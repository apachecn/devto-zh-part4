# æ—¶é—´è·Ÿè¸ª:OpenBSD ä¸Šçš„ Kimai2 1.0

> åŸæ–‡:[https://dev . to/nab bisen/time-tracking-kimai 2-1-0-on-openbsd-9k](https://dev.to/nabbisen/time-tracking-kimai2-1-0-on-openbsd-9k)

## [](#introducation)ç®€ä»‹

[Kimai2 1.0 å‘å¸ƒ](https://github.com/kevinpapst/kimai2/releases/tag/1.0)ï¼ï¼

[Kimai](https://www.kimai.org/) æ˜¯å¼€æºçš„æ—¶é—´è¿½è¸ª appã€‚
æœ‰ä¸¤å¤§ç‰ˆæœ¬: [Kimai1](https://github.com/kimai/kimai) ï¼Œæ˜¯ [GPLv3](https://www.gnu.org/licenses/gpl-3.0.en.html) è¡Œè´§ï¼Œ [Kimai2](https://github.com/kevinpapst/kimai2) ï¼Œæ˜¯ [MIT](https://opensource.org/licenses/MIT) è¡Œè´§ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•å®‰è£…æœ€æ–°çš„ Kimai2ã€‚å®ƒåŸºäº [Symfony](https://symfony.com/) ã€ [PHP](https://php.net) å¥å£®æ¡†æ¶ã€‚
æ­¤å¤–ï¼ŒKimai2 éå¸¸é€‚åˆ[ä¿æŒ Symfony çš„æ›´æ–°](https://github.com/kevinpapst/kimai2/pull/710):)

#### [](#environment)ç¯å¢ƒ

*   OS: [OpenBSD](https://www.openbsd.org/) 6.5
*   æ•°æ®åº“: [MariaDB](https://mariadb.org/) 10.0
*   Web æœåŠ¡å™¨: [httpd](https://man.openbsd.org/httpd.8)
*   åº”ç”¨æœåŠ¡å™¨: [PHP](https://php.net/) 7.3
    *   CGI: [PHP-FPM](https://php-fpm.org/)
    *   åŒ…ç®¡ç†å‘˜:[ä½œæ›²è€…](https://getcomposer.org/)
*   æ—¶é—´è¿½è¸ªåº”ç”¨ç¨‹åº:Kimai2 1.0

## [](#tutorial)æ•™ç¨‹

å®˜æ–¹å®‰è£…æ‰‹å†Œè¿™é‡Œæ˜¯[è¿™é‡Œæ˜¯](https://www.kimai.org/documentation/installation.html)ã€‚

#### [](#requirements)è¦æ±‚

é¦–å…ˆï¼Œä½ å¿…é¡»å…·å¤‡:

*   [httpd ä½œä¸ºç½‘ç»œæœåŠ¡å™¨](https://dev.to/nabbisen/setting-up-openbsds-httpd-web-server-4p9f)
*   [php-fpm](https://dev.to/nabbisen/php-fpm-on-openbsd-2iof)
*   PHP [ä½œæ›²](https://dev.to/nabbisen/almost-php-72-composer-with-openbsd-64-100o)
*   [MariaDB ä½œä¸ºæ•°æ®åº“æœåŠ¡å™¨](https://dev.to/nabbisen/installing-mariadb-server-on-openbsd-5lm)

å¦å¤–ï¼Œ[æ¨è HTTPS](https://dev.to/nabbisen/lets-encrypt-certbot-for-openbsds-httpd-3ofd)ã€‚

è¿™ä¸ªéƒ¨åˆ†æ‰€æœ‰çš„é“¾æ¥éƒ½æ˜¯æˆ‘å†™çš„æ•™ç¨‹ã€‚

#### [](#db-server)æ•°æ®åº“æœåŠ¡å™¨

åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·:

```
CREATE DATABASE <database> DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
GRANT ALL PRIVILEGES ON <database>.* TO <dbuser> IDENTIFIED BY '<dbpass>'; 
```

#### [](#app-server)åº”ç”¨æœåŠ¡å™¨

è·å–åŒ…:

```
$  git clone -b 1.0 --depth 1 https://github.com/kevinpapst/kimai2.git
$  cd kimai2/ 
```

ç„¶åä¿®æ”¹æƒé™:

```
#  chown -R :www .
#  chmod -R g+r .
#  chmod -R g+rw var/ 
```

è¿˜è¦é…ç½®ç³»ç»Ÿ:

```
$  cp -p .env.dist .env
$  nvim .env 
```

è¿™é‡Œæ˜¯`.env` :
ä¸­è‡³å°‘è¦æ”¹å˜çš„åœ°æ–¹

```
- APP_SECRET=change_this_to_something_unique + APP_SECRET=<some_salt_key_long_enough> ...
- DATABASE_URL=sqlite:///%kernel.project_dir%/var/data/kimai.sqlite
+ DATABASE_URL=mysql://<dbuser>:<dbpass>@<dbhost>:<dbport>/<database> 
```

*æ³¨:æ ¹æ® [Symfony çš„æ–‡æ¡£](https://symfony.com/doc/current/reference/configuration/framework.html#secret) , `secret`å€¼â€œåº”è¯¥æ˜¯éšæœºé€‰æ‹©çš„ä¸€ç³»åˆ—å­—ç¬¦ã€æ•°å­—å’Œç¬¦å·ï¼Œå»ºè®®é•¿åº¦åœ¨ 32 ä¸ªå­—ç¬¦å·¦å³ã€‚â€æˆ‘ç”¨äº† [LastPass å‘ç”Ÿå™¨](https://www.lastpass.com/password-generator)ã€‚*

è®©æˆ‘ä»¬é€šè¿‡ Composer å®‰è£…åº”ç”¨ç¨‹åºã€‚
ä½¿ç”¨`php-7.* /usr/local/libexec/composer.phar`æ˜¯ OpenBSD å®‰è£…çš„è¯€çªã€‚

```
$  php-7.3 /usr/local/libexec/composer.phar install --no-dev --optimize-autoloader 
```

ç»“æœæ˜¯:

```
Loading composer repositories with package information
Installing dependencies from lock file
Package operations: 136 installs, 0 updates, 0 removals
  - Installing ocramius/package-versions (1.4.0): Downloading (100%)         
  - Installing kimai/kimai2-composer (0.1): Downloading (100%)         
  - Installing symfony/flex (v1.2.5): Downloading (100%) ...
 - Installing white-october/pagerfanta-bundle (v1.2.4): Loading from cache
Generating optimized autoload files
ocramius/package-versions:  Generating version class...
ocramius/package-versions: ...done generating version class
Executing script cache:clear [OK]
Executing script assets:install [OK] 
```

*æ³¨æ„:ä¸éœ€è¦åˆ›å»ºæ¨¡å¼å’Œè¡¨ï¼Œè¿™ä¸åŒäº[å®‰è£… Kimai2 0.9](https://dev.to/nabbisen/time-tracking-kimai2-on-openbsd-2mk9) çš„æ–¹å¼ã€‚*

å¥½äº†ï¼Œæˆ‘ä»¬ç»§ç»­å§:

```
$  php-7.3 bin/console cache:warmup --env=prod 
```

ç»“æœæ˜¯:

```
 // Warming up the cache for the prod environment with debug false                                                      

 [OK] Cache for the "prod" environment (debug=false) was successfully warmed. 
```

ç³»ç»Ÿç°åœ¨å‡ ä¹å‡†å¤‡å¥½äº†ã€‚
è®©æˆ‘ä»¬å‡†å¤‡ web æœåŠ¡å™¨ã€‚
å°†ä¸‹é¢çš„å®šä¹‰æ·»åŠ åˆ° [`/etc/httpd.conf`](https://man.openbsd.org/httpd.conf.5) :

```
server "<fqdn>" {
        listen on $ext_addr port 80
        block return 301 "https://$SERVER_NAME$REQUEST_URI"
}
server "<fqdn>" {
        listen on $ext_addr tls port 443
        tls {
                certificate     "/etc/letsencrypt/live/<fqdn>/fullchain.pem"
                key             "/etc/letsencrypt/live/<fqdn>/privkey.pem"
        }
        # create unique log files (optional):
        log {
                access  "<fqdn>-access.log"
                error   "<fqdn>-error.log"
        }

        # the document root is the directory named `public`:
        root "/<...>/kimai2/public"
        directory index index.php

        location "/*.php" { 
                fastcgi socket "/run/php-fpm.sock"
        } 
        location "/*.php[/?]*" {
                fastcgi socket "/run/php-fpm.sock"
        }
        # if directories are accessed to, call `index.php` with url parameter:
        location match "^/(.*)/[^\.]+/?$" {
                fastcgi socket "/run/php-fpm.sock"
                request rewrite "/index.php/%1"
        }
} 
```

é‡å¯:

```
#  rcctl restart httpd 
```

æœ€åï¼Œè¿›å…¥ä½ çš„ FQDN aka https:// <fqdn>ï¼Œä½ å¯ä»¥é€‰æ‹©â€œæ³¨å†Œæ–°è´¦æˆ·â€é“¾æ¥:</fqdn>

[![login](../Images/c444b7bddd97ff961dd7a2b62b016e7a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--KCM83kk0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/o0wyckfm0ntwj0a7ylpi.png)

å¦å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œ :
åˆ›å»ºä¸€ä¸ªç”¨æˆ·ä½œä¸ºç³»ç»Ÿç®¡ç†å‘˜

```
$  php-7.3 bin/console kimai:create-user <username> <email-address> ROLE_SUPER_ADMIN 
```

*ç»“æœæ˜¯* :

```
Please enter the password: 

 [OK] Success! Created user: <username> 
```

## [](#conclusion)ç»“è®º

ç°åœ¨æ‰€æœ‰çš„æœåŠ¡å™¨ï¼Œæ•°æ®åº“/åº”ç”¨ç¨‹åº/webï¼Œéƒ½å‡†å¤‡å¥½äº†å¹¶åœ¨ç›‘å¬ã€‚
è®©æˆ‘ä»¬é€šè¿‡ä»»ä½•ç½‘ç»œæµè§ˆå™¨è®¿é—®< fqdn >:

[![screenshot](../Images/94ed6989f5a0b413df2dc5d5dc315612.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--00sPVajM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5f1ueqlryin1318t3i5z.png)

ç§ï¼ŒğŸ¥³
ä¸€ä¸ªæ¼‚äº®çš„æ—¶é—´è·Ÿè¸ªåº”ç”¨ç¨‹åºï¼Œå¹²å‡€çš„ç”¨æˆ·ç•Œé¢ï¼Œç®€å•çš„èœå•å’Œå‡ ç§å¯¼å‡ºæ—¶é—´è¡¨çš„æ–¹æ³•åœ¨è¿™é‡Œï¼

æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚
å¿«ä¹è®¡ç®—ã€‚