# ç”¨é’©å­å’Œä¸Šä¸‹æ–‡å¯¹æœ¬åœ°é€šçŸ¥åšå‡ºååº”

> åŸæ–‡:[https://dev . to/salted-bytes/react-native-local-notifications-with-hooks-and-context-5g ke](https://dev.to/salted-bytes/react-native-local-notifications-with-hooks-and-context-5gke)

åœ¨ä»»ä½•åº”ç”¨ç¨‹åºä¸­ï¼Œæ€»ä¼šæœ‰éœ€è¦å‘ç”¨æˆ·ä¼ é€’å°ä¿¡æ¯çš„æ—¶å€™ã€‚åœ¨ web åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™é€šå¸¸æ˜¯é€šè¿‡ toast ç±»å‹çš„æ¶ˆæ¯æ¥å®Œæˆçš„ã€‚åœ¨ç§»åŠ¨åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™é€šå¸¸æ˜¯æŸç§æé†’æˆ–æœ¬åœ°é€šçŸ¥ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åˆ›å»ºç”¨ React ä¸Šä¸‹æ–‡å’Œé’©å­æ›´æ–°çš„å¯é‡ç”¨è­¦æŠ¥ç»„ä»¶ã€‚

[![Alt Text](img/fb3d6ee67782cc416b9f819dbf554914.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--hg1o3gwq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/i1c6g3l0xi7r2nzjzcje.gif)

æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ notes åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥ä»[è¿™é‡Œ](https://github.com/jim-at-jibba/rn-local-notifications-tut)å…‹éš†å®Œæˆçš„é¡¹ç›®ã€‚

æ‚¨å¯ä»¥çœ‹åˆ°å®ƒå·²ç»å…·æœ‰æŸ¥çœ‹å’Œåˆ›å»ºæ³¨é‡Šçš„åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›é€šçŸ¥ç”¨æˆ·ä¿å­˜æ³¨é‡Šæ˜¯å¦æˆåŠŸæˆ–è€…æ˜¯å¦æœ‰é”™è¯¯ã€‚æ˜¾ç„¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå¯ä»¥ä½¿ç”¨è­¦æŠ¥çš„ä¾‹å­ã€‚å®ƒå¯ä»¥ç”¨æ¥é€šçŸ¥ç”¨æˆ·ä»»ä½•äº‹æƒ…ï¼

åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†éå¸¸æ£’çš„ [React Native Paper](https://reactnativepaper.com/) ã€‚[é˜…è¯»æˆ‘æœ€è¿‘çš„æ–‡ç« ](https://dev.to/salted-bytes/best-of-the-best-react-native-ui-libraries-31p3)ï¼Œäº†è§£æˆ‘ä¸ºä»€ä¹ˆä½¿ç”¨å®ƒï¼Œä¸ºä»€ä¹ˆæˆ‘è®¤ä¸ºå®ƒæ˜¯æœ€å¥½çš„åŸç”Ÿ UI åº“ã€‚æˆ‘ä»¬å°†ä½¿ç”¨`Snackbar`ç»„ä»¶ä½œä¸ºæˆ‘ä»¬çš„è­¦æŠ¥ç»„ä»¶ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•é€‚åˆæ‚¨çš„é¡¹ç›®çš„ç»„ä»¶ã€‚

æˆ‘ä»¬æ­£æŠŠè¿™ç¯‡æ–‡ç« åˆ†æˆå‡ ä¸ªä¸åŒçš„éƒ¨åˆ†ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ [`React.context`](https://reactjs.org/docs/context.html) æ¥ä¿æŒå’Œè®¾ç½®æˆ‘ä»¬çš„è­¦æˆ’çŠ¶æ€ã€‚React æ–‡æ¡£æŒ‡å‡º

> ä¸Šä¸‹æ–‡æä¾›äº†ä¸€ç§é€šè¿‡ç»„ä»¶æ ‘ä¼ é€’æ•°æ®çš„æ–¹å¼ï¼Œè€Œä¸å¿…åœ¨æ¯ä¸€å±‚æ‰‹åŠ¨å‘ä¸‹ä¼ é€’å±æ€§ã€‚

ä¸Šä¸‹æ–‡éå¸¸é€‚åˆç®¡ç†éœ€è¦å…¨å±€å¯ç”¨çš„ç®€å•çŠ¶æ€ã€‚

## [](#global-context-provider)å…¨å±€ä¸Šä¸‹æ–‡æä¾›è€…

æˆ‘è®¤ä¸ºï¼Œæ ¹æ®**åŸŸ**å°†å­˜å‚¨åœ¨ä¸Šä¸‹æ–‡ä¸­çš„çŠ¶æ€è¿›è¡Œæ‹†åˆ†æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ï¼Œä¾‹å¦‚ï¼Œä¸ºè­¦æŠ¥ã€ä¾§æ ã€è´­ç‰©è½¦ç­‰è®¾ç½®å•ç‹¬çš„ä¸Šä¸‹æ–‡ã€‚é€šè¿‡è¿™æ ·åšï¼Œä½ å¯ä»¥é¿å…ä¸å¿…è¦çš„é‡æ–°å‘ˆç°ï¼Œä½ çš„è­¦å‘Šä¸Šä¸‹æ–‡ä¸ä¼šåœ¨æ„ä½ çš„ä¾§è¾¹æ ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥æ›´æ–°ä¸€ä¸ªä¸åº”è¯¥ä½¿ç”¨å¦ä¸€ä¸ªé‡æ–°å‘ˆç°ç»„ä»¶ã€‚

é€šè¿‡å°†æ‚¨çš„åº”ç”¨ç¨‹åºåŒ…è£…åœ¨ä¸€ä¸ª`Context.provider`ä¸­ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡ã€‚ä½†æ˜¯å½“ä½ æœ‰å¤šä¸ªä¸Šä¸‹æ–‡æ—¶ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªâ€œé—®é¢˜â€,å› ä¸ºè¿™ä¼šä½¿ä½ çš„`App.js`å˜å¾—è‡ƒè‚¿ï¼Œæ›´ä¸å¯è¯»ã€‚ä½†æ˜¯å¹¶æ²¡æœ‰å¤±å»ä¸€åˆ‡ï¼Œæ¥è‡ª LevelUp tuts çš„ Scott Tolinsky ç»™æˆ‘ä»‹ç»äº†ä¸€æ®µå¾ˆæ£’çš„ä»£ç ï¼Œå®ƒå°†ä½ çš„`Context.Providers`ç»„æˆäº†ä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶ã€‚è¿™ä½¿å¾—äº‹æƒ…å˜å¾—æ›´åŠ æ•´æ´ã€‚

ä½ å¯èƒ½å·²ç»å‘ç°åœ¨ä½ çš„`App.js`ä¸­æœ‰å¤šä¸ªä¸Šä¸‹æ–‡å®é™…ä¸Šå¹¶ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘åªæ˜¯å–œæ¬¢ä¸œè¥¿æ•´æ´ã€‚

```
import * as React from "react";
// we will import our context providers here

function ProviderComposer({ contexts, children }) {
  return contexts.reduceRight(
    (kids, parent) =>
      React.cloneElement(parent, {
        children: kids
      }),
    children
  );
}

function ContextProvider({ children }) {
  return (
    // we add our providers to the contexts prop
    <ProviderComposer contexts={[]}>{children}</ProviderComposer>
  );
}

export default ContextProvider; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#alert-provider)é¢„è­¦æä¾›è€…

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå¯ä»¥ä¿å­˜æˆ‘ä»¬çš„è­¦æŠ¥çŠ¶æ€çš„ä¸Šä¸‹æ–‡ã€‚æˆ‘ä»¬ä½¿ç”¨`React.createContext`å¹¶å°†å®ƒèµ‹ç»™ä¸€ä¸ªå˜é‡ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬è¿˜å¯¼å‡ºäº†å˜é‡ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä»¥åå¯ä»¥åœ¨å…¶ä»–ç»„ä»¶ä¸­ä½¿ç”¨å®ƒã€‚

æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…è£…æˆ‘ä»¬çš„`AlertContext.Provider`çš„`AlertProvider`ç»„ä»¶ï¼Œè¿™è®©æˆ‘ä»¬å¯ä»¥è®¿é—®å­˜å‚¨åœ¨æˆ‘ä»¬çš„`AlertContext`ä¸­çš„çŠ¶æ€ã€‚

```
import * as React from "react";

export const AlertContext = React.createContext({});

export const AlertProvider = ({ children }) => {

  return (
    <AlertContext.Provider
      value={// Our context values will go here}>
      {children}
    </AlertContext.Provider>
  );
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥ç®¡ç†å­˜å‚¨åœ¨æˆ‘ä»¬çš„ä¸Šä¸‹æ–‡ä¸­çš„æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºæ­¤ä½¿ç”¨`React.useState`,ä½†æ˜¯ç”±äºæˆ‘ä»¬çš„æ•°æ®ç»“æ„ç¨å¾®å¤æ‚ä¸€äº›ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†æ›´æ–°å¤šæ¡æ•°æ®æ¥è§¦å‘æˆ‘ä»¬çš„è­¦æŠ¥ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘å†³å®šä½¿ç”¨`React.useReducer`ã€‚å®ƒä½¿å¾—è­¦æŠ¥æä¾›è€…çš„å®ç°åŠå…¶æ–¹æ³•çš„æ‰§è¡Œæ›´åŠ ç®€æ´ã€‚

```
[...]

const initialState = {
  type: "close",
  open: false,
  alertType: "info",
  message: ""
};

const reducer = (state, action) => {
  switch (action.type) {
    case "close":
      return {
        ...initialState
      };
    case "open":
      return {
        open: true,
        alertType: action.alertType,
        message: action.message
      };
    default:
      throw new Error("Action not found");
  }
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„`provider`ä¸­ä½¿ç”¨æˆ‘ä»¬çš„`reducer`,è®©æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®æ‰€æœ‰å­˜å‚¨çš„è­¦æŠ¥çŠ¶æ€ã€‚è¿™ç§ç»„åˆå…è®¸æˆ‘ä»¬ä»åº”ç”¨ç¨‹åºçš„ä»»ä½•éƒ¨åˆ†æ›´æ–°å’Œè®¿é—®è­¦æŠ¥çŠ¶æ€çš„ä»»ä½•éƒ¨åˆ†ï¼Œåªè¦åº”ç”¨ç¨‹åºåŒ…è£…åœ¨æˆ‘ä»¬çš„å…¨å±€ä¸Šä¸‹æ–‡æä¾›ç¨‹åºä¸­ã€‚

```
import * as React from "react";

const initialState = {
  type: "close",
  open: false,
  alertType: "info",
  message: ""
};

export const AlertContext = React.createContext({});

const reducer = (state, action) => {
  switch (action.type) {
    case "close":
      return {
        ...initialState
      };
    case "open":
      return {
        open: true,
        alertType: action.alertType,
        message: action.message
      };
    default:
      throw new Error();
  }
};

export const AlertProvider = ({ children }) => {
  const [alertState, dispatchAlert] = React.useReducer(reducer, initialState);
  return (
    <AlertContext.Provider
      value={{
        alertState,
        dispatchAlert
      }}>
      {children}
    </AlertContext.Provider>
  );
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#the-alert-component)å‘Šè­¦ç»„ä»¶

æ­£å¦‚æˆ‘åœ¨æœ¬æ–‡å¼€å§‹æ—¶æåˆ°çš„ï¼Œæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ [React Native Paper](https://reactnativepaper.com/) åŠå…¶ Snackbar ç»„ä»¶æ¥æé†’ç”¨æˆ·æˆ‘ä»¬åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•ä¿¡æ¯ã€‚ä½†æ˜¯è¿™ä¸ªå¯ä»¥æ¢æˆå…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚æ‚¨åªéœ€è¦ä¸€ç§æ–¹æ³•æ¥ä½¿ç”¨ä»è­¦æŠ¥ä¸Šä¸‹æ–‡ä¼ é€’ä¸‹æ¥çš„æ•°æ®ã€‚

è¿™ä¸ªç»„ä»¶éå¸¸ç®€å•ã€‚æˆ‘ä»¬ä½¿ç”¨`React.useContext`é’©å­æ¥è®¢é˜…å¯¹`AlertContext`çš„æ›´æ”¹ï¼Œç„¶åæ ¹æ®çŠ¶æ€æ‰“å¼€/å…³é—­å¼¹å‡ºçª—å£ã€‚æˆ‘ä»¬æ ¹æ®`alertState.alertType`å±æ€§è®¾ç½®è­¦å‘Šæ¡†çš„æ ·å¼ï¼Œä»¥æ°å½“åœ°ä¼ è¾¾æ¶ˆæ¯çš„å«ä¹‰ã€‚

```
import * as React from "react";
import { Snackbar } from "react-native-paper";
import { AlertContext } from "../globalState";
import { colors } from "../constants";

const SnackBar = () => {
  const { alertState, dispatchAlert } = React.useContext(AlertContext);
  const [alertSyle, setAlertStyle] = React.useState({
    backgroundColor: colors.info
  });

  React.useEffect(() => {
    switch (alertState.alertType) {
      case "info":
        setAlertStyle({
          backgroundColor: colors.success
        });
        break;
      case "error":
        setAlertStyle({
          backgroundColor: colors.error
        });
        break;
      case "success":
        setAlertStyle({
          backgroundColor: colors.success
        });
        break;
      default:
        setAlertStyle({
          backgroundColor: colors.info
        });
    }
  }, [alertState]);

  const closeMe = () => {
    dispatchAlert({ type: "close" });
  };

  return (
    <>
      {typeof alertState.open === "boolean" && (
        <Snackbar
          style={alertSyle}
          visible={alertState.open}
          onDismiss={() => closeMe()}
          action={{
            label: "Undo",
            onPress: () => {
              console.log("Snackbar closed");
              // Do something
            }
          }}>
          {alertState.message}
        </Snackbar>
      )}
    </>
  );
};

export default SnackBar; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#using-our-alert-provider)ä½¿ç”¨æˆ‘ä»¬çš„è­¦æŠ¥æä¾›ç¨‹åº

æœ€åï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹ä½¿ç”¨æˆ‘ä»¬å¯çˆ±çš„æ–°åŠŸèƒ½`AlertContext`ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šçŸ¥ç”¨æˆ· GraphQL çªå˜çš„ç»“æœã€‚

å¦‚æœæ‚¨æƒ³äº†è§£å¦‚ä½•è½»æ¾åœ°å°† GraphQL é›†æˆåˆ°æ‚¨çš„ React æœ¬æœºåº”ç”¨ç¨‹åºä¸­ï¼Œè¯·æŸ¥çœ‹æœ¬æ–‡ã€‚

åŒæ ·ï¼Œæˆ‘ä»¬åœ¨ Snackbar ç»„ä»¶ä¸­ä½¿ç”¨äº†`useContext`é’©å­æ¥è®¿é—®`dispatchAlert`æ–¹æ³•ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬æé†’ç”¨æˆ· GraphQL å˜å¼‚çš„æˆåŠŸæˆ–é”™è¯¯ã€‚

```
[...]

const NoteCreateScreen = ({ navigation }) => {
  const { dispatchAlert } = React.useContext(AlertContext);

  const createNoteMutation = useMutation(gql(createNote));
  return (
    <SafeAreaView style={gStyle.container}>
      <ScrollView contentContainerStyle={gStyle.contentContainer}>
        <View style={{ flex: 1, height: '100%', width: '100%' }}>
          <Surface style={styles.surface}>
            <Formik
              initialValues={{ note: '', title: '' }}
              onSubmit={({ note, title }) => {
                const input = {
                  id: uuid(),
                  title,
                  note,
                  createdAt: moment().toISOString()
                };
                createNoteMutation({
                  variables: {
                    input
                  },
                  update: (_, { data, error }) => {
                    if (error) {
                      dispatchAlert({
                        type: 'open',
                        alertType: 'error',
                        message: 'Error creating note'
                      });
                    } else {
                      dispatchAlert({
                        type: 'open',
                        alertType: 'success',
                        message: 'Note created'
                      });
                      navigation.state.params.refetch();
                      navigation.goBack();
                    }
                  }
                });
              }}
            >
              {({ values, handleSubmit, handleChange }) => {
                return (
                  <>
                    [...]
                  </>
                );
              }}
            </Formik>
          </Surface>
        </View>
      </ScrollView>
    </SafeAreaView>
  );
};

export default NoteCreateScreen; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°±æ˜¯ä½ æ‰€æ‹¥æœ‰çš„ï¼Œä¸€ä¸ªé«˜åº¦å¯å®šåˆ¶çš„ï¼Œå¯é‡ç”¨çš„ï¼Œå…¨çƒå¯æ‰§è¡Œçš„æœ¬åœ°é€šçŸ¥ç³»ç»Ÿã€‚è¿™ç§æƒ…å†µæ˜¯å¯¹`React Context`çš„å®Œç¾è¿ç”¨ï¼Œä½†æ˜¾ç„¶è¿˜æœ‰æ›´å¤šã€‚

ä½ è¿˜ä¼šåˆ›ä½œä»€ä¹ˆï¼Ÿ

# [](#thanks-for-reading)æ„Ÿè°¢é˜…è¯»ğŸ™

å¦‚æœæˆ‘é”™è¿‡äº†ä»€ä¹ˆï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¯·å‘Šè¯‰æˆ‘