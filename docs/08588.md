# ä»£ç çš„å‡ºç°â€”â€”éœ€è¦ä¸€äº›æ±‡ç¼–â€”â€”éš¾é¢˜ 7

> åŸæ–‡:[https://dev . to/10x learner/advent-of-code-some-assembly-required-puzzle-7-518m](https://dev.to/10xlearner/advent-of-code-some-assembly-required-puzzle-7-518m)

# [](#advent-of-code-some-assembly-required-puzzle-7)ä»£ç çš„å‡ºç°â€”â€”éœ€è¦ä¸€äº›ç»„è£…â€”â€”éš¾é¢˜ 7

ä½ å¥½ï¼æˆ‘æ˜¯ Xavier Jouvenotï¼Œè¿™æ˜¯å…³äºä»£ç å‡ºç°çš„[ç³»åˆ—çš„ç¬¬ä¸ƒéƒ¨åˆ†ã€‚è¿™é‡Œ](https://adventofcode.com)å¯ä»¥æ‰¾åˆ°ä¸Šä¸€éƒ¨åˆ†

å¯¹äºè¿™ä¸ªæ–°å¸–å­ï¼Œæˆ‘ä»¬å°†ä» 2015 å¹´ 12 æœˆ 7 æ—¥å¼€å§‹è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåä¸ºâ€œéœ€è¦ä¸€äº›è£…é…â€ã€‚æˆ‘å°†åœ¨ C++ä¸­æå‡ºè§£å†³æ–¹æ¡ˆï¼Œä½†æ¨ç†å¯ä»¥åº”ç”¨äºå…¶ä»–è¯­è¨€ã€‚

## [](#part-1)ç¬¬ä¸€éƒ¨åˆ†

### [](#the-problem)é—®é¢˜

è¿™ä¸ªé—®é¢˜çš„å®Œæ•´ç‰ˆå¯ä»¥ç›´æ¥åœ¨[é™ä¸´ä»£ç ç½‘ç«™](https://adventofcode.com/2015/day/7)ä¸Šæ‰¾åˆ°ï¼Œæˆ‘åœ¨è¿™é‡Œåªæè¿°é—®é¢˜çš„æœ¬è´¨:

åœ£è¯è€äººç»™äº†å°é²æ¯”ä¸€å¥—ç”µçº¿å’Œä½é€»è¾‘é—¨ï¼Œä»–éœ€è¦æˆ‘ä»¬çš„å¸®åŠ©æ¥ç»„è£…ç”µè·¯ï¼Œå› ä¸ºä»–å¤ªå°äº†ï¼Œæ— æ³•ç‹¬ç«‹å®Œæˆã€‚

æ¯æ ¹ç”µçº¿ç”±ä¸€äº›å°å†™å­—æ¯æ ‡è¯†ï¼Œå¯ä»¥ä¼ è¾“ 16 ä½ä¿¡å·ï¼Œåªèƒ½ä»ä¸€ä¸ªæºè·å¾—ä¿¡å·ï¼Œä½†å¯ä»¥å‘å¤šä¸ªç›®çš„åœ°æä¾›ä¿¡å·ã€‚ä¸€æ ¹å¯¼çº¿çš„ä¿¡å·ç”±ä¸€ä¸ªé—¨ã€å¦ä¸€æ ¹å¯¼çº¿æˆ–æŸä¸ªç‰¹å®šå€¼æä¾›ç»™æ¯æ ¹å¯¼çº¿ã€‚æœ€åï¼Œç›´åˆ°æ‰€æœ‰çš„è¾“å…¥éƒ½æœ‰ä¿¡å·æ—¶ï¼Œé—¨æ‰æä¾›ä¿¡å·ã€‚

ä¾‹å¦‚:

```
123 -> x // Attribution of the signal to the wire
456 -> y // Attribution of the signal to the wire
x AND y -> d // Bitwise AND operator
x OR y -> e // Bitwise OR operator
x LSHIFT 2 -> f // Left Shifting
y RSHIFT 2 -> g // Right Shifting
NOT x -> h // Bitwise complement
NOT y -> i // Bitwise complement 
```

<svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç»“æœåœ¨

```
x: 123
y: 456
d: 72
e: 507
f: 492
g: 114
h: 65412
i: 65079 
```

<svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸æ‰¾åˆ°ç”µçº¿`a`ä¸­çš„ä¿¡å·å€¼

### [](#solution)è§£

é¦–å…ˆï¼Œè¿™ä¸ªé—®é¢˜å’Œä¸Šä¸€ä¸ªå®Œå…¨ä¸åœ¨ä¸€ä¸ªå±‚é¢ä¸Šã€‚é‚£ä¹ˆå°±ä»å®ƒå¼€å§‹å§ã€‚

#### [](#bit-operations)ä½æ“ä½œ

å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›æ¯”ç‰¹ä¸Šçš„æ“ä½œç¬¦ã€‚å¸Œæœ› C++å·²ç»å®šä¹‰äº†æˆ‘ä»¬éœ€è¦çš„é‚£ä¸ª

ä»–ä»¬åœ¨è¿™é‡Œ:

*   `&`æ˜¯`AND`è¿ç®—ç¬¦
*   `|`æ˜¯`OR`è¿ç®—ç¬¦
*   `<<`æ˜¯`LSHIFT`è¿ç®—ç¬¦
*   `>>`æ˜¯`RSHIFT`è¿ç®—ç¬¦
*   `~`æ˜¯`NOT`è¿ç®—ç¬¦

æˆ‘é¼“åŠ±ä½ æ£€æŸ¥ä¸€ä¸‹å…³äºè¿™äº›æ“ä½œå‘˜çš„ [std æ–‡æ¡£](https://en.cppreference.com/w/cpp/language/operator_arithmetic)ã€‚

#### [](#the-types)ç±»å‹

è®©æˆ‘ä»¬ä»æˆ‘ä»¬éœ€è¦çš„ç±»å‹/å¯¹è±¡å¼€å§‹ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ª`Signal`ï¼Œå®ƒå°†æ˜¯ä¸€ä¸ª`uint16_t`ï¼Œå› ä¸ºä¿¡å·æ˜¯ 16 ä½çš„ã€‚

```
using Signal = uint16_t; 
```

<svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æœ‰`Wire`ï¼Œå®ƒæ˜¯ä¸€ä¸ªæœ‰åå­—çš„ç‰©ä½“ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªä¿¡å·ã€‚è¿™æ˜¯æ ‡é¢˜å¯èƒ½çš„æ ·å­ã€‚

```
class Wire
{
public:
    explicit Wire (const std::string& name_);
    ~Wire ();

    bool hasSignal () const;

    void setSignal(const Signal value_);
    Signal getSignal() const;

    std::string getName() const;
private:
    std::string name;
    bool hasSignalValueBeenSet{false};
    Signal value{0};
}; 
```

<svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¿¡å·å’Œå¯¼çº¿ï¼Œæˆ‘ä»¬éœ€è¦çš„æœ€åä¸€ä¸ªå¯¹è±¡æ˜¯å…è®¸æˆ‘ä»¬è®¡ç®—æ¯æ ¹å¯¼çº¿çš„ä¿¡å·å€¼çš„æ“ä½œã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æœ‰ 5 ç§æ“ä½œ:

```
enum class OperationType
{
    AND, // x AND y -> z
    OR, // x OR y -> z
    LSHIFT, // x LSHIFT 2 -> y
    RSHIFT, // x RSHIFT 2 -> y
    NOT, // NOT x -> y
    ATTRIBUTION, // 123 -> x
}; 
```

<svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ä¸ºæ¯ç§æ“ä½œè®¾ç½®ä¸€ä¸ªå…¬å…±æ¥å£çš„è¡Œä¸º:

```
class Operation
{
public:
    virtual Wire& getResultWire () = 0;
    virtual bool canBeExecuted () const = 0;
    virtual bool isExecuted () const = 0;
    virtual void execute () = 0;
}; 
```

<svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**ç¼–è¾‘**:æ³¨æ„â€œè¾“å‡ºçº¿â€å¯ä»¥ç›´æ¥é›†æˆåœ¨`Operation`ç±»ä¸­ï¼Œå› ä¸ºæ‰€æœ‰æ“ä½œåªèƒ½æœ‰ä¸€ä¸ªè¾“å‡ºã€‚

æ¯ä¸ªç‰¹å®šçš„æ“ä½œéƒ½å°†ä»è¯¥ç±»ç»§æ‰¿ï¼Œå¹¶é‡å†™è¯¥å‡½æ•°ä»¥æŒ‡å®šå…¶è¡Œä¸ºã€‚ä¾‹å¦‚:

```
class LShift : public Operation
{
public:
    LShift (Wire& input_, size_t number_, Wire& output_) : input(input_), number(number_), output(output_) {}
    ~LShift () = default;

    Wire& getResultWire () override
    {
        return output;
    }

    bool canBeExecuted () const override
    {
        return input.hasSignal();
    }

    bool isExecuted () const override
    {
        return hasBeenExecuted;
    }

    void execute () override
    {
        output.setSignal (input.getSignal() << number);
        hasBeenExecuted = true;
    }

private:
    Wire& input, &output;
    size_t number{0};
    bool hasBeenExecuted{false};
}; 
```

<svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ æƒ³çœ‹æ‰€æœ‰æ“ä½œçš„å®ç°ï¼Œæˆ‘é‚€è¯·ä½ å»æˆ‘çš„ [Github](https://github.com/Xav83/AdventOfCode/tree/2015.07/2015/Day7) ã€‚

#### [](#the-program)ç¨‹åº

ç°åœ¨æˆ‘ä»¬æœ‰äº†æˆ‘ä»¬çš„ä¸»ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›ä»£ç ä»éš¾é¢˜è¾“å…¥ä¸­æå–æ•°æ®ï¼Œæ¯”å¦‚:

```
class Wires; // vector of Wire with some specific behavior
class Operations; // vector of Operation with a method "run" to run all the operations

foreachLineIn(fileContent, [&wires](const std::string& line)
{
    const auto operationType = getOperationFromInstruction (line);
    auto& wiresFromInstruction = getWiresNameInInstruction (line);
    for(auto& w : wiresFromInstruction.getWires())
    {
        wires.addNewWire(w); // Only adds wire if it doesn't already exist
    }
});

foreachLineIn(fileContent, [&wires, &operations](const std::string& line)
{
    const auto operationType = getOperationFromInstruction (line);
    auto& wiresFromInstruction = getWiresNameInInstruction (line);
    operations.addNewOperation(operationType, wires, wiresFromInstruction, line);
}); 
```

<svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬æœ‰äº†æ‰€æœ‰çš„æ•°æ®ï¼Œæˆ‘ä»¬â€œåªâ€éœ€è¦è¿è¡Œå®ƒï¼Œâ€¦æˆ‘çš„æ„æ€æ˜¯`operations.run()`ã€‚

```
void Operations::run()
{
    while (std::any_of(std::begin(operations), std::end(operations), [](const auto& operation)
    {
        return !operation->isExecuted();
    }))
    {
        for(auto& operation : operations)
        {
            if(!operation->isExecuted() && operation->canBeExecuted())
            {
                operation->execute();
            }
        }
    }
} 
```

<svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg viewBox="0 0 448 512" class="highlight-action highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç§ï¼Œæ¯æ ¹ç”µçº¿éƒ½æœ‰ä¿¡å·ã€‚ç°åœ¨è¦åšçš„å°±æ˜¯ç”¨`std::find_if`å¾—åˆ°åä¸º`a`çš„çº¿æ¥æ±‚è§£è¿™éƒ¨åˆ†ã€‚

## [](#part-2)ç¬¬äºŒéƒ¨åˆ†

### [](#the-problem)é—®é¢˜

å¯¹äºè¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¿…é¡»è·å– a çº¿çš„ä¿¡å·ï¼Œå°† b çº¿è¦†ç›–ä¸ºè¯¥ä¿¡å·ï¼Œå¹¶é‡ç½®å…¶ä»–çº¿(åŒ…æ‹¬ a çº¿),å†æ¬¡æ‰¾åˆ° a çº¿çš„ä¿¡å·å€¼ã€‚

### [](#solution)è§£

å—¯â€¦â€¦ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªè½¯ä»¶å¯ä»¥æ‰¾åˆ°å¯¼çº¿`a`çš„å€¼ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯ä¿®æ”¹ç»™å¯¼çº¿ b èµ‹å€¼çš„é‚£æ¡çº¿ï¼Œç„¶åå®ƒå†æ¬¡è¿è¡Œç¨‹åºï¼Œå¾—åˆ°ç»“æœï¼Œå¯¹å—ï¼Ÿ

å®Œå…¨æ­£ç¡®ï¼Œå®ƒçš„å·¥ä½œ/çˆ±è½¯ä»¶â¤çš„å¯é‡ç”¨æ€§

## [](#conclusion)ç»“è®º

ä½ å¯ä»¥æ³¨æ„åˆ°ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­å†™çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶æ²¡æœ‰åŒ…æ‹¬æ‰€æœ‰ä½¿ç¨‹åºè¿è¡Œçš„èµ„æºï¼Œè€Œåªæ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„èµ„æºä¸­æœ‰è¶£çš„éƒ¨åˆ†ã€‚å¦‚æœä½ æƒ³ä»å¤´åˆ°å°¾çœ‹è¿™äº›èŠ‚ç›®ï¼Œä½ å¯ä»¥ç™»å½•æˆ‘çš„ [GitHub è´¦æˆ·](https://github.com/Xav83/AdventOfCode/tree/2015.07/2015/Day7)ï¼Œæ¢ç´¢å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œæ·»åŠ è¯„è®ºæˆ–æé—®ã€‚

ä»¥ä¸‹æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„ std æ–¹æ³•åˆ—è¡¨ï¼Œæˆ‘éå¸¸é¼“åŠ±æ‚¨æŸ¥çœ‹å®ƒä»¬çš„å®šä¹‰:

*   [ä½¿ç”¨](https://en.cppreference.com/w/cpp/language/type_alias)
*   [std::any_of](https://en.cppreference.com/w/cpp/algorithm/all_any_none_of)

è°¢è°¢ä½ çš„é˜…è¯»ï¼Œå¸Œæœ›ä½ å–œæ¬¢ğŸ˜ƒã€‚ç›´åˆ°ä¸‹ä¸€éƒ¨åˆ†ï¼Œäº«å—å­¦ä¹ å’Œæˆé•¿çš„ä¹è¶£ã€‚