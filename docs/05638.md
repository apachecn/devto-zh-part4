# ç”¨ React Native æ„å»ºä¸€ä¸ªâ€œéçƒ­ç‹—â€å…‹éš†

> åŸæ–‡ï¼š<https://dev.to/amanhimself/build-a-not-hotdog-clone-with-react-native-367m>

[![cover_image](img/c73bc6c549c3f77746f958c8417dd7cb.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--cpFNJBKo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://amanhimself.dev/static/29cdcebe32a0daa1982382c3e8caa5ec/f39d8/banner.webp)

å¦‚æœä½ æ˜¯ HBOã€Šç¡…è°·ã€‹(Silicon Valley)çš„ç²‰ä¸ï¼Œä½ ä¼šè®°å¾—ä»–ä»¬æ¨å‡ºäº†ä¸€æ¬¾çœŸæ­£çš„äººå·¥æ™ºèƒ½ç§»åŠ¨åº”ç”¨ï¼Œå¯ä»¥æ ¹æ®ç»™å®šçš„å›¾åƒ(æˆ–ä¸æ ¹æ®å›¾åƒ)å¯¹çƒ­ç‹—è¿›è¡Œåˆ†ç±»ã€‚ä½¿ç”¨ Google çš„ Vision APIï¼Œè®©æˆ‘ä»¬å°è¯•åœ¨ React Native ä¸­é‡æ–°åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å·¥ä½œæ¨¡å‹ã€‚

è°·æ­Œçš„è§†è§‰ API æ˜¯ä¸€ç§æœºå™¨å­¦ä¹ å·¥å…·ï¼Œå®ƒä»ä½œä¸ºè¾“å…¥æä¾›çš„å›¾åƒä¸­å¯¹ç»†èŠ‚è¿›è¡Œåˆ†ç±»ã€‚è¿™äº›åˆ†ç±»è¿‡ç¨‹åŸºäºé¢„å…ˆè®­ç»ƒçš„ API æ¨¡å‹ä¸­åŒ…å«çš„æ•°åƒä¸ªä¸åŒç±»åˆ«ã€‚Vision API æ”¯æŒé€šè¿‡ REST API è®¿é—®è¿™äº›é¢„å…ˆè®­ç»ƒå¥½çš„æ¨¡å‹ã€‚

## æˆ‘ä»¬åœ¨å»ºé€ ä»€ä¹ˆï¼Ÿ

[![hb1](img/5085d9e7086cee07c9c1baf5de91da7e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--jVPSFycL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AHg6nlnaROCavW5_YLygtEA.gif)

## ç›®å½•

*   å…ˆå†³æ¡ä»¶
*   è®¾ç½® Firebase é¡¹ç›®
*   å°† Firebase SDK ä¸ React æœ¬æœºåº”ç”¨ç¨‹åºé›†æˆ
*   ç”Ÿæˆ Google Vision API å¯†é’¥
*   è®¾å®šç›¸æœºå’Œç›¸æœºèƒ¶å·çš„æƒé™
*   åˆ›å»ºæ ‡é¢˜ç»„ä»¶
*   æ·»åŠ è¦†ç›–å¾®è°ƒå™¨
*   è¿›å…¥ç…§ç›¸æœºå’Œèƒ¶å·
*   æ·»åŠ ç¡®å®šçƒ­ç‹—çš„åŠŸèƒ½
*   æ˜¾ç¤ºæœ€ç»ˆç»“æœ
*   ç»“è®º

## å…ˆå†³æ¡ä»¶

è¦å­¦ä¹ æœ¬æ•™ç¨‹ï¼Œè¯·ç¡®ä¿æ‚¨åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­å®‰è£…äº†ä»¥ä¸‹è½¯ä»¶ï¼Œå¹¶ä¸”èƒ½å¤Ÿè®¿é—®ä¸‹é¢æåˆ°çš„æœåŠ¡:

*   å®‰è£…äº† npm/yarn çš„ [Node.js](https://nodejs.org/en/) ( > = `10.x.x`)ã€‚
*   [expo-cli](https://docs.expo.io/versions/latest/workflow/expo-cli/?) ( > = `3.0.9`)ï¼ŒåŸå create-react-native-appã€‚
*   ä¸€ä¸ª[è°·æ­Œäº‘å¹³å°](https://cloud.google.com/)è´¦å·
*   [Firebase å­˜å‚¨](https://console.firebase.google.com/)è®¾ç½®
*   Android æˆ– iOS ç‰ˆ Expo å®¢æˆ·ç«¯åº”ç”¨ï¼Œç”¨äºæµ‹è¯•åº”ç”¨

## è®¾ç½® Firebase é¡¹ç›®

åœ¨æœ¬èŠ‚ä¸­ï¼Œè®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªæ–°çš„ Firebase é¡¹ç›®ã€‚å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰è¿™ä¸ªè¿‡ç¨‹ï¼Œå¹¶ä¸”çŸ¥é“å¦‚ä½•ä» Firebase é¡¹ç›®ä¸­è·å–é…ç½®å¯†é’¥ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚

è®¿é—® [Firebase](https://console.firebase.google.com/) å¹¶ç”¨æ‚¨çš„ Google ID ç™»å½•ã€‚ç™»å½•åï¼Œå•å‡»ä¸€ä¸ªæ–°é¡¹ç›®å¹¶è¾“å…¥åç§°ã€‚æœ€åï¼Œç‚¹å‡»**åˆ›å»ºé¡¹ç›®**æŒ‰é’®ã€‚

[![hb1](img/70f867c0fb36b3de49beb4abf73da95f.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--1xMKnU1Z--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2ABDhg-K1-ekeYg4D2AAir3A.jpeg)

åˆ›å»ºé¡¹ç›®å¹¶é‡å®šå‘åˆ°ä»ªè¡¨æ¿å±å¹•åï¼Œåœ¨å·¦ä¾§èœå•ä¸­ï¼Œç‚¹å‡»**è®¾ç½®**å›¾æ ‡ï¼Œç„¶åè½¬åˆ°**é¡¹ç›®è®¾ç½®**ã€‚

[![hb2](img/b6bbd01fb313ead5abadee51fb8735d9.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--kwGPGWDw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AyJvioMA9wqdBcPGS5HiwYQ.png)

å¦‚ä¸Šæ‰€ç¤ºï¼Œå°† Firebase ä¸ React Native æˆ– Expo åº”ç”¨ç¨‹åºé›†æˆéœ€è¦æ•´ä¸ª`firebaseConfig`å¯¹è±¡ã€‚å°†å®ƒä»¬ä¿å­˜åœ¨æŸä¸ªåœ°æ–¹ï¼Œæˆ–è€…ç¡®ä¿æ‚¨çŸ¥é“å¦‚ä½•å¯¼èˆªåˆ°æ­¤é¡µé¢ã€‚

ä¸‹ä¸€æ­¥æ˜¯è®¾ç½® Firebase å­˜å‚¨è§„åˆ™ï¼Œä¾‹å¦‚å…è®¸é€šè¿‡åº”ç”¨ç¨‹åºä¸Šä¼ å›¾åƒæ–‡ä»¶ã€‚ä» Firebase æ§åˆ¶å°çš„å·¦ä¾§èœå•ä¸­ï¼Œæ‰“å¼€**å­˜å‚¨**é€‰é¡¹å¡ï¼Œç„¶åé€‰æ‹©**è§„åˆ™**ã€‚æŒ‰å¦‚ä¸‹æ–¹å¼ä¿®æ”¹å®ƒä»¬ã€‚

```
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Firebase è®¾ç½®å®Œæˆã€‚

## å°† Firebase SDK ä¸ React åŸç”Ÿ app é›†æˆ

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ React æœ¬åœ°é¡¹ç›®ã€‚å¯¹äºè¿™ä¸ªæ¼”ç¤ºï¼Œè®©æˆ‘ä»¬ä½¿ç”¨`expo-cli`ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„å·¥å…·ï¼Œæœ‰åŠ©äºä»¥æ›´å¿«çš„é€Ÿåº¦åˆ›å»º React åŸç”Ÿåº”ç”¨ã€‚æ‰“å¼€ç»ˆç«¯çª—å£ï¼Œè¿è¡Œä»¥ä¸‹ä¸€ç³»åˆ—å‘½ä»¤ã€‚

```
# generate a new app
expo init not-hotdog-app

# navigate inside the app folder
cd not-hotdog-app

# install the firebase SDK & other dependencies
yarn add firebase@6.0.1 expo-permissions expo-image-picker uuid react-native-elements 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> æ­¤å¤–ï¼Œæœ¬æ•™ç¨‹ä½¿ç”¨`yarn`ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œä½†æ˜¯éå¸¸æ¬¢è¿æ‚¨ä½¿ç”¨`npm`ã€‚

ç°åœ¨é¡¹ç›®å·²ç»ç”Ÿæˆï¼Œåœ¨æ‚¨å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ‰“å¼€ç›®å½•ã€‚ç„¶ååˆ›å»ºä¸€ä¸ªåä¸º`config`çš„æ–°æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`Firebase.js`çš„æ–°æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å°†è´Ÿè´£é›†æˆ Firebase å’Œ Expo åº”ç”¨ç¨‹åºã€‚

```
import * as firebase from 'firebase'

const firebaseConfig = {
  apiKey: 'XXXX',
  authDomain: 'XXXX',
  databaseURL: 'XXXX',
  projectId: 'XXXX',
  storageBucket: 'XXXX',
  messagingSenderId: 'XXXX',
  appId: 'XXXX'
}

// Initialize Firebase
firebase.initializeApp(firebaseConfig)

export default firebase 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€æœ‰çš„ x éƒ½æ˜¯ä¸Šä¸€èŠ‚ä¸­çš„`firebaseConfig`å¯¹è±¡ä¸­æ¯ä¸ªé”®çš„å€¼ã€‚è¿™å°±å®Œæˆäº†å°† Firebase Web SDK ä¸ Expo åº”ç”¨ç¨‹åºé›†æˆçš„æ­¥éª¤ã€‚

## ç”Ÿæˆä¸€ä¸ªè°·æ­Œè§†è§‰ API å¯†é’¥

ç™»å½•è°·æ­Œäº‘å¹³å°åï¼Œæ‚¨å¯ä»¥è®¿é—®[è°·æ­Œäº‘æ§åˆ¶å°](https://console.cloud.google.com/)ï¼Œåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚

[![hb3](img/a2362ada1b705ff82e489c201fe0916c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--fVFBq9kx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AxVCIMrUY0EDtGMfUKJC5Hg.png)

ä»ä¸‹æ‹‰èœå•ä¸­å¿ƒï¼Œé€‰æ‹©ä¸€ä¸ªé¡¹ç›®ã€‚ç„¶ååœ¨ä¸‹é¢çš„å±å¹•ä¸­ç‚¹å‡»æŒ‰é’®**æ–°å»ºé¡¹ç›®**ã€‚æ³¨æ„ï¼Œæ‚¨å·²ç»ç”Ÿæˆäº†ä¸€ä¸ª Firebase é¡¹ç›®ï¼Œä»å¯ç”¨åˆ—è¡¨ä¸­é€‰æ‹©å®ƒã€‚

[![hb4](img/2c5e76bea46ddab5209ca82ccbdcdd89.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--9ds9-Rdd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AFUsemE_BjGBUN2T1gorSUg.png)

ç°åœ¨ä½ åœ¨æ§åˆ¶å°å†…åä¸º**ä»ªè¡¨æ¿**çš„å±å¹•ä¸Šã€‚ä»å·¦ä¸Šè§’ï¼Œç‚¹å‡»èœå•æŒ‰é’®ï¼Œä¼šå¼¹å‡ºä¸€ä¸ªä¾§è¾¹æ èœå•ã€‚é€‰æ‹©**API&æœåŠ¡>ä»ªè¡¨ç›˜**ã€‚

[![hb5](img/e6da7dffb13d62d43aa7080d43e56175.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--lOhaK8OQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AggHFyid_JjNABDZh6JfsMA.png)

åœ¨ä»ªè¡¨æ¿ä¸Šï¼Œé€‰æ‹©æŒ‰é’®**å¯ç”¨ API å’ŒæœåŠ¡**ã€‚

[![hb6](img/3e4a7e05336d5f92ae997072f645446d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--B0QOHIVV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2ArhVkQAIWdeqV9wSZsjacew.jpeg)

ç„¶åæœç´¢**è§†è§‰ API** å¹¶ç¡®ä¿ç‚¹å‡»æŒ‰é’®**å¯ç”¨**ã€‚

[![hb7](img/89ef69b5479e42d26bcc5c74f4a8d113.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--nf78gdRf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2ADzHGkXJQyTeYCHqETkhIPA.jpeg)

ç°åœ¨ï¼Œè¿”å›åˆ°**ä»ªè¡¨æ¿**å¹¶è½¬åˆ°**å‡­è¯**ä»¥ç”Ÿæˆ API å¯†é’¥ã€‚ç‚¹å‡»æŒ‰é’®**åˆ›å»ºå‡­è¯**ï¼Œæ‚¨å°†ç»å†ä¸€ä¸ªç”Ÿæˆ API å¯†é’¥çš„å°è¿‡ç¨‹ã€‚

[![hb8](img/9893b90154c890dc065acbac58556857.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--_UTiKpKu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2A8SdYi2l3aGS3VcvG7PU-Fg.jpeg)

å®Œæˆåï¼Œåœ¨æ‰€æœ‰å¯¼å…¥è¯­å¥ä¹‹åï¼Œå°† API é”®ä¿å­˜åœ¨`App.js`æ–‡ä»¶ä¸­ã€‚

```
const VISION_API_KEY = 'XXXX' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®¾ç½®å®Œæˆã€‚è®©æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€éƒ¨åˆ†ï¼Œå¼€å§‹æ„å»ºåº”ç”¨ç¨‹åºã€‚

## è®¾ç½®ç›¸æœºæƒé™&ç›¸æœºå·

è¦åœ¨ä»»ä½• Expo åº”ç”¨ç¨‹åºä¸­è®¾ç½®æƒé™ï¼Œæ‚¨æ‰€éœ€è¦çš„å°±æ˜¯åˆ©ç”¨æ¥è‡ªæ¨¡å—`expo-permissions`çš„å¼‚æ­¥æ–¹æ³•ã€‚å¯¹äºæ­¤å…‹éš†ï¼Œéœ€è¦è®¾ç½®ä¸¤ä¸ªæƒé™ã€‚æ‰€éœ€çš„æƒé™é€‚ç”¨äºç›¸æœºå’Œç›¸æœºèƒ¶å·(æˆ–è®¾å¤‡çš„ç…§ç‰‡)ã€‚

åœ¨ç”¨æˆ·æƒ³è¦ä¸Šä¼ å›¾åƒçš„æƒ…å†µä¸‹ä½¿ç”¨ç›¸æœºèƒ¶å·ã€‚å¯¹äº iOS æ¨¡æ‹Ÿå™¨å¼€å‘ï¼Œä½ ä¸èƒ½è®¿é—®ç›¸æœºï¼Œæ‰€ä»¥å¦‚æœä½ ä¸æ‰“ç®—ä½¿ç”¨ä¸€ä¸ªçœŸæ­£çš„è®¾å¤‡ï¼Œç›´åˆ°æœ¬æ•™ç¨‹ç»“æŸï¼Œä½†æƒ³è·Ÿéšã€‚å»ºè®®æ·»åŠ ç›¸æœºèƒ¶å·åŠŸèƒ½ã€‚

åœ¨`App.js`æ–‡ä»¶ä¸­å¯¼å…¥æƒé™æ¨¡å—ã€‚

```
import * as Permissions from 'expo-permissions' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸‹ä¸€æ­¥æ˜¯è®¾ç½®ä¸€ä¸ªåˆå§‹çŠ¶æ€ï¼Œå®ƒå°†é€šè¿‡ç¡®å®šç”¨æˆ·æ˜¯å¦å·²ç»æˆäºˆæ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨ç›¸æœºå’Œç›¸æœºèƒ¶å·çš„æƒé™æ¥æ§åˆ¶`render`æ–¹æ³•ä¸­çš„`View`ã€‚

```
class App extends Component {
  state = {
    hasGrantedCameraPermission: false,
    hasGrantedCameraRollPermission: false,
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•`componentDidMount()`ï¼Œä¸ºæ¯ä¸ªè®¸å¯å®šä¹‰ä¸€ä¸ªæ‰¿è¯ºã€‚åœ¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ‚¨ä¼šå‘ç°ä¸¤ä¸ªå‡½æ•°`cameraRollAccess()`å’Œ`cameraAccess()`æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚è¿™äº›æƒé™ç»„ä»¶ä¸­æ¯ä¸€ä¸ªéƒ½æœ‰ä¸€ä¸ª[æƒé™ç±»å‹](https://docs.expo.io/versions/v34.0.0/sdk/permissions/#permissions-types):

*   å¯¹äºç›¸æœºèƒ¶å·:`Permissions.CAMERA_ROLL`
*   å¯¹äºæ‘„åƒæœº:`Permissions.CAMERA`

```
async componentDidMount() {
    this.cameraRollAccess()
    this.cameraAccess()
  }

  cameraRollAccess = async () => {
    const { status } = await Permissions.askAsync(Permissions.CAMERA_ROLL)

    if (status === 'granted') {
      this.setState({ hasGrantedCameraRollPermission: true })
    }
  }

  cameraAccess = async () => {
    const { status } = await Permissions.askAsync(Permissions.CAMERA)

    if (status === 'granted') {
      this.setState({ hasGrantedCameraPermission: true })
    }
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¯ä¸ªæƒé™ç»„ä»¶è¿”å›ä¸€ä¸ª`granted`æˆ–`denied`çš„`status`å€¼ã€‚åœ¨è®¸å¯è¢«æˆäºˆçš„æƒ…å†µä¸‹ï¼ŒçŠ¶æ€å˜é‡`hasGrantedCameraRollPermission`å’Œ`hasGrantedCameraPermission`çš„å€¼éƒ½è¢«è®¾ç½®ä¸ºçœŸã€‚æ–¹æ³•`Permissions.askAsync()`æç¤ºç”¨æˆ·æƒé™ç±»å‹ã€‚

æ¥ä¸‹æ¥ï¼Œè½¬åˆ°`App`ç»„ä»¶çš„ render æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨åŒæ€å˜é‡æ·»åŠ æ¡ä»¶ã€‚å¦‚æœä¸¤è€…éƒ½è®¾ç½®ä¸ºçœŸï¼Œå®ƒå°†æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„ç¬¬ä¸€ä¸ªå±å¹•ã€‚

```
 render() {
    const {
      hasGrantedCameraPermission,
      hasGrantedCameraRollPermission,
    } = this.state

    if (
      hasGrantedCameraPermission === false &&
      hasGrantedCameraRollPermission === false
    ) {
      return (
        <View style={{ flex: 1, marginTop: 100 }}>
          <Text>No access to Camera or Gallery!</Text>
        </View>
      )
    } else {
      return (
        <View style={styles.container}>
          {*/ Rest of the content in the next section*/ }
        </View>
      )
    }
  }

// Corresponding StyleSheet Object

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#fff'
  }
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœå…¶ä¸­ä¸€ä¸ªæˆ–ä¸¤ä¸ªæœªè¢«æˆäºˆï¼Œåº”ç”¨ç¨‹åºå°†æ˜¾ç¤ºæ¶ˆæ¯`No access to Camera or Gallery!`ï¼Œä¹Ÿå¦‚ä¸‹æ‰€ç¤ºã€‚

[![hb9](img/988b63c2cfd10fbcabacf3bc76c6ecbf.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--05V3bXKb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2ARPW_mo8N7A303-1dKqHsRA.png)

å½“åœ¨çœŸå®çš„ android è®¾å¤‡ä¸Šæµ‹è¯•æ—¶ï¼Œå®ƒç¡®å®ä¼šè¦æ±‚æƒé™ã€‚

[![hb10](img/418da60bba2b3badfdf99a76469bb16c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--2ExRLwEI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AZ-YtLTjjd-jbDtNKA9gWNw.jpeg)

åŒæ ·ï¼Œè¦ä½¿ç”¨æ‘„åƒæœº:

[![hb11](img/e21d25429e12c7dd4350e46c0363cbfb.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--V7uPskyS--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2Ac0BRdUMxfP_WTYt0VoVTRA.jpeg)

## åˆ›å»ºè¡¨å¤´ç»„ä»¶

ä½¿ç”¨ React Native çš„ UI åº“ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæœ‰ç”¨çš„æ ‡é¢˜ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªæŒ‰é’®å’Œåº”ç”¨ç¨‹åºçš„æ ‡é¢˜æ–‡æœ¬ã€‚å·¦æŒ‰é’®å°†æ‰“å¼€æ‰‹æœºçš„å›¾åº“æˆ–åŒ…å«ç”¨æˆ·ç…§ç‰‡çš„ç›¸æœºèƒ¶å·ã€‚å³è¾¹çš„æŒ‰é’®æ˜¯åœ¨çœŸå®è®¾å¤‡ä¸Šæ‰“å¼€è®¿é—®æ‘„åƒå¤´ã€‚

ä»`react-native-elements`åº“ä¸­å¯¼å…¥`Header`ç»„ä»¶ã€‚

```
import { View, Text, StyleSheet, TouchableOpacity } from 'react-native'
import { Header, Icon } from 'react-native-elements' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

UI åº“æœ‰ä¸€ä¸ªåä¸º`Header`çš„é¢„å®šä¹‰ç»„ä»¶ï¼Œæ‚¨å¯ä»¥ç«‹å³ä½¿ç”¨ã€‚è¯¥ç»„ä»¶æ¥å—å·¦ä¾§å’Œå³ä¾§çš„å›¾æ ‡ã€‚å› ä¸ºåº”ç”¨ç¨‹åºéœ€è¦è¿™äº›å›¾æ ‡æ˜¯å¯ç‚¹å‡»çš„ï¼Œæ‰€ä»¥ä½¿ç”¨`TouchableOpacity`ï¼Œä»¥ä¾¿å®ƒçš„`prop`å¯ä»¥åœ¨ä»¥åç”¨äºæ‰“å¼€ç›¸æœºæˆ–ç›¸æœºèƒ¶å·ã€‚

```
<View style={styles.container}>
  <Header
    statusBarProps={{ barStyle: 'light-content' }}
    backgroundColor="black"
    leftComponent={
      <TouchableOpacity onPress={() => alert('soon')}>
        <Icon name="photo-album" color="#fff" />
      </TouchableOpacity>
    }
    centerComponent={{
      text: 'Not Hotdog?',
      style: { color: '#fff', fontSize: 20, fontWeight: 'bold' }
    }}
    rightComponent={
      <TouchableOpacity onPress={() => alert('soon')}>
        <Icon name="camera-alt" color="#fff" />
      </TouchableOpacity>
    }
  /> </View> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`Header`ç»„ä»¶è¿˜æœ‰ä¸€ä¸ª`statusBarProps`é“å…·ï¼Œå¯ä»¥æ”¹å˜çŠ¶æ€æ çš„é¢œè‰²ï¼Œè·¨å¹³å°å·¥ä½œã€‚å®ƒå°†ç»™å‡ºä»¥ä¸‹è¾“å‡ºã€‚

[![hb12](img/2bb746cd5fc26cdf5d0323847c0ddcd6.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--bKYjsoNv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AHUDX6p1wtfbrBGmNNanPVw.png)

è¿™ä¸¤ä¸ªå›¾æ ‡éƒ½æ˜¯å¯è§¦æ‘¸çš„ï¼Œä½†æ˜¯ç°åœ¨é™¤äº†ä¸€ä¸ªè™šæ‹Ÿçš„`alert`æ¶ˆæ¯ä¹‹å¤–ï¼Œå®ƒä»¬æ²¡æœ‰å…³è”çš„å¤„ç†ç¨‹åºæ–¹æ³•ã€‚

[![hb13](img/28fa06b8a3e98abfefee2a1facef7a4b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Vn4C6zfH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AuKMGmdh-AQESyamwCwZ3tA.png)

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`react-native-elements`åº“ä½¿ç”¨æè´¨å›¾æ ‡ï¼Œå¹¶æœ‰ä¸€ä¸ª [`react-native-vector-icons`](https://github.com/oblador/react-native-vector-icons) çš„å¯¹ç­‰ä¾èµ–ã€‚

## æ·»åŠ å åŠ å¾®è°ƒå™¨

è¦æ·»åŠ åˆ°åˆå§‹çŠ¶æ€å¯¹è±¡ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯å€¼ä¸º false çš„`uploading`ã€‚æ¯å½“ä»ç›¸æœºèƒ¶å·ä¸Šä¼ å›¾åƒæˆ–ç”± Vision API åˆ†æç»“æœæ—¶ï¼Œè¯¥å˜é‡å°†åœ¨åº”ç”¨ç¨‹åºä¸­ç”¨äºæ˜¾ç¤ºåŠ¨ç”»å¾®è°ƒå™¨ã€‚

```
state = {
  //... rest,
  uploading: false
}

// also make sure to include deconstruct the state inside render()
const {
  hasGrantedCameraPermission,
  hasGrantedCameraRollPermission,
  uploading
} = this.state 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`components/UploadingOverlay.js`ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å°†åŒ…å«ä¸€ä¸ªä¸æ–‡ä»¶ååŒåçš„è¡¨ç¤ºç»„ä»¶ã€‚ä½¿ç”¨æ¥è‡ª`react-native`çš„`ActivityIndicator`ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨å®ƒçš„é“å…·`animating`æ¥åˆ¶ä½œè¿™ä¸ªç»„ä»¶çš„åŠ¨ç”»ã€‚

```
import React from 'react'
import { ActivityIndicator, StyleSheet, View } from 'react-native'

const UploadingOverlay = () => (
  <View style={[StyleSheet.absoluteFill, styles.overlay]}>
    <ActivityIndicator color="#000" animating size="large" />
  </View> )

const styles = StyleSheet.create({
  overlay: {
    backgroundColor: 'rgba(255,255,255,0.9)',
    alignItems: 'center',
    justifyContent: 'center'
  }
})

export default UploadingOverlay 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°†`StyleSheet.absoluteFill`æ·»åŠ åˆ°æŒæœ‰æ—‹è½¬å™¨çš„`View`ç»„ä»¶çš„`style`æ”¯æŸ±ä¸­ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå åŠ å±å¹•ã€‚ä¸€ä¸ª*è¦†ç›–å›¾*ä»…ä»…æ˜¯ä¸€ä¸ªå±å¹•ï¼Œæˆ–è€…æ˜¯ React Native çš„ä¸€ä¸ª`View`ï¼Œå…è®¸å½“å‰å±å¹•å‡ºç°åœ¨å…¶ä»–å±å¹•ä¹‹ä¸Šã€‚ä½¿ç”¨`backgroundColor`å±æ€§ï¼Œæ‚¨å¯ä»¥åœ¨å®šä¹‰ RBG å€¼ååœ¨æœ€åæ·»åŠ `opacity`ã€‚

ä¾‹å¦‚ï¼Œå½“è¯·æ±‚è®¿é—®æ‘„åƒå¤´çš„æƒé™æ—¶ï¼Œåº”ç”¨ç¨‹åºå±å¹•ä¸Šå‡ºç°ä¸€ä¸ªå¯¹è¯æ¡†(*å¦‚ä¸Šä¸€èŠ‚*æ‰€ç¤º)ã€‚è¯·æ³¨æ„èƒŒæ™¯ä¸­çš„æ¡†æ˜¯å¦‚ä½•æ”¾ç½®åœ¨å±å¹•é¡¶éƒ¨çš„ã€‚

ç°åœ¨ï¼Œå›åˆ°`App.js`ï¼Œåœ¨`render()`éƒ¨åˆ†çš„åº•éƒ¨æ·»åŠ è¿™ä¸ªç»„ä»¶ï¼Œå°±åœ¨æ ¹`View`ç»„ä»¶ç»“æŸä¹‹å‰ã€‚ä¸è¦å¿˜è®°å¯¼å…¥ç»„ä»¶ã€‚

```
import UploadingOverlay from './components/UploadingOverlay'

// ... rest
{
  uploading ? <UploadingOverlay /> : null
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šè¿°æ¡ä»¶è¡¨æ˜ï¼Œå¦‚æœ`this.state.uploading`çš„å€¼ä¸ºçœŸï¼Œå°†æ˜¾ç¤ºè¦†ç›–å±å¹•ã€‚ä¸ºäº†è¿›è¡Œæµ‹è¯•ï¼Œæš‚æ—¶å°†çŠ¶æ€å¯¹è±¡ä¸­çš„å€¼`uploading`è®¾ç½®ä¸º`true`ã€‚

[![hb14](img/66913b88b488d0c87895beb0da34686a.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--rVIxf_0s--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AxcmtOrumJIUGwTIVaV8lSQ.png)

æ— ä¼‘æ­¢çš„æ—‹è½¬å°†ç»§ç»­å‡ºç°ã€‚ç»§ç»­ä¹‹å‰ï¼Œå°†`uploading`çš„å€¼è®¾ç½®å› falseã€‚

## è®¿é—®ç›¸æœºå’Œç›¸æœºèƒ¶å·

åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†é€šè¿‡åœ¨`App`ç»„ä»¶ä¸­å®šä¹‰ä¸‰ä¸ªä¸åŒçš„å¤„ç†å‡½æ•°æ¥æ·»åŠ è®¿é—®ç›¸æœºå’Œç›¸æœºèƒ¶å·çš„åŠŸèƒ½ã€‚ç¡®ä¿æ‚¨åœ¨æ–‡ä»¶`App.js`ä¸­ã€‚é¦–å…ˆï¼Œå¯¼å…¥ä¸‹é¢çš„è¯­å¥ï¼Œå› ä¸ºæœ¬èŠ‚å°†åˆ©ç”¨ Firebase çš„å­˜å‚¨å’Œ`uuid`æ¨¡å—æ¥åˆ›å»ºæ¯ä¸ªå›¾åƒçš„å”¯ä¸€å¼•ç”¨ã€‚

```
import firebase from './config/Firebase'
import uuid from 'uuid' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œä¿®æ”¹å¯¹è±¡çš„åˆå§‹çŠ¶æ€ï¼Œæœ€åæ·»åŠ ä»¥ä¸‹å†…å®¹ã€‚

```
state = {
  hasGrantedCameraPermission: false,
  hasGrantedCameraRollPermission: false,
  uploading: false,
  image: null,
  googleResponse: false
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†åœ¨å½“å‰åº”ç”¨ä¸­å¯ç”¨è¿™ä¸¤ç§åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬åˆ©ç”¨å¦ä¸€ä¸ªåä¸º`expo-image-picker`çš„ Expo æ¨¡å—ã€‚é¦–å…ˆï¼Œåœ¨å…¶ä½™çš„å¯¼å…¥è¯­å¥ä¹‹åå¯¼å…¥æ¨¡å—ã€‚

```
import * as ImagePicker from 'expo-image-picker' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Expo æ–‡æ¡£å¯¹è¿™ä¸ªæ¨¡å—çš„ç”¨é€”æœ‰æœ€å¥½çš„å®šä¹‰ã€‚çœ‹ä¸€çœ‹ã€‚

> [å›¾åƒæ‹¾å–å™¨]æä¾›å¯¹ç³»ç»Ÿç”¨æˆ·ç•Œé¢çš„è®¿é—®ï¼Œä»¥ä¾¿ä»æ‰‹æœºçš„å›¾åƒåº“ä¸­é€‰æ‹©å›¾åƒå’Œè§†é¢‘ï¼Œæˆ–ä½¿ç”¨ç›¸æœºæ‹ç…§ã€‚

è¿™å°±æ˜¯ä½ ç°åœ¨éœ€è¦çš„ã€‚å®šä¹‰ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œ`takePhoto`ï¼Œå®ƒå°†è®¿é—®æ‰‹æœºçš„æ‘„åƒå¤´æ¥ç‚¹å‡»ä¸€å¼ ç…§ç‰‡ã€‚

```
takePhoto = async () => {
  let pickerResult = await ImagePicker.launchCameraAsync({
    allowsEditing: true,
    aspect: [4, 3]
  })

  this.handleImagePicked(pickerResult)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¼‚æ­¥æ–¹æ³•`ImagePicker.launchCameraAsync()`æ¥å—ä¸¤ä¸ªå‚æ•°:

*   `allowsEditing`æ˜¾ç¤ºç‚¹å‡»åç¼–è¾‘å›¾åƒçš„ç•Œé¢ã€‚ä¸»è¦ç”¨äºè£å‰ªå›¾åƒã€‚
*   `aspect`æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœ`allowsEditing`è®¾ç½®ä¸º trueï¼Œåˆ™ä¿æŒä¸€è‡´çš„çºµæ¨ªæ¯”ã€‚

ç±»ä¼¼åœ°ï¼Œ`ImagePicker.launchImageLibraryAsync()`ä¸ç›¸åŒçš„ä¸€ç»„å‚æ•°ä¸€èµ·ç”¨äºè®¿é—®ç›¸æœºèƒ¶å·ã€‚

```
pickImage = async () => {
  let pickerResult = await ImagePicker.launchImageLibraryAsync({
    allowsEditing: true,
    aspect: [16, 9]
  })

  this.handleImagePicked(pickerResult)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸¤ä¸ªå¼‚æ­¥å‡½æ•°éƒ½è¿”å›æ‰€é€‰å›¾åƒçš„`uri`(å…¶ä»–å‚æ•°ä¸­çš„*å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æŸ¥çœ‹[è¿™é‡Œçš„](https://docs.expo.io/versions/v34.0.0/sdk/imagepicker/#returns)* )ã€‚æœ€åï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½åœ¨å®ƒä»¬çš„å·¥ä½œå®Œæˆåè°ƒç”¨å¦ä¸€ä¸ªå›è°ƒ`handleImagePicked`ã€‚è¿™ä¸ªæ–¹æ³•åŒ…å«äº†åœ¨ä»ç›¸æœºèƒ¶å·ä¸­é€‰å–æˆ–ç‚¹å‡»å›¾åƒåå¦‚ä½•å¤„ç†å›¾åƒçš„é€»è¾‘ä¸šåŠ¡ã€‚

```
handleImagePicked = async pickerResult => {
  try {
    this.setState({ uploading: true })

    if (!pickerResult.cancelled) {
      uploadUrl = await uploadImageAsync(pickerResult.uri)
      this.setState({ image: uploadUrl })
    }
  } catch (e) {
    console.log(e)
    alert('Image Upload failed')
  } finally {
    this.setState({ uploading: false })
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åˆï¼Œå°†`uploading`çš„çŠ¶æ€è®¾ç½®ä¸ºçœŸã€‚ç„¶åï¼Œå¦‚æœé€‰æ‹©äº†ä¸€ä¸ªå›¾åƒï¼Œè°ƒç”¨è‡ªå®šä¹‰æ–¹æ³•`uploadImageAsync` ( *ï¼Œå®ƒå°†åœ¨æœ¬èŠ‚*çš„æœ€åå®šä¹‰)å¹¶ä¼ é€’æ‰€é€‰å›¾åƒçš„ URIã€‚è¿™ä¹Ÿå°†æŠŠçŠ¶æ€å¯¹è±¡çš„`image`çš„å€¼è®¾ç½®ä¸ºä¸Šä¼ å›¾åƒçš„ URLã€‚æœ€åï¼Œå¦‚æœç»“æœæ˜¯è‚¯å®šçš„ï¼Œå¹¶ä¸”å›¾åƒä¸Šä¼ æ²¡æœ‰ä»»ä½•é”™è¯¯ï¼Œåˆ™å°†`finally`æ¨¡å—ä¸­çš„`uploading`çš„çŠ¶æ€è®¾ç½®å› falseã€‚

è‡ªå®šä¹‰æ–¹æ³•`uploadImageAsync`å¿…é¡»åœ¨`App`ç»„ä»¶ä¹‹å¤–å®šä¹‰ã€‚å®ƒå°†é€šè¿‡åœ¨`uuid`çš„å¸®åŠ©ä¸‹åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å›¾åƒ ID æˆ–æ–‘ç‚¹æ¥ä¸Šä¼ å›¾åƒã€‚å®ƒä½¿ç”¨`xhr`è¿›è¡Œ Ajax è°ƒç”¨ï¼Œå‘ Firebase å­˜å‚¨å™¨å‘é€ä¸Šä¼ å›¾åƒçš„è¯·æ±‚ã€‚

```
async function uploadImageAsync(uri) {
  const blob = await new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest()
    xhr.onload = function() {
      resolve(xhr.response)
    }
    xhr.onerror = function(e) {
      console.log(e)
      reject(new TypeError('Network request failed'))
    }
    xhr.responseType = 'blob'
    xhr.open('GET', uri, true)
    xhr.send(null)
  })

  const ref = firebase
    .storage()
    .ref()
    .child(uuid.v4())
  const snapshot = await ref.put(blob)

  blob.close()

  return await snapshot.ref.getDownloadURL()
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> è¯·æ³¨æ„ï¼Œç”¨äºè®¿é—®å’Œä¸Šä¼ å›¾åƒåˆ° Firebase çš„æºä»£ç æ‘˜è‡ªæœ¬ä¾‹ä¸­çš„[ä½¿ç”¨ Expo å’Œ Firebaseã€‚](https://github.com/expo/firebase-storage-upload-example)

ç°åœ¨ä½ å¯ä»¥æ·»åŠ ä¸¤ä¸ªå‡½æ•°ï¼Œ`pickImage`å’Œ`takePhoto`ä½œä¸ºç›¸åº”å›¾æ ‡çš„`onPress`é“å…·çš„å€¼ã€‚

```
<Header
  statusBarProps={{ barStyle: 'light-content' }}
  backgroundColor="#000"
  leftComponent={
    <TouchableOpacity onPress={this.pickImage}>
      <Icon name="photo-album" color="#fff" />
    </TouchableOpacity>
  }
  centerComponent={{
    text: 'Not Hotdog?',
    style: styles.headerCenter
  }}
  rightComponent={
    <TouchableOpacity onPress={this.takePhoto}>
      <Icon name="camera-alt" color="#fff" />
    </TouchableOpacity>
  }
/> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯ä¸€ä¸ªè®¿é—®ç›¸æœºèƒ¶å·çš„ä¾‹å­ã€‚

[![hb15](img/bc00d4e2ef15a62383b12a4c0c442ae8.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--yj2qIr_Y--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AdEcP_2OfNpFepEiWpwg3lA.gif)

## æ·»åŠ ç¡®å®šçƒ­ç‹—çš„åŠŸèƒ½

ç”±äºå¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºç°åœ¨å·²ç»è®¾ç½®å¥½äº†ï¼Œè¿™ä¸€éƒ¨åˆ†å°†ä¼šéå¸¸æœ‰è¶£ã€‚æ‚¨å°†åˆ©ç”¨ Google çš„ Vision API æ¥åˆ†æç”¨æˆ·æä¾›çš„å›¾ç‰‡æ˜¯å¦æ˜¯çƒ­ç‹—ã€‚

åœ¨`App`ç»„ä»¶å†…éƒ¨ï¼Œæ·»åŠ ä¸€ä¸ªåä¸º`submitToGoogle`çš„æ–°æ–¹æ³•ã€‚å®ƒå°†å‘é€è¯·æ±‚å¹¶ä¸ API é€šä¿¡ï¼Œä»¥ä¾¿åœ¨å›¾åƒä¸Šä¼ åç”¨æˆ·æŒ‰ä¸‹æŒ‰é’®æ—¶è·å–ç»“æœã€‚åŒæ ·ï¼Œåœ¨åˆ†æå’Œè·å–ç»“æœæ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå°†çŠ¶æ€å˜é‡`uploading`è®¾ç½®ä¸º trueã€‚ç„¶åï¼Œå®ƒå°†ä»çŠ¶æ€å¯¹è±¡çš„`image`å‘é€å›¾åƒçš„ URI ä½œä¸ºè¯·æ±‚çš„ä¸»ä½“ã€‚

é™¤äº† URIï¼Œè¿˜å®šä¹‰äº†æ‚¨æƒ³è¦ä½¿ç”¨çš„ç±»åˆ«ç±»å‹ä»¥åŠå®ƒå¯ä»¥ä½œä¸ºå“åº”è·å–çš„å¤§é‡ç»“æœã€‚æ‚¨å¯ä»¥æ›´æ”¹`LABEL`ç±»åˆ«çš„`maxResults`å€¼ã€‚ç›®å‰ï¼Œçš„å€¼è¢«è®¾ç½®ä¸º`7`ã€‚é™¤äº†ä¸‹é¢ä½¿ç”¨çš„`LABEL_DETECTION`ä¹‹å¤–ï¼Œè§†è§‰ API è¿˜æä¾›äº†å…¶ä»–æ£€æµ‹ç±»åˆ«ï¼Œå¦‚äººè„¸ã€å¾½æ ‡ã€åœ°æ ‡ã€æ–‡æœ¬ç­‰ã€‚

```
submitToGoogle = async () => {
  try {
    this.setState({ uploading: true })
    let { image } = this.state
    let body = JSON.stringify({
      requests: [
        {
          features: [{ type: 'LABEL_DETECTION', maxResults: 7 }],
          image: {
            source: {
              imageUri: image
            }
          }
        }
      ]
    })
    let response = await fetch(
      `https://vision.googleapis.com/v1/images:annotate?key=${VISION_API_KEY}`,
      {
        headers: {
          Accept: 'application/json',
          'Content-Type': 'application/json'
        },
        method: 'POST',
        body: body
      }
    )
    let responseJson = await response.json()
    const getLabel = responseJson.responses[0].labelAnnotations.map(
      obj => obj.description
    )

    let result =
      getLabel.includes('Hot dog') ||
      getLabel.includes('hot dog') ||
      getLabel.includes('Hot dog bun')

    this.setState({
      googleResponse: result,
      uploading: false
    })
  } catch (error) {
    console.log(error)
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œç»“æœè¢«æå–åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚åœ¨å½“å‰åœºæ™¯ä¸­ï¼Œæ¯ä¸ªæ•°ç»„éƒ½æœ‰ä¸ƒä¸ªä¸åŒçš„å¯¹è±¡ã€‚ä½¿ç”¨ JavaScript çš„`map`è®©æˆ‘ä»¬ä»æ¯ä¸ªå¯¹è±¡ä¸­æå–`description`çš„å€¼ã€‚ä½ éœ€è¦åšçš„å°±æ˜¯æ£€æµ‹æè¿°ä¸­æ˜¯å¦åŒ…å«`hotdog`è¿™ä¸ªè¯ã€‚è¿™æ˜¯åœ¨å˜é‡`result`ä¸­å®Œæˆçš„ã€‚æœ€åï¼Œ`uploading`è¦†ç›–å›¾çš„çŠ¶æ€è¢«è®¾ç½®å› falseï¼Œä¸Šä¼ å›¾åƒæ˜¯å¦åŒ…å«çƒ­ç‹—çš„ç»“æœå°†æ›´æ–°`googleResponse`ä¸º booleanã€‚

å¦å¤–ï¼ŒVision API ä½¿ç”¨ HTTP Post è¯·æ±‚ä½œä¸º REST API ç«¯ç‚¹ï¼Œå¯¹è¯·æ±‚ä¸­å‘é€çš„å›¾åƒæ‰§è¡Œæ•°æ®åˆ†æã€‚è¿™æ˜¯é€šè¿‡ URL `https://vision.googleapis.com/v1/images:annotate`å®Œæˆçš„ã€‚è¦éªŒè¯æ¯ä¸ªè¯·æ±‚ï¼Œæ‚¨éœ€è¦ API å¯†é’¥ã€‚è¿™ä¸ª POST è¯·æ±‚çš„ä¸»ä½“æ˜¯ JSON æ ¼å¼çš„ã€‚æ¯”å¦‚:

```
{  "requests":  [  {  "image":  {  "content":  "/9j/7QBEUGhvdG9...image contents...eYxxxzj/Coa6Bax//Z"  },  "features":  [  {  "type":  "LABEL_DETECTION",  "maxResults":  1  }  ]  }  ]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## æ˜¾ç¤ºæœ€ç»ˆç»“æœ

ä½¿ç”¨æ¥è‡ª`googleResponse`çš„å¸ƒå°”å€¼ï¼Œæœ€ç»ˆç»“æœå°†è¢«è¾“å‡ºã€‚å°†ä½¿ç”¨`renderImage`æ˜¾ç¤ºè¾“å‡ºã€‚

```
renderImage = () => {
  let { image, googleResponse } = this.state
  if (!image) {
    return (
      <View style={styles.renderImageContainer}>
        <Button
          buttonStyle={styles.button}
          onPress={() => this.submitToGoogle()}
          title="Check"
          titleStyle={styles.buttonTitle}
          disabled
        />
        <View style={styles.imageContainer}>
          <Text style={styles.title}>Upload an image to verify a hotdog!</Text>
          <Text style={styles.hotdogEmoji}>ğŸŒ­</Text>
        </View>
      </View>
    )
  }
  return (
    <View style={styles.renderImageContainer}>
      <Button
        buttonStyle={styles.button}
        onPress={() => this.submitToGoogle()}
        title="Check"
        titleStyle={styles.buttonTitle}
      /> 
      <View style={styles.imageContainer}>
        <Image source={{ uri: image }} style={styles.imageDisplay} />
      </View> 
      {googleResponse ? (
        <Text style={styles.hotdogEmoji}>ğŸŒ­</Text>
      ) : (
        <Text style={styles.hotdogEmoji}>âŒ</Text>
      )}
    </View>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢ä½¿ç”¨çš„`Button`ç»„ä»¶æ¥è‡ª`react-native-elements`åº“ã€‚å®ƒå°†è¢«ç¦ç”¨ï¼Œç›´åˆ°æ²¡æœ‰å›¾åƒè¢«é€‰ä¸­ã€‚åœ¨å®ƒçš„æ”¯æŸ±`onPress`ä¸Šè°ƒç”¨äº†å¥æŸ„å‡½æ•°`submitToGoogle`ã€‚ç¬¬äºŒä¸ªè§†å›¾æ˜¾ç¤ºå›¾åƒï¼Œåœ¨å®ƒä¸‹é¢ï¼Œä¸€ä¸ªè¡¨æƒ…ç¬¦å·å±•ç¤ºäº†å›¾åƒæ˜¯å¦æœ‰æƒ³è¦çš„ç»“æœã€‚è¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæ˜¾ç¤ºåå­—è¡¨æƒ…ç¬¦å·ï¼Œå› ä¸ºåœ¨å®šä¹‰åˆå§‹çŠ¶æ€æ—¶,`googleResponse`çš„é»˜è®¤å€¼è¢«è®¾ç½®ä¸º falseã€‚åªæœ‰ç‚¹å‡»æŒ‰é’®åï¼Œæ˜¾ç¤ºçš„è¡¨æƒ…ç¬¦å·æ‰æ˜¯æœ€ç»ˆç»“æœã€‚

æœ€åï¼Œä¸è¦å¿˜è®°åœ¨`App`ç»„ä»¶çš„`render`æ–¹æ³•ä¸­æ·»åŠ `renderImage`ï¼Œå°±åœ¨`UploadingOverlay`ç»„ä»¶ä¹‹å‰ã€‚

```
// inside the render method
{
  this.renderImage()
}
{
  uploading ? <UploadingOverlay /> : null
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œæœ‰ä¸€ä¸ªç®€çŸ­çš„æ¼”ç¤ºï¼Œå±•ç¤ºäº†è¯¥åº”ç”¨ç¨‹åºåœ¨ä½¿ç”¨ Expo å®¢æˆ·ç«¯è¿è¡Œè¯¥åº”ç”¨ç¨‹åºçš„çœŸå® android è®¾å¤‡ä¸Šçš„å¤–è§‚å’Œå·¥ä½œæ–¹å¼ã€‚

[![hb17](img/5085d9e7086cee07c9c1baf5de91da7e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--jVPSFycL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AHg6nlnaROCavW5_YLygtEA.gif)

è¿™é‡Œæ˜¯`StyleSheet`å¯¹è±¡çš„å®Œæ•´æºä»£ç ã€‚

```
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#cafafe'
  },
  headerCenter: {
    color: '#fff',
    fontSize: 20,
    fontWeight: 'bold'
  },
  renderImageContainer: {
    marginTop: 20,
    alignItems: 'center'
  },
  button: {
    backgroundColor: '#97caef',
    borderRadius: 10,
    width: 150,
    height: 50
  },
  buttonTitle: {
    fontWeight: '600'
  },
  imageContainer: {
    margin: 25,
    alignItems: 'center'
  },
  imageDisplay: {
    width: 300,
    height: 300
  },
  title: {
    fontSize: 36
  },
  hotdogEmoji: {
    marginTop: 20,
    fontSize: 90
  }
})

export default App 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨è®¿é—® Firebase ä¸­çš„å­˜å‚¨éƒ¨åˆ†ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æ¯ä¸ªå›¾åƒéƒ½ä»¥ base64 äºŒè¿›åˆ¶å­—ç¬¦ä¸²çš„åç§°å­˜å‚¨ã€‚

[![hb16](img/83bd4a8cafe819ecb7b638f6c3fafd8a.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--6b14_VDc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2ACIWmTd4__kyKZRBBqQG0iw.png)

## ç»“è®º

é€šè¿‡é›†æˆ Firebase å­˜å‚¨å¹¶ä½¿ç”¨ Google çš„ Vision API å’Œ React Nativeï¼Œæ‚¨å·²ç»å®Œæˆäº†æœ¬æ•™ç¨‹ã€‚API æ˜¯æƒŠäººçš„ï¼Œæœ‰æ— ç©·æ— å°½çš„ç”¨ä¾‹ã€‚æˆ‘å¸Œæœ›ä½ é€šè¿‡é˜…è¯»è¿™ç¯‡æ–‡ç« å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ã€‚è¯¥åº”ç”¨ç¨‹åºçš„å®Œæ•´æºä»£ç å¯åœ¨ Github repo è·å¾—ã€‚æœ¬å¸–ä¸­ä½¿ç”¨çš„ä¸€äº›èµ„æº:

*   [react-native-elements](https://react-native-training.github.io/) UI ç»„ä»¶åº“
*   [ä¸–åšæ‘„åƒå¸ˆ](https://docs.expo.io/versions/v34.0.0/sdk/imagepicker/#returns)
*   [firebase-storage-upload-Expo ç¤ºä¾‹](https://github.com/expo/firebase-storage-upload-example)
*   [è§†è§‰äººå·¥æ™ºèƒ½](https://cloud.google.com/vision/?utm_source=google&utm_medium=cpc&utm_campaign=japac-IN-all-en-dr-bkws-all-super-trial-e-dr-1003987&utm_content=text-ad-none-none-DEV_c-CRE_256563224787-ADGP_Hybrid+%7C+AW+SEM+%7C+BKWS+~+T1+%7C+EXA+%7C+ML+%7C+1:1+%7C+IN+%7C+en+%7C+Vision+%7C+google+vision+api-KWID_43700023274811671-kwd-312947612586&userloc_9061696&utm_term=KW_google%20vision%20api&ds_rl=1264446&gclid=CjwKCAjwqNnqBRATEiwAkHm2BCkLuArU9ZtlYQ4p3bCJoHF0CDQ0Gm2o0rjZVWHWJ63kdpz7AbwtPxoCoWgQAvD_BwE)

* * *

> [æœ€åˆå‘å¸ƒäºå¿ƒè·³](https://heartbeat.fritz.ai/build-a-not-hotdog-clone-with-react-native-8f9b9eb75bd2)

æˆ‘ç»å¸¸åœ¨ Nodejsã€Reactjs å’Œ React Native ä¸Šå†™ã€‚ä½ å¯ä»¥é€šè¿‡[aman his . dev](https://amanhimself.dev)æ¥è®¿é—®æˆ‘ï¼Œæˆ–è€…ä½ å¯ä»¥è®¢é˜…[æˆ‘çš„æ¯å‘¨ç®€è®¯](https://tinyletter.com/amanhimself)ï¼Œç›´æ¥åœ¨ä½ çš„æ”¶ä»¶ç®±ä¸­æ¥æ”¶æ‰€æœ‰å…³äºæ–°å¸–å­å’Œå†…å®¹çš„æ›´æ–°ğŸ’Œã€‚