# ä½¿ç”¨æœ‰æ•ˆçš„ HTML å…ƒç´ ç®€åŒ–åº”ç”¨ç¨‹åºä¸­çš„è¡¨å•å¤„ç†

> åŸæ–‡:[https://dev . to/David wells/simplify-form-handling-in-your-app-using-valid-html-elements-1jh 3](https://dev.to/davidwells/simplify-form-handling-in-your-app-using-valid-html-elements-1jh3)

> æœ€åˆå‘å¸ƒäº [davidwells.io](https://davidwells.io/blog/simple-forms)

å¦‚æœä½ çš„ç½‘ç«™æˆ–åº”ç”¨åšäº†ä¸€äº›äº‹æƒ…(ä»»ä½•äº‹æƒ…)ï¼Œä½ å¾ˆå¯èƒ½åœ¨æŸä¸ªåœ°æ–¹æœ‰è¿™æ ·çš„æµç¨‹:

1.  ç”¨æˆ·åœ¨è¡¨å•ä¸­è¾“å…¥ä¿¡æ¯
2.  è¿è¡Œè¾“å…¥éªŒè¯(å¯é€‰)
3.  ç”¨æˆ·æäº¤è¡¨å•
4.  æ•°æ®å‘é€åˆ°åç«¯è¿›è¡Œå¤„ç†ğŸš€

ä¸ºäº†å¤„ç†è¿™ä¸ªæµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä»£ç ä¸­å¤„ç†è¡¨å•è¾“å…¥ã€‚

å¾ˆå¤šæ—¶å€™ï¼Œåœ¨ JS ç–²åŠ³çš„åœŸåœ°ä¸Šï¼Œæˆ‘çœ‹åˆ°å¼€å‘äººå‘˜è·³åˆ°æ¡†æ¶ç‰¹å®šçš„åº“æˆ–æ›´å¤§çš„â€œè¡¨å•çŠ¶æ€â€è§£å†³æ–¹æ¡ˆæ¥è§£å†³è¡¨å•å¤„ç†ã€‚

æœ‰å¾ˆå¤šå¾ˆå¤šçš„åº“å¯ä»¥è§£å†³è¡¨å•é—®é¢˜ [formsy React](https://github.com/christianalfoni/formsy-react) ï¼Œ [redux-forms](https://redux-form.com/8.2.2/) ï¼Œ [final-form](https://github.com/final-form/final-form) ï¼Œ [formik](https://jaredpalmer.com/formik/) ï¼Œä¸èƒœæšä¸¾...

> æ—ç™½:è¿™äº›åº“æä¾›äº†è®¸å¤šç‰¹æ€§&æ”¯æŒå„ç§è¾¹ç¼˜æƒ…å†µç­‰ã€‚éœ€è¦å°±ç”¨å§ï¼æ„Ÿè°¢å„è‡ªå¼€æºä½œè€…ä»˜å‡ºçš„æ—¶é—´å’Œç²¾åŠ›ğŸ‰

ä½†æ˜¯...æˆ‘æ€»æ˜¯æƒ³çŸ¥é“ä¸ºä»€ä¹ˆäººä»¬ä¸ä½¿ç”¨ç®€å•çš„ HTML è¡¨å•&ä» DOM ä¸­è·å–å€¼ã€‚

æ ¹æ®æˆ‘æ„å»ºå¤§å‹ web åº”ç”¨ç¨‹åºçš„ç»éªŒï¼Œè¿™äº›æ›´å¤§çš„**â€œè¡¨å•çŠ¶æ€â€**è§£å†³æ–¹æ¡ˆå·²ç»è¶…å‡ºäº†æˆ‘çš„éœ€è¦ã€‚

è¿™ç¯‡æ–‡ç« æ˜¯å…³äºä½¿ç”¨ç®€å•æœ‰æ•ˆçš„ HTML è¡¨å•è¾“å…¥è¿›è¡Œè¡¨å•å¤„ç†çš„ã€‚

è¿™ç§æ–¹æ³•é€‚ç”¨äºä»»ä½•æ¡†æ¶æˆ–æ™®é€šçš„ HTMLã€‚

## [](#why-you-no-html)ä¸ºä»€ä¹ˆä½ æ²¡æœ‰ HTMLï¼Ÿ

HTML è¡¨å•åœ¨ç½‘ç»œå‡ºç°çš„æ—¶å€™å°±å·²ç»å­˜åœ¨äº†ã€‚è¿™äº›è¾“å…¥èŠ‚ç‚¹ç»è¿‡äº†å®æˆ˜æµ‹è¯•ï¼Œè¿è¡Œè‰¯å¥½ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒä»¬æ¥è·å–è¡¨å•å€¼ï¼Œå¹¶åšä¸€äº›æœ‰è¶£çš„åº”ç”¨ç¨‹åºå·¥ä½œã€‚

ä½¿ç”¨åŸç”Ÿçš„[è¡¨å•äº‹ä»¶ç›‘å¬å™¨](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/submit_event)å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¼€å‘äººå‘˜å›´ç»• DOM APIs çš„äººæœºå·¥ç¨‹å­¦ä»¥åŠä»ä¸åŒç±»å‹çš„è¾“å…¥ä¸­è·å–å€¼æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ã€‚

```
<html>
  <body>
    <!-- The awesome app form -->
    <form id="baz" action="/" method="POST">
      <label>
        <span>Email address</span>
        <input name="email"type="email" required />
      </label>

      <button type="submit" name="submit" class="button">
        Submit Form
      </button>
    </form>

    <!-- The codez -->
    <script>
    /* Get form selector */
    const form = document.querySelector('form[id=baz]')

    /* Make awesome app logic function */
    function doStuff(event) {
      // 1\. Get event.target
      // 2\. Loop over DOM nodes
      // 3\. Get current node values
      // 4\. Do app logic
    }

    // Attach the listener
    form.addEventListener('submit', doStuff, false)

    // Lastly Remember to remove listener if in SPA
    form.removeEventListener('submit', doStuff, false)
    </script>
  </body>
</html> 
```

ä¸Šé¢çš„ä»£ç è¿˜ä¸é”™ï¼Œä½†æ˜¯éå†è¡¨å•è¾“å…¥å¹¶ä»ä¸åŒç±»å‹çš„è¡¨å•å…ƒç´ ä¸­è·å–å€¼å¯èƒ½ä¼šå¾ˆéº»çƒ¦ã€‚

å¦‚æœæˆ‘ä»¬éœ€è¦é™„åŠ åˆ°å¤šä¸ªè¡¨å•ä¸Šå‘¢ï¼Ÿé€»è¾‘å¼€å§‹å˜å¾—åˆç†ã€‚

## [](#how-can-we-simplify)æ€æ ·æ‰èƒ½ç®€åŒ–ï¼Ÿ

æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### [](#1-using-getformdata)1ã€‚ä½¿ç”¨è·å–è¡¨å•æ•°æ®

ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ [get-form-data](https://github.com/insin/get-form-data) ï¼Œå®ƒéå¸¸å°ï¼Œå¯ä»¥è®©ä½ ä»ä¸€ä¸ªæœ‰æ•ˆçš„è¡¨å•å…ƒç´ ä¸­è·å–æ‰€æœ‰çš„å€¼ã€‚

```
const form = document.querySelector('form[id=baz]')

/* Make awesome app logic function */
function doStuff(event) {
  const data = getFormData(form)
  console.log(JSON.stringify(data))
  // Do stuff with the form data
}

// Attach the listener
form.addEventListener('submit', doStuff, false) 
```

å®ƒè¶…çº§ç®€å•ï¼Œåœ¨[ååº”](https://github.com/insin/react-auto-form)ä¸­è¿è¡Œè‰¯å¥½ã€‚

### [](#2-using-analyticsutilforms)2ã€‚ä½¿ç”¨åˆ†æå·¥å…·è¡¨å•

ç¬¬äºŒä¸ªï¼Œæ˜¯[è¡¨å•å®ç”¨ç¨‹åºåº“](https://github.com/DavidWells/analytics/tree/master/packages/analytics-util-forms)ã€‚è¿™è¿›ä¸€æ­¥å°†äº‹ä»¶ç›‘å¬å™¨é™„åŠ åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨å•ä¸Šã€‚

Form utilities æ˜¯ä¸€ä¸ªå¾ˆå°çš„åº“(2.6kB)ï¼Œç”¨äºä»æœ‰æ•ˆçš„ HTML è¡¨å•ä¸­è¯»å–å€¼ã€‚æˆ‘åˆ›å»ºäº†è¿™ä¸ªè¡¨å•â€”â€”utils åº“æ˜¯ä¸ºäº†åœ¨ä¸€äº›å³å°†åˆ°æ¥çš„ [**åˆ†ææ’ä»¶**](https://getanalytics.io/plugins) ä¸­ä½¿ç”¨ã€‚

[è¡¨å•å®ç”¨ç¨‹åºåº“](https://www.npmjs.com/package/analytics-util-forms)å…¬å¼€äº†è¿™äº›æ–¹æ³•`onSubmit`ã€`onChange`ã€&ã€`listen`ã€‚

æ‚¨å¯ä»¥ç›‘å¬å•ä¸ªçš„è¾“å…¥æ›´æ”¹ï¼Œæˆ–è€…å®Œæ•´çš„â€œç”¨æˆ·ç‚¹å‡»äº†æäº¤æŒ‰é’®â€äº‹ä»¶ã€‚

æŸ¥çœ‹ç¤ºä¾‹ HTMLï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨:

*   [ç¤ºä¾‹ HTML ä¸€](https://github.com/DavidWells/analytics/blob/master/packages/analytics-util-forms/examples/all-forms.html)
*   [ç¤ºä¾‹ HTML äºŒ](https://github.com/DavidWells/analytics/blob/master/packages/analytics-util-forms/examples/single.html)

å¹¶ç»§ç»­é˜…è¯»ä»¥äº†è§£ APIã€‚

### [](#listening-to-form-submissions-with-formutils)ç”¨ form-utils ç›‘å¬è¡¨å•æäº¤

å¬å–æäº¤çš„è¡¨æ ¼ï¼Œåšä¸€äº›æœ‰è¾“å…¥çš„äº‹æƒ…ã€‚

è¿™å°†æ¥æ”¶è¡¨å•æäº¤ï¼Œå¹¶åœ¨æ­£å¸¸æäº¤è¡¨å•ä¹‹å‰è§¦å‘ä¸€ä¸ªè‡ªå®šä¹‰å›è°ƒã€‚

```
import { onSubmit } from 'analytic-util-forms'

// Add to single form
const formOne = document.querySelector("form[id=one]")
onSubmit(formOne, (event, data) => {
  console.log('form', event.target)
  console.log('form data', JSON.stringify(data, null, 2))
})

// Add to single form with options
onSubmit('form[id=two]', {
  /* Turn on debug to disable submissions and see values */
  debug: true,
  /* Turn off sensitive values filter */
  disableFilter: false,
  //* // Exclude field by name or regex pattern of name attribute
  excludeFields: [
    /private/,
    'shhhh'
  ],
  /* Custom filter function. Return false to exclude data */
  filter: (fieldName, value) => {
    if (fieldName === 'hello') {
      return false
    }
    // credit card number
    if (value.match(/^\d{4}[- ]?\d{4}[- ]?\d{4}[- ]?\d{4}$/)) {
      return false
    }
    return true
  }
}, (event, data) => {
  console.log('form', event.target)
  console.log('form data', JSON.stringify(data, null, 2))
})

// Remove onSubmit listener
const cleanUpFuntion = onSubmit('form[id=three]', (event, data) => {
  console.log('form', event.target)
  console.log('form data', JSON.stringify(data, null, 2))
})
cleanUpFuntion() // <-- call function to clean up listener

// Listen to all forms on page
onSubmit('all', (event, data) => {
  console.log('form', event.target)
  console.log('form data', JSON.stringify(data, null, 2))
}) 
```

### [](#listening-to-form-field-changes-with-formutils)ç”¨ form-utils ç›‘å¬è¡¨å•åŸŸçš„å˜åŒ–

å€¾å¬å½¢å¼çš„å˜åŒ–ï¼Œç”¨è¾“å…¥åšä¸€äº›äº‹æƒ…ã€‚

```
import { onChange } from 'analytic-util-forms'

// Add to single form with no options
const formOne = document.querySelector("form[id=one]")
onChange(formOne, (event, data) => {
  console.log('form', event.target)
  console.log('form data', JSON.stringify(data, null, 2))
})

// Add to single form with options
onChange('form[id=two]', {
  /* Turn on debug to disable submissions and see values */
  debug: true,
  /* Turn off sensitive values filter */
  disableFilter: false,
  //* // Exclude field by name or regex pattern of name attribute
  excludeFields: [
    /private/,
    'shhhh'
  ],
  /* Custom filter function. Return false to exclude data */
  filter: (fieldName, value) => {
    if (fieldName === 'hello') {
      return false
    }
    // credit card number
    if (value.match(/^\d{4}[- ]?\d{4}[- ]?\d{4}[- ]?\d{4}$/)) {
      return false
    }
    return true
  }
}, (event, data) => {
  console.log('form', event.target)
  console.log('change data', JSON.stringify(data, null, 2))
})

// Remove onChange listener
const cleanUpFuntion = onChange('form[id=three]', (event, data) => {
  console.log('form', event.target)
  console.log('change data', JSON.stringify(data, null, 2))
})
cleanUpFuntion() // <-- call function to clean up listener

// Listen to all forms on page
onChange('all', (event, data) => {
  console.log('form', event.target)
  console.log('form data', JSON.stringify(data, null, 2))
}) 
```

### [](#listening-to-submission-amp-change-events-with-formutils)å¬æäº¤&ç”¨è¡¨æ ¼æ”¹å˜äº‹ä»¶

Listen ä¼šå°†`onChange` & `onSubmit`ç›‘å¬å™¨é™„åŠ åˆ°è¡¨å•

```
import { listen } from 'analytic-util-forms'

// Add to single form with no options
const formOne = document.querySelector("form[id=one]")
listen(formOne, (event, data, type) => {
  console.log('listen type', type)
  console.log('listen form', event.target)
  console.log('listen form data', JSON.stringify(data, null, 2))
})

// Listen to all forms with options
listen({
  /* Turn on debug to disable submissions and see values */
  debug: true,
  /* Turn off sensitive values filter */
  disableFilter: false,
  /* Custom functionality handler for onSubmit */
  onSubmit: (event, data) => {
    console.log('submit form', event.target)
    console.log('submit data', JSON.stringify(data, null, 2))
  },
  onChange: (event, data) => {
    console.log('change form', event.target)
    console.log('change data', JSON.stringify(data, null, 2))
  },
  /* Include only specific forms. This negates 'all'
  includeForms: [
    'form[id=content-form]',
    window.document.forms[1]
  ],
  /**/
  /* Exclude forms by selectors or node.
  excludeForms: [
    'form[name=two]',
    window.document.forms[2]
  ],
  /**/
  //* // Exclude field by name or regex pattern of name attribute
  excludeFields: [
    /private/,
    'shhhh'
  ],
  /**/
  //* // Custom filter function
  filter: (fieldName, value) => {
    if (fieldName === 'hello') {
      return false
    }
    // credit card number
    if (value.match(/^\d{4}[- ]?\d{4}[- ]?\d{4}[- ]?\d{4}$/)) {
      return false
    }
    return true
  }
  /**/
}) 
```

## [](#installing)å®‰è£…

è¦åœ¨é¡¹ç›®ä¸­å®‰è£…è¡¨å•åŠ©æ‰‹ï¼Œè¯·è¿è¡Œ

```
npm install analytics-util-forms 
```

## [](#keepin-things-small)ä¿æŒå°äº‹æƒ…

ä¸ºäº†ä½¿åŒ…çš„å°ºå¯¸å°½å¯èƒ½çš„å°ï¼Œæˆ‘æ€»æ˜¯æ ¹æ®ä¸åŒçš„åŒ…è£…å°ºå¯¸æ¥æ£€æŸ¥ bundlephobiaã€‚

*   [https://bundlephobia.com/result?p=final-form](https://bundlephobia.com/result?p=final-form)
*   [https://bundlephobia.com/result?p=redux-form](https://bundlephobia.com/result?p=redux-form)
*   [https://bundlephobia.com/result?p=formik](https://bundlephobia.com/result?p=formik)
*   [https://bundlephobia.com/result?p=formsy-react](https://bundlephobia.com/result?p=formsy-react)
*   [https://bundlephobia.com/result?p=analytics-util-forms](https://bundlephobia.com/result?p=analytics-util-forms)

å°½å¯èƒ½æŠŠäº‹æƒ…åšå¾—å°ï¼Œå¹¶ç›¸åº”åœ°å¯¹ä¾èµ–å…³ç³»è¿›è¡Œé¢„ç®—ï¼

## [](#wrapping-up)åŒ…è£…å®Œæ¯•

å¦‚ä½•å¤„ç†è¡¨å•å€¼æœ€ç»ˆå–å†³äºæ‚¨è‡ªå·±ã€‚å¦‚æœå…¶ä»–åº“æˆ–æŠ½è±¡ä¸ºä½ å·¥ä½œï¼Œå¤ªå¥½äº†ï¼ç»§ç»­å‰è¿›ğŸššã€‚å®ƒä»¬å¤„ç†é¢å¤–çš„äº‹æƒ…ï¼Œæ¯”å¦‚éªŒè¯ã€ä¸å¹²å‡€çš„è¾“å…¥å’Œä¸€å †å…¶ä»–ç”¨ä¾‹ã€‚

é“å…·ç»™ [insin](https://github.com/insin) ï¼Œç»™ [get-form-data](https://github.com/insin/get-form-data) åº“çµæ„Ÿå’Œ`analytics-util-forms`è¿™ä¸ªå¼•æ“ç›–ä¸‹ä½¿ç”¨ã€‚