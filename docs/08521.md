# Kentico 12:è®¾è®¡æ¨¡å¼ç¬¬ 10 éƒ¨åˆ†â€”â€”ä½¿ç”¨ NodeAliasPath çš„ MVC è·¯ç”±

> åŸæ–‡ï¼š<https://dev.to/seangwright/kentico-12-design-patterns-part-10-mvc-routing-with-nodealiaspath-22l3>

<figure>

[![](img/ea8a37ed9405b5de96ecb5337dd587a7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--PYeNLJXt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ojg9hpamdx8mab6qmh3g.jpg)

<figcaption>Photo by [George Hiles](https://unsplash.com/@hilesy) on [Unsplash](https://unsplash.com)</figcaption>

</figure>

> åº†ç¥æˆ‘çš„ *Kentico 12 -è®¾è®¡æ¨¡å¼*ç³»åˆ—çš„ç¬¬ 10 åğŸ‰ï¼Œæˆ‘å†™äº†ä¸€ç¯‡é•¿æ–‡ï¼Œæè¿°äº†ä¸€ç§åœ¨æˆ‘ä»¬çš„ Kentico 12 MVC åº”ç”¨ç¨‹åºä¸­é‡Šæ”¾ä¼ ç»Ÿé—¨æˆ·å¼•æ“è·¯ç”±åŠŸèƒ½çš„é…·æ–¹æ³•ã€‚è¯·ç»§ç»­é˜…è¯»ï¼

ä½¿ç”¨ ASP.NET MVC æŠ€æœ¯æ ˆæ„å»º Kentico CMS åº”ç”¨ç¨‹åºä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿä½¿ç”¨ä¸€ä¸ªå¾ˆå¥½çš„æ¡†æ¶ï¼Œå¹¶å®Œå…¨æ§åˆ¶åœ¨ Kentico å†…ç®¡ç†çš„æ‰€æœ‰å†…å®¹çš„äº¤ä»˜å’Œå‘ˆç°ã€‚

ä¸è¯¥å¹³å°ä»¥å‰çš„ç‰ˆæœ¬ç›¸æ¯”ï¼ŒKentico 12 MVC æœ‰è®¸å¤šä¼˜åŠ¿(ä½ å¯ä»¥[åœ¨è¿™é‡Œ](https://www.kentico.com/product/kentico12)äº†è§£æ›´å¤šä¿¡æ¯)ï¼Œä½† Kentico ä»¥å‰åŸºäº Web è¡¨å•çš„é—¨æˆ·å¼•æ“æ¶æ„æœ‰ä¸€äº›ç‰¹æ€§åœ¨ MVC ä¸­æ²¡æœ‰æ˜ç¡®çš„å¯¹åº”é¡¹ã€‚

æœ‰è¿‡ Kentico ç»éªŒçš„å¼€å‘äººå‘˜å¯èƒ½ä¼šå‘ç°è‡ªå·±æ­£åœ¨å¯»æ‰¾çš„ä¸€ä¸ªç‰¹æ€§æ˜¯ï¼Œè®©ä»–ä»¬çš„ MVC åº”ç”¨ç¨‹åºä¸­çš„è·¯ç”±ä¸ CMS å†…å®¹æ ‘ä¸­é¡µé¢çš„`NodeAliasPath`å€¼ä¸€èµ·å·¥ä½œã€‚

å¯¹äº Kentico æä¾›çš„ç°æˆäº§å“æ¥è¯´ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ğŸ˜Ÿï¼Œä½†æ˜¯é€šè¿‡ MVC æ¡†æ¶ä¸­çš„ä¸€äº›å…³é”®é›†æˆç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆåœ°å¤åˆ¶è¿™ç§è¡Œä¸ºï¼Œå¹¶æ„å»ºå…·æœ‰éå¸¸åŠ¨æ€çš„è·¯ç”±çš„ç«™ç‚¹ğŸ™Œã€‚

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä½¿ç”¨ Kentico demo Dancing Goat ç«™ç‚¹çš„ä¾‹å­ï¼Œçœ‹çœ‹é»˜è®¤æƒ…å†µä¸‹æ˜¯å¦‚ä½•æ„å»ºçš„ï¼Œç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å®ç°`NodeAliasPath`é©±åŠ¨çš„ MVC è·¯ç”±ã€‚

## MVC é©±åŠ¨çš„åŸºäºçº¦å®šçš„è·¯ç”±

### CMS å†…å®¹æ ‘ä¸­çš„æ–‡ç« 

å¦‚æœæˆ‘ä»¬æŸ¥çœ‹è·³èˆçš„å±±ç¾Šæ¼”ç¤ºçš„å†…å®¹æ ‘ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸º`Articles`çš„èŠ‚ç‚¹ï¼Œå®ƒæ˜¯è‡ªå®šä¹‰é¡µé¢ç±»å‹`Article section (MVC)`çš„ä¸€ä¸ªå®ä¾‹ã€‚

è¿™ä¸ªé¡µé¢çš„å­˜åœ¨åªæ˜¯ä¸ºäº†ç»„ç»‡å†…å®¹æ ‘ä¸­çš„å†…å®¹â€”â€”å› ä¸ºå®ƒæ²¡æœ‰â€œé¡µé¢â€é€‰é¡¹å¡â€”â€”å¹¶ä¸”å®ƒåœ¨ MVC åº”ç”¨ç¨‹åºä¸­å¹¶ä¸è¡¨ç¤ºä¸ºå¯å¯¼èˆªçš„é¡¹ç›®ã€‚

[![](img/46628be10e247ea8bcef0e1fd0e2952b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Wyso6VQn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/a3i9c1ukyn4pgdpxf9w3.jpg)

å­é¡µé¢æ˜¯è‡ªå®šä¹‰é¡µé¢ç±»å‹`Article (MVC)`çš„å®ä¾‹ï¼Œå®ƒä»¬å¯ç”¨äº†â€œé¡µé¢â€é€‰é¡¹å¡â€”â€”è¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥é€šè¿‡ç‰¹å®šçš„ URL æ¨¡å¼åœ¨ MVC åº”ç”¨ç¨‹åºä¸­è¢«è·¯ç”±åˆ°ã€‚

å¦‚ä½•å¤„ç†è¯¥é¡µé¢åŠå…¶ä¸‹åµŒå¥—å†…å®¹çš„è·¯ç”±ï¼Ÿ

è®©æˆ‘ä»¬æ¥çœ‹çœ‹...

### MVC ä¸­çš„æ–‡ç« 

é¦–å…ˆï¼Œæˆ‘ä»¬æ³¨æ„åˆ°åœ¨`DancingGoat`åº”ç”¨ç¨‹åº
çš„`App_Start\RouteConfig.cs`ä¸­å®šä¹‰äº†ä¸€æ¡æ˜¾å¼è·¯ç”±

```
var route = routes.MapRoute(
    name: "Article",
    url: "{culture}/Articles/{guid}/{pageAlias}",
    defaults: new 
    { 
        culture = defaultCulture.Name, 
        controller = "Articles", 
        action = "Show" 
    },
    constraints: new 
    { 
        culture = new SiteCultureConstraint(), 
        guid = new GuidRouteConstraint() 
    }
); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯¥å†…å®¹çš„è·¯ç”±é…ç½®ä½¿ç”¨åŸºäº [MVC çº¦å®šçš„è·¯ç”±](http://www.dotnetfunda.com/articles/show/3029/different-types-of-routing-in-aspnet-mvc)(ä¸[å±æ€§è·¯ç”±](https://devblogs.microsoft.com/aspnet/attribute-routing-in-asp-net-mvc-5/)ç›¸å¯¹)ã€‚

> å‡è®¾æˆ‘ä»¬ä¸ºè¿™ä¸ªå†…å®¹å®šä¹‰äº†ä¸€ä¸ªæ˜¾å¼çš„è·¯ç”±ï¼Œå®ƒåªä½¿ç”¨äº†ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œè¿™ä¸æ˜¯éå¸¸åŸºäºçº¦å®šçš„â€”â€”è¿™æ„Ÿè§‰æ›´åƒæ˜¯é…ç½®ã€‚è¿™å¾ˆæ­£å¸¸â€”â€”MVC çš„è·¯ç”±çº¦å®šåœ¨æ²¡æœ‰å®šåˆ¶çš„æƒ…å†µä¸‹åªèƒ½èµ°è¿™ä¹ˆè¿œğŸ¤·â€â™€ï¸.

æˆ‘ä»¬å·²ç»å¯ä»¥çœ‹åˆ°å†…å®¹çš„ URL æ˜¯å¦‚ä½•ä¸ MVC åº”ç”¨ç¨‹åºè·¯ç”±é…ç½®è”ç³»åœ¨ä¸€èµ·çš„ã€‚ç«™ç‚¹ä¸­çš„æ‰€æœ‰æ–‡ç« éƒ½å¯ä»¥åœ¨ä¸€ä¸ª`{culture}/Articles/{guid}/{pageAlias}`è·¯å¾„æ¨¡å¼ä¸‹æ‰¾åˆ°ã€‚

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè·¯ç”±å‚æ•°`{guid}`ï¼Œä¹Ÿå°±æ˜¯æ ‘ä¸­`Article (MVC)`é¡µé¢å®ä¾‹çš„`NodeGuid`ï¼Œè¢«åŒ…å«è¿›æ¥æ˜¯ä¸ºäº†ç¡®ä¿ MVC åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ‰¾åˆ°æ­£ç¡®çš„é¡µé¢ã€‚

<figure>

[![](img/7df6bb8afccb23eaa8a7fa94ac8191e3.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--rx5bV18m--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/q47oyq4wmkf15sq90oua.jpg)

<figcaption>An example of a URL for the Article - "Coffee Beverages Explained"</figcaption>

</figure>

> æˆ‘ä»¬éœ€è¦ç”¨`NodeGuid`æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªé¡µé¢çš„æƒ…å†µæ˜¯ï¼Œåœ¨ä¸åŒçš„çˆ¶é¡µé¢ä¸‹æœ‰å¤šä¸ª`Article (MVC)`é¡µé¢ï¼Œä½†æ˜¯æœ‰ç›¸åŒçš„åç§°(`{pageAlias}`)ï¼Œå› ä¸º`{pageAlias}`è¡¨ç¤º`NodeAlias`â€”â€”é¡µé¢å‹å¥½åç§°çš„â€œç®€åŒ–â€ç‰ˆæœ¬ã€‚
> 
> `Guid`æœ‰ç‚¹å¼ºè¿«æˆ‘ä»¬å»æ¡¥æ¥ğŸŒ‰CMS ä¸­çš„å†…å®¹ç®¡ç†å’Œ MVC ä¸­çš„å†…å®¹äº¤ä»˜ä¹‹é—´çš„å·®è·ã€‚

æˆ‘ä»¬ç½‘ç«™ä¸­`Article (MVC)`å†…å®¹çš„æ¸²æŸ“æ§åˆ¶å™¨ç”±`Controllers\ArticlesController.cs`ç‹¬å®¶å¤„ç†ã€‚

è¿™å¹¶ä¸æ˜¯ä¸€ä»¶åäº‹â€”â€”äº‹å®ä¸Šï¼Œå¯¹äºå¤§å¤šæ•°ç”¨ä¾‹æ¥è¯´ï¼Œè¿™æ˜¯æœ‰æ„ä¹‰çš„â€”â€”æ— è®º`Article (MVC)`çš„å®ä¾‹åœ¨å†…å®¹æ ‘ä¸­çš„ä»€ä¹ˆä½ç½®ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›ä»æ•°æ®åº“ä¸­æ£€ç´¢å®ƒï¼Œæ˜ å°„åˆ°è§†å›¾æ¨¡å‹ï¼Œå¹¶åœ¨ MVC ç«¯ä»¥ç›¸åŒçš„æ–¹å¼å‘ˆç°ã€‚

æˆ‘å¸Œæœ›æˆ‘ä»¬ä»è¿™ä¸ªç¤ºä¾‹ä¸­æ³¨æ„åˆ°çš„ä¸»è¦å†…å®¹å¦‚ä¸‹:

1.  æˆ‘ä»¬ä½¿ç”¨åŸºäºçº¦å®šçš„è·¯ç”±ï¼Œä½†å®ƒçœ‹èµ·æ¥æ›´åƒæ˜¯åŸºäºé…ç½®çš„ã€‚
2.  CMS ä¸­çš„å†…å®¹ç¼–è¾‘å™¨æ— æ³•é…ç½®æˆ‘ä»¬çš„ URL æ¨¡å¼â€”â€”ä¸Šé¢ URL æ¨¡å¼çš„`/Articles/`éƒ¨åˆ†æ˜¯ç¡¬ç¼–ç çš„ã€‚
3.  æˆ‘ä»¬éœ€è¦åœ¨ URL ä¸­æ’å…¥ä¸€ä¸ª`Guid`å€¼ï¼Œä½¿å®ƒè¶³å¤Ÿç‹¬ç‰¹ï¼Œä»¥ä¾¿ MVC åº”ç”¨ç¨‹åºæ‰¾åˆ°æ­£ç¡®çš„`Article (MVC)`å®ä¾‹- `Guid`å¯¹ç”¨æˆ·æ¥è¯´ä¸æ˜¯å¾ˆå‹å¥½ï¼Œæ„Ÿè§‰åƒæ˜¯ä¸å¯é¿å…çš„ã€‚

> å…¬å¹³åœ°è¯´ï¼ŒKentico æä¾›äº†ä¸€ç§ç»•è¿‡ä¸Šè¿°#2 çš„æ–¹æ³•ï¼Œå³ä½¿ç”¨ [MVC æ›¿ä»£ URL](https://docs.kentico.com/k12sp/developing-websites/configuring-page-urls-on-mvc-sites/enabling-alternative-urls-for-pages)ï¼Œä½†æ˜¯è¿™ç§ç‰¹æ€§æœ€å¥½ç”¨äºä¸ºè¥é”€ç›®çš„ç”Ÿæˆå¥½çœ‹çš„ URLï¼Œè€Œä¸æ˜¯ä½œä¸ºæ‰€æœ‰ç½‘ç«™å†…å®¹çš„ä¸»è¦ URL ç”Ÿæˆã€‚

## ä½†æ˜¯è§„æ¨¡å¤§å—ï¼Ÿ

è¿™ä¸ªç”± Kentico åœ¨è·³èˆçš„å±±ç¾Šæ¼”ç¤ºç°åœº**å‘ˆç°çš„è·¯ç”±è®¾è®¡æ¨¡å¼å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¨¡å¼**ï¼å®ƒä¼šä¸ºä½ å·¥ä½œå¾—å¾ˆå¥½ï¼ğŸ’ª

ASP.NET MVC å¼€å‘è€…å·²ç»ç”¨è¿™ç§æ–¹æ³•å¼€å‘åº”ç”¨ç¨‹åºåå¹´äº†ï¼Œå¦‚æœå®ƒç¬¦åˆä½ çš„éœ€æ±‚ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†å°†åªé’ˆå¯¹æ•™è‚²ã€‚

è¯·å…è®¸æˆ‘å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼Œä¸Šé¢çš„è·¯ç”±æ¶æ„å°†æ— æ³•å·¥ä½œã€‚

å‡è®¾æˆ‘ä»¬çš„ç½‘ç«™ä¸Šæœ‰ä¸¤ä¸ªæ–‡ç« ä½œè€…ï¼ŒAxel å’Œ Roseï¼Œä»–ä»¬éƒ½æƒ³è¦è‡ªå·±çš„è™šè£å¿ƒ URLï¼Œå…¶ä¸­åŒ…å«ä»–ä»¬çš„åå­—ï¼Œå¦‚ä¸‹æ‰€ç¤º:

`/axels-coffee-corner/{articleName}`
T1ã€‘

Axel å¾ˆå°‘å†™ä»–çš„æ–‡ç« ï¼Œæ‰€ä»¥æŠŠä»–æ‰€æœ‰çš„æ–‡ç« åµŒå¥—åœ¨`/axels-coffee-corner/`ä¸‹å°±è¶³å¤Ÿäº†ã€‚

ç„¶è€Œï¼Œç½—æ–¯æ¯å¤©å†™ä¸¤æ¬¡å…³äºå’–å•¡çš„æ–‡ç« ï¼Œç”šè‡³åœ¨å‘¨æœ«ä¹Ÿæ˜¯å¦‚æ­¤(å¥¹çœŸçš„å¾ˆå–œæ¬¢å’–å•¡â˜•å’Œå†™ä½œğŸ“ï¼)ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³åœ¨å¥¹çš„ URL ä¸­æ·»åŠ ä¸€ä¸ª`{month}-{year}`æ¨¡å¼ï¼Œè®©å¥¹çš„è¯»è€…çŸ¥é“å¥¹çš„å†…å®¹æœ‰å¤šæ–°é²œã€‚

ç½—æ–¯è¿˜æåˆ°ï¼Œå…¬å¸é‡Œçš„å…¶ä»–ä¸€äº›äººä¹Ÿå¼€å§‹å¯¹å†™å’–å•¡æ„Ÿå…´è¶£ï¼Œå¯èƒ½æƒ³åœ¨ç½‘ç«™ä¸Šå¼€è¾Ÿè‡ªå·±çš„æ–‡ç« æ¿å—...ğŸ˜¨

æˆ‘ä»¬ç°æœ‰çš„ MVC è·¯ç”±æ¶æ„å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚

*   âŒ:æˆ‘ä»¬æ²¡æœ‰å¾ˆå¥½çš„æ–¹æ³•é€šè¿‡ URL æ¥åŒºåˆ†ä¸€ä¸ªä½œè€…çš„æ–‡ç« å’Œå¦ä¸€ä¸ªä½œè€…çš„æ–‡ç« â€”â€”æˆ‘ä»¬åªæœ‰ä¸€ç§æ¨¡å¼:`{culture}/Articles/{guid}/{pageAlias}`ã€‚
*   âŒ:å¦‚æœæˆ‘ä»¬åœ¨ CMS ä¸­ä½¿ç”¨ä¸€ä¸ªé¡µé¢å®¹å™¨(`{month}-{year}`)æ¥ç»„ç»‡ Rose çš„æ–‡ç« ï¼Œåœ¨ MVC ç«¯è§£æå‡ºè¿™äº› URLï¼Œç„¶åä½¿ç”¨è¿™äº›å€¼åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢æ­£ç¡®çš„é¡¹ç›®ï¼Œè¿™å°†æ˜¯ä¸€ä»¶æ£˜æ‰‹çš„äº‹æƒ…ã€‚æˆ‘ä»¬*å°†*éœ€è¦ä½¿ç”¨å®ƒä»¬è¿›è¡ŒæŸ¥è¯¢ï¼Œå› ä¸ºå®ƒä»¬æœ‰æ•ˆåœ°å–ä»£äº†ä½¿ç”¨`NodeGuid`æ¥ä¿è¯å”¯ä¸€æ€§ã€‚
*   âŒç”¨ä»–ä»¬è‡ªå·±çš„è™šè£å¿ƒ URL å‘ç«™ç‚¹æ·»åŠ ä»»ä½•æ–°çš„ä½œè€…éƒ½éœ€è¦åœ¨ MVC åº”ç”¨ç¨‹åºä¸­éƒ¨ç½²æ–°çš„è·¯ç”±æ¨¡å¼ã€‚

æˆ‘ä»¬çš„è¦æ±‚çœ‹èµ·æ¥è¶Šæ¥è¶Šåƒ CMS ä¸­çš„å†…å®¹ç»„ç»‡åº”è¯¥åŒ¹é…æˆ‘ä»¬ç”¨æ¥å¯¼èˆªåˆ°å®ƒçš„ URLã€‚

æˆ‘ä»¬ä¸æƒ³å°† URL è§£ææˆé€»è¾‘æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œå› ä¸ºä¸€ä¸ªâ€œå®Œæ•´â€çš„ URL å·²ç»å­˜åœ¨äºæ•°æ®åº“ä¸­â€”â€”å³`NodeAliasPath`ã€‚

åŒæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ MVC ç«™ç‚¹ä¸Šä»¥åŒæ ·çš„æ–¹å¼è½»æ¾ã€ä¸€è‡´åœ°å‘ˆç°å†…å®¹ï¼Œè€Œä¸éœ€è¦ä¸æ–­åœ°éƒ¨ç½²è·¯ç”±é…ç½®æ›´æ–°ã€‚ğŸ˜’

MVC å®Œå…¨æ˜¯å…³äºå†…å®¹äº¤ä»˜ï¼Œè€Œä¸æ˜¯å†…å®¹ç»„ç»‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•çœŸæ­£ä»å†…å®¹åœ¨ CMS ä¸­çš„ç»„ç»‡å’Œ URL æ ‡è¯†ä¸­æŠ½è±¡å‡ºå†…å®¹åœ¨ MVC ä¸­çš„å‘ˆç°å‘¢ï¼ŸğŸ¤”

## [ç”¨`IRouteConstraint`è·¯ç”±`NodeAliasPath`](#routing-by-raw-nodealiaspath-endraw-with-raw-irouteconstraint-endraw-)

è®©æˆ‘ä»¬ä»å®šä¹‰æˆ‘ä»¬éœ€è¦å®Œæˆçš„ä»»åŠ¡å¼€å§‹:

1.  âœ…é…ç½®äº†ä¸€æ¡åŒ¹é…ä»»æ„`NodeAliasPath`çš„è·¯ç”±ã€‚
2.  å¦‚æœä¸ç»™å®šçš„`NodeAliasPath`ç›¸å…³è”çš„é¡µé¢æ˜¯ç‰¹å®šé¡µé¢ç±»å‹çš„å®ä¾‹ï¼Œåˆ™âœ…åªæœ‰æˆ‘ä»¬çš„è·¯ç”±åŒ¹é…ã€‚
3.  âœ…å°†æ­¤è·¯ç”±è¿æ¥åˆ°ç‰¹å®šçš„`Controller`å’Œ`Action`ï¼Œå®ƒä»¬è¢«ç¼–ç ä¸ºå¤„ç†æ‰€éœ€é¡µé¢ç±»å‹çš„é¡µé¢ã€‚

### é…ç½®æˆ‘ä»¬çš„è·¯çº¿

æ‰€æœ‰è¿™äº›éœ€æ±‚éƒ½å¯ä»¥é€šè¿‡å®ç°`System.Web.Routing.IRouteConstraint`æ¥å£æ¥æ»¡è¶³ã€‚

`IRouteConstraint`æœ‰ä¸€ä¸ªæ–¹æ³•`Match`ï¼Œå½“è¯·æ±‚å’Œè·¯ç”±çš„ä¸Šä¸‹æ–‡ä¸æˆ‘ä»¬çš„éœ€æ±‚åŒ¹é…æ—¶ï¼Œå®ƒè¿”å›`true`ï¼Œå½“ä¸åŒ¹é…æ—¶ï¼Œè¿”å›ã€T3:ã€‘

```
bool Match(
    HttpContextBase httpContext, 
    Route route, 
    string parameterName, 
    RouteValueDictionary values, 
    RouteDirection routeDirection) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°†å®ç°`IRouteConstraint`çš„ç±»çš„å®ä¾‹åˆ†é…ç»™æˆ‘ä»¬ä¼ é€’ç»™`constraints`å‚æ•°çš„å¯¹è±¡ä¸­åŸºäºçº¦å®šçš„è·¯ç”±å®šä¹‰ã€‚

```
routes.MapRoute(
    name: "default",
    url: "{controller}/{action}/{id}",
    defaults: new
    {
        controller = "Home",
        action = "Index",
        id = UrlParameter.Optional
    },
    constraints: new
    {
        id = new MyCustomConstraint()
    }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å®ç°`MyCustomConstraint`æ¥çº¦æŸ`{id}`è·¯ç”±å‚æ•°ã€‚

å®ƒçš„`Match`æ–¹æ³•å°†ä½œä¸º`string parameterName`å‚æ•°çš„å€¼è¢«ä¼ é€’ç»™`"id"`ï¼Œè¯¥å€¼å¯ç”¨äºåœ¨`RouteValueDictionary values`å‚æ•°ä¸­æŸ¥æ‰¾å€¼ã€‚

è®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰æˆ‘ä»¬çš„è·¯çº¿ï¼Œç„¶åä¸ºä¸‹é¢çš„ç”¨ä¾‹å®ç°`IRouteConstraint`:

```
routes.MapRoute(
    name: "Articles",
    url: "{*nodeAliasPath}",
    defaults: new
    {
        controller = "Articles",
        action = "Show"
    },
    constraints: new
    {
        nodeAliasPath = new NodeAliasPathConstraint(Article.CLASS_NAME)
    }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢æˆ‘ä»¬ç”¨éå¸¸å®½æ¾çš„ URL æ¨¡å¼`{*nodeAliasPath}`å®šä¹‰äº†ä¸€æ¡è·¯çº¿ï¼Œå®ƒæœ‰æ•ˆåœ°åŒ¹é…äº†*æ¯ä¸€ä¸ª URL* ã€‚

è¿™é€šå¸¸æ˜¯ä¸å¥½çš„ï¼Œå› ä¸ºåªæœ‰æ–‡ç« çš„ URL åº”è¯¥ç”±`ArticlesController.Show`å¤„ç†ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬çš„`NodeAliasPathConstraint`å¸®åŠ©äº†æˆ‘ä»¬ã€‚

è¯¥çº¦æŸä»¥`Article` ( `Article (MVC)`é¡µé¢ç±»å‹)ç±»çš„ Kentico `CLASS_NAME`ä½œä¸ºå‚æ•°ï¼Œå¹¶çº¦æŸè·¯ç”±æ¨¡å¼æ¨¡æ¿çš„`nodeAliasPath`ä»¤ç‰Œä»¥æ»¡è¶³å…¶è¦æ±‚ã€‚ğŸ‘

### å®šä¹‰æˆ‘ä»¬çš„çº¦æŸ

ä¸‹é¢æ˜¯æˆ‘ä»¬çš„çº¦æŸå°šæœªå®Œæˆçš„å®ç°:

```
public class NodeAliasPathConstraint : IRouteConstraint
{
    private readonly string nodeClassName;

    public NodeAliasPathConstraint(string nodeClassName) => 
        this.nodeClassName = nodeClassName;

    public bool Match(
        HttpContextBase httpContext, 
        Route route, 
        string parameterName, 
        RouteValueDictionary values, 
        RouteDirection routeDirection)
    {
        // â— If we didn't configure the route correctly and no
        // nodeAliasPath was defined in the route URL template
        // we can't match

        if (!values.TryGetValue(parameterName, out object nodeAliasPathObj))
        {
            return false;
        }

        // Converts nodeAliasPathObj into a TreeNode.NodeAliasPath
        // by prefixing with a /

        string nodeAliasPath = $"/{nodeAliasPathObj}";

        // TODO: Determine if nodeAliasPath matches any page in the CMS
        // with a TreeNode.NodeClassName matching our nodeClassName

        return false;
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šå›¾ä¸­çš„`NodeAliasPathConstraint`ï¼Œé‡‡ç”¨äº†ä¸€ä¸ª`nodeClassName`ï¼Œå¹¶æ ¹æ®è·¯çº¿å€¼æ„å»ºäº†ä¸€ä¸ª`nodeAliasPath`ã€‚

æˆ‘ä»¬ç°åœ¨éœ€è¦æŸ¥è¯¢æ•°æ®åº“æ¥æ£€æŸ¥ä¸¤ä¸ªæ¡ä»¶:

1.  CMS ä¸­å­˜åœ¨ä¸€ä¸ªé¡µé¢ï¼Œå®ƒçš„`TreeNode.NodeAliasPath`ä¸å½“å‰è¯·æ±‚çš„è·¯ç”±å‚æ•°æ•è·çš„`nodeAliasPath`ç›¸åŒ¹é…ã€‚
2.  è¯¥é¡µé¢æœ‰ä¸€ä¸ª`TreeNode.NodeClassName`ï¼Œå®ƒä¸æˆ‘ä»¬çš„è·¯ç”±å¯ä»¥å¤„ç†çš„é¡µé¢ç±»å‹ç›¸åŒ¹é…ï¼Œå¦‚`nodeClassName`æ‰€å®šä¹‰çš„ã€‚

æˆ‘ä»¬æ¥æ·»åŠ æŸ¥è¯¢æ•°æ®åº“çš„é€»è¾‘:

```
// Additional filters (e.g. culture) should be applied as needed

bool isPreview = HttpContext.Current.Kentico().Preview().Enabled;

var node = DocumentHelper.GetDocuments()
    .WhereEquals(nameof(TreeNode.NodeAliasPath), nodeAliasPath)
    .LatestVersion(isPreview)
    .Published(!isPreview)
    .OnSite(SiteContext.SiteName)
    .CombineWithDefaultCulture()
    .TopN(1)
    .Column(nameof(TreeNode.ClassName))
    .FirstOrDefault();

if (node is null)
{
    return false;
}

if (string.Equals(node.ClassName, nodeClassName, StringComparison.OrdinalIgnoreCase))
{
    // â— We replace the `nodeAliasPath` route value with the one we prefixed
    // above so that the ArticlesController.Show(string nodeAliasPath)
    // call is passed a correct TreeNode.NodeAliasPath value

    values[parameterName] = nodeAliasPath;

    return true;
}

return false; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æƒ³è®©æˆ‘ä»¬çš„æŸ¥è¯¢æ›´å¿«ğŸƒâ€â™€ï¸ï¼Œå› ä¸ºå®ƒå°†åœ¨ä»»ä½•æ—¶å€™è¢«è°ƒç”¨ï¼ŒMVC çš„è·¯ç”±è¿‡ç¨‹éœ€è¦çŸ¥é“æˆ‘ä»¬çš„â€œä»»ä½•â€è·¯ç”±`"{*nodeAliasPath}"`æ˜¯å¦åŒ¹é…ä¸€ä¸ªç‰¹å®šçš„ URLã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å°†åˆ—é™åˆ¶ä¸º`ClassName`ï¼Œå¹¶ä¸”åªå–ç¬¬ä¸€ä¸ªç»“æœ(æˆ‘ä»¬åº”è¯¥åªæœ‰ 1 ä¸ª)ã€‚

å¦‚æœä¸å­˜åœ¨å¸¦æœ‰ä¸ URL åŒ¹é…çš„`NodeAliasPath`çš„é¡µé¢ï¼Œæˆ‘ä»¬è¿”å›`false`ã€‚

å¦‚æœä¸Šé¢çš„æŸ¥è¯¢è¿”å›ä¸€ä¸ªé¡µé¢çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”é¡µé¢çš„`NodeClassName`ä¸è¿™ä¸ªè·¯ç”±å¤„ç†çš„é¡µé¢ç±»å‹ä¸åŒ¹é…ï¼Œæˆ‘ä»¬è¿”å›`false`ã€‚

åªæœ‰å½“å†…å®¹æ ‘ä¸­å­˜åœ¨ä¸€ä¸ªå…·æœ‰åŒ¹é…çš„`NodeAliasPath`å’Œ`NodeClassName`çš„é¡µé¢ï¼Œå¹¶ä¸”è¯¥é¡µé¢ä¸æä¾›ç»™çº¦æŸçš„æ„é€ å‡½æ•°çš„é¡µé¢ç›¸åŒ¹é…æ—¶ï¼Œæˆ‘ä»¬æ‰è¿”å›`true`ã€‚

### é€šè¿‡ç¼“å­˜ä¼˜åŒ–æˆ‘ä»¬çš„é€»è¾‘

ç›®å‰ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¤šä¸ªè·¯ç”±ä¸Šä½¿ç”¨è¿™ä¸ªçº¦æŸï¼Œæ‰€æœ‰çš„è·¯ç”±éƒ½ä½¿ç”¨ç›¸åŒçš„`"{*nodeAliasPath}"` URL æ¨¡æ¿ï¼Œæˆ‘ä»¬çš„çº¦æŸâ€”â€”å› æ­¤æˆ‘ä»¬çš„æŸ¥è¯¢â€”â€”å°†ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ MVC æ£€æŸ¥æ‰€è¯·æ±‚çš„ URL çš„æ¯ä¸ªè·¯ç”±æ‰§è¡Œä¸€æ¬¡ã€‚

ä¾‹å¦‚ï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæœ‰ 15 ä¸ªæ§åˆ¶å™¨ï¼Œæ¯ä¸ªæ§åˆ¶å™¨å¤„ç†ä¸åŒçš„é¡µé¢ç±»å‹ï¼Œæˆ‘ä»¬å°†æœ‰ 15 ä¸ªè·¯ç”±ç”¨è¿™ä¸ªçº¦æŸçš„å”¯ä¸€å®ä¾‹æ¥å®šä¹‰ã€‚å¦‚æœæœ€åæ£€æŸ¥çš„è·¯ç”±æ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†è¿è¡Œè¿™ä¸ªæŸ¥è¯¢ 15 æ¬¡ã€‚ğŸ˜è¯¥æ­»ã€‚

æˆ‘ä»¬çš„çº¦æŸä¹Ÿå°†åœ¨ç›¸åŒè·¯ç”±çš„æ¯ä¸ªåç»­ HTTP è¯·æ±‚ä¸Šè¢«è°ƒç”¨(å³ï¼Œæ‚¨å‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼Œç„¶ååˆ·æ–°é¡µé¢)ã€‚

å½“ç»“æœå·²çŸ¥æ—¶ï¼Œæˆ‘ä»¬ä¸æƒ³é‡å¤è¿™ä¸ªä¸å¿…è¦çš„æŸ¥è¯¢ï¼

è§£å†³è¿™ä¸ªæ€§èƒ½å¯ä¼¸ç¼©æ€§é—®é¢˜çš„å¿«é€Ÿæœ‰æ•ˆçš„æ–¹æ³•æ˜¯ä½¿ç”¨ç¼“å­˜ã€‚

Kentico æä¾›äº†ä¸€ä¸ª`CacheHelper`ç±»æ¥å¸®åŠ©å¼€å‘äººå‘˜å°†é¡¹ç›®æ·»åŠ åˆ°ç¼“å­˜ä¸­ï¼Œå¹¶è®¾ç½®è¿™äº›ç¼“å­˜é¡¹ç›®çš„ä¾èµ–å…³ç³»ã€‚

ä¸‹é¢æ˜¯æˆ‘ä»¬å¯¹`CacheHelper`çš„ç”¨æ³•:

```
Func<TreeNode> query = () => DocumentHelper.GetDocuments()
    .WhereEquals(nameof(TreeNode.NodeAliasPath), nodeAliasPath)
    .LatestVersion(isPreview)
    .Published(!isPreview)
    .OnSite(SiteContext.SiteName)
    .CombineWithDefaultCulture()
    .TopN(1)
    .Column(nameof(TreeNode.ClassName))
    .FirstOrDefault();

string scope = nameof(NodeAliasPathConstraint);
string cacheItemName = $"{scope}|preview:{isPreview}|" +
    {SiteContext.SiteName}|{nodeAliasPath}" 
var node = CacheHelper.Cache(
    query,
    new CacheSettings(
        cacheMinutes: 5, 
        cacheItemNameParts: cacheItemName)
    {
        GetCacheDependency = () => CacheHelper.GetCacheDependency(new[]
        {
            $"node|{SiteContext.CurrentSiteName}|{nodeAliasPath}"
        })
    });

// Check if node is a match ... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½¿ç”¨`CacheHelper`å°†ç¼“å­˜æˆ‘ä»¬æŸ¥è¯¢åŒ¹é…ç»™å®š`nodeAliasPath`çš„`TreeNode`çš„ç»“æœ 5 åˆ†é’Ÿï¼Œå¦‚æœ CMS æ›´æ–°å½“å‰ç«™ç‚¹åŒ¹é…`nodeAliasPath`çš„ä»»ä½•èŠ‚ç‚¹ï¼Œä¹Ÿå°†æ¸…é™¤ç¼“å­˜ã€‚

æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªå¯é‡ç”¨çš„`NodeAliasPathConstraint`ç±»ï¼Œå¯ä»¥ç”¨æ¥çº¦æŸå“ªäº› URL åŒ¹é…æˆ‘ä»¬çš„ MVC åº”ç”¨ç¨‹åºå®šä¹‰çš„æ‰€æœ‰ä¸åŒçš„è·¯ç”±ã€‚

ç”±äºæˆ‘ä»¬åœ¨ä¸Šé¢å®šä¹‰çš„è·¯å¾„åŒ¹é…ä¸€ä¸ª`Article (MVC)`é¡µé¢çš„ä»»ä½•`NodeAliasPath`ï¼Œæˆ‘ä»¬çš„`ArticlesController`å¯ä»¥å¤„ç†å†…å®¹æ ‘ä¸­ä»»ä½•åœ°æ–¹çš„ä»»ä½•æ–‡ç« ï¼Œä¸ç®¡å®ƒæ˜¯å¦‚ä½•ç»„ç»‡çš„æˆ–è€… URL çœ‹èµ·æ¥åƒä»€ä¹ˆâ€”â€”åªè¦ URL æ˜¯é¡µé¢çš„`NodeAliasPath`ã€‚

é˜¿å…‹å¡å°”å’Œç½—æ–¯çš„æ–‡ç« ç½‘å€éƒ½å°†æŒ‰ç…§ä»–ä»¬é¢„æœŸçš„æ–¹å¼å·¥ä½œã€‚ğŸ¤¸â€â™‚ï¸

ä»»ä½•æ–°ä½œè€…åªéœ€è¦åœ¨æ ‘ä¸­åˆ›å»ºä¸€ä¸ªå®¹å™¨é¡µé¢ï¼Œå¹¶å¼€å§‹åœ¨å®ƒä¸‹é¢åµŒå¥—æ–°çš„`Article (MVC)`é¡µé¢å®ä¾‹ã€‚

## åŸºäºçº¦å®šè·¯ç”±çš„æ³¨æ„äº‹é¡¹

æˆ‘ä»¬åŸºäº`NodeAliasPath`çš„è·¯ç”±æ­£å¦‚æˆ‘ä»¬æ‰€å¸Œæœ›çš„é‚£æ ·å·¥ä½œï¼Œåœåœ¨è¿™é‡Œæ²¡æœ‰ä»»ä½•é—®é¢˜ğŸ˜…ã€‚

ç„¶è€Œï¼ŒæŒ‰ç…§ç›®å‰çš„è®¾è®¡ï¼Œæˆ‘ä»¬å°†åœ¨ MVC åº”ç”¨ç¨‹åºä¸­ä»¥ä¸€å †`RouteCollection.MapRoute()`è°ƒç”¨ç»“æŸï¼Œè¿™äº›è°ƒç”¨æœ‰æ•ˆåœ°åšç€åŒæ ·çš„äº‹æƒ…ï¼Œåªæ˜¯æ–¹å¼ç•¥æœ‰ä¸åŒã€‚

æˆ‘ä»¬ä¹Ÿæœ‰æˆ‘åœ¨ä»¥å‰çš„å¸–å­ä¸­æåˆ°çš„â€œåˆ†æ•£çš„å­—ç¬¦ä¸²â€çš„é—®é¢˜:

```
defaults: new
{
    controller = "Articles",
    action = "Show"
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæˆ‘ä»¬æŠŠæˆ‘ä»¬çš„`ArticlesController`é‡å‘½åä¸º`ArticleController`(ä¸å«`s`)ï¼Œæˆ‘ä»¬çš„è·¯çº¿å°±ä¼šä¸­æ–­ï¼Œé™¤éæˆ‘ä»¬æŠŠä¸Šé¢çš„çº¿æ›´æ–°ä¸º`controller = "Article"`ğŸ˜¢ã€‚

ç”±äºæˆ‘ä»¬å°†çº¦æŸåº”ç”¨äºç‰¹å®šçš„æ§åˆ¶å™¨/åŠ¨ä½œå¯¹ï¼Œä»¥åŒ¹é…ç‰¹å®šçš„`NodeAliasPath` / `NodeClassName`å¯¹ï¼Œå› æ­¤åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªé¡µé¢ç±»å‹çš„â€œåˆ—è¡¨â€è§†å›¾å’Œâ€œç»†èŠ‚â€è§†å›¾å®šä¹‰ä¸€ä¸ªè·¯ç”±ã€‚

å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨åä¸º`List`çš„æ–¹æ³•è€Œä¸æ˜¯`Index`æ–¹æ³•æ¥æ˜¾ç¤ºæ–‡ç« åˆ—è¡¨ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°æ–¹æ³•å’Œè·¯ç”±é…ç½®ğŸ˜¤ã€‚

å¦‚æœæˆ‘ä»¬åªæœ‰å°‘æ•°å‡ æ¡ä½¿ç”¨è¿™ç§çº¦æŸçš„è·¯çº¿ï¼Œé‚£ä¹ˆä¸Šè¿°æ¨¡å¼å°†ä¼šå¾ˆå¥½åœ°å·¥ä½œ...

ä½†æ˜¯ï¼Œè¿™ä¸ªè®¾è®¡æœ‰ä¸€ä¸ªæœ€ç»ˆå½¢å¼,å®ƒå°†åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ä¼˜é›…åœ°å¤„ç†æˆ‘ä»¬åŸºäº`NodeAliasPath`çš„è·¨è®¸å¤šæ§åˆ¶å™¨çš„è·¯ç”±â€”â€”å®ƒå°†æŒ‰ç…§æˆ‘ä»¬æƒ³è¦çš„é‚£æ ·æ‰©å±•ã€‚

å¦‚æœä½ æ•¢ï¼Œè¯·ç»§ç»­é˜…è¯»ï¼ğŸƒğŸ‘»

## ç»ˆææ–¹æ³•ï¼

### `PageTypeRouteAttribute`

é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªä¸åŸºäºä»»ä½• MVC ç±»çš„è‡ªå®šä¹‰`Attribute`ã€‚

```
[AttributeUsage(AttributeTargets.Method)]
public class PageTypeRouteAttribute : Attribute
{
    public PageTypeRouteAttribute(params string[] classNames) =>
        ClassNames = classNames;

    public string[] ClassNames { get; }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯¥å±æ€§å°†ä½œä¸ºæˆ‘ä»¬æ‰€æœ‰æ§åˆ¶å™¨åŠ¨ä½œæ–¹æ³•çš„æ ‡è®°ï¼ŒæŒ‡ç¤ºè¯¥æ–¹æ³•æ”¯æŒå‘ˆç°å“ªäº›è‡ªå®šä¹‰é¡µé¢ç±»å‹ã€‚

> è¯¥å±æ€§å…è®¸å¤šä¸ªç±»åï¼Œå› ä¸ºå•ä¸ªåŠ¨ä½œæ–¹æ³•å¯èƒ½ä»¥ä¸€ç§éå¸¸é€šç”¨å’ŒæŠ½è±¡çš„æ–¹å¼å¤„ç†ä¸åŒçš„é¡µé¢ç±»å‹ï¼Œåªä½¿ç”¨å®ƒä»¬å…±åŒçš„`TreeNode`å±æ€§ï¼Œæˆ–è€…é€šè¿‡æˆ‘ä»¬åˆ›å»ºçš„è‡ªå®šä¹‰æ¥å£åº”ç”¨äºæ‰€æœ‰é¡µé¢ç±»å‹ğŸ§.

ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå±æ€§çš„ä¾‹å­:

```
// ArticlesController.cs

[PageTypeRoute(Article.CLASS_NAME)]
public ActionResult Index(string nodeAliasPath)
{
    // ...
}

// or maybe HomeController.cs

[PageTypeRoute(Home.CLASS_NAME, "CMS.Root")]
public ActionResult Index(string nodeAliasPath)
{
    // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### æ›´æ–°æˆ‘ä»¬çš„`NodeAliasPathConstraint`

å½“æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ª`NodeAliasPath`åŒ¹é…æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨æ ‡å‡†çš„ MVC è·¯ç”±è¡Œä¸ºï¼Œé™¤äº†æˆ‘ä»¬å¸Œæœ›`RouteValueDictionary`ä¸­çš„`"controller"`å’Œ`"action"`å€¼æ¥è‡ªæ§åˆ¶å™¨å’Œå¸¦æœ‰æ­£ç¡®`PageTypeRouteAttribute`çš„åŠ¨ä½œï¼Œç”±`NodeClassName`åŒ¹é…ã€‚

æˆ‘ä»¬å¯ä»¥é¦–å…ˆç§»é™¤ä¸Šé¢å®šä¹‰çš„`NodeAliasPathConstraint`çš„æ„é€ å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ–°å®ç°å°†ç”¨äºæ‰€æœ‰å®šåˆ¶é¡µé¢ç±»å‹ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨æŸ¥è¯¢è¿”å›çš„`NodeClassName`å€¼æ‰¾åˆ°æ­£ç¡®çš„æ§åˆ¶å™¨å’ŒåŠ¨ä½œæ¥å¤„ç†è¯·æ±‚ï¼Œä½¿ç”¨`PageTypeRouteAttributeCacheHelper` :

```
if (!values.TryGetValue(parameterName, out object nodeAliasPathObj))
{
    return false;
}

string nodeAliasPath = $"/{nodeAliasPathObj as string}";

// Use the same CacheHelper.Cache call to query for matching Node

var node = ...

if (node is null)
{
    return false;
}

if (!PageTypeRouteAttributeCacheHelper
        .ClassNameLookup
        .TryGetValue(nodeClassName, out var pair))
{
    return false;
}

values["action"] = pair.ActionName;
values["controller"] = pair.ControllerName;
values[parameterName] = nodeAliasPath;
values["nodeClassName"] = node.ClassName;

return true; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> è¿™ä¸ª`PageTypeRouteAttributeCacheHelper`ç±»å¯ä»¥åœ¨[GitHub Gist è¿™é‡Œ](https://gist.github.com/seangwright/d84ef3189d724359c291be2fa463f3b6)æ‰¾åˆ°ï¼Œå› ä¸ºå®ƒå¤ªé•¿äº†ï¼Œä¸èƒ½æ”¾åœ¨å¸–å­é‡Œã€‚
> 
> å®ƒå°†åæ˜ åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç±»å‹ï¼Œæ‰¾åˆ°`Controller`å®ä¾‹ï¼Œæ‰¾åˆ°é‚£äº›å¸¦æœ‰`PageTypeRouteAttribute` s çš„æ§åˆ¶å™¨ä¸Šçš„æ‰€æœ‰åŠ¨ä½œï¼Œæœ€åå°† ActionName/ControllerName `struct`æ·»åŠ åˆ°å¸¦æœ‰`PageTypeRouteAttribute.ClassNames`å€¼ä½œä¸ºé”®çš„`Dictionary`ä¸­ã€‚
> 
> ç†æƒ³æƒ…å†µä¸‹ï¼ŒæŸ¥æ‰¾å°†ç”±å®ç°æ¥å£çš„æœåŠ¡æ¥æ‰§è¡Œï¼Œè¯¥æ¥å£è¢«æ³¨å…¥åˆ°`NodeAliasPathRouteHandler`çš„æ„é€ å‡½æ•°ä¸­ï¼Œä»¥ä½¿å…¶æ›´å…·å¯æµ‹è¯•æ€§ã€‚æˆ‘å°†æŠŠè¿™ä¸ªç•™ç»™è¯»è€…ğŸ¤“ï¼

### ç™»è®°æˆ‘ä»¬çš„è·¯çº¿

æˆ‘ä»¬ç°åœ¨åªéœ€è¦æ³¨å†Œä¸€æ¡ä½¿ç”¨`NodeAliasPathConstraint`çš„è·¯ç”±ã€‚

```
routes.MapRoute(
    name: "NodeAliasPath",
    url: "{*nodeAliasPath}",
    defaults: null,
    constraints: new
    {
        nodeAliasPath = new NodeAliasPathConstraint()
    }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### æ›´æ–° CMS é¡µé¢ç±»å‹é…ç½®

æˆ‘ä»¬è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯å°†`Article (MVC)`é¡µé¢ç±»å‹çš„â€œURL æ¨¡å¼â€å­—æ®µæ›´æ”¹ä¸º`{% NodeAliasPath %}`ã€‚

[![](img/2f4c590a467b918348e4069a1d1d9731.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--lvZD4Mfn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/yp1kpellm5p235m5ld6p.jpg)

è¿™å°†ç¡®ä¿å½“æˆ‘ä»¬åœ¨å†…å®¹æ ‘ä¸­æŸ¥çœ‹æ–‡ç« é¡µé¢çš„â€œé¡µé¢â€é€‰é¡¹å¡æ—¶ï¼Œå®ƒå°†å‘ MVC åº”ç”¨ç¨‹åºå‘é€æ­£ç¡®çš„è¯·æ±‚â€”â€”ä½¿ç”¨`NodeAliasPath`ä½œä¸º URLâ€”â€”å¹¶ä½¿ç”¨æˆ‘ä»¬ä¸Šé¢æ„å»ºçš„æ‰€æœ‰å†…å®¹å‘ˆç°é¡µé¢ã€‚

## ä½•å»ä½•ä»

æˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„å¤šçš„è‡ªå®šä¹‰é¡µé¢ç±»å‹ä¸Šä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ä¿è¯ï¼Œæ— è®ºæ‚¨å°†å†…å®¹æ”¾åœ¨æ ‘çš„å“ªä¸ªä½ç½®ï¼Œéƒ½ä¼šé€‰æ‹©æ­£ç¡®çš„æ§åˆ¶å™¨å’ŒåŠ¨ä½œğŸ‘ã€‚

æˆ‘ä»¬è¿˜å¯ä»¥ç¡®ä¿¡ï¼ŒCMS å†…å®¹æ ‘çš„ç»„ç»‡ç»“æ„å’Œæ‰€æœ‰é¡µé¢çš„åç§°å°†åæ˜ åœ¨ç”¨äºè®¿é—® MVC åº”ç”¨ç¨‹åºâš¡.ä¸­çš„å†…å®¹çš„ URL ä¸­

æˆ‘ä»¬åœ¨ [WiredViews](https://www.wiredviews.com) ä¸­ä½¿ç”¨çš„ä¸€ä¸ªæ¨¡å¼æ˜¯ä¸ºæ¯ç§å†…å®¹é¡µé¢ç±»å‹çš„â€œåˆ—è¡¨é¡µé¢â€åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰é¡µé¢ç±»å‹ã€‚

å› æ­¤ï¼Œä¸ä¸Šé¢çš„`Article (MVC)`ç¤ºä¾‹ç±»ä¼¼ï¼Œ`Article section (MVC)`å°†å¯ç”¨â€œé¡µé¢â€é€‰é¡¹å¡ã€‚

æˆ‘ä»¬å°†é…ç½®`ArticlesController`å¦‚ä¸‹:

```
[PageTypeRoute(ArticleSection.CLASS_NAME)]
public ActionResult Index(string nodeAliasPath)
{
    // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

MVC åº”ç”¨ç¨‹åºä¸­çš„æ¯ä¸ªæ–‡ç« éƒ¨åˆ†éƒ½å°†ç”±ç›¸åŒçš„é€»è¾‘å‘ˆç°ï¼Œä½†æ˜¯å¯ä»¥åœ¨å†…å®¹æ ‘ä¸­çš„ä»»ä½•åœ°æ–¹åˆ›å»ºä¸åŒçš„éƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰è‡ªå·±çš„`NodeAliasPath`ç”¨ä½œå‘ˆç°å…¶å†…å®¹çš„ URLğŸ’ªã€‚

ç¤ºä¾‹:

è®¾æƒ³æˆ‘ä»¬æœ‰ä¸€ä¸ªâ€œæ–‡ç« å®¹å™¨â€->â€œæ–‡ç« ä½œè€…â€->â€œæ–‡ç« â€çš„å†…å®¹å±‚æ¬¡ç»“æ„:

å¯ä»¥åˆ—å‡ºæˆ‘æœ€è¿‘å†™çš„å‰ 10 ç¯‡æ–‡ç« ã€‚
`/Company-Articles/Moe-Tucker`ä¼šåˆ—å‡ºæœ€è¿‘çš„åå¤§èŒã€‚
`/Company-Articles/Moe-Tucker/How-To-Make-Coffee`å°†æ˜¯é—¨é—¨çš„ä¸€ç¯‡å…·ä½“æ–‡ç« ã€‚
`/Guest-Articles/Exene-Cervenka/Rock-And-Roll-Coffee`ä¼šæ˜¾ç¤º Exene çš„å®¢ä¸²æ–‡ç« ã€‚

å¯¹äºç›¸åŒçš„å†…å®¹ç±»å‹èƒ½å¤Ÿæœ‰å¤šä¸ªâ€œå®¶â€,å¹¶ä¸”ä¸å¿…æ‹…å¿ƒè°ƒæ•´ MVC è·¯ç”±ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½ğŸš€ğŸ¤˜ï¼

ä¸¤ä¸ªé¢å¤–æ´¥è´´ï¼Œæˆ‘ä¸ä¼šåœ¨è¿™é‡Œè®¨è®ºï¼Œæ˜¯:

*   èƒ½å¤Ÿé€šè¿‡ä½¿ç”¨é¡µé¢çš„`NodeAliasPath`æ›´å®¹æ˜“åœ°ç”ŸæˆåŠ¨æ€èœå•ï¼Œè€Œä¸æ˜¯é€šè¿‡ MVC çš„ API ç”Ÿæˆ URLã€‚
*   ä½¿ç”¨`NodeAliasPath`ä¸ºé€šå¸¸å¯¹ç”Ÿæˆ URL æœ‰å¤æ‚è¦æ±‚çš„é¡µé¢åˆ›å»º XML ç«™ç‚¹åœ°å›¾ã€‚ä½¿ç”¨`NodeAliasPath`è¿˜å¯ä»¥ç®€åŒ–æˆ‘ä»¬è·å–ç«™ç‚¹åœ°å›¾æ•°æ®æ‰€éœ€çš„æŸ¥è¯¢â€”â€”å¯¹äºæ‰€æœ‰æ–‡æ¡£ï¼ŒURLã€å›¾åƒå’Œä¿®æ”¹æ—¥æœŸ*å¯ä»¥æ¥è‡ªåŒä¸€ä¸ª`DocumentQuery`,è€Œä¸ç®¡é¡µé¢ç±»å‹ã€‚*

## æ€»ç»“

å¥½å§ï¼Œé‚£å¾ˆä¹…äº†...ä½†æ˜¯å¦‚æœä½ åœ¨çŸ¥é“æˆ‘å–œæ¬¢æ·±å…¥æŒ–æ˜è®¾è®¡æ¨¡å¼ã€Kentico å’Œ ASP.NET MVC ä¹‹å‰è¯»è¿‡æˆ‘çš„å¸–å­â€”â€”é‚£ä¹ˆï¼ŒæŠ±æ­‰#ä¸æŠ±æ­‰ğŸ¤£ã€‚

åœ¨æˆ‘ä»¬çš„ Kentico 12 MVC åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåŸºäº`NodeAliasPath`çš„è·¯ç”±è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯æˆ‘ä»¬åˆ°åº•å®Œæˆäº†ä»€ä¹ˆï¼Ÿ

*   âœ…æˆ‘ä»¬å°†åŸºäº`NodeAliasPath`çš„ URL åŠŸèƒ½ä» Kentico CMS é—¨æˆ·å¼•æ“ç½‘ç«™è°ƒæ•´åˆ°äº† Kentico 12 MVCï¼Œå› æ­¤å†…å®¹ç¼–è¾‘å¯ä»¥æ§åˆ¶ URLã€‚
*   âœ…æˆ‘ä»¬ä½¿å¾—é¡µé¢ç±»å‹åœ¨ CMS ä¸­æœ‰å¤šä¸ªä¸»ç›®å½•æˆä¸ºå¯èƒ½ï¼Œè€Œä¸ä¼šå¢åŠ  MVC è·¯ç”±é…ç½®çš„å¤æ‚æ€§ã€‚
*   âœ…:æˆ‘ä»¬åšäº†ä¸€ä¸ªæ˜“äºé‡ç”¨çš„`Attribute`ï¼Œå®ƒæ¸…æ¥šåœ°å®šä¹‰äº†ä»€ä¹ˆå†…å®¹ä¸å“ªä¸ªæ§åˆ¶å™¨åŠ¨ä½œç›¸å…³è”ã€‚
*   âœ…:æˆ‘ä»¬åˆ©ç”¨ Kentico çš„ç¼“å­˜ API æ¥ç¡®ä¿æˆ‘ä»¬ç»å¸¸è°ƒç”¨çš„è·¯ç”±çº¦æŸä¸ä¼šå½±å“ç«™ç‚¹æ€§èƒ½ã€‚

æˆ‘å¾ˆä¹æ„ä»æ‰€æœ‰æ­£åœ¨æ„å»º Kentico 12 MVC åº”ç”¨ç¨‹åºçš„ Kentico å¼€å‘äººå‘˜é‚£é‡Œå¾—åˆ°å…³äºè¿™ç§æ¨¡å¼çš„åé¦ˆã€‚

æˆ‘çŸ¥é“ Kentico è®¡åˆ’åœ¨ Kentico 2020 å¹´å¢åŠ ä¸€ä¸ªâ€œåŠ¨æ€è·¯ç”±â€è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬ä¸åœ¨é‚£ä¸ªç¾å¦™çš„ç“¦å°”å“ˆæ‹‰é‡ŒğŸŒASP.NET æ ¸å¿ƒ Kentico è¿˜æ²¡æœ‰ï¼Œæˆ‘ä»¬ Kentico å¼€å‘äººå‘˜æœ‰æ—¶éœ€è¦å‘æŒ¥åˆ›é€ åŠ›ã€‚

æ„Ÿè°¢é˜…è¯»ğŸ™ï¼

* * *

å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾æ›´å¤šçš„ Kentico å†…å®¹ï¼Œè¯·åœ¨ DEV:

## # [è‚¯è’‚ç§‘](https://dev.to/t/kentico) <button name="button" type="button" data-info="{&quot;className&quot;:&quot;Tag&quot;,&quot;style&quot;:&quot;full&quot;,&quot;id&quot;:5339,&quot;name&quot;:&quot;kentico&quot;}" class="crayons-btn follow-action-button whitespace-nowrap c-btn--secondary fs-base " aria-label="Follow tag: kentico" aria-pressed="false">è·Ÿéš</button>

æˆ–è€…æˆ‘çš„ Kentico åšå®¢ç³»åˆ—:

*   [Kentico 12:è®¾è®¡æ¨¡å¼](https://dev.to/search?q=Kentico%2012%20-%20Design%20Patterns)
*   [Kentico CMS å¿«é€Ÿæç¤º](https://dev.to/search?q=Kentico%20CMS%20Quick%20Tip)