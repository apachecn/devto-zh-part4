# ä½¿ç”¨ React and Go åˆ›å»º WebAssembly åº”ç”¨ç¨‹åº

> åŸæ–‡:[https://dev . to/oayomide/create-a-web assembly-app-with-react-and-go-39j 7](https://dev.to/oayomide/create-a-webassembly-app-with-react-and-go-39j7)

# WASM å…¥é—¨ï¼Œååº”è¿‡æ¥å°±èµ°

WebAssembly å¤ªæ£’äº†â€”â€”å‡ ä¹ç®—ä¸ä¸Šä»€ä¹ˆæ–°é—»ï¼Œä½†æ˜¯å¦‚ä½•å°†å®ƒä¸ React and Go ä¸€èµ·ä½¿ç”¨å‘¢ï¼Ÿå—¯ï¼Œè€å®è¯´ï¼Œæœ‰å¾ˆå¤šèµ„æ–™å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€æ¬¡é¡ºåˆ©çš„ç»å†ã€‚æˆ‘æƒ³è¦ä¸€ç¯‡ç›´æˆªäº†å½“çš„æœ€æ–°æ–‡ç« ã€‚é¦–å…ˆï¼Œæˆ‘ä¸€ç›´åœ¨å¯»æ‰¾ä¸€ä¸ªä½¿ç”¨ Create-React-App çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºè°ä¼šæƒ³æä¹± Webpack å‘¢ï¼ŸğŸ™ƒğŸ™ƒ

è¿™ä¸ªç®€çŸ­æ•™ç¨‹çš„ç›®çš„æ˜¯å‘ä½ å±•ç¤ºæˆ‘æ˜¯å¦‚ä½•æŠŠæ‰€æœ‰çš„ä¸œè¥¿æ‹¼å‡‘åœ¨ä¸€èµ·ï¼Œå¹¶è®©ä¸€ä¸ªåŸºäº React çš„ Go ç¨‹åºç¼–è¯‘æˆ WebAssembly å¹¶è¿è¡Œçš„ã€‚æˆ‘å‡è®¾å¦‚ä¸‹:

*   æ‚¨å·²ç»å®‰è£…äº† Go(1.11 åŠæ›´é«˜ç‰ˆæœ¬)ã€‚
*   NPM/çº±çº¿å·²å®‰è£…ã€‚

æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ react çš„è¾“å…¥æ¡†ä¸­è¾“å…¥ä¸€ä¸ªå€¼ï¼Œç„¶åä½¿ç”¨ WebAssembly æ¥å‘ˆç°è¯¥å€¼ã€‚ç®€å•æœ‰è¶£å§ï¼Ÿ

[![Alt Text](img/6e816d76355f01712f76e5e020f9cce0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--WfPus55T--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/h4h0ur2eaig2lvjy0hkf.png)

åœ¨æ­¤å…‹éš†å›è´­[ã€‚å›è´­åŒ…å«è¢«å¼¹å‡ºçš„åº”ç”¨ç¨‹åºã€‚æˆ‘è¯•å›¾ä½¿è¿™ç¯‡æ–‡ç« å°½å¯èƒ½ç®€çŸ­ï¼Œè¿™æ ·æˆ‘å¯èƒ½ä¼š(æ— æ„ä¸­)é”™è¿‡ä¸€äº›ä¸œè¥¿ã€‚](https://github.com/oayomide/go-reactive)

åœ¨æ ¹ä¸­ï¼Œæˆ‘ä»¬æœ‰åŒ…å«ä»¥ä¸‹ä»£ç çš„`main.go`:

```
package main

import (
    "fmt"
    "syscall/js"
)

var c chan bool

// init is called even before main is called. This ensures that as soon as our WebAssembly module is ready in the browser, it runs and prints "Hello, webAssembly!" to the console. It then proceeds to create a new channel. The aim of this channel is to keep our Go app running until we tell it to abort.
func init() {
    fmt.Println("Hello, WebAssembly!")
    c = make(chan bool)
}

func main() {
    // here, we are simply declaring the our function `sayHelloJS` as a global JS function. That means we can call it just like any other JS function.
    js.Global().Set("sayHelloJS", js.FuncOf(SayHello))
    println("Done.. done.. done...")

    // tells the channel we created in init() to "stop".
    <-c
}

// SayHello simply set the textContent of our element based on the value it receives (i.e the value from the input box)
// the element MUST exist else it'd throw an exception
func SayHello(jsV js.Value, inputs []js.Value) interface{} {
    message := inputs[0].String()
    h := js.Global().Get("document").Call("getElementById", "message")
    h.Set("textContent", message)
    return nil
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬çš„å‡½æ•° sayHello æœ‰ä¸¤ä¸ªå‚æ•°ã€‚æˆ‘ä»¬æ›´å…³å¿ƒç¬¬äºŒç‚¹ã€‚ç¬¬äºŒä¸ªå‡½æ•°çš„æœ¬è´¨æ˜¯å®ƒæ¥å—ä¸€ä¸ª js.Value æ•°ç»„ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥ä» JavaScript ä¼ é€’ä»»æ„å¤šçš„å‚æ•°ã€‚è¦è·å¾—è¿™äº›å€¼ï¼Œæˆ‘ä»¬åªéœ€ä½¿ç”¨ç´¢å¼•ã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›è·å¾—è¾“å…¥æ¡†ä¸­è¾“å…¥çš„å€¼ã€‚

```
message := inputs[0].String() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±åƒæˆ‘ä¹‹å‰è¯´çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•°ç»„çš„ç´¢å¼•æ¥è·å–æˆ‘ä»¬æƒ³è¦çš„å€¼ã€‚

```
h := js.Global().Get("document").Call("getElementById", "message")
h.Set("textContent", message) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢çš„ä»£ç ç±»ä¼¼äº:

```
let h = document.getElementById("message")
h.textContent = message 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥æˆ‘ä»¬æ‰€åšçš„æ˜¯ç”¨ idâ€œmessageâ€å’Œè¾“å…¥å€¼æ¥æ”¹å˜å…ƒç´ çš„æ–‡æœ¬ã€‚

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¼–è¯‘`main.go` :

```
GOOS=js GOARCH=wasm go build -o ../client/public/main.wasm 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#client-side-of-things)å®¢æˆ·ç«¯çš„ä¸œè¥¿

åœ¨`App.js`ä¸­ï¼Œæˆ‘ä»¬åœ¨ componentDidMount()ä¸­æœ‰è¿™ä¸ª:

```
async componentDidMount() {
    let { instance, module } = await WebAssembly.instantiateStreaming(fetch("main.wasm"), window.go.importObject)
    await window.go.run(instance)
    this.setState({
      mod: module,
      inst: instance
    })
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æ­£åœ¨å®ä¾‹åŒ–æˆ‘ä»¬çš„`main.wasm`å¹¶è¿è¡Œå®ä¾‹ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è°ƒç”¨æˆ‘ä»¬çš„ WASM å‡½æ•°äº†ã€‚æ­¤å¤–ï¼Œå°†æ¨¡å—å’Œå®ä¾‹è®¾ç½®ä¸ºçŠ¶æ€ï¼Œä»¥é˜²æˆ‘ä»¬ä»¥åéœ€è¦å®ƒä»¬ã€‚å¦å¤–ï¼Œ**ä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬åœ¨åš`window.go.run(instance)`ã€‚**ä»å“ªé‡Œæ¥çš„ï¼Ÿå¥½å§ï¼Œå®ƒå·²ç»åœ¨ React åº”ç”¨ç¨‹åºä¸­å¤„ç†äº†ã€‚ä½ ä¼šæ³¨æ„åˆ°æœ‰ä¸€ä¸ªåŒ…å«ä¸€ä¸ª`init_js`æ–‡ä»¶çš„`wasmjs`æ–‡ä»¶å¤¹ã€‚ä½¿ç”¨ JS çš„ WASM æ–‡ä»¶æ‰€éœ€çš„è¿™ä¸ªå’Œ`wasm_exec.js`æ–‡ä»¶å·²ç»è¢«åˆ›å»ºå¹¶ä¸æˆ‘ä»¬ä½¿ç”¨ webpack çš„ React åº”ç”¨æ†ç»‘åœ¨ä¸€èµ·ã€‚**æ‰€ä»¥å®ƒå°† Go()å®ä¾‹ç»‘å®šåˆ°å…¨å±€çª—å£ã€‚å› æ­¤ï¼Œå®ƒä¸æ˜¯å£°æ˜ Go()çš„æ–°å®ä¾‹ï¼Œè€Œæ˜¯ä½œä¸ºçª—å£å¯¹è±¡å˜é‡**
å­˜åœ¨

```
 handleSubmit = async (e) => {
    e.preventDefault()
    window.sayHelloJS(this.state.message)
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯æˆ‘ä»¬è°ƒç”¨ä¹‹å‰åœ¨ Go ä»£ç ä¸­æ³¨å†Œçš„å‡½æ•° sayHelloJSï¼æ³¨æ„æˆ‘ä»¬æ˜¯ä½œä¸ºä¸€ä¸ªçª—å£å¯¹è±¡å±æ€§æ¥è®¿é—®çš„ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä» React è°ƒç”¨å®ƒã€‚å¦‚æœæˆ‘ä»¬ç§°å®ƒä¸º`sayHelloJS`ï¼Œå®ƒå°†æ˜¯æœªå®šä¹‰çš„ã€‚

```
<span id="message">
    Ayomide Onigbinde wrote this!!ğŸ˜‰...ğŸ’• from WebAssembly and Golang
</span> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æœ‰è¿™ä¸ª HTML å…ƒç´ ã€‚è¯·æ³¨æ„ï¼Œå®ƒæœ‰ä¸€ä¸ª idâ€œmessageâ€ã€‚è¿™ä¸ªå…ƒç´ æ˜¯æˆ‘ä»¬åœ¨ç¼–è¯‘æˆ WebAssembly çš„ Go ä»£ç ä¸­æ“ä½œçš„å…ƒç´ ï¼æ‰€ä»¥è¿™ä¸ªå…ƒç´ å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™å®ƒä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥çš„ä»»ä½•å€¼ï¼è€Œå®ƒçš„ WebAssembly(ç¼–è¯‘è‡ª Go)åœ¨åšè¿™ä¸ªï¼ğŸ‰ğŸ‰

æˆ‘å°½åŠ›è§£é‡Šäº†ï¼å¦‚æœæœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œè¯·è¯„è®ºï¼Œæˆ‘ä»¬ä¼šä¸€èµ·è§£å†³ğŸ˜‰ğŸ˜‰ã€‚

éå¸¸æ„Ÿè°¢äºšä¼¦çš„[æ•™ç¨‹](https://www.aaron-powell.com/posts/2019-02-06-golang-wasm-3-interacting-with-js-from-go/)å’Œéå¸¸æ„Ÿè°¢[åœ¨ LogRocket](https://github.com/Chrischuck/ai-tic-tac-toe/tree/master/client/src) çš„å…‹é‡Œæ–¯ã€‚çœŸæ˜¯æ•‘å‘½å•Šï¼[è¿™ç¯‡æ–‡ç« ](https://dev.to/brightdevs/using-webassembly-with-react-1led)ä¹Ÿæœ‰åŠ©äºç†è§£ä¸ WASM çš„å…³ç³»ã€‚