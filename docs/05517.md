# æ„å»ºä¸€ä¸ª Shell å‡½æ•°æ¥å¤åˆ¶æœ€æ–°çš„ Git Commit SHA

> åŸæ–‡:[https://dev . to/Alex MacArthur/building-a-shell-function-to-copy-the-latest-git-commit-sha-35nf](https://dev.to/alexmacarthur/building-a-shell-function-to-copy-the-latest-git-commit-sha-35nf)

æˆ‘ç»å¸¸å‘ç°è‡ªå·±éœ€è¦å¤åˆ¶é¡¹ç›®ä¸­æœ€æ–°æäº¤çš„ SHAï¼Œå¹¶ä¸”æ‰‹åŠ¨åœ°åšè¿™ä»¶äº‹å˜å¾—å¾ˆéº»çƒ¦ã€‚æˆ‘å·²ç»å¯¹é€šè¿‡æ»šåŠ¨è‡ªå®šä¹‰ shell å‡½æ•°æ¥æé«˜æ•ˆç‡æ„Ÿåˆ°è¶Šæ¥è¶Šèˆ’æœå’Œå…´å¥‹äº†([å°±åƒæˆ‘åœ¨è¿™é‡Œå†™çš„](https://dev.to/posts/formatting-my-php-more-efficiently-with-a-bash-function))ï¼Œæ‰€ä»¥è¿™æ„Ÿè§‰åƒæ˜¯å¦ä¸€ä¸ªå¾ˆå¥½çš„å€™é€‰ã€‚ç»è¿‡ä¸€ç•ªæœç´¢ï¼Œè¿™ä¸€ç‚¹å¾—åˆ°äº†è¯å®â€”â€”å¾ˆå°‘æœ‰å…¶ä»–äººæ„å»ºä¸€ä¸ªç®€å•çš„ç»ˆç«¯å‘½ä»¤æ¥åšè¿™æ ·çš„äº‹æƒ…ã€‚æ‰€ä»¥ï¼Œæˆ‘å»äº†ã€‚

**é—®é¢˜:**å¤åˆ¶æˆ‘ä¸Šä¸€æ¬¡æäº¤çš„ SHA å¾ˆéº»çƒ¦ï¼Œè€Œä¸”å¾ˆè´¹æ—¶é—´ã€‚

**è§£å†³æ–¹æ¡ˆ:**åˆ›å»ºä¸€ä¸ª shell å‡½æ•°ï¼Œå…è®¸æˆ‘ç”¨ä¸€ä¸ªç®€å•çš„ç»ˆç«¯å‘½ä»¤æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚

## [](#building-the-function)å»ºç­‘åŠŸèƒ½

æˆ‘ä¸ºæ­¤åšçš„å¤§éƒ¨åˆ†å®éªŒéƒ½æ˜¯åœ¨æˆ‘çš„æœºå™¨ä¸Šçš„å¸¸è§„ shell è„šæœ¬ä¸­å®Œæˆçš„ã€‚ä½†æ˜¯ä¸ºäº†å¿«é€Ÿæµ‹è¯•ä½œä¸ºç»ˆç«¯å‘½ä»¤çš„è„šæœ¬ï¼Œæˆ‘å°†æˆ‘çš„è¿­ä»£å¤åˆ¶åˆ°æˆ‘çš„`~/.zshrc`ä¸­ï¼Œå¹¶ç”¨`source ~/.zshrc`æ¥è·å–å®ƒã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™äº›è¿­ä»£å°±æ˜¯è¿™æ ·è¿›è¡Œçš„ã€‚

### [](#iteration-1-stupid-simple)è¿­ä»£#1::æ„šè ¢ç®€å•

è®¾ç½®è¿™ä¸ªå‡½æ•°çš„åŸºç¡€éå¸¸ç®€å•:

```
# `clc` stands for `copy last commit`.
function clc {
    LAST_COMMIT_SHA=$(git rev-parse HEAD)
    echo "$LAST_COMMIT_SHA" | tr -d '\n' | pbcopy
    echo "Copied ${LAST_COMMIT_SHA}."
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­¤æ—¶ï¼Œæˆ‘å¯ä»¥åœ¨æˆ‘çš„ç»ˆç«¯ä¸­è¿è¡Œ`clc`ï¼Œé€šè¿‡è¿™æ ·åšï¼Œè·å–æœ€åä¸€ä¸ªæäº¤ SHAï¼Œåˆ é™¤æ¢è¡Œç¬¦ï¼Œå°†å…¶å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¹¶æ˜¾ç¤ºä¸€æ¡æ¼‚äº®çš„ç¡®è®¤æ¶ˆæ¯ã€‚å®Œæˆä»»åŠ¡ï¼é…ª

### [](#iteration-2-copy-from-different-branch)è¿­ä»£#2::ä»ä¸åŒçš„åˆ†æ”¯å¤åˆ¶

å½“æˆ‘æŒ‘é€‰æ—¶ï¼Œæˆ‘ç»å¸¸æƒ³è¦ä¸åŒåˆ†æ”¯çš„æœ€æ–°æäº¤ SHAï¼Œè€Œä¸æ˜¯æˆ‘å½“å‰çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘å‡çº§äº†å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªåˆ†æ”¯åç§°ä½œä¸ºå‚æ•°ã€‚å¦‚æœè®¾ç½®äº†è¯¥å‚æ•°ï¼Œåˆ™ç­¾å‡ºè¯¥åˆ†æ”¯ï¼Œè·å–æœ€æ–°çš„æäº¤ SHAï¼Œå¹¶è¿”å›åˆ°åŸå§‹åˆ†æ”¯ã€‚

```
function clc { +    # The original script wrapped in a nested function:
+    function copy_last_commit() {
        LAST_COMMIT_SHA=$(git rev-parse HEAD)
        echo "$LAST_COMMIT_SHA" | tr -d '\n' | pbcopy
        echo "Copied ${LAST_COMMIT_SHA}."
+    }
+    
+    # Added to check out branch, if parameter is set.
+    if [ ! -z "$1" ]; then
+        if git checkout $1 >/dev/null; then
+            copy_last_commit
+            git checkout - >/dev/null
+        else
+            echo "Checkout wasn't successful. Didn't copy anything."
+        fi
+    else
+        copy_last_commit
+    fi } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œç±»ä¼¼äº`clc some-branch`çš„ä¸œè¥¿ã€‚è¿™å°†å¯¼è‡´è¯¥åˆ†æ”¯è¢«æ£€å‡º(`git checkout $1 >/dev/null`)ï¼Œå¦‚æœæˆåŠŸï¼Œå¤åˆ¶å°†å¼€å§‹ï¼Œäº§ç”Ÿå¦‚ä¸‹å†…å®¹:

```
Switched to branch 'my-branch'
Copied 3ccbd742f916659c50cbff6c2f63e2ba28a168b5.
Switched to branch 'master' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæˆ‘å¶ç„¶ä¼ é€’äº†ä¸€ä¸ªä¸å­˜åœ¨çš„åˆ†æ”¯åï¼Œè€Œå®ƒå¤±è´¥äº†ï¼Œå°±ä¼šè¾“å‡ºä¸€æ¡é”™è¯¯æ¶ˆæ¯ã€‚å½“ç„¶ï¼Œå¦‚æœæ²¡æœ‰ä¼ é€’åˆ†æ”¯å‚æ•°ï¼Œjust æ£€æŸ¥ä¼šç›´æ¥å¤åˆ¶å½“å‰åˆ†æ”¯çš„æäº¤ SHAã€‚ä½†æ˜¯ï¼

### [](#iteration-3-respect-unstaged-changes)è¿­ä»£#3::å°Šé‡æœªåˆ†çº§çš„å˜æ›´

é€šå¸¸ï¼Œæˆ‘çš„æ´»åŠ¨åˆ†æ”¯æœ‰ä¸€å †æœªåˆ†çº§çš„å˜æ›´ï¼Œè¿è¡Œè¿™ä¸ªå‘½ä»¤ä»ä¸€ä¸ªä¸åŒçš„åˆ†æ”¯è·å–é˜¿æ²™ä¼šäº§ç”Ÿè¿™ä¸ªæ¶ˆæ¯:

```
Please commit your changes or stash them before you switch branches.
Aborting
Checkout wasn't successful. Didn't copy anything. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥ï¼Œæˆ‘å†æ¬¡å‡çº§å®ƒâ€”â€”è¿™ä¸€æ¬¡ï¼Œä¸æ˜¯å®Œå…¨æ£€å‡ºåˆ†æ”¯ï¼Œè€Œæ˜¯ä½¿ç”¨`git stash`æ¥éšè—æˆ‘ä»¬çš„æ›´æ”¹å¹¶æ¢å¤å®ƒä»¬ã€‚å®ƒæ›´åŠ çµæ´»ï¼Œä¸éœ€è¦ä½ æœ‰ä¸€ä¸ªå¹²å‡€çš„å·¥ä½œç›®å½•ã€‚

åœ¨è¿™æ ·åšçš„æ—¶å€™ï¼Œé‡è¦çš„æ˜¯æˆ‘ä»¬åªåœ¨çœŸæ­£éœ€è¦çš„æ—¶å€™`stash`ã€‚å½“æ²¡æœ‰ä¸œè¥¿å¯ä»¥å­˜å‚¨æ—¶è¿è¡Œ`git stash`ï¼Œ*ä»€ä¹ˆéƒ½ä¸åš*â€”â€”æ²¡æœ‰æ–°çš„å­˜å‚¨è¢«åˆ›å»ºã€‚å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªæ–°çš„ä»“åº“æ²¡æœ‰å®é™…åˆ›å»ºçš„æ—¶å€™è‡ªåŠ¨è¿è¡Œ`git stash pop`ï¼Œæˆ‘ä»¬å¯èƒ½æœ€ç»ˆä¼šæ¢å¤ä¸€ä¸ªæˆ‘ä»¬ä¸æƒ³è¦çš„æ—§ä»“åº“(ä½ å¯ä»¥ä½¿ç”¨`git stash list`æŸ¥çœ‹ä½ çš„å›è´­ä¸­çš„æ‰€æœ‰ä»“åº“)ã€‚

æˆ‘ä½¿ç”¨`git status -s`æ‰§è¡Œäº†è¿™ä¸ªæ£€æŸ¥ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°å˜é‡`IS_DIRTY`ä¸­ã€‚å¦‚æœå·¥ä½œæ ‘æ˜¯â€œè„çš„â€ï¼Œéšè—æ›´æ”¹ï¼Œå¹¶åœ¨æˆ‘ä»¬å®Œæˆåæ¢å¤å®ƒä»¬ã€‚

```
function clc {
    # The original script wrapped in a nested function:
    function copy_last_commit() {
        LAST_COMMIT_SHA=$(git rev-parse HEAD)
        echo "$LAST_COMMIT_SHA" | tr -d '\n' | pbcopy
        echo "Copied ${LAST_COMMIT_SHA}."
    }

    # Added to check out branch, if parameter is set.
    if [ ! -z "$1" ]; then
+        IS_DIRTY=$(git status -s)
+    
+        if [[ ! -z $IS_DIRTY ]]; then
+            git stash push -u >/dev/null
+            echo "Stashed unstaged stages."
+        fi 
        if git checkout $1 >/dev/null; then
            copy_last_commit
            git checkout - >/dev/null
        else
            echo "Checkout wasn't successful. Didn't copy anything."
        fi

+        if [[ ! -z $IS_DIRTY ]]; then
+            git stash pop >/dev/null
+            echo "Restored unstaged changes."
+        fi
    else
        copy_last_commit
    fi
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› ä¸ºå®ƒè®©æˆ‘çŠ¯äº†é”™è¯¯ï¼Œæ‰€ä»¥è¦ç‰¹åˆ«æ³¨æ„ï¼Œæˆ‘æ²¡æœ‰ä½¿ç”¨ç®€å•çš„`git stash`å‘½ä»¤æ¥éšè—æˆ‘çš„æ›´æ”¹ã€‚ç›¸åï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯`git stash push -u`ã€‚è¿™æ˜¯å› ä¸ºæˆ‘æƒ³ä¿å­˜æˆ‘å½“å‰æ‰€æœ‰çš„ä¿®æ”¹ï¼ŒåŒ…æ‹¬æˆ‘åˆšåˆšåˆ›å»ºä½†è¿˜æ²¡æœ‰æäº¤çš„æ–‡ä»¶ã€‚æ›´å†—é•¿çš„`git stash push`åé¢è·Ÿç€`-u`(ä»£è¡¨`--include-untracked`)æ ‡å¿—å°±èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚

## [](#iteration-4-tear-down-amp-basically-everything)è¿­ä»£#4::æ‹†æ‰&åŸºæœ¬ä¸Šä¸€åˆ‡

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘å¯¹è‡ªå·±æ„Ÿè§‰å¾ˆå¥½ã€‚æˆ‘å·²ç»è§£å†³äº†ä¸€è·¯ä¸Šé‡åˆ°çš„æ‰€æœ‰å¥‡æ€ªçš„ shell é—®é¢˜ï¼Œå¹¶åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å‘è¡¨äº†è¿™ç¯‡åšæ–‡ã€‚

ç„¶åï¼Œå‡ ä¸ª Reddit ç”¨æˆ·(è°¢è°¢ï¼Œ[åŠªå‹’](https://www.reddit.com/user/nunull/)å’Œ[å¥¥æ–¯æ±€-è°¢å¼—](https://www.reddit.com/user/austin-schaffer/)ï¼)æŒ‡å‡ºï¼Œæˆ‘å®é™…ä¸Šå¹¶ä¸éœ€è¦*æ¥æ‰§è¡Œæ£€éªŒï¼Œåªæ˜¯ä¸ºäº†è·å¾—æäº¤ SHAã€‚è¿™åº”è¯¥æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå› ä¸ºå·²ç»åœ¨ä½¿ç”¨`git rev-parse HEAD`æ¥æ‹‰ SHAã€‚ç”¨æˆ‘éœ€è¦çš„ä»»ä½•åˆ†æ”¯æ›¿æ¢æ‰`HEAD`å°±å·²ç»å®Œæˆäº†ï¼Œå®Œå…¨ä¸éœ€è¦ä»»ä½•å¤æ‚çš„ç»“å¸å’Œå­˜å‚¨é€»è¾‘ğŸ¤¦ã€‚*

æœ‰äº†è¿™ä¸ªå¯ç¤ºï¼Œå‡½æ•°ä»æ‰€æœ‰çš„ä»£ç è¡Œå‡å°‘åˆ°åªæœ‰å‡ è¡Œ:

```
function clc {
    [[ -z $1 ]] && BRANCH=$(git rev-parse --abbrev-ref HEAD) || BRANCH=$1
    LAST_COMMIT_SHA=$(git rev-parse $BRANCH | tail -n 1)
    echo "$LAST_COMMIT_SHA" | tr -d '\n' | pbcopy
    echo "Copied ${LAST_COMMIT_SHA}."
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

çœ‹ï¼ŒReddit æ²¡é‚£ä¹ˆç³Ÿï¼å†æ¬¡æ„Ÿè°¢å–Šå‡ºè¿™å¥è¯çš„ä¸¤ä¸ªäººï¼

## [](#see-the-touched-up-final-product)è§ä¿®é¥°è¿‡çš„æœ€ç»ˆäº§å“

æˆ‘åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­æ·»åŠ äº†ä¸€äº›æ¼‚äº®çš„ç»ˆç«¯é¢œè‰²ã€‚

## [](#using-the-function)ä½¿ç”¨åŠŸèƒ½

è¦åœ¨æ‚¨çš„æœ¬åœ° shell ä¸­ä½¿ç”¨å®ƒï¼Œæ‚¨å¯ä»¥å°†å®ƒæ”¾åœ¨æ‚¨çš„`~/.bashrc`æˆ–`~/.zshrc`æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯æœ€å¥½å°†å®ƒå­˜å‚¨åœ¨ç³»ç»Ÿä¸­çš„å…¶ä»–åœ°æ–¹ã€‚æˆ‘ä¸èƒ½ä»£è¡¨`bash`çš„ç”¨æˆ·ï¼Œä½†æ˜¯å¦‚æœä½ ä½¿ç”¨çš„æ˜¯`zsh`ï¼Œé‚£ä¹ˆåªéœ€è¦æŠŠæ–‡ä»¶æ”¾åœ¨ä½ çš„`$ZSH/custom`ç›®å½•ä¸­ï¼Œç„¶åæ‰¾åˆ°å®ƒã€‚

### [](#install-as-custom-zsh-function)å®‰è£…ä¸ºè‡ªå®šä¹‰ ZSH åŠŸèƒ½

ä¸ºäº†ä½¿å®ƒå˜å¾—éå¸¸ç®€å•ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå®ƒå°†ä»æˆ‘çš„ GitHub Gist ä¸­æ£€ç´¢è¿™ä¸ªå‡½æ•°ï¼Œå¹¶æŠŠå®ƒæ”¾åˆ°é€‚å½“çš„ä½ç½®:

```
curl https://gist.githubusercontent.com/alexmacarthur/933a50c3e072baaf7b6ed18b94e0e873/raw/59f22ae740d83f39a88b70f4aebb0c27b2f9805f/copy-last-commit.zsh -o $ZSH/custom/clc.zsh 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#running-the-command)è¿è¡Œå‘½ä»¤

ä¹‹åï¼Œç”¨`source ~/.zshrc`å¯åŠ¨å®ƒï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿè¿è¡Œè¿™ä¸ªå‘½ä»¤äº†ã€‚

è¿è¡Œ`clc`å°†ä¼šè¿”å›å¦‚ä¸‹å†…å®¹:

```
Copied 3ccbd742f916659c50cbff6c2f63e2ba28a168b5 from master. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿è¡Œ`clc new-branch`å°†ä¼šè¿”å›å¦‚ä¸‹å†…å®¹:

```
Copied 3ccbd742f916659c50cbff6c2f63e2ba28a168b5 from new-branch. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#did-i-miss-something)æˆ‘é”™è¿‡äº†ä»€ä¹ˆå—ï¼Ÿ

æˆ‘ä¸ä¼šæ„Ÿåˆ°æƒŠè®¶ã€‚å¦‚æœæœ‰ä»€ä¹ˆå»ºè®®æˆ–æ”¹è¿›ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼