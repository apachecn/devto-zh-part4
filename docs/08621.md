# â€œä½¿ç”¨åé€€æŒ‰é’®â€æŒ‚é’©å¤„ç† React Native ä¸­çš„åé€€æŒ‰é’®è¡Œä¸º

> åŸæ–‡:[https://dev . to/far skid/useback button-hook-to-handle-back-button-behavior-in-react-native-3gi 8](https://dev.to/farskid/usebackbutton-hook-to-handle-back-button-behavior-in-react-native-3gi8)

[React hooks](https://reactjs.org/docs/hooks-intro.html) æœ‰åŠ©äºæºå¸¦æœ‰çŠ¶æ€é€»è¾‘ï¼Œå¹¶ä½¿å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸä¸è§†å›¾å±‚ç”Ÿå‘½å‘¨æœŸåˆ†å¼€ã€‚è‡ªä» React v16.8 ä»¥æ¥å®ƒä»¬å°±å­˜åœ¨äº†ï¼Œå› ä¸ºäººä»¬ä¸€ç›´åœ¨é¿å…ç±»ç»„ä»¶è€Œæ”¯æŒé’©å­ã€‚

é’©å­çš„ä¸€ä¸ªæœ‰è¶£çš„æ–¹é¢æ˜¯å®ƒä»¬åœ¨ç»„æˆå’ŒæŠ½è±¡æ–¹é¢çš„çµæ´»æ€§ã€‚å¦‚æœä½¿ç”¨ä¸åŒ[å†…ç½®é’©å­](https://reactjs.org/docs/hooks-reference.html)çš„ä»£ç ç‰‡æ®µæ­£åœ¨å¤„ç†ä¸å…¶ä»–éƒ¨åˆ†åˆ†ç¦»ä¸”ç‹¬ç«‹çš„é€»è¾‘éƒ¨åˆ†ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¢«æŠ½è±¡ä¸ºä¸€ä¸ª [**è‡ªå®šä¹‰é’©å­**](https://reactjs.org/docs/hooks-custom.html) ã€‚

## [](#usebackbutton-custom-hook)ä½¿ç”¨åé€€æŒ‰é’®è‡ªå®šä¹‰æŒ‚é’©

ä¸ºäº†ä½¿ç”¨ React Native å¤„ç† Android å’Œ tvOS è®¾å¤‡ä¸­ç¡¬ä»¶åé€€æŒ‰é’®çš„è¡Œä¸ºï¼Œæœ‰ [*BackHandler*](https://facebook.github.io/react-native/docs/backhandler.html) API å¯ä»¥å¸®åŠ©è¦†ç›–é»˜è®¤è¡Œä¸ºæˆ–ä¿®è¡¥å®ƒã€‚

é‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ–¹æ³•æ¥æä¾› APIï¼Œè¿™æ„å‘³ç€è¦è®¢é˜…åé€€æŒ‰é’®ï¼Œæ‚¨éœ€è¦æ³¨å†Œä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ã€‚

```
import { BackHandler } from "react-native";

function backButtonHandler() {}

BackHandler.addEventListener("hardwareBackPress", backButtonHandler); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ç„¶ï¼Œè¦å–æ¶ˆæ³¨å†Œè¿™ä¸ªè®¢é˜…ï¼Œæ‚¨éœ€è¦ä½¿ç”¨`removeListener`ï¼Œå°±åƒæˆ‘ä»¬å¤„ç† DOM äº‹ä»¶ä¸€æ ·ã€‚

```
backButtonHandler.removeEventListener("hardwareBackPress", backButtonHandler); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#use-hooks-to-utilize-backhandler)ä½¿ç”¨é’©å­æ¥åˆ©ç”¨ BackHandler

è®¢é˜…æ˜¯å‰¯ä½œç”¨ï¼å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`useEffect`å†…ç½®é’©å­æ¥æ‰§è¡Œå®ƒä»¬ã€‚éœ€è¦æ³¨æ„çš„æ˜¯`useEffect`è¦æ±‚æˆ‘ä»¬è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œä¸€æ—¦ React æ„¿æ„æ¸…ç†ï¼Œå°±åˆ é™¤è®¢é˜…ï¼å½“ç»„ä»¶è¢«å¸è½½æˆ–è€…`useEffect`é’©å­çš„ä¸€ä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶ï¼Œé€šå¸¸éœ€è¦æ¸…ç†ï¼Œæ‰€ä»¥ React éœ€è¦æ¸…ç†é’©å­ä»¥å‰çš„è®¢é˜…å¹¶é‡æ–°æ‰§è¡Œå®ƒï¼

[åœ¨*ä½¿ç”¨æ•ˆæœ*](https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup)
é˜…è¯»æ›´å¤šå…³äºè®¢é˜…å’Œæ¸…ç†çš„ä¿¡æ¯

```
function backButtonHandler() {}

function MyComponent() {
  useEffect(() => {
    BackHandler.addEventListener("hardwareBackPress", backButtonHandler);

    return () => {
      BackHandler.removeEventListener("hardwareBackPress", backButtonHandler);
    };
  }, [backButtonHandler]);

  return <View>...</View>;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#usebackbutton-is-born)useBackButton è¯ç”Ÿï¼

è™½ç„¶ä¸Šé¢çš„ä»£ç ç‰‡æ®µè¿è¡Œå¾—å¾ˆå®Œç¾ï¼Œä½†æ˜¯å°†å®ƒå¤åˆ¶ç²˜è´´åˆ°æ‰€æœ‰çš„å±å¹•ä¸Šå¯èƒ½ä¼šè®©æˆ‘ä»¬ä¸­çš„ä¸€äº›äººæ„Ÿåˆ°æ²®ä¸§(æ¯•ç«Ÿæˆ‘ä»¬æ˜¯æ€ªäºº)ï¼ä¸ºäº†å¸®åŠ©æ¶ˆé™¤æˆ‘ä»¬çš„æŒ«æŠ˜æ„Ÿï¼ŒReact æä¾›äº†ä¸€ç§æ–¹æ³•æ¥å»ºç«‹æ‚¨çš„è‡ªå®šä¹‰æŒ‚é’©ã€‚

```
/* ComponentA */
function backButtonHandlerForA() {}
function ComponentA() {
  // Frustration begins!
  useEffect(() => {
    BackHandler.addEventListener("hardwareBackPress", backButtonHandlerForA);

    return () => {
      BackHandler.removeEventListener(
        "hardwareBackPress",
        backButtonHandlerForA
      );
    };
  }, [backButtonHandlerForA]);

  return <ViewA />;
}

/* ComponentB */
function backButtonHandlerForB() {}
function ComponentB() {
  // Frustration begins!
  useEffect(() => {
    BackHandler.addEventListener("hardwareBackPress", backButtonHandlerForB);

    return () => {
      BackHandler.removeEventListener(
        "hardwareBackPress",
        backButtonHandlerForB
      );
    };
  }, [backButtonHandlerForB]);

  return <ViewB />;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è‡ªå®šä¹‰é’©å­åªæ˜¯åœ¨ç»„ä»¶å’Œé’©å­ä¹‹é—´å…±äº«ç›¸åŒé€»è¾‘çš„æŠ½è±¡ï¼Œå°±åƒæˆ‘ä»¬åœ¨å¸¸è§„ç¼–ç¨‹ä¸­åœ¨å‡½æ•°ä¹‹é—´åšçš„ä¸€æ ·ã€‚
ç»„ä»¶æ˜¯åŠŸèƒ½ã€‚é’©å­ä¹Ÿæ˜¯å‡½æ•°ã€‚ä½ æ˜ç™½äº†ï¼Œå¯¹å§ï¼Ÿï¼

åœ¨ä¸Šè¿°*ç»„ä»¶ A* å’Œ*ç»„ä»¶ B* æ ·æœ¬çš„æƒ…å†µä¸‹ï¼Œæ³¨å†Œã€ç§»é™¤å’ŒæŒ‚é’©å®ç°æ˜¯ç›¸åŒçš„ã€‚åªæ˜¯æ¯ä¸ªç»„ä»¶çš„å¤„ç†ç¨‹åºå¯èƒ½ä¸åŒã€‚æ‰€ä»¥æˆ‘ä»¬çš„å®šåˆ¶é’©å­éœ€è¦æä¾›é‚£äº›å…¬å…±éƒ¨åˆ†ï¼Œå¹¶ä¸”åªæ¥å—å˜åŒ–çš„éƒ¨åˆ†(æ¯ä¸ªç»„ä»¶çš„å¤„ç†ç¨‹åº)ä½œä¸ºä¼ å…¥å‚æ•°ã€‚

```
/* useBackButton */
function useBackButton(handler) {
  // Frustration isolated! Yay! ğŸ‰
  useEffect(() => {
    BackHandler.addEventListener("hardwareBackPress", handler);

    return () => {
      BackHandler.removeEventListener(
        "hardwareBackPress",
        handler
      );
    };
  /* now that the handler is an external dependency, once handler 
    changes, we wanna be able to reflect that change and update the 
    handler inside our hook too. so we need to pass handler as a 
    dependency to our custom hook
  */
  }, [handler]);
}

/* ComponentA */
function backButtonHandlerForA() {}
function ComponentA() {
  // utilize custom hook
  useBackButtton(backButtonHandlerForA);
  return <ViewA />;
}

/* ComponentB */
function backButtonHandlerForB() {}
function ComponentB() {
  // utilize custom hook
  useBackButtton(backButtonHandlerForB);

  return <ViewB />;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#recap)é‡è¿°

å¦‚æœæ‚¨æ‰“ç®—åœ¨ç»„ä»¶å’Œå†…ç½®æŒ‚é’©ä¹‹é—´å…±äº«ä¸€ä¸ªå…¬å…±é€»è¾‘ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ„å»ºæ‚¨çš„è‡ªå®šä¹‰æŒ‚é’©æ¥å°†å…¶æŠ½è±¡å‡ºæ¥ã€‚è¯·åŠ¡å¿…é˜…è¯»ä»¤äººå°è±¡æ·±åˆ»çš„è¯¦ç»†æ–‡ä»¶çš„é’©å­å’Œ**è§„åˆ™çš„é’©å­**ä»å®˜æ–¹æ–‡ä»¶ã€‚

å¹²æ¯ï¼