# ç”¨ Python (Pyodide)å’Œ WebAssembly åˆ›å»º Dev çš„ç¦»çº¿é¡µé¢ğŸ¦„ğŸ’¡âœ¨

> åŸæ–‡:[https://dev . to/sayanarijit/create-dev-s-offline-page-with-python-pyodide-and-web assembly-241h](https://dev.to/sayanarijit/create-dev-s-offline-page-with-python-pyodide-and-webassembly-241h)

å—è¿™ç¯‡æ–‡ç« çš„å¯å‘:

[![sendilkumarn](../Images/75ababb1cfcd601b558af3fa3f9c9e35.png)](/sendilkumarn) [## ç”¨(å¾®å°çš„)GO å’Œ WebAssembly åˆ›å»º Dev çš„ç¦»çº¿é¡µé¢ğŸ¦„ğŸ’¡âœ¨

### sendil Kumar 7 æœˆ 6 æ—¥ 194 åˆ†é’Ÿé˜…è¯»

#go #webassembly #showdev](/sendilkumarn/create-dev-s-offline-page-with-tiny-go-and-webassembly-9n6)

æˆ‘å†³å®šç”¨ Python è¯•ä¸€è¯•ã€‚

è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å†™æˆ‘æƒ³åšå¾ˆä¹…çš„ WebAssemblyã€‚ä¸ºæ­¤ï¼Œæˆ‘ä½¿ç”¨äº† [Pyodide](https://github.com/iodide-project/pyodide) ã€‚

## [](#lets-get-started)æˆ‘ä»¬å¼€å§‹å§

é¦–å…ˆ[ä¸‹è½½ Pyodide](https://github.com/iodide-project/pyodide/releases) ï¼Œè§£å‹å¹¶å¤åˆ¶`pyodide.js`æ–‡ä»¶åˆ°ä½ å½“å‰çš„ç›®å½•ä¸‹ã€‚

ç°åœ¨æˆ‘ä»¬æŠŠæœåŠ¡å™¨å†™åœ¨`server.py`é‡Œã€‚

```
from http.server import BaseHTTPRequestHandler, HTTPServer

class HTTPRequestHandler(BaseHTTPRequestHandler):
    """Request handler class"""

    def do_GET(self):
        """Handler for GET requests."""

        # Send response status code
        self.send_response(200)

        # Send headers
        self.send_header("Cache-Control", "no-cache")

        if self.path.endswith(".wasm"):
            # Header to serve .wasm file
            self.send_header("Content-Type", "application/wasm")
        else:
            self.send_header("Content-Type", "text/html")

        self.end_headers()

        # Serve the file contents
        urlpath = self.path
        if urlpath == "/":
            urlpath = "/index.html"

        with open(f".{urlpath}", "rb") as f:
            content = f.read()

        self.wfile.write(content)

def main():
    print("starting server...")

    # Server settings
    server_address = ("localhost", 8080)
    httpd = HTTPServer(server_address, HTTPRequestHandler)

    print("running server...")
    httpd.serve_forever()

if __name__ == "__main__":
    main() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

äºæ˜¯æˆ‘ä»¬æœ‰äº†`pyodide.js`ã€`server.py`ã€‚

è®©æˆ‘ä»¬æŠŠ`index.html`å†™æˆ

```
<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <title>Python wasm</title>
   </head>
   <body>
      <script src="pyodide.js"></script>
      <div id="status">Initializing Python...</div>
      <canvas id="draw-here"></canvas>
      <style>
         .color {
         display: inline-block;
         width: 50px;
         height: 50px;
         border-radius: 50%;
         cursor: pointer;
         margin: 10px;
         }
      </style>
      <div id="colors" style="text-align:center"></div>
      <script>
        window.languagePluginUrl = "/pyodide.js";
        languagePluginLoader.then(() => {
          pyodide.runPython(` ! Python code goes here ! `)
        })
      </script>
   </body>
</html> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è®©æˆ‘ä»¬ä¸º canvas ç¼–å†™ Python ä»£ç ã€‚

```
from js import document as doc

# Make the "Initializing Python" status disappear doc.getElementById("status").innerHTML = ""

canvas = doc.getElementById("draw-here")

canvas.setAttribute("width", doc.body.clientWidth)
canvas.setAttribute("height", 300)
ctx = canvas.getContext("2d")
ctx.strokeStyle = "#F4908E"
ctx.lineJoin = "round"
ctx.lineWidth = 5

# Global variables pen = False
lastPoint = (0, 0)

def onmousemove(e):
    global lastPoint

    if pen:
        newPoint = (e.offsetX, e.offsetY)
        ctx.beginPath()
        ctx.moveTo(lastPoint[0], lastPoint[1])
        ctx.lineTo(newPoint[0], newPoint[1])
        ctx.closePath()
        ctx.stroke()
        lastPoint = newPoint

def onmousedown(e):
    global pen, lastPoint
    pen = True
    lastPoint = (e.offsetX, e.offsetY)

def onmouseup(e):
    global pen
    pen = False

canvas.addEventListener("mousemove", onmousemove)
canvas.addEventListener("mousedown", onmousedown)
canvas.addEventListener("mouseup", onmouseup)

# Colors 
div = doc.getElementById("colors")
colors = ["#F4908E", "#F2F097", "#88B0DC", "#F7B5D1", "#53C4AF", "#FDE38C"]

for c in colors:
    node = doc.createElement("div")
    node.setAttribute("class", "color")
    node.setAttribute("id", c)
    node.setAttribute("style", f"background-color: {c}")

    def setColor(e):
        ctx.strokeStyle = e.target.id

    node.addEventListener("click", setColor)
    div.appendChild(node) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ AJAX è·å–æ–‡æœ¬å½¢å¼çš„ä»£ç ï¼Œå¹¶ä½¿ç”¨`pyodide.runPython(code)`æ‰§è¡Œã€‚

ä½†ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ç›´æ¥æŠŠä»£ç ç²˜è´´åœ¨`index.html`ä¸­ã€‚

* * *

æ‰€ä»¥æœ€ç»ˆç‰ˆæœ¬çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <title>Python wasm</title>
   </head>
   <body>
      <script src="pyodide.js"></script>
      <div id="status">Initializing Python...</div>
      <canvas id="draw-here"></canvas>
      <style>
         .color {
         display: inline-block;
         width: 50px;
         height: 50px;
         border-radius: 50%;
         cursor: pointer;
         margin: 10px;
         }
      </style>
      <div id="colors" style="text-align:center"></div>
      <script>
         window.languagePluginUrl = "/pyodide.js";
         languagePluginLoader.then(() => {
           pyodide.runPython(`
from js import document as doc

# Make the "Initializing Python" status disappear
doc.getElementById("status").innerHTML = ""

canvas = doc.getElementById("draw-here")

canvas.setAttribute("width", doc.body.clientWidth)
canvas.setAttribute("height", 300)
ctx = canvas.getContext("2d")
ctx.strokeStyle = "#F4908E"
ctx.lineJoin = "round"
ctx.lineWidth = 5

# Global variables
pen = False
lastPoint = (0, 0)

def onmousemove(e):
    global lastPoint

    if pen:
        newPoint = (e.offsetX, e.offsetY)
        ctx.beginPath()
        ctx.moveTo(lastPoint[0], lastPoint[1])
        ctx.lineTo(newPoint[0], newPoint[1])
        ctx.closePath()
        ctx.stroke()
        lastPoint = newPoint

def onmousedown(e):
    global pen, lastPoint
    pen = True
    lastPoint = (e.offsetX, e.offsetY)

def onmouseup(e):
    global pen
    pen = False

canvas.addEventListener("mousemove", onmousemove)
canvas.addEventListener("mousedown", onmousedown)
canvas.addEventListener("mouseup", onmouseup)

# Colors

div = doc.getElementById("colors")
colors = ["#F4908E", "#F2F097", "#88B0DC", "#F7B5D1", "#53C4AF", "#FDE38C"]

for c in colors:
    node = doc.createElement("div")
    node.setAttribute("class", "color")
    node.setAttribute("id", c)
    node.setAttribute("style", f"background-color: {c}")

    def setColor(e):
        ctx.strokeStyle = e.target.id

    node.addEventListener("click", setColor)
    div.appendChild(node)
           `)
         })
      </script>
   </body>
</html> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬åªéœ€è¦ç”¨`python server.py`è¿è¡Œ webserverï¼Œæ‰“å¼€ [http://localhost:8080](http://localhost:8080)

å¦‚æœä½ æœ‰å›°éš¾ï¼Œ[è¿™é‡Œæ˜¯å®Œæ•´çš„é¡¹ç›®](https://github.com/sayanarijit/pyodide-dev-offline-page)ã€‚