# ä¸ react æŒ‚é’©â€”â€”ä½¿ç”¨ React è·¯ç”±å™¨åˆ›å»ºå›¾ä¹¦è¯¦æƒ…é¡µé¢ï¼Œç¬¬ 4 éƒ¨åˆ†

> åŸæ–‡:[https://dev . to/param Harrison/hooked-with-react-creating-book-details-page-using-react-router-part-4-2 PCP](https://dev.to/paramharrison/hooked-with-react-creating-book-details-page-using-react-router-part-4-2pcp)

æˆ‘ä»¬å·²ç»ä¸ºå›¾ä¹¦æœç´¢é¡µé¢åˆ›å»ºäº†å›¾ä¹¦åˆ—è¡¨é¡µé¢ã€‚ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨ react router ä¸ºæ¯æœ¬ä¹¦åˆ›å»ºå¦ä¸€ä¸ªé¡µé¢ã€‚

ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹è¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œ

[https://codesandbox.io/embed/rl20opm2l4](https://codesandbox.io/embed/rl20opm2l4)

## [](#creating-books-detail-page)åˆ›å»ºå›¾ä¹¦æ˜ç»†é¡µé¢

é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ App.js ä¸­çš„ react router åˆ›å»ºè·¯ç”±ï¼Œå¹¶åŠ è½½ä¸¤ä¸ªé¡µé¢

*   ç´¢å¼•é¡µï¼Œè¿™æ˜¯æˆ‘ä»¬å½“å‰çš„æœç´¢é¡µé¢ï¼Œæ˜¾ç¤ºå›¾ä¹¦åˆ—è¡¨
*   å°†é€šè¿‡å”¯ä¸€ ID æ ‡è¯†çš„å›¾ä¹¦è¯¦ç»†ä¿¡æ¯é¡µé¢

å°†æˆ‘ä»¬æ‰€æœ‰çš„é€»è¾‘ç§»åˆ°ç´¢å¼•é¡µã€‚åˆ›å»ºä¸€ä¸ªåä¸º`pages`çš„æ–°æ–‡ä»¶å¤¹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåä¸º`searchPage.js`
çš„æ–‡ä»¶

```
import React, { useState } from 'react';
import axios from 'axios';

import BookSearchForm from '../components/bookSearchForm';
import Loader from '../components/loader';
import BooksList from '../components/booksList';

const SearchPage = () => {
  const [searchTerm, setSearchTerm] = useState('');
  const [books, setBooks] = useState({ items: [] });
  const [error, setError] = useState(false);
  const [loading, setLoading] = useState(false);

  let API_URL = `https://www.googleapis.com/books/v1/volumes`;

  const fetchBooks = async () => {
    setLoading(true);
    setError(false);
    try {
      const result = await axios.get(`${API_URL}?q=${searchTerm}`);
      setBooks(result.data);
    } catch (error) {
      setError(true);
    }
    setLoading(false);
  };

  const onInputChange = e => {
    setSearchTerm(e.target.value);
  };

  const onSubmitHandler = e => {
    e.preventDefault();
    fetchBooks();
  };

  return (
    <>
      <BookSearchForm
        onSubmitHandler={onSubmitHandler}
        onInputChange={onInputChange}
        searchTerm={searchTerm}
        error={error}
      />
      <Loader searchTerm={searchTerm} loading={loading} />
      <BooksList books={books} />
    </>
  );
};

export default SearchPage; 
```

å¹¶é‡æ„`App.js`æ–‡ä»¶

```
import React from 'react';

import SearchPage from './pages/searchPage.js';
import './App.css';

const App = () => {
  return (
    <>
      <SearchPage />
    </>
  );
};

export default App; 
```

æ·»åŠ `react-router-dom`åŒ…å¹¶é€šè¿‡è·¯ç”±
å‘ˆç°æœç´¢é¡µé¢

```
yarn add react-router-dom 
```

```
import React from 'react';
import { BrowserRouter as Router, Route, Switch } from 'react-router-dom';
import SearchPage from './pages/searchPage.js';
import './App.css';

const NoMatchRoute = () => <div>404 Page</div>;const App = () => {
  return (
    <Router> <Switch> <Route path="/" exact component={SearchPage} /> <Route component={NoMatchRoute} /> </Switch> </Router> );
};

export default App; 
```

è®©æˆ‘ä»¬åˆ›å»ºè¯¦ç»†é¡µé¢ï¼Œå¹¶é€šè¿‡ react è·¯ç”±å™¨è¿›è¡Œè·¯ç”±ã€‚åœ¨`pages`æ–‡ä»¶å¤¹
ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶`bookDetailPage.js`

```
import React from 'react';

const BookDetailPage = () => {
  return <div>Book details page</div>;
};

export default BookDetailPage; 
```

å°†è·¯çº¿æ·»åŠ åˆ°`App.js`ã€‚åœ¨è¿™é‡Œï¼Œè·¯å¾„å°†å…·æœ‰è·¯ç”±å‚æ•°`bookId`æ¥é€šè¿‡ ID è¯†åˆ«å›¾ä¹¦ã€‚

```
<Route path="/book/:bookId" exact component={BookDetailPage} /> 
```

ç°åœ¨é€šè¿‡ react-router å‘é€çš„ props è·å–`BookDetailPage`ä¸­çš„å›¾ä¹¦ IDã€‚å¦‚æœä½ æƒ³äº†è§£å®ƒå¦‚ä½•å·¥ä½œçš„ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒæˆ‘åœ¨ react è·¯ç”±å™¨ä¸­å…³äº[åŠ¨æ€é¡µé¢çš„åšæ–‡ã€‚](https://dev.to/blog/dynamic-pages-in-react-router/)

è·¯çº¿å‚æ•°é€šè¿‡ä¸€ä¸ªå«åš`match`çš„é“å…·å‘é€ã€‚

```
import React from 'react';

const BookDetailPage = ({ match }) => {
  const {
    params: { bookId },
  } = match;

  return (
    <div>
      Book details page: <strong>{bookId}</strong>
    </div>
  );
};

export default BookDetailPage; 
```

## [](#link-the-details-page-from-books-list-component)é“¾æ¥æ¥è‡ªå›¾ä¹¦åˆ—è¡¨ç»„ä»¶çš„è¯¦ç»†ä¿¡æ¯é¡µé¢

æ·»åŠ ä¸€ä¸ªé“¾æ¥ï¼Œè½¬åˆ°`BooksList`ç»„ä»¶ä¸­çš„è¯¦ç»†ä¿¡æ¯é¡µé¢ã€‚

```
import { Link } from "react-router-dom";

...

<Link to={`/book/${book.id}`}>Show details</Link> 
```

> ä½¿ç”¨`Link`æ˜¯å› ä¸ºï¼Œå®ƒä½¿ç”¨å®¢æˆ·ç«¯è·¯ç”±ã€‚HTML `a`æ ‡ç­¾å°†åˆ·æ–°é¡µé¢å¹¶ç‚¹å‡»æœåŠ¡å™¨æ¥åŠ è½½æ–°çš„ URL

å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†é¡µé¢ä¹‹é—´çš„é“¾æ¥ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¯¦ç»†ä¿¡æ¯é¡µé¢ä¸­æ˜¾ç¤ºè¿™æœ¬ä¹¦çš„è¯¦ç»†ä¿¡æ¯ã€‚ä¸ºæ­¤ï¼Œ

*   æˆ‘ä»¬éœ€è¦ç”¨ book ID è°ƒç”¨ APIï¼Œè·å–è¯¦ç»†ä¿¡æ¯å¹¶å‘ˆç°è¾“å‡ºã€‚è®©æˆ‘ä»¬å¼€å§‹å§ã€‚
*   åœ¨è°ƒç”¨ API æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®`loading`çŠ¶æ€ã€‚
*   å¦‚æœ API æŠ›å‡ºé”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®`error`çŠ¶æ€ã€‚
*   å¦‚æœ API è¿”å›å†…å®¹ï¼Œåˆ™è®¾ç½®`book`çŠ¶æ€ã€‚

è¿™æ˜¯å›¾ä¹¦è¯¦ç»†ä¿¡æ¯é¡µé¢çš„ä»£ç ï¼Œ

*   å®ƒåªåœ¨é¡µé¢æŒ‚è½½æ—¶ä½¿ç”¨`useEffect` react é’©å­æ¥è°ƒç”¨å›¾ä¹¦ç»†èŠ‚ APIã€‚è¦äº†è§£æ›´å¤šå…³äº useEffect hook çš„ä¿¡æ¯ï¼Œè¯·ç‚¹å‡»æŸ¥çœ‹å®˜æ–¹æ–‡ä»¶ã€‚

```
import React, { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import axios from 'axios';

import BookDetail from '../components/bookDetail';

const BookDetailPage = ({ match }) => {
  const {
    params: { bookId },
  } = match;
  const [book, setBook] = useState(null);
  const [error, setError] = useState(false);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    const API_BASE_URL = `https://www.googleapis.com/books/v1/volumes`;
    const fetchBook = async () => {
      setLoading(true);
      setError(false);
      try {
        const result = await axios.get(`${API_BASE_URL}/${bookId}`);
        setBook(result.data);
      } catch (error) {
        setError(true);
      }
      setLoading(false);
    };
    // Call the API
    fetchBook();
  }, [bookId]);

  return (
    <>
      <Link to={`/`}>Go back to search books</Link>
      {loading && (
        <div style={{ color: `green` }}>
          loading book detail for book ID: <strong>{bookId}</strong>
        </div>
      )}
      {error && (
        <div style={{ color: `red` }}>
          some error occurred, while fetching api
        </div>
      )}
      {book && <BookDetail book={book} />}
    </>
  );
};

export default BookDetailPage; 
```

å®ƒä½¿ç”¨ä¸€ä¸ªæ–°çš„ç»„ä»¶`BookDetail`æ¥å‘ˆç°ä¹¦ç±çš„ç»†èŠ‚ã€‚`bookDetail.js`åŒ…å«

```
import React from 'react';

import { bookAuthors } from '../utils';

const BookDetail = ({ book }) => {
  const createDescMarkup = description => {
    return { __html: description };
  };

  return (
    <section>
      <div>
        <img
          alt={`${book.volumeInfo.title} book`}
          src={`http://books.google.com/books/content?id=${book.id}&printsec=frontcover&img=1&zoom=1&source=gbs_api`}
        />
        <div>
          <h3>
            <strong>Title:</strong> {book.volumeInfo.title}
          </h3>
          <p>
            <strong>Authors:</strong> {bookAuthors(book.volumeInfo.authors)}
          </p>
          <p>
            <strong>Published Date:</strong> {book.volumeInfo.publishedDate}
          </p>
          <p>
            <strong>Publisher:</strong> {book.volumeInfo.publisher}
          </p>
          <p>
            <strong>Page Count:</strong> {book.volumeInfo.pageCount}
          </p>
          <div
            dangerouslySetInnerHTML={createDescMarkup(
              book.volumeInfo.description
            )}
          />
        </div>
      </div>
    </section>
  );
};

export default BookDetail; 
```

ç°åœ¨æˆ‘ä»¬å·²ç»æˆåŠŸåœ°æ¸²æŸ“äº†æ•´ä¸ªé¡µé¢ã€‚ä½ å¯ä»¥å›åˆ°æœç´¢é¡µé¢ï¼Œæœç´¢ä»»ä½•ä¹¦ç±ï¼Œå¹¶æ£€æŸ¥å®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ã€‚

åœ¨è¿™é‡Œå°è¯•ä¸€ä¸‹ï¼Œ

[https://codesandbox.io/embed/books-detail-page-by2nj](https://codesandbox.io/embed/books-detail-page-by2nj)

ä¼™è®¡ä»¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ ·å¼å’Œæµ‹è¯•æ¥è¿›ä¸€æ­¥æ‰©å±•è¿™äº›åº”ç”¨ç¨‹åºã€‚æˆ‘è¦ä¹ˆç»§ç»­å†™ï¼Œè¦ä¹ˆå¾ˆå¿«ä½œä¸ºå•ç‹¬çš„åšå®¢æ–‡ç« ğŸ˜

åœ¨è¿™é‡ŒæŸ¥çœ‹ç¬¬ 4 éƒ¨åˆ†[çš„ä»£ç åº“ï¼Œåœ¨è¿™é‡Œ](https://github.com/learnwithparam/books-series-react-hooks/commit/de644a750b935268c085cc83d5771a9b88e17432)æŸ¥çœ‹æ•´ä¸ªç³»åˆ—çš„ä»£ç åº“[ã€‚](https://github.com/learnwithparam/books-series-react-hooks)

### [](#stay-in-touch)ä¿æŒè”ç³»ï¼

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥åœ¨ [Twitter](https://twitter.com/learnwithparam) ä¸Šæ‰¾åˆ°æˆ‘ï¼Œäº†è§£æ›´æ–°ã€å…¬å‘Šå’Œæ–°é—»ã€‚ğŸ¤