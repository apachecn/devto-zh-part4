# GitHub æ–°ä»£ç å¯¼èˆªèƒŒåçš„ä»£ç 

> åŸæ–‡:[https://dev . to/codenamev/the-code-behind-github-s-new-code-navigation-c1n](https://dev.to/codenamev/the-code-behind-github-s-new-code-navigation-c1n)

GitHub [æœ€è¿‘å®£å¸ƒäº†ä¸¤ä¸ªæ–°çš„ä»£ç å¯¼èˆªç‰¹æ€§](https://help.github.com/en/articles/navigating-code-on-github):

1.  è·³è½¬åˆ°å®šä¹‰â€“å¿«é€ŸæŸ¥çœ‹ä»»ä½•ç»™å®šæ–¹æ³•çš„æºä»£ç ã€‚
2.  æŸ¥æ‰¾æ‰€æœ‰å¼•ç”¨â€“è¯†åˆ«åŒä¸€ä¸ª repo ä¸­æŸä¸ªå‡½æ•°çš„æ‰€æœ‰å¼•ç”¨ã€‚

[![The code behind GitHub's new Code Navigation](../Images/84365882fae528246700dd1c7d73a387.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s---RYyQaQO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.codenamev.com/content/images/2019/08/jump-to-definition-tab.png)

æˆ‘å·²ç»ç­‰è¿™äº›åŠŸèƒ½å‡ºç°å¾ˆä¹…äº†ï¼Œæœ€æ£’çš„æ˜¯ï¼Œæ‰€æœ‰è¿™äº›èƒŒåçš„ä»£ç éƒ½æ˜¯å¼€æºçš„ï¼

ä»é¡¶å±‚å¼€å§‹ï¼Œä»–ä»¬ä½¿ç”¨ä¸€ä¸ªåä¸º [Semantic](https://github.com/github/semantic) çš„ Haskell åº“ã€‚è¯­ä¹‰å¯ä»¥*è§£æ*ã€*åˆ†æ*ã€*æ¯”è¾ƒ*æºä»£ç ã€‚æˆªæ­¢åˆ°è¿™ç¯‡æ–‡ç« çš„æœ€åä¸€æ¬¡æ›´æ–°ï¼Œå®ƒæ”¯æŒ Rubyã€JavaScriptã€TypeScriptã€Pythonã€Goã€PHPã€Javaã€JSONã€JSXã€Haskell å’Œ Markdownã€‚

å¦‚éœ€å®Œæ•´çš„ç¤ºä¾‹åˆ—è¡¨ï¼Œè¯·æŸ¥çœ‹[è¯­ä¹‰ç”¨æ³•æ–‡æ¡£](https://github.com/github/semantic/blob/master/docs/examples.md)ã€‚å®ƒé™„å¸¦äº†ä¸€ä¸ªå¾ˆæ£’çš„ CLIï¼Œå…è®¸æ‚¨:

### [](#generate-parse-trees)ç”Ÿæˆè§£ææ ‘

<figure>

```
$ semantic parse test.A.py
(Statements
  (Annotation
    (Function
      (Identifier)
      (Identifier)
      (Return
        (Identifier)))
    (Empty))
  (Call
    (Identifier)
    (Call
      (Identifier)
      (TextElement)
      (Empty))
    (Empty))) 
```

<figcaption>Generate an abstract syntax tree (AST)</figcaption>

</figure>

### [](#generate-syntax-aware-diffs)ç”Ÿæˆè¯­æ³•æ„ŸçŸ¥å·®å¼‚

```
$ semantic diff test.A.py test.B.py
(Statements
  (Annotation
    (Function
    { (Identifier)
    ->(Identifier) }
      (Identifier)
      (Return
        (Identifier)))
    (Empty))
  (Call
    (Identifier)
    (Call
    { (Identifier)
    ->(Identifier) }
      (TextElement)
      (Empty))
    (Empty))) 
```

### [](#display-import-call-graphs)æ˜¾ç¤ºå¯¼å…¥è°ƒç”¨å›¾

```
semantic graph main.py | dot -Tsvg > main.html && open main.html 
```

[![The code behind GitHub's new Code Navigation](../Images/c123093655954ecac76ae7f20e4e2ed6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xFeI-4Ru--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.codenamev.com/content/images/2019/08/import_graph.svg)

### [](#display-call-graphs)æ˜¾ç¤ºé€šè¯å›¾è¡¨

```
semantic graph --calls main.py | dot -Tsvg > main.html && open main.html 
```

[![The code behind GitHub's new Code Navigation](../Images/7a6a5f2b11cfe8793bcf5dbac3693db8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--WBtf176C--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.codenamev.com/content/images/2019/08/call_graph.svg)

## ç†è§£ä½ çš„ä»£ç 

ä»£ç è§£ææ˜¯é€šè¿‡ [tree-sitter](https://github.com/tree-sitter/tree-sitter) åº“å®Œæˆçš„ï¼Œè¿™ä¸ªåº“çœ‹èµ·æ¥æ˜¯ C è¯­è¨€ï¼Œå¸¦æœ‰ä¸€äº›è¯­è¨€ç»‘å®š([CLI å·²ç»è¿‡æ—¶äº†](https://github.com/tree-sitter/tree-sitter/tree/master/cli)ï¼).

> [Tree-sitter]å¯ä»¥ä¸ºæºæ–‡ä»¶æ„å»ºå…·ä½“çš„è¯­æ³•æ ‘ï¼Œå¹¶åœ¨æºæ–‡ä»¶è¢«ç¼–è¾‘æ—¶æœ‰æ•ˆåœ°æ›´æ–°è¯­æ³•æ ‘

é€šè¿‡ç¼–å†™ç‰¹å®šäºè¯­è¨€çš„è§£æå™¨æ¥æ”¯æŒè¯­è¨€ã€‚è¿™äº›è§£æå™¨ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆ:

1.  **è¯­æ³•**â€“åŒ…å«å„ç§è¯­è¨€æ ¼å¼åŒ–çš„è§„åˆ™
2.  **è¯æ³•åˆ†æ**â€”â€”æ¨¡å¼åŒ–å•ä¸ªå­—ç¬¦ç»„(ç”¨äº[è¯æ³•](https://en.wikipedia.org/wiki/Lexical_analysis))ã€‚

è§£ææ¥è‡ª [tree-sitter-ruby](https://github.com/tree-sitter/tree-sitter-ruby) :
çš„ç®€å• ruby æ–¹æ³•çš„è¯­æ³•ç¤ºä¾‹

<figure>

```
{
  "name": "ruby",
  "word": "identifier",
  "rules": {
    "method": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": "def"
        },
        {
          "type": "SYMBOL",
          "name": "_method_rest"
        }
      ]
    }
  }
} 
```

<figcaption>[https://github.com/tree-sitter/tree-sitter-ruby/blob/master/src/grammar.json](https://github.com/tree-sitter/tree-sitter-ruby/blob/master/src/grammar.json#L5-L46)</figcaption>

</figure>

Tree-sitter æœ‰[ä¸€ä¸ª*ä»¤äººæ•¬ç•çš„*æ¸¸ä¹åœº](http://tree-sitter.github.io/tree-sitter/playground)ï¼Œåœ¨é‚£é‡Œä½ å¯ä»¥æ¢ç´¢å®ƒä¸ºä»»ä½•ç»™å®šä»£ç ç”Ÿæˆçš„è§£ææ ‘ã€‚

å½“ä½ å‘è¯­ä¹‰åº“æä¾›ä»£ç æ—¶ï¼Œå®ƒä½¿ç”¨ tree-sitter ç”Ÿæˆè§£ææ ‘ï¼Œç„¶åä½¿ç”¨[è¯­è¨€çš„è¯­æ³•](https://github.com/github/semantic/blob/master/docs/grammar-development-guide.md)(ä¾‹å¦‚æ¥è‡ª tree-sitter-ruby)è§£æè§£ææ ‘å¹¶æ˜ å°„ AST èŠ‚ç‚¹(å…¶ä¸­è®¸å¤šå·²ç»å¯ä»¥ä»åº“æœ¬èº«è·å¾—:[æ–‡å­—](https://github.com/github/semantic/blob/master/src/Data/Syntax/Literal.hs)ã€[è¡¨è¾¾å¼](https://github.com/github/semantic/blob/master/src/Data/Syntax/Expression.hs)ã€[è¯­å¥](https://github.com/github/semantic/blob/master/src/Data/Syntax/Statement.hs)å’Œ[ç±»å‹](https://github.com/github/semantic/blob/master/src/Data/Syntax/Type.hs))ã€‚

è™½ç„¶ä»–ä»¬å¸Œæœ›åœ¨å°†æ¥å–æ¶ˆè¿™ä¸€æ­¥ï¼Œä½†æ˜¯ä¸€æ—¦ AST èŠ‚ç‚¹è¢«æ˜ å°„ï¼Œç¬¬äºŒè½®è§£æå°±å®Œæˆäº†ï¼Œä»¥å°†å®ƒä»¬åŒ…è£…æˆåº“å¯ä»¥ç†è§£çš„æ•°æ®ç»“æ„(å…³äºè¿™ä¸€ç‚¹çš„æ›´å¤šä¿¡æ¯ï¼Œ[å‚è§â€œèµ‹å€¼â€æ–‡æ¡£](https://github.com/github/semantic/blob/master/docs/assignment.md))ã€‚

è¿˜æœ‰å¾ˆå¤šäº‹æƒ…å‘ç”Ÿåœ¨*åˆ†æ*å’Œ*æ¯”è¾ƒ*æºä»£ç ä¸Šï¼Œä½†æ˜¯æˆ‘ä¼šæŠŠè§£é‡Šç•™ç»™ä»–ä»¬çš„[å…³äºç¨‹åºåˆ†æçš„ä¼Ÿå¤§æ–‡æ¡£](https://github.com/github/semantic/blob/master/docs/program-analysis.md)ã€‚

è°¢è°¢ GitHub â¤ï¸ç»§ç»­åŠªåŠ›ğŸ˜„