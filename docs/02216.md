# ç”¨ TypeScriptã€Expressã€Mocha å’Œ Chai æ„å»ºé¡¹ç›®

> åŸæ–‡ï¼š<https://dev.to/oliverjumpertz/building-a-project-with-typescript-express-mocha-and-chai-13fc>

## æˆ‘ä»¬è¦é€ ä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç”¨äºç¼–å†™ Express.js API çš„ TypeScript é¡¹ç›®ã€‚æˆ‘ä»¬å°†ä»è®¾ç½®å¥½ä¸€åˆ‡å¼€å§‹ï¼Œæ··åˆ TSLintï¼Œæ·»åŠ  Mocha å’Œ Chai è¿›è¡Œæµ‹è¯•ï¼Œç„¶åä½¿ç”¨ webpack åˆ›å»ºä¸€ä¸ªæ†ç»‘çš„ JS æ–‡ä»¶ï¼Œå®ƒå¯ä»¥ä¸ node ä¸€èµ·è¿è¡Œï¼Œå¼€ç®±å³ç”¨ï¼Œä¸éœ€è¦ä»»ä½•å…¶ä»–ä¸œè¥¿ã€‚

## ç‚¹å¿«é€Ÿç¬”è®°

è¿™é‡Œæˆ‘å°†ä½¿ç”¨ Yarnï¼Œä½†æ˜¯å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨ npmï¼Œè¯·éšæ„ç›¸åº”åœ°æ›´æ”¹å‘½ä»¤ã€‚

æˆ‘åœ¨ Mac OS X ä¸Šä½¿ç”¨ zshï¼Œæ‰€ä»¥ä½ åœ¨ç»ˆç«¯ä¸Šçœ‹åˆ°çš„å¯èƒ½ä¸ä½ åœ¨è¿™ç¯‡æ–‡ç« ä¸­çœ‹åˆ°çš„æœ‰æ‰€ä¸åŒã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªå‘½ä»¤çš„è¾“å‡ºå’Œç»“æœåº”è¯¥æ˜¯ç›¸åŒçš„ã€‚

## åˆå§‹è®¾ç½®

æˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°ç›®å½•å¹¶å»ºç«‹ä¸€ä¸ªæ–°é¡¹ç›®:

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript]> mkdir express-api
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript]> cd express-api 
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> yarn init --yes
yarn init v1.12.3
warning The yes flag has been set. This will automatically answer yes to all questions, which may have security implications.
success Saved package.json
âœ¨  Done in 0.03s. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

(å¯ä»¥éšæ„çœç•¥ init ä¸Š Yarn çš„`--yes`å‚æ•°ï¼ŒæŒ‰ç…§è‡ªå·±çš„å–œå¥½å¡«å†™æ‰€æœ‰å†…å®¹ã€‚)

## æ·»åŠ  TypeScriptã€TSLint å’Œ Express

æ—¢ç„¶åŸºæœ¬é¡¹ç›®å·²ç»è®¾ç½®å¥½äº†ï¼Œæ˜¯æ—¶å€™æ·»åŠ ç¬¬ä¸€ä¸ªä¾èµ–é¡¹äº†ï¼ŒTypeScript å’Œ TSLint:

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> yarn add --dev typescript tslint
yarn add v1.12.3
info No lockfile found.
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
[3/4] ğŸ”—  Linking dependencies...
[4/4] ğŸ“ƒ  Building fresh packages...

[...]
âœ¨  Done in 1.96s. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å’Œå¿«é€’ï¼Œä»¥åŠå…¶ç±»å‹:

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> yarn add express
yarn add v1.12.3
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
[3/4] ğŸ”—  Linking dependencies...
[4/4] ğŸ“ƒ  Building fresh packages...

[...]

âœ¨  Done in 0.90s.
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> yarn add --dev @types/express @types/node
yarn add v1.12.3
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
[3/4] ğŸ”—  Linking dependencies...
[4/4] ğŸ“ƒ  Building fresh packages...

[...]

âœ¨  Done in 0.96s. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æœ€åŸºæœ¬çš„è®¾ç½®å°±å¿«å®Œæˆäº†ã€‚TypeScript ç°åœ¨éœ€è¦ä¸€ä¸ª`tsconfig.json`, TSLint æ¥ä¸‹æ¥å°†å¾—åˆ°å®ƒçš„`tslint.json`ã€‚

TSLint çš„ init æä¾›çš„åŸºæœ¬é…ç½®ç°åœ¨å·²ç»è¶³å¤Ÿäº†ï¼Œè¿˜æœ‰ä¸€ä¸ªç©ºçš„`tsconfig.json`ï¼Œæˆ‘ä»¬å°†åœ¨åé¢å¡«å……:

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> yarn tslint --init
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> touch tsconfig.json 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

TypeScript çš„`tsc init`å°†ç”Ÿæˆä¸€ä¸ªç›¸å¯¹è¾ƒå¤§çš„é…ç½®ï¼Œå…¶ä¸­è®¸å¤šè®¾ç½®è¢«æ³¨é‡Šæ‰ï¼Œä»¥å±•ç¤ºå¯èƒ½çš„æƒ…å†µï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬éå¸¸ç¡®å®šæˆ‘ä»¬éœ€è¦ä»€ä¹ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨ä¸‹é¢çš„`tsconfig.json` :

```
{  "compilerOptions":  {  "module":  "commonjs",  "esModuleInterop":  true,  "target":  "es6",  "noImplicitAny":  true,  "moduleResolution":  "node",  "sourceMap":  true,  "outDir":  "dist",  "baseUrl":  ".",  "paths":  {  "*":  ["node_modules/*"]  }  },  "include":  ["src/**/*"]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç•™ç»™æˆ‘ä»¬çš„å”¯ä¸€ä¸€ä»¶äº‹ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ª`src/`ç›®å½•ï¼Œæ·»åŠ æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª ts æ–‡ä»¶

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> mkdir src
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> touch src/index.ts 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶å°†ä»¥ä¸‹å†…å®¹æ”¾å…¥`index.ts` :

```
import express from "express";

const app = express();
const port = 8080;

app.get("/", (req, res) => {
    res.send("Hello world!");
});

app.listen(port, () => {
    console.log(`server started at http://localhost:${port}`);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## æµ‹è¯•æˆ‘ä»¬çš„åˆå§‹è®¾ç½®

æˆ‘ä»¬å‡†å¤‡å¥½äº†ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥ç¼–è¯‘æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå¹¶åƒè¿™æ ·å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡å™¨:

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002]
â””[~/projects/typescript/express-api]> yarn tsc
yarn run v1.12.3
$ /Users/oliver/projects/typescript/express-api/node_modules/.bin/tsc
âœ¨  Done in 2.02s.
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> node dist/index.js
server started at http://localhost:8080 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç‚¹å‡»è¿™ä¸ªé“¾æ¥ä¼šåœ¨æˆ‘ä»¬çš„æµè§ˆå™¨ä¸­ç»™æˆ‘ä»¬ä¸€ä¸ªå‹å¥½çš„`Hello world!`ã€‚å¤ªå¥½äº†ï¼

## æ·»åŠ  npm è„šæœ¬

æˆ‘ä»¬è¿˜æ²¡æœ‰ä½¿ç”¨ TSLintï¼Œç”¨ Yarn æ‰‹åŠ¨æ‰§è¡Œæ¯ä¸ªå‘½ä»¤å¹¶ä¸æ˜¯å¯¹æˆ‘ä»¬æ—¶é—´çš„æœ€å¥½åˆ©ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ·»åŠ ä¸€äº› npm è„šæœ¬å¹¶æ›´æ”¹æˆ‘ä»¬çš„`package.json`ï¼ŒåŒæ—¶è®©`main`æŒ‡å‘æˆ‘ä»¬çš„`dist/index.js`ã€‚

```
{  "name":  "express-api",  "version":  "1.0.0",  "main":  "dist/index.js",  "license":  "MIT",  "scripts":  {  "prebuild":  "tslint -c tslint.json -p tsconfig.json --fix",  "build":  "tsc",  "prestart":  "yarn build",  "start":  "node ."  },  "devDependencies":  {  "@types/express":  "^4.17.1",  "@types/node":  "^12.7.5",  "tslint":  "^5.20.0",  "typescript":  "^3.6.3"  },  "dependencies":  {  "express":  "^4.17.1"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç°åœ¨åªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ–° API åœ¨è¿è¡Œ:

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> yarn start
yarn run v1.12.3
$ tslint -c tslint.json -p tsconfig.json --fix

ERROR: /Users/oliver/projects/typescript/express-api/src/index.ts:11:5 - Calls to 'console.log' are not allowed.

error Command failed with exit code 2.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å“å‘¦ã€‚TSLint ä¸å–œæ¬¢æˆ‘ä»¬ä½¿ç”¨æ§åˆ¶å°æ¥è¡¨ç¤ºæˆ‘ä»¬çš„æœåŠ¡å™¨å·²ç»å¯åŠ¨ã€‚è®©æˆ‘ä»¬é€šè¿‡å°†`tslint.json`çš„å†…å®¹æ›´æ”¹ä¸ºä»¥ä¸‹å†…å®¹æ¥å¿«é€Ÿä¿®å¤è¿™ä¸ªé—®é¢˜:

```
{  "defaultSeverity":  "error",  "extends":  ["tslint:recommended"],  "jsRules":  {},  "rules":  {  "no-console":  [false]  },  "rulesDirectory":  []  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“æˆ‘ä»¬å†æ¬¡å°è¯•æ—¶:

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002]
â””[~/projects/typescript/express-api]> yarn start
yarn run v1.12.3
$ yarn build
$ tslint -c tslint.json -p tsconfig.json --fix
$ tsc
$ node .
server started at http://localhost:8080 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç§ï¼ŒæˆåŠŸäº†ï¼

## åŠ å…¥æ‘©å¡å’ŒæŸ´è¿›è¡Œæµ‹è¯•

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†å®ç° API å¹¶è®©å®ƒåœ¨æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œæ‰€éœ€çš„ä¸€åˆ‡å·¥ä½œã€‚ç°åœ¨æ˜¯æ—¶å€™æ·»åŠ ä¸€äº›æµ‹è¯•åŠŸèƒ½äº†ã€‚
å¦‚å¼€å¤´æ‰€è¯´ï¼Œæˆ‘ä»¬è¦ç”¨æ‘©å¡å’ŒæŸ´ã€‚æˆ‘ä»¬è¿˜éœ€è¦ ts-node æ¥è®© Mocha æ­£ç¡®åœ°å¤„ç† TypeScriptã€‚

åˆä¸€è½®æ·»åŠ ä¾èµ–:

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002]
â””[~/projects/typescript/express-api]> yarn add --dev mocha chai ts-node @types/mocha @types/chai
yarn add v1.12.3
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
[3/4] ğŸ”—  Linking dependencies...
[4/4] ğŸ“ƒ  Building fresh packages...

[...]

âœ¨  Done in 0.96s. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¾ˆå¥½ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨`src/`ä¸­åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè§„èŒƒ`index.spec.ts`ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
import { expect } from "chai";
import "mocha";

describe("This", () => {
  describe("should", () => {
    it("always pass", () => {
      expect(true).to.equal(true);
    });
  });
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€æ¬¡æµ‹è¯•ï¼Œæœªæ¥è¿˜ä¼šæœ‰æ›´å¤šçš„æµ‹è¯•ã€‚
ä½†æ˜¯ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬çš„æµ‹è¯•æ¯æ¬¡éƒ½åœ¨ TypeScript ç¼–è¯‘å™¨ä¹‹åè¿è¡Œï¼Œé‚£å°±å¤ªå¥½äº†ã€‚
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`postbuild`è®©æˆ‘ä»¬çš„æµ‹è¯•åœ¨æ¯æ¬¡ç¼–è¯‘å™¨åœ¨æˆ‘ä»¬çš„`package.json`ä¸­è¿è¡Œåè¿è¡Œï¼Œå°±åƒè¿™æ ·:

```
{  "name":  "express-api",  "version":  "1.0.0",  "main":  "dist/index.js",  "license":  "MIT",  "scripts":  {  "prebuild":  "tslint -c tslint.json -p tsconfig.json --fix",  "build":  "tsc",  "postbuild":  "yarn test",  "prestart":  "yarn build",  "start":  "node .",  "test":  "mocha -r ts-node/register src/**/*.spec.ts"  },  "devDependencies":  {  [...]  },  "dependencies":  {  [...]  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬çš„æµ‹è¯•æ˜¯æ„å»ºé“¾çš„ä¸€éƒ¨åˆ†ã€‚

## webpack

### ä¸ºä»€ä¹ˆè¦è£…ç½‘é¡µåŒ…

æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œåœä¸‹æ¥ï¼Œè¿›ä¸€æ­¥å®ç°æˆ‘ä»¬çš„ APIï¼Œç„¶ååœ¨æŸä¸ªåœ°æ–¹éƒ¨ç½²æ•´ä¸ªé¡¹ç›®ã€‚è¿™å½“ç„¶å¾ˆå¥½ï¼Œä½†æ˜¯æœ‰ç‚¹ä½æ•ˆã€‚

è®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬çš„`node_modules` :
çš„å¤§å°

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> du -hs node_modules 
 67M    node_modules 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å—¯ï¼Œè¿™æ˜¯ä¸€ç‚¹ç£ç›˜ç©ºé—´çš„ä½¿ç”¨ï¼Œåªæ˜¯ä¸€ä¸ªç«¯ç‚¹è¿”å›â€œHello worldï¼â€è¿˜æ²¡æœ‰åšå…¶ä»–äº‹æƒ…ã€‚ä½†æ˜¯ webpack å¯ä»¥å¸®åŠ©æˆ‘ä»¬å°†åº”ç”¨ç¨‹åºå‡å°‘åˆ°ç»å¯¹å¿…è¦çš„ç¨‹åº¦ã€‚
è¿™éå¸¸æ–¹ä¾¿ï¼Œå°¤å…¶æ˜¯å½“æˆ‘ä»¬æƒ³å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Docker å®¹å™¨æ—¶ã€‚

### æ·»åŠ  webpack

è®©æˆ‘ä»¬æ·»åŠ  webpack æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹:

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002]
â””[~/projects/typescript/express-api]> yarn add --dev webpack-cli webpack ts-loader
yarn add v1.12.3
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
[3/4] ğŸ”—  Linking dependencies...
[4/4] ğŸ“ƒ  Building fresh packages...

[...]

âœ¨  Done in 7.35s. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¤ªå¥½äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ª webpack é…ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å®ƒçš„ç»‘å®šå’Œæ ‘æŠ–åŠ¨ã€‚

æˆ‘ä»¬å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°åä¸º`webpack.config.js` :
çš„æ–‡ä»¶ä¸­

```
const path = require('path');

module.exports = {
  name: 'deployment',
  mode: 'production',
  entry: './src/index.ts',
  target: 'node',
  devtool: 'hidden-source-map',
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        use: 'ts-loader',
        exclude: /node_modules/,
      },
    ],
  },
  resolve: {
    extensions: ['.tsx', '.ts', '.js'],
  },
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
  },
  optimization: {
    usedExports: true,
  },
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™åŸºæœ¬ä¸Šæ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œæˆ‘ä»¬å‡ ä¹å‡†å¤‡å¥½äº†ã€‚
ç°åœ¨è®©æˆ‘ä»¬è°ƒæ•´ä¸€ä¸‹æˆ‘ä»¬çš„`package.json`ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ webpack æ¥ä»£æ›¿æ™®é€šçš„ TypeScript ç¼–è¯‘å™¨:

```
{  "name":  "express-api",  "version":  "1.0.0",  "main":  "dist/bundle.js",  "license":  "MIT",  "scripts":  {  "prebuild":  "tslint -c tslint.json -p tsconfig.json --fix",  "build":  "webpack",  "postbuild":  "yarn test",  "prestart":  "yarn build",  "start":  "node .",  "test":  "mocha -r ts-node/register src/**/*.spec.ts"  },  "devDependencies":  {  [...]  },  "dependencies":  {  [...]  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“æˆ‘ä»¬ç°åœ¨ä½¿ç”¨`yarn start`æˆ–`yarn build`æ—¶ï¼Œwebpack ä¼šåˆ›å»ºä¸€ä¸ª`bundle.js`ï¼Œç„¶åæ‰§è¡Œå®ƒæ¥ä»£æ›¿æ—§çš„`index.js`ã€‚

è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹`dist/`æ–‡ä»¶å¤¹æœ‰å¤šå¤§:

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> du -hs dist        
1.2M    dist 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

1.2 å…†ï¼è¿™æ˜¯æˆ‘ä»¬çš„åŒ…ï¼ŒåŒ…æ‹¬ä¸€ä¸ªæºç å›¾ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ†ç»‘åŒ…ï¼Œåªæœ‰:

```
â”Œ[oliver@Olivers-MBP] [/dev/ttys002] 
â””[~/projects/typescript/express-api]> du -hs dist/bundle.js
564K    dist/bundle.js 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¾ˆå¥½ï¼Œè€Œä¸”å¥½å¾—å¤šã€‚564K æ˜¯æˆ‘ä»¬éœ€è¦çš„ä¸€åˆ‡ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶æ”¾åœ¨æŸä¸ªåœ°æ–¹ï¼Œç„¶åç”¨`node bundle.js`å¼€å§‹ã€‚æ²¡æœ‰å¿…è¦æŠŠæ•´ä¸ªé¡¹ç›®æ”¾åœ¨æŸä¸ªåœ°æ–¹è®©æœåŠ¡å™¨è¿è¡Œã€‚

## å¯¹æˆ‘ä»¬çš„ npm è„šæœ¬åšä¸€äº›æœ€åçš„è°ƒæ•´

è¿˜æœ‰ä¸‰ä¸ªè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ åˆ°æˆ‘ä»¬çš„`package.json`ä¸­ï¼Œä½¿æˆ‘ä»¬çš„ç”Ÿæ´»åœ¨å¼€å‘æ—¶å˜å¾—æ›´å®¹æ˜“ä¸€äº›ã€‚

### å¼€å‘æ—¶å¿«é€Ÿç¼–è¯‘

æ˜¾ç„¶ï¼Œwebpack æ¯”ç”¨ TypeScript ç¼–è¯‘å™¨ç¼–è¯‘æˆ‘ä»¬çš„ä»£ç èŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚è¿™ç§å¼€é”€å¯èƒ½ä¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­å¢åŠ ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥ä½¿ç”¨ TypeScript ç¼–è¯‘å™¨æ¥ç»•è¿‡ webpackï¼Œç„¶åé€šè¿‡å‘æˆ‘ä»¬çš„`package.json` :
æ·»åŠ ä»¥ä¸‹å†…å®¹æ¥å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡å™¨

```
"scripts":  {  [...]  "dev":  "tsc",  "postdev":  "node dist/index.js"  }, 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»…ç”¨`yarn dev`å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚

### å»ºé€ å‰çš„æ¸…ç†

ä½¿ç”¨æˆ‘ä»¬æ–°çš„`yarn dev`è„šæœ¬ï¼Œæˆ‘ä»¬ç°åœ¨å®é™…ä¸Šæœ‰ä¸¤ç§ç±»å‹çš„æ„å»ºï¼Œå®ƒä»¬åˆ›å»ºä¸åŒçš„æ–‡ä»¶ã€‚åœ¨è¿›è¡Œäº§å“çº§æ„å»ºä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥æ¸…ç†æˆ‘ä»¬çš„`dist/`æ–‡ä»¶å¤¹ï¼Œä»¥ä¾¿åœ¨æ„å»ºä¹‹åï¼Œæœ€ç»ˆåªç•™ä¸‹æˆ‘ä»¬çœŸæ­£éœ€è¦çš„æ–‡ä»¶ã€‚

è®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨æ”¾å…¥`package.json` :
ä¸­çš„`clear`è„šæœ¬æ¥æ”¹å˜æˆ‘ä»¬çš„`prebuild`æ­¥éª¤

```
"scripts":  {  "prebuild":  "yarn clear && tslint -c tslint.json -p tsconfig.json --fix",  [...]  "clear":  "rm -r dist/* || true"  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ç»“è®º

å°±æ˜¯è¿™æ ·ã€‚æˆ‘ä»¬å·²ç»å»ºç«‹äº†ä¸€ä¸ªå¾ˆå¥½çš„å¼€ç«¯æ¥ç»§ç»­å¼€å‘ã€‚ä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘ä»¬éœ€è¦éƒ¨ç½²çš„åªæ˜¯æˆ‘ä»¬çš„`bundle.js`(ä¹Ÿè®¸è¿˜æœ‰æˆ‘ä»¬çš„`bundle.js.map`)è€Œä¸æ˜¯æˆ‘ä»¬çš„æ•´ä¸ªé¡¹ç›®ã€‚
å¦‚æœä½ ä¸èƒ½å®Œå…¨éµå¾ªæ‰€æœ‰æ­¥éª¤ï¼Œä½ å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°æ¨¡æ¿[ã€‚](https://github.com/excelbrium/yarn-typescript-webpack-express-starter)