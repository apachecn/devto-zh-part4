# æµé‡æ³¨é‡Š 0.100

> åŸæ–‡:[https://dev.to/wgao19/notes-on-flow-0-100-5c6k](https://dev.to/wgao19/notes-on-flow-0-100-5c6k)

æµé‡ [0.100](https://github.com/facebook/flow/releases/tag/v0.100.0) è¾“å‡ºğŸ’¯ã€‚ä¸€å¦‚æ—¢å¾€åœ°é˜…è¯»å’Œå­¦ä¹ å…³äº Flow å’Œ JavaScript çš„çŸ¥è¯†ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘å†™äº†ä¸€ç¯‡å…³äºå¯¹è±¡ææ„ã€React ç±»å‹å®šä¹‰çš„çŸ­æ–‡ï¼Œå¹¶æä¾›äº†ä¸€ç¯‡è§£é‡Šæ–¹å·®ç¬¦å·çš„å¥½æ–‡ç« çš„é“¾æ¥ã€‚

Flow 0.100 æœ‰éå¸¸å¥½çš„å‘è¡Œè¯´æ˜å’Œç¤ºä¾‹ã€‚æ‰€ä»¥æˆ‘ä¸ä¼šé‡å¤å·²ç»è¯´è¿‡çš„è¯ã€‚ä»¥ä¸‹æ˜¯æˆ‘åœ¨è¯•å›¾äº†è§£è¿™äº›å˜åŒ–æ—¶è®°ä¸‹çš„ä¸€äº›è¦ç‚¹ã€‚

* * *

## [](#destructuring-objects-in-function-parameters)ææ„å‡½æ•°å‚æ•°ä¸­çš„å¯¹è±¡

> å¦‚æœç”Ÿæˆçš„ç»‘å®šæœªè¢«ä½¿ç”¨ï¼Œåˆ™ææ„æ¨¡å¼ä»¥å‰å¯èƒ½åŒ…æ‹¬ç¼ºå¤±çš„å±æ€§ã€‚å³ä½¿ä¸ä½¿ç”¨ï¼Œè¿™ç°åœ¨ä¹Ÿæ˜¯ä¸€ä¸ªé”™è¯¯ã€‚[è¯•æµç¤ºä¾‹](https://flow.org/try/#0C4TwDgpgBA8lC8UDeUwC4oGdgCcCWAdgOZQC+A3AFAD01UAojjgPY4YAqAFhDtHplALNULSDlBQABgEdJUQlFCQpMSQBooAQwHMAZlABiAG2YB3KADcADADoAjFdtXKugK4EAxsDzMCUXQAUSGAa0qQYMACUyKRAA)

```
type O = { p: string }
// Error: There is no property `q` in type `O`, as of Flow v0.100.0
function f({ p, q }: O) {} 
```

æˆ‘é‡åˆ°çš„ä¸€ä¸ªå›°æƒ‘æ˜¯

> è¿™æ˜¯å¦æ„å‘³ç€æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç²¾ç¡®çš„ï¼Ÿ

æ‰€ä»¥æˆ‘å€Ÿæ­¤æœºä¼šæ¾„æ¸…äº†ä¸€äº›äº‹æƒ…ã€‚ç²¾ç¡®æ„å‘³ç€åœ¨è¿™é‡Œä¼ å…¥çš„å¯¹è±¡*ä¸èƒ½*åŒ…å«é¢å¤–çš„å­—æ®µ([é“¾æ¥åˆ°æ–‡æ¡£](https://flow.org/en/docs/types/objects/#toc-exact-object-types))ã€‚

å¦ä¸€æ–¹é¢ï¼Œå¯†å°æ„å‘³ç€å¯¹è±¡å¯èƒ½åŒ…å«å…¶ä»–å­—æ®µï¼Œä½†æ˜¯é™¤éæ‚¨å¯¹å®ƒä»¬è¿›è¡Œæ³¨é‡Šï¼Œå¦åˆ™æ‚¨å¯èƒ½æ— æ³•è®¿é—®å®ƒä»¬ã€‚å½“æˆ‘ä»¬ç”¨ä¸€äº›å­—æ®µç¼–å†™ä¸€ä¸ªå¯¹è±¡ç±»å‹æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒæ˜¯*å¯†å°çš„*ã€‚è¯•å›¾è®¿é—®ä¸€ä¸ªå¯†å°å¯¹è±¡çš„æœªæ ‡æ³¨å­—æ®µå°†å¯¼è‡´é”™è¯¯ï¼Œä¸ç®¡å®ƒæ˜¯å¦å‡†ç¡®:

```
type Sealed = { foo: string }

const sealed = {
  foo: 'foo',
}
sealed.bar = 'bar' // error
const { foo, bar } = sealed // error 
```

å¯¹äºéœ€è¦å¯†å°å¯¹è±¡çš„å‡½æ•°ï¼Œä»ç„¶å¯ä»¥ä¼ å…¥å¸¦æœ‰é¢å¤–å±æ€§çš„å¯¹è±¡ã€‚

```
function usingSealed(x: Sealed) {
  // does things
}
usingSealed({ foo: 'foo', bar: 'bar' }) // ok 
```

å½“å‡½æ•°æœŸæœ›*ç²¾ç¡®çš„*å¯¹è±¡:
æ—¶å°±ä¸æ˜¯è¿™æ ·äº†

```
type Exact = {| foo: string |}

function usingExact(x: Exact) {
  // does things
}
usingExact({ foo: 'foo', bar: 'bar' }) // error 
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡ææ„å¯¹è±¡æ¥è®¿é—®å‡½æ•°å‚æ•°çš„å­—æ®µ:

```
// destructuring on function parameter
function goodUsingSealed({ foo }: Sealed) { // ok
  // does things
} 
```

ä½†æ˜¯ç”±äºææ„æ„å‘³ç€è®¿é—®å¯¹è±¡ï¼Œæˆ‘ä»¬*ä¸åº”è¯¥*èƒ½å¤Ÿè®¿é—®å¯†å°å¯¹è±¡çš„é¢å¤–å±æ€§ã€‚è¿™åœ¨ 0.100 ä¸­æ˜¯å›ºå®šçš„:

```
// fixed in 0.100
function badUsingSealed({ foo, bar }: Sealed) { // error after 0.100
  // does things
} 
```

* * *

## [](#react-component-types)ååº”å…ƒä»¶ç±»å‹

React åº“å®šä¹‰æœ‰å¾ˆå¤šå˜åŒ–ã€‚æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æœºä¼šï¼Œè®©æˆ‘ä»¬åé€€ä¸€æ­¥ï¼Œçœ‹çœ‹å®ƒä»¬åˆ°åº•æ˜¯ä»€ä¹ˆã€‚

[è¿™é‡Œçš„](https://github.com/facebook/flow/blob/master/lib/react.js)æ˜¯åˆ° React åº“å®šä¹‰çš„é“¾æ¥ã€‚

æˆ‘çš„å¸¸ç”¨æ¸…å•:

*   `React$Component<Props, State = void>`
*   `AbstractComponent<-Config, +Instance = mixed>`
*   `React$ComponentType<-Config>`
*   `React$ElementType`
*   `React$Element<+ElementType: React$ElementType>`
*   (æ–°)`React$MixedElement = React$Element<React$ElementType>`
*   (æ–°)`MixedElement = React$MixedElement`
*   `React$Ref<ElementType: React$ElementType>`

åœ¨ä¸Šé¢çš„å®šä¹‰ä¸­ï¼Œå¸¦å°–æ‹¬å·çš„æ˜¯å¤šæ€ç±»å‹ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦ä¸ºé‚£äº›å¤šæ€æä¾›ç±»å‹å‚æ•°ã€‚

### [](#-raw-reactcomponentltprops-state-voidgt-endraw-)`React$Component<Props, State = void>`

`React$Component`æ˜¯ ES6 React ç±»çš„åŸºç±»ï¼Œå»ºæ¨¡ä¸ºå¤šæ€ç±»ï¼Œå…¶ä¸»è¦ç±»å‹å‚æ•°æ˜¯ Props å’Œ Stateã€‚

### [](#-raw-reactabstractcomponent-endraw-)`React$AbstractComponent`

`React$AbstractComponent`æ˜¯ Flow ä½¿ç”¨çš„ç±»å‹åï¼Œç”± React åº“å£°æ˜ä¸­çš„ä¸€äº›ä¸åŒç±»å‹çš„ React ç±»å’Œç»„ä»¶ä½¿ç”¨ã€‚

`React.AbstractComponent`ç›´æ¥ä½¿ç”¨å®ƒï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ`Config`è¡¨ç¤ºé“å…·ç±»å‹ï¼Œ`Instance`è¡¨ç¤ºå®ä¾‹ã€‚åŠŸèƒ½ç»„ä»¶æœ‰`Instance: void`ã€‚

### [](#-raw-reactcomponenttype-endraw-)`React$ComponentType`

```
declare type React$ComponentType<-Config> = React$AbstractComponent<
  Config,
  mixed
> 
```

åˆ«åä¸º`React$AbstractComponent<Config, mixed>`ï¼Œç”¨ä½œ React ä¸­ç»„ä»¶çš„ç±»å‹ã€‚å®ƒå¯ä»¥æ˜¯:

*   æ— çŠ¶æ€åŠŸèƒ½ç»„ä»¶ã€‚æ¥å— props ä½œä¸ºå‚æ•°å¹¶è¿”å› React èŠ‚ç‚¹çš„å‡½æ•°ã€‚
*   ES6 ç±»ç»„ä»¶ã€‚ä½¿ç”¨ ES6 ç±»è¯­æ³•æˆ–ä¼ ç»Ÿçš„`React.createClass()`åŠ©æ‰‹å®šä¹‰çŠ¶æ€çš„ç»„ä»¶ã€‚

### [](#-raw-reactelementtype-endraw-)`React$ElementType`

```
declare type React$ElementType = string | React$AbstractComponent<empty, mixed> 
```

React ä¸­å…ƒç´ çš„ç±»å‹ã€‚ååº”å…ƒç´ å¯ä»¥æ˜¯:

*   è¿™äº›å…ƒç´ æ˜¯ä¾èµ–äº React æ¸²æŸ“å™¨å®ç°çš„å†…åœ¨å…ƒç´ ã€‚
*   ååº”ç»„ä»¶ã€‚æœ‰å…³å…¶ä¸åŒå˜ä½“çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§`ComponentType`ã€‚

å‡ æ›´ä¸`ElementType`æœ‰å…³:

A `React$Element`æ˜¯ React å…ƒç´ çš„ç±»å‹ã€‚React å…ƒç´ é€šå¸¸æ˜¯ä½¿ç”¨ JSX æ–‡æœ¬åˆ›å»ºçš„ï¼Œå®ƒè¢« React.createElement è°ƒç”¨(è§ä¸‹æ–‡)ã€‚

```
declare type React$Element<+ElementType: React$ElementType> = {|
  +type: ElementType,
  +props: React$ElementProps<ElementType>,
  +key: React$Key | null,
  +ref: any,
|} 
```

æœ€åï¼Œè¿™é‡Œæ˜¯ä¸¤ä¸ªæ–°ç±»å‹:

```
declare type React$MixedElement = React$Element<React$ElementType>
declare type MixedElement = React$MixedElement 
```

æ•é”çš„è¯»è€…å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œä»¥ä¸Šæˆ–å¤šæˆ–å°‘æ˜¯å¯¹ Flow ä»£ç åº“çš„æ³¨é‡Šå’Œä»£ç ç‰‡æ®µçš„å¤åˆ¶å’Œç²˜è´´ã€‚å®ƒä»¬ç¡®å®å†™å¾—éå¸¸å¥½ï¼Œä»£ç æœ¬èº«çš„å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯ä¸è¨€è‡ªæ˜çš„ã€‚

* * *

## [](#variance-sigils)æ–¹å·®ç¬¦å·

å˜å¼‚ç¬¦å·åœ¨åº“å®šä¹‰ä¸­æ— å¤„ä¸åœ¨ã€‚å¦‚æœè¿™ç»„åŒä¹‰è¯å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„å°†åæ–¹å·®è§†ä¸ºåªè¯»ï¼Œå°†é€†å˜è§†ä¸ºåªå†™ã€‚

è¿™ç¯‡æ–‡ç«  [Flow çš„ç»å¯†](https://medium.com/@forbeslindesay/covariance-and-contravariance-c3b43d805611)è§£é‡Šçš„å¾ˆå¥½ã€‚

## [](#till-next-time)ğŸ¶ä¸‹æ¬¡è§

[æµé‡ 0.101](https://github.com/facebook/flow/releases/tag/v0.101.0) å·²ç»å‡ºæ¥äº†ï¼Œæˆ‘è½åäº†ğŸ˜­æ˜¯ [JSConfã€‚äºšæ´²](https://2019.jsconf.asia/)ç°åœ¨åœ¨å®¶ã€‚ä¸‹å‘¨æˆ‘ä¼šå†·é™ä¸‹æ¥ï¼Œå›åˆ°æˆ‘æ­£å¸¸çš„çŠ¶æ€:]