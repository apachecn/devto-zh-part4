# ç®€å• SQL æ•™ç¨‹:å¦‚ä½•é€è§†

> åŸæ–‡:[https://dev . to/erikwhiting 88/simple-SQL-tutorial-how-to-pivot-2 cjl](https://dev.to/erikwhiting88/simple-sql-tutorial-how-to-pivot-2cjl)

é€è§†æ•°æ®åªæ˜¯ä»¥ä¸åŒçš„æ–¹å¼æ˜¾ç¤ºå·²æœ‰æ•°æ®çš„ä¸€ç§ç»ƒä¹ ã€‚å®ƒéå¸¸æœ‰ç”¨ï¼Œä½†ä¹Ÿä¼šè®©äººæ„Ÿåˆ°å›°æƒ‘ã€‚æˆ‘å¸Œæœ›ä»»ä½•åŠªåŠ›ç¼–å†™å®Œç¾æ—‹è½¬æŸ¥è¯¢çš„äººéƒ½èƒ½é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼Œå¹¶å°½å¿«å¾—åˆ°ä»–ä»¬éœ€è¦çš„ç­”æ¡ˆï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§ï¼

## [](#but-why)ä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿæˆ‘å‡†å¤‡çš„è¿™ä¸ªä¾‹å­çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œä½†æ˜¯æˆ‘ç”¨ä¸€äº›å®¹æ˜“ç†è§£çš„æƒ³æ³•æ¥è¯´æ˜ä¸€äº›å¤æ‚çš„äº‹æƒ…ã€‚ç°å®ä¸–ç•Œä¸­ä½ ä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œä½ å°±å¿å¿å§ã€‚

## [](#the-data)æ•°æ®

å¥½çš„ï¼Œæˆ‘æœ‰ä¸€ä¸ªåä¸º`FoodEaten`çš„è¡¨æ ¼ï¼Œè®°å½•æˆ‘æ¯å¤©åƒçš„é£Ÿç‰©ã€‚æˆ‘çš„æ•°æ®æ˜¯è¿™æ ·çš„:

```
SELECT * FROM FoodEaten;
-- Results:
Id  | Date       | FoodName | AmountEaten |
--- |------------|----------|-------------|
1   | 2019-08-01 | Sammich  |   2         |
2   | 2019-08-01 | Pickle   |   3         |
3   | 2019-08-01 | Apple    |   1         |
4   | 2019-08-02 | Sammich  |   1         |
5   | 2019-08-02 | Pickle   |   1         |
6   | 2019-08-02 | Apple    |   4         |
7   | 2019-08-03 | Cake     |   2         |
8   | 2019-08-04 | Sammich  |   1         |
9   | 2019-08-04 | Pickle   |   2         |
10  | 2019-08-04 | Apple    |   3         |
----|------------|----------|-------------| 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘çš„é¥®é£Ÿæ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼Œé™¤äº†ç¬¬ä¸‰å¤©æˆ‘åƒäº†ä¸¤æ•´å—è›‹ç³•ã€‚æˆ‘ä»¬å§‘ä¸”ç§°ä¹‹ä¸ºä½œå¼Šæ—¥å§ğŸ˜‰

å¦‚æœæˆ‘æƒ³æ¯å¤©éƒ½çœ‹åˆ°è¿™äº›ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å•ä¸ªçš„é£Ÿç‰©æ¶ˆè´¹è®°å½•ï¼Œé‚£è¯¥æ€ä¹ˆåŠï¼Ÿå¦‚æœä¸æ˜¯ç°åœ¨çš„å‘ˆç°æ–¹å¼ï¼Œæˆ‘æ›´æ„¿æ„çœ‹åˆ°ä¸‰æ˜æ²»ã€æ³¡èœã€è‹¹æœä½œä¸ºæ ç›®å‘¢ï¼Ÿå³ä½¿è¿™äº›ä¸œè¥¿æ˜¯åˆ—ä¸­çš„å€¼ï¼Œæˆ‘ä¹Ÿå¯ä»¥è¿™æ ·åšå—ï¼Ÿä½ èµŒä½ å¯çˆ±çš„è„¸æˆ‘å¯ä»¥ï¼Œç”¨ä¸€ä¸ªå°é­”æœ¯å«`PIVOT`
[![image](../Images/0e92cd7c163bd6438dd9c793ff6ad81b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--6GBdHDJf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://hips.hearstapps.com/hmg-prod.s3.amazonaws.com/images/ross-geller-pivot-1534246982.jpg%3Fcrop%3D1xw:0.9881266490765171xh%3Bcenter%2Ctop%26resize%3D480:%2A)

## [](#the-pivot-syntax)æ¢è½´è¯­æ³•

ä¸‹é¢çš„è¯­æ³•å°†å‡ºç°åœ¨`T-SQL`ä¸­ï¼Œè¿™æ˜¯å¾®è½¯çš„ SQL Server ä½¿ç”¨çš„ SQL æ–¹è¨€ã€‚æˆ‘æœ‰å¤§çº¦ 98.7%çš„æŠŠæ¡è¿™åœ¨ SQL çš„ Oracle/MySQL é£æ ¼çš„`PL-SQL`ä¸­ä¹Ÿèƒ½å·¥ä½œã€‚

è¯­æ³•èƒŒåçš„åŸºæœ¬æ¦‚å¿µæ˜¯:

```
SELECT [Data You Break Up The Other Datas With] AS 'a cool name',
[DataPoint1], [DataPoint2], [DataPointEtc]
FROM (
    SELECT [The], [Columns], [With], [Data]
) AS SourceTable
PIVOT (
    AGGREGATE_FUNCTION([Column with data you want displayed in rows])
    FOR [Column in which "The Columns With Data" live] IN (
        [DataPoint1], [DataPoint2], [DataPointEtc]
    )
) AS PivotTable 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ²¡æœ‰ä»»ä½•æ„ä¹‰å—ï¼Ÿæ²¡äº‹ï¼Œçœ‹ä¸ªçœŸçš„:

```
SELECT [Date] AS 'Day',
[Sammich], [Pickle], [Apple], [Cake]
FROM (
    SELECT [Date], FoodName, AmountEaten FROM FoodEaten
) AS SourceTable
PIVOT (
    MAX(AmountEaten)
    FOR FoodName IN ([Sammich], [Pickle], [Apple], [Cake])
) AS PivotTable 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ˜“è„†æŸ æª¬ SQ(L)ueezyã€‚çœ‹çœ‹ç»“æœ:

```
|     DAY     | Sammich | Pickle | Apple | Cake |
|-------------|---------|--------|-------|------|
| 2019-08-01  |    2    |    3   |   1   | NULL |
| 2019-08-02  |    1    |    1   |   4   | NULL |
| 2019-08-03  |  NULL   |  NULL  | NULL  |   2  |
| 2019-08-04  |    1    |    2   |   3   | NULL |
|-------------|---------|--------|-------|------| 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ æ˜ç™½è¿™æ˜¯æ€ä¹ˆå›äº‹äº†å—ï¼Ÿå®ƒæ¥å—æ‚¨æä¾›çš„æ•°æ®ç‚¹å¹¶ä»ä¸­ç”Ÿæˆåˆ—ï¼Œå¹¶æ˜¾ç¤ºæ‚¨æŒ‡å®šä¸ºè¡Œå€¼çš„å¦ä¸€åˆ—çš„å€¼ã€‚

æ³¨æ„ï¼Œåœ¨é€è§†åçš„åˆ—ä¸Šéœ€è¦ä¸€ä¸ªèšåˆå‡½æ•°(ä»¥ç¡®ä¿è¿”å›ä¸€æ¡è®°å½•)ã€‚å¦‚æœä½ ä¸åšä»»ä½•æ•°å­¦è¿ç®—ï¼Œä½¿ç”¨`MAX()`é€šå¸¸æ˜¯ç›¸å½“å®‰å…¨çš„ã€‚æ‚¨è¿˜å¯ä»¥åœ¨åŒ…å«æ—¥æ”¶å…¥ã€æœˆå¹³å‡é”€å”®é¢ç­‰æ•°å­—çš„åˆ—ä¸Šä½¿ç”¨`AVG()`æˆ–`SUM()`ã€‚ä½†è¿™æ¬¡æˆ‘ä»¬åªæ˜¯åœ¨è°ˆè®ºæˆ‘ç³Ÿç³•é€é¡¶çš„é¥®é£Ÿã€‚

æˆ‘ä¸å¤ªå–œæ¬¢è¿™å¼ æ¡Œå­çš„ä¸€ç‚¹æ˜¯æ‰€æœ‰çš„`NULL` sã€‚å¦‚æœæˆ‘æ²¡æœ‰åƒä»»ä½•è›‹ç³•ï¼Œæˆ‘ä¸æƒ³çœ‹åˆ°â€œNULL â€,å¦‚æœæˆ‘æ²¡æœ‰åƒä»»ä½•è‹¹æœï¼Œæˆ‘åº”è¯¥è¢«ç¾è¾±ä¸º 0ã€‚ä¸‹é¢æ˜¯æœ€åŸºæœ¬çš„è§£å†³æ–¹æ³•:

```
SELECT [Date] AS 'Day',
    ISNULL([Sammich], 0) AS Sammich,
    ISNULL([Pickle],  0) AS Pickle, 
    ISNULL([Apple],   0) AS Apple,
    ISNULL([Cake],    0) AS Cake
FROM (
    SELECT [Date], FoodName, AmountEaten FROM FoodEaten
) AS SourceTable
PIVOT (
    MAX(AmountEaten)
    FOR FoodName IN (
        [Sammich], [Pickle], [Apple], [Cake]
    )
) AS PivotTable 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ é—®çš„æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿçœ‹å“ªï¼

```
|     DAY     | Sammich | Pickle | Apple | Cake |
|-------------|---------|--------|-------|------|
| 2019-08-01  |    2    |    3   |   1   |   0  |
| 2019-08-02  |    1    |    1   |   4   |   0  |
| 2019-08-03  |    0    |    0   |   0   |   2  |
| 2019-08-04  |    1    |    2   |   3   |   0  |
|-------------|---------|--------|-------|------| 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#and-there-you-have-it)å¥½äº†

è¿™æ˜¯ä½ çš„åŸºæœ¬åŸåˆ™ï¼Œå¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚