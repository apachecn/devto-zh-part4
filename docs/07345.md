# è®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªè´§å¸äº¤æ˜“æ‰€ç¬¬äºŒéƒ¨åˆ†

> åŸæ–‡:[https://dev . to/Marlon Anthony/let-s-build-a-currency-exchange-part-ii-eh0](https://dev.to/marlonanthony/let-s-build-a-currency-exchange-part-ii-eh0)

åœ¨æœ¬æ•™ç¨‹çš„è¿™ä¸€åŠï¼Œæˆ‘ä»¬å°†é‡ç‚¹æ”¾åœ¨å‰ç«¯ã€‚è¿™ä¸ªé¡¹ç›®çš„ä»£ç åœ¨æˆ‘çš„ [GitHub](https://github.com/marlonanthony/forex) ä¸Šã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°è¿™ç¯‡æ–‡ç« çš„å‰åŠéƒ¨åˆ†ã€‚æˆ‘ä»¬å°†æŠŠæˆ‘ä»¬å‰ç«¯çš„ä»£ç å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º`client`çš„æ–‡ä»¶å¤¹ä¸­ã€‚åœ¨æ ¹çº§åˆ«åˆ›å»º`client`ï¼Œcd åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨ç»ˆç«¯è¿è¡Œä¸‹é¢çš„å‘½ä»¤:

```
npx create-react-app . 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä½¿ç”¨`npx`ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸å¿…å…¨å±€å®‰è£… create-react-appã€‚åœ¨æ‚¨çš„ç»ˆç«¯ä¸­è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè®©æˆ‘ä»¬å¾—åˆ°æˆ‘ä»¬çš„ä¾èµ–é¡¹:

```
npm i @apollo/react-hooks apollo-cache-inmemory apollo-client apollo-link-http graphql-tag react-chartjs-2 chart.js react-router-dom 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¸¦ç€æˆ‘ä»¬çš„é™„å±å“ï¼Œè®©æˆ‘ä»¬æ¥ä¸€æ¬¡å¤§æ‰«é™¤å§ã€‚åˆ é™¤`logo.svg`ã€`serviceWorker.js`ã€`App.test.js`å’Œ`App.css`ã€‚ç°åœ¨ä»`index.js`å’Œ`App.js`ç§»é™¤ä»–ä»¬çš„å¯¼å…¥(å’Œæ‰€æœ‰é‚£äº›å¥‡æ€ªçš„åˆ†å·)ã€‚ç„¶åï¼Œè°ƒæ•´`index.js`ï¼Œä½¿å…¶ç±»ä¼¼äºä¸‹é¢çš„ä»£ç :

```
// index.js

import React from 'react'
import ReactDOM from 'react-dom'
import { BrowserRouter } from 'react-router-dom'
import { ApolloClient } from 'apollo-client'
import { ApolloProvider } from '@apollo/react-hooks'
import { InMemoryCache } from 'apollo-cache-inmemory' 
import { HttpLink } from 'apollo-link-http'

import App from './App'
import './index.css'

const cache = new InMemoryCache() 
const client = new ApolloClient({
  cache,
  link: new HttpLink({
    uri: 'http://localhost:4000/graphql',
    credentials: 'include' 
  })
})

ReactDOM.render(
  <ApolloProvider client={client}>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </ApolloProvider>, document.getElementById('root')
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é¦–å…ˆï¼Œæˆ‘ä»¬å¤„ç†æˆ‘ä»¬çš„è¿›å£ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„`InMemoryCache`å®ä¾‹ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„`ApolloClient`é…ç½®å¯¹è±¡ä¸­ã€‚æˆ‘ä»¬ä½¿ç”¨`HttpLink`æ¥è®¿é—®æˆ‘ä»¬çš„ GraphQL APIï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ [GraphQL æ“åœº](http://localhost:4000/graphql)ä¸­æ‰€åšçš„é‚£æ ·ï¼Œæˆ‘ä»¬æ·»åŠ äº†`credentials: 'include'`æ¥ç¡®ä¿æˆ‘ä»¬çš„ cookie éšæ¯ä¸ªè¯·æ±‚ä¸€èµ·å‘é€ã€‚

åœ¨æˆ‘ä»¬çš„æ¸²æŸ“å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç”¨ React è·¯ç”±å™¨çš„`BrowserRouter`æ¥åŒ…è£…ä¸€åˆ‡ã€‚`react-router`å°†`BrowserRouter`æè¿°ä¸ºï¼Œâ€œä¸€ä¸ªä½¿ç”¨ HTML5 å†å² API æ¥ä¿æŒä½ çš„ UI ä¸ URL åŒæ­¥çš„è·¯ç”±å™¨ã€‚â€

æˆ‘ä»¬ä¼ é€’`ApolloClient`çš„æ–°å®ä¾‹`ApolloProvider`ï¼Œä»¥ä¾¿ç¨åæˆ‘ä»¬å¯ä»¥`consume`å®ƒ(ç±»ä¼¼äº React `Context` API)ã€‚å½“æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™`@apollo/react-hooks`æ­£æ˜¯ä¸€å¤©å¤§çš„å¥½æ—¶æœºã€‚è¿™æ˜¯ä¸€ä¸ªç¼©å°ç‰ˆçš„`react-apollo`ï¼Œå®ƒä¸æä¾›æ¸²æŸ“é“å…·åŠŸèƒ½ï¼Œä½†æ˜¯å°†åŒ…çš„å¤§å°å‡å°‘äº† 50%ï¼

æ‰“å¼€`App.js`å¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :

```
// App.js

import React from 'react'
import { Route } from 'react-router-dom'

import Landing from './pages/Landing'

const App = () => <Route exact path='/' component={ Landing } />

export default App 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

React Router çš„`Route`ç»„ä»¶å…è®¸æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª routes `path`ï¼Œå¹¶å°†è¯¥è·¯å¾„åˆ†é…ç»™ä¸€ä¸ªè¦æ¸²æŸ“çš„ç»„ä»¶ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™ä¸ªç»„ä»¶æ˜¯`Landing`ã€‚åœ¨`src`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª`pages`æ–‡ä»¶å¤¹ã€‚åœ¨`pages`ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¹¶å°†å…¶å‘½åä¸º`Landing.js`ã€‚æ’å…¥ä»¥ä¸‹ä»£ç :

```
// Landing.js

import React from 'react'

const Landing = () => <div>Hello world!</div>

export default Landing 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å†ä¸€æ¬¡å±•ç¤ºäº†æˆ‘ä»¬å¯¹ä¼ ç»Ÿçš„å°Šé‡ï¼Œå¹¶å¬é›†äº†æˆ‘ä»¬æœ€åº„ä¸¥çš„â€œä½ å¥½ï¼Œä¸–ç•Œâ€ä¹é˜Ÿï¼æ²¡æœ‰ä»€ä¹ˆæ¯”ä¸€å¥ç²¾å¿ƒæ‰“æ‰®çš„â€œä½ å¥½ï¼Œä¸–ç•Œâ€æ›´è®©æˆ‘ç€è¿·çš„äº†

åœ¨`src`æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºå¦ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶å°†å…¶å‘½åä¸º`graphql`ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸¤ä¸ªå­æ–‡ä»¶å¤¹:`mutations`å’Œ`queries`ã€‚åœ¨`queries`ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå‘½åä¸º`currencyPairInfo.js`ã€‚

æ·»åŠ ä»¥ä¸‹ä»£ç :

```
// currencyPairInfo.js

import gql from 'graphql-tag'

export const CURRENCY_PAIR_INFO = gql`
  query CurrencyPairInfo($fc: String, $tc: String) {
    currencyPairInfo(tc: $tc, fc: $fc) {
      fromCurrency 
      fromCurrencyName
      toCurrency
      toCurrencyName
      exchangeRate
      lastRefreshed
      timeZone
      bidPrice
      askPrice
    }
  }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é¦–å…ˆï¼Œæˆ‘ä»¬ä»`graphql-tag`å¯¼å…¥`gql`ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®šä¹‰æˆ‘ä»¬çš„çªå˜å’ŒæŸ¥è¯¢ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åšçš„äº‹æƒ…ä¸åœ¨ GraphQL Playground ä¸­åšçš„å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯æˆ‘ä»¬åœ¨æŸ¥è¯¢ä¸­æ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„åç§°(`CurrencyPairInfo`)å¹¶è¿›ä¸€æ­¥æè¿°äº†æˆ‘ä»¬çš„æ¨¡å¼çš„å½¢çŠ¶ã€‚æœ€åï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæŸ¥è¯¢å­˜å‚¨åœ¨å¸¸é‡`CURRENCY_PAIR_INFO`ä¸­ã€‚

ç°åœ¨æˆ‘ä»¬æœ‰äº†æŸ¥è¯¢ï¼Œè®©æˆ‘ä»¬è¿”å›åˆ° Landing.js å¹¶ä½¿ç”¨å®ƒã€‚

```
// Landing.js

import React, { useState } from 'react'
import { useQuery } from '@apollo/react-hooks'

import { CURRENCY_PAIR_INFO } from '../graphql/queries/currencyPairInfo'

const Landing = () => {
  const [ fc, setFc ] = useState('EUR'),
        [ tc, setTc ] = useState('USD'),
        { data, loading, error, refetch } = useQuery(CURRENCY_PAIR_INFO, {
          variables: { fc, tc }
        })

  if(loading) return <p>Loading...</p>
  if(error) return <button onClick={() => refetch()}>Retry</button>

  return data && (
    <section>
      <h3>Currency Exchange</h3>
      <div>
        <select
          value={`${fc}/${tc}`}
          onChange={e => {
            const [ fromCurrency, toCurrency ] = e.target.value.split('/')
            setFc(fromCurrency)
            setTc(toCurrency)
          }}>
          <option>EUR/USD</option>
          <option>JPY/USD</option>
          <option>GBP/USD</option>
          <option>AUD/USD</option>
          <option>USD/CHF</option>
          <option>NZD/USD</option>
          <option>USD/CAD</option>
        </select>
        <button onClick={() => refetch()}>refresh</button>
      </div>
      <div className='landing_pair_data'>
        { data.currencyPairInfo && Object.keys(data.currencyPairInfo).map(val => (
          <div key={val} className='data'>
            <p><span>{val}: </span>{ data.currencyPairInfo[val] }</p>
          </div>
        ))}
      </div>
    </section>
  )
}

export default Landing 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä»`@apollo/react-hooks`å¯¼å…¥`useQuery`ï¼Œæˆ‘ä»¬åœ¨`currencyPairInfo.js`ç¼–å†™çš„æŸ¥è¯¢å’Œä»`React`å¯¼å…¥`useState`ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ React é’©å­`useState`ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç±»ç»„ä»¶é€šè¿‡`this.state`åˆå§‹åŒ–çŠ¶æ€ï¼Œç„¶åä½¿ç”¨`setState`æ›´æ–°å®ƒã€‚`useState`å°†åˆå§‹çŠ¶æ€ä½œä¸ºå‚æ•°ï¼Œè¿”å›å½“å‰çŠ¶æ€å’Œæ›´æ–°æ‰€è¿°çŠ¶æ€çš„å‡½æ•°ã€‚æ­¤çŠ¶æ€å°†ç”¨äºæ”¶é›†ç”¨æˆ·è¾“å…¥ã€‚æˆ‘ä»¬å°†è¿™ä¸ªè¾“å…¥ä½œä¸ºæŸ¥è¯¢æä¾›ç»™`variables`ï¼Œç„¶å`useQuery`è¿”å›å“åº”ã€‚

ä¸–ç•Œä¸Šäº¤æ˜“é‡æœ€å¤§çš„è´§å¸å¯¹è¢«ç§°ä¸ºä¸»è¦è´§å¸ã€‚å®ƒä»¬æ„æˆäº†å¤–æ±‡å¸‚åœºçš„æœ€å¤§ä»½é¢ï¼Œçº¦å  85%ï¼Œå› æ­¤å®ƒä»¬è¡¨ç°å‡ºé«˜å¸‚åœºæµåŠ¨æ€§ã€‚ä¸»è¦æœ‰:æ¬§å…ƒ/ç¾å…ƒï¼Œç¾å…ƒ/æ—¥å…ƒï¼Œè‹±é•‘/ç¾å…ƒï¼Œæ¾³å…ƒ/ç¾å…ƒï¼Œç¾å…ƒ/ç‘å£«æ³•éƒï¼Œæ–°è¥¿å…°å…ƒ/ç¾å…ƒï¼Œç¾å…ƒ/åŠ æ‹¿å¤§å…ƒã€‚è¿™äº›æ˜¯æˆ‘ä»¬å°†æä¾›ç»™ç”¨æˆ·çš„è´§å¸å¯¹ã€‚

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`select`åˆ—è¡¨ï¼Œæ¯ä¸ª`option`ä¸ºæˆ‘ä»¬çš„æŸ¥è¯¢æä¾›å˜é‡ã€‚è¿™äº›é€‰é¡¹æ„æˆäº†ä¸“ä¸šã€‚Apollo æä¾›äº†ä¸€ä¸ª`refetch`å‡½æ•°ï¼Œå®ƒå°†é‡æ–°åŠ è½½ç»™å®šçš„æŸ¥è¯¢ã€‚æˆ‘ä»¬å°†è¿™ä¸ªåŠŸèƒ½æ”¾åœ¨ä¸€ä¸ªæŒ‰é’®ä¸­ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥è·å¾—æœ€æ–°çš„æ•°æ®ã€‚æ³¨æ„ä¸è¦è¿‡äºé¢‘ç¹åœ° ping Alpha Vantage APIã€‚å¦‚æœä½ å‘é€å¤ªå¤šè¯·æ±‚ï¼Œä»–ä»¬ä¼šå¾ˆå¤§æ–¹åœ°ç»™ä½ å‡ ç§’é’Ÿçš„è¶…æ—¶æ—¶é—´ã€‚æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥æ€è€ƒä½ çš„å‚²æ…¢ã€‚

æˆ‘ä»¬çš„æ•°æ®é€šè¿‡`data.currencyPairInfo`è¿”å›ç»™æˆ‘ä»¬ã€‚æˆ‘ä»¬æ˜ å°„æ‰€è¿°æ•°æ®å¹¶å°†å…¶æä¾›ç»™ DOMã€‚ä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬æ­£åœ¨æ¸²æŸ“`__typename: PairDisplay`ã€‚Apollo å®¢æˆ·ç«¯ä½¿ç”¨`__typename`å’Œ`id`å­—æ®µæ¥å¤„ç†ç¼“å­˜æ›´æ–°ã€‚å¦‚æœæ‚¨æŸ¥è¯¢ä¸€ä¸ªä¸åŒçš„è´§å¸å¯¹ï¼Œç„¶åå†æ¬¡æŸ¥è¯¢åŸå§‹è´§å¸å¯¹ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°å…ˆå‰çš„è´§å¸å¯¹æ•°æ®å¯ä»¥é€šè¿‡`apollo-cache-inmemory`ç«‹å³è·å¾—ã€‚

æˆ‘ä¸èƒ½è¿™æ ·ç›¯ç€æˆ‘ä»¬å‹åœ¨å·¦è¾¹çš„æ•°æ®ã€‚è¿›å…¥ index.cssï¼Œåœ¨`body`ä¸­æ·»åŠ ä¸€ä¸ªå¿«é€Ÿçš„`text-align: center`ã€‚

å…ˆä¸è¯´è¿™ä¸ªï¼Œè®©æˆ‘ä»¬æ¥æ¸…ç†ä¸€ä¸‹ã€‚åœ¨`src`ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œå‘½åä¸º`components`ã€‚åœ¨`components`é‡Œé¢åˆ›å»ºä¸€ä¸ª`pairs`æ–‡ä»¶å¤¹ã€‚åœ¨`pairs`ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶`SelectList.js`å¹¶æ’å…¥ä»¥ä¸‹å†…å®¹:

```
// SelectList.js

import React from 'react'

const SelectList = ({ fc, setFc, tc, setTc }) => (
  <select
    value={`${fc}/${tc}`}
    onChange={e => {
      const [ fromCurrency, toCurrency ] = e.target.value.split('/')
      setFc(fromCurrency)
      setTc(toCurrency)
    }}>
    <option>EUR/USD</option>
    <option>JPY/USD</option>
    <option>GBP/USD</option>
    <option>AUD/USD</option>
    <option>USD/CHF</option>
    <option>NZD/USD</option>
    <option>USD/CAD</option>
  </select>
)

export default SelectList 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å›åˆ° Landing.js ç”¨`SelectList`æ›¿æ¢`select`ï¼Œå¹¶ä¼ é€’å¿…è¦çš„é“å…·ã€‚

```
 import React, { useState } from 'react'
import { useQuery } from '@apollo/react-hooks' 
import { CURRENCY_PAIR_INFO } from '../graphql/queries/currencyPairInfo'
+import SelectList from '../components/SelectList' 
const Landing = () => {
  const [ fc, setFc ] = useState('EUR'),
        [ tc, setTc ] = useState('USD'),
        { data, loading, error, refetch } = useQuery(CURRENCY_PAIR_INFO, {
          variables: { fc, tc }
        })

  if(loading) return <p>Loading...</p>
  if(error) return <button onClick={() => refetch()}>Retry</button>

  return data && (
    <section>
      <h3>Currency Exchange</h3>
      <div>
+       <SelectList fc={fc} tc={tc} setFc={setFc} setTc={setTc} />
        <button onClick={() => refetch()}>refresh</button>
      </div>
      <div className='landing_pair_data'>
        { data.currencyPairInfo && Object.keys(data.currencyPairInfo).map(val => (
          <div key={val} className='data'>
            <p><span>{val}: </span>{ data.currencyPairInfo[val] }</p>
          </div>
        ))}
      </div>
    </section>
  )
}

export default Landing 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½å¤šäº†ï¼ç°åœ¨æˆ‘ä»¬ä» Aplha Vantage API æ¥æ”¶æ•°æ®ï¼Œè®©æˆ‘ä»¬å¼€å§‹å¯¼èˆªã€‚æ‰“å¼€`App.js`å¹¶è¿›è¡Œä»¥ä¸‹è°ƒæ•´:

```
// App.js

import React from 'react'
import { Route, Switch } from 'react-router-dom'

import Landing from './pages/Landing'
import Navbar from './components/navbar/Navbar'

const App = () => (
  <main>
    <div className='navbar'><Navbar /></div>
    <Switch>
      <Route exact path='/' component={ Landing } />
    </Switch>
  </main>
)

export default App 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä»`react-router-dom`å¯¼å…¥`Switch`å’Œä¸€ä¸ªæˆ‘ä»¬å°†è¦åˆ›å»ºçš„åä¸º`Navbar`çš„æ–‡ä»¶ã€‚`Switch`ç»„ä»¶å‘ˆç°åŒ¹é…è·¯çº¿`path`çš„ç¬¬ä¸€ä¸ªå­©å­(`Route`æˆ–`Redirect`)å¹¶æ˜¾ç¤ºå®ƒã€‚

åœ¨`components`ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œå‘½åä¸º`navbar`ã€‚åœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ªåä¸º`Navbar.js`çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ’å…¥ä»¥ä¸‹å†…å®¹:

```
// Navbar.js

import React from 'react'
import { NavLink } from 'react-router-dom'

import './Navbar.css'

const Navbar = () => (
  <div className='navigation'>
    <header><NavLink exact to='/'>Forex</NavLink></header>
    <ul>
      <li><NavLink exact to="/login">Login</NavLink></li>
      <li><NavLink exact to='/register'>Sign Up</NavLink></li>
      <li>Logout</li>
    </ul>
  </div>
)

export default Navbar 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ç¯‡æ–‡ç« ä¸æ˜¯å…³äºé€ å‹çš„ã€‚æˆ‘æƒ³å°å¿ƒä¸è¦ç”¨æ ·å¼åŒ–çš„ç»„ä»¶æ±¡æŸ“ä»£ç åº“ï¼Œè¿™æ ·æ—¢è´¹æ—¶åˆè®©ä¸€äº›äººéš¾ä»¥ç†è§£é€»è¾‘ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘å†³å®šåªä½¿ç”¨ä¸¤ä¸ª CSS æ–‡ä»¶:`index.css`å’Œ`Navbar.css`ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å¾ˆå°‘çš„ CSSâ€”â€”ä»…å¤Ÿé»‘æš—æ¨¡å¼ä½¿ç”¨ã€‚ğŸ˜

åœ¨`navbar`æ–‡ä»¶å¤¹ä¸­åˆ›å»º`Navbar.css`å¹¶æ’å…¥ä¸‹é¢çš„ä»£ç :

```
/* Navbar.css */

.navbar { margin-bottom: 55px; }

.navigation {
  position: fixed;
  left: 0;
  top: 0;
  background: var(--secondary-color);
  width: 100vw;
  height: 55px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.navigation header a {
  text-decoration: none;
  color: var(--header-text-color);
  margin-left: 10px;
}
.navigation ul {
  display: flex;
  list-style: none;
  margin-right: 15px;
}

.navigation li {
  margin: 0 15px;
  color: var(--header-text-color);
}
.navigation li:hover {
  cursor: pointer;
  color: var(--main-color);
}

.navigation a {
  text-decoration: none;
  color: var(--header-text-color);
}
.navigation a:hover,
.navigation a:active,
.navigation a.active {
  color: var(--main-color);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°†`index.css`è°ƒæ•´åˆ°å¦‚ä¸‹:

```
/* index.css */

/* Global */

* {
  --main-color: rgb(0,0,0);
  --secondary-color: rgb(55,131,194);
  --text-color: rgba(200,200,200, 0.6);
  --header-text-color: rgb(200,200,200);
}

body {
  font-family: Arial, Helvetica, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  margin: 0;
  background: var(--main-color);
  text-align: center;
  box-sizing: border-box;
}

a { text-decoration: none;  color: rgb(0,0,0); }
section { padding-top: 50px; }
span { color: var(--secondary-color); }
p { color: var(--text-color); font-size: 14px; }
p:hover { color: rgba(200,200,200, 0.4); }
h1,h2, h3, h4 { color: var(--header-text-color); }
button, select { cursor: pointer; }

/* Landing && Pair */

.landing_pair_data {
  margin: 20px 0 20px calc(50% - 170px);
  padding: 20px;
  width: 300px;
  border-radius: 20px;
  box-shadow: 1px 1px 1px 1px var(--secondary-color), 
    -1px -1px 1px 1px var(--secondary-color);
}

.data {
  border-bottom: 1px solid var(--secondary-color);
  width: 280px;
  margin-left: calc(50% - 140px);
  text-align: start;
  text-transform: capitalize;
  padding: 2px 2px 2px 0;
}

.modal {
  position: absolute;
  background: rgb(225,225,225);
  color: var(--main-color);
  width: 280px;
  left: calc(50% - 160px);
  top: 25%;
  padding: 20px;
  animation: modal .5s;
}
.modal p {
  color: var(--main-color);
}

@keyframes modal {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Account  */

.pair_divs {
  padding: 20; 
  border: 1px solid rgba(255,255,255,0.1); 
  border-radius: 5px;
  width: 400px; 
  margin: 10px auto;
}
.pair_divs p {
  text-align: start;
  padding-left: 20px;
}
.pair_divs:hover {
  border: 1px solid rgba(55,131,194, 0.3);
}

/* Chart  */

.chartData {  
  padding-top: 50px;  
  height: calc(100vh - 105px); 
}
.chartData form input,
.chartData form button {
  margin: 10px;
}

/* Login && Register */

.login input,
.register input {
  padding: 5px; 
  margin: 10px 0px; 
  width: 60%;
  max-width: 400px;
  background: var(--main-color);
  color: var(--header-text-color);
  font-size: 13px;
}

.login form,
.register form {
  display: flex; 
  justify-content: center; 
  flex-direction: column; 
  align-items: center;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸¤ä¸ªæ–‡ä»¶ä»£è¡¨äº†æˆ‘ä»¬æ•´ä¸ª CSSã€‚ä¿å­˜æ‚¨çš„æ–‡ä»¶ï¼Œå¹¶æŸ¥çœ‹æµè§ˆå™¨ã€‚

[![navbar](../Images/1e9b20e71d107b8471a591e52a516838.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--PLOEWWFQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/marlonanthony/currency_exchange/blob/master/images/navbar.png%3Fraw%3Dtrue)

ç°åœ¨æˆ‘ä»¬æœ‰äº†å¯¼èˆªæ¡ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ³¨å†Œè·¯ç”±ã€‚åœ¨`graphql/mutations`ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`register.js`çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ’å…¥ä»¥ä¸‹ä»£ç :

```
// graphql/mutations/register.js

import gql from 'graphql-tag'

export const REGISTERMUTATION = gql`
  mutation RegisterMutation($email: String!, $password: String!, $name: String!) {
    register(email: $email, password: $password, name: $name)  
  }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`components`ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œå‘½åä¸º`auth`ã€‚åœ¨`auth`å†…éƒ¨åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå‘½åä¸º`Register.js`ã€‚æ’å…¥ä»¥ä¸‹å†…å®¹:

```
// components/auth/Register.js

import React, { useState } from 'react'
import { useMutation } from '@apollo/react-hooks'

import { REGISTERMUTATION } from '../../graphql/mutations/register'

export default function Register(props) {
  const [ email, setEmail ] = useState(''),
        [ password, setPassword ] = useState(''),
        [ name, setName ] = useState(''),
        [ register, { error } ] = useMutation(REGISTERMUTATION, {
          variables: { email, password, name }
        })

  return (
    <div className='register'>
      <form onSubmit={ async e => {
        e.preventDefault()
        await register()
        props.history.push('/login')
      }}>
        <h2>Sign Up</h2>
        <input
          required
          name='email'
          type='email'
          value={ email }
          onChange={ e => setEmail(e.target.value) }
          placeholder='Enter your email'
        />
        <input
          required
          type='password'
          value={ password }
          onChange={ e => setPassword(e.target.value) }
          placeholder='Enter your password'
        />
        <input
          required
          type='text'
          value={ name }
          onChange={ e => setName(e.target.value) }
          placeholder='Enter your name'
        />
        { error && <p>{ error.message }</p> }
        <button>SignUp</button>
      </form>
    </div>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª`form`æ¥æ”¶é›†ç”¨æˆ·æ•°æ®ï¼Œå¹¶å°†å…¶æ”¾å…¥ç»„ä»¶çŠ¶æ€ã€‚`onSubmit`ï¼Œæˆ‘ä»¬å°†çŠ¶æ€ä½œä¸º`variables`ä¼ é€’ç»™`register`çªå˜ã€‚ç”±äºæˆ‘ä»¬å°†ç”µå­é‚®ä»¶è¾“å…¥`type`è®¾ç½®ä¸ºâ€œç”µå­é‚®ä»¶â€å¹¶ä¼ é€’äº†`required`å±æ€§ï¼Œæˆ‘ä»¬ä¸ä¼šçœ‹åˆ°æˆ‘ä»¬åœ¨åç«¯æŠ›å‡ºçš„é”™è¯¯ã€‚æˆ‘ä»¬ä¸æ¯”è¾ƒå¯†ç ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°é”™è¯¯ã€‚æˆ‘ä»¬åˆ›å»ºçš„å”¯ä¸€é”™è¯¯æ˜¯â€œç”¨æˆ·å·²ç»å­˜åœ¨â€è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¸æ£€æŸ¥å•ä¸ªé”™è¯¯ï¼Œè€Œåªæ˜¯åœ¨æ‰€æœ‰è¾“å…¥ä¸‹æ˜¾ç¤ºé”™è¯¯ã€‚

æ‰“å¼€`App.js`ã€‚å¯¼å…¥`Register.js`å¹¶åˆ›å»ºæ³¨å†Œç»„ä»¶`Route`ã€‚

```
// App.js

import React from 'react'
import { Route, Switch } from 'react-router-dom'

import Landing from './pages/Landing'
import Navbar from './components/navbar/Navbar'
import Register from './components/auth/Register'

const App = () => (
  <main>
    <div className='navbar'><Navbar /></div>
    <Switch>
      <Route exact path='/' component={ Landing } />
      <Route path='/register' component={ Register } />
    </Switch>
  </main>
)

export default App 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨å¯¼èˆªåˆ°æˆ‘ä»¬çš„æ³¨å†Œç»„ä»¶ï¼Œæ‚¨å°†èƒ½å¤Ÿæ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥æˆ‘ä»¬çš„[æ•°æ®åº“](https://www.mongodb.com/cloud/atlas)æ¥ç¡®è®¤è¿™ä¸€ç‚¹ã€‚

åœ¨`graphql/mutations`ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå‘½åä¸º`login.js`å¹¶æ’å…¥ä»¥ä¸‹å†…å®¹:

```
// graphql/mutations/login.js

import gql from 'graphql-tag'

export const LOGINMUTATION = gql`
  mutation LoginMutation($email: String!, $password: String!) {
    login(email: $email, password: $password) {
      id
      email
      name
    }
  }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`graphql/queries`ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`me.js`çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :

```
// graphql/queries/me.js

import gql from 'graphql-tag'

export const MEQUERY = gql`
  query MeQuery {
    me {
      id
      email 
      name
      bankroll
    }
  }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è½¬åˆ°`auth`æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå‘½åä¸º`Login.js`ã€‚è°ƒæ•´ Login.jsï¼Œä½¿å…¶ç±»ä¼¼äºä¸‹é¢çš„ä»£ç :

```
// Login.js

import React, { useState } from 'react'
import { useMutation } from '@apollo/react-hooks'

import { MEQUERY } from '../../graphql/queries/me'
import { LOGINMUTATION } from '../../graphql/mutations/login'

export default function Login(props) {
  const [ email, setEmail ] = useState(''),
        [ password, setPassword ] = useState(''),
        [ login, { error } ] = useMutation(LOGINMUTATION, {
          variables: { email, password },
          update: (cache, { data }) => {
            if(!data || !data.login) return 
            cache.reset()
            cache.writeQuery({
              query: MEQUERY,
              data: { me: data.login }
            })
          }
        })

  return (
    <div className='login'>
      <form onSubmit={ async e => {
        e.preventDefault()
        await login()
        props.history.push('/') 
      }}>
        <h2>Login</h2>
        <input
          required
          name='email'
          type='email'
          value={ email }
          onChange={ e => setEmail(e.target.value) }
          placeholder='Enter your email'
        />
        <input
          required
          type='password'
          value={ password }
          onChange={ e => setPassword(e.target.value) }
          placeholder='Enter your password'
        />
        { error && <p>{ error.message }</p> }
        <button type='submit'>Login</button>
      </form>
    </div>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬è®©ç”¨æˆ·ç™»å½•ï¼Œå¹¶å°†ä»–ä»¬é‡å®šå‘å›ä¸»é¡µã€‚ApolloClient ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª`update`å‡½æ•°ï¼Œä¸€æ—¦ç”¨æˆ·ç™»å½•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ›´æ–°ç¼“å­˜ã€‚ä¸€æ—¦ç”¨æˆ·æˆåŠŸç™»å½•ï¼Œæˆ‘ä»¬å°±`update`ç¼“å­˜ï¼Œä»¥ä¾¿`me`æŸ¥è¯¢ä»£è¡¨å½“å‰ç”¨æˆ·ã€‚

ä»æ–‡æ¡£ä¸­:

> è°ƒç”¨ update å‡½æ•°æ—¶ï¼Œå°† Apollo ç¼“å­˜ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚ç¼“å­˜æœ‰å‡ ä¸ªå®ç”¨å‡½æ•°ï¼Œæ¯”å¦‚ cache.readQuery å’Œ cache.writeQueryï¼Œå®ƒä»¬å…è®¸æ‚¨ä½¿ç”¨ GraphQL å¯¹ç¼“å­˜è¿›è¡Œè¯»å†™æŸ¥è¯¢ï¼Œå°±åƒå®ƒæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ä¸€æ ·ã€‚è¿˜æœ‰å…¶ä»–ç¼“å­˜æ–¹æ³•ï¼Œå¦‚ cache.readFragmentã€cache.writeFragment å’Œ cache.writeDataï¼Œå¦‚æœæ‚¨æœ‰å…´è¶£ï¼Œå¯ä»¥åœ¨æˆ‘ä»¬è¯¦ç»†çš„ç¼“å­˜æŒ‡å—ä¸­äº†è§£è¿™äº›æ–¹æ³•ã€‚
> 
> æ³¨æ„:update å‡½æ•°æ¥æ”¶ç¼“å­˜è€Œä¸æ˜¯å®¢æˆ·æœºä½œä¸ºå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚è¯¥ç¼“å­˜é€šå¸¸æ˜¯ InMemoryCache çš„ä¸€ä¸ªå®ä¾‹ï¼Œåœ¨åˆ›å»ºå®¢æˆ·ç«¯æ—¶æä¾›ç»™ ApolloClient æ„é€ å‡½æ•°ã€‚å¯¹äº update å‡½æ•°ï¼Œå½“æ‚¨è°ƒç”¨ cache.writeQuery æ—¶ï¼Œupdate ä¼šåœ¨å†…éƒ¨è°ƒç”¨ broadcastQueriesï¼Œå› æ­¤ä¾¦å¬æ›´æ”¹çš„æŸ¥è¯¢å°†ä¼šæ›´æ–°ã€‚ä½†æ˜¯ï¼Œè¿™ç§å¹¿æ’­è¡Œä¸ºåœ¨ cache.writeQuery ä¹‹åä¼šå‘ç”Ÿå˜åŒ–ï¼Œåªåœ¨ update å‡½æ•°ä¸­å‘ç”Ÿã€‚åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹ï¼Œcache.writeQuery åªä¼šå†™å…¥ç¼“å­˜ï¼Œè€Œä¸ä¼šç«‹å³å°†æ›´æ”¹ä¼ æ’­åˆ°è§†å›¾å±‚ã€‚ä¸ºäº†é¿å…è¿™ç§æ··æ·†ï¼Œåœ¨å†™å…¥ç¼“å­˜æ—¶æœ€å¥½ä½¿ç”¨ client.writeQueryã€‚
> 
> update å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„æ•°æ®å±æ€§åŒ…å«æ‚¨çš„çªå˜ç»“æœã€‚å¦‚æœæ‚¨æŒ‡å®šä¸€ä¸ªä¹è§‚å“åº”ï¼Œæ‚¨çš„æ›´æ–°å‡½æ•°å°†è¢«è°ƒç”¨ä¸¤æ¬¡:ä¸€æ¬¡ä½¿ç”¨æ‚¨çš„ä¹è§‚ç»“æœï¼Œå¦ä¸€æ¬¡ä½¿ç”¨æ‚¨çš„å®é™…ç»“æœã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ‚¨çš„å˜å¼‚ç»“æœé€šè¿‡ cache.writeQuery æ›´æ–°ç¼“å­˜ã€‚

å¦‚æœç”¨æˆ·è¾“å…¥äº†æ— æ•ˆçš„ç”µå­é‚®ä»¶ï¼Œä»–ä»¬ä¼šçœ‹åˆ° HTML é”™è¯¯ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬çš„ã€‚å¦‚æœç”¨æˆ·è¾“å…¥äº†æœ‰æ•ˆä½†ä¸æ­£ç¡®çš„ç”µå­é‚®ä»¶ï¼Œæˆ‘ä»¬ä¼šæŠ›å‡ºâ€œç”µå­é‚®ä»¶æˆ–å¯†ç ä¸æ­£ç¡®ï¼â€å¦‚æœç”¨æˆ·è¾“å…¥äº†ä¸æ­£ç¡®çš„å¯†ç ï¼Œæˆ‘ä»¬ä¼šæŠ›å‡ºå®Œå…¨ç›¸åŒçš„é”™è¯¯ï¼Œè®©åäººæ›´éš¾ç ´è¯‘å“ªä¸ªè¾“å…¥æ˜¯ä¸æ­£ç¡®çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¸æƒ³åœ¨é”™è¯¯å‘ç”Ÿçš„åœ°æ–¹æ˜¾ç¤ºé”™è¯¯ï¼Œä»¥å…æ³„éœ²ç§˜å¯†ã€‚

æ‰“å¼€ App.js å¹¶è¿›è¡Œä»¥ä¸‹è°ƒæ•´:

```
// App.js

import React from 'react'
import { Route, Switch } from 'react-router-dom'

import Landing from './pages/Landing'
import Navbar from './components/navbar/Navbar'
import Register from './components/auth/Register'
import Login from './components/auth/Login'

const App = () => (
  <Switch>
    <Route path='/login' component={ Login } />
    <Route path='/' render={() => (
      <main>
        <div className='navbar'><Navbar /></div>
        <Route exact path='/' component={ Landing } />
        <Route path='/register' component={ Register } />
      </main>
    )} />
  </Switch>
)

export default App 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› ä¸ºæˆ‘ä»¬åœ¨ç”¨æˆ·ç™»å½•ä¹‹å‰æ¸…ç©ºäº†ç¼“å­˜ï¼Œå¹¶ä¸” navbar åˆ©ç”¨`me`æŸ¥è¯¢è¿›è¡Œæˆæƒï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æŠŠç™»å½•ç»„ä»¶æ”¾åœ¨ navbar ä¹‹å¤–ã€‚

æˆ‘ä»¬ç°åœ¨å¯ä»¥ç™»å½•ä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶å°†ç”¨æˆ·çš„ä¼šè¯ id ä¿å­˜åœ¨ä¸€ä¸ª cookie ä¸­ã€‚å¦‚æœä½ æ‰“å¼€ä½ çš„ DevToolsï¼Œåœ¨ Application æ–‡ä»¶å¤¹ä¸‹ï¼Œåœ¨ Cookies æ ‡ç­¾é‡Œé¢ï¼Œä½ ä¼šçœ‹åˆ°æˆ‘ä»¬çš„ cookieã€‚

å¦‚æœæˆ‘ä»¬ä¸åœ¨å¯¼èˆªæ¡ä¸ŠåŒæ—¶æ˜¾ç¤ºç™»å½•å’Œæ³¨é”€ï¼Œè¿™å¯èƒ½æ˜¯æœ€å¥½çš„ã€‚åƒè¿™æ ·è°ƒæ•´ Navbar.jsã€‘

```
// Navbar.js

import React from 'react'
import { NavLink, Redirect } from 'react-router-dom'
import { useQuery } from '@apollo/react-hooks'

import { MEQUERY } from '../../graphql/queries/me'
import './Navbar.css'

const Navbar = () => {
  const { data, loading, error } = useQuery(MEQUERY)

  if(loading) return <p>Loading....</p>
  if(error) return <Redirect to='/login' />
  if(!data) return <p>This is unfortunate</p>

  return (
    <div className='navigation'>
      <header><NavLink exact to='/'>Forex</NavLink></header>
      { !data.me ? (
        <ul>
          <li><NavLink exact to='/login'>Login</NavLink></li>
          <li><NavLink exact to='/register'>SignUp</NavLink></li>
        </ul> ) 
      : (
        <ul>
          <li>Logout</li>
        </ul>
      )}
    </div>
  )
}

export default Navbar 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æˆ‘ä»¬çš„`me`æŸ¥è¯¢å‡ºé”™çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨`Redirect`ç”¨æˆ·ç™»å½•ã€‚å¦‚æœç”¨æˆ·è¿”å›ï¼Œæˆ‘ä»¬æ˜¾ç¤ºæ³¨é”€ï¼Œ`else`ç™»å½•/æ³¨å†Œã€‚ç›®å‰æ³¨é”€ä¸æ˜¯å¾ˆæœ‰ç”¨ã€‚æˆ‘ä»¬ä»å˜å¼‚å¼€å§‹ã€‚åœ¨`graphql/mutations`ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`logout.js`çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ’å…¥ä¸‹é¢çš„ä»£ç ã€‚

```
// graphql/mutations/logout.js

import gql from 'graphql-tag'

export const LOGOUT_MUTATION = gql`
  mutation Logout {
    logout
  }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`components/auth`ä¸­åˆ›å»º`Logout.js`ï¼Œå¹¶æ’å…¥ä»¥ä¸‹å†…å®¹:

```
// components/auth/Logout.js

import React from 'react' 
import { useMutation } from '@apollo/react-hooks'
import { withRouter } from 'react-router-dom'

import { MEQUERY } from '../../graphql/queries/me'
import { LOGOUT_MUTATION } from '../../graphql/mutations/logout'

const Logout = props => {
  const [logout] = useMutation(LOGOUT_MUTATION, {
    update: cache => {
      cache.writeQuery({
        query: MEQUERY,
        data: { me: null }
      })
      props.history.push('/')
    }
  })

  return <div onClick={() => logout()}>Logout</div>
}

export default withRouter(Logout) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ç”¨æˆ·ç‚¹å‡»`Logout`æ—¶ï¼Œä¼šå‘ç”Ÿä¸‰ä»¶äº‹:

*   `logout`çªå˜ç ´åäº†`req`å¯¹è±¡ä¸Šçš„ä¼šè¯ã€‚

*   æˆ‘ä»¬æ›´æ–°ç¼“å­˜ï¼Œä½¿`me`æŸ¥è¯¢è¿”å›`null`ã€‚

*   æˆ‘ä»¬å°†ç”¨æˆ·é‡å®šå‘åˆ°ä¸»é¡µã€‚

å¦‚æœä¸€ä¸ªç»„ä»¶æ²¡æœ‰è¢« React Router æ¸²æŸ“(ä½œä¸º`component`é“å…·ä¼ é€’ç»™`Route`)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸èƒ½è®¿é—®`history.push`ã€‚React è·¯ç”±å™¨çš„ HOC `withRouter`è®©æˆ‘ä»¬å¯ä»¥é€šè¿‡ props è®¿é—®å†å²å¯¹è±¡ã€‚æˆ‘ä»¬åˆ©ç”¨`props.history.push('/')`å°†ç”¨æˆ·å¯¼èˆªå›ä¸»é¡µã€‚åœ¨å¯¼å‡ºæ–‡ä»¶æ—¶ï¼Œä¸è¦å¿˜è®°ç”¨`withRouter`å°†æ³¨é”€ç»„ä»¶åŒ…è£…èµ·æ¥ã€‚

å°†`Logout.js`å¯¼å…¥`Navbar.js`å¹¶ç”¨æˆ‘ä»¬çš„æ–°ç»„ä»¶æ›¿æ¢`<li><Logout></li>`ã€‚è°ƒæ•´åï¼Œæ‚¨å°†æ³¨é”€ï¼

æˆ‘ä»¬ç°åœ¨å¯ä»¥ä¸“æ³¨äºå…è®¸ç”¨æˆ·æ‰“å¼€å¤šå¤´/ç©ºå¤´å¤´å¯¸ã€‚æ‰“å¼€`Landing.js`å¹¶è¿›è¡Œä»¥ä¸‹è°ƒæ•´:

```
// Landing.js

import React, { useState } from 'react'
import { useQuery } from '@apollo/react-hooks'

import { MEQUERY } from '../graphql/queries/me'
import { CURRENCY_PAIR_INFO } from '../graphql/queries/currencyPairInfo'
import SelectList from '../components/pairs/SelectList'
import OpenLongPosition from '../components/positions/OpenLongPosition'

const Landing = () => {
  const [ fc, setFc ] = useState('EUR'),
        [ tc, setTc ] = useState('USD'),
        [ askPrice, setAskPrice ] = useState(0),
        [ bidPrice, setBidPrice ] = useState(0),
        [ showModal, setShowModal ] = useState(false),
        user = useQuery(MEQUERY),
        { data, loading, error, refetch } = useQuery(CURRENCY_PAIR_INFO, {
          variables: { fc, tc }
        })

  if(loading) return <p>Loading...</p>
  if(error) return <button onClick={() => refetch()}>Retry</button>

  return data && (
    <section>
      <h2>Currency Exchange</h2>
      { user.data.me && <p>Available Balance { user.data.me.bankroll.toLocaleString()}.00</p> }
      <div>
        <SelectList fc={fc} tc={tc} setFc={setFc} setTc={setTc} />
        <button onClick={() => refetch()}>Refresh</button>
        { user.data.me && (
          <OpenLongPosition
            fc={fc}
            tc={tc}
            pairData={data}
            askPrice={askPrice}
            setAskPrice={setAskPrice}
            showModal={showModal}
            setShowModal={setShowModal}
        />)}
        <button>Sell</button>
      </div>
      <div className='landing_pair_data'>
        { data.currencyPairInfo && Object.keys(data.currencyPairInfo).map(val => (
          <div key={val} className='data'>
            <p><span>{val}: </span>{ data.currencyPairInfo[val] }</p>
          </div>
        ))}
      </div>
    </section>
  )
}

export default Landing 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯¼å…¥`MEQUERY`å’Œä¸€ä¸ªæˆ‘ä»¬éœ€è¦åˆ›å»ºçš„åä¸º`OpenLongPosition`çš„æ–‡ä»¶ã€‚æˆ‘ä»¬é›†æˆäº†`useState`æ¥å­˜å‚¨/æ›´æ–°`askPrice`ã€`bidPrice`ï¼Œå¹¶åˆ‡æ¢ä¸€ä¸ªæ¨¡æ€ã€‚æœ‰äº†ç”¨æˆ·åï¼Œæˆ‘ä»¬æ˜¾ç¤ºä»–ä»¬çš„èµ„é‡‘(å¯ç”¨èµ„é‡‘)ã€‚å¦‚æœç”¨æˆ·æ”¹å˜è´§å¸å¯¹æˆ–åˆ·æ–°æ•°æ®ï¼Œæˆ‘ä»¬ç›¸åº”åœ°æ”¹å˜`askPrice`å’Œ`bidPrice`çš„çŠ¶æ€ã€‚æœ€åï¼Œå¦‚æœæ‰¾åˆ°ä¸€ä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬æ˜¾ç¤ºä¸€ä¸ªâ€œè´­ä¹°â€æŒ‰é’®(`OpenLongPosition`)ã€‚

åœ¨`graphql/mutations`ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå‘½åä¸º`openPosition.js`ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :

```
// openPosition.js

import gql from 'graphql-tag'

export const OPENPOSITION = gql`
  mutation OpenPosition(
    $pair: String!, 
    $lotSize: Int!, 
    $openedAt: Float!, 
    $position: String!
  ) {
    openPosition(
      pair: $pair, 
      lotSize: $lotSize, 
      openedAt: $openedAt, 
      position: $position
    ) {
      success
      message
      pair {
        id
        user
        position
        pair
        lotSize
        openedAt
      }
    }
  }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`graphql/queries`ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`getPairs.js`çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ’å…¥ä»¥ä¸‹ä»£ç :

```
// graphql/queries/getPairs.js

import gql from 'graphql-tag'

export const GETPAIRS = gql`
  query GetPairs {
    getPairs {
      id
      user
      pair
      lotSize
      openedAt
      closedAt
      pipDif
      profitLoss
      open
      position
      createdAt
      updatedAt
    }
  }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`components`ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œå‘½åä¸º`positions`ã€‚åœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ªåä¸º`OpenLongPosition.js`çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :

```
// OpenLongPosition.js

import React from 'react'
import { Link } from 'react-router-dom'
import { useMutation } from '@apollo/react-hooks'

import { OPENPOSITION } from '../../graphql/mutations/openPosition'
import { MEQUERY } from '../../graphql/queries/me'
import { GETPAIRS } from '../../graphql/queries/getPairs'

const OpenLongPosition = ({
  fc, 
  tc, 
  pairData,
  askPrice,
  setAskPrice,
  showModal,
  setShowModal
}) => {

  const [ openPosition, { data, loading, error }] = useMutation(OPENPOSITION, {
    variables: {
      pair: `${fc}/${tc}`,
      lotSize: 100000,
      openedAt: askPrice,
      position: 'long'
    },
    update: cache => {
      const user = cache.readQuery({ query: MEQUERY })
      user.me.bankroll -= 100000
      cache.writeQuery({
        query: MEQUERY,
        data: { me: user.me }
      })
    },
    refetchQueries: [{ query: GETPAIRS }]
  })

  if(loading) return <p>Loading...</p>
  if(error) return <p>{ error.message }</p>

  return openPosition && (
    <>
      <button onClick={ async () => {
        await setAskPrice(+pairData.currencyPairInfo.askPrice)
        alert('Are you sure you want to buy?')
        await openPosition()
        setShowModal(true)
      }}>
        Buy
      </button>
      { data && data.openPosition.message && showModal && (
        <div className='modal'>
          <button onClick={() => setShowModal(false)}>x</button>
          <p>{ data.openPosition.message }</p>
          <p>Currency Pair: { data.openPosition.pair.pair }</p>
          <p>Lot Size: { data.openPosition.pair.lotSize.toLocaleString() }.00</p>
          <p>Opened At: { data.openPosition.pair.openedAt }</p>
          <p>Position: { data.openPosition.pair.position }</p>
          <Link to={{ pathname: '/account', state: { data } }}>
            <button>Details</button>
          </Link>
        </div>
      )}
    </>
  )
}

export default OpenLongPosition 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°†çªå˜ä¼ é€’ç»™æ‰€éœ€çš„å˜é‡ã€‚ä¸€æ—¦ç”¨æˆ·ç‚¹å‡»â€œè´­ä¹°â€æŒ‰é’®ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›æ˜¾ç¤ºä¸€äº›æ•°æ®ï¼Œå¹¶å…è®¸ä»–ä»¬ç¡®è®¤è´­ä¹°ã€‚è¿™é‡Œæˆ‘ä»¬åªæ˜¯ä½¿ç”¨äº†ä¸€ä¸ª`alert`ã€‚ç„¶åå‘ç”¨æˆ·æ˜¾ç¤ºä¸€ä¸ªæè¿°ä»–ä»¬äº¤æ˜“çš„æ¨¡æ€å’Œä¸€ä¸ª`details`æŒ‰é’®ï¼Œå°†ä»–ä»¬é‡å®šå‘åˆ°æˆ‘ä»¬ä»ç„¶éœ€è¦åˆ›å»ºçš„é¡µé¢â€” `Account`ã€‚æ‰“å¼€ MongoDB Atlasï¼Œæ‚¨å°†çœ‹åˆ°æ–°åˆ›å»ºçš„èŒä½ã€‚

Apollo ä¸ºæˆ‘ä»¬æä¾›äº†è®¸å¤šåœ¨çªå˜åæ›´æ–°ç¼“å­˜çš„æ–¹æ³•ã€‚æˆ‘ä»¬å·²ç»åœ¨è¿™ä¸ªé¡¹ç›®ä¸­å®ç°äº†å…¶ä¸­çš„ä¸€äº›ã€‚åœ¨è¿™ä¸ªç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨`refetchQueries`æ¥æ›´æ–°æˆ‘ä»¬çš„é…å¯¹ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æ–‡ä»¶:

> refetchQueries æ˜¯æ›´æ–°ç¼“å­˜æœ€ç®€å•çš„æ–¹æ³•ã€‚ä½¿ç”¨ refetchQueriesï¼Œæ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªè¦åœ¨å˜å¼‚å®Œæˆåè¿è¡Œçš„æŸ¥è¯¢ï¼Œä»¥ä¾¿é‡æ–°æå–å¯èƒ½å—å˜å¼‚å½±å“çš„å­˜å‚¨éƒ¨åˆ†ã€‚

æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å˜å¼‚é’©å­æ¥å—çš„ä¸€äº›é€‰é¡¹ã€‚æŸ¥çœ‹[æ–‡æ¡£](https://www.apollographql.com/docs/react/essentials/mutations/)ä¸­çš„å®Œæ•´åˆ—è¡¨ã€‚

åœ¨æˆ‘ä»¬å¼€å§‹åˆ›å»º`Account`ç»„ä»¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…è®¸ç”¨æˆ·æ‰“å¼€ä¸€ä¸ª`short`ä½ç½®ã€‚æ‰“å¼€`components/positions`ï¼Œæ–°å»ºä¸€ä¸ªåä¸º`OpenShortPosition.js`çš„æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç :

```
// components/positions/OpenShortPosition.js

import React from 'react'
import { Link } from 'react-router-dom'
import { useMutation } from '@apollo/react-hooks'

import { OPENPOSITION } from '../../graphql/mutations/openPosition'
import { MEQUERY } from '../../graphql/queries/me'
import { GETPAIRS } from '../../graphql/queries/getPairs'

const OpenShortPosition = ({
  fc,
  tc,
  pairData,
  bidPrice,
  setBidPrice,
  showModal,
  setShowModal
}) => {
  const [ openPosition, { data, loading, error }] = useMutation(OPENPOSITION, {
    variables: {
      pair: `${fc}/${tc}`, 
      lotSize: 100000, 
      openedAt: bidPrice, 
      position: 'short' 
    },
    update: cache => {
      const user = cache.readQuery({ query: MEQUERY })
      user.me.bankroll -= 100000
      cache.writeQuery({
        query: MEQUERY,
        data: { me: user.me }
      })
    },
    refetchQueries: [{ query: GETPAIRS }]
  })

  if(loading) return <p>Loading...</p>
  if(error) return <p>{ error.message }</p>

  return openPosition && (
    <>
      <button onClick={ async () => {
        await setBidPrice(+pairData.currencyPairInfo.bidPrice)
        alert('Are you sure you want to sell short?')
        await openPosition()
        setShowModal(true) 
      }}>
        Sell
      </button> 
      { data && data.openPosition.message && showModal && ( 
        <div className='modal'>
          <button onClick={() => setShowModal(false)}>x</button>
          <p>{ data && data.openPosition.message }</p>
          <p>Currency Pair: { data.openPosition.pair.pair }</p>
          <p>Lot Size: { data.openPosition.pair.lotSize.toLocaleString() }.00</p>
          <p>Opened At: { data.openPosition.pair.openedAt }</p>
          <p>Position: { data.openPosition.pair.position }</p>
          <Link to={{ pathname: '/account', state: { data } }}>
            <button>Details</button>
          </Link>
        </div>
      )}
    </>
  )
}

export default OpenShortPosition 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œæˆ‘ä»¬åšäº†ä¸åœ¨`OpenLongPosition`ä¸­å®Œå…¨ç›¸åŒçš„äº‹æƒ…ï¼Œé™¤äº†æˆ‘ä»¬ä¼ é€’`bidPrice`è€Œä¸æ˜¯`askPrice`å’Œ`position: short`è€Œä¸æ˜¯`position: long`ä½œä¸ºå‚æ•°ã€‚

å›åˆ° Landing.jsï¼Œç”¨æˆ‘ä»¬æ–°åˆ›å»ºçš„`OpenShortPosition`ç»„ä»¶æ›¿æ¢â€œSellâ€æŒ‰é’®ã€‚

```
// Landing.js

import OpenShortPosition from '../components/positions/OpenShortPosition'

{ user.data.me && (
  <OpenShortPosition
    fc={fc}
    tc={tc}
    pairData={data}
    bidPrice={bidPrice}
    setBidPrice={setBidPrice}
    showModal={showModal}
    setShowModal={setShowModal}
/>)} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ‰äº†å®ƒï¼Œæˆ‘ä»¬çš„ç”¨æˆ·å°±å¯ä»¥å–ç©ºäº†ã€‚æˆ‘ä»¬ä»ç„¶éœ€è¦åˆ›å»ºæˆ‘ä»¬çš„`Account`ç»„ä»¶ã€‚æˆ‘ä»¬å¼€å§‹å§ï¼åœ¨`pages`æ–‡ä»¶å¤¹ä¸­åˆ›å»º`Account.js`å¹¶æ·»åŠ ä¸‹é¢çš„ä»£ç :

```
// Account.js

import React, { useState } from 'react'
import { useQuery } from '@apollo/react-hooks'
import { Link, Redirect } from 'react-router-dom'

import { GETPAIRS } from '../graphql/queries/getPairs'
import { MEQUERY } from '../graphql/queries/me'

const Account = props => {
  const [ open, setOpen ] = useState(true),
        user = useQuery(MEQUERY),
        { data, loading, error } = useQuery(GETPAIRS)

  if(user.error) return <Redirect to='/login' />
  if(!user.data || !user.data.me) return <p>A man has no name.</p>
  if(loading) return <p>Loading...</p>
  if(!data) return <p>Nothing to show!</p>
  if(error) return <p>{ error.message }</p>

  return (
    <section>
      <h2>{ user.me.name }</h2>
      <div>
        <p><span>Available Balance: </span>{ user.me.bankroll.toLocaleString() }.00</p> 
      </div>
      <br />
      { props.location.state &&  (
        <div>
          <h3>New Position</h3>
          <div className='pair_divs'>
            <p><span>Pair: </span>{ props.location.state.data.openPosition.pair.pair }</p>
            <p><span>Lot Size: </span>{ props.location.state.data.openPosition.pair.lotSize.toLocaleString() }.00</p>
            <p><span>Pip Dif: </span>{ props.location.state.data.openPosition.pair.openedAt }</p>
            <p><span>Position: </span>{ props.location.state.data.openPosition.pair.position }</p>
          </div>
        </div>
      )}
      <br />
      <h3>Currency Pairs</h3>
      <button onClick={() => setOpen(true)}>open</button>
      <button onClick={() => setOpen(false)}>closed</button>
      <div>
      { data.getPairs && data.getPairs.map(pair => pair.open && open && (
        <div className='pair_divs' key={pair.id}>
          <Link to={{ pathname: '/pair', state: { pair, me: user.me } }}>
            { pair.pair && <p><span>Currency Pair: </span>{ pair.pair }</p> }
            { pair.lotSize && <p><span>Lot Size: </span>{ pair.lotSize.toLocaleString() }.00</p> }
            { pair.position && <p><span>Position: </span>{ pair.position }</p> }
            { pair.openedAt && <p><span>Opened At: </span>{ pair.openedAt.toFixed(4) }</p> }
            { pair.createdAt && <p><span>Created At: </span>{ new Date(+pair.createdAt).toLocaleString() }</p> }
            { pair.updatedAt && <p><span>Updated At: </span>{ new Date(+pair.updatedAt).toLocaleString() }</p> }
          </Link>
        </div>
      ))}
      { data.getPairs && data.getPairs.map(pair => !pair.open && !open && (
        <div className='pair_divs' key={ pair.id }>
          <div>
            { pair.pair && <p><span>Currency Pair: </span>{ pair.pair }</p> }
            { pair.lotSize && <p><span>Lot Size: </span>{ pair.lotSize.toLocaleString() }.00</p> }
            { pair.position && <p><span>Position: </span>{ pair.position }</p> }
            { pair.openedAt && <p><span>Opened At: </span>{ pair.openedAt.toFixed(4) }</p> }
            { pair.closedAt && <p><span>Closed At: </span>{ pair.closedAt.toFixed(4) }</p> }
            { <p><span>Pip Dif: </span>{ pair.pipDif || 0 }</p> }
            { <p><span>Profit/Loss: </span>{ pair.profitLoss.toFixed(2) || 0 }</p> }
            { pair.createdAt && <p><span>Created At: </span>{ new Date(+pair.createdAt).toLocaleString() }</p> }
            { pair.updatedAt && <p><span>Updated At: </span>{ new Date(+pair.updatedAt).toLocaleString() }</p> }
          </div>
        </div>
      ))}
      </div>
    </section>
  )
}

export default Account 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

React Router çš„`Link`ç»„ä»¶å…è®¸æˆ‘ä»¬åœ¨å°†ç”¨æˆ·å¯¼èˆªåˆ°å¦ä¸€ä¸ªè§†å›¾æ—¶ä¼ é€’çŠ¶æ€ã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨æŸäº›è·¯çº¿ä¸Šæ¸²æŸ“ç‹¬ç‰¹çš„æ™¯è‰²ï¼Œè¿™æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚æˆ‘ä»¬ç”¨å®ƒæ¥æ˜¾ç¤ºç”¨æˆ·åˆšåˆšæ‰“å¼€çš„æ–°å¤´å¯¸â€”â€”å¦‚æœæœ‰çš„è¯ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œå‘æŒ¥åˆ›æ„ï¼Œä½†æˆ‘ä»¬ä¼šä¿æŒç®€å•ï¼Œåªæ˜¾ç¤ºä¸€äº›å…³äºæ–°èŒä½çš„æ•°æ®ã€‚

åœ¨æ–°ä½ç½®(å¦‚æœæœ‰)ä¸‹ï¼Œæˆ‘ä»¬æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·çš„ä½ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹æ˜¾ç¤ºå¼€æ”¾ä½ç½®ï¼Œä½†æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæŒ‰é’®åœ¨å¼€æ”¾å’Œå…³é—­ä¹‹é—´åˆ‡æ¢ã€‚å¦‚æœå¤´å¯¸æœªç»“ï¼Œç”¨æˆ·å¯ä»¥ç‚¹å‡»è´§å¸å¯¹ã€‚è¿™å°†æŠŠä»–ä»¬å¯¼èˆªåˆ°`/pair`(æˆ‘ä»¬éœ€è¦åˆ›å»ºå®ƒ)å¹¶æä¾›è¿›ä¸€æ­¥çš„é€‰é¡¹ã€‚è¿™ä¸ªç»„ä»¶æœ‰ç‚¹å†—é•¿ã€‚æˆ‘ä»¬ä¸€ä¼šå„¿ä¼šé‡æ„ã€‚

è®©æˆ‘ä»¬å°†`Account.js`å¯¼å…¥ App.js å¹¶åˆ›å»ºå®ƒçš„`Route`ã€‚

```
// App.js

import React from 'react'
import { Route, Switch } from 'react-router-dom'

import Landing from './pages/Landing'
import Navbar from './components/navbar/Navbar'
import Register from './components/auth/Register'
import Login from './components/auth/Login'
import Account from './pages/Account'

const App = () => (
  <Switch>
    <Route path='/login' component={ Login } />
    <Route path='/' render={() => (
      <main>
        <div className='navbar'><Navbar /></div>
        <Route exact path='/' component={ Landing } />
        <Route path='/register' component={ Register } />
        <Route path='/account' component={ Account } />
      </main>
    )} />
  </Switch>
)

export default App 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬è¿˜å¸Œæœ›å½“ç”¨æˆ·ç™»å½•æ—¶å¯ä»¥ä»å¯¼èˆªæ è®¿é—®`Account`ã€‚

```
// Navbar.js

return (
  <ul>
    <li><NavLink to='/account'>Account</NavLink></li>
    <li><Logout /></li>
  </ul>
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ä»å¯¼èˆªæ å¯¼èˆªåˆ°`/account`æ—¶ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æ²¡æœ‰æ˜¾ç¤ºâ€œæ–°ä½ç½®â€ã€‚é…·ï¼ç°åœ¨è®©æˆ‘ä»¬é‡æ„`Account.js`å¹¶æ·»åŠ ä¸€äº›åŠŸèƒ½ã€‚åœ¨`components/pairs`ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`NewPosition.js`çš„æ–°æ–‡ä»¶ã€‚ä»`Account.js`ä¸­å‰ªåˆ‡ä»¥ä¸‹ä»£ç ï¼Œå¹¶å°†å…¶æ’å…¥åˆ°æ‚¨æ–°åˆ›å»ºçš„æ–‡ä»¶ä¸­ã€‚

```
// components/pairs/NewPosition.js

import React from 'react'

export default function NewPosition({ state }) {
  return (
    <div>
      <h3>New Position</h3>
      <div className='pair_divs' style={{ textAlign: 'center' }}>
        <p><span>Pair: </span>{ state.data.openPosition.pair.pair }</p>
        <p><span>Lot Size: </span>{ state.data.openPosition.pair.lotSize.toLocaleString() }.00</p>
        <p><span>Pip Dif: </span>{ state.data.openPosition.pair.openedAt }</p>
        <p><span>Position: </span>{ state.data.openPosition.pair.position }</p>
      </div>
    </div>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå‘½åä¸º`Pairs.js`ã€‚ä»`Account.js`ä¸­å‰ªåˆ‡ä»¥ä¸‹ä»£ç ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚

```
// components/pairs/Pairs.js

import React from 'react'
import { Link } from 'react-router-dom'

const Pairs = ({ data, open, user }) => (
  <div>
    { data.getPairs && data.getPairs.map(pair => pair.open && open && (
      <div className='pair_divs' key={ pair.id }>
        <Link to={{ pathname: '/pair', state: { pair, me: user.data.me } }}>
          { pair.pair && <p><span>Currency Pair: </span>{ pair.pair }</p> }
          { pair.lotSize && <p><span>Lot Size: </span>{ pair.lotSize.toLocaleString() }.00</p> }
          { pair.position && <p><span>Position: </span>{ pair.position }</p> }
          { pair.openedAt && <p><span>Opened At: </span>{ pair.openedAt.toFixed(4) }</p> }
          { pair.createdAt && <p><span>Created At: </span>{ new Date(+pair.createdAt).toLocaleString() }</p> }
          { pair.updatedAt && <p><span>Updated At: </span>{ new Date(+pair.updatedAt).toLocaleString() }</p> }
        </Link>
      </div>
    ))}
    { data.getPairs && data.getPairs.map(pair => !pair.open && !open && (
      <div className='pair_divs' key={ pair.id }>
        <div>
          { pair.pair && <p><span>Currency Pair: </span>{ pair.pair }</p> }
          { pair.lotSize && <p><span>Lot Size: </span>{ pair.lotSize.toLocaleString() }.00</p> }
          { pair.position && <p><span>Position: </span>{ pair.position }</p> }
          { pair.openedAt && <p><span>Opened At: </span>{ pair.openedAt.toFixed(4) }</p> }
          { pair.closedAt && <p><span>Closed At: </span>{ pair.closedAt.toFixed(4) }</p> }
          { <p><span>Pip Dif: </span>{ pair.pipDif || 0 }</p> }
          { <p><span>Profit/Loss: </span>{ pair.profitLoss.toFixed(2) || 0 }</p> }
          { pair.createdAt && <p><span>Created At: </span>{ new Date(+pair.createdAt).toLocaleString() }</p> }
          { pair.updatedAt && <p><span>Updated At: </span>{ new Date(+pair.updatedAt).toLocaleString() }</p> }
        </div>
      </div>
    ))}
  </div>
)

export default Pairs 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½å§ã€‚æˆ‘ä»¬åº”è¯¥åœ¨å¤„ç†`Account.js`æ—¶å®ç°ä¸€ä¸ª`addFunds`æŒ‰é’®ã€‚åœ¨`graphql/mutations`ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`addFunds.js`çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ’å…¥ä»¥ä¸‹å†…å®¹:

```
// graphql/mutations/addFunds.js

import gql from 'graphql-tag'

export const ADDFUNDS = gql`
  mutation ($amount: Int!) {
    addFunds(amount: $amount) {
      success
      message
      bankroll
    }
  }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`components/pairs`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`AddFunds.js`çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :

```
// components/pairs/AddFunds.js

import React, { useState } from 'react'
import { useMutation } from '@apollo/react-hooks'

import { ADDFUNDS } from '../../graphql/mutations/addFunds'

export default function AddFunds() {
  const [ showModal, setShowModal ] = useState(false),
        [ addFunds, { data, loading, error } ] = useMutation(ADDFUNDS, {
          variables: { amount: 1000000 }
        })

  if(loading) return <p>Loading...</p>
  if(error) return <p>{ error.message }</p>

  return addFunds && (
    <>
      <button onClick={ async () => {
        alert('Are you sure?')
        await addFunds()
        setShowModal(true)
      }}>Add Funds</button>
      { data && data.addFunds.message && showModal && (
        <div className='modal'>
          <button onClick={() => setShowModal(false)}>x</button>
          <p>{ data.addFunds.message }</p>
        </div>
      )}
    </>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€šå¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯¹è‡ªå·±çš„å­˜æ¬¾é‡‘é¢æœ‰ä¸€å®šçš„å‘è¨€æƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬åœ¨è¿™é‡Œåˆ†å‘ç±³è‰çš„æ—¶å€™ï¼Œè°ä¼šå¤§æƒŠå°æ€ªå‘¢ï¼Ÿ

è¯¥æ˜¯æˆ‘ä»¬å›å»çš„æ—¶å€™äº†ã€‚

```
// Account.js

import React, { useState } from 'react'
import { useQuery } from '@apollo/react-hooks'
import { Redirect } from 'react-router-dom'

import { GETPAIRS } from '../graphql/queries/getPairs'
import { MEQUERY } from '../graphql/queries/me'
import AddFunds from '../components/pairs/AddFunds'
import Pairs from '../components/pairs/Pairs'
import NewPosition from '../components/pairs/NewPosition'

export default function Account(props) {
  const [ open, setOpen ] = useState(true),
        user = useQuery(MEQUERY),
        { data, loading, error } = useQuery(GETPAIRS)

  if(user.error) return <Redirect to='/login' />
  if(!user.data || !user.data.me) return <p>A man has no name.</p>
  if(loading) return <p>Loading...</p>
  if(!data) return (
    <section>
      <h2>{ user.data.me.name }</h2>
      <div>
        <p><span>Available Balance: </span>{ user.data.me.bankroll.toLocaleString() }.00</p>
        <AddFunds />
      </div>
    </section>
  )
  if(error) return <p>{ error.message }</p>

  return (
    <section>
      <h2>{ user.data.me.name }</h2>
      <div>
        <p><span>Available Balance: </span>{ user.data.me.bankroll.toLocaleString() }.00</p>
        <AddFunds />
      </div>
      { props.location.state && <NewPosition state={ props.location.state } /> }
      <h3>Currency Pairs</h3>
      <button onClick={() => setOpen(true)}>open</button>
      <button onClick={() => setOpen(false)}>closed</button>
      <Pairs data={ data } open={ open } user={ user } />
    </section>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é¦–å…ˆï¼Œæˆ‘ä»¬å¤„ç†æˆ‘ä»¬çš„è¿›å£ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®ç°`useQuery`æ¥æ‰¾å‡ºç”¨æˆ·ã€‚å¦‚æœæ²¡æœ‰`getPair`æ•°æ®ï¼Œæˆ‘ä»¬åªæ˜¾ç¤ºå…³äºç”¨æˆ·çš„ä¿¡æ¯ï¼Œè€Œ`AddFunds`æŒ‰é’®`else`æ˜¾ç¤ºæ‰€æœ‰æ•°æ®ã€‚

æˆ‘ä»¬çš„ç”¨æˆ·ç°åœ¨å¯ä»¥å¼€ä»“å¹¶æŠŠé’±å­˜å…¥ä»–ä»¬çš„è´¦æˆ·ã€‚è®©æˆ‘ä»¬å…è®¸ä»–ä»¬å¹³ä»“ã€‚è¿™åˆä¸€æ¬¡ä»çªå˜å¼€å§‹ã€‚åœ¨`graphql/mutations`ä¸­åˆ›å»º`closePosition.js`å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
// graphql/mutations/closePosition.js

import gql from 'graphql-tag'

export const CLOSEPOSITION = gql`
  mutation ClosePosition($id: ID!, $closedAt: Float!) {
    closePosition(id: $id, closedAt: $closedAt) {
      success
      message
      pair {
        id
        user
        pair
        lotSize
        position
        openedAt
        closedAt
        pipDif
        profitLoss
        open
        createdAt
        updatedAt
      }
    }
  }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªç©ºç¼ºèŒä½æ—¶ï¼Œä»–ä»¬ä¼šè¢«å¯¼èˆªåˆ°`/pair`ã€‚è¿™æ˜¯ä»–ä»¬å¯ä»¥å¹³ä»“çš„åœ°æ–¹ã€‚åœ¨`pages`æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»º`Pair.js`ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè°ƒæ•´ï¼Œä½¿å…¶ç±»ä¼¼äºä¸‹é¢çš„ä»£ç :

```
// Pair.js

import React from 'react'
import { useQuery } from '@apollo/react-hooks'

import { CURRENCY_PAIR_INFO } from '../graphql/queries/currencyPairInfo'
import ClosePosition from '../components/positions/ClosePosition'
import PairDetails from '../components/pairs/PairDetails'

export default function Pair(props) {
  const { createdAt, lotSize, openedAt, pair, position, id } = props.location.state.pair,
        { bankroll, name } = props.location.state.me,
        [ fc, tc ] = pair.split('/'),
        { data, loading, error, refetch } = useQuery(CURRENCY_PAIR_INFO, {
          variables: { fc, tc }
        })

  if(loading) return <p>Loading...</p>
  if(error) return <p>{ error.message }</p>

  const { bidPrice, lastRefreshed, askPrice } = data.currencyPairInfo,
        pipDifLong = (bidPrice - openedAt).toFixed(4),
        pipDifShort = (openedAt - askPrice).toFixed(4),
        potentialProfitLoss = position === 'long'
          ? pipDifLong * lotSize
          : pipDifShort * lotSize,
        date = new Date(lastRefreshed + ' UTC')

  return data && (
    <section>
      <div className='landing_pair_data'>
        <h3>Pair Details</h3>
        <div>
          <p>{ name } your available balance is { bankroll.toLocaleString() }.00</p> 
          <div>
            <button onClick={() => refetch()}>Refresh</button>
            <ClosePosition 
              id={id} 
              bidPrice={bidPrice} 
              askPrice={askPrice} 
              position={position} 
            />
          </div>
        </div>
        <PairDetails
          pair={pair} 
          lotSize={lotSize}
          openedAt={openedAt}
          position={position}
          createdAt={createdAt}
          askPrice={askPrice}
          bidPrice={bidPrice}
          lastRefreshed={date.toLocaleString()}
          pipDifLong={pipDifLong}
          pipDifShort={pipDifShort}
          potentialProfitLoss={potentialProfitLoss}
        />
      </div>
    </section>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦æˆ‘ä»¬æœ‰äº†çŠ¶æ€ï¼Œæˆ‘ä»¬å°±å°†æŸ¥è¯¢å˜é‡ä¼ é€’ç»™`currencyPairInfo`ã€‚å“åº”æä¾›äº†å®Œæˆæˆ‘ä»¬çš„`closePosition`çªå˜æ‰€éœ€çš„æ•°æ®ã€‚æ ¹æ®`position`æ˜¯åšå¤šè¿˜æ˜¯åšç©ºï¼Œæˆ‘ä»¬ä½¿ç”¨`askPrice`æˆ–`bidPrice`æ¥è®¡ç®—è‡ªæœ€åˆè´­ä¹°ä»¥æ¥çš„ä»·æ ¼å·®å¼‚ã€‚è¿™ç§ä»·æ ¼å·®å¼‚å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ç‚¹å·®(pipDif)ã€‚

æ­£å¦‚[dailyfx.com](https://www.dailyfx.com/forex/education/trading_tips/daily_trading_lesson/2019/01/18/what-is-a-pip.html)æ‰€æè¿°çš„:

> PIPâ€”â€”ä»£è¡¨ç™¾åˆ†æ¯”ç‚¹æ•°â€”â€”æ˜¯å¤–æ±‡äº¤æ˜“å‘˜ç”¨æ¥å®šä¹‰ä¸¤ç§è´§å¸ä¹‹é—´æœ€å°ä»·å€¼å˜åŒ–çš„è®¡é‡å•ä½ã€‚è¿™é€šå¸¸ç”±ç¬¬å››ä¸ªå°æ•°ä½æ•°çš„ç§»åŠ¨æ¥è¡¨ç¤ºã€‚ç‚¹å€¼çš„è®¡ç®—æ–¹æ³•æ˜¯å°†ä¸€ä¸ªç‚¹(0.0001)ä¹˜ä»¥ç‰¹å®šçš„æ‰‹/åˆçº¦å¤§å°ã€‚å¯¹äºæ ‡å‡†æ‰‹æ•°ï¼Œè¿™éœ€è¦ 100ï¼Œ000 å•ä½çš„åŸºç¡€è´§å¸ï¼Œå¯¹äºè¿·ä½ æ‰‹æ•°ï¼Œè¿™æ˜¯ 10ï¼Œ000 å•ä½ã€‚ä¾‹å¦‚ï¼Œä»¥æ¬§å…ƒ/ç¾å…ƒä¸ºä¾‹ï¼Œæ ‡å‡†åˆçº¦ä¸­ä¸€ç‚¹çš„å˜åŠ¨ç­‰äº 10 ç¾å…ƒ(0.0001 x 100ï¼Œ000)ã€‚

æ¯ä¸ªè´§å¸å¯¹éƒ½æœ‰è‡ªå·±çš„ç›¸å¯¹å…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€æ¯”è¾ƒ`openedAt`ä»·æ ¼å’Œ`closedAt`ä»·æ ¼å°±å¯ä»¥è®¡ç®—ç›ˆäºã€‚æˆ‘ä»¬é€šè¿‡é¦–å…ˆè®¡ç®—å‡º`position`æ˜¯é•¿è¿˜æ˜¯çŸ­æ¥è®¡ç®—`pipDif`ã€‚å¦‚æœå¤´å¯¸å¾ˆé•¿ï¼Œæˆ‘ä»¬ä»`bidPrice`å‡å»`openedAt`ä»·æ ¼ã€‚ç›¸åï¼Œå¦‚æœå¤´å¯¸ä¸è¶³ï¼Œæˆ‘ä»¬ä»`openedAt`ä»·æ ¼ä¸­å‡å»`askPrice`ã€‚è¿™å°†æä¾›æˆ‘ä»¬çš„`pipDif`ã€‚ä¸€æ—¦æˆ‘ä»¬æœ‰äº†ä»·æ ¼å·®å¼‚ï¼Œæˆ‘ä»¬å°±ç”¨å®ƒä¹˜ä»¥`lotSize`ã€‚

ä¸€æ—¦ç›´è§‚æ¼”ç¤ºï¼Œæ‚¨å¯ä»¥çœ‹åˆ°è¿™æ˜¯å¤šä¹ˆå®¹æ˜“è®¡ç®—ã€‚å¯¹äºæ ‡å‡†æ‰¹æ¬¡(100ï¼Œ000 ä¸ªå•ä½)ï¼Œæ¯ä¸ªç‚¹(é€šå¸¸æ˜¯ç¬¬å››ä¸ªå°æ•°ä½)ç§»åŠ¨ç›¸å½“äº 10 ä¸ªè´§å¸å•ä½çš„åˆ©æ¶¦/æŸå¤±ã€‚

[![pipdif](../Images/4549f354446353e0acc4fb6a55419a4c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--BfdnMR4k--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/marlonanthony/currency_exchange/blob/master/images/pipdif.png%3Fraw%3Dtrue)

å¯¹äºå°æ‰¹é‡(10ï¼Œ000 ä¸ªå•ä½)ï¼Œæˆ‘ä»¬åšåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯æ¯ä¸ª pip ç§»åŠ¨ç›¸å½“äº 1 ä¸ªè´§å¸å•ä½çš„åˆ©æ¶¦/æŸå¤±ã€‚

[![pipdif minilot](../Images/b5c001e3ee9dd484000b278ae5be7089.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--bm9anZqA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/marlonanthony/currency_exchange/blob/master/images/pipdif2.png%3Fraw%3Dtrue)

ç†è§£è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œæˆ‘ä»¬ä¸æ˜¯åœ¨å°†ä¸€ç§è´§å¸å…‘æ¢æˆå¦ä¸€ç§è´§å¸ã€‚æˆ‘ä»¬åªæ˜¯åœ¨èµŒå“ªç§è´§å¸ç›¸å¯¹äºå¦ä¸€ç§è´§å¸æ›´å€¼é’±ã€‚ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œå¦‚æœä½ æƒ³ä¹°å…¥(æˆ–åšå¤š)æ¬§å…ƒå¯¹ç¾å…ƒï¼Œä½ åº”è¯¥å–å‡ºæ¬§å…ƒ/ç¾å…ƒæˆ–ä¹°å…¥ç¾å…ƒ/æ¬§å…ƒã€‚ç›¸åï¼Œè¦åšå¤šç¾å…ƒå…‘æ¬§å…ƒï¼Œä½ å¯ä»¥ä¹°å…¥æ¬§å…ƒ/ç¾å…ƒæˆ–å–å‡ºç¾å…ƒ/æ¬§å…ƒã€‚å±•æœŸ(åˆ©æ¯)å’Œä¿è¯é‡‘è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„èŒƒå›´ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸“é—¨å…³æ³¨ pipDifã€‚

æˆ‘ä»¬éœ€è¦åˆ›å»º`ClosePosition`å’Œ`PairDetails`ã€‚åœ¨`components/positions`ä¸­ï¼Œåˆ›å»º`ClosePosition.js`å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
// components/positions/ClosePosition.js

import React, { useState } from 'react'
import { useQuery, useMutation } from '@apollo/react-hooks'
import { Link } from 'react-router-dom'

import { CLOSEPOSITION } from '../../graphql/mutations/closePosition'
import { MEQUERY } from '../../graphql/queries/me'
import { GETPAIRS } from '../../graphql/queries/getPairs'

export default function ClosePosition({ id, bidPrice, askPrice, position }) {
  const [ showModal, setShowModal ] = useState(false),
        { refetch  } = useQuery(MEQUERY),
        [ closePosition, { data, loading, error } ] = useMutation(CLOSEPOSITION, {
          variables: position === 'long'
            ? { id, closedAt: +bidPrice } 
            : { id, closedAt: +askPrice },
          refetchQueries: [{ query: GETPAIRS }]
        })

  if(loading) return <p>Loading...</p>
  if(error) return <p>{ error.message }</p>

  return closePosition && (
    <>
      <button onClick={ async () => {
        alert(`Are you sure you want to close your ${
          position === 'long' ? 'long' : 'short' } position?`) 
        await closePosition()
        setShowModal(true)
        refetch()
      }}>
        { position === 'long' ? 'Sell' : 'Buy' }
      </button> 

      { data && data.closePosition.message && showModal && ( 
        <div className='modal'>
          <button onClick={() => setShowModal(false)}>x</button>
          <p>{ data.closePosition.message }</p>
          <Link to='/account'><button>Account</button></Link>
        </div>
      )}
    </>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªæ–‡ä»¶æ‰€åšçš„å°±æ˜¯è§£å¯†`position`æ˜¯é•¿è¿˜æ˜¯çŸ­ï¼Œå¹¶ä¸º`closePosition`çªå˜æä¾›é€‚å½“çš„å˜é‡(é…å¯¹`id`å’Œ`bidPrice/askPrice`)ã€‚`closePosition`å“åº”æ¶ˆæ¯å°†é€šè¿‡æ¨¡æ€æ˜¾ç¤ºã€‚

æˆ‘ä»¬ä½¿ç”¨`useQuery`é’©å­æ¥è®¿é—®`me`æŸ¥è¯¢`refetch`å‡½æ•°ã€‚æˆ‘ä»¬å°†`refetch`æ–¹æ³•æ·»åŠ åˆ°æŒ‰é’®ä¸­ï¼Œè¿™æ ·åœ¨`closePosition`å˜å¼‚è¿è¡Œåï¼Œ`refetch`å°†åˆ·æ–°ç”¨æˆ·æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬åœ¨è¿™é‡Œä¸ä½¿ç”¨`refetchQueries`ï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬çš„çªå˜è¿è¡Œä¹‹å`open`å¯¹å°†ä¼šæ˜¯æœ€æ–°çš„ï¼Œä½†æ˜¯`closed`å¯¹ä¸ä¼šã€‚

åœ¨ç»„ä»¶æ–‡ä»¶å¤¹ä¸­åˆ›å»º`PairDetails.js`å¹¶æ·»åŠ ä¸‹é¢çš„ä»£ç :

```
// components/PairDetails.js

import React from 'react'

const PairDetails = ({
  pair,
  lotSize,
  openedAt,
  position,
  createdAt,
  askPrice,
  bidPrice,
  lastRefreshed,
  pipDifLong,
  pipDifShort,
  potentialProfitLoss
}) => (
  <div>
    <p><span>Currency Pair: </span>{pair}</p>
    <p><span>Lot Size: </span>{lotSize.toLocaleString()}.00</p>
    <p><span>Opened At: </span>{(+openedAt).toFixed(4)}</p>
    <p><span>Position: </span>{position}</p>
    <p><span>Created At: </span>{new Date(+createdAt).toLocaleString()}</p>
    { position === 'long' 
      ? (
        <>
          <br />
          <p><span>Current Bid Price: </span>{(+bidPrice).toFixed(4)}</p>
          <p><span>Last Refreshed: </span>{lastRefreshed}</p>
          <p><span>Current Pip Difference: </span>{pipDifLong}</p>
          <p><span>Potential PL: </span>
            {potentialProfitLoss.toLocaleString()}.00
          </p>
        </> ) 
      : (
        <>
          <br />
          <p><span>Current Ask Price: </span>{(+askPrice).toFixed(4)}</p>
          <p><span>Last Refreshed: </span>{lastRefreshed}</p>
          <p><span>Current Pip Difference: </span>{pipDifShort}</p>
          <p><span>Potential PL: </span>
            {potentialProfitLoss.toLocaleString()}.00
          </p>
        </>
      )
    }
  </div>
)

export default PairDetails 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æ˜¾ç¤ºæœªç»“å¤´å¯¸æ•°æ®ã€‚æˆ‘ä»¬è¿˜æ˜¾ç¤ºå½“å‰çš„`askPrice` / `bidPrice`å’Œå¹³ä»“å°†æä¾›çš„`potentialProfitLoss`ã€‚

å°† Pair.js å¯¼å…¥ App.js å¹¶åˆ›å»ºå…¶`Route`ã€‚

```
// App.js

import React from 'react'
import { Route, Switch } from 'react-router-dom'

import Landing from './pages/Landing'
import Navbar from './components/navbar/Navbar'
import Register from './components/auth/Register'
import Login from './components/auth/Login'
import Account from './pages/Account'
import Pair from './pages/Pair'

const App = () => (
  <Switch>
    <Route path='/login' component={ Login } />
    <Route path='/' render={() => (
      <main>
        <div className='navbar'><Navbar /></div>
        <Route exact path='/' component={ Landing } />
        <Route path='/register' component={ Register } />
        <Route path='/account' component={ Account } />
        <Route path='/pair' component={ Pair } />
      </main>
    )} />
  </Switch>
)

export default App 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨å› å¼€è®¾æ–°èŒä½è€Œå¯¼èˆªè‡³/accountï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹å†…å®¹:

[![account](../Images/dfab5fb2aa8b4c50359a146052238170.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--fDo-PpVP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/marlonanthony/currency_exchange/blob/master/images/account.png%3Fraw%3Dtrue)

ç‚¹å‡»æ‰“å¼€çš„ä¸€å¯¹ï¼Œä»”ç»†çœ‹çœ‹æµè§ˆå™¨ã€‚

[![pair details](../Images/076c9ae997d50ff8742939ab1d158e82.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--kcTLJJYU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/marlonanthony/currency_exchange/blob/master/images/pair_details.png%3Fraw%3Dtrue)

è¿™æ ·ç”¨æˆ·å°±å¯ä»¥å¹³ä»“äº†ã€‚æˆ‘ä»¬æœ€å¥½ä¸è¦èººåœ¨åŠŸåŠ³ç°¿ä¸Šã€‚æ˜¯æ—¶å€™å®æ–½æˆ‘ä»¬çš„å›¾è¡¨äº†ï¼æˆ‘ä»¬å°†ä»æŸ¥è¯¢å¼€å§‹ã€‚åœ¨`graphql/queries`ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¹¶å°†å…¶å‘½åä¸º`monthlyTimeSeries.js`ã€‚æ’å…¥ä»¥ä¸‹å†…å®¹:

```
// graphql/queries/monthlyTimeSeries.js

import gql from 'graphql-tag' 

export const MONTHLYTIMESERIES = gql`
  query MonthlyTimeSeries($fc: String, $tc: String) {
    monthlyTimeSeries(fc: $fc, tc: $tc) {
      timesArray
      valuesArray
    }
  }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`pages`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`Chart.js`çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :

```
// Chart.js

import React, { useState } from 'react'
import { Line } from 'react-chartjs-2'
import { useQuery } from '@apollo/react-hooks'

import { MONTHLYTIMESERIES } from '../graphql/queries/monthlyTimeSeries'

export default function Chart() {
  const [ fc, setFc ] = useState('EUR'),
        [ tc, setTc ] = useState('USD'), 
        [ fromCurrency, setFromCurrency ] = useState('EUR'), 
        [ toCurrency, setToCurrency ] = useState('USD'),
        { data, error, loading, refetch } = useQuery(MONTHLYTIMESERIES, {
          variables: { fc, tc }
        })

  if(loading) return <p>loading...</p>
  if(error) return <button onClick={() => {
    refetch({ fc: 'EUR', tc: 'USD' })
    window.location.href = '/chart'
  }}>retry</button>

  const labels = data && data.monthlyTimeSeries.timesArray,
        chartData = data && data.monthlyTimeSeries.valuesArray

  return (
    <div className='chartData'>
      <form onSubmit={e => {
        e.preventDefault()
        setFc(fromCurrency)
        setTc(toCurrency) 
      }}>
        <input 
          name='fromCurrency'
          value={fromCurrency}
          placeholder='From Currency'
          onChange={e => setFromCurrency(e.target.value.toUpperCase())}
        />
        <input 
          name='toCurrency'
          value={toCurrency}
          placeholder='To Currency'
          onChange={e => setToCurrency(e.target.value.toUpperCase())}
        />
        <button>submit</button>
      </form>
      <Line data={{
        labels,
        datasets: [
          {
            label: `${fc}/${tc} Time Series FX (Monthly)`,
            fill: true,
            lineTension: 0.1,
            backgroundColor: 'rgb(55, 131, 194)',
            borderColor: 'white',
            borderCapStyle: 'butt',
            borderDash: [],
            borderDashOffset: 0.0,
            borderJoinStyle: 'miter',
            pointBorderColor: 'white',
            pointBackgroundColor: '#fff',
            pointBorderWidth: 1,
            pointHoverRadius: 5,
            pointHoverBackgroundColor: 'white',
            pointHoverBorderColor: 'rgba(220,220,220,1)',
            pointHoverBorderWidth: 2,
            pointRadius: 1,
            pointHitRadius: 10,
            data: chartData
          }
        ]
      }} />
    </div>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„`monthlyTimeSeries`æŸ¥è¯¢æ¥è·å–å›¾è¡¨æ•°æ®ã€‚æˆ‘ä»¬æä¾›äº†å‡ ä¸ªè¾“å…¥ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥é€‰æ‹©ä»–ä»¬æƒ³è¦è°ƒæŸ¥çš„è´§å¸å¯¹ã€‚å¦‚æœç”¨æˆ·è¾“å…¥äº†é”™è¯¯çš„å¯†ç å¯¹ï¼Œæˆ‘ä»¬ä¼šæ˜¾ç¤ºä¸€ä¸ªåˆ·æ–°æŒ‰é’®ã€‚`refetch`å‡½æ•°æ¥å—ä¸å…¶ç›¸å…³çš„`query`çš„å‚æ•°ã€‚`onClick`æˆ‘ä»¬ä½¿ç”¨è¯¥åŠŸèƒ½å†æ¬¡æ˜¾ç¤ºæ¬§å…ƒ/ç¾å…ƒã€‚æˆ‘ä»¬å‘`Line`ç»„ä»¶æä¾›ä»æŸ¥è¯¢ä¸­å¾—åˆ°çš„`react-chartjs-2`çš„ä¸¤ä¸ªæ•°ç»„:`labels`å’Œ`chartData`ã€‚æœ€åï¼Œæˆ‘ä»¬æ·»åŠ ä¸€äº›æ ·å¼å¹¶è¿”å›æˆ‘ä»¬çš„å›¾è¡¨ã€‚

æˆ‘ä»¬éœ€è¦å°†`Chart.js`å¯¼å…¥åˆ°`App.js`ä¸­ï¼Œå¹¶åœ¨`Navbar.js`ä¸­ç»™å®ƒä¸€ä¸ª`path`ã€‚å…ˆè¯´`App.js` :

```
// App.js

import React from 'react'
import { Route, Switch } from 'react-router-dom'

import Landing from './pages/Landing'
import Navbar from './components/navbar/Navbar'
import Register from './components/auth/Register'
import Login from './components/auth/Login'
import Account from './pages/Account'
import Pair from './pages/Pair'
import Chart from './pages/Chart'

const App = () => (
  <Switch>
    <Route path='/login' component={ Login } />
    <Route path='/' render={() => (
      <main>
        <div className='navbar'><Navbar /></div>
        <Route exact path='/' component={ Landing } />
        <Route path='/register' component={ Register } />
        <Route path='/account' component={ Account } />
        <Route path='/pair' component={ Pair } />
        <Route path='/chart' component={ Chart } />
      </main>
    )} />
  </Switch>
)

export default App 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Navbar.js:

```
// Navbar.js

import React from 'react'
import { NavLink, Redirect } from 'react-router-dom'
import { useQuery } from '@apollo/react-hooks'

import { MEQUERY } from '../../graphql/queries/me'
import Logout from '../auth/Logout'
import './Navbar.css'

const Navbar = () => {
  const { data, loading, error } = useQuery(MEQUERY)

  if(loading) return <p>Loading....</p>
  if(error) return <Redirect to='/login' />
  if(!data) return <p>This is unfortunate</p>

  return (
    <div className='navigation'>
      <header><NavLink exact to='/'>Forex</NavLink></header>
      { !data.me ? (
        <ul>
          <li><NavLink exact to='/login'>Login</NavLink></li>
          <li><NavLink exact to='/register'>SignUp</NavLink></li>
        </ul> ) 
      : (
        <ul>
          <li><NavLink to='/chart'>Chart</NavLink></li>
          <li><NavLink to='/account'>Account</NavLink></li>
          <li><Logout /></li>
        </ul>
      )}
    </div>
  )
}

export default Navbar 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦ä½ ä¿å­˜ä½ çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†å®Œæˆï¼Œåº”è¯¥ç±»ä¼¼äºä¸‹é¢çš„è§†é¢‘:

[![forex demo](../Images/8c5cd09827e8e2d34d1ecde61f150cef.png)T2ã€‘](https://youtu.be/mbx9sLVk5UQ)

ä½ ä¼šæ³¨æ„åˆ°å›¾è¡¨ååº”å……åˆ†ï¼Œåœ¨æ—§çš„çœ¼é•œä¸Šä¹Ÿæ²¡æœ‰é‚£ä¹ˆç³Ÿç³•ã€‚

çœ‹å“ªï¼æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè´§å¸äº¤æ˜“æ‰€ï¼Œå¹¶å¸Œæœ›åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å­¦åˆ°ä¸€äº›ä¸œè¥¿ã€‚æˆ‘çŸ¥é“æˆ‘åšåˆ°äº†ã€‚

* * *

ä¼¸æ‰‹:[Twitter](https://twitter.com/marlonanthony10)|[Medium](https://medium.com/@marlonanthony)|[GitHub](https://github.com/marlonanthony)