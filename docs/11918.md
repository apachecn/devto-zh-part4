# å¦‚ä½•ä» React Native 0.57 å‡çº§åˆ° 0.59 |ç¬¬ 1 éƒ¨åˆ†:å‡çº§åˆ° 0.58

> åŸæ–‡:[https://dev . to/julietter/how-to-upgrade-from-react-native-0-57-to-0-59-part-1-upgrading-to-0-58-492 I](https://dev.to/julietter/how-to-upgrade-from-react-native-0-57-to-0-59-part-1-upgrading-to-0-58-492i)

[![](../Images/6efd1beb915ff919fc3006634c829a52.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--7g2QxAOo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2Atg4oPcJpJ7dOTE9x0WstQg.jpeg)

#### [](#hey-you-you-need-to-upgrade-to-059)å˜¿ä½ ï¼ä½ éœ€è¦å‡çº§åˆ° 0.59ï¼ğŸ“¢

å¦‚æœä½ è¿˜ä¸çŸ¥é“ï¼Œå¦‚æœä½ æƒ³å‘ Google Play å•†åº—æäº¤æ›´æ–°ï¼Œæ‰€æœ‰ React åŸç”Ÿåº”ç”¨éƒ½éœ€è¦åœ¨ 2019 å¹´ 8 æœˆ 1 æ—¥ä¹‹å‰å‡çº§åˆ° 0.59ã€‚è¿™æ˜¯å› ä¸º Google Play æå‡ºäº†æ–°çš„ 64 ä½è¦æ±‚ã€‚ä»–ä»¬å¯¹æ­¤ç›¸å½“è®¤çœŸ:

> åˆ° 2019 å¹´ 8 æœˆ 1 æ—¥ï¼Œæ‰€æœ‰ä½¿ç”¨æœ¬æœºä»£ç çš„åº”ç”¨ç¨‹åºå¿…é¡»åœ¨ 32 ä½ç‰ˆæœ¬ä¹‹å¤–æä¾› 64 ä½ç‰ˆæœ¬ï¼Œæ‰èƒ½å‘å¸ƒæ›´æ–°ã€‚ä»Šå¹´ 1 æœˆï¼Œæˆ‘ä»¬é‡ç”³è¿™æ˜¯å¿…è¦çš„ï¼Œä»¥ä¾¿ä¸ºåˆ›æ–°è®©è·¯ï¼Œå¹¶é¢„è®¡æœªæ¥çš„ Android è®¾å¤‡ä»…æ”¯æŒ 64 ä½ä»£ç ã€‚

å¹¸è¿çš„æ˜¯ï¼ŒReact Native åœ¨ä»–ä»¬çš„`0.59`ç‰ˆæœ¬ä¸­å¼•å…¥äº† 64 ä½ç‰ˆæœ¬ã€‚ä½†é—®é¢˜æ˜¯ï¼Œæ›´æ–°èµ·æ¥å¯èƒ½æœ‰ç‚¹æ£˜æ‰‹ã€‚è¿™å°±æ˜¯æˆ‘åˆ›å»ºè¿™ä¸ªæ•™ç¨‹çš„åŸå› ã€‚å¦‚æœæ‚¨æƒ³è®©æ‚¨çš„åº”ç”¨ç¨‹åºåŠ å¿«é€Ÿåº¦ï¼Œå¹¶ä¸ºå³å°†å‘å¸ƒçš„ç‰ˆæœ¬åšå¥½å‡†å¤‡ï¼Œè¯·è·Ÿéšã€‚

#### [](#about-this-tutorial)å…³äºæœ¬æ•™ç¨‹

åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œæˆ‘éœ€è¦å°†ä¸€ä¸ªé¡¹ç›®ä»`0.57.4`å‡çº§åˆ°`0.59.8`(æ³¨æ„:ä¸€ä¸ªæ›´æ–°çš„`0.59.10`å·²ç»å‘å¸ƒ)ã€‚æˆ‘è¿˜éœ€è¦ Android å’Œ iOS ç‰ˆæœ¬ã€‚

å½“ç”¨ä¸¤ä¸ªæ¬¡è¦ç‰ˆæœ¬å‡çº§ä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œ**æˆ‘å¼ºçƒˆå»ºè®®ä¸€æ¬¡å‡çº§ä¸€ä¸ªæ¬¡è¦ç‰ˆæœ¬ã€‚**(ä¾‹å¦‚`0.57`åˆ°`0.58`ï¼Œç„¶å`0.58`åˆ°`0.59`)ã€‚å¦‚æœå‡ºç°é—®é¢˜ï¼Œå®ƒä¼šç®€åŒ–æ•…éšœæ’é™¤ã€‚

å› æ­¤ï¼Œå¦‚æœä½ éœ€è¦åƒæˆ‘ä¸€æ ·ä»`0.57`å‘ä¸Šçˆ¬ï¼Œæˆ‘å‘ä½ å±•ç¤º**ç¬¬ 1 éƒ¨åˆ†ï¼Œå…± 2 éƒ¨åˆ†:å‡çº§åˆ° 0.58ï¼**

#### [](#part-1-upgrading-to-react-native-058)ç¬¬ 1 éƒ¨åˆ†:å‡çº§ååº”åŸç”Ÿ 0.58 â¬†ï¸

#### [](#key-changes)ğŸ”‘ä¸»è¦å˜åŒ–

*   iOS JavaScriptCore æ¡†æ¶ç°åœ¨éœ€è¦é“¾æ¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚
*   ç°åœ¨æ”¯æŒ Android çš„ target 27 SDKã€‚

#### [](#step-1-update-your-packagejson)ç¬¬ä¸€æ­¥:æ›´æ–°ä½ çš„ package.json â¬†ï¸

æ‰“å¼€æ‚¨çš„`package.json`å¹¶æ›´æ–°ä»¥ä¸‹ä¾èµ–é¡¹:

```
//  package.json  "dependencies":  {  "react":  "16.6.3",  "react-native":  "0.58.6",  },  "devDependencies":  {  "babel-core":  "^7.0.0-bridge.0",  "react-test-renderer":  "16.6.3",  } 
```

ç„¶åï¼Œåˆ é™¤æ‚¨çš„`node_modules`å¹¶ç”¨`npm i`é‡æ–°å®‰è£…ä¸€ä¸ªæ–°æ‰¹æ¬¡ã€‚

#### [](#step-2-modernize-babel-%F0%9F%97%A3)ç¬¬äºŒæ­¥:ç°ä»£åŒ–å·´åˆ«å¡”ğŸ—£

çœ‹åˆ°ä¸Šé¢é‚£ä¸ªå·´åˆ«å¡”å‡çº§äº†å—ï¼Ÿç‰ˆæœ¬ 7 å¼•å…¥äº†ä¸€ç§æ–°ç±»å‹çš„ Babel é…ç½®æ–‡ä»¶ï¼Œè¿™ç§æ–‡ä»¶ç°åœ¨æ›´å—æ¬¢è¿ï¼Œç”šè‡³æ˜¯æ‚¨å¯èƒ½ä½¿ç”¨çš„è®¸å¤šåº“æ‰€å¿…éœ€çš„ã€‚

è¦æ›´æ–°:

**1ã€‚**åˆ›å»ºä¸€ä¸ªæ–°çš„`babel.config.js`æ–‡ä»¶ã€‚

**2ã€‚**ç§»æ¤å½“å‰`.babelrc`æ–‡ä»¶ä¸­çš„ä»»ä½•é…ç½®ã€‚ç°åœ¨éœ€è¦å¯¼å‡ºè¿™äº›é¢„è®¾ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚

```
// a basic react native babel.config.js

module.exports = {
     presets: ["module:metro-react-native-babel-preset"]
} 
```

**3ã€‚**å®Œæˆåï¼Œåˆ é™¤æ—§çš„`.babelrc`æ–‡ä»¶ã€‚

#### [](#step-3-update-flow)ç¬¬ä¸‰æ­¥:æ›´æ–°æµé‡â¬†ï¸

è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ã€‚æ‰“å¼€`.flowconfig`å¹¶æ›´æ–°æµç¨‹ä¾èµ–å…³ç³»:

```
// .flowconfig

[version]
^0.92.0 
```

å¦‚æœä½ ä½¿ç”¨ Flow å¹¶åœ¨è¿™æ¬¡æ›´æ–°åé‡åˆ°é”™è¯¯ï¼Œå»ä»–ä»¬çš„ [changelog](https://github.com/facebook/flow/blob/master/Changelog.md) è¯Šæ–­ä»»ä½•é—®é¢˜ã€‚

#### [](#step-4-link-the-javascriptcore-framework)ç¬¬å››æ­¥:é“¾æ¥ JavaScriptCore æ¡†æ¶ğŸ”—

**1ã€‚**æ‰“å¼€ä½ çš„ XCode é¡¹ç›®ã€‚

**2ã€‚**é€‰æ‹©æ‚¨çš„é¡¹ç›®:

[![](../Images/4ba53ef2c00aa03b522ecf5f3a25e6f3.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--1Pykbc79--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2Ae-16F4qmNUIbdl6V9JIw9w.png)

**3ã€‚**é€‰æ‹©æ‚¨é¡¹ç›®çš„ä¸»è¦ç›®æ ‡è®¾ç½®:

[![](../Images/326199c9189d1d95e48032db1ef183a9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--A-A0XXjh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2AQAip1dbngymFpYK22VdXyg.png)

**4ã€‚**å¯¼èˆªè‡³`Build Phases`å±å¹•:

[![](../Images/178475a17deffe6e1fe17e4390598520.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--RjBO0ZXg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2A3ZhaeWwxJu1CMueVGwU1qA.png)

**5ã€‚**åœ¨`Link Binary With Libraries`ä¸‹ï¼Œå¢åŠ `JavaScriptCore.framework`

[![](../Images/9e5e6a60ec8a17ce7a1375a7447c21ba.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--_3e3unMB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2Ax7LhxNbYVVm7xVaKLCEHHg.png)

[![](../Images/212543badea64e98993eabc189df55ef.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Wy6-tk8F--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2Au6Aqk3Z114iQHG37roeuGw.png)

è¯·æ³¨æ„ï¼Œåœ¨æ­¤æ›´æ”¹åï¼Œæ‚¨å¯èƒ½éœ€è¦æ¸…ç† XCode ç¼“å­˜ã€‚è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« å¯ä»¥å¸®åˆ°ä½ ã€‚

#### [](#step-5-update-raw-androidbuildgradle-endraw-)ç¬¬äº”æ­¥:æ›´æ–°`android/build.gradle` â¬†ï¸

æ›´æ–°`android/build.gradle`ä»¥æ”¯æŒä¸€äº›æ–°çš„åº“/SDKã€‚ä¸è¦åˆ é™¤ä»»ä½•å†…å®¹ï¼Œåªæ›´æ–°ä»¥ä¸‹ç‰ˆæœ¬å·:

```
// android/build.gradle

buildscript {
     ext {
          buildToolsVersion = "28.0.2"
          compileSdkVersion = 28
          targetSdkVersion = 27
          supportLibVersion = "28.0.0"
     }

     dependencies {
          classpath 'com.android.tools.build:gradle:3.2.1'
     }

     task wrapper(type: Wrapper) {
          gradleVersion = '4.7'
     }
} 
```

#### [](#step-6-update-gradle)ç¬¬å…­æ­¥:æ›´æ–°æ ¼æ‹‰å¾·Â·â¬†ï¸

ä½¿ç”¨æ–°çš„ Gradle ç‰ˆæœ¬ 4.7(åœ¨ä¸Šä¸€æ­¥ä¸­æ›´æ–°)å°†è¦æ±‚æ‚¨æ›´æ–°`android/gradle/wrapper/gradle-wrapper.properties`

```
distributionUrl=https\://services.gradle.org/distributions/gradle-4.7-all.zip 
```

#### [](#step-7-update-raw-androidappbuildgradle-endraw-)ç¬¬ä¸ƒæ­¥:æ›´æ–°`android/app/build.gradle` â¬†ï¸

åœ¨`0.58`å¹´ï¼ŒReact Native å¼€å§‹æ¨å‡º 64 ä½ Android ç‰ˆæœ¬ã€‚è¦æ·»åŠ æ­¤ç”Ÿæˆç±»å‹:

**1ã€‚**é¦–å…ˆï¼Œåˆ é™¤`ndk`éƒ¨åˆ†ã€‚å®ƒå°†ä¸å†è¢«ä½¿ç”¨:

```
android {
     defaultConfig {
          // Remove the following:
          ndk {
               abiFilters "armeabi-v7a", "x86"
          }
     }
} 
```

**2ã€‚**å°†`â€œarm64-v8aâ€`æ¶æ„æ·»åŠ åˆ°ä»¥ä¸‹åˆ—è¡¨ä¸­:

```
android {
  splits {
    abi {
      include "armeabi-v7a", "x86", "arm64-v8a"
    }
  }
  buildTypes {
    variant.outputs.each { output ->
      def versionCodes = ["armeabi-v7a":1, "x86":2, "arm64-v8a": 3]
    }
  } 
```

**3ã€‚**æœ€åï¼Œç”±äºæˆ‘ä»¬åªå‡çº§åˆ° React Native `0.58.6`ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®š Android åº”è¯¥ä½¿ç”¨çš„ React Native ä¾èµ–é¡¹:

```
dependencies {
     // implementation "com.facebook.react:reactnative:+"
     implementation "com.facebook.react:react-native:0.58.6"
} 
```

#### [](#step-8-change-up-android-build-scripts)æ­¥éª¤ 8:ä¿®æ”¹ Android æ„å»ºè„šæœ¬ğŸš§

å¯¹äºé‚£äº›ä½¿ç”¨ Buck çš„äººæ¥è¯´ï¼Œæ„å»ºè„šæœ¬å·²ç»æœ‰äº†ä¸€ç‚¹æ”¹å˜:

**1ã€‚**åœ¨`android/app/BUCK`ä¸­ï¼Œç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢`jarfile` / `for aarfile`å¾ªç¯çš„:

```
### OLD CODE lib_deps = []

for jarfile in glob(['libs/*.jar']):
  name = 'jars__' + jarfile[jarfile.rindex('/')+ 1: jarfile.rindex('.jar')]
  lib_deps.append(':' + name)
  prebuilt_jar(
    name = name,
    binary_jar = jarfile,
  )

for aarfile in glob(['libs/*.aar']):
  name = 'aars__' + aarfile[aarfile.rindex('/') + 1: aarfile.rindex('.aar')]
  lib_deps.append(':' + name)
  android_prebuilt_aar(
    name = name,
    aar = aarfile,
 )

### NEW CODE load(":build_defs.bzl", "create_aar_targets", "create_jar_targets")

lib_deps = []

create_aar_targets(glob(["libs/*.aar"]))

create_jar_targets(glob(["libs/*.jar"])) 
```

**2ã€‚**ç°åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„`android/app/build_defs.bzl`æ–‡ä»¶:

```
# android/app/build_defs.bzl 
"""Helper definitions to glob .aar and .jar targets"""
def create_aar_targets(aarfiles):
    for aarfile in aarfiles:
        name = "aars__" + aarfile[aarfile.rindex("/") + 1:aarfile.rindex(".aar")]
        lib_deps.append(":" + name)
        android_prebuilt_aar(
            name = name,
            aar = aarfile,
        )
def create_jar_targets(jarfiles):
    for jarfile in jarfiles:
        name = "jars__" + jarfile[jarfile.rindex("/") + 1:jarfile.rindex(".jar")]
        lib_deps.append(":" + name)
        prebuilt_jar(
            name = name,
            binary_jar = jarfile,
        ) 
```

#### ç¬¬ä¹æ­¥:æ£€æŸ¥ä½ çš„è£åˆ¤ğŸ‘€

`<ScrollView>`ã€`<CameraRollView>`å’Œ`<SwipeableRow>`éƒ½å¾—åˆ°äº†ä¸€äº›æ›´æ–°ï¼Œå¦‚æœä½ åœ¨è¿™äº›ç»„ä»¶ä¸­ä½¿ç”¨ä»»ä½•å¼•ç”¨ï¼Œå¯èƒ½ä¼šç»™ä½ å¸¦æ¥éº»çƒ¦ã€‚

è¿™åœ¨æˆ‘çš„é¡¹ç›®ä¸­ä¸æ˜¯é—®é¢˜ï¼Œä½†å¦‚æœå¯¹ä½ æ¥è¯´æ˜¯ï¼Œå¯¹è¿™äº›ç»„ä»¶ä½¿ç”¨`createRef()`åº”è¯¥èƒ½è®©ä½ é¡ºåˆ©å®Œæˆã€‚æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°[ã€‚](https://github.com/react-native-community/releases/issues/81#issuecomment-459252692)

#### [](#step-10-new-round-android-icons)ç¬¬åæ­¥:æ–°çš„åœ†å½¢å®‰å“å›¾æ ‡ï¼ğŸ‘

æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œç°åœ¨æ”¯æŒåœ†å½¢ Android å›¾æ ‡ï¼è¿™é‡Œæœ‰ä¸€ç¯‡å…³äºå¦‚ä½•åˆ›é€ è¿™äº›çš„æ–‡ç« ã€‚åˆ›å»ºå®Œè¿™äº›æ–‡ä»¶åï¼Œå°†å®ƒä»¬æ·»åŠ åˆ°æ‚¨çš„`android/app/src/main/AndroidManifest.xml`æ–‡ä»¶ä¸­:

```
<manifest...
     <application...
          android:roundIcon="@mipmap/ic_launcher_round" 
```

#### [](#step-11-test-test-test)ç¬¬åä¸€æ­¥:æµ‹è¯•ï¼Œæµ‹è¯•ï¼Œæµ‹è¯•ğŸ§ª

æ„å»ºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚ç¡®ä¿åœ¨å®é™…çš„ iOS å’Œ Android è®¾å¤‡ä¸Šè¿è¡Œå®ƒä»¬ã€‚çœ‹åˆ°ä»»ä½•æ–°çš„åå¯¹è­¦å‘Šå—ï¼Ÿæœ€å¥½ç°åœ¨å°±æŠŠä»–ä»¬æ¶ˆç­åœ¨èŒèŠ½çŠ¶æ€ã€‚å…¶ä¸­ä¸€äº›è­¦å‘Šå¯èƒ½æ¥è‡ªæ‚¨çš„ä¾èµ–é¡¹ã€‚çœ‹çœ‹æ˜¯å¦æœ‰ä»»ä½•æ›´æ–°ã€‚å¦‚æœæ²¡æœ‰ï¼Œæ‚¨å¯èƒ½éœ€è¦è‡ªå·±ä¿®è¡¥ã€‚

**ä¿®è¡¥è½¯ä»¶åŒ…**ğŸš‘

éœ€è¦æ‰“ä¸ªåŒ…è¡¥ä¸ï¼Ÿæˆ‘æœ€å–œæ¬¢çš„æ–¹æ³•æ˜¯ç”¨[è¡¥ä¸åŒ…](https://github.com/ds300/patch-package)ã€‚è¿™æ˜¯ä¸€ä¸ªåº“ï¼Œå®ƒåŒºåˆ†ä½ å¯¹ä¸€ä¸ª`node_modules`åŒ…æ‰€åšçš„æ›´æ”¹ï¼Œä¿å­˜è¿™äº›æ›´æ”¹ï¼Œå¹¶åœ¨æ¯æ¬¡è¿è¡Œ`npm i`æ—¶åº”ç”¨è¿™äº›æ›´æ”¹ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå¿«é€Ÿæ•™ç¨‹:

**1ã€‚**è·‘`npm i patch-package`

**2ã€‚**å°†è¿™ä¸ªå®‰è£…åè„šæœ¬æ·»åŠ åˆ°æ‚¨çš„`package.json`:

```
"scripts":  {  "postinstall":  "patch-package"  } 
```

**3ã€‚**è¿›å…¥ä½ çš„`node_modules`ï¼Œå¯¹ä½ çš„ç›®æ ‡ä¾èµ–åšå‡ºä»»ä½•ä½ éœ€è¦çš„æ”¹å˜ã€‚

**4ã€‚**ä¸€æ—¦å®Œæˆï¼Œè¿è¡Œ`npx patch-package package-name`ã€‚è¿™å°†ä¸ºè¯¥ç‰¹å®šåŒ…åˆ›å»ºä¸€ä¸ªè¡¥ä¸æ–‡ä»¶ã€‚æ‚¨åº”è¯¥å°†è¿™äº›æ–‡ä»¶æäº¤åˆ°é¡¹ç›®ä¸­ã€‚

**5ã€‚**ç°åœ¨ï¼Œæ¯å½“æ‚¨åˆ é™¤`node_modules`æ—¶ï¼Œæ‚¨çš„è¡¥ä¸å°†åœ¨æ‚¨è¿è¡Œ`npm i`åæ·»åŠ ã€‚ğŸ™Œ

#### [](#next-steps)ä¸‹ä¸€æ­¥

ä¸ºä½ çš„é¡¹ç›®å·¥ä½œï¼Ÿæ­å–œä½ ã€‚ğŸ‰ä½ å·²ç»æˆåŠŸä¸€åŠäº†ï¼

æ•¬è¯·å…³æ³¨ç¬¬ 2 éƒ¨åˆ†:å‡çº§åˆ° React Native `0.59`ï¼

[![](../Images/17882124307df624eb816a32c3aa5336.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--sZP_0Ld0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/laychg7tuxkzt61a0jpv.png)

ğŸ‘‹å—¨ï¼æˆ‘æ˜¯[æœ±ä¸½å¶](http://www.julietterapala.com)ã€‚æˆ‘åœ¨ [Eventric](https://www.eventric.com/) å·¥ä½œï¼Œæ˜¯ä¸€åè½¯ä»¶å¼€å‘å‘˜ã€‚è¯·åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘ï¼Œåœ°å€æ˜¯ [@Juliette](https://twitter.com/JulietteR) ã€‚