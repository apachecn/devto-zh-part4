# ä½¿ç”¨ CSS Paint (Houdini) API ç”Ÿæˆå½¢çŠ¶å’Œå›¾åƒ

> åŸæ–‡:[https://dev . to/jamessouth/generating-shapes-and-images-with-CSS-paint-Houdini-API-29c](https://dev.to/jamessouth/generating-shapes-and-images-with-the-css-paint-houdini-api-29c)

æœ‰äº†æ–°çš„ CSS ç”»å›¾ API(åˆåèƒ¡è¿ªå°¼ï¼Œå¤§æ¦‚æ˜¯ä»¥æ¢…å°”æ–‡çš„ä¸“è¾‘å‘½åçš„ğŸ¤˜ğŸ˜)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤§å¤šæ•°çš„ [HTML ç”»å¸ƒç»˜åˆ¶æ–¹æ³•](https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial)æ¥ç»˜åˆ¶å›¾åƒæˆ–å½¢çŠ¶ï¼Œå¹¶åœ¨ä»»ä½•è·å–å›¾åƒçš„ CSS å±æ€§ä¸­ä½¿ç”¨å®ƒã€‚ä»Šå¤©æˆ‘æƒ³å±•ç¤ºæˆ‘æ˜¯å¦‚ä½•åœ¨æˆ‘æ–°é‡å»ºçš„[ä½œå“é›†ç½‘ç«™](https://jamessouth.github.io/portfolio/) *ä¸­ä½¿ç”¨ Houdini æ¥ç”Ÿæˆè¾¹æ¡†å›¾åƒå’Œæ°”æ³¡çŠ¶ div çš„ã€‚æˆ‘è¿˜å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨[polyfill](https://github.com/GoogleChromeLabs/css-paint-polyfill)ï¼Œå¦‚ä½•å°† Houdini ä¸ webpack å’Œ Babel ç»“åˆä½¿ç”¨ï¼Œä»¥åŠåœ¨åˆ¶ä½œä¸‹é¢çš„æ¼”ç¤ºæ—¶é‡åˆ°çš„å›°éš¾ã€‚
* <small>å½“å‰æœªå¤šå¡«å……-é™¤éæ‚¨ä½¿ç”¨ Chrome</small> æŸ¥çœ‹ï¼Œå¦åˆ™æ‚¨å°†çœ‹åˆ°ä¸€ä¸ªå›é€€

ä½¿ç”¨ Houdini çš„åŸºç¡€å¦‚ä¸‹:å¯¹äºä»»ä½•æ¥å—å›¾åƒçš„ CSS å±æ€§ï¼Œæ¯”å¦‚ background-imageï¼Œè¾“å…¥`paint(workletName)`ä½œä¸ºå€¼ã€‚åœ¨ JS æ–‡ä»¶ä¸­ï¼Œä¸ºæ‚¨çš„ worklet åˆ›å»ºä¸€ä¸ª ES6 ç±»ã€‚åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç”¨`workletName`å’Œç±»åä½œä¸ºå‚æ•°è°ƒç”¨`registerPaint`æ–¹æ³•ã€‚ç„¶åï¼Œåœ¨æ‚¨çš„ä¸» JS æ–‡ä»¶æˆ– webpack å…¥å£ç‚¹ä¸­ï¼Œå¯¹`CSS.paintWorklet`è¿›è¡Œç‰¹æ€§æ£€æµ‹ã€‚å¦‚æœæœ‰ï¼Œç°åœ¨åªæœ‰ Chromeï¼Œæ‰“ç”µè¯ç»™`CSS.paintWorklet.addModule('./myWorkletClassFile.js')`ï¼›å¦åˆ™ï¼Œåœ¨`npm i -S css-paint-polyfill`ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€å¯¼å…¥ polyfillï¼Œè¿™æ ·å®ƒå°†æ˜¯ä¸€ä¸ªå•ç‹¬çš„ webpack å—ï¼Œç„¶åè°ƒç”¨`addModule`ã€‚ç°åœ¨æˆ‘ä»¬å‡†å¤‡å¼€å‘æˆ‘ä»¬çš„ç±»ï¼Œå¹¶ç”Ÿæˆä¸€äº›è‰ºæœ¯ï¼æœ¬æ–‡å›è´­:

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png) [è©¹å§†æ–¯Â·ç´¢æ©](https://github.com/jamessouth) / [ç»˜ç”»æ¼”ç¤º](https://github.com/jamessouth/paint-demo)

### å…³äº css paint api çš„ç¬¬ä¸€ç¯‡æ–‡ç« çš„æŠ¥å‘Š

<article class="markdown-body entry-content container-lg" itemprop="text">

# ç»˜ç”»æ¼”ç¤º

æˆ‘çš„æ–‡ç« ä¸­å…³äºæ–°çš„ [CSS Paint (Houdini) API](https://dev.to/jamessouth/generating-shapes-and-images-with-the-css-paint-houdini-api-29c) çš„æ¼”ç¤ºã€‚

[æ¼”ç¤º 1](https://jamessouth.github.io/paint-demo/demo1.html)

[æ¼”ç¤º 2](https://jamessouth.github.io/paint-demo/demo2.html)

[æ¼”ç¤º 3](https://jamessouth.github.io/paint-demo/demo3.html) (ä»…é™ Chrome)

[æ¼”ç¤º 4](https://jamessouth.github.io/paint-demo/demo4.html)

</article>

[View on GitHub](https://github.com/jamessouth/paint-demo)

<figure>

```
//(simplified) index.js, webpack entry point
import '../css/demo.scss';

if (CSS.paintWorklet) {
  //not imported so won't be picked up by webpack, which is ok
  CSS.paintWorklet.addModule('./demo.min.js');
} else {
  import(/* webpackChunkName: "css-paint-polyfill" */ 'css-paint-polyfill').then(() => {
    CSS.paintWorklet.addModule('./demo.min.js');
  });
} 
```

<figcaption>[index.js](https://github.com/jamessouth/paint-demo/blob/master/src/js/index.js)</figcaption>

</figure>

## [](#generating-a-pages-background)ç”Ÿæˆé¡µé¢çš„èƒŒæ™¯

<figure>[![Demo 1](../Images/c0f86e870074c91747acfa6c53865753.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--iLpvZJKJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/jamessouth/paint-demo/master/images/demo1.jpg) 

<figcaption>æ¼”ç¤º 1</figcaption>

</figure>

æ‰€ä»¥è®©æˆ‘ä»¬ä»ç”Ÿæˆé¡µé¢çš„èƒŒæ™¯å¼€å§‹ã€‚Demo 1 æ˜¯[ä½åœ¨è¿™é‡Œ](https://jamessouth.github.io/paint-demo/demo1.html)ã€‚

<figure>

```
 <!--index1.html -->
  <body>
    <div class="bg">
      <div>a</div>
      <div>b</div>
      ...
      <div>n</div>
    </div>
  </body>
<!--a fallback for no support or polyfill, then calling paint with demo1 worklet-->
  <style>
    .bg{
      background-image: linear-gradient(black, black);
      background-image: paint(demo1);
    }
  </style> 
```

<figcaption>[index1.html](https://github.com/jamessouth/paint-demo/blob/master/src/html/index1.html)</figcaption>

</figure>

é€šå¸¸æˆ‘ä¸ä¼šåœ¨ HTML ä¸­æœ‰ä¸€ä¸ª`<style>`æ ‡ç­¾ï¼Œä½†æ˜¯å½“åœ¨ SCSS è¿›è¡Œ`paint`å£°æ˜æ—¶ï¼Œè‡³å°‘å¯¹äºè¿è¡Œåœ¨é¡µé¢åŠ è½½ä¸Šçš„ worklets æ¥è¯´ï¼Œä¼šæœ‰ä¸€äº›ç¼“å­˜é—®é¢˜ã€‚è¦æ˜ç™½æˆ‘çš„æ„æ€ï¼Œè¯·æŸ¥çœ‹ Chrome ä¸­çš„[æ¼”ç¤º 4](https://jamessouth.github.io/paint-demo/demo4.html)â€”â€”æ¯æ¬¡ç‚¹å‡»é‡æ–°åŠ è½½æ—¶ï¼Œé¡µé¢éƒ½æ— æ³•åŠ è½½ğŸ˜¢ã€‚

æˆ‘è®¤ä¸ºåŒæ ·çš„ç¼“å­˜é—®é¢˜ä¹Ÿç»™æˆ‘åœ¨ Firefox ä¸Šå¸¦æ¥äº†é—®é¢˜â€”â€”å¦‚æœæ²¡æœ‰æ‰“å¼€å¼€å‘å·¥å…·å’Œç¦ç”¨ç¼“å­˜æ£€æŸ¥ï¼Œpolyfill å‡ ä¹ä¸ä¼šè¿è¡ŒğŸ˜­ã€‚è¿™å¯èƒ½æ˜¯ç”±äºæˆ‘è®¾ç½®æ¼”ç¤ºå›è´­çš„æ–¹å¼ï¼Œæˆ– GitHub ä¸Šçš„æ‰˜ç®¡ã€‚åœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œpolyfill åœ¨ Edge å’Œ Safari ä¸Šç›¸å½“å¯é ã€‚

å½“èšåˆå¡«å……ä¸è¿è¡Œæ—¶ï¼Œæ‚¨å°†åœ¨å‡ ä½•ä½“ä¸Šçœ‹åˆ°èƒŒæ™¯è‰²ï¼Œè€Œä¸æ˜¯æ¸å˜å›é€€ã€‚èšåˆå¡«å……é€šè¿‡åˆ›å»ºä¸€ä¸ªå›¾åƒæ¥å·¥ä½œï¼Œå› æ­¤å¦‚æœæ‚¨è°ƒæ•´å¤§å°æˆ–é‡æ–°å®šå‘ï¼Œæ‚¨å°†å¾—åˆ°é¡µé¢åŠ è½½æ—¶å½¢æˆçš„åŸå§‹å›¾åƒçš„é‡å¤æˆ–æˆªæ–­ã€‚é€šè¿‡å°†`background-repeat`è®¾ç½®ä¸º`no-repeat`å¯ä»¥é˜²æ­¢é‡å¤ï¼›ä½ ä¹Ÿä¼šçœ‹åˆ°èº«ä½“çš„èƒŒæ™¯é¢œè‰²ã€‚ç”±äº Chrome æœ‰ä¸€äº›å¯¹ Houdini çš„åŸç”Ÿæ”¯æŒï¼Œå½“ä½ è°ƒæ•´å¤§å°æˆ–é‡å®šå‘æ—¶ï¼Œworklet ä¼šå†æ¬¡è¿è¡Œå¹¶é‡æ–°ç»˜åˆ¶ä»¥é€‚åº”æ–°çš„å°ºå¯¸ï¼Œæ‰€ä»¥å¦‚æœä½ ç¼–å†™ä¸€ä¸ªå¤æ‚çš„ paint å‡½æ•°ï¼Œè¯·æ³¨æ„è¿™ä¸€ç‚¹ã€‚

æ¼”ç¤º 1 ä¸­çš„å‡å ä½ç¬¦å†…å®¹åœ¨ä¸€ä¸ª div ä¸­ï¼Œå®ƒå°†ä¿å­˜ç»˜åˆ¶çš„èƒŒæ™¯å¹¶è¦†ç›–é¡µé¢ã€‚è¿™æ˜¯ Chrome ä¸­çš„[é”™è¯¯](https://bugs.chromium.org/p/chromium/issues/detail?id=808908)çš„å˜é€šæ–¹æ³•ï¼Œå®ƒç ´åäº†`body`(æ˜¾ç„¶è¿˜æœ‰`html`å’Œ`:root`)ä¸Šè®¾ç½®çš„ CSS è‡ªå®šä¹‰å±æ€§ï¼Œè‡³å°‘åœ¨ç”»å›¾å°å·¥å…·ä¸­è®¿é—®å®ƒä»¬æ—¶æ˜¯è¿™æ ·ã€‚å‰©ä¸‹çš„ CSS æ˜¯:

<figure>

```
//demo1.scss
.bg{
  --stars: 522;
  min-height: 100vh;
  width: 100%;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
}
.bg div{
  width: 200px;
  height: 200px;
  background-color: coral;
  margin: 1em auto;
  text-align: center;
  font-size: 3em;
} 
```

<figcaption>[demo1.scss](https://github.com/jamessouth/paint-demo/blob/master/src/css/demo1.scss)</figcaption>

</figure>

Chrome bug çš„ç¬¬äºŒä¸ªè§£å†³æ–¹æ³•æ˜¯åœ¨ä¸»ä½“ä¸Šä½¿ç”¨ä¼ªå†…å®¹ï¼Œä½†æ˜¯ polyfill ä¸èµ·ä½œç”¨ã€‚ç¬¬ä¸‰ç§è§£å†³æ–¹æ³•æ˜¯åœ¨ body ä¸Šè®¾ç½®è‡ªå®šä¹‰å±æ€§ï¼Œç„¶ååœ¨ worklet ä¸­æµ‹è¯•é“å…·çš„å­˜åœ¨ã€‚å¦‚æœæ²¡æœ‰(Chrome å°±æ˜¯è¿™ç§æƒ…å†µ)ï¼Œè®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ã€‚ä¸ç®¡æ€æ ·ï¼Œè®©æˆ‘ä»¬å¼€å§‹å·¥ä½œå§ï¼

åœ¨æˆ‘ä»¬çš„ worklet ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºé™æ€çš„å¸®åŠ©å™¨æ–¹æ³•ç”¨äº`paint`æ–¹æ³•ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬è¿›è¡Œç»˜å›¾ã€‚`paint`æ–¹æ³•æœ‰ 1 åˆ° 4 ä¸ªå‚æ•°:

*   è°ƒç”¨ç»˜å›¾æ–¹æ³•çš„ç”»å¸ƒä¸Šä¸‹æ–‡(`ctx`)
*   ä½ æ­£åœ¨ç»˜åˆ¶çš„å…ƒç´ çš„å°ºå¯¸ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ææ„ä¸º`{ width, height }`
*   `props`ï¼Œå…è®¸æ‚¨è®¿é—® CSS è‡ªå®šä¹‰å±æ€§
*   ä¸€ä¸ª`args`æ•°ç»„ï¼Œä¿å­˜ä» CSS ä¸­è°ƒç”¨ç”»å›¾å°å·¥å…·æ—¶ä¼ å…¥çš„å‚æ•°ï¼Œå°±åƒ`paint(workletName, arg1, arg2, ...)`

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä»»ä½•åœ°æ–¹éƒ½ä¸æ”¯æŒ argsğŸ˜­ã€‚èƒ¡è¿ªå°¼å‡†å¤‡å¥½äº†å—ï¼Ÿè¿›è¡Œæ›´æ–°ã€‚

<figure>

```
//demo1.js
class Demo1 {
  static get inputProperties() { return ['--stars']; }//access CSS custom property

  static getWidth() {
    return Math.floor(Math.random() * 10) + 1;
  }

  //other static methods omitted but they all just return random numbers

  paint(ctx, { width, height }, props) {
    const stars = props.get('--stars');//use CSS custom property

    ctx.fillStyle = 'rgb(0, 0, 0)';
    ctx.fillRect(0, 0, width, height);//cover all of element

    for (let i = 0; i < stars; i += 1) {//populate stars on black background
      ctx.fillStyle = `rgba(255, 255, 255, ${Demo.getTransparency()})`;//hsla not working in Edge
      ctx.fillRect(Demo.getDistAlongSide(width), Demo.getDistAlongSide(height), 1, 1);
    }

    const ctr = [//all lines start halfway across, just below bottom
      width / 2,
      height + 2,
    ];

    for (let i = 0; i < 700; i += 1) {
      const startSide = i % 4;
      const endSide = (startSide + Demo.getEndSide()) % 4;
      ctx.beginPath();
      ctx.moveTo(...ctr);//spread coordinates as two args
      ctx.lineTo(...Demo.getPoint(endSide, width, height));
      ctx.lineWidth = Demo.getWidth();
      ctx.lineCap = 'square';
      ctx.strokeStyle = `rgba(${Demo.getColor(240, 15)}, ${Demo.getColor(240, 15)}, ${Demo.getColor(50, 20)},
        .05)`;//use high opacity for a Roy Lichtenstein/pop-art look
      ctx.stroke();
    }
  }
}
registerPaint('demo1', Demo1);//called with worklet name and class name 
```

<figcaption>[demo1.js](https://github.com/jamessouth/paint-demo/blob/master/src/js/demo1.js)</figcaption>

</figure>

ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹æ„å»ºäº†ï¼æ®æˆ‘æ‰€çŸ¥ï¼Œ [Worklet æ¥å£](https://developer.mozilla.org/en-US/docs/Web/API/Worklet)åªæ¥å— ES6 ç±»ï¼Œæ‰€ä»¥ trans piled-to-ES5-function Worklet ä¸èµ·ä½œç”¨ï¼Œwebpack åŒ…è£…åœ¨å‡½æ•°ä¸­çš„ç±»ä¹Ÿä¸èµ·ä½œç”¨(å¦‚æœæœ‰åŠæ³•åœ¨ webpack ä¸­ç¼©å°ï¼Œè¯·å›ç­”[æˆ‘å…³äºå †æ ˆæº¢å‡ºçš„é—®é¢˜](https://stackoverflow.com/questions/57402682/how-to-just-minify-and-nothing-else-a-js-worklet-file-in-webpack))ã€‚æ‰€ä»¥ï¼Œæˆ‘ä¸€ç›´åœ¨ webpack ä¹‹å¤–å¤„ç†å®ƒä»¬ã€‚è¿™å·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†æ˜¯ä½¿å¾—å¼€å‘ä¸­çš„è¿­ä»£æœ‰ç‚¹æ…¢ã€‚å®‰è£… [`babel-minify`](https://www.npmjs.com/package/babel-minify) åŒ…ä½œä¸ºå¼€å‘ä¾èµ–é¡¹ï¼Œç„¶ååœ¨`package.json`ä¸­ç¼©å°ä½ çš„ worklet æ–‡ä»¶å¹¶æŠŠå®ƒä»¬æ”¾åœ¨ä½ çš„`/dist`æ–‡ä»¶å¤¹:

<figure>

```
 //package.json
  "scripts": {
    "lint": "eslint ./src/js",
    "dev": "webpack-dev-server",
    "build": "webpack",
    "prebuild": "rm -f dist/demo1.min.js && npx minify src/js/demo1.js --out-file dist/demo1.min.js..."
// && minify the other worklets etc...
  } 
```

<figcaption>[package.json](https://github.com/jamessouth/paint-demo/blob/master/package.json)</figcaption>

</figure>

åœ¨æˆ‘çš„ webpack é…ç½®ä¸­ï¼Œæˆ‘ä½¿ç”¨`CleanWebpackPlugin`å¹¶åˆ é™¤æ‰€æœ‰å†…å®¹ï¼Œé™¤äº†ç¼©å°çš„ worklet æ–‡ä»¶:

<figure>

```
 //webpack.config.js
  plugins: [
    new CleanWebpackPlugin({ cleanOnceBeforeBuildPatterns: [
      '**/*',
      '!demo1.min.js',
      //other worklet files...
    ] }), 
```

<figcaption>[webpack.config.js](https://github.com/jamessouth/paint-demo/blob/master/webpack.config.js)</figcaption>

</figure>

ä¸ºäº†å¼€å‘ workletï¼Œæˆ‘å°†å®ƒç§»åŠ¨åˆ°`/dist`æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶å°†å…¶å‘½åä¸º`demo1.min.js`,å› ä¸ºè¿™æ˜¯æˆ‘åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨çš„åç§°ã€‚ç°åœ¨ï¼Œå½“æˆ‘å¯åŠ¨`webpack-dev-server`æ—¶ï¼Œ`/dist`è¢«æ¸…é™¤ï¼Œé™¤äº†å·¥ä½œæµï¼Œå¼€å‘å·¥ä½œæµæ˜¯æ­£å¸¸çš„ï¼Œé™¤äº†å¿…é¡»æ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨ä»¥åæ˜ å·¥ä½œæµçš„å˜åŒ–ã€‚å½“æˆ‘å®Œæˆæ—¶ï¼Œæˆ‘å°†å·¥ä½œæµç§»å›æºä»£ç (é‡å‘½åä¸º`demo1.js`)å¹¶æ„å»ºç”¨äºç”Ÿäº§ã€‚é¢„æ„å»ºè„šæœ¬å°†ç¼©å°å·¥ä½œå°ç¨‹åºï¼Œwebpack å°†å¤„ç†å‰©ä¸‹çš„å·¥ä½œï¼

## [](#generating-border-images)ç”Ÿæˆè¾¹æ¡†å›¾åƒ

<figure>[![Demo 2](../Images/fc3297114fb355eb3aa1b98d9b103d68.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--e88XKSz_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/jamessouth/paint-demo/master/images/demo2.jpg) 

<figcaption>è¯•ç© 2</figcaption>

</figure>

æ¼”ç¤º 2 [(ç°åœº)](https://jamessouth.github.io/paint-demo/demo2.html)ä¸æ¼”ç¤º 1 çš„ç»“æ„ç›¸ä¼¼ï¼Œåªæ˜¯ä¸€äº›è™šæ‹Ÿå†…å®¹:

<figure>

```
 <!--index2.html-->
  <body class="border">
    <div>a</div>
    <div>b</div>
    <div>c</div>
    <div>d</div>
  </body>
  <style>
    .border div{
      border-image-source: linear-gradient(blue, blue);
      border-image-source: paint(demo2);
    }
  </style> 
```

<figcaption>[index2.html](https://github.com/jamessouth/paint-demo/blob/master/src/html/index2.html)</figcaption>

</figure>

å®ƒçš„é£æ ¼ç±»ä¼¼äºæ¼”ç¤º 1ï¼Œé™¤äº†æˆ‘ä»¬ä½¿ç”¨èƒ¡è¿ªå°¼æ¥ç”Ÿæˆ[è¾¹ç•Œå›¾åƒ](https://developer.mozilla.org/en-US/docs/Web/CSS/border-image) :

<figure>

```
//demo2.scss
.border{
  min-height: 100vh;
  width: 100%;
  background-color: #efefef;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(284px, 1fr));
}
.border div{
  width: 200px;
  height: 200px;
  background-color: coral;
  margin: 1em auto;
  text-align: center;
  font-size: 3em;
  --lines: 343;
  border-image: 82 / 42px / 14;//short for border-image-slice, -width, -outset
  border-style: solid;
} 
```

<figcaption>[demo2.scss](https://github.com/jamessouth/paint-demo/blob/master/src/css/demo2.scss)</figcaption>

</figure>

åªæ˜¯ç”»ä¸€å †çº¿ï¼Œå½¢æˆæˆ‘ä»¬è®¾ç½®ä¸ºè¾¹ç•Œå›¾åƒæºçš„å›¾åƒ:

<figure>

```
//demo2.js
class Demo2 {
  static get inputProperties() { return ['--lines']; }//CSS custom prop

  //static methods omitted but they all just return random numbers

  paint(ctx, { width, height }, props) {
    const lines = props.get('--lines');

    for (let i = 0; i < lines; i += 1) {
      const start = Demo2.getRandomPoint(width, height);
      const end = Demo2.getRandomPoint(width, height);
      ctx.beginPath();
      ctx.moveTo(...start);
      ctx.lineTo(...end);
      ctx.lineWidth = Demo2.getWidth();
      ctx.lineCap = 'square';
      ctx.strokeStyle = `rgba(${Demo2.getColor(36, 150)}, ${Demo2.getColor(108, 150)}, ${Demo2.getColor(12, 200)}, ${Demo2.getTransparency()})`;
      ctx.stroke();
    }
  }
}
registerPaint('demo2', Demo2); 
```

<figcaption>[demo2.js](https://github.com/jamessouth/paint-demo/blob/master/src/js/demo2.js)</figcaption>

</figure>

åœ¨æˆ‘çš„[æ–‡ä»¶å¤¹ç½‘ç«™](https://jamessouth.github.io/portfolio/)ä¸­ï¼Œæˆ‘åªå¯¹ç„¦ç‚¹æ ·å¼å’Œåº•éƒ¨è¾¹æ¡†ä½¿ç”¨äº†è¿™ç§æŠ€æœ¯ï¼›è¿™é‡Œæ˜¯ [SCSS](https://github.com/jamessouth/portfolio/blob/master/src/css/main.scss#L170) å’Œ[çš„å°å·¥ä½œå°](https://github.com/jamessouth/portfolio/blob/master/src/js/BorderPaint.js)ã€‚

## [](#generating-arbitrarilyshaped-elements)ç”Ÿæˆä»»æ„å½¢çŠ¶çš„å…ƒç´ 

<figure>[![Demo 3](../Images/e8bf49c3c59aaf37763da6b05e457d1e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--_L1bYzTT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/jamessouth/paint-demo/master/images/demo3.jpg) 

<figcaption>æ¼”ç¤º 3ã€‚è“è‰²çš„äº‘ï¼Œå®ƒçš„è½®å»“ï¼Œå’Œæ„Ÿå¹å·è¢«é®ç½©ï¼Œçº¢è‰²/é»„è‰²/ç™½è‰²çˆ†ç‚¸è¢«ç»˜åˆ¶ï¼ŒèƒŒæ™¯æ˜¯ä¸€ä¸ª CSS åœ†é”¥å½¢æ¸å˜ã€‚</figcaption>

</figure>

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Houdini ç”¨ [`mask-image`](https://developer.mozilla.org/en-US/docs/Web/CSS/mask-image) å±æ€§å°† div é›•åˆ»æˆä»»ä½•å½¢çŠ¶(è¿™é‡Œæ˜¯æˆ‘ä½œå“é›†çš„[è¯­éŸ³æ³¡æ³¡å·¥å…·åŒ…](https://github.com/jamessouth/portfolio/blob/master/src/js/ButtonPaint.js))ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿™æ ·åšçš„ä»»ä½•å…ƒç´ åœ¨ CSS ç›’å­æ¨¡å‹ä¸­ä»ç„¶ä¼šå æ®ä¸€ä¸ªçŸ©å½¢ï¼Œä½†æ˜¯åœ¨å®ƒçš„ç›’å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•å¤–è§‚ã€‚å¯¹äºç¬¬ä¸‰ä¸ªæ¼”ç¤ºï¼Œæˆ‘æœ‰ç‚¹ç–¯ç‹‚:æˆ‘é‡æ–°åˆ›å»ºäº† [POPï¼ç¾å›½è‰ºæœ¯å®¶](https://www.imageduplicator.com/sat/sat_big_image.php?image_name=images/works/3794_01.jpg)[ç½—ä¼ŠÂ·åˆ©å¸Œæ»•æ–¯å¦](https://lichtensteinfoundation.org/biography/)ä¸º 1966 å¹´ 4 æœˆ 25 æ—¥å‡ºç‰ˆçš„*æ–°é—»å‘¨åˆŠ*å°é¢åˆ¶ä½œçš„çˆ†ç‚¸çŸ³ç‰ˆç”»ã€‚è¿™ä¸ªåªèƒ½åœ¨ Chrome ä¸­ä½¿ç”¨ï¼Œå› ä¸º polyfill ä¼¼ä¹ä¸å–œæ¬¢åœ¨ä¸€ä¸ªæ ·å¼è¡¨ä¸­æœ‰å¤šä¸ª`paint`å€¼ï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨å¤šä¸ªæ ·å¼è¡¨ï¼Œæ¯ä¸ªæ ·å¼è¡¨è°ƒç”¨ä¸€ä¸ª`paint`æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚Demo 3 æ˜¯[ä½åœ¨è¿™é‡Œ](https://jamessouth.github.io/paint-demo/demo3.html)ã€‚

<figure>

```
 <!--index3.html -->
  <body class="shape">
    <div id="pop">
      <p><span>P</span><span>O</span>P</p>
    </div>
    <div id="expt"></div>
    <div id="blue"></div>
    <div id="outline"></div>
  </body>
  <style>
    #expt{
      -webkit-mask-image: paint(demo3b);
      mask-image: paint(demo3b);
    }
    #pop{
      background-image: paint(demo3a);
    }
    #blue{
      -webkit-mask-image: paint(demo3c);
      mask-image: paint(demo3c);
    }
    #outline{
      -webkit-mask-image: paint(demo3d);
      mask-image: paint(demo3d);
    }
  </style> 
```

<figcaption>[index3.html](https://github.com/jamessouth/paint-demo/blob/master/src/html/index3.html)</figcaption>

</figure>

äº‘ä¸è½®å»“çš„å‰©ä½™ CSS:

<figure>

```
//(partial) demo3.scss
#blue{
  background-color: #f5f9fc;
  background-image: radial-gradient(#1b4282 30%, #122182 32%, #1a237e12 33%),
                    radial-gradient(#1b4282 30%, #14248e 32%, #1a237e08 33%);
  background-size: 8px 8px;
  background-position: 0 0, 4px 4px;
}
#outline{
  background-color: #282a2c;
} 
```

<figcaption>[demo3.scss](https://github.com/jamessouth/paint-demo/blob/master/src/css/demo3.scss)</figcaption>

</figure>

å°± worklet ä»£ç è€Œè¨€ï¼Œé®ç½©å’Œç»˜åˆ¶ä¹‹é—´å‡ ä¹æ²¡æœ‰åŒºåˆ«ã€‚å¯¹äº[æ„Ÿå¹å·](https://github.com/jamessouth/paint-demo/blob/master/src/js/demo3b.js)å’Œ[äº‘è½®å»“](https://github.com/jamessouth/paint-demo/blob/master/src/js/demo3d.js)ï¼Œä¸¤ç§æ–¹å¼éƒ½æœ‰æ•ˆï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯çº¯è‰²ã€‚[çº¢/é»„/ç™½çˆ†ç‚¸](https://github.com/jamessouth/paint-demo/blob/master/src/js/demo3a.js)ä¹Ÿæ˜¯å®å¿ƒçš„ï¼Œä½†æ˜¯æˆ‘ç”»å®ƒæ˜¯ä¸ºäº†åº”ç”¨é»‘è‰²è½®å»“ï¼›ä¼¼ä¹ä¸å¯èƒ½æ—¢é®è”½ä¸€ä¸ªå½¢çŠ¶åˆåœ¨å®ƒå‘¨å›´æœ‰ä¸€ä¸ªè½®å»“ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆäº‘çš„è½®å»“æ˜¯ä¸€ä¸ªå•ç‹¬çš„å·¥ä½œä»¶ã€‚

æˆ‘è¯•ç€åœ¨å·¥ä½œå›¾ä¸­ç»˜åˆ¶è“è‰²çš„äº‘ï¼Œä½†æ˜¯çœ‹èµ·æ¥ä¸å¤ªå¥½ã€‚åµŒå¥—å¾ªç¯å¯ä»¥ç”¨æ¥ç»˜åˆ¶ä¸»é¢˜å…ƒç´ çš„å®½åº¦å’Œé«˜åº¦ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰æ‰¾åˆ°ä¸€ç§æ–¹æ³•å°†ç»˜åˆ¶çš„å†…å®¹é™åˆ¶åœ¨äº‘çš„è¾¹ç•Œå†…ã€‚æˆ‘è¿˜å°è¯•äº† [ctx.createPattern()](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/createPattern) æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘æ‰¾ä¸åˆ°ä¸€ç§æ–¹æ³•å°†ä¸€ä¸ªå›¾åƒæ”¾å…¥ worklet(æ²¡æœ‰ DOM è®¿é—®)ä½œä¸ºæ¨¡å¼æºã€‚å› æ­¤ï¼Œæˆ‘åœ¨ CSS ä¸­åˆ¶ä½œäº†äº‘çš„å›¾æ¡ˆï¼Œç„¶ååœ¨ä¸€ä¸ªå°å·¥å…·ä¸­é®ç›–äº†å½¢çŠ¶ï¼Œå› æ­¤éœ€è¦å¦ä¸€ä¸ªå°å·¥å…·æ¥åˆ¶ä½œè½®å»“ã€‚

ä¸ºäº†å¸®åŠ©ç»˜åˆ¶è¿™äº›å½¢çŠ¶ï¼Œæˆ‘ä½¿ç”¨äº†[è¿™ä¸ªå·¥å…·](http://www.victoriakirst.com/beziertool/)ï¼Œå®ƒç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤å¹¶æ·»åŠ  x å’Œ y åç§»ï¼Œç„¶åæˆ‘ç”¨å®ƒæ¥å®šä½ div ä¸­çš„å½¢çŠ¶ã€‚

## [](#more-on-the-polyfill-and-conclusion)å¤šä¸Šå¤šä¸‹å’Œç»“è®º

æˆ‘æƒ³ç”¨ polyfill å±•ç¤ºçš„æœ€åä¸€ä»¶äº‹æ˜¯ï¼Œåœ¨å…¶ä»–å£°æ˜ä¹‹å‰è°ƒç”¨ CSS ä¸­çš„`paint`ä¼¼ä¹æ¯”æŠŠå®ƒæ”¾åœ¨ä»»ä½•åœ°æ–¹éƒ½æ›´å¥½ã€‚æˆ‘åˆ¶ä½œäº†[æ¼”ç¤º 4](https://jamessouth.github.io/paint-demo/demo4.html) æ¥å±•ç¤ºå‰é¢æåˆ°çš„å½“`paint`åœ¨ SCSS è¢«è°ƒç”¨æ—¶çš„ç¼“å­˜é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†è¯´æ˜å¦‚æœå…¶ä»–å£°æ˜å‡ºç°åœ¨å®ƒä¹‹å‰ï¼Œpolyfill ä¼¼ä¹ä¸ä¼šç»å¸¸è¿è¡Œï¼Œæ‰€ä»¥ä½ åªèƒ½å¾—åˆ°ä¸»ä½“çš„èƒŒæ™¯é¢œè‰²ã€‚è¿™ç¯‡æ–‡ç« çš„å°é¢å›¾ç‰‡æ˜¯æ¼”ç¤º 4 çš„ä¸€ä¸ªé•œå¤´ã€‚

<figure>

```
//demo4.scss
.cache{
  //put paint declaration first for best results
  background-image: linear-gradient(black, black);
  background-image: paint(demo4);
  --rays: 582;
  min-height: 100vh;
  width: 100%;
} 
```

<figcaption>[demo4.scss](https://github.com/jamessouth/paint-demo/blob/master/src/css/demo4.scss)</figcaption>

</figure>

åœ¨æˆ‘å‘ç°è¿™ç§æ”¾ç½®æœ‰æ‰€ä¸åŒä¹‹å‰ï¼Œéœ€è¦åƒ`display: block`è¿™æ ·çœ‹ä¼¼éšæœºçš„å£°æ˜(å°½ç®¡è¿™å·²ç»æ˜¯ div çš„é»˜è®¤è®¾ç½®)æ¥è¿è¡Œ polyfillğŸ˜–ğŸ˜•ğŸ˜µğŸ¤¦â€â™‚ï¸.

* * *

èƒ¡è¿ªå°¼æ˜¯æ–°å…´æŠ€æœ¯ï¼Œæœ‰è¶Šæ¥è¶Šå¤šçš„æµè§ˆå™¨æ”¯æŒ T2ï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»å¯ä»¥ç”¨æˆ‘ä»¬çš„èƒŒæ™¯ã€è¾¹æ¡†å’Œ div åšå¾ˆå¤šå¾ˆé…·çš„äº‹æƒ…ã€‚èƒ½æƒ³è±¡å‡ºæ¥å°±èƒ½ç”»å‡ºæ¥ï¼æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œå¹¶èƒ½æ¿€å‘ä½ ä½¿ç”¨`paint`æ¥æ¨è¿›ä½ çš„å‰ç«¯åˆ›é€ åŠ›ã€‚è¯·ç•™ä¸‹è¯„è®ºï¼Œå¹¿æ³›åˆ†äº«ï¼è°¢è°¢å¤§å®¶ï¼