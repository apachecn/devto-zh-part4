# è®©æˆ‘ä»¬ç”¨ Tensorflow.js åœ¨ 10 åˆ†é’Ÿå†…æ„å»ºä¸€ä¸ªæ¸¸æˆğŸ®

> åŸæ–‡ï¼š<https://dev.to/yashints/let-s-build-a-game-with-tensorflow-js-in-10-minutes-1co5>

æˆ‘æœ€è¿‘ä¸€ç›´åœ¨ç© [Tensorflow.js](https://www.tensorflow.org/js) ï¼Œå‘ç°æ•´ä¸ªæ¦‚å¿µå¾ˆå¸å¼•äººã€‚ä¹‹å‰æˆ‘å†™äº†ä¸€ç¯‡å…³äº[å¦‚ä½•å¼€å§‹](https://yashints.dev/blog/2018/11/27/get-started-with-tensorflowjs)çš„æ–‡ç« ï¼Œæˆ‘æ‰“ç®—å†™æ›´å¤šå…³äºåˆ›å»ºä¸€ä¸ªæ–°æ¨¡å‹çš„æ‰€æœ‰æ–¹é¢ï¼Œç”¨å®ƒè½¬ç§»å­¦ä¹ ï¼Œæˆ–è€…åªæ˜¯ä½¿ç”¨é¢„å…ˆè®­ç»ƒçš„æ¨¡å‹è¿›è¡Œæ¨ç†ã€‚

## è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„è®¡åˆ’ğŸ—ºï¸

ä»Šå¤©æˆ‘ä»¬æƒ³:

*   æ‰¾ä¸€ä¸ªç”¨ JavaScript å†™çš„æ¸¸æˆ
*   æ‰¾åˆ°ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥æ§åˆ¶æ¸¸æˆçš„æ¨¡å‹
*   å°†è¿™ä¸¤è€…æ··åˆåœ¨ä¸€èµ·ï¼Œäº«å—ä¹è¶£ğŸ¤ª
*   ä¸è¦æŠ±æ€¨æˆ‘ä»¬åˆšåˆšå†™çš„ä»£ç ç ´åäº†ä¹è¶£ğŸ˜

## å…è´£å£°æ˜

æˆ‘åœ¨è¿™é‡Œæ²¡æœ‰å±•ç¤ºä»»ä½•å…³äº JavaScript ä»£ç çš„æœ€ä½³å®è·µã€‚å®ƒæ˜¯ä»å…¶ä»–åœ°æ–¹å¤åˆ¶ç²˜è´´çš„ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯è®©å®ƒå·¥ä½œã€‚

## å¯»æ‰¾æ¸¸æˆ

å½“æˆ‘ä¸ºæˆ‘å…³äºäººå·¥æ™ºèƒ½å’Œ JavaScript çš„æ¼”è®²[åˆ¶ä½œä¸€ä¸ªæ¼”ç¤ºæ—¶ï¼Œæˆ‘åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æœç´¢ä¸€ä¸ªç”¨ JavaScript ç¼–å†™çš„æ¸¸æˆã€‚æˆ‘ä¸æƒ³è¦ä¸€ä¸ªå¤æ‚çš„æ¸¸æˆï¼Œåªæ˜¯ä¸€äº›è½»é‡çº§çš„ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°å®šåˆ¶ã€‚](https://www.youtube.com/watch?v=P1gBGT7R7jE)

ä½ ç°åœ¨å¯ä»¥çœ‹æˆ‘çš„æ¼”è®²äº†ğŸ‘‡ğŸ¼ï¼š

[https://www.youtube.com/embed/P1gBGT7R7jE](https://www.youtube.com/embed/P1gBGT7R7jE)

åœ¨è°·æ­Œæœç´¢äº†ä¸€ä¸ª`JavaScript game`åï¼Œæˆ‘åœ¨ W3Schools ä¸Šæ‰¾åˆ°äº†[è¿™ä¸ªæ¸¸æˆ:](https://www.w3schools.com/graphics/game_score.asp)

[![A simple game written in JavaScript and HTML](img/ca2c1afee564d22fbc7f67221cc78f75.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--yP482xOq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/2t06ff3tbtw6lhawpj1x.gif)

æ¸¸æˆå¾ˆç®€å•ã€‚ä½ åªéœ€è¦åœ¨è¿›æ¥çš„ç»¿è‰²æ¡ä¹‹é—´å¼•å¯¼çº¢è‰²ç«‹æ–¹ä½“ã€‚å¦‚æœå®ƒç¢°åˆ°ä»»ä½•ç»¿è‰²æ¡ï¼Œæ¸¸æˆå°±ç»“æŸäº†ã€‚

## å¯»æ‰¾åˆé€‚çš„æ¨¡å‹

å¯¹äºè¿™ä¸ªæ¸¸æˆï¼Œæˆ‘èƒ½æƒ³åˆ°çš„æœ€å¿«çš„å°±æ˜¯[è¯­éŸ³å‘½ä»¤](https://github.com/tensorflow/tfjs-models/tree/master/speech-commands)ã€‚è¯¥æ¨¡å‹è¯†åˆ«ç”±ç®€å•å•è¯ç»„æˆçš„å£å¤´å‘½ä»¤ã€‚ç°åœ¨å®ƒåªæœ‰ 18 ä¸ªå•è¯ï¼Œä½†æˆ‘ä»¬ç”šè‡³ä¸éœ€è¦å®ƒï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦çš„åªæ˜¯æ–¹å‘(`up`ã€`down`ã€`left`å’Œ`right`)ã€‚

è¿™ä¸ªæ¨¡å‹ä½¿ç”¨ [WebAudio API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API) é€šè¿‡ä½ çš„éº¦å…‹é£å¬ä½ çš„å£°éŸ³ã€‚

## å’±ä»¬ç å§ğŸ’»

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¾—åˆ°æ¸¸æˆèƒŒåçš„ä»£ç ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨åŒä¸€ä¸ª[é¡µé¢ä¸Šæ‰¾åˆ°äº†æ¸¸æˆ](https://www.w3schools.com/graphics/tryit.asp?filename=trygame_score)ã€‚

```
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    border:1px solid #d3d3d3;
    background-color: #f1f1f1;
}
</style>
</head>
<body onload="startGame()">
<script>

var myGamePiece;
var myObstacles = [];
var myScore;

function startGame() {
    myGamePiece = new component(30, 30, "red", 10, 120);
    myScore = new component("30px", "Consolas", "black", 280, 40, "text");
    myGameArea.start();
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = 480;
        this.canvas.height = 270;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.frameNo = 0;
        this.interval = setInterval(updateGameArea, 20);
        },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    },
    stop : function() {
        clearInterval(this.interval);
    }
}

function component(width, height, color, x, y, type) {
    this.type = type;
    this.width = width;
    this.height = height;
    this.speedX = 0;
    this.speedY = 0;    
    this.x = x;
    this.y = y;    
    this.update = function() {
        ctx = myGameArea.context;
        if (this.type == "text") {
            ctx.font = this.width + "  " + this.height;
            ctx.fillStyle = color;
            ctx.fillText(this.text, this.x, this.y);
        } else {
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
    }
    this.newPos = function() {
        this.x += this.speedX;
        this.y += this.speedY;        
    }
    this.crashWith = function(otherobj) {
        var myleft = this.x;
        var myright = this.x + (this.width);
        var mytop = this.y;
        var mybottom = this.y + (this.height);
        var otherleft = otherobj.x;
        var otherright = otherobj.x + (otherobj.width);
        var othertop = otherobj.y;
        var otherbottom = otherobj.y + (otherobj.height);
        var crash = true;
        if ((mybottom < othertop) || (mytop > otherbottom) || (myright < otherleft) || (myleft > otherright)) {
            crash = false;
        }
        return crash;
    }
}

function updateGameArea() {
    var x, height, gap, minHeight, maxHeight, minGap, maxGap;
    for (i = 0; i < myObstacles.length; i += 1) {
        if (myGamePiece.crashWith(myObstacles[i])) {
            myGameArea.stop();
            return;
        } 
    }
    myGameArea.clear();
    myGameArea.frameNo += 1;
    if (myGameArea.frameNo == 1 || everyinterval(150)) {
        x = myGameArea.canvas.width;
        minHeight = 20;
        maxHeight = 200;
        height = Math.floor(Math.random()*(maxHeight-minHeight+1)+minHeight);
        minGap = 50;
        maxGap = 200;
        gap = Math.floor(Math.random()*(maxGap-minGap+1)+minGap);
        myObstacles.push(new component(10, height, "green", x, 0));
        myObstacles.push(new component(10, x - height - gap, "green", x, height + gap));
    }
    for (i = 0; i < myObstacles.length; i += 1) {
        myObstacles[i].speedX = -1;
        myObstacles[i].newPos();
        myObstacles[i].update();
    }
    myScore.text="SCORE: " + myGameArea.frameNo;
    myScore.update();
    myGamePiece.newPos();    
    myGamePiece.update();
}

function everyinterval(n) {
    if ((myGameArea.frameNo / n) % 1 == 0) {return true;}
    return false;
}

function moveup() {
    myGamePiece.speedY = -1; 
}

function movedown() {
    myGamePiece.speedY = 1; 
}

function moveleft() {
    myGamePiece.speedX = -1; 
}

function moveright() {
    myGamePiece.speedX = 1; 
}

function clearmove() {
    myGamePiece.speedX = 0; 
    myGamePiece.speedY = 0; 
}
</script>
<div style="text-align:center;width:480px;">
  <button onmousedown="moveup()" onmouseup="clearmove()" ontouchstart="moveup()">UP</button><br><br>
  <button onmousedown="moveleft()" onmouseup="clearmove()" ontouchstart="moveleft()">LEFT</button>
  <button onmousedown="moveright()" onmouseup="clearmove()" ontouchstart="moveright()">RIGHT</button><br><br>
  <button onmousedown="movedown()" onmouseup="clearmove()" ontouchstart="movedown()">DOWN</button>
</div>

<p>The score will count one point for each frame you manage to "stay alive".</p>
</body>
</html> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### åˆ›å»ºé¡¹ç›®ç»“æ„

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è®¾ç½®é¡¹ç›®ç»“æ„ã€‚æˆ‘ä»¬éœ€è¦ä»¥ä¸‹æ–‡ä»¶:

*   `package.json`
*   `index.html`
*   `game.js`
*   `index.js`

åœ¨æˆ‘ä»¬çš„`package.json`ä¸­ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸€äº›ä¾èµ–é¡¹å’Œä¸€ä¸ªè„šæœ¬å‘½ä»¤æ¥è¿è¡Œåº”ç”¨ç¨‹åºã€‚

```
{  ...  "dependencies":  {  "@tensorflow-models/speech-commands":  "^0.3.9",  "@tensorflow/tfjs":  "^1.2.8"  },  "scripts":  {  "watch":  "cross-env NODE_OPTIONS=--max_old_space_size=4096 NODE_ENV=development parcel index.html --no-hmr --open"  },  "devDependencies":  {  "@babel/core":  "^7.0.0-0",  "@babel/plugin-transform-runtime":  "^7.1.0",  "babel-core":  "^6.26.3",  "babel-polyfill":  "~6.26.0",  "babel-preset-env":  "~1.6.1",  "babel-preset-es2017":  "^6.24.1",  "clang-format":  "~1.2.2",  "cross-env":  "^5.2.0",  "eslint":  "^4.19.1",  "eslint-config-google":  "^0.9.1",  "parcel-bundler":  "~1.10.3"  },  ...  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘åœ¨è¿™é‡Œç”¨çš„æ˜¯åŒ…è£¹ï¼Œå› ä¸ºå®ƒå¾ˆå®¹æ˜“å®‰è£…ï¼Œè€Œä¸”å¾ˆå¥½ç”¨ã€‚æ­¤å¤–ï¼Œ [Tensorflow.js æ¨¡å‹ GitHub èµ„æºåº“](https://github.com/tensorflow/tfjs-models)ä¸Šçš„å¤§éƒ¨åˆ†æ¼”ç¤ºéƒ½æ˜¯ä½¿ç”¨ parcelã€‚

æ‚¨çš„é¡¹ç›®ç»“æ„åº”è¯¥æ˜¯è¿™æ ·çš„:

[![Project structure](img/8b98fa150797cabbf856ec8e75d2588b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ICyYXC4G--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/slboqeldmivtc8pgj5hc.jpg)

### å°†æ¸¸æˆä»£ç è½¬æ¢æˆæ¨¡å—

ç°åœ¨ï¼Œæˆ‘ä»¬ä¸è¦å¤ªå…³æ³¨ä»£ç ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åšä¸€äº›é‡æ„ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°† JavaScript ä»£ç åˆ†ç¦»åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚è¿™æ ·ï¼Œä½ çš„ HTML åº”è¯¥çœ‹èµ·æ¥åƒ:

```
<!DOCTYPE html>

<html class="no-js">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>TensorFlow.js Speech Commands Model Demo</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      canvas {
        border: 1px solid #d3d3d3;
        background-color: #f1f1f1;
      }
    </style>

  </head>
  <body>
    <script src="index.js"></script>
  </body>
</html> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨ **SpeechCommand** æ¨¡å—ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹æˆ‘ä»¬çš„ JavaScript ä»£ç æ¥æ”¯æŒå®ƒã€‚åˆ›å»ºä¸€ä¸ªåä¸º`main.js`çš„æ–‡ä»¶ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç ç²˜è´´åˆ°å…¶ä¸­ã€‚

```
var myGamePiece;
var myObstacles = [];
var myScore;

export const startGame = function() {
    myGamePiece = new component(30, 30, "red", 10, 120);
    myScore = new component("30px", "Consolas", "black", 280, 40, "text");
    myGameArea.start();
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = 480;
        this.canvas.height = 270;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.frameNo = 0;
        this.interval = setInterval(updateGameArea, 40);
        },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    },
    stop : function() {
        clearInterval(this.interval);
    }
}

function component(width, height, color, x, y, type) {
    this.type = type;
    this.width = width;
    this.height = height;
    this.speedX = 0;
    this.speedY = 0;    
    this.x = x;
    this.y = y;    
    this.update = function() {
        let ctx = myGameArea.context;
        if (this.type == "text") {
            ctx.font = this.width + "  " + this.height;
            ctx.fillStyle = color;
            ctx.fillText(this.text, this.x, this.y);
        } else {
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
    }
    this.newPos = function() {
        this.x += this.speedX;
        this.y += this.speedY;        
    }
    this.crashWith = function(otherobj) {
        let myleft = this.x;
        let myright = this.x + (this.width);
        let mytop = this.y;
        let mybottom = this.y + (this.height);
        let otherleft = otherobj.x;
        let otherright = otherobj.x + (otherobj.width);
        let othertop = otherobj.y;
        let otherbottom = otherobj.y + (otherobj.height);
        let crash = true;
        if ((mybottom < othertop) || (mytop > otherbottom) || (myright < otherleft) || (myleft > otherright)) {
            crash = false;
        }
        return crash;
    }
}

function updateGameArea() {
    let x, height, gap, minHeight, maxHeight, minGap, maxGap;
    for (let i = 0; i < myObstacles.length; i += 1) {
        if (myGamePiece.crashWith(myObstacles[i])) {
            myGameArea.stop();
            return;
        } 
    }
    myGameArea.clear();
    myGameArea.frameNo += 1;
    if (myGameArea.frameNo == 1 || everyinterval(180)) {
        x = myGameArea.canvas.width;
        minHeight = 20;
        maxHeight = 200;
        height = Math.floor(Math.random()*(maxHeight-minHeight+1)+minHeight);
        minGap = 50;
        maxGap = 200;
        gap = Math.floor(Math.random()*(maxGap-minGap+1)+minGap);
        myObstacles.push(new component(10, height, "green", x, 0));
        myObstacles.push(new component(10, x - height - gap, "green", x, height + gap));
    }
    for (let j = 0; j < myObstacles.length; j += 1) {
        myObstacles[j].speedX = -1;
        myObstacles[j].newPos();
        myObstacles[j].update();
    }
    myScore.text="SCORE: " + myGameArea.frameNo;
    myScore.update();
    myGamePiece.newPos();    
    myGamePiece.update();
}

export const everyinterval = function(n) {
    if ((myGameArea.frameNo / n) % 1 == 0) {return true;}
    return false;
}

export const moveup = function() {
    myGamePiece.speedY = -1; 
}

export const movedown = function() {
    myGamePiece.speedY = 1; 
}

export const moveleft = function() {
    myGamePiece.speedX = -1; 
}

export const moveright = function() {
    myGamePiece.speedX = 1; 
}

export const clearmove = function() {
    myGamePiece.speedX = 0; 
    myGamePiece.speedY = 0; 
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘åœ¨è¿™é‡Œæ‰€åšçš„åªæ˜¯æ”¹å˜ä¸€äº›å‡½æ•°ï¼Œä½¿ä¹‹ä¿æŒä¸å˜ï¼Œç„¶åå¯¼å‡ºä»¥åéœ€è¦çš„å‡½æ•°ã€‚ç°åœ¨è®©æˆ‘ä»¬ç¼–å†™æˆ‘ä»¬çš„`index.js`å¹¶å¯¼å…¥è¯­éŸ³å‘½ä»¤æ¨¡å‹ã€‚

```
import * as speechCommands from "@tensorflow-models/speech-commands"; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œå¯¼å…¥æˆ‘ä»¬ç©æ¸¸æˆéœ€è¦çš„å‡½æ•°:

```
import { startGame, moveup, movedown, clearmove } from './main'; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä¸ä¼šç”¨å·¦å’Œå†™ï¼Œä½†æ˜¯ä½ ä¹Ÿå®Œå…¨å¯ä»¥ç”¨å®ƒä»¬ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ¨¡å‹å®ä¾‹å¹¶åˆå§‹åŒ–å®ƒã€‚ç”±äºåŠ è½½æ¨¡å‹éœ€è¦å¼‚æ­¥è°ƒç”¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨[life(ç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼)](https://en.wikipedia.org/wiki/Immediately-invoked_function_expression) :

```
const recognizer = speechCommands.create("BROWSER_FFT");

(async function() {
  await recognizer.ensureModelLoaded();

  console.log(recognizer.wordLabels());

  startGame();
})(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦æ¨¡å‹åŠ è½½å®Œæ¯•ï¼Œæˆ‘ä»¬å°±å¼€å§‹æ¸¸æˆã€‚æœ€åï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨å®ä¾‹ä¸Šçš„`listen`æ–¹æ³•æ¥ç›‘å¬å‘½ä»¤:

```
const suppressionTimeMillis = 1000;
const allowedCommands = ['up', 'down'];

recognizer
  .listen(
    result => {
      checkPredictions(recognizer.wordLabels(), result.scores,
      2, suppressionTimeMillis);
    },
    {
      includeSpectrogram: true,
      suppressionTimeMillis,
      probabilityThreshold: 0.8
    }
  )
  .then(() => {
    console.log("Streaming recognition started.");
  })
  .catch(err => {
    console.log("ERROR: Failed to start streaming display: " + err.message);
  });

const checkPredictions = (
  candidateWords,
  probabilities,
  topK,
  timeToLiveMillis
) => {
  if (topK != null) {
    let wordsAndProbs = [];
    for (let i = 0; i < candidateWords.length; ++i) {
      wordsAndProbs.push([candidateWords[i], probabilities[i]]);
    }
    wordsAndProbs.sort((a, b) => b[1] - a[1]);
    wordsAndProbs = wordsAndProbs.slice(0, topK);
    candidateWords = wordsAndProbs.map(item => item[0]);
    probabilities = wordsAndProbs.map(item => item[1]);
    console.log(wordsAndProbs);
    // Highlight the top word.
    const topWord = wordsAndProbs[0][0];
    if(allowedCommands.includes(topWord)) {
      if(topWord === 'up') {
        moveup();
        setTimeout(() => clearmove(), 850);
        console.log('up');
      } else {
        movedown();
        setTimeout(() => clearmove(), 850);
        console.log('down');
      }
    }

  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†å¼€å§‹æˆ‘ä»¬çš„æ¸¸æˆï¼Œå¹¶å¬å–ä½ çš„éº¦å…‹é£ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰è·å¾—ä½¿ç”¨éº¦å…‹é£çš„æƒé™ï¼Œæ‚¨éœ€è¦å‘æ‚¨çš„æµè§ˆå™¨æˆäºˆæƒé™ã€‚

Listen æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«ç»“æœå¯¹è±¡çš„æ‰¿è¯ºã€‚å½“æˆ‘ä»¬å¾—åˆ°ç»“æœæ—¶ï¼Œæˆ‘ä»¬å°†è°ƒç”¨æˆ‘ä»¬çš„å°åŠ©æ‰‹å‡½æ•°æ¥æ£€æŸ¥å“ªäº›å•è¯è¢«è¯†åˆ«ä¸º fireï¼Œå¹¶åŸºäºæ­¤æ‰§è¡Œæ“ä½œã€‚

[ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ç°åœºæ¼”ç¤º](https://jsgame-speechcommand.netlify.com/)ã€‚

## æ”¹è¿›

å¦‚æœä½ å·²ç»çœ‹è¿‡å…³äº[è¯­éŸ³å‘½ä»¤æŠ¥å‘Š](https://github.com/tensorflow/tfjs-models/tree/master/speech-commands)çš„æ–‡æ¡£ï¼Œä½ å¯ä»¥çœ‹åˆ°å½“è°ƒç”¨`speechCommands.create()`æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šåŠ è½½çš„æ¨¡å‹èƒ½å¤Ÿè¯†åˆ«çš„è¯æ±‡ã€‚è¿™è¢«æŒ‡å®šä¸º`speechCommands.create()`çš„ç¬¬äºŒä¸ªå¯é€‰å‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥é™åˆ¶è¯è¯­çš„æ–¹å‘æ€§:

```
const recognizer = speechCommands.create('BROWSER_FFT', 'directional4w'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨å¦‚æœä½ å°è¯•è¿™ä¸ªæ¨¡å‹ï¼Œå®ƒä¼šæ›´å‡†ç¡®ï¼Œå› ä¸ºå®ƒåªå…³æ³¨æ–¹å‘è¯(`up`ã€`down`ã€`left`å’Œ`right`)ã€‚

## æ€»ç»“

å°±æ˜¯è¿™æ ·ã€‚è¿™å°±æ˜¯ä½ æ‰€éœ€è¦åšçš„ï¼Œç”¨ä½ çš„å£°éŸ³å’Œ`Tensorflow.js` **è¯­éŸ³å‘½ä»¤**æ¨¡å¼æ¥æ§åˆ¶è¿™ä¸ªè¿·ä½ æ¸¸æˆã€‚

ç°åœ¨å»ç”¨é‚£äº›é¢„å…ˆè®­ç»ƒå¥½çš„æ¨¡å‹åˆ›å»ºä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ï¼Œå¹¶ç¡®ä¿æ£€æŸ¥å®ƒä»¬çš„èŒƒä¾‹åº“ã€‚

æ›´å¤šä»¤äººæŒ¯å¥‹çš„æ¼”ç¤ºï¼Œè¯·çœ‹ç”±[é˜¿è¥¿å§†Â·ä¾¯èµ›å› ](https://twitter.com/jawache)ã€[åŸƒè‰è¯ºÂ·å“ˆæ™®æ´›å¤«](https://twitter.com/EleanorHaproff)å’Œ[å¥¥è¨é©¬Â·è©¹è¾¾åˆ©](https://twitter.com/osama_jandali)å»ºé€ çš„ aijs.rocks ã€‚