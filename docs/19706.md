# ä½¿ç”¨ CFFI æ„å»º C libgeohash çš„ Python åŒ…è£…å™¨

> åŸæ–‡ï¼š<https://dev.to/aldnav/building-a-python-wrapper-of-c-libgeohash-using-cffi-4727>

DEV çš„ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚åˆ°ğŸŠï¸

æˆ‘ä»¥å‰ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ Geohash ,è¢«å®ƒçš„æ¦‚å¿µè¿·ä½äº†ã€‚æˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªç”¨ c å†™çš„å®ç°ã€‚æˆ‘ä¸€ç›´æƒ³è¯•éªŒå¤–å›½å‡½æ•°ï¼Œå‘ç° [CFFI](https://cffi.readthedocs.io) é€‚åˆæˆ‘çš„æƒ…å†µã€‚åŒä¸€å¤©ä¸‹åˆï¼Œæˆ‘ç”¨ Python ç¼–å†™äº†ä¸€ä¸ªç®€å•çš„ libgeohash åŒ…è£…å™¨ã€‚

çœ‹çœ‹è¿™ä¸ªã€‚[https://aldnav . com/blog/writing-a-geo hash-wrapper-using-cffi/](https://aldnav.com/blog/writing-a-geohash-wrapper-using-cffi/)
é‚£æ˜¯ä»€ä¹ˆï¼Ÿæƒ³ç›´æ¥è·³åˆ°æºä»£ç ä¸­å—ï¼Ÿå¥½å§ï¼[https://github.com/aldnav/geohash](https://github.com/aldnav/geohash)

è¿™é‡Œæœ‰ä¸€ä¸ªé¢„è§ˆã€‚

```
# geohash_build.py from cffi import FFI
ffi = FFI()
ffi.cdef(
    """
    char* geohash_encode(double lat, double lng, int precision);
    GeoCoord geohash_decode(char* hash);
"""
)
lib = ffi.dlopen("geohash.so")
ffi.set_source("_geohash", None) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
# Simple testing from _geohash import ffi, lib
print(lib.geohash_encode(35.689487, 139.691706, 6))
#>> xn774c 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
# Use geohash module import geohash
geohash.geohash_encode(48.856614, 2.352222)  # u09tvw for Paris! geohash.geohash_decode("wy7b1h")  # lat: 35.179554, long: 129.075642 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æŸ¥çœ‹æˆ‘çš„ç¬”è®°ï¼Œçœ‹çœ‹æˆ‘æ˜¯å¦‚ä½•æ„å»ºåŒ…è£…å™¨çš„ã€‚åŠ ä¸Šæ›´å¤šçš„å‚è€ƒèµ„æ–™ï¼Œé“¾æ¥åˆ°å„è‡ªä½œè€…çš„æ›´å…¨é¢çš„ç¬”è®°ã€‚

è®©æˆ‘çŸ¥é“ä½ çš„æƒ³æ³•ï¼