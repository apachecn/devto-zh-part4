# é€šè¿‡åˆ¶ä½œè‡ªå·±çš„ç†è§£:JavaScript è°ƒç”¨ã€åº”ç”¨å’Œç»‘å®š

> åŸæ–‡:[https://dev . to/kamaal/understanding-by-making-your-own-JavaScript-call-apply-bind-5238](https://dev.to/kamaal/understanding-by-making-your-own-javascript-call-apply-bind-5238)

ä¸é‡æ–°å‘æ˜è½®å­æœ€ç»ˆæ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†è¿™ä¹Ÿæ˜¯é€šè¿‡(é‡æ–°)åˆ›é€ å·²ç»å­˜åœ¨çš„ä¸œè¥¿æ¥æé«˜è‡ªå·±çš„ä¸€ç§æ–¹å¼ã€‚æˆ‘å†™è¿™ä¸ªç³»åˆ—ä¸»è¦æ˜¯ä¸ºäº†æé«˜æˆ‘å¯¹ JavaScript çš„æ ‡å‡†å†…ç½®å¯¹è±¡å¦‚`call`ã€`apply`ã€`bind`çš„ç†è§£ã€‚

## [](#functionprototypecall)Function.prototype.call()

> call()æ–¹æ³•ä½¿ç”¨ç»™å®šçš„ this å€¼å’Œå•ç‹¬æä¾›çš„å‚æ•°è°ƒç”¨å‡½æ•°ã€‚- MDN

[Mozilla](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call)

æœ€åˆï¼Œæ–¹æ³•`call`è°ƒç”¨å‡½æ•°å¹¶å…è®¸æ‚¨ä¼ é€’é€—å·åˆ†éš”çš„å‚æ•°ã€‚

#### [](#example-from-mdn)æ¥è‡ª MDN çš„ä¾‹å­

```
 function Product(name, price) {
  this.name = name;
  this.price = price;
}

function Food(name, price) {
  Product.call(this, name, price);
  this.category = 'food';
}

function Toy(name, price) {
  Product.call(this, name, price);
  this.category = 'toy';
}

const food = new Food('cheese', 5)
console.log(food.name) //  cheese
console.log(food) //  {name: 'chees', price: 5, category: 'food'}

const fun = new Toy('robot', 40);
console.log(fun.name) //  robot 
```

#### [](#custom-example)è‡ªå®šä¹‰ç¤ºä¾‹

```
 const add = (a, b) => a + b
console.log(add.call(null, 3, 8, 10)) // 11 
```

é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£ call æ–¹æ³•çš„åŸºæœ¬åŠŸèƒ½ã€‚

*   Call æ”¹å˜äº†è°ƒç”¨è€…çš„`this`ä¸Šä¸‹æ–‡ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­`Product.call`ç”¨`call`çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³`Food`æ›¿æ¢äº†åŸæ¥å‡½æ•°ä½“ä¸­çš„`this`ã€‚>ä½¿ç”¨è°ƒç”¨æ¥é“¾æ¥ä¸€ä¸ªå¯¹è±¡çš„æ„é€ å‡½æ•°- MDN

[![call context](img/214e30e9839ad822c1519405296e5cf9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ZahQrZGN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/smxdcojxpxn7z7x666zx.png)

*   å¦‚æœè°ƒç”¨æ—¶æœ‰å¤šä¸ªå‚æ•°ï¼Œé‚£ä¹ˆä»å·¦åˆ°å³ï¼Œä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹ï¼Œå°†æ¯ä¸ªå‚æ•°ä¼ é€’ç»™åŸå§‹å‡½æ•°ã€‚

    *   åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯`name`å’Œ`price`ã€‚
*   `call`ä¸åº”è¯¥å¯¹`this`å¯¹è±¡äº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ã€‚

> thisArg å€¼åœ¨æ²¡æœ‰ä¿®æ”¹çš„æƒ…å†µä¸‹ä½œä¸º`this`å€¼ä¼ é€’ã€‚è¿™ä¸ç¬¬ 3 ç‰ˆæœ‰æ‰€ä¸åŒï¼Œåœ¨ç¬¬ 3 ç‰ˆä¸­ï¼Œæœªå®šä¹‰æˆ–ç©ºçš„ thisArg è¢«æ›¿æ¢ä¸ºå…¨å±€å¯¹è±¡ï¼ŒToObject åº”ç”¨äºæ‰€æœ‰å…¶ä»–å€¼ï¼Œç»“æœä½œä¸º`this`å€¼ä¼ é€’ã€‚å³ä½¿ä¸åŠ ä¿®æ”¹åœ°ä¼ é€’ thisArgï¼Œéä¸¥æ ¼å‡½æ•°åœ¨è¿›å…¥å‡½æ•°æ—¶ä»ç„¶æ‰§è¡Œè¿™äº›è½¬æ¢ã€‚- Ecma

[Ecma è§„èŒƒ](https://www.ecma-international.org/ecma-262/6.0/#sec-function.prototype.call)

## [](#lets-reimplement-the-call-method)è®©æˆ‘ä»¬é‡æ–°å®ç°è°ƒç”¨æ–¹æ³•ã€‚

```
 if(!Function.prototype.fauxCall){
    Function.prototype.fauxCall = function(context){
       context.fn = this;
       return context.fn();
    }
}

const food = new Food('cheese', 5)
console.log(food) //  expected {name: 'chees', price: 5, category: 'food'} 
```

å¦‚æœæˆ‘ä»¬è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°†å¾—åˆ°

[![Call result](img/855c8bc07b3def77b568c0af6b2b05fd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ucQ3crSV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/83nqogy3i8gqo8y5hqra.png)

è€Œä¸æ˜¯

```
 {name: 'chees', price: 5, category: 'food'} 
```

å¥½çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è°ƒç”¨`fn()`æ—¶ä¼ é€’åŸå§‹å‚æ•°ã€‚çœ‹èµ·æ¥å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯ğŸ¤”æˆ‘ä»¬å¦‚ä½•çŸ¥é“æœ‰å¤šå°‘å‚æ•°æ¥è‡ªåŸå§‹è°ƒç”¨ï¼Ÿ

è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`arguments`å®ƒæ˜¯åœ¨å‡½æ•°å†…éƒ¨å¯è®¿é—®çš„ç±»ä¼¼**æ•°ç»„çš„**å¯¹è±¡ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰ä¸€ä¸ªé—®é¢˜ï¼›è®°ä½`arguments`ä¸æ˜¯`array`è€Œæ˜¯`object`ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ**åƒæ•°ç»„ä¸€æ ·**

æˆ‘ä»¬å¯ä»¥ç”¨`Array.from` [ã€æ›´å¤šæ–¹å¼ã€‘](https://dzone.com/articles/js-array-from-an-array-like-object)æŠŠè¿™ä¸ª`object`è½¬æ¢æˆ`array`ï¼Œç„¶åä»ç¬¬äºŒä¸ªå…ƒç´ ç”¨`Array.slice`å¿½ç•¥ç¬¬ä¸€ä¸ªå‚æ•°ã€‚

```
if(!Function.prototype.fauxCall){
    Function.prototype.fauxCall = function(context){
       const args = Array.from(arguments).slice(1);
       context.fn = this;
       return context.fn(...args);
    }
}

const food = new Food('cheese', 5)
console.log(food) //  expected {name: 'chees', price: 5, category: 'food'} 
```

å¦‚æœæˆ‘ä»¬è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°†å¾—åˆ°

[![Call result](img/d17d96f5fff4a08506205e32e1b80994.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--8A_kyezN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/jgifge75si7va0tuzikb.png)

Ok çœ‹èµ·æ¥ä¸é”™ï¼Œä½†è¿˜æ˜¯å¯ä»¥çœ‹åˆ°å‰¯ä½œç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`delete`æ“ä½œç¬¦æ¥æ¶ˆé™¤å‰¯ä½œç”¨ï¼Œä½†æ˜¯ï¼Œå³ä½¿æˆ‘ä»¬å¯ä»¥åˆ é™¤æˆ‘ä»¬åˆ›å»ºçš„è¿™ä¸ªå‰¯ä½œç”¨`fn`å±æ€§ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼›å¦‚æœ`context`å·²ç»æœ‰ä¸€ä¸ªåŒåçš„æˆ¿äº§`fn`ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥å½¢æˆéšæœºå¯†é’¥ï¼Œç„¶åå°†å…¶åˆ†é…ç»™ä¸Šä¸‹æ–‡ï¼Œç„¶åæˆ‘ä»¬å¿…é¡»åˆ é™¤å®ƒã€‚

```
if(!Function.prototype.fauxCall){
    Function.prototype.fauxCall = function(context){
       const fnName =
    [...Array(10)].map(_ => ((Math.random() * 36) | 0).toString(36)).join`` ||
    {};
       const args = Array.from(arguments).slice(1);
       context[fnName]= this;
       const result = obj[fnName](...args); 
       delete obj[fnName];
       return result;
    }
}

const food = new Food('cheese', 5)
console.log(food) //  expected {name: 'chees', price: 5, category: 'food'} 
```

å¦‚æœæˆ‘ä»¬è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°†å¾—åˆ°

[![Call success](img/fe2fc0edae37ae61aed33b86d7825866.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Bwsk8yOH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/62atb9zhv15llj4ayq0i.png)

å‡ ä¹æˆåŠŸäº†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç”¨ null è€Œä¸æ˜¯ object æ¥è°ƒç”¨ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚

è¿˜è®°å¾—æˆ‘ä»¬çš„`add`å‡½æ•°å—ï¼Ÿå¦‚æœæˆ‘ä»¬æƒ³åœ¨æ²¡æœ‰`this`å‚æ•°çš„æƒ…å†µä¸‹`fauxCall`æ·»åŠ å‡½æ•°ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°é”™è¯¯

```
const add = (a, b) => a + b;
console.log(add.fauxCall(null, 5, 6, 7)); // 11 :: 7 will ignore by add method 
```

[![Call error](img/802bdcba25f3ece62479b9dbd2f0d701.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--VREfsSBW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/0ptf5sbhiwija9hwjff3.png)

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¯•å›¾ç»™ä¸€ä¸ª`null`å¯¹è±¡è®¾ç½®ä¸€ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ guard å‡½æ•°æ¥ä¿®å¤å®ƒã€‚

æ­¤å¤–ï¼Œå†æ·»åŠ ä¸¤ä¸ªæ–¹æ³•æ¥æ£€æŸ¥ç°æœ‰çš„å±æ€§ï¼Œå¹¶åˆ†é…æ–°çš„å±æ€§ï¼Œè€Œä¸æ˜¯é™æ€çš„`fnName`å˜é‡ã€‚

1.  `getRandomKey`:è¯¥å‡½æ•°æ¯æ¬¡ç”Ÿæˆå¹¶è¿”å›ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ã€‚
2.  `checkRandomKey`:è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼›key å’Œ context (object ),å¹¶æ£€æŸ¥è¯¥å¯¹è±¡æ˜¯å¦å·²ç»å…·æœ‰ä¸ property ç›¸åŒçš„é”®ï¼Œç„¶åç”¨æ–°çš„é”®é€’å½’å®ƒï¼Œç›´åˆ°ä¸ºå±æ€§åæ‰¾åˆ°å”¯ä¸€çš„æ–°å±æ€§ã€‚

#### [](#complete-implementation)å®Œæˆå®æ–½

```
const isOBject = obj => {
    const type = typeof obj;
    return type === "function" || (type === "object" && !!obj);
};

const getRandomKey = () => {
    return (
    [...Array(10)].map(_ => ((Math.random() * 36) | 0).toString(36)).join`` ||
    {}
  );
};

const checkRandomKey = (key, obj) => (obj[key] === undefined) ? key : checkRandomKey(getRandomKey(), obj);

if(!Function.prototype.fauxCall){
    Function.prototype.fauxCall = function(_context) {
       const context = isOBject(_context) ? _context : {};
       const fnName = checkRandomKey(getRandomKey(), context);
       const args = Array.from(arguments).slice(1);
       context[fnName] = this;
       const result = context[fnName](...args);
       delete context[fnName];
       return result;
    };
}

function Product(name, price) {
  this.name = name;
  this.price = price;
}

function Food(name, price) {
  Product.fauxCall(this, name, price);
  this.category = "food";
}
const add = (a, b) => a + b;

console.log(new Food("cheese", 5)); // {name: 'chees', price: 5, category: 'food'}
console.log(add.fauxCall(null, 5, 6, 7)); // 11 :: 7 will ignore by add method 
```

* * *

## function . prototype . apply()

> apply()æ–¹æ³•ä½¿ç”¨ç»™å®šçš„ this å€¼å’Œä»¥æ•°ç»„(æˆ–ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡)å½¢å¼æä¾›çš„å‚æ•°è°ƒç”¨å‡½æ•°ã€‚- MDN

[Mozilla](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call)

æœ€åˆï¼Œæ–¹æ³•`apply`è°ƒç”¨å‡½æ•°å¹¶å…è®¸æ‚¨ä¼ é€’æ•°ç»„æˆ–ç±»ä¼¼æ•°ç»„çš„å‚æ•°ã€‚å¬èµ·æ¥ç†Ÿæ‚‰å—ï¼Ÿæ˜¯çš„ï¼Œå› ä¸º`call`å’Œ`apply`å‡ ä¹åšç€åŒæ ·çš„äº‹æƒ…ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ call æ¥å—é€—å·åˆ†éš”çš„å‚æ•°ï¼Œè€Œ apply æ¥å—æ•°ç»„æˆ–ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸º`call`åšçš„ä¸€åˆ‡å¯¹`apply`æœ‰æ•ˆï¼Œé™¤äº†`args`éƒ¨åˆ†ï¼Œç°åœ¨æˆ‘ä»¬ç¡®åˆ‡åœ°çŸ¥é“å“ªä¸ªå‚æ•°åº”è¯¥ä¸å‡½æ•°è°ƒç”¨ä¸€èµ·ä½¿ç”¨ã€‚

```
//... all call helper codes
if(!Function.prototype.fauxApply){
    Function.prototype.fauxApply = function(_context, _args) {
        const context = isOBject(_context) ? _context : {};
        const fnName = checkRandomKey(getRandomKey(), context);
        const args = _args.length ? _args : []
        context[fnName] = this;
        const result = context[fnName](...args);
        delete context[fnName];
        return result;
    };
}
const numbers = [5, 6, 7];

console.log(new Food("cheese", 5)); // {name: 'chees', price: 5, category: 'food'}
console.log(add.fauxApply(null, 5, 6, 7)); // 11 :: 7 will ignore by add method 
```

* * *

## [](#functionprototypebind)Function.prototype.bind()

> bind()æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå…¶ this å…³é”®å­—è®¾ç½®ä¸ºæä¾›çš„å€¼ï¼Œè°ƒç”¨æ–°å‡½æ•°æ—¶ï¼Œåœ¨ä»»ä½•æä¾›çš„å‚æ•°ä¹‹å‰æœ‰ä¸€ä¸ªç»™å®šçš„å‚æ•°åºåˆ—ã€‚

call å’Œ bind ä¹‹é—´å”¯ä¸€çš„åŒºåˆ«æ˜¯ call è°ƒç”¨å‡½æ•°å¹¶è¿”å›å€¼ï¼Œè€Œ bind è¿”å›ä¸€ä¸ªå¸¦æœ‰æ›´æ–°ä¸Šä¸‹æ–‡çš„æ–°å‡½æ•°ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œç”¨å‚æ•°å’Œä¸Šä¸‹æ–‡è°ƒç”¨`call`ã€‚

```
//... all call helper codes
Function.prototype.fauxBind = function(_contetxt){
  const args = Array.from(arguments).slice(1);
  const self = this;
  return function(){
      //return self.fauxApply(_contetxt, args)
      return self.fauxCall(_contetxt, ...args) // either call or apply
  }
}
console.log(add.fauxBind(null, 4,7)()); 
```

CodeSandbox

[![Edit js-call-apply-bind](img/0b3f0135583496627e3621355d8e9248.png)T2ã€‘](https://codesandbox.io/s/js-call-apply-bind-yh997?fontsize=14)

[https://codesandbox.io/embed/yh997](https://codesandbox.io/embed/yh997)

â™¥

è¿™é‡Œçš„å®ç°æ˜¯è®¸å¤šæ–¹å¼ä¸­çš„ä¸€ç§ã€‚è¿™ä¸ªæ¨¡æ‹Ÿçš„ç›®çš„åªæ˜¯ä¸ºäº†äº†è§£`call`åœ¨å¼•æ“ç›–ä¸‹æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å¦‚æœä½ å‘ç°ä»»ä½•é—®é¢˜æˆ–é”™åˆ«å­—ï¼Œè¯·è®©æˆ‘çŸ¥é“ã€‚