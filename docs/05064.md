# ç”¨æ­£ç¡®çš„æ–¹å¼æ„å»º React-native appã€‚

> åŸæ–‡ï¼š<https://dev.to/unbug/build-react-native-app-in-the-right-way-4k8c>

# ååº”åŸç”Ÿè®­ç»ƒ

[![](img/ed29700ee73921fc26766484c59a52a5.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--LZI15pjC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-3.png)

GitHub:[https://GitHub . com/unbug/react-native-train/blob/master/readme . MD](https://github.com/unbug/react-native-train/blob/master/README.md)

è§†é¢‘åœ¨è¿™é‡Œ- [Udemy](https://www.udemy.com/react-native-train/?couponCode=LUCKY-0)

[![](img/bcb7950c4962342a7cdd398a512d3910.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--gMGmqlLP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160727-3.png)

è¯·[ç•™è¨€](https://www.gitbook.com/book/unbug/react-native-training/discussions)æˆ–æ¨ç‰¹ [@unbug](https://twitter.com/unbug) è¿›ä¸€æ­¥è¯¢é—®ã€‚ä»»ä½•å¸®åŠ©å°†ä¸èƒœæ„Ÿæ¿€:)

# ç›®å½•

*   [1 å…ˆçœ‹çœ‹](#1-first-look)
    *   [1.1 åœ¨ 5 åˆ†é’Ÿå†…æ„å»ºä¸€ä¸ªåº”ç”¨](#11-building-an-app-in-5-minutes)
    *   [1.2 å·¥ä½œåŸç†](#12-how-it-works)
    *   [1.3 è°ƒè¯•å·¥å…·](#13-debug-tools)
    *   [1.4 æ–‡æ¡£&API](#14-docs--apis)
    *   [1.5 èµ„æº](#15-resources)
*   [2 ä¸ªç»„ä»¶](#2-components)
    *   [2.1 æ¸²æŸ“& JSX](#21-render--jsx)
    *   [2.2 è§†å›¾ã€æ–‡æœ¬ã€å›¾åƒç­‰](#22-view-text-image-etc)
    *   2.3 ç”Ÿå‘½å‘¨æœŸ
    *   [2.4 é“å…·&çŠ¶æ€](#24-props--states)
    *   [2.5 äº‹ä»¶](#25-events)
    *   [2.6 èµ„æº](#26-resources)
*   [3 ç§é£æ ¼](#3-styles)
    *   [3.1 æŸ”æ€§ç›’](#31-flexbox)
    *   [3.2 ç»å¯¹&ç›¸å¯¹](#32-absolute--relative)
    *   [3.3 å°ºå¯¸&å°ºå¯¸&ç‰ˆé¢](#33-size--dimensions--onlayout)
    *   [3.4 ç»§æ‰¿](#34-inheritance)
    *   [3.5 èµ„æº](#35-resources)
*   [4 æ¶æ„](#4-architecture)
    *   [4.1 Redux](#41-redux)
    *   4.2 ååº”è¿˜åŸ
    *   [4.3 å®¹å™¨&ç»„ä»¶](#43-containers--components)
    *   [4.4 Todo React åŸç”Ÿ App](#44-todo-react-native-app)
    *   [4.5 å‘½åçº¦å®š](#45-naming-convention)
    *   [4.6 èµ„æº](#46-resources)
*   [5 ä¸ªæ•°æ®](#5-data)
    *   [5.1 è·å–](#51-fetch)
    *   [5.2 æŒä¹…](#52-persistent)
    *   [5.3 èµ„æº](#53-resources)
*   [6 è·¯ç”±å™¨](#6-router)
    *   [6.1 å¯¼èˆªå™¨](#61-navigator)
    *   [6.2 èµ„æº](#62-resources)
*   [7 ä¸ªåŸç”Ÿæ¨¡å—(è‰æ¡ˆ)](#7-native-modules)
    *   7.1 iOS
    *   7.1.1 JS å‘¼å« OC
    *   7.1.2 OC å‘¼å« JS
    *   æœ¬åœ°è§†å›¾ç»„ä»¶
    *   7.2 å®‰å“ç³»ç»Ÿ
    *   7.2.1 JS è°ƒç”¨ Java
    *   7.2.2 Java è°ƒç”¨ JS
    *   æœ¬åœ°è§†å›¾ç»„ä»¶
    *   7.3 èµ„æº
*   [8 æ•´åˆ(è‰æ¡ˆ)](#8-integration)
    *   [8.1 iOS](#81-ios)
    *   [8.1.1 åŒ…è£…](#811-package)
    *   å›¾åƒ
    *   [8.2 å®‰å“](#82-android)
    *   [8.2.1 åŒ…è£…](#821-package)
    *   å›¾åƒ
    *   [8.3 å‘å¸ƒå‰](#83-before-publishing)
    *   [8.4 èµ„æº](#83-resources)
*   [9 çƒ­æ›´æ–°(è‰ç¨¿)](#9-hot-update-draf)
    *   9.1 iOS
    *   9.2 å®‰å“ç³»ç»Ÿ
    *   9.3 èµ„æº
*   [10 æ€§èƒ½(è‰æ¡ˆ)](#10-performance)
    *   [10.1 shouldComponentUpdate](#101-shouldcomponentupdate)
    *   [10.2 èµ„æº](#102-resources)
*   [èµ„æº](#resources)

* * *

# 1 ç¬¬ä¸€çœ¼

[ä»‹ç» React Native](https://facebook.github.io/react/blog/2015/03/26/introducing-react-native.html)

> æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯åŸç”Ÿç§»åŠ¨å¹³å°çš„ç”¨æˆ·ä½“éªŒï¼Œç»“åˆæˆ‘ä»¬åœ¨ web ä¸Šä½¿ç”¨ React æ„å»ºæ—¶çš„å¼€å‘äººå‘˜ä½“éªŒã€‚åªè¦ç¨åŠ åŠªåŠ›ï¼Œæˆ‘ä»¬å°±èƒ½è®© GitHub ä¸Šçš„ React æˆä¸ºçœŸæ­£çš„æœ¬åœ°ç§»åŠ¨åº”ç”¨ã€‚ç§»åŠ¨ç¯å¢ƒä¸­çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œæˆ‘ä»¬ä¸æ˜¯åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ React å¹¶æ¸²æŸ“åˆ° div å’Œ spansï¼Œè€Œæ˜¯åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­è¿è¡Œ JavaScriptCore çš„åµŒå…¥å¼å®ä¾‹ï¼Œå¹¶æ¸²æŸ“åˆ°æ›´é«˜çº§åˆ«çš„ç‰¹å®šäºå¹³å°çš„ç»„ä»¶ã€‚
> 
> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯åœ¨è¿½é€**â€œå†™ä¸€æ¬¡ï¼Œè¿è¡Œåˆ°ä»»ä½•åœ°æ–¹ã€‚â€**ä¸åŒçš„å¹³å°æœ‰ä¸åŒçš„å¤–è§‚ã€æ„Ÿè§‰å’ŒåŠŸèƒ½ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä»ç„¶åº”è¯¥ä¸ºæ¯ä¸ªå¹³å°å¼€å‘ç‹¬ç«‹çš„åº”ç”¨ç¨‹åºï¼Œä½†åŒä¸€æ‰¹å·¥ç¨‹å¸ˆåº”è¯¥èƒ½å¤Ÿä¸ºä»–ä»¬é€‰æ‹©çš„ä»»ä½•å¹³å°æ„å»ºåº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€ä¸ºæ¯ä¸ªå¹³å°å­¦ä¹ ä¸€å¥—å®Œå…¨ä¸åŒçš„æŠ€æœ¯ã€‚æˆ‘ä»¬ç§°è¿™ç§æ–¹æ³•ä¸º**â€œä¸€æ¬¡å­¦ä¹ ï¼Œéšå¤„ä¹¦å†™ã€‚â€**

[å±•ç¤ºåŒº](https://facebook.github.io/react-native/showcase.html)

[![](img/f67979088a5e21c57d2d8c04578cb487.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--lKJpkPK9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160630-4.png)

# 1.1 5 åˆ†é’Ÿæ­å»ºä¸€ä¸ª app

1.  éœ€æ±‚éµå¾ª[å…¥é—¨](http://facebook.github.io/react-native/releases/next/docs/getting-started.html)
2.  ç”Ÿæˆæ–°çš„ React æœ¬æœºé¡¹ç›®

```
 react-native init testRn 
```

1.  æ„å»ºå’Œè¿è¡Œé¡¹ç›®

```
 react-native run-ios 
```

æˆ–è€…æ‰“å¼€`testRn/ios/testRn.xcodeproj`ï¼Œç”¨ XCode çš„æ’­æ”¾æŒ‰é’®æ„å»º

[![](img/07ffc8c5abdc3cf616018fa2942c3902.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ecVEJvO3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160622-0.png)

æˆ–è€…å¦‚æœåº”ç”¨ç¨‹åºå·²ç»æ„å»ºå¥½ï¼Œå¯åŠ¨ç½‘ç»œæœåŠ¡å™¨

```
npm start
//or
react-native start 
```

# 1.2 å·¥ä½œåŸç†

1. [JavaScript æ¡¥](https://www.infoq.com/articles/react-native-introduction)

[![](img/f6975889401fab28de3b25c689e1ea07.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--U3YaaFXr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/21.jpg)

2.[ååº”æœ¬åœ°æ‰“åŒ…ç¨‹åº](https://github.com/facebook/react-native/tree/master/packager)

[![](img/88019cbbb444944aaeb2cb4dc52e6a96.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--PoliFDZl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/Pasted%20Graphic.jpg)

# 1.3 è°ƒè¯•å·¥å…·

1.[å¼€å‘è€…èœå•](https://facebook.github.io/react-native/docs/debugging.html)

[![](img/4b10498982bb644a5f6c47674452b616.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--550pcBqm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160623-0.png)

2.Chrome å¼€å‘å·¥å…·

[![](img/470a4c4215f1e3f2dfd8ffea8146e82b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--gv-ge82X--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160623-2.png)T3ã€‘
3 . log

```
console.log('some text');
console.dir({a:1, b:2, c:3});
debugger;//breaking point 
```

4.[åŸå­](https://atom.io/)T4[æ ¸ç´ ](https://nuclide.io/)

[![](img/fd7220a2a032fa924bc13aeca8e849ad.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--RgaWnV2B--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160623-3.png)

5 .æ£€æŸ¥

ç”¨`cmd-shift-p`æ‰“å¼€ Atom [å‘½ä»¤è°ƒè‰²æ¿åŒ…](https://atom.io/packages/command-palette)ï¼Œæœç´¢â€œæ£€æŸ¥å™¨â€ï¼Œç„¶åç‚¹å‡»â€œæ ¸ç´ ååº”åŸç”Ÿæ£€æŸ¥å™¨:æ˜¾ç¤ºâ€

[![](img/7b8d0f52fba71c56c679e9af794b7aa6.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--JxQtDItT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160624-0.png)

[![](img/65de5d0cd95dc1aa6a8d58a23ac9e300.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--zWQW5FcJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160623-4.png)

6.[çœŸå®è£…ç½®](https://facebook.github.io/react-native/docs/debugging.html#chrome-developer-tools)

6.1 éƒ¨ç½²åˆ°çœŸå®è®¾å¤‡

`project_name/ios/project_name/AppDelegate.m`

```
 //jsCodeLocation = [NSURL URLWithString:@"http://localhost:8081/index.ios.bundle?platform=ios&dev=true"];

  /**
   * OPTION 2
   * Load from pre-bundled file on disk. The static bundle is automatically
   * generated by the "Bundle React Native code and images" build step when
   * running the project on an actual device or running the project on the
   * simulator in the "Release" build configuration.
   */

   jsCodeLocation = [[NSBundle mainBundle] URLForResource:@"main" withExtension:@"jsbundle"]; 
```

6.2 åœ¨çœŸå®è®¾å¤‡ä¸­è°ƒè¯•

1.`project_name/ios/project_name/AppDelegate.m`

```
 jsCodeLocation = [NSURL URLWithString:@"http://172.28.0.230:8081/index.ios.bundle?platform=ios&dev=true"]; 
```

2.`node_modules/react-native/Libraries/WebSocket/RCTWebSocketExecutor.m`

```
 if (!_url) {
    NSUserDefaults *standardDefaults = [NSUserDefaults standardUserDefaults];
    NSInteger port = [standardDefaults integerForKey:@"websocket-executor-port"] ?: 8081;
    NSString *URLString = [NSString stringWithFormat:@"http://172.28.0.230:%zd/debugger-proxy?role=client", port];
    _url = [RCTConvert NSURL:URLString];
  } 
```

3.

[![](img/27b825a90509344eff8fe4cec0f73cd2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--zpyX2Rim--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160826-0.png)

# 1.4 æ–‡æ¡£&API

*   [ååº”å †](https://facebook.github.io/react/docs/getting-started.html)
*   [ååº”åŸç”Ÿ](https://facebook.github.io/react-native/docs/getting-started.html)
*   [æ ¸ç´ ](https://nuclide.io/docs/quick-start/getting-started/)

# 1.5 èµ„æº

*   [æœ¬åœ°ååº”:å°†ç°ä»£ç½‘ç»œæŠ€æœ¯å¼•å…¥æ‰‹æœº](https://code.facebook.com/posts/1014532261909640/react-native-bringing-modern-web-techniques-to-mobile/)
*   [Detailed explanation of React Native communication mechanism](http://blog.cnbang.net/tech/2698/)
*   [ååº”è‡ªç„¶è°ƒç ”æŠ¥å‘Š](http://blog.csdn.net/lihuiqwertyuiop/article/details/45241909)
*   [Overview of React Native: Background, Planning and Risks](https://github.com/tmallfe/tmallfe.github.io/issues/18)
*   [JavaScript æ ¸å¿ƒ](http://trac.webkit.org/wiki/JavaScriptCore)
*   [ååº”åŸç”Ÿ iOS çœŸæœºè°ƒè¯•](http://www.jianshu.com/p/cc64bcb58df2)

# 2 ä¸ªç»„ä»¶

1.MyComponent.js

```
//define component
class MyComponent extends React.Component {
  render() {
    return <Text>My component!</Text>;
  }
}
//export component
export default MyComponent; 
```

2.Main.js

```
//import component
import MyComponent from './MyComponent';
class Main extends React.Component {
  render() {
    //use component
    return <MyComponent>;
  }
} 
```

3.å­¦å¾’åˆ¶

```
AppRegistry.registerComponent('MyApp', () => Main); 
```

# 2.1 æ¸²æŸ“& JSX

```
..
...
render() {
  const txt = 'Hello';
  function say(name){
    return 'I am '+name;
  }
  return (
    <View>
      <Text>This is a title!</Text>
      <Text>{txt}</Text>
      <View>
        <Text>{say('React')}</Text>
      </View>
    </View>
  );
}
..
... 
```

# 2.2 è§†å›¾ã€æ–‡æœ¬ã€å›¾åƒç­‰

1.  [æ ¸å¿ƒéƒ¨ä»¶](https://facebook.github.io/react-native/docs/tutorial-core-components.html)

```
..
...
import {
  StyleSheet,
  Text,
  View,
  Image
} from 'react-native';

class Main extends Component {
  render() {
    return (
      <View>
        <Image source={require('./img/bg.png')}>
          <Image source={require('./img/icon.png')}/>
          <Text>
            some text!
          </Text>
        </Image>
      </View>
    );
  }
} 
```

# 2.3 ç”Ÿå‘½å‘¨æœŸ

1.  å®ä¾‹åŒ–

1.1 ç¬¬ä¸€æ¬¡åˆ›å»ºå®ä¾‹æ—¶è°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

*   getDefaultProps
*   **getInitialState** çš„ç¼©å†™å½¢å¼
*   ç»„ä»¶å°†å®‰è£…
*   **æ¸²æŸ“**
*   **ç»„ä»¶å®‰è£…**

1.2 å¯¹äºè¯¥ç»„ä»¶ç±»åˆ«çš„æ‰€æœ‰åç»­ä½¿ç”¨:

*   getInitialState
*   ç»„ä»¶å°†å®‰è£…
*   æä¾›ï¼›ç»™äºˆ
*   componentDidMount "

1.  ä¸€ç”Ÿ

*   componentWillReceiveProps
*   **shouldComponentUpdate//return true | false**T2ã€‘

    ```
     shouldComponentUpdate(nextProps, nextState) {
     return nextProps.id !== this.props.id;
     } 
    ```

*   componentWillUpdate//ä¸ä¸ºåˆå§‹æ¸²æŸ“è°ƒç”¨

*   æä¾›ï¼›ç»™äºˆ

*   componentDidUpdate

1.  æ‹†å¸å’Œæ¸…ç†

*   ç»„ä»¶å°†å¸è½½

[![](img/abcf6c7467f63b0169d186cf032af957.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--O15L2tI7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160627-0.png)

# 2.4 é“å…·&çŠ¶æ€

1.props:å±æ€§è¢«ä¼ é€’ç»™ä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥ä¿å­˜ä»»ä½•æ•°æ®

```
class User extends Component {
  render(){
    const user = this.props.data;
    this.props.onReady('I am ready!');
    return(
      <View>
        <Text>
          score: {this.props.score}
          type: {this.props.type}
          Name: {user.name}
          Age: {user.age}
        </Text>
      </View>
    );
  }
}
//dufaultProps
User.propTypes = { score: React.PropTypes.number };
User.defaultProps = { score: 0 };

var user = {name: 'foo', age: 21};
class Main extends Component {
  handleReady(str){
    console.log(str);
  }
  render(){
    return(
      <View>
        <User type="Dev" data={user} onReady={this.handleReady}/>
      </View>
    );
  }
} 
```

2.state: State ä¸åŒäº propsï¼Œå› ä¸ºå®ƒåœ¨ç»„ä»¶å†…éƒ¨ã€‚

```
class Timer extends Component {
  constructor(props) {
    super(props);
    this.state = {count: 0};
  }

  componentDidMount() {
    let that = this;
    setInterval(function () {
      that.increase();
    }, 1000);
  }

  increase() {
    this.setState({count: this.state.count + 1});
  }

  render() {
    return (
      <View>
        <Text>count: {this.state.count}</Text>
      </View>
    );
  }
}

class Main extends Component {
  render(){
    return(
      <View>
        <Timer/>
      </View>
    );
  }
} 
```

3.*é“å…·* VS *çŠ¶æ€*

*   ä½¿ç”¨ props é€šè¿‡ç»„ä»¶æ ‘ä¼ é€’æ•°æ®å’Œè®¾ç½®ã€‚
*   ä¸è¦åœ¨ç»„ä»¶å†…éƒ¨ä¿®æ”¹ this.props è®¤ä¸ºé“å…·æ˜¯ä¸å¯å˜çš„ã€‚
*   ä½¿ç”¨ props æ¥ä½¿äº‹ä»¶å¤„ç†ç¨‹åºä¸å­ç»„ä»¶é€šä¿¡ã€‚
*   ä½¿ç”¨ state å­˜å‚¨ç®€å•çš„è§†å›¾çŠ¶æ€ï¼Œå¦‚ä¸‹æ‹‰é€‰é¡¹æ˜¯å¦å¯è§ã€‚
*   åˆ‡å‹¿ç›´æ¥ä¿®æ”¹ this.stateï¼Œè€Œåº”ä½¿ç”¨ this.setstateã€‚

[![](img/f70ba9cfa2f4f1e19815ebae6ae4693c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ddt76JBp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160702-0.png)

4.æ— çŠ¶æ€ç»„ä»¶

```
const Heading = ({title}) => <Text>{title}</Text>; 
..
...
<Heading title="test title"/>
...
.. 
```

# 2.5 äº‹ä»¶

1.åŸºæœ¬äº‹ä»¶

1.1.[`<TouchableHighlight/>`](https://facebook.github.io/react-native/docs/touchablehighlight.html)T3ã€‘

```
class Touch extends Component {
  handlePress(){
    console.log('press');
  }
  handleLongPress(){
    console.log('longPress');
  }
  render() {
    return (
      <TouchableHighlight
        onPress={this.handlePress}
        onLongPress={this.handleLongPress}>
        <View>
          <Text>Press me!</Text>
        </View>
      </TouchableHighlight>
    );
  }
} 
```

1.2.[`<TextInput/>`](https://facebook.github.io/react-native/docs/textinput.html)T3ã€‘

```
class Test extends Component {
  //...
  //handle events
  //...
  render() {
    return (
      <TextInput 
        onBlur={...}
        onChange={...}
        onEndEditing={...}
        onSelectionChange={...}
        onSubmitEditing={...}
      </TextInput>
    );
  }
} 
```

ä¸€ç‚¹ä¸‰ã€‚[è®¾å¤‡äº‹ä»¶å‘ç”Ÿå™¨](https://kpetrovi.ch/2015/09/30/react-native-ios-keyboard-events.html)

```
//keyboardWillShow, keyboardDidShow, keyboardWillHide, keyboardDidHide
//keyboardWillChangeFrame, keyboardDidChangeFrame
//add the listener
 var listener = DeviceEventEmitter.addListener('keyboardWillShow', (e) =>{
   console.log('Event is fired!');
 });
 //remove the listener
 listener.remove(); 
```

2.[æ‰‹åŠ¿åº”ç­”ç³»ç»Ÿ](https://facebook.github.io/react-native/docs/gesture-responder-system.html#responder-lifecycle)

2.1 ç”Ÿå‘½å‘¨æœŸ

[![](img/97bfed16953bb592f70db7fb1e556201.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--pZCrNHtp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160630-2.png) 

2.2 ç¤ºä¾‹

```
class Test extends Component {
  /* Capture handles */
  //the responder system bubbles up from the deepest component, 
  //a parent View wants to prevent the child from becoming responder on a touch start
  handleStartShouldSetResponderCapture(evt){
    return true;
  }
  //the responder system bubbles up from the deepest component, 
  //a parent View wants to prevent the child from becoming responder on a touch move
  handleMoveShouldSetResponderCapture(evt){
    return true;
  }

  /* Lifecycle handles */
  //Does this view want to become responder on the start of a touch?
  handleStartShouldSetResponder(evt){
    return true;
  }
  //Called for every touch move on the View when it is not the responder: 
  //does this view want to "claim" touch responsiveness?
  handleMoveShouldSetResponder(evt){
    return true;
  }
  //The View is now responding for touch events. 
  handleResponderGrant(evt){
    console.log('you are touching me');
  }
  //Something else is the responder right now and will not release it
  handleResponderReject(evt){
    console.log('please wait in line');
  }

  /* event handles */
  //touch move
  handleResponderMove(evt){
    console.log('touch move at:', 'X='+evt.pageX, 'Y='+evt.pageY);
  }
  //touch end/up
  handleResponderRelease(evt){
    console.log('touch end');
  }
  //Something else wants to become responder. Should this view release the responder?
  handleResponderTerminationRequest(evt){
    return true;
  }
  //touch cancel
  handleResponderTerminate(evt){
    console.log('touch canceled');
  }
  render() {
    return (
      <View 
        onStartShouldSetResponderCapture={this.handleStartShouldSetResponderCapture}
        onMoveShouldSetResponderCapture={this.handleMoveShouldSetResponderCapture}
        onStartShouldSetResponder={this.handleStartShouldSetResponder}
        onMoveShouldSetResponder={this.handleMoveShouldSetResponder}
        onResponderGrant={this.handleResponderGrant} 
        onResponderReject={this.handleResponderReject}
        onResponderMove={this.handleResponderMove}
        onResponderRelease={this.handleResponderRelease}
        onResponderTerminationRequest={this.handleResponderTerminationRequest}
        onResponderTerminate={this.handleResponderTerminate}>
          <Text>Press me!</Text>
      </View>
    );
  }
} 
```

2.3 evt æ˜¯ä¸€ä¸ªåˆæˆè§¦æ‘¸äº‹ä»¶ï¼Œå…·æœ‰ä»¥ä¸‹å½¢å¼ nativeEvent:

*   changedTouches -è‡ªä¸Šæ¬¡äº‹ä»¶ä»¥æ¥å‘ç”Ÿå˜åŒ–çš„æ‰€æœ‰è§¦æ‘¸äº‹ä»¶çš„æ•°ç»„
*   æ ‡è¯†ç¬¦-è§¦æ‘¸çš„ ID
*   location Xâ€”â€”è§¦æ‘¸ç›¸å¯¹äºå…ƒç´ çš„ X ä½ç½®
*   locationY -è§¦æ‘¸ç›¸å¯¹äºå…ƒç´ çš„ Y ä½ç½®
*   pageX -è§¦æ‘¸çš„ X ä½ç½®ï¼Œç›¸å¯¹äºæ ¹å…ƒç´ 
*   pageY -è§¦æ‘¸çš„ Y ä½ç½®ï¼Œç›¸å¯¹äºæ ¹å…ƒç´ 
*   ç›®æ ‡-æ¥æ”¶è§¦æ‘¸äº‹ä»¶çš„å…ƒç´ çš„èŠ‚ç‚¹ id
*   æ—¶é—´æˆ³-è§¦æ‘¸çš„æ—¶é—´æ ‡è¯†ç¬¦ï¼Œç”¨äºé€Ÿåº¦è®¡ç®—
*   è§¦æ‘¸-å±å¹•ä¸Šæ‰€æœ‰å½“å‰è§¦æ‘¸çš„æ•°ç»„

3. [PanResponder](https://facebook.github.io/react-native/docs/panresponder.html)

3.1

```
this._panResponder = PanResponder.create({
  // Ask to be the responder:
  onStartShouldSetPanResponder: (evt, gestureState) => true,
  onStartShouldSetPanResponderCapture: (evt, gestureState) => true,
  onMoveShouldSetPanResponder: (evt, gestureState) => true,
  onMoveShouldSetPanResponderCapture: (evt, gestureState) => true,
  //touch start
  onPanResponderGrant: (evt, gestureState) => {},
  //touch move
  onPanResponderMove: (evt, gestureState) => {},
  onPanResponderTerminationRequest: (evt, gestureState) => true,
  //touch end/up
  onPanResponderRelease: (evt, gestureState) => {},
  //touch cancel
  onPanResponderTerminate: (evt, gestureState) => {},
  onShouldBlockNativeResponder: (evt, gestureState) => true,
}); 
```

3.2 ä¸€ä¸ªæ‰‹åŠ¿çŠ¶æ€å¯¹è±¡å…·æœ‰ä»¥ä¸‹å†…å®¹:

*   åªè¦å±å¹•ä¸Šè‡³å°‘æœ‰ä¸€æ¬¡è§¦æ‘¸ï¼Œæ‰‹åŠ¿çŠ¶æ€çš„ ID å°±ä¸€ç›´å­˜åœ¨
*   moveX -æœ€è¿‘ç§»åŠ¨çš„è§¦æ‘¸çš„æœ€æ–°å±å¹•åæ ‡
*   moveY -æœ€è¿‘ç§»åŠ¨çš„è§¦æ‘¸çš„æœ€æ–°å±å¹•åæ ‡
*   x0 -åº”ç­”è€…æˆæƒçš„å±å¹•åæ ‡
*   y0 -åº”ç­”è€…æˆæƒçš„å±å¹•åæ ‡
*   dx -è§¦æ‘¸å¼€å§‹åæ‰‹åŠ¿çš„ç´¯è®¡è·ç¦»
*   dy -è‡ªè§¦æ‘¸å¼€å§‹ä»¥æ¥æ‰‹åŠ¿çš„ç´¯ç§¯è·ç¦»
*   vx -æ‰‹åŠ¿çš„å½“å‰é€Ÿåº¦
*   vy -æ‰‹åŠ¿çš„å½“å‰é€Ÿåº¦
*   numberActiveTouches -å½“å‰å±å¹•ä¸Šçš„è§¦æ‘¸æ¬¡æ•°

3.3 ui explorer ä¸­çš„ [PanResponder ç¤ºä¾‹](https://github.com/facebook/react-native/blob/master/Examples/UIExplorer/PanResponderExample.js)

# 2.6 èµ„æº

*   [react.parts](https://react.parts/native)
*   [js.coach](https://js.coach/)
*   [é“å…· vs çŠ¶æ€](https://github.com/uberVU/react-guide/blob/master/props-vs-state.md)
*   [æ€è€ƒåœ¨ååº”](https://facebook.github.io/react/docs/thinking-in-react.html)
*   [æ·±å…¥ JSX](https://facebook.github.io/react/docs/jsx-in-depth.html)
*   [æœ¬ç« æ¼”ç¤ºè„šæœ¬](https://github.com/unbug/react-native-train-scripts)

# 3 ç§æ¬¾å¼

1.å£°æ˜æ ·å¼

```
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: 'blue',
  },
  text: {
    fontSize: 14,
    color: 'red'
  }
}); 
```

2.ä½¿ç”¨æ ·å¼

```
class Main extends Component {
  render() {
    return (
      <View style={styles.container}>
        <Text style={styles.text}>I am red.</Text>
      </View>
    );
  }
} 
```

3.æ€§èƒ½

*   [æŸ¥çœ‹å±æ€§](https://facebook.github.io/react-native/docs/view.html#style)
*   [å›¾åƒå±æ€§](https://facebook.github.io/react-native/docs/image.html#style)
*   [æ–‡æœ¬å±æ€§](https://facebook.github.io/react-native/docs/text.html#style)
*   [å¼¹æ€§å±æ€§](https://facebook.github.io/react-native/docs/flexbox.html#content)
*   [å˜æ¢å±æ€§](https://facebook.github.io/react-native/docs/transforms.html#content)

# 3.1 Flexbox

1.[æŸ”æ€§ç›’å¸ƒå±€](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)

> flex å¸ƒå±€èƒŒåçš„ä¸»è¦æ€æƒ³æ˜¯è®©å®¹å™¨èƒ½å¤Ÿæ”¹å˜å…¶é¡¹ç›®çš„å®½åº¦/é«˜åº¦(å’Œé¡ºåº)ï¼Œä»¥æœ€å¥½åœ°å¡«å……å¯ç”¨ç©ºé—´(ä¸»è¦æ˜¯é€‚åº”å„ç§æ˜¾ç¤ºè®¾å¤‡å’Œå±å¹•å°ºå¯¸)ã€‚flex å®¹å™¨æ‰©å±•é¡¹ç›®ä»¥å¡«å……å¯ç”¨ç©ºé—´ï¼Œæˆ–è€…æ”¶ç¼©é¡¹ç›®ä»¥é˜²æ­¢æº¢å‡ºã€‚

[![](img/b28e181cbad7b14b69c9a9f854be486c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--xntHxG7q--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-15.png)

flex:1

[![](img/06df66f63fe7c47874184515db80dc80.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--7_MVOFQD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-2.png)T3ã€‘

```
const styles = StyleSheet.create({
  container: {
    flex: 1
  },
  header: {
    height: 200,
    backgroundColor: 'red'
  },
  main: {
    flex: 1,
    backgroundColor: 'blue'
  },
  footer: {
    height: 200,
    backgroundColor: 'green'
  },
  text: {
    color: '#ffffff',
    fontSize: 80
  }
}); 
```

3.flexDirection:'è¡Œ' | 'åˆ—'

[![](img/c0826c8eafa4d233e0a0bef45bbf7355.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--3ox1J1jl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-7.png)

[![](img/3e30fb5afaf196dec1d1832921fb2d2e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--7TQgOFHr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-8.png)

4 . justify content:' flex-start ' | ' flex-end ' | ' center ' | ' space-between ' | ' space-around '

[![](img/ba1aae085ad019a1cdae673f80f55aa3.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--OBYJzj77--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-10.png)

5.alignItems:'å¼¹æ€§èµ·ç‚¹' | 'å¼¹æ€§ç»ˆç‚¹' | 'ä¸­å¿ƒ' | 'æ‹‰ä¼¸'

[![](img/2e599a781202739597f137e221c939cc.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--spBeo4Ea--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-12.png)

6.alignSelf:'è‡ªåŠ¨' | 'ä¼¸ç¼©å¼€å§‹' | 'ä¼¸ç¼©ç»“æŸ' | 'å±…ä¸­' | 'æ‹‰ä¼¸'

[![](img/5a7a7dcca79de15dcb8f298b35d50918.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--kBCr8c-2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-13.png)

7.flexWrap:'wrap'|'nowrap 'ã€‚

[![](img/fedc65e0e5b2c30242cd6284ecd0a388.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--s-ekYtxq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-14.png)

8.ç®±çŠ¶æ¨¡å¼

[![](img/790e3bbbc332cafb6904721d446c8226.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Icua6igz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-16.png)

å®½åº¦=è¾¹æ¡†å®½åº¦(25)+å¸•ä¸é¡¿ left(25)+100+è¾¹æ¡†å®½åº¦(25)+å¸•ä¸é¡¿ Right(25)=200

height = border pwidth(25)+padding op(25)+100+border color width(25)+padding bottom(25)= 200

```
class Main extends Component {
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.header}>
          <Text style={styles.text}>200X100</Text>
        </View>
        <View style={styles.main}>
          <View  style={styles.mainContent}>
            <Text style={styles.text}>100X100</Text>
          </View>
        </View>
        <View style={styles.footer}>
          <Text style={styles.text}>200X100</Text>
        </View>
      </View>
    );
  }
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center'
  },
  header: {
    height: 100,
    width: 200,
    backgroundColor: 'red'
  },
  main: {
    height: 200,
    width: 200,
    padding: 25,
    borderWidth: 25,
    borderColor: 'black',
    margin: 25,
    backgroundColor: 'blue'
  },
  mainContent: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: 'red'
  },
  footer: {
    height: 100,
    width: 200,
    backgroundColor: 'green'
  },
  text: {
    color: '#ffffff',
    fontSize: 20
  }
}); 
```

[![](img/a4010a33063367db967035ec647d46a2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--j8M5lU06--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-17.png)

# 3.2 ç»å¯¹&ç›¸å¯¹

1 .ç»å¯¹

[![](img/3e7414aeb3820b06e12ed71202035e65.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--10axAj5v--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-0.png)T3ã€‘

```
class Position extends Component {
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.box1}>
          <Text style={styles.text}>1</Text>
        </View>
        <View style={styles.box2}>
          <Text style={styles.text}>2</Text>
        </View>
        <View style={styles.box3}>
          <Text style={styles.text}>3</Text>
        </View>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  container: {
    flex: 1
  },
  box1: {
    position: 'absolute',
    top: 40,
    left: 40,
    width: 100,
    height: 100,
    backgroundColor: 'red'
  },
  box2: {
    position: 'absolute',
    top: 80,
    left: 80,
    width: 100,
    height: 100,
    backgroundColor: 'blue'
  },
  box3: {
    position: 'absolute',
    top: 120,
    left: 120,
    width: 100,
    height: 100,
    backgroundColor: 'green'
  },
  text: {
    color: '#ffffff',
    fontSize: 80
  }
}); 
```

2.zIndexï¼Œ [v0.29](https://github.com/facebook/react-native/commit/d64368b9e239b574039f4a6508bf2aeb0806121b) æˆ–[å˜æ¢](http://facebook.github.io/react-native/docs/transforms.html)

[![](img/d475b97a39973b7b9a3e8f8ce389a5c8.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Iuf_Hk0c--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-2.png)T3ã€‘

```
 box2: {
    position: 'absolute',
    top: 80,
    left: 80,
    width: 100,
    height: 100,
    backgroundColor: 'blue',
    transform: [{'translate': [0,0, 1]}]
  }, 
```

3 .ç›¸å¯¹(é»˜è®¤)

[![](img/378e15e330f4ca064c69d46ed582229d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--OLA5x2TP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-1.png)T3ã€‘

```
class Relative extends Component {
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.box1}>
          <Text style={styles.text}>1</Text>
          <View style={styles.ball}/>
        </View>
        <View style={styles.box2}>
          <Text style={styles.text}>2</Text>
        </View>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  container: {
    flex: 1
  },
  box1: {
    position: 'relative',
    top: 40,
    left: 40,
    width: 100,
    height: 100,
    backgroundColor: 'red'
  },
  box2: {
    position: 'absolute',
    top: 100,
    left: 100,
    width: 100,
    height: 100,
    backgroundColor: 'blue'
  },
  ball: {
    position: 'absolute',
    top: 40,
    left: 40,
    width: 40,
    height: 40,
    borderRadius: 20,
    backgroundColor: 'yellow'
  },
  text: {
    color: '#ffffff',
    fontSize: 80
  }
}); 
```

4 .å›ºå®š

[![](img/9848cb5c752b55240e87a00f68b97233.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--D9YjLugj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-3.png)T3ã€‘

```
class Fixed extends Component {
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.tbar}>
          <Text style={styles.text}>Fixed top bar</Text>
        </View>
        <ScrollView style={styles.main}>
          <View style={styles.item}><Text style={styles.text}>1</Text></View>
          <View style={styles.item}><Text style={styles.text}>2</Text></View>
          <View style={styles.item}><Text style={styles.text}>3</Text></View>
        </ScrollView>
        <View style={styles.bbar}>
          <Text style={styles.text}>Fixed bottom bar</Text>
        </View>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  container: {
    flex: 1
  },
  tbar: {
    width: 375,
    height: 100,
    borderBottomWidth: 5,
    borderColor: 'black',
    backgroundColor: 'red'
  },
  main: {
    flex: 1
  },
  item: {
    height: 200,
    width: 375,
    marginTop: 10,
    backgroundColor: 'green'
  },
  bbar: {
    width: 375,
    height: 100,
    borderTopWidth: 5,
    borderColor: 'black',
    backgroundColor: 'red'
  },
  text: {
    color: '#ffffff',
    fontSize: 40
  }
}); 
```

# 3.3 å°ºå¯¸&å°ºå¯¸& onLayout

1 .çª—å£å¤§å°

[![](img/988560aea5dd405c5115ddedd55db732.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--oXlA9Q_l--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-4.png)T3ã€‘

```
let winSize = Dimensions.get('window');
console.log(winSize);
class Size extends Component {
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.block}/>
        <Text style={styles.text}>some text</Text>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  container: {
    flex: 1,
    alignItems: 'flex-start'
  },
  block: {
    height: 100,
    width: winSize.width,
    backgroundColor: 'red'
  },
  text: {
    color: '#ffffff',
    fontSize: 40/winSize.scale,
    backgroundColor: 'blue'
  }
}); 
```

2. [onLayout](http://facebook.github.io/react-native/releases/0.28/docs/view.html#onlayout)

```
class Size extends Component {
  handleTextLayout(evt){
    console.log(evt.nativeEvent.layout);
  }
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.block}/>
        <Text style={styles.text}
          onLayout={this.handleTextLayout}>some text</Text>
      </View>
    );
  }
} 
```

# 3.4 ç»§æ‰¿

1 .ä¼ é£æ ¼å½“é“å…·

```
class InheritanceStyle extends Component {
  render() {
    return (
      <View style={this.props.parentColor}>
      </View>
    );
  }
}

class Main extends Component {
  handleReady(str){
    console.log(str);
  }
  render() {
    return (
      <View style={styles.container}>
        <InheritanceStyle parentColor={styles.blue}/>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  container: {
    flex: 1
  },
  blue: {
    flex: 1,
    backgroundColor: 'blue'
  }
}); 
```

2 .ä¸²è”æ ·å¼

BaseStyles.js

```
import { StyleSheet,Dimensions } from 'react-native';
let winSize = Dimensions.get('window');
const BaseStyles = StyleSheet.create({
  text: {
    fontSize: 40/winSize.scale
  }
});
export default BaseStyles; 
```

```
import BaseStyles from './BaseStyles';

class InheritanceStyle extends Component {
  render() {
    return (
      <View style={this.props.parentColor}>
        <Text style={[BaseStyles.text, styles.text]}> this is a long text </Text>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  text:{
    color: '#ffffff'
  }
}); 
```

[![](img/8d0a7506e52966b0537f8aa30c660cc0.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--KeVOxkgI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-5.png)

# 3.5 èµ„æº

*   [Flexbox å®Œæ•´æŒ‡å—](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)
*   [CSS3 Flexbox å±æ€§çš„å¯è§†åŒ–æŒ‡å—](https://scotch.io/tutorials/a-visual-guide-to-css3-flexbox-properties)
*   [äº†è§£å¼¯æ›²æ–¹å‘](http://www.standardista.com/understanding-flex-direction/)
*   [æœ¬ç« æ¼”ç¤ºè„šæœ¬](https://github.com/unbug/react-native-train-scripts)

# 4 æ¶æ„

1.MVC é—®é¢˜

[![](img/0dc6701c69cd679aea2413ae168f849d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--AA0rqKCk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160722-0.png)

2.[é€šé‡](http://facebook.github.io/flux/docs/overview.html)

[![](img/f57bbeb5a781dd72c26c840922122171.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--3R22_RwH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/flux-diagram-white-background.png) 

3ã€‚æ•°æ®æµ

[![](img/1098e8aba633161160e58adb6de24a28.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--MFoPsNlq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160719-1.png)

[é€šé‡ TodoMVC ç¤ºä¾‹](https://github.com/facebook/flux/tree/master/examples/flux-todomvc/)

# 4.1 Redux

1.[åŠ¨ä½œ](https://github.com/acdlite/flux-standard-action) &åŠ¨ä½œåˆ›å»ºè€…

```
//action type
const ADD_TODO = 'ADD_TODO';

//action creator, semantic methods that create actions
//collected together in a module to become an API
function addTodoAction(title, hour) {
  //action, an object with a type property and new data, like events
  return {type: ADD_TODO, title, hour}
} 
```

2.[å‡é€Ÿå™¨](http://redux.js.org/docs/basics/Reducers.html)

```
//a function that accepts an accumulation and a value and returns a new accumulation.
function todoReducers(state = [], action) {
  switch (action.type) {
    case ADD_TODO:
      //always return a new state, never mutate old state
      return [
        {
          id: Utils.GUID(),
          title: "action.title,"
          endTime: getEndTime(action.hour),
          completed: false
        },
        ...state
      ]
    default:
      //return default state
      return state
  }
} 
```

3.å•†åº—

```
import { createStore } from 'redux';
//1\. define store
let store = createStore(todoReducers);

class App extends Component {
  constructor(props){
    super(props);
    this.state = {todos: []};
  }
  componentDidMount(){
    //2\. subscribe store
    this.unsubscribeStore = store.subscribe(() =>{
      //3\. getState
      this.setState({todos: store.getState()});
    });
  }
  componentWillUnmount(){
    //5\. unsubscribe store
    this.unsubscribeStore();
  }
  renderTodoList = ()=>{
    //reder todo list
    return this.state.todos.map( (todo)=> {
      return <Text key={todo.id}>Todo: {todo.title}</Text>
    });
  }
  handleAddTodo = ()=>{
    //4\. dispatching actions
    store.dispatch( addTodoAction('Create a new todo', 8) );
  }
  render() {
    return (
      <View>
        <TouchableHighlight onPress={this.handleAddTodo}>
          <Text>Add Todo</Text>
        </TouchableHighlight>
        <ScrollView>{this.renderTodoList()}</ScrollView>
      </View>
    );
  }
} 
```

4.æ•°æ®æµ

[![](img/2b3bce640675b518e064553faeb09c6d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--BBqGWQN0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160724-0.png)

[![](img/b4e82a5b62af1189e9ff1214a4371606.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--euiKGn2g--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160721-2.png)

[![](img/b7eb5573231db5a5229506e49f65f903.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--9F5qUoH0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160721-3.png)

# 4.2 [ååº”-è¿˜åŸ](https://github.com/reactjs/react-redux)

1.è¡ŒåŠ¨

```
import * as  navigationActions from './navigation';
import * as  todosActions from './todos';

export default {...navigationActions, ...todosActions}; 
```

2.combineReducers()

```
import { combineReducers } from 'redux';
import navigation from './navigation';
import todos from './todos';

const rootReducer = combineReducers({
  navigation, todos
});

export default rootReducer; 
```

3.configureStore()æ˜¾ç¤ºçš„åº”ç”¨ç¨‹åºçŠ¶æ€

```
import { createStore } from 'redux';
import reducers from '../reducers';

export default function configureStore() {
  const store = createStore(reducers);
  return store;
} 
```

4.mapStateToProps & mapDispatchToProps & bindActionCreators

```
import { bindActionCreators } from 'redux';
import { connect } from 'react-redux';

class App extends Component {
  renderTodoList = ()=>{
    //reder todo list
    return this.props.todos.map( (todo)=> {
      return <Text key={todo.id}>Todo: {todo.title}</Text>
    });
  }
  handleAddTodo = ()=>{
    this.props.actions.addTodoAction('Create a new todo', 8);
  }
  render() {
    return (
      <View>
        <TouchableHighlight onPress={this.handleAddTodo}>
          <Text>Add Todo</Text>
        </TouchableHighlight>
        <ScrollView>{this.renderTodoList()}</ScrollView>
      </View>
    );
  }
}

function mapStateToProps(state) {
  return {
    todos: state.todos
  };
}

function mapDispatchToProps(dispatch) {
  return {
    actions: bindActionCreators(Actions, dispatch)
  }
}

export default connect(
  mapStateToProps,
  mapDispatchToProps
)(App); 
```

5.ç”¨`<Provider/>`
è·¯è¿‡åº—é“º

```
import React, { Component } from 'react';
import { Provider } from 'react-redux';

import App from './containers/App';
import configureStore from './store/configureStore';

class Root extends Component {
  render() {
    return (
      <Provider store={configureStore()}>
        <App />
      </Provider>
    );
  }
}

export default Root; 
```

# 4.3 å®¹å™¨&ç»„ä»¶

1.[è¡¨ç¤ºå’Œå®¹å™¨ç»„ä»¶](http://redux.js.org/docs/basics/UsageWithReact.html)

|  | è¡¨è±¡æˆåˆ† | å®¹å™¨ç»„ä»¶ |
| --- | --- | --- |
| ç›®çš„ | äº‹ç‰©çš„å¤–è§‚(æ ‡è®°ã€æ ·å¼) | å·¥ä½œåŸç†(æ•°æ®è·å–ã€çŠ¶æ€æ›´æ–°) |
| æ„è¯†åˆ° Redux | ä¸ | æ˜¯ |
| è¯»å–æ•°æ® | ä»é“å…·ä¸­è¯»å–æ•°æ® | è®¢é˜… Redux çŠ¶æ€ |
| è¦æ›´æ”¹æ•°æ® | ä» props è°ƒç”¨å›è°ƒ | è°ƒåº¦å†—ä½™æ“ä½œ |
| éƒ½å†™å¥½äº† | ç”¨æ‰‹ | é€šå¸¸ç”± React Redux ç”Ÿæˆ |

2.`components/home-view`&T1ã€‘

2.1 ä¸»è§†å›¾ç»„ä»¶

[![](img/c471329572843f13c95407d82f3ad93a.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--1XDs0TLz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160721-1.png)

2.2 HomeView å®¹å™¨

```
import {
  Header,
  Main,
} from '../components/home-view';
import Actions from '../actions';

class HomeView extends Component {
  render() {
    return (
      <View>
        <Header {...this.props}/>
        <Main {...this.props} isVisible={this.state.isVisible}/>
      </View>
    );
  }
}

function mapStateToProps(state) {
  return {
    todos: state.todos
  };
}

function mapDispatchToProps(dispatch) {
  return {
    actions: bindActionCreators(Actions, dispatch)
  }
}

export default connect(
  mapStateToProps,
  mapDispatchToProps
)(HomeView); 
```

# 4.4 [Todo React åŸç”Ÿ App](https://github.com/unbug/TodoRN)

1.æ¦‚è§‚

[![](img/83386f75c44478b54509639beeb7fe70.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--aSvBFZkW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160722-1.png)

2.ç»“æ„

[![](img/fd87a9a7034080f6a6b0b77b106fc6ce.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--FPCTld_3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160721-8.png)

3.å®¹å™¨å’Œç»„ä»¶

[![](img/679272e2117559bd4b1b1a5af485d293.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--q5m9JPbN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160721-6.png)

# 4.5 å‘½åçº¦å®š

1.å®¹å™¨å’Œç»„ä»¶

1.1.å®¹å™¨æ–‡ä»¶:

```
src/containers/ModuleNameView.js 
```

ç»„ä»¶æ–‡ä»¶:

```
src/components/module-name-view
 - index.js
 - Main.js
 - Header.js
 - ...
 - img
   - icon@2x.png
   - icon@3x.png 
```

1.2.äº‹ä»¶åç§°:

```
handleEventName = ()=>{//todo}
...
<MyComponent onEventName={this.handleEventName}/> 
```

1.3.æ¸²æŸ“æ–¹æ³•:

```
 renderMethodName = () => {
   //todo
  }
  render() {
    return (
      <View>
        {this.renderMethodName()}
      </View>
    );
  } 
```

`
1.4\. mapStateToProps & mapDispatchToProps

``javascript
å‡½æ•° mapStateToProps(state){
return {
todos:state . todos
}ï¼›
}`

 `å‡½æ•° mapDispatchToProps(dispatch){
return {
Actions:bindActionCreators(Actionsï¼Œdispatch)
}
}
`

 `2 .åŠ¨ä½œ``src/actions``

 ````index.js
todos.js
navigation.js`` 

 ``2.1 ``src/constants/ActionTypes.js``

 ```` JavaScript
export const SWITCH _ MAIN _ TAB = ' SWITCH _ MAIN _ TAB 'ï¼›`

 `' src/actions/todos . js ```JavaScript
import * as types from '../å¸¸é‡/æ“ä½œç±»å‹``

 ``å¯¼å‡ºå‡½æ•° addTodo(titleï¼Œhour) {
è¿”å›{type: typesã€‚ADD_TODOï¼Œtitleï¼Œhour}
}

 `3 .å‡é€Ÿå™¨``src/reducers``
``
index.js
todos.js
navigation.js
``
3.1ã€‚``src/reducers/todos.js``
` `javascript
å¯¼å…¥{ ADD_TODOï¼ŒDELETE_TODOï¼ŒEDIT_TODOï¼ŒCOMPLETE_TODO }è‡ª'../constants/action types '
const initial state =[]`

 `å¯¼å‡ºé»˜è®¤å‡½æ•° todos(state = initialStateï¼Œaction){
switch(action . type){
case ADD _ TODO:
//TODO
é»˜è®¤:
è¿”å›çŠ¶æ€
}
}

 ``4.styles` `src/styles``

 `````
index.js
Basic.js
Theme.js
``
4.1 ``src/styles/Basic.js``

` `javascript
ä»' react-native 'å¯¼å…¥{ StyleSheetï¼ŒDimensions }ï¼›
è®© winSize = dimensions . get(' window ')ï¼›
const Basic = style sheet . create({
text:{
fontSize:32/winsize . scale
}
})ï¼›
å¯¼å‡ºé»˜è®¤åŸºæœ¬ï¼›`

 ```4.2` `src/styles/Theme.js``

 `````JavaScript
//colors
const color = {
ç»¿è‰²:' #00551e 'ï¼Œ
æ£•è‰²:' #693504 'ï¼Œ
çº¢è‰²:' #db2828'
}`

 `//other
const active = {
opacity:0.6

'å¯¼å‡ºé»˜è®¤{colorï¼Œactive}
 ``4.3` `å¯¼å…¥{Themeï¼ŒBasicStyle}è‡ª'../../styles 'ï¼›`````

 ```# 4.6 èµ„æº

*   [é€šé‡](http://facebook.github.io/flux/docs/overview.html)
*   [è„¸ä¹¦:MVC ä¸å¯ä¼¸ç¼©ï¼Œç”¨é€šé‡ä»£æ›¿](https://www.infoq.com/news/2014/05/facebook-mvc-flux)
*   [è¿˜åŸ](http://redux.js.org/index.html)
*   æ¯”å°”Â·è´¹å¸Œå°”çš„ fluxchat
*   [ä»‹ç»åŠ©ç„Šå‰‚&åœ¨ç»ƒä¹ ä¸­ååº”(KKBOX)](http://www.slideshare.net/randylien/introduce-flux-react-in-kkbox)
*   æ¯”å°”Â·è´¹å¸Œå°”è‘—
*   [é€šé‡ TodoMVC ç¤ºä¾‹](https://github.com/facebook/flux/tree/master/examples/flux-todomvc)
*   [Todo React åŸç”Ÿ App](https://github.com/unbug/TodoRN)

# 5 ä¸ªæ•°æ®

1.[è”ç½‘](http://facebook.github.io/react-native/releases/0.30/docs/network.html)

*   å–å¾—
*   XMLHttpRequest API
*   WebSocket

# 5.1 è·å–

1 .åº”ç”¨ [redux-thunk](https://github.com/gaearon/redux-thunk) ä¸­é—´ä»¶

` `javascript
ä»' redux 'å¯¼å…¥{ applyMiddlewareï¼ŒcreateStoreï¼Œcompose }ï¼›
ä»â€˜redux-thunkâ€™å¯¼å…¥ thunkï¼›
ä»â€œredux-loggerâ€å¯¼å…¥ createLogger
ä»'è¿›å£å‡é€Ÿå™¨../reducers 'ï¼›`

 `var middleware = compose(applyMiddleware(thunk)ï¼Œautore hydrate())ï¼›

å¯¼å‡ºé»˜è®¤å‡½æ•° configure store(){
const store = createStore(reducersï¼Œundefinedï¼Œmiddlewares
é€€è´§åº—é“ºï¼›
}

 `2 .å¼€å§‹å’Œç»“æŸåŠ¨ä½œç±»å‹

``javascript
//todo action types
export const START_FETCH_ALL_TODOS = 'START_FETCH_ALL_TODOS';
export const FETCH_ALL_TODOS = 'FETCH_ALL_TODOS';
``
3 .å–æµ
``JavaScript
import * as types from '../constants/actiontype 'ï¼›
å°†*ä½œä¸º API ä»'å¯¼å…¥../constants/server API 'ï¼›`

 `å‡½æ•° shouldFetchAllTodos(state){
const data = state . todosï¼›
if(data&&data . isfetchingalltodos){
è¿”å› false
}
è¿”å› true
}

å¯¼å‡ºå‡½æ•° fetchAllTodos(){
return async(dispatchï¼ŒgetState)=>{
//éªŒè¯
if(ï¼shouldFetchAllTodos(getState()){
return promise . resolve()ï¼›
}

```
//dispatch fetch start action
dispatch({type: types.START_FETCH_ALL_TODOS});

//fetching
const response = await fetch(APIs.allTodos);
//response
const data = await response.json();

//dispatch fetch end action
return dispatch({
  type: types.FETCH_ALL_TODOS,
  data
}); 
```

}
}
```

 `4 .å‡é€Ÿå™¨

` `javascript
å¯¼å‡ºé»˜è®¤å‡½æ•° todos(state = initialStateï¼Œaction){
switch(action . type){
case ç±»å‹ã€‚START _ FETCH _ ALL _ TODOS:
return object . assign({ }ï¼Œstateï¼Œ{ isFetchingAllTodos:true })ï¼›`

 ````
case types.FETCH_ALL_TODOS:
  return Object.assign({}, state, {
    isFetchingAllTodos: false,
    data: action.data.data.reduce(function (pre, cur) {
      //remove duplicates
      !pre.find( key=> key.id===cur.id) && pre.push(cur);
      return pre;
    }, [...state.data])
  });
...
...
default:
  return state 
```

}
}
``
5 .åˆ†æ´¾&æ¸²æŸ“`

 ```javascript
...
componentDidMount(){
//fetch data from server
this.props.actions.fetchAllTodos();
}
...
...
renderLoading = () => {
if (this.props.todos.isFetchingAllTodos) {
return (
<View style={styles.loading}>
<Text style={styles.loadingText}>Loading...</Text>
</View>
)
}
return null;
}
...
``

[![](img/7399f41ce4ecc461a4e3eba8207efd4f.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--4Cz0I_6c--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160726-2.png)

# 5.2 æŒä¹…

1.[å¼‚æ­¥å­˜å‚¨](https://facebook.github.io/react-native/docs/asyncstorage.html)

2 .åº”ç”¨ [redux-persist](https://github.com/rt2zz/redux-persist) ä¸­é—´ä»¶

` `javascript
ä»' react-native 'å¯¼å…¥{ async storage }ï¼›
ä»â€˜reduxâ€™å¯¼å…¥{ applyMiddlewareï¼ŒcreateStoreï¼Œcompose }ï¼›
ä»â€˜redux-thunkâ€™å¯¼å…¥ thunkï¼›
ä»â€˜redux-persistâ€™å¯¼å…¥{persistStoreï¼Œauto rehydrate }ï¼›
ä»'è¿›å£å‡é€Ÿå™¨../reducers 'ï¼›`

 `var middleware = compose(applyMiddleware(thunk)ï¼Œautore hydrate())ï¼›

å¯¼å‡ºé»˜è®¤å‡½æ•° configure store(){
const store = createStore(reducersï¼Œundefinedï¼Œmiddlewares
persistStore(storeï¼Œ{ storage:async storage })ï¼›
é€€è´§å•†åº—ï¼›
}

 `# 5.3 èµ„æº

*   [Redux å¼‚æ­¥åŠ¨ä½œ](http://redux.js.org/docs/advanced/AsyncActions.html)
*   [Todo React åŸç”Ÿ App](https://github.com/unbug/TodoRN)

# 6 è·¯ç”±å™¨

*   [èˆªæµ·å®¶](https://facebook.github.io/react-native/docs/navigatorios.html)
*   [å¯¼èˆªä»ª](https://facebook.github.io/react-native/docs/navigator.html)

# 6.1 å¯¼èˆªå™¨

1 .å®šä¹‰è·¯çº¿

` `javascript`

 `ä»'å¯¼å…¥ MainTabsViewã€‚/maintaibsview 'ï¼›
ä»'å¯¼å…¥ç¼–è¾‘è§†å›¾ã€‚/edit view 'ï¼›
ä»'å¯¼å…¥ BroswerViewã€‚/BroswerView 'ï¼›

const ROUTES = { MainTabsViewï¼ŒBroswerViewï¼Œedit view }ï¼›
```

 `2 .é…ç½®å¯¼èˆªå™¨

``javascript
class App extends Component {
renderScene = (route, navigator) => {
let Scene = ROUTES[route.name];
return <Scene {...route} navigator={navigator}/>;
}
configureScene = (route, routeStack) => {
switch (route.name){
case 'EditView':
return Navigator.SceneConfigs.FloatFromBottom;
default:
return Navigator.SceneConfigs.PushFromRight;
}
}
render() {
return (
<View style={styles.container}>
<StatusBar barStyle="light-content"/>
<Navigator
initialRoute={{name: 'MainTabsView'}}
renderScene={this.renderScene}
configureScene={this.configureScene}/>
</View>
)
}
}
``

3 .å‰è¿›å’Œåé€€

[![](img/9f3230ffc0857dc534372bc6d93235da.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--pAGUjCgi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160727-2.png)

``javascript
...
handleEdit = ()=>{
//Navigate forward to a new scene
this.props.navigator.push({name: 'EditView', data: this.props.data});
}
...
``

``javascript
...
close = ()=>{
//Transition back and unmount the current scene
this.props.navigator.pop();
}
...
``
[![](img/6fb09c96b1582e12059c0af137901f0c.png)T4ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--s6y7sCcB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160727-1.png)

4.onDidFocus & onWillFocus

``javascript
...
componentDidMount(){
this.currentRoute = this.props.navigator.navigationContext.currentRoute;
this.bindEvents();
}
componentWillUnmount(){
this.unBindEvents();
}
bindEvents = ()=>{
this.willFocusSubscription = this.props.navigator.navigationContext.addListener('willfocus', (event) => {
if (this.currentRoute !== event.data.route) {
this.setState({isVisible: false});
}
});
this.didFocusSubscription = this.props.navigator.navigationContext.addListener('didfocus', (event) => {
if (this.currentRoute === event.data.route) {
this.setState({isVisible: true});
}
});
}
unBindEvents = ()=>{
this.willFocusSubscription.remove();
this.didFocusSubscription.remove();
}
...
``

# 6.2 èµ„æº

*   [React Native ä¸­çš„è·¯ç”±å’Œå¯¼èˆª](http://blog.paracode.com/2016/01/05/routing-and-navigation-in-react-native/)

# 7 ä¸ªåŸç”Ÿæ¨¡å—

åœ¨æ‚¨çš„ RN ä»£ç ä¸­ï¼Œæ’å…¥:

``console.log(__fbBatchedBridge);``

ç„¶ååœ¨æ‚¨çš„è°ƒè¯•å™¨([http://localhost:8081/debugger-ui](http://localhost:8081/debugger-ui))ä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹ï¼Œ

[![](img/8be74f30664e4fb94ea8882adf4aa2fe.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--haUn4Etp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/native_modules_screenshot.png) 
è¿™å°±æ˜¯æˆ‘ä»¬æœ¬ç« è¦è®²çš„å†…å®¹ã€‚

# 8 æ•´åˆ

å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¹¶ä¸æ˜¯åœ¨å¼€å§‹ä¸€ä¸ªæ–°çš„ appï¼Œåªæ˜¯æƒ³ç”¨ react-native å¼€å‘ä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œæ‰€ä»¥é›†æˆåº”è¯¥æ˜¯ react-native å¼€å‘è€…å¿…å¤‡çš„æŠ€èƒ½ã€‚

å‡è®¾æ‚¨å·²ç»åœ¨ AwesomeProject ä¸­åˆ›å»ºäº†ä¸€äº›ç‰¹æ€§ï¼Œé‚£ä¹ˆæ‚¨å¸Œæœ›ä¸ºæ‚¨å½“å‰çš„é¡¹ç›®åˆ›å»ºä¸€ä¸ªå®Œå…¨ç›¸åŒçš„ç¯å¢ƒã€‚

[![](img/a281628a9770f530bbd5d11b770d0313.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Uv5LoNpX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integrationdemo.png)

**æ³¨æ„**ç‰ˆæœ¬åœ¨ä½ çš„åº”ç”¨å‘å¸ƒåéå¸¸é‡è¦ã€‚å¦‚æœä½ æƒ³å‡çº§ react-native å’ŒåŒ…ä»£ç ï¼Œé‚£å‡ ä¹æ„å‘³ç€ä½ ä¸æƒ³å†ç»´æŠ¤æ—§ç‰ˆæœ¬äº†ã€‚

# 8.1 iOS

*   ## å…·æœ‰å±€éƒ¨è·¯å¾„çš„ä½™è¶³ç±»

    è¦æ±‚:[æ¤°å­](https://cocoapods.org/)

    pod **ç‰ˆæœ¬> 1.0** åï¼Œéœ€è¦è¯†åˆ«ç›®æ ‡ã€‚åœ¨é¡¹ç›®æ ¹æ–‡ä»¶å¤¹ä¸­åˆ›å»ºâ€œpod fileâ€:
    ``
    target 'MyiOSApp' do
    pod 'React', :path => '../../AwesomeProject/node_modules/react-native', :subspecs => [
    'Core',
    'RCTImage',
    'RCTNetwork',
    'RCTText',
    'RCTWebSocket',
    ]
    end
    ``

ç„¶å``pod install``

[![](img/78a4072faa7d78d2ccef9625aa63c9f3.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--WQ8kShWM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/pod_integration.png)

# 8.1.1 åŒ…

``
react-native bundle
--platform ios
--dev false
--entry-file index.ios.js
--bundle-output ios/bundle/index.ios.bundle
--assets-dest ios/bundle``

# 8.2 å®‰å“

èµ·åˆï¼Œæˆ‘éµå¾ªäº†å®˜æ–¹çš„è¯´æ˜(è¿™çœ‹èµ·æ¥å¾ˆç®€å•)ï¼Œä½†æ˜¯å‡ºç°äº†å¾ˆå¤šæ„å»ºæˆ–è¿è¡Œæ—¶é”™è¯¯ğŸ˜‚ã€‚

æ¯”å¦‚:

`` Can't find variable: __fbBatchedBridge (<unknown file>:1)``

``java.lang.UnsatisfiedLinkError: could find DSO to load: libreactnativejni.so``

``android.view.WindowManager$BadTokenException: Unable to add window android.view.ViewRootImpl$W@5d992cf -- permission denied for this window type``

ä½†æ˜¯æ¼”ç¤ºå·¥ä½œæ­£å¸¸ï¼Œæ‰€ä»¥æˆ‘å†³å®šå¤åˆ¶å®ƒçš„æ„å»ºè®¾ç½®ã€‚æœ€åï¼Œå®ƒåœ¨æˆ‘çš„ Nexus 5X ä¸Šæ­£å¸¸å·¥ä½œã€‚æ­¥éª¤:

*   æ·»åŠ è·¯å¾„åˆ°æ ¹ gradle æ–‡ä»¶ï¼Œ
    [![](img/b8d3bd11c16339874f1efb87cdff0f9c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--TfrZ-xKQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step11.png)

*   ä¿®æ”¹ app gradle æ–‡ä»¶ï¼Œ
    [![](img/8b184d0714fec761508c294f8a9ca4fd.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--yJechyLQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step22.png)

    *1.å®˜æ–¹æ¼”ç¤ºä½¿ç”¨è¿™ä¸ªå˜é‡æ¥æ§åˆ¶æ˜¯å¦ä¸º CPU æ„å»ºä¸åŒçš„åº”ç”¨ç¨‹åºï¼Œè¿™å°†å‡å°‘æ¯ä¸ªåº”ç”¨ç¨‹åºçš„å¤§å°ï¼Œæˆ‘åœ¨è¿™é‡Œå¿½ç•¥å®ƒã€‚

    *2.ç‰ˆæœ¬æ”¯æŒåŒ…å¾ˆé‡è¦..ç”±äº react-native Android ä½¿ç”¨è®¸å¤šå¼€æºé¡¹ç›®ï¼Œå¦‚æœä½ å·²ç»ä½¿ç”¨äº†å…¶ä¸­ä¸€äº›ï¼Œä½ åº”è¯¥æ£€æŸ¥ç‰ˆæœ¬æˆ–ä»ä¾èµ–é¡¹ä¸­æ’é™¤ã€‚[ç›®å‰çš„åå•](https://github.com/facebook/react-native/blob/master/ReactAndroid/build.gradle)

    ``
    compile 'com.android.support:appcompat-v7:23.0.1'
    compile 'com.android.support:recyclerview-v7:23.0.1'
    compile 'com.facebook.fresco:fresco:0.11.0'
    compile 'com.facebook.fresco:imagepipeline-okhttp3:0.11.0'
    compile 'com.fasterxml.jackson.core:jackson-core:2.2.3'
    compile 'com.google.code.findbugs:jsr305:3.0.0'
    compile 'com.squareup.okhttp3:okhttp:3.2.0'
    compile 'com.squareup.okhttp3:okhttp-urlconnection:3.2.0'
    compile 'com.squareup.okhttp3:okhttp-ws:3.2.0'
    compile 'com.squareup.okio:okio:1.8.0'
    compile 'org.webkit:android-jsc:r174650'
    ``

*   ä¿®æ”¹æ ¹ gradle.propertiesï¼Œ
    [![](img/5b5b83d9a0e31fc557e3e548e5491fd7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--_qp8KHz3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step3.png)

*   æ·»åŠ  proguard è§„åˆ™ï¼Œ
    [![](img/148a0459ec5e21b6b2296c02f1fedb08.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--J2cmFeBj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step4.png)

*   AndroidManifest.xmlï¼Œå¦‚æœä¸éœ€è¦è°ƒè¯•æ¨¡å¼ï¼Œå¯ä»¥ç§»é™¤æƒé™ã€‚
    [![](img/ffdd2b83521d32d61a220f440886b181.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--IXiwOxW---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step5.png)

# 8.2 å®‰å“

èµ·åˆï¼Œæˆ‘éµå¾ªäº†å®˜æ–¹çš„è¯´æ˜(è¿™çœ‹èµ·æ¥å¾ˆç®€å•)ï¼Œä½†æ˜¯å‡ºç°äº†å¾ˆå¤šæ„å»ºæˆ–è¿è¡Œæ—¶é”™è¯¯ğŸ˜‚ã€‚

æ¯”å¦‚:

`` Can't find variable: __fbBatchedBridge (<unknown file>:1)``

``java.lang.UnsatisfiedLinkError: could find DSO to load: libreactnativejni.so``

``android.view.WindowManager$BadTokenException: Unable to add window android.view.ViewRootImpl$W@5d992cf -- permission denied for this window type``

ä½†æ˜¯æ¼”ç¤ºå·¥ä½œæ­£å¸¸ï¼Œæ‰€ä»¥æˆ‘å†³å®šå¤åˆ¶å®ƒçš„æ„å»ºè®¾ç½®ã€‚æœ€åï¼Œå®ƒåœ¨æˆ‘çš„ Nexus 5X ä¸Šæ­£å¸¸å·¥ä½œã€‚æ­¥éª¤:

*   æ·»åŠ è·¯å¾„åˆ°æ ¹ gradle æ–‡ä»¶ï¼Œ
    [![](img/b8d3bd11c16339874f1efb87cdff0f9c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--TfrZ-xKQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step11.png)

*   ä¿®æ”¹ app gradle æ–‡ä»¶ï¼Œ
    [![](img/8b184d0714fec761508c294f8a9ca4fd.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--yJechyLQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step22.png)

    *1.å®˜æ–¹æ¼”ç¤ºä½¿ç”¨è¿™ä¸ªå˜é‡æ¥æ§åˆ¶æ˜¯å¦ä¸º CPU æ„å»ºä¸åŒçš„åº”ç”¨ç¨‹åºï¼Œè¿™å°†å‡å°‘æ¯ä¸ªåº”ç”¨ç¨‹åºçš„å¤§å°ï¼Œæˆ‘åœ¨è¿™é‡Œå¿½ç•¥å®ƒã€‚

    *2.ç‰ˆæœ¬æ”¯æŒåŒ…å¾ˆé‡è¦..ç”±äº react-native Android ä½¿ç”¨è®¸å¤šå¼€æºé¡¹ç›®ï¼Œå¦‚æœæ‚¨å·²ç»ä½¿ç”¨äº†å…¶ä¸­çš„ä¸€äº›ï¼Œæ‚¨åº”è¯¥æ£€æŸ¥ç‰ˆæœ¬æˆ–ä»ä¾èµ–é¡¹ä¸­æ’é™¤å®ƒä»¬ã€‚[å½“å‰åˆ—è¡¨](https://github.com/facebook/react-native/blob/master/ReactAndroid/build.gradle)
    T0ã€‘

*   ä¿®æ”¹æ ¹ gradle.propertiesï¼Œ
    [![](img/5b5b83d9a0e31fc557e3e548e5491fd7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--_qp8KHz3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step3.png)

*   æ·»åŠ  proguard è§„åˆ™ï¼Œ
    [![](img/148a0459ec5e21b6b2296c02f1fedb08.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--J2cmFeBj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step4.png)

*   AndroidManifest.xmlï¼Œå¦‚æœä¸éœ€è¦è°ƒè¯•æ¨¡å¼ï¼Œå¯ä»¥ç§»é™¤æƒé™ã€‚
    [![](img/ffdd2b83521d32d61a220f440886b181.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--IXiwOxW---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step5.png)

# 8.2.1 åŒ…

``
react-native bundle
--platform android
--dev false
--entry-file index.android.js
--bundle-output android/bundle/index.android.bundle
--assets-dest android/bundle/
``

# 8.3 å‡ºç‰ˆå‰

*   å…³é—­è°ƒè¯•è®¾ç½®ã€‚
*   å¼‚å¸¸å¤„ç†ç¨‹åºçš„å®ç°ã€‚

# 8.3 èµ„æº

*   [ä¸ç°æœ‰åº”ç”¨é›†æˆ- iOS](https://facebook.github.io/react-native/docs/embedded-app-ios.html)
*   [ä¸ç°æœ‰åº”ç”¨æ•´åˆ- Android](https://facebook.github.io/react-native/docs/embedded-app-android.html)

# 9 çƒ­æ›´æ–°(draf)

# 10 æ€§èƒ½

# 10.1 shouldcomponentdupdate

æœ¬ç« å¯é€‚ç”¨äºæ‰€æœ‰ react åº”ç”¨ã€‚

## shouldcomponentdupdate

React é€šå¸¸å¾ˆå¿«ï¼Œä½†æ˜¯æ‚¨ä»ç„¶å¯ä»¥é€šè¿‡ä¼˜åŒ–å‡½æ•° [shouldComponentUpdate](https://facebook.github.io/react/docs/component-specs.html#updating-shouldcomponentupdate) æ¥æé«˜æ€§èƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒè¿”å›çœŸï¼Œå¦‚æœè¿”å›å‡ï¼Œæ¸²æŸ“å‡½æ•°å°†è¢«è·³è¿‡ã€‚

å½“çŠ¶æ€æˆ–å±æ€§æ”¹å˜æ—¶ï¼Œè¿™ä¸ªå‡½æ•°ç»å¸¸è¢«è°ƒç”¨ã€‚æ‰€ä»¥**ä¿æŒç®€å•å¿«é€Ÿ**å¾ˆé‡è¦ã€‚
å½“æ‚¨è°ƒç”¨`setState`æ—¶ï¼Œ`render`åŠŸèƒ½å°†ä¸€ç›´æ‰§è¡Œï¼Œå³ä½¿å…ˆå‰çŠ¶æ€ç­‰äºå½“å‰çŠ¶æ€ã€‚è¿™æ˜¯æˆ‘ä»¬å¯ä»¥åšä¸€äº›ä¼˜åŒ–çš„åœ°æ–¹ã€‚

[æ¼”ç¤º 1](https://jsbin.com/figuse/edit?html,js,output)

åœ¨æ¼”ç¤º 1 ä¸­ï¼Œå½“å•å‡»æŒ‰é’®æ—¶ï¼Œå®ƒå°†è®¾ç½®ç›¸åŒçš„çŠ¶æ€ï¼Œä½†æ¸²æŸ“æ—¶é—´ä»ä¼šå¢åŠ ã€‚

[æ¼”ç¤º 2](http://jsbin.com/culipes/5/edit?html,js,output)

åœ¨ demo2 ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥ name çš„å€¼æ˜¯å¦ç­‰äºä¹‹å‰çš„å€¼ï¼Œå¦‚æœç­‰äºåˆ™è¿”å› falseï¼Œé‚£ä¹ˆæˆ‘ä»¬å‡å°‘æ¸²æŸ“å‡½æ•°çš„æ¬¡æ•°ã€‚

ä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„çŠ¶æ€ç»“æ„å¾ˆå¤æ‚ï¼Œæ¯”å¦‚`{ a: { b: { c: [1, 2, 3] }}}`ï¼Œæˆ‘ä»¬å°±è¦æ·±å…¥æ¯”è¾ƒå®ƒä»¬ã€‚è¿™æ˜¾ç„¶è¿åäº†æˆ‘ä»¬ä¸Šé¢æåˆ°çš„è§„åˆ™ï¼Œ**ä¿æŒ shouldComponentUpdate ç®€å•**

## ä¸å¯å˜-js

[ä¸å¯å˜](https://en.wikipedia.org/wiki/Immutable_object)æ˜¯æ¥è‡ª[å‡½æ•°å¼ç¼–ç¨‹](https://en.wikipedia.org/wiki/Functional_programming)çš„ä¸€ä¸ªæ¦‚å¿µï¼Œä¸å¯å˜æ•°æ®çš„ç‰¹ç‚¹ä¹‹ä¸€æ˜¯ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹ã€‚æ‰€ä»¥æœ‰ä¸€äº›ç®—æ³•ä¸ºæ¯ä¸ªæ•°æ®ç»“æ„åˆ›å»ºæ•£åˆ—(æ›´å¤š[ç»†èŠ‚](https://en.wikipedia.org/wiki/Persistent_data_structure))ã€‚
æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥é˜²æ­¢æ·±åº¦æ¯”è¾ƒï¼Œæµ…åº¦æ¯”è¾ƒå°±è¶³å¤Ÿäº†ã€‚
è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ª facebook çš„[ä¸å¯å˜-js](https://facebook.github.io/immutable-js/)

[æ¼”ç¤º 3](http://jsbin.com/vofubiy/8/edit?html,js,output)

åœ¨æ¼”ç¤º 3 ä¸­ï¼Œæˆ‘ä»¬å¤šæ¬¡å•å‡»ç¬¬ä¸€ä¸ªæŒ‰é’®ï¼Œæ¬¡æ•°åªä¼šå¢åŠ ä¸€æ¬¡ï¼Œå•å‡»ç¬¬äºŒä¸ªæŒ‰é’®ï¼Œæ¬¡æ•°ä¼šå¢åŠ ã€‚

# 10.2 èµ„æº

*   [React.js å¯¹è´¦](https://www.infoq.com/presentations/react-reconciliation)
*   [å¯¹è´¦](https://facebook.github.io/react/docs/reconciliation.html)
*   [é«˜çº§æ€§èƒ½](https://facebook.github.io/react/docs/advanced-performance.html)
*   [ä¸å¯å˜-js](https://facebook.github.io/immutable-js/)
*   [ShouldComponentUpdate](https://facebook.github.io/react/docs/component-specs.html#updating-shouldcomponentupdate)
*   [åŠŸèƒ½ç¼–ç¨‹](https://en.wikipedia.org/wiki/Functional_programming)

# èµ„æº

*   [ååº”å †](https://facebook.github.io/react/)
*   [ååº”åŸç”Ÿ](https://facebook.github.io/react-native/)
*   [ç‰›é€¼-ååº”](https://github.com/enaqx/awesome-react)
*   [awesome-react-native](https://github.com/jondot/awesome-react-native)
*   [æ„å»ºä¸ååº”](http://buildwithreact.com/)

### ä¹¦ç±

*   [å­¦ä¹ ååº”åŸç”Ÿ](http://shop.oreilly.com/product/0636920041511.do)

## - [å½¢æˆååº”è¾¹ç¼˜](http://shop.oreilly.com/product/9781939902122.do)

## ç”± [@unbug](https://twitter.com/unbug) åˆ›ä½œ:

*   MIHTool-iOS Web Debugger Pro:MIHTool å¸®åŠ©å‰ç«¯å·¥ç¨‹å¸ˆåœ¨ iPad å’Œ iPhone ä¸Šè°ƒè¯•å’Œä¼˜åŒ–ä»–ä»¬çš„ç½‘é¡µã€‚
*   [ä»£ç è‡ªæˆ‘-å˜é‡å‘½åç¥å™¨](https://unbug.github.io/codelf/):æ•´ç†ä½ çš„ GitHub stars å’Œèµ„æºåº“ã€‚åœ¨ GitHub çš„é¡¹ç›®ä¸­æœç´¢ï¼Œæ‰¾åˆ°çœŸå®ä¸–ç•Œä¸­ä½¿ç”¨çš„å˜é‡åã€‚
*   [js-middleware](https://github.com/unbug/js-middleware) :å¼ºå¤§çš„ Javascript ä¸­é—´ä»¶æ¨¡å¼å®ç°ï¼Œå°† Middleware es åº”ç”¨äºä»»ä½•å¯¹è±¡ã€‚ä¸€ä¸ªæ— ç—›çš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ä»£ç åƒ ReduxJS å’Œ ExpressJS ä¸€æ ·å¯ä¼¸ç¼©å’Œå¯ç»´æŠ¤ã€‚
*   [å¯¹è‡ªæ€çš„å…¬å…±è®¸å¯è¯´ä¸](https://github.com/unbug/snts):æˆ‘ä»¬å¤±å»äº†å¤ªå¤šå¤©æ‰å¼€å‘è€…ï¼Œä»–ä»¬è‡ªæ€äº†ï¼Œæ¯”å¦‚ Aaron Hillel Swartz(1986 å¹´ 11 æœˆ 8 æ—¥-2013 å¹´ 1 æœˆ 11 æ—¥)ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œç¤¾åŒºéœ€è¦ä½ ï¼Œä¸–ç•Œéœ€è¦ä½ ï¼Œè¯·è®©è‡ªå·±æ´»ä¸‹å»ã€‚``````````````````````````````````