# Yarn å·¥ä½œç©ºé—´:æ²¡æœ‰ Lerna çš„ monorepo ç®¡ç†åº”ç”¨ç¨‹åºå’Œç¼–ç ç¤ºä¾‹

> åŸæ–‡:[https://dev . to/Hugo _ _ df/yarn-work spaces-mono repo-management-without-lerna-for-applications-and-coding-examples-3920](https://dev.to/hugo__df/yarn-workspaces-monorepo-management-without-lerna-for-applications-and-coding-examples-3920)

> å¦‚ä½•ä½¿ç”¨ Yarn å·¥ä½œç©ºé—´ç®¡ç†åº”ç”¨ç¨‹åº/ç¼–ç ç¤ºä¾‹ï¼Ÿ

å½“æ‚¨ä¸éœ€è¦ git åŒºåˆ†å’Œç‰ˆæœ¬æ§åˆ¶å·¥å…·æ—¶ï¼Œä¸éœ€è¦ Lernaã€‚

æ­¤å¤–ï¼ŒYarn å·¥ä½œåŒºæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„è½»é‡çº§å·¥å…·ï¼Œå¯ä»¥è®©ç®€å•çš„ Node.js monorepo æ“ä½œæ›´å¿«åœ°å¯åŠ¨å’Œè¿è¡Œã€‚

åœ¨[github.com/HugoDF/yarn-workspaces-simple-monorepo](https://github.com/HugoDF/yarn-workspaces-simple-monorepo)çš„å•ä¸€å›è´­ç¤ºä¾‹

## [](#yarn-workspaces-vs-lerna)çº±çº¿å·¥ä½œåŒº vs Lerna

ä½¿ç”¨å·¥ä½œåŒºçš„ä¼˜ç‚¹:Yarn å·¥ä½œåŒºæ˜¯æ ‡å‡† Yarn å·¥å…·é“¾çš„ä¸€éƒ¨åˆ†(ä¸éœ€è¦ä¸‹è½½é¢å¤–çš„ä¾èµ–é¡¹)ã€‚å®ƒçš„èŒƒå›´éå¸¸æœ‰é™ï¼Œå¹¶ä¸”å¯¹æ‚¨çš„å®‰è£…è¿›è¡Œé‡å¤æ•°æ®æ¶ˆé™¤(å³ä½¿å®ƒä»¬æ›´å¿«)ã€‚è¿™éå¸¸é€‚åˆç®¡ç†ä»£ç ç¤ºä¾‹æˆ–åº”ç”¨ç¨‹åºçš„å•ä¸€æŠ¥è¡¨ã€‚

å·¥ä½œç©ºé—´çš„ç¼ºç‚¹:å¦‚æœä½ æ­£åœ¨å¤„ç†ä¸€ä¸ª*åŒ…* (npm æ¨¡å—ï¼Œåº“)çš„å•ä¸€æŠ¥å‘Šï¼ŒLerna æä¾›äº†å‘å¸ƒ/æµ‹è¯•åªæ”¹å˜æ–‡ä»¶çš„å·¥å…·ã€‚

æ³¨æ„:Lerna å’Œ Yarn å·¥ä½œç©ºé—´æ˜¯*äº‹å®ä¸Š*è¢«è®¾è®¡æˆä¸€èµ·å·¥ä½œï¼Œåªæ˜¯åœ¨ä½ çš„`lerna.json`ä¸­ä½¿ç”¨`"npmClient": "yarn"`ã€‚å…³äºä¸ Lerna çš„æ¯”è¾ƒï¼Œè¯·å‚è§ [Yarn å·¥ä½œç©ºé—´æ–‡æ¡£ã€‚](https://yarnpkg.com/lang/en/docs/workspaces/#toc-how-does-it-compare-to-lerna)

## [](#set-up-yarn-workspaces)è®¾ç½®çº±çº¿å·¥ä½œåŒº

```
{
"private": true,
"workspaces": ["examples/*", "other-example"]
} 
```

ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤º:

å›¾å½¢ LRï¼›r[root]ï¼›r ->ç¤ºä¾‹ï¼›ä¾‹->ä¾‹-1ï¼›ä¾‹->ä¾‹-2ï¼›r ->å…¶ä»–-ä¸¾ä¾‹ï¼›

**æ³¨æ„**:æ¯ä¸ªå·¥ä½œåŒº(åŒ…)éœ€è¦æœ‰ä¸€ä¸ª package.jsonï¼Œå¸¦æœ‰å”¯ä¸€çš„`name`å’Œæœ‰æ•ˆçš„`version`ã€‚æ ¹ package.json ä¸éœ€è¦ï¼Œåªéœ€è¦æœ‰`"private": true`å’Œ`"workspaces": []`å°±å¯ä»¥äº†ã€‚

## [](#bootstrapping-the-monorepo)è‡ªä¸¾å•æŠ¥è¡¨

ä¸ Lerna ç­‰ä»·çš„å°†åŒ…æ‹¬ä¸€ä¸ª`lerna bootstrap`ï¼Œå®ƒåœ¨æ‰€æœ‰çš„åŒ…ä¸­è¿è¡Œ`npm install`ã€‚

å¯¹äºå·¥ä½œåŒºï¼Œå› ä¸ºä¾èµ–å…³ç³»æ˜¯ä»æ ¹é”å®šçš„ï¼Œæ‰€ä»¥æ‚¨åªéœ€è¦åœ¨é¡¶å±‚æ‰§è¡Œä¸€ä¸ª`yarn`ã€‚

ä¸ºäº†è®©å·¥ä½œåŒºå·¥ä½œï¼Œæ‚¨çš„â€œå·¥ä½œåŒºâ€æ–‡ä»¶å¤¹éœ€è¦æœ‰ä¸€ä¸ª package.jsonï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª`name`å’Œ`version`ã€‚

## [](#managing-your-monorepo-with-raw-yarn-workspace-endraw-and-raw-yarn-workspaces-endraw-commands)ä½¿ç”¨`yarn workspace`å’Œ`yarn workspaces`å‘½ä»¤ç®¡ç†æ‚¨çš„ monorepo

### [](#run-commands-in-a-single-package)è¿è¡Œå•ä¸ªåŒ…ä¸­çš„å‘½ä»¤

è¦åœ¨ monorepo çš„å•ä¸ªåŒ…ä¸­è¿è¡Œå‘½ä»¤ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è¯­æ³•:

```
yarn workspace <package-name> <yarn-command> 
```

ä¾‹å¦‚:

```
$ yarn workspace example-1 run test
yarn workspace v1.x.x
yarn run v1.x.x
$ node test.js
test from example 1
âœ¨ Done in 0.23s.
âœ¨ Done in 0.86s. 
```

æˆ–è€…

```
$ yarn workspace example-2 remove lodash.omit
yarn workspace v1.x.x
yarn remove v1.x.x
[1/2] ğŸ—‘ Removing module lodash.omit...
[2/2] ğŸ”¨ Regenerating lockfile and installing missing dependencies...
success Uninstalled packages.
âœ¨ Done in 2.83s.
âœ¨ Done in 3.58s. 
```

â€œåŒ…åâ€åº”è¯¥æ˜¯åœ¨`name`é”®ä¸‹çš„ package.json ä¸­æ‰¾åˆ°çš„å€¼ã€‚

### [](#run-commands-in-all-packages)è¿è¡Œæ‰€æœ‰åŒ…ä¸­çš„å‘½ä»¤

è¦åœ¨ monorepo çš„æ¯ä¸ªåŒ…ä¸­è¿è¡Œå‘½ä»¤ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è¯­æ³•:

```
yarn workspaces <yarn-command> 
```

ä¾‹å¦‚:

```
$ yarn workspaces run test
yarn workspaces v1.x.x
yarn run v1.x.x
$ node test.js
test from example 1
âœ¨ Done in 0.22s.
yarn run v1.x.x
$ node test.js
{ public: 'data' } 'Should not display "secret"'
âœ¨ Done in 0.23s.
yarn run v1.x.x
$ echo "Other Example"
Other Example
âœ¨ Done in 0.11s.
âœ¨ Done in 2.15s. 
```

æˆ–è€…

```
$ yarn workspaces run add lodash.omit@latest
yarn workspaces v1.x.x
yarn add v1.x.x
[1/4] ğŸ” Resolving packages...
[2/4] ğŸšš Fetching packages...
[3/4] ğŸ”— Linking dependencies...
[4/4] ğŸ”¨ Building fresh packages...
success Saved 1 new dependency.
info Direct dependencies
info All dependencies
â””â”€ lodash.omit@4.5.0
âœ¨ Done in 3.31s.
yarn add v1.x.x
[1/4] ğŸ” Resolving packages...
[2/4] ğŸšš Fetching packages...
[3/4] ğŸ”— Linking dependencies...
[4/4] ğŸ”¨ Building fresh packages...
success Saved 1 new dependency.
info Direct dependencies
info All dependencies
â””â”€ lodash.omit@4.5.0
âœ¨ Done in 2.76s.
yarn add v1.x.x
[1/4] ğŸ” Resolving packages...
[2/4] ğŸšš Fetching packages...
[3/4] ğŸ”— Linking dependencies...
[4/4] ğŸ”¨ Building fresh packages...
success Saved 1 new dependency.
info Direct dependencies
info All dependencies
â””â”€ lodash.omit@4.5.0
âœ¨ Done in 2.63s.
âœ¨ Done in 10.82s. 
```

åœ¨[github.com/HugoDF/yarn-workspaces-simple-monorepo](https://github.com/HugoDF/yarn-workspaces-simple-monorepo)çš„å•ä¸€å›è´­ç¤ºä¾‹

[unsplash-logo
é©¬ä¸Â·äºšå½“æ–¯](https://unsplash.com/@martinadams?utm_medium=referral&utm_campaign=photographer-credit&utm_content=creditBadge)