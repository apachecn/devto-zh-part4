# Python æŠ€å·§å’Œè¯€çªï¼Œæ‚¨è¿˜æ²¡æœ‰çœ‹è¿‡ï¼Œç¬¬ 2 éƒ¨åˆ†ã€‚

> åŸæ–‡:[https://dev . to/Martin Heinz/python-tips-and-trick-you-have-not-behind-seen-part-2-p78](https://dev.to/martinheinz/python-tips-and-trick-you-haven-t-already-seen-part-2-p78)

*æ³¨:è¿™æœ€åˆå‘å¸ƒåœ¨[martinheinz . dev](https://martinheinz.dev/blog/4)T3ã€‘*

å‡ å‘¨å‰ï¼Œæˆ‘å‘è¡¨äº†ä¸€ç¯‡æ–‡ç« ([æ­¤å¤„](https://dev.to/martinheinz/python-tips-and-trick-you-haven-t-already-seen-1p41))å…³äºä¸€äº›ä¸å¤ªä¸ºäººæ‰€çŸ¥çš„ Python ç‰¹æ€§ï¼Œå¾ˆå¤šäººä¼¼ä¹éƒ½å–œæ¬¢å®ƒï¼Œæ‰€ä»¥è¿™é‡Œæœ‰å¦ä¸€è½® Python ç‰¹æ€§ï¼Œå¸Œæœ›ä½ è¿˜æ²¡æœ‰çœ‹åˆ°ã€‚

## [](#naming-a-slice-using-raw-slice-endraw-function)ä½¿ç”¨`slice`åŠŸèƒ½å‘½ååˆ‡ç‰‡

ä½¿ç”¨å¤§é‡ç¡¬ç¼–ç çš„ç´¢å¼•å€¼å¾ˆå¿«ä¼šå¯¼è‡´ç»´æŠ¤å’Œå¯è¯»æ€§æ–¹é¢çš„æ··ä¹±ã€‚ä¸€ç§é€‰æ‹©æ˜¯å¯¹æ‰€æœ‰ç´¢å¼•å€¼ä½¿ç”¨å¸¸é‡ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½:

```
#              ID    First Name     Last Name line_record = "2        John         Smith"

ID = slice(0, 8)
FIRST_NAME = slice(9, 21)
LAST_NAME = slice(22, 27)

name = f"{line_record[FIRST_NAME].strip()}  {line_record[LAST_NAME].strip()}"
# name == "John Smith" 
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…ç¥ç§˜çš„ç´¢å¼•ï¼Œé¦–å…ˆä½¿ç”¨`slice`å‡½æ•°å‘½åå®ƒä»¬ï¼Œç„¶ååœ¨åˆ‡æ‰å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†æ—¶ä½¿ç”¨å®ƒä»¬ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨åˆ‡ç‰‡å¯¹è±¡çš„å±æ€§`.start`ã€`.stop`å’Œ`.step`æ¥è·å¾—å…³äºåˆ‡ç‰‡å¯¹è±¡çš„æ›´å¤šä¿¡æ¯ã€‚

## [](#prompting-user-for-a-password-at-runtime)è¿è¡Œæ—¶æç¤ºç”¨æˆ·è¾“å…¥å¯†ç 

è®¸å¤šå‘½ä»¤è¡Œå·¥å…·æˆ–è„šæœ¬éœ€è¦ç”¨æˆ·åå’Œå¯†ç æ‰èƒ½æ“ä½œã€‚å› æ­¤ï¼Œå¦‚æœä½ ç¢°å·§ç¼–å†™äº†è¿™æ ·çš„ç¨‹åºï¼Œä½ å¯èƒ½ä¼šå‘ç°`getpass`æ¨¡å—å¾ˆæœ‰ç”¨:

```
import getpass

user = getpass.getuser()
password = getpass.getpass()
# Do Stuff... 
```

è¿™ä¸ªéå¸¸ç®€å•çš„åŒ…å…è®¸ä½ æç¤ºç”¨æˆ·è¾“å…¥å¯†ç ï¼Œå¹¶é€šè¿‡æå–å½“å‰ç”¨æˆ·çš„ç™»å½•åæ¥è·å–ä»–ä»¬çš„ç”¨æˆ·åã€‚è¯·æ³¨æ„ï¼Œä¸æ˜¯æ¯ä¸ªç³»ç»Ÿéƒ½æ”¯æŒéšè—å¯†ç ã€‚Python ä¼šè¯•å›¾è­¦å‘Šä½ è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥åªéœ€åœ¨å‘½ä»¤è¡Œä¸­é˜…è¯»è­¦å‘Šã€‚

## [](#find-close-matches-of-a-wordstring)æŸ¥æ‰¾å•è¯/å­—ç¬¦ä¸²çš„ç›¸è¿‘åŒ¹é…é¡¹

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ Python æ ‡å‡†åº“çš„ä¸€äº›æ›´éš¾ç†è§£çš„ç‰¹æ€§ã€‚å¦‚æœä½ å‘ç°è‡ªå·±å¤„äºè¿™æ ·çš„æƒ…å†µï¼Œä½ éœ€è¦ä½¿ç”¨åƒ[Levenshtein distance](https://en.wikipedia.org/wiki/Levenshtein_distance)Python å’Œ`difflib`è¿™æ ·çš„ä¸œè¥¿æ¥æŸ¥æ‰¾ç±»ä¼¼äºæŸä¸ªè¾“å…¥å­—ç¬¦ä¸²çš„å•è¯ã€‚

```
import difflib
difflib.get_close_matches('appel', ['ape', 'apple', 'peach', 'puppy'], n=2)
# returns ['apple', 'ape'] 
```

`difflib.get_close_matches`æ‰¾åˆ°æœ€ä½³çš„*â€œè¶³å¤Ÿå¥½â€*åŒ¹é…ã€‚è¿™é‡Œï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ç¬¬äºŒä¸ªå‚æ•°ç›¸åŒ¹é…ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æä¾›å¯é€‰å‚æ•°`n`,æŒ‡å®šè¦è¿”å›çš„æœ€å¤§åŒ¹é…æ•°ã€‚å¦ä¸€ä¸ªå¯ç”¨çš„å…³é”®å­—å‚æ•°`cutoff`(é»˜è®¤ä¸º 0.6)å¯ä»¥è®¾ç½®ä¸ºæ”¹å˜åŒ¹é…å­—ç¬¦ä¸²çš„å¾—åˆ†é˜ˆå€¼ã€‚

## [](#working-with-ip-addresses)å¤„ç† IP åœ°å€

å¦‚æœä½ å¿…é¡»ç”¨ Python åšä¸€äº›ç½‘ç»œå·¥ä½œï¼Œä½ å¯èƒ½ä¼šå‘ç°`ipaddress`æ¨¡å—éå¸¸æœ‰ç”¨ã€‚ä¸€ä¸ªç”¨ä¾‹æ˜¯ä» CIDR ç”Ÿæˆ ip åœ°å€åˆ—è¡¨(*æ— ç±»åŸŸé—´è·¯ç”±* ):

```
import ipaddress
net = ipaddress.ip_network('74.125.227.0/29')  # Works for IPv6 too
# IPv4Network('74.125.227.0/29') 
for addr in net:
    print(addr)

# 74.125.227.0
# 74.125.227.1
# 74.125.227.2
# 74.125.227.3
# ... 
```

å¦ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§æ˜¯ ip åœ°å€çš„ç½‘ç»œæˆå‘˜æ£€æŸ¥:

```
ip = ipaddress.ip_address("74.125.227.3")

ip in net
# True 
ip = ipaddress.ip_address("74.125.227.12")
ip in net
# False 
```

è¿˜æœ‰å¾ˆå¤šæ›´æœ‰è¶£çš„åŠŸèƒ½æˆ‘å°±ä¸èµ˜è¿°äº†ï¼Œå› ä¸ºä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°é‚£äº›[ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œåœ¨`ipaddress`æ¨¡å—å’Œå…¶ä»–ç½‘ç»œç›¸å…³æ¨¡å—ä¹‹é—´åªæœ‰æœ‰é™çš„äº’æ“ä½œæ€§ã€‚ä¾‹å¦‚ï¼Œæ‚¨ä¸èƒ½ä½¿ç”¨`IPv4Network`çš„å®ä¾‹ä½œä¸ºåœ°å€å­—ç¬¦ä¸²â€”â€”å®ƒä»¬éœ€è¦é¦–å…ˆä½¿ç”¨`str`è¿›è¡Œè½¬æ¢ã€‚](https://docs.python.org/3/howto/ipaddress.html)

## [](#debugging-program-crashes-in-shell)è°ƒè¯•ç¨‹åºåœ¨ Shell ä¸­å´©æºƒ

å¦‚æœä½ æ˜¯ä¸€ä¸ªæ‹’ç»ä½¿ç”¨ IDE å¹¶ä¸”ç”¨ Vim æˆ– Emacs ç¼–ç çš„äººï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šé‡åˆ°è¿™æ ·ä¸€ç§æƒ…å†µï¼Œåœ¨ IDE ä¸­ä½¿ç”¨è°ƒè¯•å™¨æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä½ çŸ¥é“å—ï¼Ÿä½ æœ‰ä¸€ä¸ªâ€”â€”ç”¨`python3.8 -i`è¿è¡Œä½ çš„ç¨‹åºâ€”â€”`-i`åœ¨ä½ çš„ç¨‹åºç»ˆæ­¢æ—¶å¯åŠ¨äº¤äº’å¼ shellï¼Œä»é‚£é‡Œä½ å¯ä»¥æ¢ç´¢æ‰€æœ‰å˜é‡å¹¶è°ƒç”¨å‡½æ•°ã€‚ä¸é”™ï¼Œä½†æ˜¯*å®é™…*è°ƒè¯•å™¨(`pdb`)æ€ä¹ˆæ ·ï¼Ÿ

è®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„ç¨‹åº(`script.py` ):

```
def func():
    return 0 / 0

func() 
```

ç”¨`python3.8 -i script.py`å’Œ
è¿è¡Œè„šæœ¬

```
# Script crashes... Traceback (most recent call last):
  File "script.py", line 4, in <module>
    func()
  File "script.py", line 2, in func
    return 0 / 0
ZeroDivisionError: division by zero
>>> import pdb
>>> pdb.pm()  # Post-mortem debugger > script.py(2)func()
-> return 0 / 0
(Pdb) 
```

æˆ‘ä»¬çœ‹åˆ°äº†æˆ‘ä»¬å´©æºƒçš„åœ°æ–¹ï¼Œç°åœ¨è®©æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªæ–­ç‚¹:

```
def func():
    breakpoint()  # import pdb; pdb.set_trace()
    return 0 / 0

func() 
```

ç°åœ¨å†è¿è¡Œä¸€æ¬¡:

```
script.py(3)func()
-> return 0 / 0
(Pdb)  # we start here (Pdb) step
ZeroDivisionError: division by zero
> script.py(3)func()
-> return 0 / 0
(Pdb) 
```

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‰“å°è¯­å¥å’Œå›æº¯å¯¹äºè°ƒè¯•æ¥è¯´å·²ç»è¶³å¤Ÿäº†ï¼Œä½†æ˜¯æœ‰æ—¶ï¼Œæ‚¨éœ€è¦å¼€å§‹æ¢ç´¢ï¼Œä»¥äº†è§£ç¨‹åºå†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥è®¾ç½®æ–­ç‚¹ï¼Œå½“æ‚¨è¿è¡Œç¨‹åºæ—¶ï¼Œæ‰§è¡Œå°†åœ¨æ–­ç‚¹å¤„åœæ­¢ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥æ‚¨çš„ç¨‹åºï¼Œä¾‹å¦‚ï¼Œåˆ—å‡ºå‡½æ•°å‚æ•°ã€è®¡ç®—è¡¨è¾¾å¼ã€åˆ—å‡ºå˜é‡æˆ–å¦‚ä¸Šæ‰€ç¤ºå•æ­¥æ‰§è¡Œã€‚`pdb`æ˜¯å…¨åŠŸèƒ½çš„ python shellï¼Œæ‰€ä»¥ä½ å¯ä»¥æ‰§è¡Œä»»ä½•æ–‡å­¦ä½œå“ï¼Œä½†æ˜¯ä½ éœ€è¦ä¸€äº›è°ƒè¯•å™¨å‘½ä»¤ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°

## [](#defining-multiple-constructors-in-a-class)åœ¨ä¸€ä¸ªç±»ä¸­å®šä¹‰å¤šä¸ªæ„é€ å‡½æ•°

ä¸€ä¸ªåœ¨ç¼–ç¨‹è¯­è¨€ä¸­å¾ˆå¸¸è§ï¼Œä½†åœ¨ Python ä¸­ä¸å¸¸è§çš„ç‰¹æ€§æ˜¯å‡½æ•°é‡è½½ã€‚å³ä½¿ä½ ä¸èƒ½é‡è½½æ™®é€šå‡½æ•°ï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨ç±»æ–¹æ³•é‡è½½æ„é€ å‡½æ•°:

```
import datetime

class Date:
    def __init__(self, year, month, day):
        self.year = year
        self.month = month
        self.day = day

    @classmethod
    def today(cls):
        t = datetime.datetime.now()
        return cls(t.year, t.month, t.day) 
```

ä½ å¯èƒ½ä¼šå€¾å‘äºå°†å¤‡é€‰æ„é€ å‡½æ•°çš„æ‰€æœ‰é€»è¾‘æ”¾å…¥`__init__`ä¸­ï¼Œå¹¶ä½¿ç”¨`*args`ã€`**kwargs`å’Œä¸€å †`if`è¯­å¥æ¥è§£å†³å®ƒï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç±»æ–¹æ³•ã€‚è¿™å¯èƒ½è¡Œå¾—é€šï¼Œä½†å¯èƒ½ä¼šå˜å¾—éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ã€‚å› æ­¤ï¼Œæˆ‘å»ºè®®åœ¨`__init__`ä¸­åŠ å…¥å¾ˆå°‘çš„é€»è¾‘ï¼Œå¹¶åœ¨ä¸åŒçš„æ–¹æ³•/æ„é€ å‡½æ•°ä¸­æ‰§è¡Œæ‰€æœ‰çš„æ“ä½œã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯¹äºç±»çš„ç»´æŠ¤è€…å’Œç”¨æˆ·æ¥è¯´ï¼Œä½ å°†å¾—åˆ°å¹²å‡€æ¸…æ™°çš„ä»£ç ã€‚

## [](#caching-function-calls-using-decorator)ä½¿ç”¨è£…é¥°å™¨ç¼“å­˜å‡½æ•°è°ƒç”¨

æ‚¨æ˜¯å¦æ›¾ç»ç¼–å†™è¿‡æ‰§è¡Œæ˜‚è´µçš„ I/O æ“ä½œçš„å‡½æ•°ï¼Œæˆ–è€…å¯ä»¥ä»ç¼“å­˜(å†…å­˜åŒ–)å…¶ç»“æœä¸­è·ç›Šçš„ç›¸å½“æ…¢çš„é€’å½’å‡½æ•°ï¼Ÿ
å¦‚æœä½ è¿™æ ·åšäº†ï¼Œé‚£ä¹ˆä½¿ç”¨`functools` :
ä¸­çš„`lru_cache`æœ‰ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆ

```
from functools import lru_cache
import requests

@lru_cache(maxsize=32)
def get_with_cache(url):
    try:
        r = requests.get(url)
        return r.text
    except:
        return "Not Found"

for url in ["https://google.com/",
            "https://martinheinz.dev/",
            "https://reddit.com/",
            "https://google.com/",
            "https://dev.to/martinheinz",
            "https://google.com/"]:
    get_with_cache(url)

print(get_with_cache.cache_info())
# CacheInfo(hits=2, misses=4, maxsize=32, currsize=4) 
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨ç¼“å­˜ *GET* è¯·æ±‚(æœ€å¤š 32 ä¸ªç¼“å­˜ç»“æœ)ã€‚æ‚¨è¿˜å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`cache_info`æ–¹æ³•æ£€æŸ¥å‡½æ•°çš„ç¼“å­˜ä¿¡æ¯ã€‚è£…é¥°å™¨è¿˜æä¾›äº†ä¸€ä¸ªä½¿ç¼“å­˜ç»“æœæ— æ•ˆçš„`clear_cache`æ–¹æ³•ã€‚æˆ‘è¿˜æƒ³æŒ‡å‡ºï¼Œè¿™ä¸åº”è¯¥ç”¨äºæœ‰å‰¯ä½œç”¨çš„å‡½æ•°æˆ–æ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºå¯å˜å¯¹è±¡çš„å‡½æ•°ã€‚

## [](#find-the-most-frequently-occurring-items-in-a-iterable)æŸ¥æ‰¾ Iterable ä¸­å‡ºç°é¢‘ç‡æœ€é«˜çš„é¡¹ç›®

åœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°æœ€å¸¸è§çš„æ¡ç›®æ˜¯ä¸€é¡¹éå¸¸æ™®é€šçš„ä»»åŠ¡ï¼Œä½ å¯ä»¥ä½¿ç”¨`for`å¾ªç¯å’Œå­—å…¸(map)æ¥å®Œæˆï¼Œä½†æ˜¯è¿™å°†ä¼šæµªè´¹æ—¶é—´ï¼Œå› ä¸ºåœ¨`collections`æ¨¡å—ä¸­æœ‰`Counter`ç±»:

```
from collections import Counter

cheese = ["gouda", "brie", "feta", "cream cheese", "feta", "cheddar", 
          "parmesan", "parmesan", "cheddar", "mozzarella", "cheddar", "gouda",
          "parmesan", "camembert", "emmental", "camembert", "parmesan"]

cheese_count = Counter(cheese)
print(cheese_count.most_common(3))
# Prints: [('parmesan', 4), ('cheddar', 3), ('gouda', 2)] 
```

åœ¨å¼•æ“ç›–ä¸‹ï¼Œ`Counter`åªæ˜¯ä¸€ä¸ªå°†æ¡ç›®æ˜ å°„åˆ°å‡ºç°æ¬¡æ•°çš„å­—å…¸ï¼Œå› æ­¤ä½ å¯ä»¥åƒæ™®é€šçš„`dict` :
ä¸€æ ·ä½¿ç”¨å®ƒ

```
print(cheese_count["mozzarella"])
# Prints: 1 
cheese_count["mozzarella"] += 1 

print(cheese_count["mozzarella"])
# Prints: 2 
```

é™¤æ­¤ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨`update(more_words)`æ–¹æ³•è½»æ¾åœ°å‘è®¡æ•°å™¨æ·»åŠ æ›´å¤šå…ƒç´ ã€‚`Counter`çš„å¦ä¸€ä¸ªå¾ˆé…·çš„ç‰¹æ€§æ˜¯ä½ å¯ä»¥ä½¿ç”¨æ•°å­¦è¿ç®—(åŠ æ³•å’Œå‡æ³•)æ¥ç»„åˆå’Œå‡å»`Counter`çš„å®ä¾‹ã€‚

## [](#conclusion)ç»“è®º

æˆ‘è®¤ä¸ºï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Pythonï¼Œè¿™æ¬¡æˆ‘åœ¨è¿™é‡Œåˆ†äº«çš„å¤§å¤šæ•°æŠ€å·§å‡ ä¹æ¯å¤©éƒ½æœ‰ç”¨ï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›å®ƒä»¬èƒ½æ´¾ä¸Šç”¨åœºã€‚æ­¤å¤–ï¼Œå¦‚æœä½ å¯¹è¿™äº› Python æŠ€å·§å’Œè¯€çªæœ‰ä»»ä½•æƒ³æ³•ï¼Œæˆ–è€…å¦‚æœä½ çŸ¥é“è§£å†³ä¸Šè¿°é—®é¢˜çš„ä»»ä½•æ›´å¥½çš„æ–¹æ³•ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼ğŸ™‚