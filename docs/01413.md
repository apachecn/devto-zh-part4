# ä» Node.js åº”ç”¨ç¨‹åºå‘é€å’Œå®‰æ’ç”µå­é‚®ä»¶

> åŸæ–‡:[https://dev . to/ATA pas/send-and-schedule-emails-from-a-node-js-app-30p 3](https://dev.to/atapas/send-and-schedule-e-mails-from-a-node-js-app-30p3)

ä½œä¸ºä¸€ååº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬æœ‰å¤šé¢‘ç¹åœ°æ„Ÿè§‰åˆ°éœ€è¦ä¸€ä¸ªæœåŠ¡æ¥å‘æŒ‡å®šçš„æˆ–è®¢é˜…çš„ç”µå­é‚®ä»¶ id å‘é€ç”µå­é‚®ä»¶ï¼Ÿå³ä½¿æ²¡æœ‰çœŸæ­£çš„éœ€è¦ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šåœ¨å¼€å‘å® ç‰©é¡¹ç›®æˆ–åº”ç”¨ç¨‹åºæ—¶å¹»æƒ³å®ƒï¼Œä¸æ˜¯å—ğŸ˜ï¼Ÿ

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è§£é‡Šä» node.js åº”ç”¨ç¨‹åºå‘é€ç”µå­é‚®ä»¶çš„ç®€å•æ­¥éª¤ã€‚æœ€åï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿå®‰æ’å’Œå‘é€ç”µå­é‚®ä»¶ã€‚ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜å°†åˆ›å»ºä¸€ä¸ª REST APIï¼Œå°†æ‰€éœ€çš„è¯¦ç»†ä¿¡æ¯å‘å¸ƒåˆ° node.js åº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿å‘é€ç”µå­é‚®ä»¶ã€‚

**TLï¼›**
åšå£«è¿™é‡Œæ˜¯å·¥ä½œ app
[![action.gif](img/2adab6df974b61f3858d3f65f6c2b24b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--rzs_tRL_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1568559587037/mYahNkH_i.gif)
*REST API ä»ä¸€ä¸ª node.js app*

ä½ å¯ä»¥ä»æˆ‘çš„ GitHub Repo ä¸­æ‰¾åˆ°ä»£ç :[æµ‹è¯• REST app å‘é€é‚®ä»¶](https://github.com/atapas/test-rest-app)

# [](#setting-the-stage)è®¾ç½®èˆå°

Nodemailer æ˜¯ Node.js åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªè¶…çº§é…·çš„æ¨¡å—ï¼Œè®©ç”µå­é‚®ä»¶å‘é€å˜å¾—å¦‚æ­¤ç®€å•ã€‚ä½¿ç”¨`npm`
å®‰è£…

```
npm install nodemailer --save 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ä½ çš„`.js` (app.jsï¼Œemail.js éšä¾¿ä»€ä¹ˆ)æ–‡ä»¶ä¸­å¯¼å…¥`Nodemailer`:

```
let nodemailer = require('nodemailer'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œéµå¾ªè¿™ä¸‰ä¸ªç®€å•çš„æ­¥éª¤æ¥è®©äº‹æƒ…è¿è½¬èµ·æ¥:

*   è®¾ç½®ä¸€ä¸ªæ¶ˆæ¯é€‰é¡¹:è¿™æ˜¯å‘Šè¯‰`Nodemailer` *è°*åœ¨ç»™*å‘é€ä»€ä¹ˆ*æ¶ˆæ¯ç»™*è°*ï¼Ÿ

```
 let mailOptions = {
        from: '<FROM_EMAIL_ADDRESS>',
        to: '<TO_EMAIL_ADDRESS>',
        subject: 'Email from Node-App: A Test Message!',
        text: 'Some content to send'
  }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ğŸ‘‰æ³¨æ„:ä¸Šé¢çš„`to`å±æ€§å¯ä»¥æœ‰å¤šä¸ªç”¨é€—å·(ï¼Œ)åˆ†éš”çš„ç”µå­é‚®ä»¶ idã€‚

*   ä½¿ç”¨ SMTP(è¿™æ˜¯é»˜è®¤è®¾ç½®)æˆ–å…¶ä»–ä¼ è¾“æœºåˆ¶[åˆ›å»ºä¸€ä¸ª`Nodemailer` *ä¼ è¾“å™¨*](https://nodemailer.com/transports/)

```
 let transporter = nodemailer.createTransport({
        service: 'gmail',
        auth: {
          user: '<FROM_EMAIL_ADDRESS>',
          pass: '<FROM_EMAIL_PASSWORD>'
        }
  }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ğŸ‘‰æ³¨æ„:åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ`service`è¢«ç§°ä¸º`gmail`ã€‚è¿™åªæ˜¯ä¸€ä¸ªä¾‹å­ã€‚æ‚¨å¯ä»¥æŒ‡å®šæƒ³è¦å®é™…ä½¿ç”¨çš„ç”µå­é‚®ä»¶æœåŠ¡çš„åç§°ã€‚

*   ä½¿ç”¨æ‚¨ä¹‹å‰åˆ›å»ºçš„ä¼ é€å™¨çš„`sendMail()`æ–¹æ³•æ¥ä¼ é€’æ¶ˆæ¯ã€‚

```
 transporter.sendMail(mailOptions, function(error, info){
        if (error) {
          console.log(error);
        } else {
          console.log('Email sent: ' + info.response);
        }
  }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±è¿™æ ·ï¼Œä½ å®Œäº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å…·å¤‡äº†ä» node.js åº”ç”¨ç¨‹åºå‘é€ç”µå­é‚®ä»¶æ‰€éœ€çš„ä¸€åˆ‡ã€‚

# [](#hang-on-a-minute-we-can-schedule-it)ç­‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å®‰æ’ä¸€ä¸‹ï¼

æ˜¯å•Šï¼Œæ²¡é”™ï¼è¿™ä¸ªåº”ç”¨ç¨‹åºçš„çœŸæ­£å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œä½ å¯ä»¥å®‰æ’ç”µå­é‚®ä»¶ï¼Œ

*   ç«‹å³å‘é€
*   æ¯å¤©ä¸‹åˆ 7 ç‚¹(19:00)å‘é€ï¼Œå°±åƒæ¯æ—¥æ–‡æ‘˜ä¸€æ ·
*   æ¯ 30 åˆ†é’Ÿå‘é€ä¸€æ¬¡ã€‚
*   2 æœˆ 29 æ—¥å‘é€ï¼
*   ....æ›´å¤šæ›´å¤šæƒ³è¦çš„æ–¹å¼ã€‚

ä½ çŒœå¯¹äº†ï¼Œæˆ‘ä»¬éœ€è¦ç±»ä¼¼ cron ä½œä¸šçš„ä¸œè¥¿ï¼Œä¸ºæ­¤æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸º [node-cron](https://www.npmjs.com/package/node-cron) çš„èŠ‚ç‚¹æ¨¡å—ã€‚

*   é¦–å…ˆå®‰è£…å®ƒã€‚

```
 node install node-cron --save 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   å¯¼å…¥`node-cron`å¹¶å®‰æ’ä»»åŠ¡

```
 let cron = require('node-cron');

 cron.schedule('* * * * *', () => {
     console.log('running a task every minute');
  }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ğŸ‘‰æ³¨æ„:ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»å‡ ä¸ª cron è°ƒåº¦æ¨¡å¼ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å·²ç»è®¡åˆ’äº†æ¯åˆ†é’Ÿä¸€æ¬¡ç®€å•çš„æ§åˆ¶å°æ—¥å¿—ã€‚

ä¸‹é¢æ˜¯æˆ‘å®‰æ’ç”µå­é‚®ä»¶æ¯åˆ†é’Ÿå‘é€çš„ç»„åˆä»£ç :

```
 let cron = require('node-cron');
  let nodemailer = require('nodemailer');

  // e-mail message options
  let mailOptions = {
        from: '<FROM_EMAIL_ADDRESS>',
        to: '<TO_EMAIL_ADDRESS>',
        subject: 'Email from Node-App: A Test Message!',
        text: 'Some content to send'
   };

  // e-mail transport configuration
  let transporter = nodemailer.createTransport({
        service: 'gmail',
        auth: {
          user: '<FROM_EMAIL_ADDRESS>',
          pass: '<FROM_EMAIL_PASSWORD>'
        }
    });

 cron.schedule('* * * * *', () => {
  // Send e-mail
  transporter.sendMail(mailOptions, function(error, info){
        if (error) {
          console.log(error);
        } else {
          console.log('Email sent: ' + info.response);
        }
    });
  }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¡”è¾¾ï¼Œå®Œæˆäº†ï¼

[![sent.gif](img/79f6e2f9b019feaaaa9e25b4de38d7fd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--cyhAAQnh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1568562815375/1hnouwcyL.gif)

# [](#rest-api-to-schedule-and-send-email)REST API æ¥è°ƒåº¦å’Œå‘é€é‚®ä»¶

å¦‚æœæ‚¨å¯¹åˆ›å»ºä¸€ä¸ªç”¨äºè°ƒåº¦å’Œå‘é€ç”µå­é‚®ä»¶çš„ REST API ä¸æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„éƒ¨åˆ†ã€‚å¦‚æœä½ ä»‹æ„çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [sails.js](https://sailsjs.com/) åœ¨ä¸€åˆ†é’Ÿå†…å®Œæˆã€‚æˆ‘åœ¨ Heroku ä¸Šå‘è¿‡ä¸€ç¯‡å…³äº *[å¦‚ä½•éƒ¨ç½²ä½ çš„ Sails.js appï¼Œæ´»å¾—æ›´ä¹…](https://blog.greenroots.info/how-to-deploy-your-sailsjs-app-on-heroku-and-live-longer-cjzv8igb2001m6vs1qhg5pdnt)* çš„æ–‡ç« ã€‚å¿«é€Ÿçœ‹ä¸€ä¸‹ã€‚

*   åœ¨ sails.js åº”ç”¨ç¨‹åºçš„`routes.js`æ–‡ä»¶ä¸­åˆ›å»ºä¸€æ¡è·¯çº¿

```
 'post /api/sendemail': 'EmailController.sendEmail' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   ç”¨`sendEmail`æ–¹æ³•åˆ›å»ºä¸€ä¸ª`EmailController`ã€‚è¿™ä¸ªæ–¹æ³•åº”è¯¥å…·æœ‰ä¸Šé¢è®¨è®ºçš„ç”¨äºå®‰æ’å’Œå‘é€ç”µå­é‚®ä»¶çš„ä»£ç ã€‚

å“‡ï¼ŒçœŸå¿«ï¼Œä¸æ˜¯å—ï¼Ÿ

ğŸ‘‰æ³¨æ„:ä½¿ç”¨ sails.jsï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»– cron åº“ï¼Œæ¯”å¦‚`sails-hook-cron`ã€‚è¯¦æƒ…å¯ä»¥åœ¨[è¿™é‡Œ](https://www.npmjs.com/package/sails-hook-cron)æ‰¾åˆ°ã€‚

* * *

å¦‚æœè¿™å¯¹ä½ æœ‰ç”¨ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚

è¯·éšæ„è¯„è®ºæ‚¨å¯èƒ½ç”¨äºç›¸åŒç›®çš„çš„æ›¿ä»£æ–¹å¼å’Œæ–¹æ³•ï¼Œå³ä» node.js ap å®‰æ’å’Œå‘é€ç”µå­é‚®ä»¶ã€‚