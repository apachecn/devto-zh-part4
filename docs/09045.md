# ç”¨ JavaScript +æœ‰è¶£çš„è¯­è¨€ API ç¼–å†™çš„è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼æ•™ç¨‹

> åŸæ–‡:[https://dev . to/erikwhiting 88/observer-design-pattern-tutorial-in-JavaScript-fun-with-a-language-API-2103](https://dev.to/erikwhiting88/observer-design-pattern-tutorial-in-javascript-fun-with-a-language-api-21o3)

ã€2021 å¹´ 4 æœˆæ›´æ–°: *å‘å¸ƒæˆ‘åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„ API å¯†é’¥çš„ç½‘ç«™å·²ç»ä¸å†æä¾›å…è´¹çš„ API å¯†é’¥ï¼Œè¿™é‡Œçš„ä¾‹å­å°±ä¸ç®¡ç”¨äº†ã€‚éå¸¸æŠ±æ­‰*:(

å¤§å®¶å¥½ï¼Œè°¢è°¢ä½ ç‚¹å‡»è¿™ç¯‡æ–‡ç« ã€‚æˆ‘å¯¹æˆ‘ä»¬ä»Šå¤©çš„æ•™ç¨‹æ„Ÿåˆ°éå¸¸å…´å¥‹ï¼Œå› ä¸ºå®ƒç»“åˆäº†æˆ‘æœ€å–œæ¬¢çš„ä¸¤æ ·ä¸œè¥¿:ç¼–ç¨‹å’Œè¯­è¨€(å£è¯­)ã€‚

æˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ç”¨ JavaScript å®ç°â€œè§‚å¯Ÿè€…â€è®¾è®¡æ¨¡å¼ï¼Œç„¶åæˆ‘å°†å±•ç¤ºå®ƒåœ¨ä¸€ä¸ª web é¡¹ç›®ä¸­çš„ç”¨é€”ã€‚**æˆ‘ä»¬ 1000%é¼“åŠ±ä½ é‡‡ç”¨è¿™æ®µä»£ç ï¼Œè°ƒæ•´å®ƒï¼Œä½¿å®ƒæˆä¸ºä½ è‡ªå·±çš„ä»£ç ï¼Œå¹¶åœ¨ä½ çš„æ–‡ä»¶å¤¹ä¸­å±•ç¤ºå®ƒ**ï¼Œå› ä¸ºå¦‚æœæˆ‘è‡ªå·±è¿™ä¹ˆè¯´çš„è¯ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆäº§å“ä¼šéå¸¸é…·ã€‚([è¿™ä¸ª](http://erikwhiting.com/newsOutlet/)å°±æ˜¯æˆ‘ä»¬è¦åšçš„)

ä»Šå¤©çš„æ—¥ç¨‹å¦‚ä¸‹:

*   å¿«é€Ÿè¯´è¯´*æ˜¯ä»€ä¹ˆ*æ˜¯è§‚å¯Ÿè€…æ¨¡å¼
*   è°ˆè°ˆæˆ‘ä»¬å°†å¦‚ä½•ç”¨ JavaScript å®ç°å®ƒ
*   `The code`
*   æˆ‘ä»¬å°†ä½•å»ä½•ä»ï¼Ÿ

# [](#what-is)ä»€ä¹ˆæ˜¯...

## [](#a-design-pattern)..ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Ÿ

åœ¨ç¼–ç¨‹ä¸­ï¼Œè®¾è®¡æ¨¡å¼æ˜¯æˆ‘ä»¬ç»å¸¸é‡åˆ°çš„é—®é¢˜çš„å¯é è§£å†³æ–¹æ¡ˆã€‚æ ¹æ®è€ç»´åŸºç™¾ç§‘ï¼Œä»–ä»¬æ˜¯

> ...ç¨‹åºå‘˜åœ¨è®¾è®¡åº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿæ—¶å¯ä»¥ç”¨æ¥è§£å†³å¸¸è§é—®é¢˜çš„æ­£å¼çš„æœ€ä½³å®è·µ

## [](#the-observer-pattern)..è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ

è§‚å¯Ÿè€…æ¨¡å¼æ˜¯å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯¹è±¡æ§åˆ¶ä¸€ä¸ªè®¢é˜…è€…åˆ—è¡¨æ—¶ã€‚å®˜æ–¹è¯´æ³•æ˜¯ï¼Œæˆ‘ä»¬å°†è®¢é˜…æ§åˆ¶å¯¹è±¡ç§°ä¸ºâ€œä¸»ä½“â€ï¼Œå°†è®¢é˜…è€…ç§°ä¸ºâ€œè§‚å¯Ÿè€…â€

ä¸¾ä¸€ä¸ªç®€å•è€Œæ·¡åŒ–çš„ä¾‹å­ï¼Œæƒ³æƒ³æ–°é—»æœºæ„ BBCã€‚BBC ä¼šä»å„åœ°è·å–æ–°é—»ï¼Œç„¶åæœŸå¾…ä»–ä»¬ä¸åŒçš„ç½‘ç»œå¯¹æ­¤è¿›è¡ŒæŠ¥é“ã€‚ä»–ä»¬ç”¨è‹±è¯­æŠ¥é“ BBC ä¸–ç•Œæ–°é—»ï¼Œç”¨é˜¿æ‹‰ä¼¯è¯­æŠ¥é“ BBC é˜¿æ‹‰ä¼¯è¯­ï¼Œç”¨è‘¡è„ç‰™è¯­æŠ¥é“ BBC å·´è¥¿æ–°é—»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‹±å›½å¹¿æ’­å…¬å¸ä½œä¸ºä¸€ä¸ªæ•´ä½“å°†æ˜¯ä¸»é¢˜ï¼Œè§‚å¯Ÿå‘˜å°†æ˜¯å„ç§ç½‘ç»œ(ä¸–ç•ŒæœåŠ¡ï¼Œé˜¿æ‹‰ä¼¯è¯­ï¼Œå·´è¥¿)ã€‚

# [](#what-are-we-going-to-do)æˆ‘ä»¬è¦åšä»€ä¹ˆï¼Ÿ

å¾ˆé«˜å…´ä½ é—®äº†ï¼æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ª JavaScript ç±»ï¼Œ`News`æˆ‘ä»¬çš„ä¸»é¢˜ï¼Œ`NewsOutlet`æˆ‘ä»¬çš„è§‚å¯Ÿè€…ã€‚æˆ‘ä»¬å°†å®ä¾‹åŒ–ä¸€ä¸ªæ–°é—»å¯¹è±¡å’Œä¸‰ä¸ªè§‚å¯Ÿè€…ï¼Œå°†è§‚å¯Ÿè€…æ·»åŠ åˆ°ä¸»é¢˜çš„è®¢é˜…è€…åˆ—è¡¨ä¸­ï¼Œå¹¶é€šè¿‡ä¸»é¢˜å°†æ•°æ®ä¼ è¾“ç»™æ‰€æœ‰è§‚å¯Ÿè€…ï¼Œå°†å…¶ç¿»è¯‘æˆä¸åŒçš„è¯­è¨€ï¼Œå¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚

å¬èµ·æ¥å¾ˆå›°æƒ‘ï¼Ÿæˆ‘å‘ä½ ä¿è¯ï¼Œä¸æ˜¯çš„ã€‚è®©æˆ‘ä»¬å¼€å§‹ç¼–ç å§ï¼Œä½ ä¼šçœ‹åˆ°çš„ã€‚

# [](#javascript)JavaScript â¤ï¸

## [](#the-subject)ä¸»è¯­

é¦–å…ˆï¼Œæˆ‘ä»¬çš„ä¸»é¢˜ï¼Œæˆ‘ä»¬å°†å…¶å‘½åä¸ºâ€œæ–°é—»â€:

```
// The news class is the Observable class or "subject"
class News {
  // A list of observers
  constructor() {
    this.observers = [];
  }

  // Method for subscribing to, or "observing" observable
  addSubscriber(subscriber) {
    this.observers.push(subscriber);
  }

  // Method for unsubscribing from observable
  unsubscribe(subscriber) {
    var index = this.observers.indexOf(subscriber);
    this.observers.splice(index, index);
  }

  // Method for sending data to subsribers
  transmit(data) {
    this.observers.forEach(subscriber => subscriber.receive(data));
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½äº†ï¼Œè®©æˆ‘ä»¬ä¸€ä¸ªæ–¹æ³•ä¸€ä¸ªæ–¹æ³•åœ°è®¨è®ºè¿™ä¸ªæ–¹æ³•:

*   è¿™é‡Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³ç¡®ä¿å½“æ–°é—»è¢«åˆ›å»ºæ—¶ï¼Œå®ƒæœ‰ä¸€ç³»åˆ—çš„è§‚å¯Ÿè€…ã€‚æˆ‘ä»¬ç¨åä¼šæ·»åŠ å®ƒä»¬ã€‚

*   è¿™æ˜¯æ­£å¼è®©è§‚å¯Ÿè€…è®¢é˜…è¯¥ä¸»é¢˜çš„æ–¹æ³•ã€‚æ·»åŠ è®¢æˆ·çš„è¯­æ³•ç±»ä¼¼äº`Subject.addSubscriber(observer)`

*   `unsubscribe` -ä¸ç”¨è¯´ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼ é€’ç»™è¿™ä¸ªå‡½æ•°çš„è§‚å¯Ÿè€…å°†åœæ­¢ä»ä¸»ä½“è·å–æ•°æ®ã€‚

*   è¿™å°±æ˜¯æ•°æ®å¦‚ä½•ä¼ é€’ç»™è§‚å¯Ÿè€…çš„ã€‚è¿™ä¸ªæ–¹æ³•éå†ä¸»é¢˜çš„è§‚å¯Ÿè€…æ•°ç»„ï¼Œå¹¶è°ƒç”¨è§‚å¯Ÿè€…çš„`receive`æ–¹æ³•ã€‚æ˜¾ç„¶ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬*å¿…é¡»*ç»™è§‚å¯Ÿè€…ç±»ä¸€ä¸ª`receive`æ–¹æ³•ã€‚

å› æ­¤ï¼Œç®€è€Œè¨€ä¹‹ï¼Œè¿™æ˜¯æˆ‘ä»¬è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ä¸ªéå¸¸åŸºæœ¬çš„ä¸»é¢˜ã€‚ç°åœ¨è®©æˆ‘ä»¬å®šä¹‰ç»„æˆæˆ‘ä»¬çš„è§‚å¯Ÿè€…çš„ç±»ã€‚

## [](#the-observer)è§‚å¯Ÿè€…

è¿™æ˜¯æˆ‘ä»¬çš„è§‚å¯Ÿè€…â€œNewsOutletâ€çš„ä»£ç ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªæ–¹æ³•æ¥ä¸€ä¸ªæ–¹æ³•åœ°æŸ¥çœ‹

```
// The News Outlets are subscribers to the news in different languages
class NewsOutlet {
    // We will set the language when we instantiate the news outlet
    constructor(language = "en") {
        this.language = language;
        this.data = "";
        this.news = "";
        // For this example we'll use my API key, but please go to 
        // https://yandex.com/ and sign up to get your own
        this.apiKey = "trnsl.1.1.20190807T020501Z.f95163fde699ac87.1f9b3df7b5d7c045104d21249dc322086ee38004";
        this.translateUrl = "https://translate.yandex.net/api/v1.5/tr.json/translate";
    }

    receive(data) {
        this.data = data;
        var urlParamList = "?";
        urlParamList += "key=" + this.apiKey;
        urlParamList += "&text=" + this.data;
        urlParamList += "&lang=" + this.language;
        var self = this;

        // Translate after receiving
        jQuery.ajax({
         url: this.translateUrl + urlParamList,
         contenttype: "application/json",
         datatype: "json",
         success: function(result) {
            self.news = result.text[0];
            self.reportTheNews();
         }
        });

    }

    reportTheNews() {
        // A shady workaround for our HTML efforts!
        let elemId = this.language + "1";
        document.getElementById(elemId).innerText = this.news;
    }

} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½å§ï¼è¿™é‡Œæœ‰å¾ˆå¤šä¸œè¥¿è¦æ‰“å¼€ï¼Œæ‰€ä»¥æˆ‘ä»¬æ…¢æ…¢æ¥ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Yandex API è¿›è¡Œç¿»è¯‘ã€‚è¯·å»[https://yandex.com](https://yandex.com)è·å–ä½ è‡ªå·±çš„ API å¯†åŒ™ï¼Œå¹¶åœ¨ä½ è¿è¡Œè¿™ä¸ªå¤ªå¤šæ¬¡ä¹‹å‰åœ¨é‚£é‡Œä¸æˆ‘çš„äº¤æ¢ã€‚å…è´¹çš„ï¼

*   å¯¹äºè§‚å¯Ÿè€…æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨å®ä¾‹åŒ–ä»–ä»¬çš„æ—¶å€™ä¼šç»™ä»–ä»¬ä¸€ç§è¯­è¨€ã€‚æˆ‘ä»¬å¿…é¡»å°† ISO è¯­è¨€ä»£ç ä¼ é€’ç»™ API æ¥å®Œæˆè¿™é¡¹å·¥ä½œ([è¿™é‡Œçš„](https://www.sitepoint.com/iso-2-letter-language-codes/)æ˜¯æ‰€æœ‰å—æ”¯æŒè¯­è¨€çš„åˆ—è¡¨)ã€‚â€œenâ€æ˜¯è‹±æ–‡ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬çš„é»˜è®¤ã€‚æˆ‘ä»¬æ­£åœ¨åˆ¶ä½œåä¸º`data`(æ¥è‡ªæˆ‘ä»¬ä¸»é¢˜çš„æ•°æ®)å’Œ`news`(ç¿»è¯‘æ•°æ®)çš„å®ä¾‹å˜é‡ã€‚æœ€åï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å°† API é”®å’Œç¿»è¯‘ API URL æ”¾åœ¨å®ä¾‹å˜é‡ä¸­ã€‚

*   è¿˜è®°å¾—åœ¨æ–°é—»è¯¾ä¸Šï¼Œæˆ‘ä»¬çš„`transmit`æ–¹æ³•è°ƒç”¨æˆ‘ä»¬æ‰€æœ‰è§‚å¯Ÿè€…çš„`receive`æ–¹æ³•å—ï¼Ÿè¿™å°±æ˜¯äº†ã€‚è¿™ç§æ–¹æ³•é¦–å…ˆä»å¯¹è±¡è·å–ä¼ è¾“çš„æ•°æ®ï¼Œå¹¶å°†å…¶æ”¾å…¥è‡ªå·±çš„æ•°æ®å˜é‡ä¸­ã€‚ç„¶åï¼Œå®ƒæ„å»ºå®Œæ•´çš„ API URLï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥ç¿»è¯‘ä¼ è¾“çš„æ•°æ®ã€‚

*   ç¬¬`jQuery.ajax`éƒ¨åˆ†â€”â€”è¿™æ˜¯ä½¿ç”¨å…¬å…± API çš„ä¸€ä¸ªéå¸¸åŸºæœ¬çš„æ–¹æ³•ã€‚æˆ‘ä»¬åˆ†é… URLã€å†…å®¹ç±»å‹å’Œæ•°æ®ç±»å‹ï¼Œç„¶åè¯´åœ¨æˆåŠŸè°ƒç”¨ API ä¹‹åéœ€è¦å‘ç”Ÿä»€ä¹ˆã€‚æ³¨æ„è¿™ä¸ªå‡½æ•°å‰é¢çš„`var self = this;`ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯å› ä¸º`this`åœ¨ ajax å‡½æ•°ä¸­ä¸å¯ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨`self`ã€‚ä¸è¦è®©è¿™è®©ä½ å›°æƒ‘ï¼Œåœ¨æŸäº›è¯­è¨€ä¸­`self`æ˜¯ä¸€ä¸ªä¿ç•™å­—ã€‚ä¸æ˜¯åœ¨ JavaScript ä¸­ï¼Œä½ å¯ä»¥éšæ„è°ƒç”¨è¿™ä¸ªå˜é‡ã€‚æ— è®ºå¦‚ä½•ï¼Œä¸€æ—¦ API è°ƒç”¨æˆåŠŸè¿”å›ï¼Œå®ƒä¼šå°†`news`å®ä¾‹å˜é‡è®¾ç½®ä¸ºè¿”å›çš„`result.text`å¯¹è±¡çš„ç¬¬ä¸€ä¸ªå…ƒç´ (çœ‹èµ·æ¥åƒ`["this is the text returned in an array for some reason"]`)ã€‚æœ€åï¼Œå®ƒå°†è°ƒç”¨`reportTheNews`æ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡è¯„è®ºçœ‹åˆ°ï¼Œè¿™ä¸æ˜¯æˆ‘è¶…çº§è‡ªè±ªçš„ä¸œè¥¿ã€‚

*   `reportTheNews` -å½“æˆ‘ä»¬ç¨ååœ¨ HTML ä¸­å±•ç¤ºæ—¶ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€äº›`div`å…ƒç´ æ˜¾ç¤ºæ–°é—»ã€‚å¦‚æœä½ æƒ³åœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°ç»“æœï¼Œå°±åƒè¿™æ ·ä¿®æ”¹å‡½æ•°:

```
reportTheNews() {
    console.log(this.news);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#almost-done-lets-recap)å¿«å¥½äº†ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹

æ­¤æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šå·²ç»æ„å»ºäº†æˆ‘ä»¬çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚å¦‚æœä½ æƒ³çœ‹åˆ°æ•´ä¸ªäº‹æƒ…çš„è¿è¡Œï¼Œç¡®ä¿åƒä¸Šé¢æ˜¾ç¤ºçš„é‚£æ ·åˆ‡æ¢`reportTheNews`ä¸­çš„ä»£ç ï¼Œå¹¶å°†å…¶å†™å…¥ä½ çš„æ§åˆ¶å°:

```
let news = new News;
let enOutlet = new NewsOutlet("en");
let ptOutlet = new NewsOutlet("pt");
let arOutlet = new NewsOutlet("ar"); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™äº›çº¿åˆ›å»ºäº†æˆ‘ä»¬çš„ä¸»é¢˜`news`å’Œè§‚å¯Ÿè€…`enOutlet`ã€`ptOutlet`å’Œ`arOutlet`ã€‚è®©æˆ‘ä»¬çš„ç»é”€åº—è®¢é˜…:

```
news.addSubscriber(enOutlet);
news.addSubscriber(ptOutlet);
news.addSubscriber(arOutlet); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†ã€‚å†³å®šä½ å¸Œæœ›ç¬¬ä¸€ä¸ªæ ‡é¢˜æ˜¯ä»€ä¹ˆã€‚æˆ‘çš„å°†æ˜¯â€œåŸƒé‡Œå…‹æ˜¯æœ€æ£’çš„â€

```
> news.transmit("Erik is the best")
< undefined
  Erik is the best
  Ø¥Ø±ÙŠÙƒ Ù‡Ùˆ Ø£ÙØ¶Ù„
  Erik Ã© o melhor 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±å«æˆ‘ç¯çƒå…ˆç”Ÿå§ğŸ˜

å°±æ˜¯è¿™æ ·ï¼è¿™å°±æ˜¯è§‚å¯Ÿè€…çš„æ¨¡å¼ã€‚æˆ‘ä»¬é€šè¿‡ä¸»é¢˜(æœ¬ä¾‹ä¸­ä¸º`news`)å°†æ•°æ®ä¼ è¾“ç»™è®¢æˆ·(3 ä¸ª`**Outlet`å˜é‡)ã€‚

ç°åœ¨ï¼Œæˆ‘å°†æŠŠå®ƒæ”¾å…¥ä¸€äº›æœ‰ä»·å€¼çš„ä¸œè¥¿ä¸­ï¼Œéå¸¸æ¬¢è¿ä½ è·Ÿéšã€‚ä½†æ˜¯ä¸ºäº†â€œå­¦ä¹ è§‚å¯Ÿè€…æ¨¡å¼â€ï¼Œä½ å®Œäº†ï¼æ­å–œä½ ï¼Œç›´æ¥è·³åˆ°â€œæˆ‘ä»¬å°†ä½•å»ä½•ä»ï¼Ÿâ€éƒ¨åˆ†

# [](#live-demo)ç°åœºè¯•ç©ï¼

å‡†å¤‡å¥½å°†æˆ‘ä»¬æ‰€å­¦ä»˜è¯¸å®è·µäº†å—ï¼Ÿè¿™æ˜¯æˆ‘ä»¬å°†è¦å»ºé€ çš„:

*   [ç°åœºæ¼”ç¤º](http://erikwhiting.com/newsOutlet/)
*   [Github å›è´­](https://github.com/erik-whiting/JsObserverDemo)

## [](#implementing-the-observer-pattern-like-the-demo-above)åƒä¸Šé¢çš„æ¼”ç¤ºä¸€æ ·å®ç°è§‚å¯Ÿè€…æ¨¡å¼

è®©æˆ‘ä»¬å¼€å§‹å§ã€‚é¦–å…ˆï¼Œå¦‚æœæ‚¨åˆ‡æ¢äº†`reportTheNews`åŠŸèƒ½ï¼Œè¯·å°†å…¶åˆ‡æ¢å›

```
 reportTheNews() {
        // A shady workaround for our HTML efforts!
        let elemId = this.language + "1";
        document.getElementById(elemId).innerText = this.news;
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°†åœ¨åˆ¶ä½œå®Œ HTML é¡µé¢åä½¿ç”¨å®ƒã€‚ä¹‹æ‰€ä»¥ä»¥è¿‚å›çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œæ˜¯å› ä¸º ajax æœ‰æ—¶çš„è¡Œä¸ºæ–¹å¼ã€‚æˆ‘ä¸ä¼šæ·±å…¥è®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºè¿™ä¸ªé¡¹ç›®å¹¶ä¸æ˜¯ä¸€ä¸ªä¼˜ç§€ ajax ä½œå“çš„èŒƒä¾‹ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç»§ç»­ã€‚

## HTML éƒ¨åˆ†

è®©æˆ‘ä»¬åšä¸€ä¸ªè¾“å…¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè¾“å…¥æˆ‘ä»¬çš„æ–°é—»ï¼Œä¸€ä¸ªå‘é€å®ƒçš„æŒ‰é’®ï¼Œä»¥åŠä¸€äº›å‘æˆ‘ä»¬æ˜¾ç¤ºä¸åŒåª’ä½“åœ¨è¯´ä»€ä¹ˆçš„ä¸œè¥¿:

```
<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="News.js"></script>
        <script src="NewsOutlet.js"></script>
        <script src="implement.js"></script>
    </head>
    <body onload="defaultBreaking()">
        <h2 id="pageTitle">The World News</h2>
        <h3>JavaScript implementation of the Observer Pattern</h3>

        <div class="worldNews">
            <div>
                What's the news??
            </div>
            <div>
                <input type="text" id="sourceNews">
            </div>
                <button onclick="sendNews()" id="transmitter">Transmit!</button>
            <div>
            </div>
        </div>

        <div class="row">
            <div class="column" id="enOutlet">
                <div class="newsTitle">The US Gazette</div>
                <div id="en1" class="breaking"></div>
            </div>
            <div class="column" id="ptOutlet">
                <div class="newsTitle">The Portugal Post</div>
                <div id="pt1" class="breaking"></div>
            </div>
            <div class="column" id="arOutlet">
                <div class="newsTitle">The Halab Herald</div>
                <div id="ar1" class="breaking"></div>
            </div>
        </div>

        <div class="footer" id="Yandex">
            All translation Powered by <a href="https://translate.yandex.com/">Yandex</a>
        </div>
        <div class="footer">
            <p>by Erik Whiting</p>
        </div>

    </body>
</html> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¤åˆ¶/ç²˜è´´ï¼Œæ‚¨å¿…é¡»å°†æˆ‘ä»¬æ­£åœ¨åˆ›å»ºçš„å…¶ä»–æ–‡ä»¶å‘½åä¸ºä¸æˆ‘ç›¸åŒçš„åç§°:

*   `style.css`
*   `News.js`
*   `NewsOutlet.js`
*   (æˆ‘ä»¬è¿˜æ²¡åšè¿™ä¸ª)

## CSS

*æ—æ³¨*æˆ‘çœŸçš„å¾ˆè®¨åŒ CSSï¼Œä½†æˆ‘æ­£åœ¨åŠªåŠ›å˜å¾—æ›´å¥½ã€‚æˆ‘ç»å¯¹ä¸æ˜¯è®¾è®¡å¸ˆï¼Œæ‰€ä»¥ä¸è¦å˜²ç¬‘æˆ‘:

```
* {
  box-sizing: border-box;
}

body, h2, p {
  font-family: Courier, sans-serif;
}

#pageTitle {
  font-size: 50px;
}

.worldNews {
  background-color: #262626;
  color: white;
  padding: 30px;
  text-align: center;
  font-size: 35px;
  border: 1px solid black;
  border-radius: 8px;
}

button {
  background-color: orange;
  font-family: Courier;
  font-color: black;
  font-size: 20px;
  width: 400px;
}

input {
  width: 400px;
  height: 40px;
  font-size: 30px;
}

.column {
  float: left;
  width: 33.33%;
  padding: 10px;
  height: 300px;
  border-radius: 8px;
  border: 1px solid black;
}

.newsTitle {
  width: 100%;
  text-align: center;
}

.breaking {
  text-align: left;
  font-size: 20px;
  border: 1px solid;
  border-radius: 8px;
  padding: 5px;
  margin: 2px;
}

#enOutlet {
  color: white;
  background-color: #820400;
}

#enOutlet > .breaking {
  background-color: #fc6f6a;
}

#ptOutlet {
  color: black;
  background-color: #008c00;
}

#ptOutlet > .breaking {
  background-color: #78f580;
}

#arOutlet {
  color: white;
  background-color: #000485;
}

#arOutlet > .breaking {
  background-color: #515cfc;
}

.newsTitle {
  font-size: 20px;
}

.row:after {
  content: "";
  display: table;
  clear: both;
}

.footer {
  background-color: #f1f1f1;
  padding: 10px;
  text-align: left;
}

@media (max-width: 600px) {
  .column {
    width: 100%;
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ æƒ³æŠŠå®ƒå˜æˆä½ è‡ªå·±çš„é¡¹ç›®ï¼Œè¯•è¯•å®ƒçš„æ ¼å¼å’Œé¢œè‰²ï¼Œè®©å®ƒæˆä¸ºä½ è‡ªå·±çš„ï¼Œå‘äººä»¬å±•ç¤ºä½ è‰ºæœ¯çš„ä¸€é¢ï¼

## [](#the-script-that-ties-it-together)æŠŠå®ƒè”ç³»åœ¨ä¸€èµ·çš„è„šæœ¬

å¥½äº†ï¼Œæœ€åä¸€ä»¶äº‹æ˜¯æœ€åä¸€ä»¶äº‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå°è„šæœ¬æ¥æŠŠæ‰€æœ‰çš„ä¸œè¥¿æ”¾åœ¨ä¸€èµ·ã€‚æˆ‘æŠŠå®ƒå«åš`implement.js`ï¼Œæ²¡æœ‰åˆ«çš„åŸå› ï¼Œåªæ˜¯æˆ‘æƒ³ä¸å‡ºä¸€ä¸ªæ›´å¥½çš„åå­—:

```
// Create all the objects we'll use
let news = new News;
let enOutlet = new NewsOutlet("en");
let ptOutlet = new NewsOutlet("pt");
let arOutlet = new NewsOutlet("ar");

// Subscribe
news.addSubscriber(enOutlet);
news.addSubscriber(ptOutlet);
news.addSubscriber(arOutlet);

// A function for setting the news elements to prompt user to type
// you don't need this if you don't want, just remove the onload
// from the HTML file if you remove this
var defaultBreaking = function() {
  var breaking = document.getElementsByClassName("breaking");
  for (let item of breaking) { item.innerText = "Type some news..."; }
}

// The function that will call transmit on news
// setting off the chain event of subscribers receiving
// then translating, then showing the news
var sendNews = function() {
  let theNews = document.getElementById("sourceNews").value;
  news.transmit(theNews);
  news.observers.forEach(function(o){
    o.reportTheNews();
  });
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»…æ­¤è€Œå·²ã€‚å¦‚æœä½ ä¸€ç›´åœ¨å¤åˆ¶/ç²˜è´´ï¼Œé‚£ä¹ˆä½ çš„ç½‘ç«™åº”è¯¥çœ‹èµ·æ¥åƒæˆ‘çš„ã€‚å¦‚æœä½ åœ¨ windows ä¸Šé‡åˆ°ä¸€ä¸ªå¥‡æ€ªçš„å…³äºè·¨ç«™è„šæœ¬çš„é”™è¯¯ï¼Œæ‰“å¼€`run.exe`å¹¶è¾“å…¥è¿™ä¸ª:

```
chrome.exe  --user-data-dir="C:/Chrome dev session"  --disable-web-security 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†æ˜¯è¦å°å¿ƒï¼Œä¸è¦ç»å¸¸è¿™æ ·åšã€‚

# [](#where-do-we-go-from-here)æˆ‘ä»¬å°†ä½•å»ä½•ä»ï¼Ÿ

è®¾è®¡æ¨¡å¼å¾ˆæ£’ï¼Œäº†è§£å®ƒä»¬ä¼šè®©ä½ æˆä¸ºæ›´å¥½çš„ç¨‹åºå‘˜ï¼Œæˆ‘ä¸åœ¨ä¹åˆ«äººæ€ä¹ˆè¯´ã€‚å°±åƒæ•°æ®ç»“æ„å’Œç®—æ³•ä¸€æ ·ï¼Œå½“ä½ è‡³å°‘çŸ¥é“äº†è®¾è®¡æ¨¡å¼çš„*å’Œå®ƒä»¬çš„ä¸€èˆ¬ç”¨é€”ï¼Œä½ çš„è„‘æµ·ä¸­å°±ä¼šæœ‰è®¸å¤šå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆåˆ—è¡¨ã€‚*

å½“äººä»¬è°ˆè®ºè§‚å¯Ÿè€…æ¨¡å¼æ—¶ï¼Œæˆ‘ç»å¸¸çœ‹åˆ°çš„ä¸€ä¸ªä¾‹å­æ˜¯äº¤æ˜“ã€‚å‡è®¾ä¸€ä¸ªè‚¡ç¥¨ä»£ç ä» 1.02 å‡çº§åˆ° 1.14ï¼Œæœ‰ä¸€åƒä¸ªä¸åŒçš„ç•Œé¢éœ€è¦æé†’ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ— è®ºè¿™ç§ä¸œè¥¿åœ¨ä»€ä¹ˆæœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œè¿™äº›æ¥å£ä¸­çš„æ¯ä¸€ä¸ªéƒ½åº”è¯¥è®¢é˜…å¹¿æ’­è‚¡ç¥¨ä»£ç ä»·æ ¼çš„å¯¹è±¡ã€‚

æˆ‘ä»¬ç”¨çš„ä¾‹å­éå¸¸ç®€å•ï¼Œä½ å¯ä»¥ç”¨å®ƒåšå¾ˆå¤šäº‹æƒ…ã€‚æ¯”å¦‚ï¼Œæˆ‘å¾ˆç¡®å®š`KnockoutJS`æ¡†æ¶(å—¨ C#å¼€å‘è€…ä»¬ï¼)å®Œå…¨å»ºç«‹åœ¨è¿™ä¸ªæ¦‚å¿µä¸Šã€‚è¿™åªæ˜¯ä¸€ä¸ªéå¸¸é…·çš„è®¾è®¡æ¨¡å¼çš„ä¾‹å­ï¼Œè¿˜æœ‰å¾ˆå¤šéœ€è¦å­¦ä¹ ã€‚

å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæ•™ç¨‹ï¼Œè¯·å‘Šè¯‰æˆ‘ä½ å–œæ¬¢å®ƒçš„ä»€ä¹ˆï¼Œä»¥åŠä½ å¸Œæœ›æˆ‘æ¥ä¸‹æ¥è°ˆè®ºä»€ä¹ˆã€‚ä¸€ç§æ–°çš„æ¨¡å¼ï¼Ÿä¸åŒçš„è¯­è¨€ï¼Ÿä¸åŒè¯­è¨€çš„æ–°æ¨¡å¼ï¼Ÿå®Œå…¨ä¸åŒçš„ä¸œè¥¿ï¼Ÿè®©æˆ‘çŸ¥é“ï¼Œè¯·ä¸è¦çŠ¹è±«é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚