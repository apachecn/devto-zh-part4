# ğŸ›¡ï¸å¦‚ä½•å®‰å…¨åœ°è®¿é—® javascript ä¸­æ·±åº¦åµŒå¥—çš„å€¼ï¼Ÿ

> åŸæ–‡ï¼š<https://dev.to/tbetous/how-to-safely-access-deep-nested-values-in-javascript-5b2a>

æˆ‘æƒ³åˆ†äº«æˆ‘ä»Šå¤©é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ä»¥åŠæˆ‘æ˜¯å¦‚ä½•è§£å†³çš„ã€‚å®ƒæ˜¯å…³äºåœ¨ javascript ä¸­è®¿é—®æ·±åº¦åµŒå¥—å€¼çš„æ–¹æ³•ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­:

```
const options = {
    notification: {
        enablePrivateMessage: true,
        enableCommentResponse: false
    }
}

const enablePrivateMessage = options.notification.enablePrivateMessage
const enableCommentResponse = options.notification.enableCommentResponse 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ

è¿™å¾ˆå¥½ï¼Œä½†æ˜¯å¦‚æœ`options`æˆ–`notification`æ˜¯`undefined`ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

```
const options = undefined
const enablePrivateMessage = options.notification.enablePrivateMessage
// Uncaught TypeError: Cannot read property 'notification' of undefined

const options = {}
const enablePrivateMessage = options.notification.enablePrivateMessage
// Uncaught TypeError: Cannot read property 'enablePrivateMessage' of undefined 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ˜¯å•Šï¼ŒçœŸå°´å°¬ï¼å¦‚æœä¸ç¡®å®šæ˜¯å¦è®¾ç½®äº†ä¸­é—´å€¼ï¼Œé‚£ä¹ˆè®¿é—®æ·±åº¦åµŒå¥—çš„å€¼æ˜¯ä¸å®‰å…¨çš„ã€‚åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘è¯•å›¾è®¿é—®`notification`çš„å±æ€§`enablePrivateMessage`ï¼Œä½†ä¸å¹¸çš„æ˜¯`options`ä¸­æ²¡æœ‰è®¾ç½®`notification`ï¼Œå› æ­¤ç­‰äº`undefined`ã€‚é”™è¯¯ä¿¡æ¯å‘Šè¯‰æˆ‘ï¼Œæˆ‘è¯•å›¾ä»æŸä¸ªä¸œè¥¿`undefined`è®¿é—®`enablePrivateMessage`å±æ€§ã€‚

## å¦‚ä½•è§£å†³ï¼Ÿ

è¿™ä¸ªé—®é¢˜çš„ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ä¸€æ¬¡æµè§ˆä¸€ä¸ªåµŒå¥—å±æ€§ï¼Œå¹¶åœ¨è®¿é—®ä¸‹ä¸€ä¸ªåµŒå¥—å€¼ä¹‹å‰æ£€æŸ¥å®ƒä»¬çš„å€¼æ˜¯`null`è¿˜æ˜¯`undefined`ã€‚

```
const options = {}
const enablePrivateMessage = options && options.notification && options.notification.enablePrivateMessage 
// enablePrivateMessage == undefined

// alternative way
const enablePrivateMessage = !options ? 
    undefined : !options.notification ? 
        undefined : options.notification.enablePrivateMessage 
// enablePrivateMessage == undefined 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è™½ç„¶è¿™é€‚ç”¨äºç®€å•çš„æƒ…å†µï¼Œä½†æ˜¯å¦‚æœä½ çš„å¯¹è±¡å¾ˆæ·±ï¼Œé‚£ä¹ˆå†™èµ·æ¥ä¼šå¾ˆç—›è‹¦ã€‚ä»£ç ä¼šå¾ˆé•¿ï¼Œéš¾ä»¥é˜…è¯»ã€‚å¹¸è¿çš„æ˜¯ï¼Œå’Œ [lodash `get` function](https://github.com/lodash/lodash/blob/master/get.js) ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªå‡½æ•°æ¥å®‰å…¨åœ°è®¿é—®å±æ€§ã€‚å°±æ˜¯è¿™é‡Œ:

```
export const getPropValue = (object, path = '') =>
    path.split('.')
        .reduce((o, x) => o == undefined ? o : o[x]
        , object)

const options = {}
const enablePrivateMessage = getPropValue(options, 'notification.enablePrivateMessage')
// enablePrivateMessage == undefined 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ`getPropValue`æ˜¯ä¸€ä¸ªå¸¦ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªæ˜¯è¦æŸ¥è¯¢çš„`object`,ç¬¬äºŒä¸ªæ˜¯æˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°çš„åµŒå¥—é“å…·çš„`path`ã€‚å½“æ‰§è¡Œå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªæ•°ç»„ä¸­åˆ†å‰²è·¯å¾„ï¼Œä»¥ä¾¿æµè§ˆæ‰€æœ‰åµŒå¥—çš„å±æ€§ã€‚

```
// Example
// path = 'notification.enablePrivateMessage'
'notification.enablePrivateMessage'.split('.')
// ['notification', 'enablePrivateMessage'] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œæˆ‘ä»¬ä»æ•°ç»„ä¸­æ‰§è¡Œä¸€ä¸ª [`reduce`](https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Array/reduce) å‡½æ•°ï¼Œè¯¥å‡½æ•°å¸¦æœ‰ä¸€ä¸ªæœ€åˆç”¨è¦æŸ¥è¯¢å¯¹è±¡è®¾ç½®çš„èšé›†å™¨ã€‚`reduce`å‡½æ•°æµè§ˆè·¯å¾„ä¸­çš„æ‰€æœ‰å±æ€§ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæœ‰æœªå®šä¹‰çš„å€¼ï¼Œé‚£ä¹ˆç»“æœå°†æ˜¯`undefined`ã€‚å¦åˆ™ï¼Œè¿”å›åµŒå¥—å±æ€§çš„å€¼ã€‚

```
// Example 1 : All properties are defined in the path
// object = {notification: {enablePrivateMessage: true}}
// path = 'notification.enablePrivateMessage'
['notification', 'enablePrivateMessage'].reduce((o, x) => {
    console.log(o, x)
    return o == undefined ? o : o[x]
}, {notification: {enablePrivateMessage: true}})
// {notification: {enablePrivateMessage: true}} 'notification'
// {enablePrivateMessage: true} 'enablePrivateMessage'
// true

// Example 2 : notification is undefined
// object = {}
// path = 'notification.enablePrivateMessage'
['notification', 'enablePrivateMessage'].reduce((o, x) => {
    console.log(o, x)
    return o == undefined ? o : o[x]
}, {})
// {} 'notification'
// undefined 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ES6 ææ„æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ

å—¯ï¼Œé‚£å¾ˆå¥½ï¼ä½†æ˜¯ä» ES6 å¼€å§‹ï¼ŒJavascript ä¸­æä¾›äº†ææ„ç‰¹æ€§ã€‚è¿™ä¸ªç‰¹æ€§çœŸçš„å¾ˆå¥½ï¼Œå…è®¸å¼€å‘äººå‘˜ç”¨å¯¹è±¡çš„åµŒå¥—å±æ€§è½»æ¾åœ°å£°æ˜å’Œè®¾ç½®å˜é‡ã€‚

```
const options = {
    notification: {
        enablePrivateMessage: true,
        enableCommentResponse: false
    }
}

const {notification: {enablePrivateMessage, enableCommentResponse}} = options

console.log(enablePrivateMessage)
// true

console.log(enableCommentResponse)
// false 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä¸èƒ½ä½¿ç”¨æˆ‘çš„`getPropValue`å‡½æ•°ã€‚å¦‚æœ`options`æ˜¯`undefined`ï¼Œé‚£ä¹ˆä¹‹å‰çš„ææ„å°†å¯¼è‡´ä¸€ä¸ªé”™è¯¯ã€‚

```
const options = undefined
const {notification: {enablePrivateMessage, enableCommentResponse}} = options
// Uncaught TypeError: Cannot destructure property `notification` of 'undefined' or 'null'. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœ`options`æ˜¯`undefined`ï¼Œä¿æŠ¤æˆ‘ä»¬çš„ä»£ç ä¸å‡ºé”™çš„ä¸€ä¸ªç®€å•æ–¹æ³•æ˜¯è®¾ç½®ä¸€ä¸ªå›é€€å€¼ã€‚ä½†è¿™è¿˜ä¸å¤Ÿã€‚

```
const options = undefined
const {notification: {enablePrivateMessage, enableCommentResponse}} = options || {}
// Uncaught TypeError: Cannot destructure property `enablePrivateMessage` of 'undefined' or 'null' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦ä½ è¿™æ ·åšäº†ï¼Œä½ éœ€è¦ä¸ºä½ æ‰€æœ‰çš„åµŒå¥—å±æ€§è®¾ç½®é»˜è®¤å€¼ï¼Œç„¶åæ‰èƒ½å¾—åˆ°ä½ æƒ³è¦çš„å±æ€§ã€‚

```
const options = undefined
let {notification: {enablePrivateMessage, enableCommentResponse} = {}} = options || {}

console.log(enablePrivateMessage)
// undefined

console.log(enableCommentResponse)
// undefined 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ æƒ³è¦çš„å±æ€§å¾ˆæœ‰æ·±åº¦ï¼Œè¿™å°±æ²¡æœ‰`getPropValue`å‡½æ•°æ–¹ä¾¿äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥è€ƒè™‘åˆ°ææ„å¯èƒ½ä¸æ˜¯è®¿é—®æ‚¨çš„å±æ€§çš„æœ€ä½³æ–¹å¼ï¼Œå› ä¸ºæ‚¨çš„æŒ‡ä»¤å¤ªé•¿è€Œä¸å¯è¯»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å»ºè®®ä½¿ç”¨`getPropValue`åŠŸèƒ½ä¸€æ¬¡è®¿é—®ä¸€ä¸ªå±æ€§ã€‚

## Lodash å¯ä»¥å¸®åˆ°ä½ ï¼

ä½ è¦çŸ¥é“`getPropValue`æ˜¯æˆ‘ä¸ºè¿™ä¸ªå¸–å­è®¾è®¡çš„ä¸€ä¸ªåŠŸèƒ½ã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä½¿ç”¨ [lodash `get`å‡½æ•°](https://lodash.com/docs/4.17.11#get)ã€‚è¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹ç¡®å®æ˜¯æœ‰ç”¨çš„ï¼Œè€Œä¸”å¾ˆæœ‰å¯èƒ½å¥æ•ˆ`getPropValue`ã€‚å¦‚æœæ‚¨çš„è·¯å¾„åœ¨è·å–ç›®æ ‡å±æ€§ä¹‹å‰åˆ°è¾¾äº†ä¸€ä¸ªæœªå®šä¹‰çš„å€¼ï¼Œé‚£ä¹ˆæœ‰ä¸€ä¸ªé¢å¤–çš„å‚æ•°å…è®¸æ‚¨è®¾ç½®ä¸€ä¸ªå›é€€å€¼ã€‚

```
import { get } from 'lodash'

const options = {
    notification: {
        enablePrivateMessage: true,
        enableCommentResponse: false
    }
}

// Example 1 : Simple case
get(options, 'notification.enablePrivateMessage')
// true

// Example 2 : Error case with 'fallback' as fallback value
get(options, 'toto.tata', 'fallback')
// 'fallback' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±æ˜¯è¿™æ ·ï¼æ‚¨å·²ç»çŸ¥é“äº†åœ¨ javascript ä¸­å®‰å…¨è®¿é—®æ·±å±‚åµŒå¥—å€¼æ‰€éœ€è¦çŸ¥é“çš„ä¸€åˆ‡ï¼å¸Œæœ›ä½ å–œæ¬¢æˆ‘åœ¨[dev to](https://dev.to)çš„ç¬¬ä¸€ç¯‡å¸–å­ï¼