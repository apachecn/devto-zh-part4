# å½“ç”¨æˆ·æ›´æ”¹æ ‡ç­¾æ—¶æ›´æ”¹æ‚¨çš„æ–‡æ¡£æ ‡é¢˜

> åŸæ–‡ï¼š<https://dev.to/hurricaneinteractive/guilt-users-into-coming-back-with-your-document-title-55kn>

**æ²¡æœ‰ä»‹ç»åªæ˜¯[è¿›å…¥ä»£ç ](#code)T3ã€‘**

## æˆ‘ä»¬å¼€å§‹å§

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé¡¹ç›®åŸºåœ°ã€‚ä¸ºæ­¤ï¼Œæˆ‘å°†ä½¿ç”¨[åˆ›å»º-ååº”-åº”ç”¨](https://github.com/facebook/create-react-app)ã€‚ç„¶è€Œï¼Œä»£ç å¯ä»¥åœ¨ä»»ä½• JavaScript é¡¹ç›®ä¸­ä½¿ç”¨ã€‚æˆ‘ä»¬åªéœ€è¦è®¿é—®`document`å¯¹è±¡ã€‚

> è¿™ä¸ªé¡¹ç›®çš„ä»£ç å¯ä»¥åœ¨ [Github](https://github.com/myweekinjs/please-dont-leave) ä¸Šæ‰¾åˆ°

### ç¬¬ä¸€æ­¥:åˆå§‹åŒ–

```
npx create-react-app please-dont-leave
cd please-dont-leave
npm start || yarn start 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### ç¬¬äºŒæ­¥:æŸ¥æ‰¾æ–‡ä»¶

æ‰“å¼€æ‚¨çš„`App.js`æ–‡ä»¶ã€‚

### ç¬¬ä¸‰æ­¥:é­”æ³•

åœ¨`App`å‡½æ•°ä¹‹ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`getBrowserHiddenProps`çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å°†æ ¹æ®æˆ‘ä»¬ä½¿ç”¨çš„æµè§ˆå™¨è·å–æ­£ç¡®çš„å±æ€§ã€‚

```
const getBrowserHiddenProps = () => {
  let hidden, visibilityChange
  if (typeof document.hidden !== "undefined") {
    hidden = "hidden";
    visibilityChange = "visibilitychange";
  } else if (typeof document.msHidden !== "undefined") {
    hidden = "msHidden";
    visibilityChange = "msvisibilitychange";
  } else if (typeof document.webkitHidden !== "undefined") {
    hidden = "webkitHidden";
    visibilityChange = "webkitvisibilitychange";
  }

  return {
    hidden,
    visibilityChange
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä½¿ç”¨ä¸€ç§ç®€åŒ–çš„æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«`hidden`å’Œ`visibilityChange`å€¼çš„å¯¹è±¡ã€‚é€šè¿‡ä¸å®šä¹‰å¯¹è±¡çš„é”®ï¼Œè¿™äº›é”®å°†é»˜è®¤ä¸ºå˜é‡åã€‚ä¸‹é¢å°†è¾¾åˆ°ä¸ä¸Šé¢ç›¸åŒçš„æ•ˆæœã€‚

```
return {
  hidden: hidden,
  visibilityChange: visibilityChange
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¾ˆé…·å§ï¼Ÿæ— è®ºå¦‚ä½•ï¼Œ**å¼€å§‹å§ï¼**

ä¸‹ä¸€æ­¥æ˜¯å‘æ–‡æ¡£æ·»åŠ ä¸€ä¸ªäº‹ä»¶ä¾¦å¬å™¨ï¼Œä»¥æ£€æŸ¥é¡µé¢å¯è§æ€§æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚æˆ‘ä»¬å°†åœ¨`App`å‡½æ•°ä¸­å®Œæˆè¿™é¡¹å·¥ä½œã€‚

```
const { hidden, visibilityChange } = getBrowserHiddenProps()

if (typeof document.addEventListener !== "undefined" && typeof hidden !== "undefined") {
  // We can continue
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œæˆ‘ä»¬æœ‰å¦ä¸€ä¸ªç†ç”±å°†`hidden`å’Œ`visibilityChange`ä½œä¸ºå¯¹è±¡è¿”å›ã€‚è¿™æ˜¯ä¸ºäº†è®©æˆ‘ä»¬èƒ½å¤Ÿ[è§£æ„](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Object_destructuring)T2 å‡½æ•°çš„è¿”å›å€¼ã€‚æˆ‘ä»¬è¿˜æ£€æŸ¥ä»¥ç¡®ä¿æˆ‘ä»¬èƒ½å¤Ÿå‘æ–‡æ¡£å¯¹è±¡æ·»åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶ç¡®ä¿`hidden`å€¼ä¸æ˜¯`undefined`ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ åŸºäºå¯è§æ€§äº‹ä»¶(`visibilityChange`)çš„äº‹ä»¶ç›‘å¬å™¨ã€‚

```
const { hidden, visibilityChange } = getBrowserHiddenProps()

if (typeof document.addEventListener !== "undefined" && typeof hidden !== "undefined") {
  // We can continue
  document.addEventListener(visibilityChange, () => {

  }, false)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥`hidden`å€¼å’Œå®ƒçš„è¡Œä¸ºã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼šè¦æ±‚ç”¨æˆ·å›æ¥ï¼Œå› ä¸ºæˆ‘ä»¬é”™è¿‡äº†ä»–ä»¬çš„æ³¨æ„åŠ›ã€‚

```
const { hidden, visibilityChange } = getBrowserHiddenProps()

if (typeof document.addEventListener !== "undefined" && typeof hidden !== "undefined") {
  // We can continue
  document.addEventListener(visibilityChange, () => {
    if (document[hidden]) {
      document.title = "ğŸ˜­ PLEASE COME BACK!!"
    } else {
      document.title = "ğŸ˜ YAY!"
    }
  }, false)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ä½ çŸ¥é“äº†ï¼å½“æ‚¨æ›´æ”¹æ ‡ç­¾æ—¶ï¼Œè§‚å¯Ÿæ‚¨çš„æ–‡æ¡£æ ‡é¢˜çš„å˜åŒ–ã€‚**æˆåŠŸ**

### ç¬¬å››æ­¥:å¯èƒ½æ€§

ç°åœ¨ï¼Œæ›´æ”¹æ ‡ç­¾æ ‡é¢˜å¯èƒ½æ²¡ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯ï¼Œå½“ç”¨æˆ·ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ ‡ç­¾æ—¶ï¼Œæ‚¨å¯ä»¥åšä¸€äº›äº‹æƒ…ã€‚è¿™æ ·åšçš„ä¸€ä¸ªæœ€æœ‰ç”¨çš„åŸå› æ˜¯å‘é€ä¸€ä¸ª Google Analytics äº‹ä»¶ã€‚è¿™å°†å…è®¸ä½ å¼€å§‹çœ‹åˆ°ç”¨æˆ·ä½•æ—¶ç¦»å¼€ä½ çš„é¡µé¢ï¼Œå¦‚æœä»–ä»¬å›æ¥ã€‚éå¸¸é…·ã€‚

è¿™äº›ä»£ç ä¸­çš„å¾ˆå¤šéƒ½æ˜¯ä» MDN ä¸Šçš„[é¡µé¢å¯è§æ€§ API](https://developer.mozilla.org/en-US/docs/Web/API/Page_Visibility_API) é¡µé¢è·å¾—çš„ã€‚å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œæˆ‘å»ºè®®ä½ å»çœ‹çœ‹è¿™ä¸ªé¡µé¢ï¼Œäº†è§£æ›´å¤šçš„ä¿¡æ¯ã€‚

* * *

è°¢è°¢ä½ çœ‹æˆ‘çš„æ–‡ç« ï¼Œå®ƒçœŸçš„æ„ä¹‰é‡å¤§ï¼â¤ï¸ï¼Œè¯·æä¾›ä»»ä½•åé¦ˆæˆ–æ„è§ï¼Œæˆ‘æ€»æ˜¯æœŸå¾…æ”¹è¿›å’Œæœ‰æ„ä¹‰çš„è®¨è®ºã€‚

### ğŸ‘‹ä¸‹æ¬¡è§ï¼