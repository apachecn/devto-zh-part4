# React useRef å¯¹ useRef é’©å­çš„ä»‹ç»

> åŸæ–‡ï¼š<https://dev.to/dinhhuyams/introduction-to-useref-hook-3m7n>

## å…ˆå†³æ¡ä»¶:å…³äº[ååº”](https://reactjs.org/)å’Œ[å‚è€ƒæ–‡çŒ®ä»¥åŠååº”ä¸­çš„ dom](https://reactjs.org/docs/refs-and-the-dom.html#callback-refs) çš„åŸºç¡€çŸ¥è¯†

è¿™ç¯‡å¸–å­è¦è®²çš„æ˜¯ä»€ä¹ˆæ˜¯ **useRef** hookï¼Œä»¥åŠæˆ‘ä»¬ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨å®ƒã€‚

ç¬¬ä¸€æ¬¡å­¦é’©å­çš„æ—¶å€™ï¼Œæˆ‘æœ‰å¾ˆå¤šç–‘é—®ï¼Œéœ€è¦å»å¯»æ‰¾ç­”æ¡ˆã€‚å…¶ä¸­ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæˆ‘å¦‚ä½•å°†å½“å‰çŠ¶æ€/é“å…·ä¸ä¹‹å‰çš„çŠ¶æ€/é“å…·è¿›è¡Œæ¯”è¾ƒï¼Œæˆ–è€…åœ¨ **useEffect Hook** ä¸­å¤„ç†æ·±å±‚å¯¹è±¡æ¯”è¾ƒã€‚åªæœ‰å½“æˆ‘äº†è§£äº† **useRef Hook** ä¹‹åï¼Œæˆ‘æ‰ä¼šå¼„æ˜ç™½ï¼Œç„¶åä¸€åˆ‡å°±æ°´è½çŸ³å‡ºäº†ã€‚

ğŸ’ªæˆ‘ä»¬å¼€å§‹å§ï¼

## 1ã€‚ä»€ä¹ˆæ˜¯ useRef hookï¼Ÿ

> Refs æä¾›äº†ä¸€ç§æ–¹æ³•æ¥è®¿é—®åœ¨ render æ–¹æ³•ä¸­åˆ›å»ºçš„ DOM èŠ‚ç‚¹æˆ– React å…ƒç´ ã€‚

æˆ‘ä»¬çš„ä¾‹å­æ˜¯å…³äºå½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ç®¡ç†è¾“å…¥çš„ç„¦ç‚¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ **createRef** API

**createRef API**

```
import {createRef} from 'react' 

const FocusInput = () => {
   const inputEl = createRef()

   const focusInput = () => {
      inputEl.current.focus()
   }

   return (
      <>
         <input ref={inputEl} type="text" />
         <button onClick={focusInput}>Focus input</button>
      </div>
   )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯ä»¥ç”¨ **useRef** hook è·å¾—å®Œå…¨ç›¸åŒçš„ç»“æœ

â€¢ **useRef Hook**

```
const FocusInput = () => {
   const inputEl = React.useRef()

   const focusInput = () => {
      inputEl.current.focus()
   }

   return (
      <>
         <input ref={inputEl} type="text" />
         <button onClick={focusInput}>Focus input</button>
      </>
   )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> ğŸ¤”ç­‰ç­‰ï¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

[![dopperlganger](img/8a1ce15c9ab5870343a043043e8a3c9d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Jrg9-QRx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/26871154/64486033-bb0d8780-d230-11e9-8311-042dc7028496.jpg)

æˆ‘ç¬¬ä¸€æ¬¡è¯»åˆ° **useRef** çš„æ—¶å€™ä¹Ÿé—®è¿‡åŒæ ·çš„é—®é¢˜ã€‚å½“æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **createRef** API æ¥ç®¡ç†è¾“å…¥çš„ç„¦ç‚¹æ—¶ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨ **useRef** hookï¼ŸReact å›¢é˜Ÿåœ¨ React 16.8 ä¸­å¼•å…¥é’©å­æ—¶ï¼Œæ˜¯ä¸æ˜¯åªæƒ³é€šè¿‡åˆ›å»ºä¸€ä¸ª**åˆ†èº«**æ¥è®©ä»£ç çœ‹èµ·æ¥ä¸€è‡´ï¼Ÿ

å—¯ï¼Œä¸åŒçš„æ˜¯ **createRef** æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šç»™**è¿”å›ä¸€ä¸ªæ–°çš„ ref** ï¼Œè€Œ **useRef** æ¯æ¬¡éƒ½ä¼šç»™**è¿”å›åŒä¸€ä¸ª ref** ã€‚

> useRef è¿”å›ä¸€ä¸ªå¯å˜çš„ Ref å¯¹è±¡ã€‚å½“å‰å±æ€§è¢«åˆå§‹åŒ–ä¸ºä¼ é€’çš„å‚æ•°(initialValue)ã€‚è¿”å›çš„å¯¹è±¡å°†åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå­˜æœŸå†…ä¿æŒä¸å˜ã€‚

```
const Test = () => {
    const [renderIndex, setRenderIndex] = React.useState(1)
   const refFromUseRef = React.useRef()
   const refFromCreateRef = createRef()

   if (!refFromUseRef.current) {
      refFromUseRef.current = renderIndex
   }

   if (!refFromCreateRef.current) {
      refFromCreateRef.current = renderIndex
   }

   return (
      <>
         <p>Current render index: {renderIndex}</p>
         <p>
            <b>refFromUseRef</b> value: {refFromUseRef.current}
         </p>
         <p>
            <b>refFromCreateRef</b> value:{refFromCreateRef.current}
         </p>

         <button onClick={() => setRenderIndex(prev => prev + 1)}>
            Cause re-render
         </button>
      </>
   )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æ‚¨æ‰€è§ï¼Œ`refFromUseRef`ä¿æŒå…¶å€¼ï¼Œå³ä½¿ç»„ä»¶é‡æ–°å‘ˆç°ï¼Œè€Œ`refFromCreateRef`æ²¡æœ‰

[![compare useRef and createRef](img/4c0a7573acb4cfaf0fb43e0f2573de6d.png "compare useRef and createRef")](https://i.giphy.com/media/LndDkp00MVrF9ECX55/giphy.gif)

> ä½ å¯ä»¥åœ¨ç‘æ©Â·ç§‘æ ¼æ–¯å¨å°”å…³äº[æ–¯å¡”å…‹ä¼Ÿæµ](https://stackoverflow.com/questions/54620698/whats-the-difference-between-useref-and-createref)çš„å›ç­”ä¸­æ‰¾åˆ° **useRef** å’Œ **createRef** çš„å¯¹æ¯”

ğŸ‘æœ‰æ„æ€ï¼ **useRef** å¯ä»¥åœ¨å®ƒçš„`.current`å±æ€§ä¸­ä¿å­˜ä¸€ä¸ªå€¼ï¼Œå®ƒå¯ä»¥åœ¨ç»„ä»¶é‡æ–°å‘ˆç°åä¿æŒä¸å˜ã€‚å› æ­¤ï¼Œ **useRef** æ¯”ä»…ä»…ç®¡ç†ç»„ä»¶ Ref æ›´æœ‰ç”¨

## 2ã€‚è¶…å‡º Ref å±æ€§

é™¤äº† **ref** å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **useRef** hook è¿›è¡Œè‡ªå®šä¹‰æ¯”è¾ƒï¼Œè€Œä¸æ˜¯ä½¿ç”¨ **useEffect** hook ä¸­é»˜è®¤çš„æµ…å±‚æ¯”è¾ƒã€‚çœ‹ä¸€çœ‹æˆ‘ä»¬çš„ä¾‹å­ğŸ˜‡

```
const Profile = () => {
   const [user, setUser] = React.useState({name: 'Alex', weight: 40})

   React.useEffect(() => {
      console.log('You need to do exercise!')
   }, [user])

   const gainWeight = () => {
      const newWeight = Math.random() >= 0.5 ? user.weight : user.weight + 1
      setUser(user => ({...user, weight: newWeight}))
   }

   return (
      <>
         <p>Current weight: {user.weight}</p>
         <button onClick={gainWeight}>Eat burger</button>
      </>
   )
}

export default Profile 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å‰ææ˜¯ç”¨æˆ·åæ°¸è¿œä¸å˜ã€‚æˆ‘ä»¬çš„æœŸæœ›æ˜¯ï¼Œåªæœ‰å½“ç”¨æˆ·ä½“é‡å¢åŠ æ—¶ï¼Œæ•ˆæœæ‰ä¼šè¾“å‡ºè­¦å‘Šæ–‡æœ¬ã€‚ç„¶è€Œï¼Œå¦‚æœæ‚¨æµ‹è¯•ä¸Šé¢çš„ä»£ç ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ•ˆæœåœ¨ç”¨æˆ·æ¯æ¬¡ç‚¹å‡»æŒ‰é’®æ—¶è¿è¡Œï¼Œå³ä½¿å½“`weight`å±æ€§ä¿æŒä¸å˜ã€‚è¿™æ˜¯å› ä¸º **useEffect** é’©å­é»˜è®¤ä½¿ç”¨æµ…å±‚æ¯”è¾ƒï¼Œè€Œæˆ‘ä»¬çš„`userState`æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ğŸ›ğŸ›ğŸ›

ğŸ”§è¦ä¿®å¤è¿™ä¸ª bugï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™è‡ªå·±çš„æ¯”è¾ƒï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„æ¯”è¾ƒã€‚

ğŸ‘‰**ç¬¬ä¸€æ­¥**:ä½¿ç”¨ lodash `isEqual`æ–¹æ³•è¿›è¡Œæ·±åº¦å¯¹æ¯”

```
const Profile = () => {
   const [user, setUser] = React.useState({name: 'Alex', weight: 40})

   React.useEffect(() => {
       if (!_.isEqual(previousUser, user) {
           console.log('You need to do exercise!')
       }
   })

    ...
}

export default Profile 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬åˆšåˆšç§»é™¤äº†æ•ˆæœä¸­çš„ä¾èµ–æ•°ç»„ï¼Œå¹¶ä½¿ç”¨ lodash `isEqual`æ–¹æ³•æ¥è¿›è¡Œæ·±åº¦æ¯”è¾ƒã€‚ä¸å¹¸çš„æ˜¯ï¼Œç”±äºç¼ºå°‘`previousUser`å€¼ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªæ–°é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬åœ¨ **ComponentDidUpdate** ç”Ÿå‘½å‘¨æœŸä¸­å¯¹ä¸€ä¸ªç±»ç»„ä»¶åšåŒæ ·çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å¾—åˆ°å…ˆå‰çš„çŠ¶æ€å€¼ã€‚

> ğŸ”¥useRef å‰æ¥æ•‘æ´

ğŸ‘‰**ç¬¬äºŒæ­¥** : useRefï¼Œç”¨äºä¿å­˜ä¹‹å‰çš„çŠ¶æ€

```
const Profile = () => {
   const [user, setUser] = React.useState({name: 'Alex', weight: 20})

   React.useEffect(() => {
       const previousUser = previousUserRef.current
       if (!_.isEqual(previousUser, user) {
           console.log('You need to do exercise!')
       }
   })

   const previousUserRef = React.useRef()
   React.useEffect(() => {
      previousUserRef.current = user
   })

    ...
}

export default Profile 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†è·Ÿè¸ª`previousUser`çš„å€¼ï¼Œæˆ‘ä»¬å°†å®ƒä¿å­˜åˆ° **useRef** é’©å­çš„`.current`å±æ€§ä¸­ï¼Œå› ä¸ºå³ä½¿åœ¨ç»„ä»¶é‡æ–°å‘ˆç°æ—¶ï¼Œå®ƒä»ç„¶å­˜åœ¨ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¦ä¸€ä¸ªæ•ˆæœå°†è¢«ç”¨æ¥åœ¨æ¯æ¬¡æ¸²æŸ“åæ›´æ–°`previousUserRef.current`çš„å€¼ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä»`previousUserRef.current`ä¸­æå–`previousUser`å€¼ï¼Œç„¶åæˆ‘ä»¬æ·±å…¥æ¯”è¾ƒä»¥å‰çš„å€¼å’Œæ–°å€¼ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬çš„æ•ˆæœåªåœ¨è¿™äº›å€¼ä¸åŒæ—¶è¿è¡Œ

ğŸ‘‰**ç¬¬ä¸‰æ­¥**:æå–æ•ˆæœåˆ°è‡ªå®šä¹‰æŒ‚é’©

å¦‚æœä½ æƒ³é‡ç”¨ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ä¸€ä¸ªæ–°çš„é’©å­ã€‚æˆ‘åªæ˜¯å°†ä¸Šé¢çš„ä»£ç æå–åˆ°ä¸€ä¸ªåä¸º**ä½¿ç”¨å…ˆå‰çš„**
çš„å‡½æ•°ä¸­

```
const usePrevious = (value) => {
    const previousUserRef = React.useRef()
   React.useEffect(() => {
      previousUserRef.current = value
   }, [value])

   return previousUserRef.current
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†ä½¿å®ƒæ›´é€šç”¨ï¼Œæˆ‘å°†æŠŠ`previousUserRef`æ”¹åä¸º`ref`

```
const usePrevious = (value) => {
    const ref = React.useRef()

    React.useEffect(() => {
      ref.current = value
    }, [value])

    return ref.current
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬å°†è‡ªå®šä¹‰çš„ **usePrevious** æŒ‚é’©åº”ç”¨åˆ°ä»£ç 

```
const Profile = () => {
    const initialValue = {name: 'Alex', weight: 20}
   const [user, setUser] = React.useState(initialValue)

    const previousUser = usePrevious(user)

   React.useEffect(() => {
       if (!_.isEqual(previousUser, user) {
           console.log('You need to do exercise!')
       }
   })

   const gainWeight = () => {
      const newWeight = Math.random() >= 0.5 ? user.weight : user.weight + 1
      setUser(user => ({...user, weight: newWeight}))
   }

   return (
      <>
         <p>Current weight: {user.weight}</p>
         <button onClick={gainWeight}>Eat burger</button>
      </>
   )
}

export default Profile 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ğŸ’ªå¤šé…·å•Šï¼æ‚¨ä¹Ÿå¯ä»¥å°†æ·±å±‚æ¯”è¾ƒé€»è¾‘æå–åˆ°ä¸€ä¸ªæ–°çš„å®šåˆ¶é’©å­ä¸­ã€‚æŸ¥çœ‹è‚¯ç‰¹Â·cÂ·å¤šå…¹çš„[ä½¿ç”¨æ·±åº¦æ¯”è¾ƒæ•ˆæœ](https://github.com/kentcdodds/use-deep-compare-effect)

## 3ã€‚ç»“è®º:

ğŸš€useRef Hook ä¸ä»…ä»…æ˜¯ç®¡ç† DOM refï¼Œå®ƒç»å¯¹ä¸æ˜¯ **createRef** çš„ç¿»ç‰ˆã€‚ **useRef** å¯ä»¥åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸€ä¸ªå€¼ã€‚ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œå½“ **useRef** çš„å½“å‰å€¼æ”¹å˜æ—¶ï¼Œç»„ä»¶ä¸ä¼šé‡æ–°å‘ˆç°ï¼Œå¦‚æœæ‚¨æƒ³è¦é‚£ä¸ªæ•ˆæœï¼Œè¯·ä½¿ç”¨ **useState** é’©å­ğŸ‘ğŸ‘ğŸ‘

è¿™é‡Œæœ‰ä¸€äº›å¾ˆå¥½çš„èµ„æºä¾›æ‚¨å‚è€ƒ:

*   [ååº” createRef API](https://medium.com/@accardo.steven/throw-the-flag-reacts-createref-api-callbackref-api-and-forwardref-api-cb464231cca1)
*   [React useRef æ–‡æ¡£](https://reactjs.org/docs/hooks-reference.html#useref)
*   [åœ¨ React çš„ useEffect é’©å­ä¸­å¤„ç†æ·±åº¦å¯¹è±¡æ¯”è¾ƒ](https://egghead.io/lessons/react-handle-deep-object-comparison-in-react-s-useeffect-hook-with-the-useref-hook)

## ğŸ™ ğŸ’ªæ„Ÿè°¢é˜…è¯»ï¼

æˆ‘å¾ˆæƒ³å¬å¬ä½ çš„æƒ³æ³•å’Œåé¦ˆã€‚æ¬¢è¿åœ¨ä¸‹é¢è¯„è®ºï¼

### âœï¸æ‰€å†™

èƒ¡ä¼Šç‰¹æ—ğŸ”¥ ğŸ©â™¥ï¸ â™ ï¸ â™¦ï¸ â™£ï¸ğŸ¤“

è½¯ä»¶å¼€å‘è€…|é­”æ³•çˆ±å¥½è€…

æ‰“æ‹›å‘¼ğŸ‘‹åœ¨

âœ… [Github](https://github.com/HuyAms)

âœ… [é¢†è‹±](https://www.linkedin.com/in/huy-trinh-dinh-253534131/)

âœ… [Medium](https://medium.com/@trnhnhhuy)