# ç”¨ Vue JS å’Œ Pouch DB å¤„ç†åˆ†é¡µ

> åŸæ–‡:[https://dev . to/obbap/handling-pagination-with-vue-js-and-pouch-d b-4146](https://dev.to/obbap/handling-pagination-with-vue-js-and-pouch-db-4146)

# [t1ã€å¯¼è¨€ã€‘](#introduction-%EF%B8%8F)

å½“æ¥è‡ªæœåŠ¡å™¨çš„å“åº”ä»…æ¥è‡ªä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨å‰ç«¯åˆ†é¡µï¼Œè¿™å°±æ›´å®¹æ˜“å¤„ç†äº†ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„æ‰€æœ‰æ•°æ®éƒ½åœ¨å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åªåœ¨ç‰¹å®šé¡µé¢ä¸Šæ˜¾ç¤ºä¸€ç³»åˆ—ç´¢å¼•ã€‚å› æ­¤ï¼Œå¦‚æœå“åº”æ˜¯ä¸€ä¸ª 400 é¡¹çš„æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥æ¯é¡µæ˜¾ç¤º 20 é¡¹ã€‚ä½†æ˜¯å¦‚æœç”±äºæŸç§åŸå› ï¼Œæ¥è‡ªæœåŠ¡å™¨çš„å“åº”ä¸èƒ½å‡ºç°åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨åˆ†é¡µæˆ–æ— é™æ»šåŠ¨ã€‚è¿™å–å†³äºç”¨ä¾‹ã€‚é‚£ä¹ˆåˆ†é¡µçš„æ€§èƒ½é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹å§ã€‚

# [](#the-problem)é—®é¢˜ğŸ‰

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç«¯ç‚¹ï¼Œå®ƒè¿”å›ä¸€ä¸ªè´Ÿè½½ï¼Œæ¯”å¦‚:

```
{
    totalNumber: 1000,
    data: [0,....,20],
    pageNumber: 1
} 
```

ä»å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ€»å…±æœ‰å¤šå°‘æ•°æ®ï¼Œä»¥åŠæˆ‘ä»¬æ‰€åœ¨çš„ç‰¹å®šé¡µé¢ï¼Œå› æ­¤æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬æ‹¥æœ‰çš„é¡µç èŒƒå›´ã€‚å¦‚æœæ¯ä¸ªå“åº”è¿”å›ä¸€ä¸ªåŒ…å« 20 ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰(1000 / 20)ä¸ªé¡µé¢ã€‚

| one | Two | three | ... | Fifty |

å¯¹äºåˆ†é¡µï¼Œå¦‚æœæˆ‘ä»¬å•å‡»â€œ1â€ï¼Œå®ƒä¼šè·å–å‰äºŒåä¸ªå…ƒç´ ã€‚ç¬¬ 2 é¡µè·å–æ¥ä¸‹æ¥çš„ 20 ä¸ªå…ƒç´ ï¼Œå›åˆ°ç¬¬ 1 é¡µå†æ¬¡è·å–å‰ 20 ä¸ªå…ƒç´ ã€‚æ‰€ä»¥æ¥æ¥å›å›çœŸçš„ä¼šå¾ˆæ…¢ï¼Œè€Œä¸”éå¸¸éº»çƒ¦ã€‚

# [](#pouchdb-a-solution)PouchDB:ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ

ä¸ºäº†å¤„ç†å®¢æˆ·ç«¯(æµè§ˆå™¨)ä¸Šçš„å­˜å‚¨ï¼Œæˆ‘ä»¬æœ‰æœ¬åœ°å­˜å‚¨ã€ä¼šè¯å­˜å‚¨ã€ç´¢å¼•æ•°æ®åº“ã€cookies ç­‰ã€‚[å°è¢‹ DB](https://pouchdb.com/) å®é™…ä¸Šæ˜¯åœ¨å¼•æ“ç›–ä¸‹ä½¿ç”¨ IndexedDBã€‚å®ƒä¸»è¦ç”¨äºç¦»çº¿åº”ç”¨ç¨‹åºï¼Œä¸å®æ—¶æ•°æ®åº“è‡ªåŠ¨åŒæ­¥ï¼Œå¾ˆå¯èƒ½æ˜¯ Couch DBã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ Vue JS æ¥è§£é‡Šè¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ã€‚

```
npm i --save vuejs-paginate pouchdb-browser pouch-vue pouchdb-find pouchdb-live-find axios

vue create pouchdb-app 
```

åœ¨ main.js æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†å®‰è£…å¹¶åˆå§‹åŒ–æ•°æ®åº“ã€‚

```
// main.js 
import Vue from 'vue';
import Paginate from 'vuejs-paginate';
import PouchDB from 'pouchdb-browser';
import * as pouchVue from 'pouch-vue';

PouchDB.plugin(require('pouchdb-find'));
PouchDB.plugin(require('pouchdb-live-find'));

Vue.component('paginate', Paginate);

Vue.use(pouchVue, {
    pouch: PouchDB, 
    defaultDB: 'users_database' //You can give it any name 
});

// ............. 
```

è½¬åˆ° vue æ–‡ä»¶ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬æ˜¾ç¤ºäº†æ‰€æœ‰çš„ç”¨æˆ·ã€‚å‡è®¾æˆ‘ä»¬çš„ç«¯ç‚¹çš„å“åº”æ˜¯è¿™æ ·çš„ã€‚

```
{
    total:'',
    pageNumber:'',
    users:[
        {
            firstname: '',
            lastname:''
        },
        {
            firstname: '',
            lastname:''
        },
    ]
} 
```

æˆ‘ä»¬å¯ä»¥åœ¨ vue æ–‡ä»¶ä¸Šæ˜¾ç¤ºæˆ‘ä»¬çš„ç¬¬ä¸€æ‰¹ç”¨æˆ·ã€‚

```
<!-- users.vue -->
<div>
    <!--
        getUsers: {
            users: [],
            total: '' ,
            pageNumber: '' 
        }
    -->
    <v-data-table
        :headers="headers"
        :items="getUsers.users"  
        v-if="getUsers.users"
        hide-actions
    >
        <template slot="items" slot-scope="props">
        <td>{{ props.item.firstname}} {{props.item.lastname}}</td>
        </template>
    </v-data-table>
    <paginate
            :page-count="pageCount"
            :click-handler="fetchNext"
            :prev-text="'Prev'"
            :next-text="'Next'"
        />
</div> 
```

é¦–å…ˆï¼Œæœ‰ä¸€ä¸ªè¡¨æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·çš„åå­—å’Œå§“æ°ã€‚æ­¤è¡¨æ¥è‡ª[å¹´](https://vuetifyjs.com/en/)æœˆã€‚

å…¶æ¬¡ï¼Œæˆ‘ä»¬æœ‰ ***åˆ†é¡µ*** ç»„ä»¶ï¼Œå®ƒæœ‰ ***é¡µé¢è®¡æ•°*** å±æ€§ï¼Œè¿™æ˜¾ç¤ºäº†æˆ‘ä»¬æ‹¥æœ‰çš„åˆ†é¡µé¡µé¢çš„æ•°é‡ã€‚å¦‚æœå“åº”æ€»å…±æœ‰ 400 ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨æ¯ä¸ªè¯·æ±‚ä¸­æ”¶åˆ° 20 ä¸ªç”¨æˆ·ï¼Œé‚£ä¹ˆé¡µé¢è®¡æ•°å°†æ˜¯(400 / 20) 20ã€‚***click-handler***propï¼Œæ¥å—ä¸€ä¸ªå½“ä»»ä½•é¡µé¢è¢«ç‚¹å‡»æ—¶è¿è¡Œçš„å‡½æ•°ã€‚ ***ä¸Šä¸€é¡µ*** å’Œ ***ä¸‹ä¸€é¡µ*** é“å…·åªæ¥å—ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µè¦æ˜¾ç¤ºçš„æ–‡å­—ã€‚

[![The flow](../Images/dad2ec527403db277288d371d02ee193.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--fj2gEb-i--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/pbaba/image/upload/v1561991050/RBE8Xtr5PTvu_1_jnf18u.jpg)

ä½¿ç”¨ä¸Šå›¾ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª ***getAllUsers*** åŠ¨ä½œï¼Œè¯¥åŠ¨ä½œè·å–ç¬¬ä¸€æ‰¹ç”¨æˆ·ï¼Œå°†ä»–ä»¬æäº¤åˆ° stateï¼Œç„¶åå°†ä»–ä»¬å­˜å‚¨åœ¨ PouchDB ä¸­ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨**T5 ä»æˆ‘ä»¬çš„å•ä¸ªæ–‡ä»¶ç»„ä»¶(SFC)è®¿é—® Pouch DBã€‚$è·åŒ…** ã€‚è¿™å°†åœ¨ ***users.vue*** æ–‡ä»¶ä¸­çš„ ***created()*** ç”Ÿå‘½å‘¨æœŸé’©å­ä¸Šå®Œæˆã€‚

```
//....
<script>
    //...users.vue
    import {mapActions, mapGetters} from 'vuex'; //Using vuex for our store
    export default {
        data(){
            return {
                headers: [
                    {
                        text: 'Name',
                        value: 'firstname',
                        align: 'left'
                    }
                ]
            }
        },
        created(){
            this.getAllUsers({
                pageNumber: 1, // Fetch first page
                pouch: this.$pouch //pass pouch db reference to action
            })
        },
        methods:{
            ...mapActions(['getAllUsers'])
        },
        computed:{
            ...mapGetters(['getUsers'])
        }
    }
</script> 
```

ç°åœ¨æˆ‘ä»¬å°†ç¼–å†™ getAllUsers åŠ¨ä½œï¼Œä»¥åŠå®Œæˆæˆ‘ä»¬çš„å­˜å‚¨æ‰€éœ€çš„å…¶ä»–å…ƒç´ ã€‚

```
//store.js
import Vue from 'vue';

//mutation type
const UPDATE_ALL_USERS = 'UPDATE_ALL_USERS';

//state
const state = {
    allUsers: null,
};

const getters = {
    getUsers: state => state.allUsers
}

const actions = {
    getAllUsers({commit}, data){
        // retrieve the pouch db reference and page number we just sent
        const {pageNumber, pouch} = data;

        //Using axios
        Vue.axios.get(`allUsers/?page=${pageNumber}`)
            .then(res =>{
                console.log('data retrieved');
                /*
                    res: {
                        users:
                        total:
                        pageNumber:
                    }
                */
                // store data in pouch db
                pouch.put({
                    _id: `${pageNumber}`,
                    users: res.data.users
                })
                .then(()=>{
                    console.log('your data has been stored');
                })
                .catch(e => console.log(e))
            });
        commit(UPDATE_ALL_USERS, res.data);
    }
}

const mutations = {
    [UPDATE_ALL_USERS](state, data){
        state.allUsers = data;
    }
} 
```

å› æ­¤ï¼Œåœ¨å®ƒä»æœåŠ¡å™¨è·å–ç‰¹å®šçš„ä¸€æ‰¹ç”¨æˆ·åï¼Œå®ƒå°†å®ƒç¼“å­˜åœ¨ pouch db ä¸­ï¼Œç”¨ ***pageNumber*** å˜é‡ä½œä¸º idï¼Œç”¨æˆ·ä½œä¸ºå®é™…æ•°æ®ã€‚

æœ€åï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ fetchNext å‡½æ•°ï¼Œå®ƒåœ¨æ¯æ¬¡ç‰¹å®šé¡µé¢è¢«ç‚¹å‡»æ—¶å‘ç”Ÿã€‚å› æ­¤ï¼Œå¦‚æœé¡µé¢è¢«ç‚¹å‡»ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥æˆ‘ä»¬çš„ç¼“å­˜ï¼Œå¦‚æœå®ƒåœ¨é‚£é‡Œï¼Œæ˜¾ç¤ºç»“æœï¼Œå¦‚æœæ²¡æœ‰è°ƒç”¨ getAllUsers æ“ä½œï¼Œå®ƒå°†ä»æœåŠ¡å™¨è·å–ï¼Œç„¶åç¼“å­˜ã€‚

```
<!--users.vue-->
<script>
//.... This is a continuation of the users.vue file above
    methods: {
        fetchNext(event){
            // event is the particular number clicked
            this.$pouch.get(`${event}`)
                .then((doc) => {
                    //if it is found, store in the cachedUsers variable
                    this.cachedUsers = doc.users;
                })
                .catch(e => {
                    //if that page wasn't found, run the getAllUsers function
                    if(e.name === 'not_found'){
                        return this.getAllUsers({
                            pageNumber: event,
                            pouch: this.$pouch
                        })
                    }
                })
        }
    }
</script> 
```

æˆ‘ä»¬éœ€è¦ ***cachedUsers*** å˜é‡ï¼Œå› ä¸º ***getUsers*** å˜é‡åªæ˜¯ä¸€ä¸ª getterï¼Œå¦‚æœåœ¨æˆ‘ä»¬çš„ç¼“å­˜ä¸­æ‰¾åˆ°ç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿå°†æˆ‘ä»¬çš„å˜é‡è®¾ç½®ä¸ºè¯¥å€¼ã€‚

```
<script>
    //.....
    computed:{
        ...mapGetters(['getUsers']),
        cachedUsers: {
            get(){
                // return the getter
                return this.getUsers
            },
            set(value){
                //use the setter
                this.getUsers.users = value;
            }
        },
        pageCount(){
            // get the total number of users and the amount of users per page to get the number of pages.
            const {total, users} = this.cachedUsers;
            //fix to one decimal space
            const numberOfPages = (Number(total) / users.length).toFixed(1);
            //if there is a decimal value, increase the number of pages by 1.
            return Number(numberOfPages.split('.')[1]) > 0
                ? Math.round(Number(numberOfPages)) + 1
                : Math.round(Number(numberOfPages));
        }
    }
</script> 
```

# [t1ã€ç»“è®ºã€‘](#conclusion)

è¿™åªæ˜¯å±•ç¤ºäº†æˆ‘ä»¬å¯ä»¥åœ¨å‰ç«¯å¤„ç†åˆ†é¡µçš„æ–¹æ³•ä¹‹ä¸€ï¼Œå®ƒä¹Ÿç¡®ä¿äº†äº‹æƒ…çš„é€Ÿåº¦ã€‚æœ€è¿‘å¸®äº†æˆ‘ä¸€ä¸ªå¿™ï¼Œä»€ä¹ˆæ¡†æ¶éƒ½å¯ä»¥å†™ã€‚ç†è§£è¿™ä¸ªæ¦‚å¿µå¾ˆé‡è¦ï¼Œæˆ‘å¸Œæœ›ä½ åšåˆ°äº†ã€‚æ„Ÿè°¢é˜…è¯»ï¼

è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨æˆ‘çš„åšå®¢ä¸Š