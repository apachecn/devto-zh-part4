# ä¿„ç½—æ–¯æ–¹å—:é€‰æ‹©å·¥å…·å’Œå»ºç«‹é¡¹ç›®

> åŸæ–‡ï¼š<https://dev.to/sleeplessbyte/tetris-choosing-the-tools-and-setting-up-the-project-4kh6>

> ğŸ”™è¿™æ˜¯ä½¿ç”¨ React æ„å»ºä¿„ç½—æ–¯æ–¹å—å…‹éš†ç³»åˆ—çš„ç¬¬äºŒéƒ¨åˆ†ã€‚å¦‚æœä½ é”™è¿‡äº†ç¬¬ä¸€ä¸ªï¼Œåœ¨è¿™é‡Œæ‰¾åˆ°å®ƒ[ã€‚](https://dev.to/sleeplessbyte/tetris-building-a-game-using-javascript-3j6f)

ä»Šå¤©æˆ‘ä»¬å°†æœç€å¼€å§‹è¿™ä¸ªé¡¹ç›®è¿ˆå‡ºä¸€æ­¥ã€‚æˆ‘å°†è®¨è®ºæ‚¨åœ¨å¼•å¯¼è‡ªå·±çš„é¡¹ç›®æ—¶å¯èƒ½ä¼šé‡åˆ°çš„å„ç§é€‰é¡¹å’Œé€‰æ‹©ã€‚è°ˆè®ºè¿™äº›å¾ˆé‡è¦â€”â€”ç‰¹åˆ«æ˜¯å› ä¸ºå¾ˆå¤šæ•™ç¨‹å’ŒæŒ‡å—å®Œå…¨è·³è¿‡äº†*ä¸ºä»€ä¹ˆ*â€”â€”ä½ ä¼šæ³¨æ„åˆ°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„äº‹æƒ…éƒ½éå¸¸æ¸…æ¥šï¼Œéƒ½æœ‰ä¸€ä¸ªå‰è¿›çš„æ–¹å‘ã€‚

> ğŸ®åœ¨è¿™ä¸ªç³»åˆ—ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºæ„å»ºä¿„ç½—æ–¯æ–¹å—å…‹éš†çš„æ‰€æœ‰æ­¥éª¤ï¼Œéµå®ˆ[ä¿„ç½—æ–¯æ–¹å—æŒ‡å—](https://tetris.fandom.com/wiki/Tetris_Guideline)ï¼Œè¿™æ˜¯[ä¿„ç½—æ–¯æ–¹å—å…¬å¸](https://tetris.fandom.com/wiki/The_Tetris_Company)ä¸ºåˆ¶ä½œæ‰€æœ‰æ–°çš„(2001 å¹´åŠä»¥å)*ä¿„ç½—æ–¯æ–¹å—*æ¸¸æˆäº§å“åœ¨å½¢å¼ä¸Šç›¸ä¼¼è€Œå¼ºåˆ¶æ‰§è¡Œçš„å½“å‰è§„èŒƒã€‚
> 
> ğŸ›‘ *ä¿„ç½—æ–¯æ–¹å—*æ˜¯æœ‰è®¸å¯çš„ï¼Œè¿™æ„å‘³ç€å¦‚æœä½ æ‰“ç®—ç”¨è¿™ä¸€ç³»åˆ—çš„æ–‡ç« æ¥å»ºé€ ä½ è‡ªå·±çš„è¡—æœºæ‹¼å›¾ï¼Œç¡®ä¿éµå®ˆæ³•å¾‹ï¼Œå¦‚æœä½ æ‰“ç®—å•†ä¸šå‘è¡Œå®ƒã€‚å³ä½¿ä½ å…è´¹æä¾›äº†ä¸€ä¸ªå…‹éš†ï¼Œä½ ä»ç„¶å¯ä»¥å¾—åˆ°ä¸€ä¸ªåœæ­¢å’Œç»ˆæ­¢ã€‚[è¿™ä¸ª reddit å¸–å­](https://www.reddit.com/r/gamedev/comments/5kkk82/law_concerns_when_creating_a_game_inspired_by/)éå¸¸å…¨é¢åœ°ä»‹ç»äº†å¦‚ä½•å»åšè¿™ä»¶äº‹ã€‚æ­¤å¤–ï¼Œ[è¿™ç¯‡ Ars Technica æ–‡ç« ](https://arstechnica.com/gaming/2012/06/defining-tetris-how-courts-judge-gaming-clones/)ä»¥*ä¿„ç½—æ–¯æ–¹å—*å’Œæ‰€è°“çš„å…‹éš†*å®‹æ—»æµ©*ä¸ºä¾‹ï¼Œæ·±å…¥æ¢è®¨äº†æ³•åº­å¦‚ä½•è¯„åˆ¤æ¸¸æˆå…‹éš†ä½“ã€‚
> 
> ğŸ“šè¿™ä¸ªç³»åˆ—çº¯ç²¹æ˜¯ä¸€ä¸ªæ•™è‚²ï¼Œéå•†ä¸šèµ„æºã€‚æˆ‘ä»¬å°†ä»…ä½¿ç”¨ *fandom wiki* ä½œä¸ºèµ„æºï¼Œå¹¶ä¸”ä»…ä½¿ç”¨ä¿„ç½—æ–¯æ–¹å—è¿™ä¸ªåç§°æ¥è¡¨ç¤ºæ¸¸æˆçš„*ç±»å‹ï¼Œè€Œä¸æ˜¯å®é™…çš„å…¬å¸ã€æ¸¸æˆæˆ–å“ç‰Œã€‚*

[![Photo showing various machines in the Arcade "Lightroom", in New Brighton, Wallasey, United Kingdom](img/ae87a369791f52607e9f562de58c3622.png "Photo by Carl Raw (https://unsplash.com/@carltraw) on Unsplash (https://unsplash.com/)")](https://res.cloudinary.com/practicaldev/image/fetch/s--dJcgWzhE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kmddjw275q1tzeym5f74.jpg)

## ç›®å½•

*   [ç›®å½•](#table-of-contents)
*   [æ¸¸æˆå¼•æ“](#the-game-engine)
*   [å·¥å…·é“¾](#the-toolchain)
    *   [å¥—é¤ç®¡ç†](#package-management)
    *   [æ†æ‰æœº](#bundler)
    *   [ç¼–è¯‘å™¨](#compiler)
    *   [æ—æŒºå’Œæ ·å¼å¯¼è½¨](#linting-and-styleguides)
    *   [æµ‹è¯•åº“](#testing-libraries)
    *   [åŸºç¡€åº“](#base-Library)
    *   [è‡ªä¸¾](#bootstrap)
*   [é¡¹ç›®åˆå§‹åŒ–](#initialisation-of-the-project)
*   [æ­£ç¡®è®¾ç½®`typescript`](#setting-up-raw-typescript-endraw-correctly)
*   [æ­£ç¡®è®¾ç½®`babel`](#setting-up-raw-babel-endraw-correctly)
*   [æ­£ç¡®è®¾ç½®`eslint`](#setting-up-raw-eslint-endraw-correctly)
    *   [æµ‹è¯•`eslint`é…ç½®](#testing-the-raw-eslint-endraw-configuration)
    *   [å¾®è°ƒè§„åˆ™](#fine-tuning-the-rules)
*   [æ­£ç¡®è®¾ç½®`jest`](#setting-up-raw-jest-endraw-correctly)
    *   [å¯ç”¨`jest-dom`æ‰©å±•](#enabling-raw-jest-dom-endraw-extensions)
    *   [è·å–è¦†ç›–æŠ¥å‘Š](#getting-a-coverage-report)
*   [æ­£ç¡®è®¾ç½®`prettier`](#setting-up-raw-prettier-endraw-correctly)
    *   [è‡ªåŠ¨æ ¼å¼åŒ–](#automatically-formatting)
*   [ç»“è®º](#conclusion)

## æ¸¸æˆå¼•æ“

å› ä¸ºè¿™ä¸ªç³»åˆ—æœ‰ä¸€ä¸ªæ¸¸æˆä½œä¸ºå®ƒçš„äº¤ä»˜ç‰©ï¼Œæ‰€ä»¥é€‰æ‹©ä¸€ä¸ªæ¸¸æˆå¼•æ“æ˜¯æ˜æ™ºçš„ã€‚ä»ç»´åŸºç™¾ç§‘æ–‡ç« ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¸¸æˆå¼•æ“æ˜¯ä¸€ä¸ªè½¯ä»¶å¼€å‘ç¯å¢ƒï¼Œä¸ºäººä»¬æ„å»ºè§†é¢‘æ¸¸æˆè€Œè®¾è®¡ã€‚æœ‰ä¸€ä¸ªå®Œæ•´çš„[æ¸¸æˆå¼•æ“åˆ—è¡¨](https://en.wikipedia.org/wiki/List_of_game_engines)ï¼Œå®ƒå¹¶ä¸å®Œæ•´ï¼Œé€‰æ‹©å“ªä¸€ä¸ªç”¨äºä½ çš„æ¸¸æˆæ˜¯å¦‚æ­¤çš„åŠªåŠ›ï¼Œä»¥è‡³äº[è®¸å¤š](https://www.youtube.com/watch?v=ibK3Ds7nDyk) [æœ‰](https://www.youtube.com/watch?v=2tZK75R2K2c) [å®Œæ•´çš„](https://www.linkedin.com/pulse/how-choose-game-engine-yann-kronberg/) [æ–‡ç« ](https://www.technobyte.org/which-game-engine-should-you-choose/) [æˆ–](https://blackshellmedia.com/2016/09/29/6-crucial-questions-ask-choosing-game-engine/) [è§†é¢‘](https://www.youtube.com/watch?v=Tnci1hO0prc) [å…³äºå®ƒ](http://mightyfingers.com/blog/11-steps-for-choosing-the-best-game-engine/)ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œå¦‚æœä½ æ­£åœ¨ä»å¤´å¼€å§‹å¼€å‘ä¸€æ¬¾æ¸¸æˆï¼Œå¹¶ä¸”ä½ æœ‰æ—¶é—´ã€æ½œåŠ›å’Œé€‰æ‹©ï¼Œä½ åªéœ€è¦é—®è‡ªå·±ä»¥ä¸‹é—®é¢˜:

1.  æˆ‘æƒ³ç©å¤šäººæ¸¸æˆå—ï¼ŸæŒ‘[è™šå¹»å¼•æ“](https://www.unrealengine.com/en-US/)ã€‚
2.  æˆ‘æƒ³å»ºä¸€ä¸ªç¬¬ä¸€äººç§°å°„å‡»æ¸¸æˆå—(å•äººè¿˜æ˜¯å¤šäºº)ï¼ŸæŒ‘[è™šå¹»å¼•æ“](https://www.unrealengine.com/en-US/)ã€‚
3.  å¦åˆ™ï¼Œé€‰æ‹© [Unity](https://unity.com/) ã€‚

æˆ‘æ˜¯æ ¹æ®ä¸€å°æ—¶åˆä¸€å°æ—¶çš„ GDC ä¼šè°ˆå’Œå·¥ä½œåˆ—è¡¨å¾—å‡ºè¿™ä¸ªç»“è®ºçš„ï¼è¿˜æœ‰è®¸å¤šæ›´æœ‰è¶£çš„å¼•æ“ï¼Œä½†æ˜¯å¦‚æœä½ éœ€è¦å…¶ä»–äºº*ä¿¡ä»»*å’Œ*èƒ½å¤Ÿä½¿ç”¨çš„ä¸œè¥¿ï¼Œå¾ˆå¿«*ï¼Œä½ å¯èƒ½éœ€è¦ä»è¿™ä¸¤ä¸ªä¸­é€‰æ‹©ä¸€ä¸ªã€‚

å¦‚æœä½ æ˜¯ä¸€ä¸ªäººçš„å•†åº—ï¼Œå¹¶ä¸”ä¸ºç½‘ç»œè€Œå»ºï¼Œæœ‰ä¸€ä¸ª javascript æ¸¸æˆå¼•æ“çš„[é›†åˆï¼ŒåŒ…æ‹¬ä¼—æ‰€å‘¨çŸ¥çš„é€‰é¡¹ï¼Œå¦‚](https://github.com/collections/javascript-game-engines) [GameMaker Studio (2)](https://www.yoyogames.com/gamemaker) ã€‚

*ç„¶è€Œ*ï¼Œæ—¢ç„¶è¿™ä¸ªç³»åˆ—æ˜¯ç”¨ *react* å»ºé€ ä¸€ä¸ªä¿„ç½—æ–¯æ–¹å—å…‹éš†ä½“ï¼Œé‚£å°±æ˜¯**æ­£æ˜¯æˆ‘è¦ç”¨çš„**ã€‚é—®é—®ä½ è‡ªå·±:React æ˜¯è¿™é¡¹å·¥ä½œçš„åˆé€‚å·¥å…·å—ï¼Ÿå’©ï¼Œå¤§æ¦‚ä¸ä¼š(å› ä¸ºæœ‰*æ›´å¥½çš„*å·¥å…·ã€‚ä»…ä»…å› ä¸ºä½ èƒ½è®©æŸæ ·ä¸œè¥¿å·¥ä½œï¼Œå¹¶ä¸æ„å‘³ç€å®ƒæ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚è¿™é‡è¦å—ï¼Ÿè¿™å–å†³äºå’Œä½ ä¸€èµ·å·¥ä½œçš„äººä»¥åŠå›´ç»•æŠ½è±¡å’ŒæŒ‘æˆ˜å·¥ä½œçš„æ„æ„¿ã€‚

## å·¥å…·é“¾

å› ä¸º`react`åº”è¯¥ç”¨äºè¿™ä¸ªé¡¹ç›®ï¼Œæ‰€ä»¥è¿™ä¸ªé¡¹ç›®å¾ˆå¯èƒ½ä¼šè¢«æ„å»ºä¸ºä¸€ä¸ª JavaScript åº”ç”¨ç¨‹åºã€‚JavaScript é¡¹ç›®(å’Œåº“)å¾€å¾€æœ‰ä¸€ä¸ª(å­)å·¥å…·é›†ï¼Œæˆ‘ç§°ä¹‹ä¸ºâ€œå·¥å…·é“¾â€ã€‚

### å¥—é¤ç®¡ç†

åŒ…ç®¡ç†å™¨æœ‰å®ƒè‡ªå·±çš„åŠŸèƒ½:å®ƒç®¡ç†åŒ…ã€‚åœ¨æ‚¨çš„åŒ…*æ¸…å•*ä¸­åˆ—å‡ºçš„ JavaScript æ¨¡å—(é¡¹ç›®æ‰€ä¾èµ–çš„åŒ…çš„é›†åˆï¼Œä¾‹å¦‚åˆ—å‡º URL æˆ–åç§°ï¼Œä»¥åŠç‰ˆæœ¬æˆ–ç‰ˆæœ¬èŒƒå›´)æ˜¯æ‚¨çš„é¡¹ç›®çš„ä¾èµ–é¡¹ã€‚ç›®å‰æ¯”è¾ƒæµè¡Œçš„æœ‰[çº±](https://yarnpkg.com/en/)å’Œ [NPM](https://www.npmjs.com/) ã€‚

æ‚¨å¯èƒ½ä¼šé—®:â€œä½†æ˜¯æˆ‘ä¸æ€»æ˜¯éœ€è¦ä¸€ä¸ªåŒ…ç®¡ç†å™¨å—ï¼Ÿâ€ç­”æ¡ˆæ˜¯ç®€çŸ­çš„**ä¸**ã€‚æ‚¨è¿˜å¯ä»¥é€‰æ‹©:

*   åœ¨æœ¬åœ°åŒ…å«æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œä¾‹å¦‚é€šè¿‡*å‡ºå”®*(å°†ä¾èµ–é¡¹å­˜å‚¨åˆ°é¡¹ç›®æœ¬åœ°çš„è¡Œä¸º)å®ƒä»¬ã€‚è¿™æ„å‘³ç€ä½ *æ€»æ˜¯*æœ‰ä¸€ä¸ªå·¥ä½œå‰¯æœ¬ï¼Œä¸éœ€è¦ç½‘ç»œã€‚
*   ä½¿ç”¨ä¸€ä¸ªä¸ä½¿ç”¨ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„åŒ…çš„è¿è¡Œæ—¶ï¼Œæ¯”å¦‚ [deno](https://deno.land/) ï¼Œä½†æ˜¯ä¹Ÿä½¿ç”¨ [unpkg](https://unpkg.com/) ï¼Œè¿™ä½¿å¾—ä½ çš„ HTML æ–‡ä»¶é›†*ä¾èµ–æ¸…å•*å’Œ*ç®¡ç†å™¨*äºä¸€èº«ã€‚
*   ä½¿ç”¨ç³»ç»ŸåŒ…ï¼Œå¦‚`.deb` ian åŒ…ï¼Œå¹¶ä½¿ç”¨ç³»ç»Ÿå·¥å…·ï¼Œå¦‚`make`å’Œ Makefile æ¥ç®¡ç†ä¾èµ–å…³ç³»ã€‚è¿™åœ¨æŠ€æœ¯ä¸Šä»ç„¶ä½¿ç”¨*åŒ…ç®¡ç†å™¨*ï¼Œä½†æ˜¯ä¸`Yarn`æˆ–`npm`é€‰é¡¹çš„æ–¹å¼ä¸åŒã€‚

> ğŸ’æˆ‘é€‰æ‹©äº†åŒ…æ¸…å•åœ¨`package.json`ä¸­çš„`Yarn`ã€‚æˆ‘è®¤ä¸ºæœ‰å¾ˆå¤šåˆç†çš„ç†ç”±æ¥é€‰æ‹©ä¸Šé¢çš„ä»»ä½•ä¸€ä¸ªé€‰é¡¹ã€‚æˆ‘è‡ªå·±å·²ç»ä½¿ç”¨äº†å…¶ä¸­çš„å¤§éƒ¨åˆ†ï¼ŒåŒ…æ‹¬ç°åœ¨å·²ç»åºŸå¼ƒçš„å·¥å…·ï¼Œå¦‚[é²å°”](https://bower.io/)ã€‚è¿™é€šå¸¸å¹¶ä¸é‡è¦ï¼Œåº”è¯¥æ ¹æ®å…¬å¸æ”¿ç­–æˆ–é¡¹ç›®å›¢é˜Ÿçš„è°ƒæ•´æ¥åšå‡ºå†³å®šã€‚

### æ†ç»‘è€…

JavaScript ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ†ç»‘å™¨ä¸è¦ä¸ Ruby ç”Ÿæ€ç³»ç»Ÿä¸­çš„*åŒ…ç®¡ç†å™¨* [æ†ç»‘å™¨](https://bundler.io)æ··æ·†ã€‚åœ¨ JavaScript ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œå®ƒé€šå¸¸è´Ÿè´£ä»¥ä¸‹ä¸€ç»„ç‰¹æ€§æˆ–å…¶ä¸­çš„ä¸€ä¸ªå­é›†:

*   æ”¶é›†é¡¹ç›®ä¸­çš„æ‰€æœ‰èµ„æº(JSã€HTMLã€æ–‡ä»¶ã€å›¾åƒã€CSS)
*   å‰¥ç¦»æœªä½¿ç”¨çš„èµ„äº§(æƒ³æƒ³æ ‘æ‘‡åŠ¨ã€æ­»ä»£ç /å¯¼å…¥æ¶ˆé™¤)
*   åº”ç”¨è½¬æ¢(transpilationï¼Œä¾‹å¦‚ Babelï¼Œpost processingï¼Œä¾‹å¦‚ PostCSS)
*   è¾“å‡ºä»£ç åŒ…(ç»„å—ã€ä»£ç åˆ†å‰²ã€ç¼“å­˜å‹å¥½è¾“å‡º)
*   é”™è¯¯è®°å½•(æ›´å‹å¥½)
*   çƒ­æ¨¡å—æ›¿æ¢(åœ¨å¼€å‘æœŸé—´è‡ªåŠ¨æ›´æ–°æ¨¡å—/èµ„äº§)

æˆ‘è¿‡å»ç”¨è¿‡å¹¶ä¸”ç°åœ¨è¿˜åœ¨ä½¿ç”¨çš„ä¸€äº›å·¥å…·æœ‰ [Webpack](https://webpack.js.org/) ã€ [Parcel](https://parceljs.org/) ã€ [Rollup](https://rollupjs.org/guide/en/) ã€ [microbundle](https://www.npmjs.com/package/microbundle) ã€ [Browserify](http://browserify.org/) å’Œ [Brunch](https://brunch.io/) ã€‚åŒæ ·çš„*å¯ä»¥é€šè¿‡ä½¿ç”¨ [Grunt](https://gruntjs.com/) ä¹‹ç±»çš„ä»»åŠ¡è¿è¡Œå™¨æˆ–è€…ä½¿ç”¨ [Gulp](https://gulpjs.com/) æ¥å®ç°*ï¼Œä½†æ˜¯æ ¹æ®æˆ‘çš„ç»éªŒï¼Œè¿™äº›å¾€å¾€ä¼šå¾ˆå¿«å¤±æ§ã€‚

è¿™é‡Œçš„é€‰æ‹©å¹¶ä¸é‡è¦ã€‚æˆ‘è®¤ä¸ºä»–ä»¬éƒ½æœ‰è‡ªå·±çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œä½ åº”è¯¥é€‰æ‹©ä½ è§‰å¾—èˆ’æœçš„ã€‚å¦‚æœä½ é¢„è§åˆ°ä½ éœ€è¦å®šåˆ¶å¾ˆå¤šä¸œè¥¿ï¼Œæœ‰äº›ä¼šæ¯”å…¶ä»–çš„æ›´å¥½ã€‚å¦‚æœä½ çš„å›¢é˜Ÿæ¯”å…¶ä»–äººæ›´äº†è§£ä»–ä»¬ä¸­çš„ä¸€ä¸ªï¼Œé‚£å¯èƒ½æ˜¯æœ‰åˆ©çš„ã€‚æ€»çš„æ¥è¯´:**ä¸€ä¸ªä¼Ÿå¤§çš„æ†ç»‘è€…æ˜¯å¯ä»¥æ›¿æ¢çš„**ã€‚

> ğŸ’æˆ‘è¿˜æ²¡æœ‰é€‰æ‹©ä»»ä½•ä¸œè¥¿ï¼æˆ‘å°†è®©å·¥å…·é“¾çš„å…¶ä½™éƒ¨åˆ†æ¥å†³å®šæˆ‘æƒ³ä½¿ç”¨å“ªç§æ†æ‰æœºã€‚å¦‚æœå¤„ç†å¾—å½“ï¼Œä»¥åæ›´æ¢æ†æ‰æœºçš„æˆæœ¬ä¸ä¼šå¾ˆé«˜ã€‚ä¹Ÿè®¸æˆ‘å°†ä¸å†éœ€è¦*ä»»ä½•*ã€‚

### ç¼–è¯‘å™¨

ä»æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œbabel ä¸»è¦æ˜¯ä¸€ä¸ª *transpiler* ï¼Œå› ä¸ºå®ƒå°†ä»£ç ç¼–è¯‘åˆ°ç›¸åŒçš„æŠ½è±¡å±‚æ¬¡(æƒ³æƒ³ JavaScript ES å’Œ JavaScript ES3)ã€‚ä¸€ä¸ª*ç¼–è¯‘å™¨*é€šå¸¸ç¼–è¯‘ä»£ç åˆ°ä¸€ä¸ªè¾ƒä½çš„æŠ½è±¡å±‚æ¬¡(æƒ³æƒ³ Java åˆ° JVM /å­—èŠ‚ç ï¼ŒTypeScript åˆ° JavaScript)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ [Babel](https://babeljs.io/) å°†è‡ªå·±åˆ—ä¸ºä¸€ä¸ªç¼–è¯‘å™¨ï¼Œå› ä¸ºå®ƒå¯ä»¥ä»ç±»å‹è„šæœ¬ä»£ç ä¸­ç§»é™¤ç±»å‹è„šæœ¬æ ‡è®°ï¼Œç”Ÿæˆæœ‰æ•ˆçš„ JavaScript

> ğŸ’ç”±äºæˆ‘æƒ³è¦ä¸€äº›ç±»å‹å®‰å…¨ï¼Œå¹¶ä¸”æˆ‘æ›´æ“…é•¿ä½¿ç”¨[ç±»å‹è„šæœ¬](https://www.typescriptlang.org/)(å®ƒç¡®å®é™„å¸¦äº†ä¸€ä¸ª*ç¼–è¯‘å™¨*ï¼Œå®ƒä¹Ÿæœ‰*ä¼ è¾“æ–‡ä»¶*)è€Œä¸æ˜¯[æµ](https://flow.org/)(å®ƒåœ¨æŠ€æœ¯ä¸Šæ˜¯ä¸€ä¸ªé™æ€ç±»å‹æ£€æŸ¥å™¨ï¼Œè€Œä¸æ˜¯*ç¼–è¯‘å™¨*æˆ–*ä¼ è¾“å™¨*)ï¼Œæˆ‘é€‰æ‹©ç±»å‹è„šæœ¬ç”¨äº*ç¼–è¯‘*è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œç„¶åä½¿ç”¨`babel`å®é™…ç¼–è¯‘å¹¶ä¼ è¾“æ–‡ä»¶

### æ—æŒºå’Œ Styleguides

æ ¹æ®[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Lint_(software))çš„è¯´æ³•ï¼ŒLint æˆ– linter æ˜¯ä¸€ç§åˆ†ææºä»£ç ä»¥æ ‡è®°ç¼–ç¨‹é”™è¯¯ã€bugã€é£æ ¼é”™è¯¯å’Œå¯ç–‘ç»“æ„çš„å·¥å…·ã€‚æ—¢ç„¶æˆ‘å°†ä½¿ç”¨`TypeScript`ï¼Œæˆ‘è‡³å°‘åœ¨å¯»æ‰¾ä¸€ä¸ªä»£ç æ¢è¡Œå™¨ã€‚

> ğŸ’ [TSLint](https://palantir.github.io/tslint/) å·²ç»è¢«[å¼ƒç”¨](https://medium.com/palantir/tslint-in-2019-1a144c2317a9)ï¼Œå› ä¸ºå¾®è½¯æ¨å‡ºäº†ä¸€ä¸ªæƒŠäººçš„å·¥å…·é›†ï¼Œä½¿ [ESLint](https://eslint.org/) èƒ½å¤Ÿæ”¯æŒ Typescriptï¼Œç§°ä¸º [`typescript-eslint`](https://typescript-eslint.io/) ã€‚

æˆ‘ä¹Ÿè®¤ä¸ºæŒ‘é€‰ä¸€ä¸ªç¼–ç é£æ ¼æŒ‡å—(ä¾‹å¦‚ï¼Œä½ æ˜¯å¦ä½¿ç”¨åˆ†å·)å¹¶å°†å…¶åº”ç”¨åˆ°é¡¹ç›®ä¸­æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæˆ‘å°†ä½¿ç”¨`prettier`ã€‚

### æµ‹è¯•åº“

å¥½å§ï¼Œè¿™ä¸ªä¹Ÿä¸æ˜¯å¼€åˆ›æ€§çš„ã€‚è™½ç„¶è¿™é‡Œæœ‰å¾ˆå¤šé€‰æ‹©ï¼Œæ¯”å¦‚[æ‘©å¡](https://mochajs.org/)ã€[èŒ‰è‰](https://jasmine.github.io/)ã€[ç£å¸¦](https://github.com/substack/tape)ï¼Œæˆ–è€…æˆ‘æœ€å–œæ¬¢çš„ [AVA](https://github.com/avajs/ava) ï¼Œæˆ‘è¿˜æ˜¯ç”¨ [jest](https://jestjs.io/) ã€‚æˆ‘ä¸ªäººè®¤ä¸ºå®ƒæ‹¥æœ‰æˆ‘å–œæ¬¢çš„ AVA çš„æ‰€æœ‰ä¼Ÿå¤§ç‰¹æ€§ï¼Œä½†æ˜¯å› ä¸ºè„¸ä¹¦åœ¨å†…éƒ¨ä½¿ç”¨å®ƒï¼Œæœ‰ç›¸å½“å¤šçš„ *React å·¥å…·*å®Œç¾åœ°æŒ‚é’©åˆ°`jest`ã€‚

### åŸºåœ°åº“

å½“ä½ æƒ³åœ¨â€œååº”â€ä¸­å‘å±•æ—¶ï¼Œç›®å‰æœ‰å¤šç§é€‰æ‹©:

*   `react`:[https://reactjs.org/](https://reactjs.org/)
*   `preact`:[https://preactjs.com/](https://preactjs.com/)
*   `react-native-web`:[https://github.com/necolas/react-native-web](https://github.com/necolas/react-native-web)

> ğŸ’ä¸å»æ·±ç©¶ç»†èŠ‚ï¼Œå› ä¸ºè¿™ä¸ªç³»åˆ—ä¸“æ³¨äºç”¨`react`å†™ä¸€ä¸ªæ¸¸æˆï¼Œé‚£å°±æ˜¯æˆ‘è¦ç”¨çš„ï¼›å¦‚æœåœ¨è¿™ä¸ªç³»åˆ—çš„ç»“å°¾æœ‰å¾ˆå¤šé—®é¢˜ï¼Œæˆ‘ä¼šå†™ä¸€ç¯‡å…³äºå¦‚ä½•ä»`react`è½¬ç§»åˆ°`preact`çš„æ–‡ç« ã€‚

### è‡ªä¸¾

å¦‚æœä½ è¯»è¿‡ [react æ–‡æ¡£](https://reactjs.org/docs/create-a-new-react-app.html)ï¼Œä½ å¯èƒ½ä¼šçŸ¥é“æœ‰å‡ ä¸ªâ€œå·¥å…·é“¾â€å­˜åœ¨ã€‚å®ƒä»¬ä¸»è¦æ˜¯æä¾›å•ä¸€å‘½ä»¤è¡Œç•Œé¢(CLI)çš„åŒ…è£…å™¨ï¼Œå¹¶ä¸æ‰€æœ‰çš„ä¾èµ–é¡¹(å·¥å…·)æ†ç»‘åœ¨ä¸€èµ·ï¼Œå¦‚ä¸Šé¢å„ç§ç±»åˆ«ä¸­æ‰€åˆ—ã€‚React å›¢é˜Ÿä¸»è¦æ¨èäº†å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæˆ‘å€¾å‘äºåŒæ„å®ƒä»¬:

*   å¦‚æœä½ æ­£åœ¨å­¦ä¹  React æˆ–åˆ›å»ºä¸€ä¸ªæ–°çš„å•é¡µåº”ç”¨ç¨‹åºï¼Œä½¿ç”¨[åˆ›å»º React åº”ç”¨ç¨‹åº](https://github.com/facebook/create-react-app)ã€‚
*   å¦‚æœä½ æ­£åœ¨ç”¨ Node.js æ„å»ºä¸€ä¸ªæœåŠ¡å™¨æ¸²æŸ“çš„ç½‘ç«™ï¼Œè¯•è¯• [Next.js](https://nextjs.org/) ã€‚
*   å¦‚æœä½ æ­£åœ¨å»ºç«‹ä¸€ä¸ªé™æ€çš„é¢å‘å†…å®¹çš„ç½‘ç«™ï¼Œè¯•è¯• [Gatsby](https://www.gatsbyjs.org/) ã€‚
*   å¦‚æœä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç»„ä»¶åº“æˆ–è€…é›†æˆä¸€ä¸ªç°æœ‰çš„ä»£ç åº“ï¼Œè¯•è¯•[ä¸­å¾®å­](https://neutrinojs.org/)ã€ [nwb](https://github.com/insin/nwb) ã€[åŒ…è£¹](https://parceljs.org/)æˆ–è€… [Razzle](https://github.com/jaredpalmer/razzle) ã€‚

æˆ‘æƒ³åœ¨ç»„åˆä¸­åŠ å…¥ [`react-static`](https://react-static.js.org) ï¼Œä»¥åŠ`next.js`å’Œ`gatsby`çš„æ›¿ä»£å“ï¼Œå®ƒå…è®¸ä½ å»ºç«‹è¶…çº§å¿«é€Ÿçš„é™æ€å†…å®¹ç½‘ç«™ï¼Œç”¨ react-app è¡¥å……æ°´åˆ†ï¼Œä¸éœ€è¦ä½¿ç”¨`GraphQL`æˆ–æœåŠ¡å™¨ã€‚

è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å†³å®šï¼Œå› ä¸ºå¦‚æœä½ é€‰æ‹©ä½¿ç”¨ä¸Šé¢å·¥å…·é“¾ä¹‹ä¸€çš„ bootstrapped é¡¹ç›®ï¼Œä½ å°†åœ¨æŸç§ç¨‹åº¦ä¸Šè¢«ä»–ä»¬çš„æŠ€æœ¯ã€é…ç½®é€‰æ‹©å’Œä¸€èˆ¬æƒ³æ³•æ‰€æŸç¼šã€‚å¤§å¤šæ•°å·¥å…·éƒ½å…è®¸ä½ *å¼¹å‡º*(åœæ­¢ä½¿ç”¨å†…ç½®é»˜è®¤)ï¼Œä½†æ˜¯ä½ ä»ç„¶éœ€è¦åšå¾ˆå¤šå·¥ä½œæ‰èƒ½ç§»å¼€ã€‚

> ğŸ’è¯¥é¡¹ç›®(ä¿„ç½—æ–¯æ–¹å—å…‹éš†)å¯èƒ½æ˜¯å®Œå…¨å¯è¡Œçš„ï¼Œæ²¡æœ‰ä¸€ä¸ªå®Œæ•´çš„è‡ªä¸¾å·¥å…·é“¾ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘é€‰æ‹©äº†*è€Œä¸æ˜¯*æ¥ä½¿ç”¨ä¸€ä¸ªå¼•å¯¼å·¥å…·é“¾ã€‚å½“æˆ‘éœ€è¦æ·»åŠ ä¸€äº›å®ƒç›®å‰ä¸èƒ½æ­£ç¡®æ”¯æŒçš„ä¸œè¥¿æ—¶ï¼Œå½“æˆ‘è¯•å›¾å‡çº§ä¾èµ–é¡¹æˆ–ç±»ä¼¼çš„ä¸œè¥¿æ—¶ï¼Œæˆ‘ç»å¸¸ä¼šé‡åˆ° *meh* è¡Œä¸ºã€‚å¦‚æœæˆ‘æœ€ç»ˆéœ€è¦å®ƒï¼Œæˆ‘å¯ä»¥åœ¨ä»¥åæ·»åŠ å®ƒï¼

## é¡¹ç›®çš„åˆå§‹åŒ–

```
# Create the directory for this new project
mkdir tetreact

# Move into that directory
cd tetreact

# Install dependencies
yarn add react react-dom

# Install development dependencies (explanation below)
yarn add typescript core-js@3 eslint eslint-config-prettier eslint-plugin-import -D
yarn add eslint-plugin-jsx-a11y eslint-plugin-react eslint-plugin-react-hooks -D
yarn add jest babel-jest prettier @babel/cli @babel/core @babel/preset-env -D
yarn add @babel/preset-react @babel/preset-typescript @typescript-eslint/eslint-plugin -D
yarn add @typescript-eslint/parser @testing-library/react @testing-library/jest-dom -D
yarn add @types/jest @types/react @types/react-dom -D

# Make this a git repository
git init 
```

ä»¥ä¸‹æ˜¯å®‰è£…ä»¥ä¸‹è½¯ä»¶åŒ…çš„åŸå› :

*   `react`å’Œ`react-dom`æ˜¯ react çš„è¿è¡Œæ—¶åŒ…ï¼Œ
*   `typescript`:ç”¨äºå¯¹`ts`å’Œ`tsx`æ–‡ä»¶è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œ
*   `core-js`:poly fills ç‰¹è‰²åº“ã€‚æœ‰ä¸€ä¸ªæ—§ç‰ˆæœ¬(`@2`)å’Œä¸€ä¸ªæ–°ç‰ˆæœ¬(`@3`)ã€‚
*   `eslint`:æ£‰ç»’èŠ¯åŒ…ï¼Œ
*   `eslint-config-prettier`:å…³é—­æœ‰å†²çªçš„é£æ ¼è§„åˆ™ï¼Œ
*   `eslint-plugin-import`:å¢åŠ `import`å’Œ`export`è¯­å¥çš„è§„åˆ™å’Œæ—æŒºã€‚
*   `eslint-plugin-jsx-a11y`:å¢åŠ  JSX å…ƒç´ çš„å¯è®¿é—®æ€§è§„åˆ™ï¼Œ
*   `eslint-plugin-react`:å¢åŠ äº† React ç‰¹å®šçš„æ—æŒºè§„åˆ™ï¼Œ
*   `eslint-plugin-react-hooks`:å¢åŠ äº† React é’©å­ç‰¹æœ‰çš„æ—æŒºè§„åˆ™ï¼Œ
*   `jest`:æµ‹è¯•æ¡†æ¶ï¼Œ
*   `babel-jest`:å¯ä»¥é€šè¿‡å·´åˆ«å¡”è¿è¡Œæµ‹è¯•ä»£ç *ï¼Œ*
*   å…è®¸æˆ‘ä»å‘½ä»¤è¡Œè¿è¡Œ babel ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å‘½ä»¤ï¼Œ
*   `@babel/core`:å·´åˆ«å¡”çš„æ ¸å¿ƒåŒ…ï¼Œ
*   `@babel/preset-env`:é¢„è®¾ï¼Œæ ¹æ®æµè§ˆå™¨åˆ—è¡¨ï¼Œç¡®å®šéœ€è¦å¯¹ä»£ç åº”ç”¨å“ªäº›è½¬æ¢ï¼Œ
*   `@babel/preset-react`:å…è®¸ JSX è½¬æ¢å¹¶ç¡®ä¿ React çš„åŠŸèƒ½ç»„ä»¶å±æ€§`displayName`è®¾ç½®æ­£ç¡®çš„é¢„ç½®ã€‚
*   `@babel/preset-typescript`:å…è®¸ä»æ–‡ä»¶ä¸­å‰¥ç¦» TypeScript ç±»å‹çš„æ ‡è®°ï¼Œç•™ä¸‹æœ‰æ•ˆçš„ JavaScriptï¼Œ
*   ä¸ºæ—æŒºæ‰“å­—ç¨¿å¢åŠ äº†å¾ˆå¤šè§„åˆ™ï¼Œ
*   `@typescript-eslint/parser`:å…è®¸`eslint`ä½¿ç”¨ TypeScript ESLint è§£æå™¨(çŸ¥é“ç±»å‹æ ‡è®°)ï¼Œ
*   `@testing-library/react`:å¢åŠ å®˜æ–¹æ¨èæµ‹è¯•åº“ï¼Œé’ˆå¯¹ reactï¼Œ
*   `@testing-library/jest-dom`:ä¸º`jest`å’Œ DOM æ·»åŠ ç‰¹æ®ŠåŒ¹é…å™¨ï¼Œ
*   `@types/*`:ç±»å‹å®šä¹‰

æ‚¨å¯èƒ½ä¼šæƒ³:â€œå“å‘€ï¼Œè¿™æœ‰å¾ˆå¤šä¾èµ–é¡¹â€ï¼Œæ˜¯çš„ï¼Œæœ‰å¾ˆå¤šã€‚ç„¶è€Œï¼Œå½“ä½¿ç”¨ç±»ä¼¼äº`create-react-app`çš„ä¸œè¥¿æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ›´å¤šçš„ä¾èµ–é¡¹ï¼Œä½ å°†å®‰è£…åŒæ ·çš„*ï¼Œå› ä¸ºè¿™äº›æ˜¯ä½ å°†ä¾èµ–çš„`react-scripts`é¡¹ç›®çš„ä¾èµ–é¡¹ã€‚æˆ‘èŠ±äº†ç›¸å½“å¤šçš„æ—¶é—´æ¥æ•´ç†è¿™ä¸ªåˆ—è¡¨ï¼Œä½†æ˜¯ä½ å¯ä»¥éšæ„ä¿®æ”¹å’Œ/æˆ–æ·»åŠ ã€‚*

é€šå¸¸æˆ‘ä¼šåœ¨è¿›è¡Œè¿‡ç¨‹ä¸­æ·»åŠ è¿™äº›ä¾èµ–é¡¹ï¼Œä½†æˆ‘å·²ç»å®Œæˆäº†ä¸‹é¢åˆ—å‡ºçš„æ‰€æœ‰æ­¥éª¤ï¼Œæ‰€ä»¥æˆ‘æ”¶é›†äº†æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œå¹¶åœ¨ä¸¤ä¸ªå‘½ä»¤ä¸­åˆ—å‡ºå®ƒä»¬ï¼Œä¾›æ‚¨å¤åˆ¶å’Œç²˜è´´ã€‚

## æ­£ç¡®è®¾ç½®`typescript`

ä¸‹é¢æ˜¯è®¾ç½®`typescript`ã€‚ä¸ºæ­¤æ·»åŠ çš„ä¾èµ–é¡¹æœ‰:

*   `typescript`:æä¾›`tsc` typescript ç¼–è¯‘å™¨å¹¶å…è®¸æ‚¨æ‹¥æœ‰ä¸€ä¸ªé¡¹ç›®ç‰ˆæœ¬ï¼Œä¸åŒäºä¾‹å¦‚ä¸æ‚¨çš„ IDE æˆ–æ–‡æœ¬ç¼–è¾‘å™¨æ†ç»‘çš„ç‰ˆæœ¬ã€‚

è¿è¡Œ`tsc --init`å‘½ä»¤ï¼Œç”¨é»˜è®¤è®¾ç½®åˆ›å»º`tsconfig.json`ã€‚

```
yarn tsc --init 
```

ç°åœ¨æˆ‘éœ€è¦åšä¸€äº›æ”¹åŠ¨ï¼Œæ‰€æœ‰æ”¹åŠ¨éƒ½åœ¨ä¸‹é¢è§£é‡Š:

```
-  // "incremental": true, +  "incremental": true -  // "target": "es5", +  "target": "esnext", -  // "jsx": "preserve", +  "jsx": "preserve", -  // "noEmit": true, +  "noEmit": true, -  // "isolatedModules": true, +  "isolatedModules": true, -  // "moduleResolution": "node", +  "moduleResolution": "node", -  // "allowSyntheticDefaultImports": true, +  "allowSyntheticDefaultImports": true, 
```

è®°ä½ï¼Œç›®æ ‡æ˜¯è®©`tsc`å¯¹ä»£ç åº“è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚è¿™æ„å‘³ç€ä¸éœ€è¦è¾“å‡ºï¼Œå› æ­¤æœ‰äº†`noEmit`ã€‚æ­¤å¤–ï¼Œå®ƒä¸éœ€è¦èŠ±æ—¶é—´è½¬æ¢åˆ°ä¸€ä¸ªæ—§çš„ JavaScriptï¼Œå› ä¸º`babel`ä¼šå¤„ç†ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥æœ‰ä¸€ä¸ª`esnext`ç›®æ ‡ã€‚åŒç†ï¼Œ`jsx`è®¾ç½®ä¸º`preserve`ï¼Œè€Œ**ä¸æ˜¯** `react`ã€‚å·´è´å°”ä¼šå¤„ç†çš„ã€‚ç„¶åæœ‰å‡ ä¸ªé€‰é¡¹ä½¿å¾—ä¸å…¶ä»–åŒ…çš„äº’æ“ä½œæ€§æ›´å®¹æ˜“ã€‚æœ€åï¼Œ`isolatedModules`æ˜¯ TypeScript over Babel åŠŸèƒ½æ­£ç¡®å·¥ä½œæ‰€å¿…éœ€çš„ã€‚

æ­¤å¤–ï¼Œ`package.json`éœ€è¦ç”¨è¿è¡Œç±»å‹æ£€æŸ¥çš„å‘½ä»¤è·å¾—`"scripts"`é”®ã€‚

```
+  "scripts": {
+    "lint:types": "yarn tsc"
+  } 
```

è¿è¡Œ`yarn lint:types`åº”è¯¥ä¼šäº§ç”Ÿä»¥ä¸‹é”™è¯¯:

```
error TS18003: No inputs were found in config file 'path/to/tetreact/tsconfig.json'. Specified
'include' paths were '["**/*"]' and 'exclude' paths were '[]'.

Found 1 error. 
```

è¿™æ˜¯æ­£ç¡®çš„é”™è¯¯ã€‚æ²¡ä»€ä¹ˆå¥½ç¼–çš„ï¼æˆ‘ä»¬æ¥è¡¥å……ä¸€ä¸‹:

```
mkdir src
touch src/App.tsx 
```

è¿è¡Œ`yarn lint:types`åº”è¯¥ä¼šäº§ç”Ÿä»¥ä¸‹é”™è¯¯:

```
node_modules/@types/babel__template/index.d.ts:16:28 - error TS2583: Cannot find name 'Set'. Do
you need to change your target library? Try changing the `lib` compiler option to es2015 or later.

16     placeholderWhitelist?: Set<string>;
                              ~~~

node_modules/@types/react/index.d.ts:377:23 - error TS2583: Cannot find name 'Set'. Do you need
to change your target library? Try changing the `lib` compiler option to es2015 or later.

377         interactions: Set<SchedulerInteraction>,
                          ~~~

src/App.tsx:1:1 - error TS1208: All files must be modules when the '--isolatedModules' flag is
provided.

1 
```

è®©æˆ‘ä»¬ä»å‰ä¸¤ä¸ªå¼€å§‹ã€‚è¿™äº›ç»™å‡ºäº†ä¿®å¤é”™è¯¯çš„æ˜ç¡®é€‰é¡¹ã€‚

```
-  // "lib": [], +  "lib": ["dom", "es2015"], 
```

è¿™ä¸åœ¨æ‚¨çš„`.eslintrc`é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ­£ç¡®çš„`env`éå¸¸ç›¸ä¼¼:æˆ‘éœ€è¦å‘Šè¯‰ TypeScript æˆ‘åœ¨ä¸€ä¸ªæµè§ˆå™¨ç¯å¢ƒ(`dom`)ä¸­ï¼Œå¹¶ä¸”å®ƒåº”è¯¥èƒ½å¤Ÿè®¿é—®é‚£äº›å·²ç»åœ¨`es2015`ä¸­å¼•å…¥çš„æ„é€ ã€‚

æœ€åä¸€ä¸ªé”™è¯¯æ˜¯å› ä¸º`--isolatedModules`æ ‡å¿—ã€‚å½“ç”¨è¿™ä¸ªæ ‡å¿—/é€‰é¡¹è¿è¡Œç¼–è¯‘å™¨æ—¶ï¼Œæ¯ä¸ªæ–‡ä»¶*éƒ½å¸Œæœ›*æˆä¸ºå®ƒè‡ªå·±çš„ç‹¬ç«‹æ¨¡å—ã€‚ä¸€ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå¦‚æœå®ƒæ˜¯ä»€ä¹ˆä¸œè¥¿çš„è¯ã€‚è¿™ä¸ªæ ‡å¿—çš„åŸå› å¹¶ä¸æ˜æ˜¾:å®ƒåœ¨`@babel/plugin-transform-typescript` çš„[æ–‡æ¡£ä¸­è¢«åˆ—ä¸ºä½¿ç”¨ Babelâ€œç¼–è¯‘â€TypeScript çš„è­¦å‘Šä¹‹ä¸€ã€‚æˆ‘åœ¨è¿™é‡Œæœ‰å…ˆè¿›çš„çŸ¥è¯†ï¼Œä½†å®ƒä¼šåœ¨ä¸‹ä¸€æ­¥å˜å¾—æ¸…æ™°ã€‚](https://babeljs.io/docs/en/babel-plugin-transform-typescript)

æˆ‘æ›´æ–°äº†`src/App.tsx`æ–‡ä»¶:

```
import React from 'react'

export function App(): JSX.Element {
  return <div>Hello world</div>
} 
```

æœ€åï¼Œ`tsc`*ä¸æŠ±æ€¨*ã€‚

## æ­£ç¡®è®¾ç½®`babel`

ä¸‹ä¸€æ­¥æ˜¯ç¡®ä¿`babel`â€œç¼–è¯‘â€ç±»å‹è„šæœ¬ä»£ç ä¸º JavaScriptï¼Œåº”ç”¨è½¬æ¢å¹¶æŒ‚é’©åˆ°æˆ‘å·²ç»å®‰è£…çš„å„ç§æ’ä»¶ä¸­ã€‚

*   `core-js@3`:poly fills ç‰¹è‰²åº“ã€‚æœ‰è¾ƒè€çš„ç‰ˆæœ¬(`@2`)å’Œè¾ƒæ–°çš„ç‰ˆæœ¬(`@3`)ï¼›å®ƒç”±`@babel/preset-env`ç»“åˆ`browerlist`é…ç½®ä½¿ç”¨ï¼Œ
*   å…è®¸æˆ‘ä»å‘½ä»¤è¡Œè¿è¡Œ babel ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å‘½ä»¤ï¼Œ
*   `@babel/core`:å·´åˆ«å¡”çš„æ ¸å¿ƒåŒ…ï¼Œ
*   `@babel/preset-env`:é¢„è®¾ï¼Œæ ¹æ®æµè§ˆå™¨åˆ—è¡¨ï¼Œç¡®å®šéœ€è¦å¯¹ä»£ç åº”ç”¨å“ªäº›è½¬æ¢ï¼Œ
*   `@babel/preset-react`:å…è®¸ JSX è½¬æ¢å¹¶ç¡®ä¿ React çš„åŠŸèƒ½ç»„ä»¶å±æ€§`displayName`è®¾ç½®æ­£ç¡®çš„é¢„ç½®ã€‚
*   `@babel/preset-typescript`:å…è®¸ä»æ–‡ä»¶ä¸­å‰¥ç¦»ç±»å‹è„šæœ¬ç±»å‹æ ‡è®°ï¼Œç•™ä¸‹æœ‰æ•ˆçš„ JavaScriptã€‚

ç›®å‰ï¼Œåœ¨æ’°å†™æœ¬æ–‡çš„æ—¶å€™ï¼ŒBabel è¿˜æ²¡æœ‰ä¸€ä¸ª`--init`å‘½ä»¤ï¼Œä½†æ˜¯è®¾ç½®å®ƒå¹¶ä¸å¤æ‚ï¼Œå°½ç®¡éœ€è¦ä¸€äº›åŠªåŠ›æ‰èƒ½æ­£ç¡®åˆ—å‡ºæ‰€æœ‰çš„é¢„ç½®å’Œæ’ä»¶ã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ª*é¡¹ç›®*ï¼Œæ ¹æ®[é€šå¤©å¡”æ–‡æ¡£](https://babeljs.io/docs/en/configuration#what-s-your-use-case)ï¼Œè¿™ä¸ªé¡¹ç›®çš„æœ€ä½³æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ª`JSON`é…ç½®ï¼Œç§°ä¸º`.babelrc`ã€‚

```
touch .babelrc 
```

å†…å®¹å¦‚ä¸‹ï¼Œæ˜¯æˆ‘å–äº†ä¸‰ä¸ª`@babel/preset-*`æ’ä»¶çš„æ–‡æ¡£å¹¶åº”ç”¨åæ”¶é›†çš„:

```
{  "presets":  [  [  "@babel/preset-env",  {  "targets":  {  "node":  "current"  },  "useBuiltIns":  "usage",  "corejs":  {  "version":  3  }  }  ],  "@babel/preset-typescript",  "@babel/preset-react"  ],  "ignore":  [  "node_modules",  "dist"  ]  } 
```

æ˜¾å¼å®šä¹‰`browserlists`é”®/é…ç½®ä¹Ÿæ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå°½ç®¡å› ä¸ºæˆ‘æ­£åœ¨æ„å»ºä¸€ä¸ªè·¨ç¯å¢ƒè·¨æµè§ˆå™¨æ¸¸æˆï¼Œæ‰€ä»¥è®¾ç½®å¯ä»¥ä¿ç•™åœ¨`defaults`ä¸Šã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œä¸ºäº†è®©é˜¿è´å°”ä½¿ç”¨`@babel/cli`æ¥è°ƒç”¨`babel`ï¼Œåœ¨`package.json`ä¸­ï¼Œæˆ‘æ·»åŠ äº†ä»¥ä¸‹å†…å®¹:

```
 {
     "scripts": {
+      "build": "yarn babel src --out-dir dist --extensions \".ts,.tsx\"",
+      "watch": "yarn build --watch",
       "lint:types": "yarn tsc"
     },
     "dependencies": {

  ...

       "typescript": "^3.5.3"
     },
+    "browserslist": [
+      "defaults"
+    ]
   } 
```

å¦‚æœæ‚¨æƒ³è¦ä¸åŒçš„ç›®æ ‡ï¼Œè¯·ç¡®ä¿éµå¾ª[æµè§ˆå™¨åˆ—è¡¨æœ€ä½³å®è·µ](https://github.com/browserslist/browserslist#best-practices)ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼›æŒ‘ä½ å–œæ¬¢çš„ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯å¦æœ‰æ•ˆï¼

```
$ yarn build
yarn run v1.16.0
warning package.json: No license field
$ babel src --out-dir dist --extensions ".ts,.tsx"
Successfully compiled 1 file with Babel.
Done in 1.67s. 
```

åœ¨`dist`ä¸­ï¼Œæˆ‘ç°åœ¨å¯ä»¥æ‰¾åˆ°`App.js`ï¼Œå®ƒæ²¡æœ‰ä»»ä½•ç±»å‹ä¿¡æ¯ã€‚å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„:

```
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.App = App;

var _react = _interopRequireDefault(require("react"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function App() {
  return _react.default.createElement("div", null, "Hello World!");
} 
```

éœ€è¦æ³¨æ„çš„å‡ ä»¶äº‹:

*   å®ƒè¡¥å……äº†`"use strict";`
*   å®ƒä½¿ç”¨`interopRequireDefault`æ¥è¦æ±‚`react`çš„é»˜è®¤å¯¼å‡º
*   ä½¿ç”¨`_react.default.createElement`æ—¶å‘ç”Ÿäº†`JSX`

è¿™ä¸‰ä»¶äº‹åªæœ‰åœ¨ Babel é…ç½®æ­£ç¡®çš„æƒ…å†µä¸‹æ‰ä¼šå‘ç”Ÿã€‚

## æ­£ç¡®è®¾ç½®`eslint`

ä¸‹ä¸€æ­¥æ˜¯ç¡®ä¿ TypeScript ä»£ç å¯ä»¥è¢«é“¾æ¥ï¼

*   `eslint`:æ£‰ç»’èŠ¯åŒ…ï¼Œ
*   `eslint-config-prettier`:å…³é—­æœ‰å†²çªçš„é£æ ¼è§„åˆ™ï¼Œ
*   `eslint-plugin-import`:å¢åŠ `import`å’Œ`export`è¯­å¥çš„è§„åˆ™å’Œæ—æŒºã€‚
*   `eslint-plugin-jsx-a11y`:å¢åŠ  JSX å…ƒç´ çš„å¯è®¿é—®æ€§è§„åˆ™ï¼Œ
*   `eslint-plugin-react`:å¢åŠ äº† React ç‰¹å®šçš„æ—æŒºè§„åˆ™ï¼Œ
*   `eslint-plugin-react-hooks`:å¢åŠ äº† React é’©å­ç‰¹æœ‰çš„æ—æŒºè§„åˆ™ï¼Œ
*   ä¸ºæ—æŒºæ‰“å­—ç¨¿å¢åŠ äº†å¾ˆå¤šè§„åˆ™ï¼Œ
*   `@typescript-eslint/parser`:å…è®¸`eslint`ä½¿ç”¨ TypeScript ESLint è§£æå™¨(å®ƒçŸ¥é“ç±»å‹æ ‡è®°)ã€‚

`eslint`æ ¸å¿ƒåŒ…é™„å¸¦ä¸€ä¸ª CLI å·¥å…·æ¥åˆå§‹åŒ–(å¹¶è¿è¡Œ)`eslint` :

```
$ yarn eslint --init

? How would you like to use ESLint? To check syntax and find problems
? What type of modules does your project use? JavaScript modules (import/export)
? Which framework does your project use? React
? Where does your code run? Browser
? What format do you want your config file to be in? JSON

Successfully created .eslintrc.json file in path/to/tetreact 
```

æ ¹æ®æ‚¨çš„é…ç½®ï¼Œå¦‚æœæ‚¨è°ƒç”¨`yarn eslint`(ä»æœ¬åœ°`node_modules`æ‰§è¡Œ`eslint`æˆ–æ™®é€š`eslint`(å¯èƒ½è°ƒç”¨â€œå…¨å±€â€å®‰è£…çš„`eslint`)ï¼Œå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹æ¶ˆæ¯*:* 

 *```
The config that you've selected requires the following dependencies:

eslint-plugin-react@latest

? Would you like to install them now with npm? No 
```

æˆ‘é€‰æ‹©`"No"`æ˜¯å› ä¸ºä¸€æ–¹é¢ï¼Œå®ƒå·²ç»å®‰è£…åœ¨`devDependencies`ä¸‹ï¼Œå¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆ‘è¯´`"yes"`ï¼Œå®ƒä¼šè¯•å›¾ä½¿ç”¨`npm`æ¥å®‰è£…å®ƒï¼Œè¿™æ˜¯æˆ‘ä¸æƒ³è¦çš„(å› ä¸ºæˆ‘æ­£åœ¨ä½¿ç”¨`yarn`)ã€‚

è‡³äºé€‰é¡¹:æˆ‘ä¸ªäººå–œæ¬¢`.json`æ–‡ä»¶ï¼Œå› ä¸ºå®ƒé™åˆ¶äº†æˆ‘ä½¿ç”¨`JavaScript`è§£å†³ä¸€äº›äº‹æƒ…ï¼Œè¿™ä½¿å¾—â€œé»‘å®¢â€åšä¸€äº›äº‹æƒ…çš„éšœç¢æ›´é«˜äº†ã€‚æˆ‘åŸºæœ¬ä¸Šé˜²æ­¢è‡ªå·±å°è¯•åšä¸€äº›ä¸å—å¼€ç®±å³ç”¨æ”¯æŒçš„äº‹æƒ…ã€‚æ‚¨çš„é‡Œç¨‹æ•°å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æˆ‘å–œæ¬¢ä½¿ç”¨æ ‡å‡†é…ç½®çš„ä¾èµ–é¡¹ï¼Œå› ä¸ºè¿™æ ·æ›´å®¹æ˜“æœç´¢è§£å†³æ–¹æ¡ˆ*å’Œ*è¯·æ±‚æ”¯æŒï¼

> ğŸ›‘å¦‚æœä½ é‡åˆ°ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„é”™è¯¯:
> 
> ```
> ESLint couldn't find the plugin "eslint-plugin-react". This can happen for a
> couple different reasons:
> ... 
> ```
> 
> å³ä½¿*æ˜¯æœ¬åœ°å®‰è£…çš„*ï¼Œä¹Ÿè¦ä»å…¨å±€åŒ…ä¸­åˆ é™¤`eslint`:
> 
> ```
> yarn global remove eslint 
> ```

å¦‚æœä½ ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰`eslint`é›†æˆè®¾ç½®çš„ IDEï¼Œé‚£ä¹ˆ`App.js`(åœ¨`dist`æ–‡ä»¶å¤¹ä¸­)å’Œ`App.tsx`(åœ¨`src`æ–‡ä»¶å¤¹ä¸­)éƒ½æœ‰å¯èƒ½å‡ºç°é”™è¯¯ã€‚**è¿™æ˜¯æ„æ–™ä¹‹ä¸­çš„**ã€‚å®ƒä¸ä¼šç”¨ä½ çš„`devDependencies`ä¸­çš„æ‰€æœ‰æ’ä»¶è‡ªåŠ¨é…ç½®`.eslintrc.json`ã€‚

ä¸ºäº†è·å¾—æ‰€æœ‰çš„é…ç½®ï¼Œæˆ‘ç¼–è¾‘äº†ç”Ÿæˆçš„`.eslintrc.json`ã€‚

*   é¦–å…ˆï¼Œæˆ‘å°†é…ç½®æ ‡è®°ä¸º`root`é…ç½®ã€‚è¿™ç¦æ­¢æ ‘ä¸­ä»»ä½•åœ°æ–¹çš„ä»»ä½•`eslint`é…ç½®å°†è§„åˆ™åº”ç”¨åˆ°è¿™ä¸ªé¡¹ç›®ã€‚
*   æ¥ä¸‹æ¥ï¼Œæˆ‘æ›´æ–°äº†`parserOptions`å¹¶å‘Šè¯‰å®ƒä½¿ç”¨`@typescript-eslint/parser`è§£æå™¨ã€‚æˆ‘çš„[æ–‡ç« ](https://dev.to/xpbytes/writing-a-code-analyzer-in-typescript-5ec3)å…³äº[ç¼–å†™ä¸€ä¸ªç±»å‹è„šæœ¬ä»£ç åˆ†æå™¨](https://dev.to/xpbytes/writing-a-code-analyzer-in-typescript-5ec3)æ›´è¯¦ç»†åœ°ä»‹ç»äº†ä¸åŒçš„`@typescript-eslint/*`åŒ…æ˜¯ä»€ä¹ˆå’Œåšä»€ä¹ˆçš„ã€‚
*   æœ€åè¿˜æœ‰æ‰€æœ‰çš„`extends`ã€‚è¿™äº›é‡‡ç”¨äº†æˆ‘æƒ³è¦åº”ç”¨äºè¯¥é…ç½®çš„é¢„è®¾é…ç½®ã€‚`@typescript-eslint/*`å’Œ`prettier/*`æ¨¡å—æœ‰æ–‡æ¡£è¯´æ˜*åº”è¯¥æŒ‰ç…§ä»€ä¹ˆé¡ºåº*æ”¾ç½®ã€‚

```
 {
+    "root": true,
+    "parser": "@typescript-eslint/parser",
     "parserOptions": {
+      "project": "./tsconfig.json",
+      "ecmaFeatures": {
+        "jsx": true
+      },
       "ecmaVersion": 2018,
       "sourceType": "module"
     },
     "env": {
       "browser": true,
       "es6": true
     },
-    "extends": "eslint:recommended" +    "extends": [
+      "eslint:recommended",
+      "plugin:@typescript-eslint/eslint-recommended",
+      "plugin:@typescript-eslint/recommended"
+      "plugin:react/recommended",
+      "prettier",
+      "prettier/@typescript-eslint",
+      "prettier/babel",
+      "prettier/react"
+    ],
     "globals": {
       "Atomics": "readonly",
       "SharedArrayBuffer": "readonly"
     },
     "plugins": [
-      "react", +      "@typescript-eslint",
+      "react-hooks",
     ],
     "rules": {
     },
+    "settings": {
+      "react": {
+        "version": "detect"
+      }
+    }
   } 
```

è¿™ä¸ª`rules`ç›®å‰ä»ç„¶æ˜¯ç©ºçš„ï¼Œæˆ‘ä¼šè¯´çš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹é…ç½®ï¼

### æµ‹è¯•`eslint`é…ç½®

æˆ‘æ”¹å˜`src/App.tsx` :

```
+  function Header() {
+    return <h1>Hello World!</h1>
+  } 
   export function App(): JSX.Element {
-    return <div>Hello World!</div> +    return <Header />
   } 
```

å¹¶æ·»åŠ æ–°çš„`scripts`æ¡ç›®:

```
 "scripts" {
     "build": "yarn babel src --out-dir dist --extensions \".ts,.tsx\"",
      "watch": "yarn build --watch",
+     "lint": "yarn eslint src/**/*",
      "lint:types": "yarn tsc"
   }, 
```

ç°åœ¨ç”±æˆ‘æ¥ç»è¥ï¼

```
yarn lint

$ eslint src/**/*

path/to/tetreact/src/App.tsx
  3:1  warning  Missing return type on function  @typescript-eslint/explicit-function-return-type

âœ– 1 problem (0 errors, 1 warning)

Done in 4.01s. 
```

ä¼æ™®è¿ªå¤šã€‚æ¥è‡ª`@typescript-eslint`æ’ä»¶çš„è­¦å‘Šï¼è¿™æ­£æ˜¯æˆ‘æœŸæœ›çœ‹åˆ°çš„ï¼Œæ‰€ä»¥æˆ‘ç°åœ¨å¯ä»¥ç»§ç»­å¾®è°ƒ`"rules"`ã€‚

### å¾®è°ƒè§„åˆ™

é€šå¸¸ï¼Œå½“æˆ‘å¼€å‘ä¸€ä¸ªåº“æˆ–é¡¹ç›®æ—¶ï¼Œæˆ‘ä¼šå¾®è°ƒ`"rules"`,æˆ–è€…æˆ‘ä½¿ç”¨ä¸€ç»„ç”±é¡¹ç›®é¢†å¯¼é¢„å…ˆç¡®å®šçš„è§„åˆ™ã€‚åœ¨[exercisem/JavaScript-analyzer åº“](https://github.com/exercism/javascript-analyzer)ä¸­ï¼Œæˆ‘å·²ç»[æ·»åŠ äº†ä¸€ä¸ªå…³äºè§„åˆ™çš„æ–‡æ¡£](https://github.com/exercism/javascript-analyzer/blob/b32e6dc67842c4edad6f75e9b8909bf5d2ac6926/docs/linting.md)ä»¥åŠæˆ‘ä¸ºä»€ä¹ˆé€‰æ‹©å®ƒä»¬è¿™æ ·ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼ŒåŒ…æ‹¬åº•éƒ¨çš„ä¸¤ä¸ª`react-hooks`è§„åˆ™ã€‚

```
{  "rules":  {  "@typescript-eslint/explicit-function-return-type":  [  "warn",  {  "allowExpressions":  false,  "allowTypedFunctionExpressions":  true,  "allowHigherOrderFunctions":  true  }  ],  "@typescript-eslint/explicit-member-accessibility":  [  "warn",  {  "accessibility":  "no-public",  "overrides":  {  "accessors":  "explicit",  "constructors":  "no-public",  "methods":  "explicit",  "properties":  "explicit",  "parameterProperties":  "off"  }  }  ],  "@typescript-eslint/indent":  ["error",  2],  "@typescript-eslint/no-non-null-assertion":  "off",  "@typescript-eslint/no-parameter-properties":  [  "warn",  {  "allows":  [  "private",  "protected",  "public",  "private readonly",  "protected readonly",  "public readonly"  ]  }  ],  "@typescript-eslint/no-unused-vars":  "off",  "@typescript-eslint/no-use-before-define":  [  "error",  {  "functions":  false,  "typedefs":  false  }  ],  "react-hooks/rules-of-hooks":  "error",  "react-hooks/exhaustive-deps":  "warn"  }  } 
```

éšç€æˆ‘ç¼–å†™æ›´å¤šçš„ä»£ç ï¼Œè¿™ä¸ªè§„åˆ™é›†å¯èƒ½ä¼šæ”¹å˜ï¼Œä½†æ˜¯ç°åœ¨åº”è¯¥è¶³å¤Ÿäº†ã€‚

## æ­£ç¡®è®¾ç½®`jest`

ä¸‹ä¸€æ­¥æ˜¯ç¡®ä¿ä»£ç æ˜¯å¯æµ‹è¯•çš„ã€‚

æˆ‘ä¸ªäºº*ä¸å–œæ¬¢*æŠŠæˆ‘çš„æµ‹è¯•æ–‡ä»¶æ”¾åœ¨æˆ‘çš„æºæ–‡ä»¶æ—è¾¹ï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰çš„æµ‹è¯•æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„ç›®å½•ä¸­ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯æ›´å¥½æˆ–é¦–é€‰ï¼Œåªæ˜¯ä¸åŒã€‚ä½ å–œæ¬¢åšä»€ä¹ˆå°±åšä»€ä¹ˆã€‚å¦‚æœä½ æŠŠæµ‹è¯•æ”¾åœ¨ä¸€èµ·ï¼Œç¡®ä¿ä½ çš„æµ‹è¯•ä»¥`.test.ts`æˆ–`.test.tsx`ç»“æŸï¼Œå¦‚æœä½ æ²¡æœ‰ï¼Œé»˜è®¤çš„*æ–‡ä»¶å¤¹æ˜¯`__tests__`ã€‚æ‚¨å¯ä»¥åœ¨å³å°†ç”Ÿæˆçš„`jest.config.js`ä¸­æ›´æ”¹è¿™äº›ã€‚*

é‡è¦çš„ä¾èµ–å…³ç³»æ˜¯:

*   `jest`:æµ‹è¯•æ¡†æ¶ï¼Œ
*   `babel-jest`:å¯ä»¥é€šè¿‡å·´åˆ«å¡”è¿è¡Œæµ‹è¯•ä»£ç *ï¼Œ*
*   `@testing-library/react`:å¢åŠ å®˜æ–¹æ¨èæµ‹è¯•åº“ï¼Œé’ˆå¯¹ reactï¼Œ
*   `@testing-library/jest-dom`:ä¸º`jest`å’Œ DOM æ·»åŠ ç‰¹æ®ŠåŒ¹é…å™¨ï¼Œ

å°±åƒå…¶ä»–ä¸€äº›å·¥å…·ä¸€æ ·ï¼Œ`jest`å¸¦æœ‰ä¸€ä¸ª CLI å’Œä¸€ä¸ªé€‰é¡¹ï¼Œå…è®¸æ‚¨*ç”Ÿæˆ*é…ç½®æ–‡ä»¶ã€‚

```
$ yarn jest --init

âˆš Would you like to use Jest when running "test" script in "package.json"? ... yes
âˆš Choose the test environment that will be used for testing Â» jsdom (browser-like)
âˆš Do you want Jest to add coverage reports? ... yes
âˆš Automatically clear mock calls and instances between every test? ... no 
```

è¿™ä¼šå°†`test`è„šæœ¬æ·»åŠ åˆ°`package.json`ä¸­çš„`"scripts"`ä¸­ï¼Œå¹¶å°†é»˜è®¤çš„`jest.config.js`æ–‡ä»¶æ·»åŠ åˆ°æ ¹ç›®å½•ä¸­ã€‚
é…ç½®æ–‡ä»¶çš„å†…å®¹éƒ½è®¾ç½®æ­£ç¡®(ç»™å‡ºä¸Šé¢åˆ—å‡ºçš„ç­”æ¡ˆ)ï¼Œé‡è¦çš„æ˜¯(ä½ å¯ä»¥è¿›å»ç¡®è®¤):

*   `coverageDirectory`åº”è¯¥è®¾ç½®ä¸º`"coverage"`ï¼Œå› ä¸ºæˆ‘æƒ³è¦è¦†ç›–ç‡æŠ¥å‘Šï¼Œ
*   `testEnvironment`ä¸åº”è¯¥è®¾ç½®æˆ–è®¾ç½®ä¸º`"jest-environment-jsdom"`ï¼Œå› ä¸ºæˆ‘ä¸æƒ³*æœ‰*åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚

`babel-jest`åŒ…æ˜¯*è‡ªåŠ¨*æ”¯æŒçš„ï¼Œå¼€ç®±å³ç”¨ï¼Œä¸éœ€è¦è®¾ç½®ä»»ä½•å…¶ä»–ä¸œè¥¿ã€‚å› ä¸º Babel å·²ç»è¢«æ­£ç¡®åœ°é…ç½®ä¸ºâ€œç¼–è¯‘â€æºä»£ç ï¼Œå¹¶ä¸”æµ‹è¯•ä»£ç å…·æœ‰ç›¸åŒçš„å±æ€§ï¼Œæ‰€ä»¥ä¸éœ€è¦é‡‡å–ä»»ä½•æ­¥éª¤æ¥ä½¿æµ‹è¯•ä¹Ÿè¢«â€œç¼–è¯‘â€ã€‚

ç„¶åæˆ‘æƒ³ä¸`@testing-library/react`åº“é›†æˆï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ¸…ç†è„šæœ¬ï¼Œç¡®ä¿åœ¨æ¯æ¬¡æµ‹è¯•å`React`åº”ç”¨ç¨‹åºçš„çŠ¶æ€å’Œç¯å¢ƒè¢«é‡ç½®(æ¸…ç†)ã€‚å®ƒå¯ä»¥é€šè¿‡`jest.config.js`æ–‡ä»¶
è¿›è¡Œè®¾ç½®ï¼Œè€Œä¸æ˜¯åŒ…å«åœ¨æ¯ä¸ªæµ‹è¯•ä¸­

```
-  // setupFilesAfterEnv: [] +  setupFilesAfterEnv: [
+    '@testing-library/react/cleanup-after-each'
+  ], 
```

æˆ‘åœ¨æµ‹è¯•ä¸­ä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶å¤¹å:

```
mkdir __tests__ 
```

ç°åœ¨æˆ‘ç”¨ä¸‹é¢çš„ä»£ç åˆ›å»ºä¸€ä¸ªå†’çƒŸæµ‹è¯•`__tests__/App.tsx`:

```
import React from 'react'
import { render } from '@testing-library/react'
import { App } from '../src/App';

it('App renders heading', () => {
  const {queryByText} = render(
    <App />,
  );

  expect(queryByText(/Hi/)).toBeTruthy();
}); 
```

æœ€åï¼Œæˆ‘ä½¿ç”¨ç”±`yarn jest --init` :
æ·»åŠ çš„`"scripts"`å‘½ä»¤è¿è¡Œæµ‹è¯•

```
yarn test

$ jest
 FAIL  __tests__/App.tsx
  Ã— App renders heading (29ms)

  â— App renders heading

    expect(received).toBeTruthy()

    Received: null

      14 |   );
      15 |
    > 16 |   expect(queryByText(/Hi/)).toBeTruthy();
         |                             ^
      17 | });
      18 |

      at Object.toBeTruthy (__tests__/App.tsx:16:29)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 1 total
Snapshots:   0 total
Time:        4.361s
Ran all test suites. 
```

å•Šã€‚æˆ‘åœ¨æ¸²æŸ“`Hello World`ï¼Œè€Œä¸æ˜¯`Hi`ã€‚æ‰€ä»¥ç°åœ¨æˆ‘å°†æ­£åˆ™è¡¨è¾¾å¼æ”¹ä¸ºæµ‹è¯•`Hello World`ï¼Œå¹¶å†æ¬¡è¿è¡Œæµ‹è¯•:

```
$ jest
 PASS  __tests__/App.tsx
  âˆš App renders heading (21ms)

Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        4.184s
Ran all test suites.
Done in 6.10s. 
```

### å¯ç”¨`jest-dom`æ‰©å±•

ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†å¦ä¸€ä¸ªä¾èµ–å…³ç³»ã€‚æˆ‘æƒ³ä½¿ç”¨`'@testing-library/jest-dom/extend-expect'`å¯è§æ€§æ£€æŸ¥`toBeVisible`ï¼Œè€Œä¸æ˜¯åªé€šè¿‡`toBeTruthy`æµ‹è¯•å®ƒæ˜¯å¦å­˜åœ¨ã€‚ä¸ºäº†ä¸é‚£ä¸ªåŒ…é›†æˆï¼Œæˆ‘å¯¹`jest.config.js` :
åšäº†å¦‚ä¸‹ä¿®æ”¹

```
 setupFilesAfterEnv: [
     '@testing-library/react/cleanup-after-each',
+    '@testing-library/jest-dom/extend-expect',
   ], 
```

è¿™ä¸€æ”¹å˜ä½¿å¾—æ‰©å±•(æ–°çš„åŒ¹é…å™¨ï¼ŒåŒ…æ‹¬`.toBeVisible`)å¯ç”¨äºæ‰€æœ‰çš„æµ‹è¯•ã€‚

æˆ‘æ›´æ–°æµ‹è¯•æ¥ä½¿ç”¨è¿™äº›:

```
 import React from 'react'
   import { render } from '@testing-library/react'
   import { App } from '../src/App'

   it('App renders heading', () => {
     const { container, queryByText } = render(
       <App />,
     );

-    expect(queryByText(/Hello World/)).toBeTruthy()
+    expect(queryByText(/Hello World/)).toBeVisible()
   } 
```

è¿è¡Œæµ‹è¯•å·¥ä½œæ­£å¸¸ï¼Œä½†æ˜¯æˆ‘çš„ IDE åœ¨`toBeVisible`åŒ¹é…å™¨ä¸Šç»™å‡ºäº†ä¸€ä¸ªé”™è¯¯ã€‚è¿™æ˜¯å› ä¸º TypeScript å¹¶ä¸çŸ¥é“`expect`åŒ¹é…å™¨å·²ç»è¢«æ‰©å±•äº†ã€‚å®ƒä¸æ“…é•¿ä»*åŠ¨æ€æ‰§è¡Œçš„ä»£ç *ä¸­æ¨æ–­å‡ºæ–°çš„ç±»å‹ã€‚ç”±äºåœ¨`jest`é…ç½®å’Œè¿™ä¸ªæµ‹è¯•ä¹‹é—´æ²¡æœ‰*äº¤å‰æ–‡ä»¶*ä¿¡æ¯ï¼Œæˆ‘ä¸èƒ½æœŸæœ›å®ƒè¢«ç¥å¥‡åœ°æ¡èµ·æ¥ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰å„ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚ï¼Œä½†ä¸é™äº:

*   å°†`import '@testing-library/jest-dom/extend-expect'`æ·»åŠ åˆ°æ¯ä¸ªæµ‹è¯•æ–‡ä»¶ä¸­ã€‚è¿™æ‰©å±•äº†`expect()`åŒ¹é…å™¨ä»¥åŒ…å«åº“æä¾›çš„é‚£äº›åŒ¹é…å™¨ï¼Œ
*   ç¡®ä¿`typescript`çŸ¥é“è¿™æ€»æ˜¯åŒ…æ‹¬åœ¨å†…çš„(è¿™æ˜¯çœŸçš„ï¼Œè€ƒè™‘åˆ°`jest.config.js`çš„å˜åŒ–)ã€‚

ä¸ºäº†è·å¾—â€œæ€»æ˜¯è¢«åŒ…å«â€çš„ä½“éªŒï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ªæ–°æ–‡ä»¶`declarations.d.ts`å’Œä¸€ä¸ªä¸‰æ–œçº¿æŒ‡ä»¤*ã€‚æˆ‘é€šå¸¸ä¼šé¿å¼€è¿™äº›æŒ‡ä»¤ï¼Œç”šè‡³æœ‰ä¸€ä¸ª`eslint`è§„åˆ™æ¥ç¦æ­¢å®ƒä»¬ï¼Œä½†æ˜¯æ ¹æ®æˆ‘çš„ç»éªŒï¼Œå½“ä½ é‡åˆ°è¿™æ ·çš„é—®é¢˜å¹¶ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œå·¥å…·æ˜¯æœ€å¥½çš„ã€‚å¦‚æœä½ åœ¨æœªæ¥çš„æŸä¸ªæ—¶å€™å…³æ³¨è¿™ç¯‡æ–‡ç« ï¼Œè¿™å¯èƒ½ä¸æ˜¯çœŸçš„ã€‚ä½ å¯ä»¥åšä»»ä½•å·¥ä½œï¼Œä¹Ÿè®¸ä¸€ä¸ª`import`å°±å¤Ÿäº†:* 

```
touch __tests__/declarations.d.ts 
```

```
/* eslint-disable @typescript-eslint/no-triple-slash-reference */
/// <reference types="@testing-library/jest-dom/extend-expect" /> 
```

è¿™æ˜¯å‘Šè¯‰ TypeScriptï¼Œå¯¹äºå½“å‰çš„ç›®å½•å­æ ‘(`__tests__`)ï¼Œå®ƒåº”è¯¥æ€»æ˜¯æ·»åŠ æŒ‡ä»¤å®šä¹‰çš„åŒ…ç±»å‹ã€‚æˆ‘ç°åœ¨è¿˜å¯ä»¥çœ‹åˆ°`__tests__/App.tsx`ä¸­çš„é”™è¯¯å·²ç»è¢«è§£å†³ï¼Œå®ƒå¯ä»¥è¯†åˆ«`.toBeVisible`ã€‚

### è·å–è¦†ç›–æŠ¥å‘Š

è¦†ç›–ç‡æŠ¥å‘Šä¸éœ€è¦æ–°çš„ä¾èµ–é¡¹ï¼Œå› ä¸º`jest`ä¸å†…ç½®è¦†ç›–ç‡æ†ç»‘åœ¨ä¸€èµ·ã€‚

ä¸ºäº†æµ‹è¯•`coverage`æ˜¯å¦æ­£å¸¸å·¥ä½œ*ï¼Œæˆ‘é¦–å…ˆä¿®æ”¹äº†`App.tsx` src æ–‡ä»¶ä»¥åŒ…å«ä¸€ä¸ªåˆ†æ”¯:* 

 *```
import React from 'react'

export interface AppProps {
  headingText?: string
}

export function App({ headingText }: AppProps): JSX.Element | null {
  if (headingText === undefined) {
    return null
  }

  return <h1>{headingText}</h1>
} 
```

ç°åœ¨ï¼Œåº”ç”¨ç¨‹åºæ¸²æŸ“`null`ï¼Œé™¤éç»™å‡ºä¸€ä¸ª`headingText`ã€‚æˆ‘è¿˜å¿…é¡»æ›´æ”¹æµ‹è¯•ä»¥é€šè¿‡ä½œä¸ºæ ‡é¢˜æ–‡æœ¬çš„`"Hello World"`ï¼Œå¦åˆ™æµ‹è¯•å°†
å¤±è´¥:

```
-  <App /> +  <App headingText="Hello World" />, 
```

æˆ‘åœ¨å¯ç”¨è¦†ç›–ç‡çš„æƒ…å†µä¸‹è¿è¡Œæµ‹è¯•å¥—ä»¶:

```
yarn test --coverage 
```

è¿™å°†è¿è¡Œæµ‹è¯•ï¼Œå¹¶ä¸”æµ‹è¯•ç»“æœæ˜¯*é€šè¿‡*ï¼›å®ƒè¿˜è¾“å‡ºä»¥ä¸‹è¡¨æ ¼æ‘˜è¦:

```
----------|----------|----------|----------|----------|-------------------|
File      |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
----------|----------|----------|----------|----------|-------------------|
All files |    66.67 |       50 |      100 |    66.67 |                   |
 App.tsx  |    66.67 |       50 |      100 |    66.67 |                 9 |
----------|----------|----------|----------|----------|-------------------| 
```

**ç¬¬ 9 è¡Œ**åœ¨ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯å†…(ç”¨äºå½“`headerText === undefined` ):

```
 return null 
```

è¿™å¯ä»¥é€šè¿‡æ˜¾å¼æ·»åŠ ä¸€ä¸ªæµ‹è¯•æ¥æµ‹è¯•ã€‚

```
it('App renders nothing without headingText', () => {
  const { container } = render(
    <App />,
  )

  expect(container.firstChild).toBeNull()
}) 
```

æˆ‘é€šå¸¸ä¸å–œæ¬¢æµ‹è¯•äº‹ç‰©æ˜¯åœ¨*è€Œä¸æ˜¯*é‚£é‡Œï¼Œå› ä¸ºé€šå¸¸ä½ ä¸å¾—ä¸åšå‡ºä¸€äº›æœ€è„†å¼±çš„å‡è®¾(å› æ­¤å¾ˆå®¹æ˜“è¢«æ‰“ç ´)ï¼Œä½†åªæ˜¯ä¸ºäº†æµ‹è¯•`jest`æ˜¯å¦å·²ç»è¢«æ­£ç¡®è®¾ç½®ï¼Œè¿™å¾ˆå¥½ï¼Œå› ä¸ºæˆ‘ç¨åä¼šæ‰”æ‰è¿™äº›è¡Œ:

```
$ jest --coverage
 PASS  __tests__/App.tsx
  âˆš App renders heading (46ms)
  âˆš App renders nothing without headingText (1ms)

----------|----------|----------|----------|----------|-------------------|
File      |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
----------|----------|----------|----------|----------|-------------------|
All files |      100 |      100 |      100 |      100 |                   |
 App.tsx  |      100 |      100 |      100 |      100 |                   |
----------|----------|----------|----------|----------|-------------------|
Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
Snapshots:   0 total
Time:        4.911s
Ran all test suites.
Done in 6.78s. 
```

## æ­£ç¡®è®¾ç½®`prettier`

æœ€åï¼Œæˆ‘å¯ä»¥ä¸“æ³¨äºè®¾ç½®(è‡ªåŠ¨)ä»£ç æ ¼å¼åŒ–ç¨‹åºï¼æˆ‘çœŸçš„å¾ˆå–œæ¬¢`prettier`ï¼ŒåŸå› å¾ˆç®€å•ï¼Œå®ƒæ¶ˆé™¤äº†è®¨è®ºè®¸å¤šé£æ ¼é€‰æ‹©çš„éœ€è¦ã€‚æˆ‘*ä¸*è®¤ä¸ºå®ƒæ€»æ˜¯æˆ–è€…ç”šè‡³ç»å¸¸ç”Ÿæˆ**æ¼‚äº®çš„**ä»£ç ï¼Œä¸è¿‡æ²¡å…³ç³»ã€‚éšç€ä»–ä»¬çš„åº“çš„æ”¹è¿›ï¼Œè¾“å‡ºä¹Ÿåœ¨æ”¹è¿›ï¼Œä¸€æ—¦ä»–ä»¬æ”¹è¿›äº†ï¼Œé‡æ–°æ ¼å¼åŒ–æ‰€æœ‰çš„ä»£ç æ˜¯å¾ˆå®¹æ˜“çš„ã€‚

*   `eslint-config-prettier`:å…³é—­ä¸æ›´æ¼‚äº®ç›¸å†²çªçš„æ ·å¼è§„åˆ™ã€‚ä½ å¯ä»¥åœ¨ä¸Šé¢çš„`eslint`é…ç½®ä¸­çœ‹åˆ°å„ç§`prettier/*`çº¿è·¯ã€‚è¿™å·²ç»è®¾ç½®å¥½äº†ã€‚
*   æ ¸å¿ƒåŒ…ï¼ŒåŒ…æ‹¬è¿è¡Œæ›´æ¼‚äº®çš„ CLI å·¥å…·ã€‚

æ›´æ¼‚äº®çš„å·²ç»è¢«æ·»åŠ åˆ°`eslint`é…ç½®ä¸­ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å¯ä»¥è·³è¿‡ã€‚

åœ¨ç¼–å†™æ—¶ï¼Œ`prettier` CLI æ²¡æœ‰`--init`é€‰é¡¹ï¼Œæ‰€ä»¥æˆ‘æ‰‹å·¥åˆ›å»ºé…ç½®æ–‡ä»¶:

```
touch .prettierrc.json 
```

æˆ‘é€‰æ‹©äº†çœ‹ä¼¼è·Ÿéš`StandardJS`çš„é£æ ¼ï¼Œä½†è¿™çœŸçš„æ²¡å…³ç³»ã€‚é€‰æ‹©ä¸€ç§é£æ ¼å¹¶åšæŒä¸‹å»ã€‚

```
{  "trailingComma":  "es5",  "tabWidth":  2,  "semi":  false,  "singleQuote":  true,  "jsxSingleQuote":  false  } 
```

æˆ‘è¿˜å¸Œæœ›èƒ½å¤Ÿå°†è¿™äº›ä½œä¸ºè„šæœ¬è¿è¡Œï¼Œæ‰€ä»¥æˆ‘æ·»åŠ äº†ä»¥ä¸‹ä¸‰ä¸ª`"scripts"` :

```
 "lint:types": "yarn tsc",
+  "lint:format": "yarn format --check",
+  "format": "yarn prettier \"{src,__{tests}__}/**/*.{ts,tsx}\"",
+  "format:fix": "yarn format --write",
   "test": "yarn jest" 
```

### è‡ªåŠ¨æ ¼å¼åŒ–

ç”±äº`prettier`å·²ç»ä½œä¸ºæ’ä»¶æ·»åŠ åˆ°`eslint`ä¸­ï¼Œå®ƒå·²ç»æ­£ç¡®åœ°ä¸`eslint`é›†æˆã€‚ç„¶è€Œï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä»£ç åœ¨ä¿å­˜æ—¶è¢«æ ¼å¼åŒ–*ã€‚æ›´æ¼‚äº®çš„æ–‡æ¡£åˆ—å‡ºäº†è®¸å¤š ideï¼Œå¹¶å…è®¸ä½ åœ¨ä¿å­˜æ—¶æ‰“å¼€æ ¼å¼åŒ–ã€‚*

æ€»çš„æ¥è¯´ï¼Œæˆ‘ä¸å–œæ¬¢åœ¨æäº¤æ—¶è¿è¡Œå¾—æ›´æ¼‚äº®*ï¼Œå› ä¸ºå®ƒä¼šé™ä½æˆ‘çš„æäº¤é€Ÿåº¦ï¼Œå¶å°”ä¼šå‡ºé”™ï¼Œæˆ‘è®¤ä¸ºæ ¼å¼åŒ–ä»£ç ä¸åº”è¯¥æ˜¯æäº¤çš„é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ç¡®å®è®¤ä¸ºåœ¨æŒç»­é›†æˆ(CI)ä¸­æ·»åŠ ä¸€ä¸ªæ£€æŸ¥æ¥æµ‹è¯•é¡¹ç›®çš„æ ¼å¼æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚*

## ç»“è®º

å°±æ˜¯è¿™æ ·ï¼è¯¥é¡¹ç›®ç°åœ¨å¤„äºå¼€å§‹ç¼–å†™ä»£ç çš„è‰¯å¥½çŠ¶æ€ã€‚æ˜¯çš„ï¼Œè¿™èŠ±äº†ä¸å°‘æ—¶é—´ï¼Œä¸Šé¢çš„è®¸å¤šé…ç½®è®¾ç½®æ­£æ˜¯è¯¸å¦‚`create-react-app`ç”šè‡³`parcel`æ†ç»‘å™¨è¿™æ ·çš„å·¥å…·å­˜åœ¨çš„åŸå› ã€‚æ³¨æ„ï¼Œæˆ‘å®é™…ä¸Šè¿˜æ²¡æœ‰å¤„ç†è¿‡`parcel`å’Œ`webpack`å¤„ç†çš„ä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚å¯¼å…¥å›¾åƒæˆ–è€…å…¶ä»–æ–‡ä»¶ç±»å‹ï¼›æˆ‘ä¸è®¤ä¸ºæˆ‘ä¼šéœ€è¦å®ƒï¼Œå› æ­¤æˆ‘æ²¡æœ‰æ·»åŠ å®ƒã€‚

è¿˜æœ‰å‡ ä»¶äº‹è¦åš:

*   è®¾ç½®é…ç½®é¡¹ï¼Œ
*   æ·»åŠ `"name"`å’Œâ€œè®¸å¯è¯â€å­—æ®µï¼Œ
*   æ·»åŠ  *servability* ï¼Œå³æ·»åŠ æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°çš„ HTML æ–‡ä»¶ã€‚

ä¸‹æ¬¡æˆ‘ä¼š*å®é™…ä¸Š*å†™ä¸€äº›æ¸¸æˆä»£ç ï¼Œä¹Ÿè®¸æ˜¯åˆšåˆšåˆ—å‡ºçš„ä¸œè¥¿ï¼Œä½†æ˜¯ç°åœ¨ï¼Œè¿™æ˜¯æˆ‘ç»™ä½ çš„å…¨éƒ¨ã€‚

[![Photo of "De Rotterdam", Rotterdam, Netherlands, with the building, the Cruise Terminal, and a small boat coasting towards the photographer on a gloomy day.](img/da9b1992591695f3c2b6d70201161ff6.png "Photo by Reginar (https://unsplash.com/@reginar) on Unsplash (https://unsplash.com/)")](https://res.cloudinary.com/practicaldev/image/fetch/s--if3Wbs4n--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/74bosly3ryp7snoz4xt4.jpg)**