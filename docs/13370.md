# åˆ›å»ºæ°¸ä¸ç¦»çº¿çš„ web åº”ç”¨ç¨‹åºï¼

> åŸæ–‡:[https://dev . to/PaCO _ ita/break-the-cache-API-limits-in-our-pwa-oo3](https://dev.to/paco_ita/break-the-cache-api-limits-in-our-pwa-oo3)

æ¬¢è¿é˜…è¯»å…³äºæ¸è¿›å¼ web åº”ç”¨çš„ç¬¬äº”ç¯‡æ–‡ç« ã€‚ğŸ™‹
å¦‚æœä½ é˜…è¯»äº†[è¿™ä¸ªç³»åˆ—çš„ç¬¬ä¸€ç¯‡æ–‡ç« ](https://dev.to/paco_ita/a-gentle-introduction-to-progressive-web-apps-step-1-24da)ï¼Œä½ ç°åœ¨åº”è¯¥æœ‰äº†ä¸€ä¸ªåšå®çš„åŸºç¡€ï¼Œå³ä½¿ PWAs æ˜¯å®Œå…¨æœªçŸ¥çš„ã€‚
åƒ`service workers`ã€`web app manifest`ã€`cache API`è¿™äº›åè¯ä½ åº”è¯¥å¾ˆç†Ÿæ‚‰ã€‚åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å‘ç°äº†å¯ä»¥ç”¨æ¥è½»æ¾åœ°ä»å¤´æ„å»º PWA çš„ä¸åŒå·¥å…·ã€‚å› æ­¤ï¼Œæ‚¨å¯èƒ½å·²ç»å¼€å§‹ä½¿ç”¨å­¦ä¹ åˆ°çš„æ¸è¿›å¼åŠŸèƒ½å‡çº§æ‚¨ç°æœ‰çš„ web åº”ç”¨ç¨‹åºã€‚

è¿™å·²ç»æ˜¯ä¸ºæˆ‘ä»¬çš„ç”¨æˆ·æä¾›æ›´å¥½ä½“éªŒçš„ä¸€ä¸ªè¿›æ­¥ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åšäº›åˆ«çš„äº‹æƒ…æ¥è¿›ä¸€æ­¥åˆ©ç”¨æ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼Œå¹¶å°†å®ƒä»¬å¸¦åˆ°ä¸€ä¸ªæ–°çš„æ°´å¹³ã€‚æˆ‘å°†å‘æ‚¨å±•ç¤ºï¼Œå¦‚ä»Šï¼Œå€ŸåŠ©ç°ä»£æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºç”¨æˆ·æä¾›æ°¸ä¸ç¦»çº¿çš„åº”ç”¨ç¨‹åºã€‚

æ‰€ä»¥æ‹¿æ¯å’–å•¡ï¼Œè®©è‡ªå·±èˆ’æœä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼ï¼

[![start](../Images/7374c44096e4593eecf008d2e1d41d5c.png)](https://i.giphy.com/media/l0IyjiXOXTX6Yemsg/giphy.gif)T3ã€‘

## [](#limits-of-the-cache-api)ç¼“å­˜ API çš„é™åˆ¶

æˆ‘ä»¬ä¹‹å‰äº†è§£åˆ°`Cache API`åªå…è®¸ç¼“å­˜`GET Requests`ï¼Œä½†æ˜¯ç›®å‰è¿˜ä¸èƒ½ç¼“å­˜ [`POST nor PUT`](https://w3c.github.io/ServiceWorker/#cache-put) ã€‚
å¦‚æœä½ è¯•å›¾ç¼“å­˜ä¸€ä¸ªä¸æ˜¯`GET`çš„è¯·æ±‚ï¼Œä½ ä¼šæ”¶åˆ°ä¸‹é¢çš„é”™è¯¯:`TypeError: Invalid request method POST.`(è¿™é‡Œæ˜¯æˆ‘ä»¬æäº¤å¸–å­çš„æƒ…å†µ)ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬çš„ç½‘ç»œåº”ç”¨ä»ç„¶ç¦»çº¿å·¥ä½œï¼Œå®ƒå…è®¸å¯¼èˆªå’Œé˜…è¯»å†…å®¹ï¼Œä½†å®ƒåªæä¾›äº†è¢«åŠ¨çš„ä½“éªŒã€‚å°½ç®¡è¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæä¾›å®Œæ•´çš„ CRUD(åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤)åŠŸèƒ½ï¼Œç”šè‡³æ˜¯ç¦»çº¿çš„ï¼Œé‚£å°±æ›´å¥½äº†ã€‚

ä¸ºæ­¤ï¼Œæœ‰å¿…è¦å¼€å‘å®šåˆ¶çš„è§£å†³æ–¹æ¡ˆæ¥å…‹æœè¿™ä¸€é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹å®¢æˆ·ç«¯ä½•æ—¶ç¦»çº¿ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ç”¨æˆ·åœ¨è¡¨å•ä¸­è¾“å…¥å¹¶è¯•å›¾å‘é€åˆ°æœåŠ¡å™¨çš„å€¼å­˜å‚¨åœ¨ç´¢å¼•æ•°æ®åº“ä¸­ã€‚
ç„¶åï¼Œå½“ç”¨æˆ·çš„ç½‘ç»œè¿æ¥æ¢å¤æ—¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¿…é¡»æ¨é€æ‰€æœ‰å¾…å®šçš„æ›´æ”¹ã€‚æˆ‘ä»¬è¿˜å¿…é¡»è®¡åˆ’å¦‚ä½•å¤„ç† POST å¤±è´¥æ—¶çš„å¼‚å¸¸ï¼Œä»¥åŠè¿™ä¼šå¦‚ä½•å½±å“å…¶ä»–ç¼“å­˜çš„è¯·æ±‚ã€‚

å¦ä¸€ç§å¯èƒ½æ€§ç”±`Cloud Firestore`ç»™å‡ºã€‚

## [](#cloud-firestore)äº‘ç«åº—

[![firestore-logo](../Images/d286c009006207af685ef98f7521b727.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ccCMPZpR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9uhu47s2cfwho07z1dbc.png)

> Cloud Firestore æ˜¯ä¸€ä¸ªçµæ´»ã€å¯æ‰©å±•çš„ NoSQL æ•°æ®åº“ï¼Œç”¨äº Firebase å’Œ Google äº‘å¹³å°çš„ç§»åŠ¨ã€web å’ŒæœåŠ¡å™¨å¼€å‘ã€‚å®ƒé€šè¿‡å®æ—¶ç›‘å¬å™¨ä½¿æ‚¨çš„æ•°æ®åœ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¹‹é—´ä¿æŒåŒæ­¥ï¼Œå¹¶ä¸ºç§»åŠ¨å’Œ web æä¾›ç¦»çº¿æ”¯æŒï¼Œå› æ­¤æ‚¨å¯ä»¥æ„å»ºå“åº”è¿…é€Ÿçš„åº”ç”¨ç¨‹åºï¼Œæ— è®ºç½‘ç»œå»¶è¿Ÿæˆ–äº’è”ç½‘è¿æ¥å¦‚ä½•éƒ½å¯ä»¥å·¥ä½œã€‚

[![structure](../Images/165526a230a939e709b8c2c917b04644.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ePddTFqJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/r26hmpckf4r3qgtkzxje.png)
Firestore æ•°æ®åº“ä¸­çš„æ•°æ®ä¿å­˜ä¸ºåä¸º`Documents`çš„ json å¯¹è±¡(key:value ç»“æ„)å¹¶åŒ…å«åœ¨`Collections`ä¸­ã€‚è¿™ç§ç»„ç»‡ä½¿å¾—ä»¥ç±»ä¼¼äºæˆ‘ä»¬çš„ web åº”ç”¨ç¨‹åº DTOs çš„æ–¹å¼è®¾è®¡é¢†åŸŸå¯¹è±¡(ä¿å­˜åœ¨æ•°æ®åº“ä¸­)å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

Firebase platform è¿˜æå‡ºäº†ä¸€ä¸ªæ…·æ…¨çš„*å…è´¹å±‚*:

[![free-tier](../Images/b68c4d9adad5c522e5de04c87a840474.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--p4eRDKFQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/e0c1c5o73li16443h4bu.png)

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒç”¨äºæˆ‘ä»¬çš„ä¸ªäººé¡¹ç›®æˆ–æ¼”ç¤ºï¼Œè€Œä¸å¿…æ‹…å¿ƒåˆå§‹æˆæœ¬ã€‚

æˆ‘å°†ä¿ç•™ä¸€ç¯‡å•ç‹¬çš„æ–‡ç« æ¥æ›´è¯¦ç»†åœ°æè¿° Firebase å¹³å°å’Œå…¶ä»–äº‘ Firestore ç‰¹æ€§ã€‚è¿™é‡Œæˆ‘ä»¬é›†ä¸­è®¨è®ºå®ƒçš„`offline persistence`åŠŸèƒ½ã€‚

#### [](#offline-persistence)ç¦»çº¿æš‚ç•™

é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºç§»åŠ¨å¼€å‘å¯ç”¨è„±æœºå­˜å‚¨ï¼Œä½†ä¸ä¸º web å¯ç”¨ã€‚æˆ‘ä»¬å¿…é¡»é€šè¿‡è°ƒç”¨`enablePersistence`æ–¹æ³•æ¥æ˜¾å¼æ¿€æ´»å®ƒ:

```
// Register Firebase Keys
firebase.initializeApp({
  apiKey: '### FIREBASE API KEY ###',
  authDomain: '### FIREBASE AUTH DOMAIN ###',
  projectId: '### CLOUD FIRESTORE PROJECT ID ###',
} ,"myDemoApp");

// Enable offline support
firebase.firestore().enablePersistence()
  .catch(function(err) {
      if (err.code == 'unimplemented') {
          // The current browser does not support all of the
          // features required to enable persistence
      }
  });
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»è¿™ä¸€åˆ»èµ·ï¼Œä»æœåŠ¡å™¨æ¥æ”¶çš„ä»»ä½•æ–‡æ¡£éƒ½å­˜å‚¨åœ¨æœ¬åœ°çš„ç´¢å¼•æ•°æ®åº“ä¸­ã€‚ç°åœ¨ï¼Œå³ä½¿æ²¡æœ‰ç½‘ç»œè¿æ¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é˜…è¯»ã€ç¼–è¾‘æˆ–åˆ é™¤ä»»ä½•ç¼“å­˜çš„æ–‡æ¡£ã€‚å¦‚æœç¼“å­˜ä¸åŒ…å«è¯·æ±‚çš„æ–‡æ¡£ï¼Œå°†è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ç”¨æˆ·ä¸€æ¢å¤åœ¨çº¿ï¼Œæ‰€æœ‰å¾…å†³çš„æœ¬åœ°æ›´æ”¹å°±ä¼šè‡ªåŠ¨ä¸æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“åŒæ­¥ã€‚

è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªä¸­æ–­ç½‘ç»œè¿æ¥çš„ç«è½¦ä¸Šæ—…è¡Œï¼Œä¸æ–­åœ°ç¦»çº¿å’Œåœ¨çº¿ã€‚å¬èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼Œä¸æ˜¯å—ï¼Ÿ

[![offline](../Images/71383ed3a5cf9849b1d19555a3110183.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s---IJemlL_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/a53s0n41slya7y73z6r9.jpg)

ç„¶è€Œï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä»ç„¶æ˜¯å¯è®¿é—®çš„ï¼Œç”šè‡³å…è®¸ä¿®æ”¹å…¶å†…å®¹(åªè¦æˆ‘ä»¬åœ¨ç¼“å­˜ä¸­æœ‰è¯·æ±‚çš„æ–‡æ¡£)ã€‚æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªæ— è®ºåœ¨çº¿è¿˜æ˜¯ç¦»çº¿éƒ½èƒ½æ— ç¼è¿è¡Œçš„ PWAã€‚

æˆ‘ä»¬å¯ä»¥åœ¨ DevTools çš„â€œåº”ç”¨ç¨‹åºâ€é€‰é¡¹å¡ä¸­åˆ†æç¼“å­˜çš„æ•°æ®(å¦‚æœä½¿ç”¨ Chrome):

[![cached-data](../Images/a879db2bb57aed15080c32d108bc4a2c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--_TDUkyIZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/jfrak95w4fr0d77baldc.png)

é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜é™åˆ¶ä¸º 40MBã€‚è¶…è¿‡æ­¤é™é¢åï¼ŒFirestore ä¼šå°è¯•æ¸…ç†æ—§æ–‡æ¡£ï¼Œç›´åˆ°ç¼“å­˜å¤§å°æ¢å¤åˆ°é™åˆ¶è®¾ç½®ä»¥ä¸‹ã€‚å¯ä»¥æŒ‡å®šä¸åŒçš„é˜ˆå€¼(æœ€å°å€¼å¿…é¡»æ˜¯ 1MB)æˆ–å®Œå…¨ç¦ç”¨é©±é€è¿‡ç¨‹:

```
firebase.firestore().settings({
  cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#firestore-limitations)Firestore é™åˆ¶

ä½†æ˜¯ï¼Œåœ¨å†³å®šåœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ Firestore ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»äº†è§£ä¸€äº›é™åˆ¶:

*   **å¾…å®šæ›´æ”¹çš„é™åˆ¶è®¾ç½®ä¸º 500ã€‚**
    è°·æ­Œå·¥ç¨‹å¸ˆæ˜ç¡®è®¾è®¡äº†è¿™æ ·ä¸€ä¸ªé™åˆ¶ï¼Œå› ä¸ºç¦»çº¿æŒä¹…åŒ–æ˜¯ä¸ºäº†è¦†ç›–æš‚æ—¶çš„è¿æ¥ä¸­æ–­ï¼Œä¸ä¼šè¢«é•¿æ—¶é—´ä½¿ç”¨ã€‚

*   **å¹¶å‘æ›´æ–°ç­–ç•¥æ˜¯â€œæœ€åå†™å…¥è€…ä¼˜å…ˆâ€ã€‚**
    å¦‚æœæ•°æ®åº“ä¸­çš„åŒä¸€ä¸ªæ–‡æ¡£æœ‰å¤šæ¬¡æ›´æ–°ï¼Œå°†ä¿å­˜åˆ°è¾¾æœåŠ¡å™¨çš„æœ€åä¸€æ¬¡å†™å…¥ã€‚å¦‚æœæ—§çš„æ•°æ®æ¥è‡ªç¦»çº¿çš„å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”ç°åœ¨æ­£åœ¨åŒæ­¥å…¶æŒ‚èµ·çš„æ›´æ”¹ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„ä¿å­˜æ—§çš„*æ•°æ®ã€‚* 

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œé€‰æ‹©æƒåœ¨ä½ ã€‚ç¦»çº¿æ—¶ä¸ä¸€å®šè¦æä¾›ç¼–è¾‘åŠŸèƒ½ï¼Œè¿™å–å†³äºæ‚¨çš„ä¸šåŠ¡éœ€æ±‚ã€‚å¦‚æœä½ å†³å®šå»åšï¼Œé‚£ä¹ˆè¦ä¹ˆä½ å¼€å‘ä¸€ä¸ªå®Œæ•´çš„å®šåˆ¶è§£å†³æ–¹æ¡ˆï¼Œè¦ä¹ˆé€‰æ‹© Firestoreã€‚æˆ‘å‘ç°åä¸€ç§é€‰æ‹©ä¸è´¹å¹ç°ä¹‹åŠ›å°±èƒ½å¸¦æ¥å¾ˆå¤šå¥½å¤„ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•è¿›ä¸€æ­¥æ”¹è¿›æˆ‘ä»¬çš„ PWAï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿè¯´æœä½ ï¼Œç°åœ¨å®ç°æ½œåœ¨çš„æ°¸ä¸ç¦»çº¿çš„ web åº”ç”¨ç¨‹åºæ˜¯å¯èƒ½çš„ï¼

[![bye](../Images/1cfeb3066f6ac96116458c85b0f10bfc.png)T4ã€‘](https://i.giphy.com/media/OOSp3kMb3IL4lE27Ar/giphy.gif)

ä½ å¯ä»¥å…³æ³¨æˆ‘:

[![follow-me-twitter](../Images/ff8782766b4760eb9020cec54eb02af8.png)](https://twitter.com/paco_ita)