# æ‚¨å¯ä»¥åœ¨ 35 LOC ä¸­åˆ›å»º React æ ·å¼çš„ç»„ä»¶

> åŸæ–‡:[https://dev . to/duty yesh/you-can-create-react-styled-components-in-35-loc-22df](https://dev.to/dutiyesh/you-can-create-react-styled-components-in-35-loc-22df)

ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ styled component åœ¨ hood ä¸‹æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿè®©æˆ‘ä»¬é€šè¿‡å»ºé€ ä¸€ä¸ªæ¥æ‰¾å‡ºç­”æ¡ˆã€‚

## [](#understanding-styled-components-api-%E2%80%8D)äº†è§£é£æ ¼åŒ–ç»„ä»¶ API ğŸ•µï¸â€

```
import styled from 'styled-components'

const Heading = styled.h1`
    color: palevioletred;
`;

const App = () => {
    return <Heading>styled components</Heading>
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åŸºäºæ ·å¼åŒ–ç»„ä»¶è¯­æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¯´æ ·å¼åŒ–ç»„ä»¶è¿”å›ä¸€ä¸ªå¸¦æœ‰åä¸º methods çš„ HTML æ ‡ç­¾çš„`styled`å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å¸¦æ ‡ç­¾çš„æ¨¡æ¿æ–‡å­—ã€‚

æ ‡è®°æ¨¡æ¿å°±åƒè°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚

```
greeting('Bruce');
// same as
greeting`Bruce`; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å”¯ä¸€çš„åŒºåˆ«æ˜¯ Tagged Template å¦‚ä½•å¤„ç†å®ƒçš„å‚æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²å€¼æ•°ç»„ã€‚

```
// logging function arguments

logArguments('Bruce');
// -> Bruce

logArguments`Bruce`;
// -> ["Bruce"] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#styled-component-phases)æ ·å¼åŒ–ç»„ä»¶é˜¶æ®µğŸŒ—

æˆ‘ä»¬å°†æ ·å¼ç»„ä»¶åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ:

### [](#phase-1-creation-phase)é˜¶æ®µ 1:åˆ›å»ºé˜¶æ®µ

åœ¨åˆ›å»ºé˜¶æ®µï¼Œæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªåä¸º method like - `h1`çš„æ ·å¼åŒ–ç»„ä»¶çš„æ ‡ç­¾ï¼Œå®ƒè¿”å›ä¸€ä¸ªåŠŸèƒ½æ€§çš„ React ç»„ä»¶ã€‚

```
// App.js
const Heading = styled.h1`
    color: palevioletred;
`; // â‡ï¸ Creation Phase

// styled-components.js
function h1(styleLiteral) {
    return () => { // â‡ï¸ Function component
        return <h1></h1>
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#phase-2-rendering-phase)ç¬¬äºŒé˜¶æ®µ:æ¸²æŸ“é˜¶æ®µ

åœ¨æ¸²æŸ“é˜¶æ®µï¼Œæˆ‘ä»¬æ¸²æŸ“åœ¨é˜¶æ®µ 1 ä¸­åˆ›å»ºçš„åŠŸèƒ½ç»„ä»¶ã€‚

```
const Heading = styled.h1`
    color: palevioletred;
`;

const App = () => {
    return <Heading /> // â‡ï¸ Rendering Phase
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#approaching-towards-style-part-of-styled-component)å‘è¢«é€ å‹æ„ä»¶çš„â€œé€ å‹â€éƒ¨åˆ†é è¿‘ğŸ’„

åœ¨åˆ›å»ºé˜¶æ®µï¼Œæˆ‘ä»¬å°†æ ·å¼ä¼ é€’ç»™äº†`h1`å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•åœ¨ä¸å†…è”å®ƒçš„æƒ…å†µä¸‹å°†å®ƒåº”ç”¨åˆ°æˆ‘ä»¬çš„ç»„ä»¶å‘¢ï¼ŸğŸ¤”

æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç±»é€‰æ‹©å™¨ï¼Œå¹¶åˆ†é…ä¸€ä¸ªéšæœºçš„åç§°ã€‚

```
const className = `sc-${Math.random().toString(16).substr(2, 6)}`;
// Generate class names like - sc-79a268, sc-56d898 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥å°†æ ·å¼åº”ç”¨åˆ°æˆ‘ä»¬çš„ç±»ä¸­ï¼Œå¹¶é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„`style`æ ‡ç­¾(å¦‚æœä¸å­˜åœ¨çš„è¯)å°†å®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„é¡µé¢ä¸­ã€‚

ä¸ºäº†ä»å…¶ä»–`style`æ ‡ç­¾ä¸­å”¯ä¸€åœ°è¯†åˆ«å®ƒï¼Œæˆ‘ä»¬å°†åˆ†é…ä¸€ä¸ª`'sc-style'`çš„`id`ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªæ ‡ç­¾ä¸ºå…¶ä»–æ ·å¼åŒ–çš„ç»„ä»¶æ·»åŠ æ ·å¼ã€‚

```
function appendStyle(className, style) {
    let styleTag = document.getElementById('sc-style');

    if (!styleTag) {
        styleTag = document.createElement('style')
        styleTag.setAttribute('id', 'sc-style');
        document.getElementsByTagName('head')[0].appendChild(styleTag);
    }

    styleTag.appendChild(document.createTextNode(`.${className} { ${style} }`))
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç»“åˆä»¥ä¸Šä¸¤æ­¥ï¼Œæˆ‘ä»¬å¾—åˆ°:

```
function h1(styleLiterals) {
    return () => {
        const className = `sc-${Math.random().toString(16).substr(2, 6)}`;
        appendStyle(className, styleLiterals[0]); // pass first item at index 0

        return <h1 className={className}></h1>
    }
}

function appendStyle(className, style) {
    let styleTag = document.getElementById('sc-style');

    if (!styleTag) {
        styleTag = document.createElement('style')
        styleTag.setAttribute('id', 'sc-style');
        document.getElementsByTagName('head')[0].appendChild(styleTag);
    }

    styleTag.appendChild(document.createTextNode(`.${className} { ${style} }`))
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#passing-text-to-display-inside-our-styled-component)ä¼ é€’æ–‡æœ¬ä»¥æ˜¾ç¤ºæˆ‘ä»¬çš„æ ·å¼ç»„ä»¶âš›ï¸å†…éƒ¨

åœ¨æ¸²æŸ“é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®ä½œä¸ºå­©å­ä¼ é€’ç»™ç»„ä»¶ï¼Œå¹¶ä½¿ç”¨`props.children`åœ¨ç»„ä»¶å†…éƒ¨è¿›è¡Œæ¸²æŸ“ã€‚

```
// App.js
const App = () => {
    return <Heading>styled components</Heading> // Rendering phase
}

// styled-components.js
function h1(styleLiterals) {
    return (props) => { // â‡ï¸ props from parent component
        return <h1>{props.children}</h1>
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#we-created-styled-component)æˆ‘ä»¬åˆ›å»ºäº†æ ·å¼åŒ–ç»„ä»¶ğŸ’…

```
// App.js
import styled from 'styled-components';

const Heading = styled.h1`
    color: palevioletred;
`;

const App = () => {
    return <Heading>styled components</Heading>
}

// styled-components.js
function h1(styleLiterals) {
    return (props) => {
        const className = `sc-${Math.random().toString(16).substr(2, 6)}`;
        appendStyle(className, styleLiterals[0]);

        return <h1 className={className}>{props.children}</h1>
    }
}

function appendStyle(className, style) {
    let styleTag = document.getElementById('sc-style');

    if (!styleTag) {
        styleTag = document.createElement('style')
        styleTag.setAttribute('id', 'sc-style');
        document.getElementsByTagName('head')[0].appendChild(styleTag);
    }

    styleTag.appendChild(document.createTextNode(`.${className} { ${style} }`))
}

const styled = {
    h1
}

export default styled; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

## [](#customizing-styled-components-with-props)ç”¨é“å…·å®šåˆ¶é£æ ¼åŒ–ç»„ä»¶ğŸ¨

è®©æˆ‘ä»¬é€šè¿‡ä¼ é€’ä¸€ä¸ª`color`å±æ€§æ¥å®šåˆ¶æˆ‘ä»¬çš„ç»„ä»¶ï¼Œä»¥ä¸åŒçš„é¢œè‰²å‘ˆç°æ–‡æœ¬ã€‚

```
const Heading = styled.h1`
    color: ${(props) => ${props.color}}; // Apply color from props
`;

const App = () => {
    return <Heading color="palevioletred">styled components</Heading>
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ æ³¨æ„åˆ°ä¸Šé¢çš„è¯ï¼Œæˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­æœ‰ä¸€ä¸ªæ’å€¼ã€‚

é‚£ä¹ˆå½“æˆ‘ä»¬ä¼ é€’å¸¦æœ‰æ’å€¼çš„æ¨¡æ¿æ–‡å­—æ—¶ï¼Œå‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

```
const username = 'Bruce';

greeting`Hello ${username}!`;
// -> ["Hello ", "!"] "Bruce" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å‡½æ•°å°†åœ¨è¿™é‡Œæ¥æ”¶ 2 ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä»ç„¶æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚
ç¬¬äºŒä¸ªå‚æ•°å°†æ˜¯æ’å€¼å†…å®¹`'Bruce'`ã€‚

## [](#update-styled-component-to-receive-interpolation-content)æ›´æ–°æ ·å¼åŒ–ç»„ä»¶ä»¥æ¥æ”¶æ’å€¼å†…å®¹ğŸ“‘

```
function h1(styleLiterals, propInterpolation) {
    return () => {
        return <h1></h1>
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç”±äºæ’å€¼å‚æ•°çš„æ•°é‡ä¸å®šï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ rest å‚æ•°å°†å®ƒä»¬è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°ç»„ã€‚

æˆ‘ä»¬çš„å‡½æ•°ç°åœ¨å˜æˆ:

```
function h1(styleLiterals, ...propsInterpolations) { // â‡ï¸ with rest parameter
    return () => {
        return <h1></h1>
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#generate-style-with-interpolation)ç”¨æ’å€¼ç”Ÿæˆæ ·å¼ğŸ‘©â€ğŸ¨

æˆ‘ä»¬çš„å‡½æ•°ç°åœ¨æ¥æ”¶ä¸¤ä¸ªå‚æ•°- `stringLiterals`å’Œ`propsInterpolations`ï¼Œæˆ‘ä»¬å¿…é¡»åˆå¹¶å®ƒä»¬æ¥ç”Ÿæˆæ ·å¼ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œéå†ä¸¤ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹ï¼Œå¹¶å°†å®ƒä»¬ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¿æ¥èµ·æ¥ã€‚

```
function getStyle(styleLiterals, propsInterpolations, props) {
    return styleLiterals.reduce((style, currentStyleLiteral, index) => {
        let interpolation = propsInterpolations[index] || '';

        if (typeof interpolation === 'function') { // execute functional prop
            interpolation = interpolation(props);
        }

        return `${style}${currentStyleLiteral}${interpolation}`;
    }, '');
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æˆ‘ä»¬çš„æ ·å¼ç»„ä»¶ä¸­ä½¿ç”¨`getStyle`å‡½æ•°:

```
function h1(styleLiterals, ...propsInterpolations) {
    return (props) => {
        const className = `sc-${Math.random().toString(16).substr(2, 6)}`;
        const style = getStyle(styleLiterals, propsInterpolations, props); // pass required parameters to generate style
        appendStyle(className, style);

        return <h1 className={className}>{props.children}</h1>
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#optimization-time-%EF%B8%8F)ä¼˜åŒ–æ—¶é—´âš¡ï¸

ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°å½“æˆ‘ä»¬ç”¨ç›¸åŒçš„æ ·å¼æ¸²æŸ“ä¸¤ä¸ªæ ·å¼çš„ç»„ä»¶æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

```
const Heading = styled.h1`
    color: palevioletred;
`;

const App = () => {
    return (
        <React.Fragment>
            <Heading>styled components</Heading>
            <Heading>styled components</Heading>
        </React.Fragment>
    )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

2 ä¸ªç±»è¢«ç”Ÿæˆï¼Œå°½ç®¡å®ƒä»¬çš„é£æ ¼æ˜¯ç›¸åŒçš„ã€‚
ä¸ºäº†å‡å°‘é‡å¤çš„ä»£ç ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ JavaScript çš„`Map`å¯¹è±¡æ¥ä¿å­˜æˆ‘ä»¬çš„æ ·å¼åŠå…¶é”®å€¼å¯¹ä¸­çš„ç±»åã€‚

```
function h1(styleLiterals, ...propsInterpolations) {
    const styleMap = new Map(); // maintain a map of `style-className` pairs

    return (props) => {
        let className = '';
        const style = getStyle(styleLiterals, propsInterpolations, props);

        if (!styleMap.has(style)) { // check whether style is already present
            className = `sc-${Math.random().toString(16).substr(2, 6)}`;
            appendStyle(className, style);

            styleMap.set(style, className); // store class for a style in Map
        } else {
            className = styleMap.get(style); // reuse class for a style
        }

        return <h1 className={className}>{props.children}</h1>
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

## [](#end-result)æœ€ç»ˆç»“æœâœ¨âœ¨

```
function h1(styleLiterals, ...propsInterpolations) {
    const styleMap = new Map(); // maintain a map of `style-className` pairs

    return (props) => {
        let className = '';
        const style = getStyle(styleLiterals, propsInterpolations, props);

        if (!styleMap.has(style)) { // check whether style is already present
            className = `sc-${Math.random().toString(16).substr(2, 6)}`;
            appendStyle(className, style);

            styleMap.set(style, className); // store class for a style in Map
        } else {
            className = styleMap.get(style); // reuse class for a style
        }

        return <h1 className={className}>{props.children}</h1>
    }
}

function getStyle(styleLiterals, propsInterpolations, props) {
    return styleLiterals.reduce((style, currentStyleLiteral, index) => {
        let interpolation = propsInterpolations[index] || '';

        if (typeof interpolation === 'function') { // execute functional prop
            interpolation = interpolation(props);
        }

        return `${style}${currentStyleLiteral}${interpolation}`;
    }, '');
}

function appendStyle(className, style) {
    let styleTag = document.getElementById('sc-style');

    if (!styleTag) {
        styleTag = document.createElement('style')
        styleTag.setAttribute('id', 'sc-style');
        document.getElementsByTagName('head')[0].appendChild(styleTag);
    }

    styleTag.appendChild(document.createTextNode(`.${className} { ${style} }`))
}

const styled = {
    h1
}

export default styled; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[https://codesandbox.io/embed/k7119](https://codesandbox.io/embed/k7119)