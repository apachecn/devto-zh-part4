# å¦‚ä½•åœ¨ React ä¸­ä½¿ç”¨æ•…äº‹ä¹¦

> åŸæ–‡:[https://dev . to/tducasse/how-to-use-story book-with-react-10g 1](https://dev.to/tducasse/how-to-use-storybook-with-react-10g1)

*ç®€åŒ–æ‚¨çš„ UI ç»„ä»¶å¼€å‘å·¥ä½œæµç¨‹*

## ä»€ä¹ˆæ˜¯æ•…äº‹ä¹¦ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¦ç”¨å®ƒï¼Ÿ

æ¥è‡ª [Storybook çš„ç½‘ç«™](https://storybook.js.org/)æœ¬èº«:

> Storybook æ˜¯ä¸€ä¸ªç”¨äºç‹¬ç«‹å¼€å‘ UI ç»„ä»¶çš„å¼€æºå·¥å…·

### [](#reusable-components)å¯å¤ç”¨ç»„ä»¶

React å…è®¸æˆ‘ä»¬ç¼–å†™æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œå¯é‡ç”¨ç»„ä»¶â€çš„ä¸œè¥¿ã€‚å¦‚æœæ‚¨ä¸çŸ¥é“ä»€ä¹ˆæ˜¯å¯é‡ç”¨ç»„ä»¶ï¼Œè¯·ä»¥æŒ‰é’®ä¸ºä¾‹:

*   æ‚¨å¯ä»¥æœ‰ä¸åŒçš„å˜ä½“:
    *   çº¢è‰²èƒŒæ™¯çš„`primary`æŒ‰é’®
    *   ç»¿è‰²èƒŒæ™¯çš„`secondary`æŒ‰é’®
*   è¿˜å¯ä»¥æœ‰ä¸åŒçš„çŠ¶æ€:å¦‚æœè¡¨å•æ­£åœ¨å‘é€ï¼ŒæŒ‰é’®å¯ä»¥æ˜¯`disabled`

åœ¨ React ä¸­ï¼Œå¤„ç†å®ƒçš„ä¸€ä¸ªéå¸¸ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæ¥å—ä¸åŒå‚æ•°çš„`Button`ç»„ä»¶:

*   ä¸€ä¸ªå«`disabled`çš„é“å…·ï¼Œä¸æ˜¯`true`å°±æ˜¯`false`
*   ä¸€ä¸ªå«`variant`çš„é“å…·ï¼Œä¸æ˜¯`primary`å°±æ˜¯`secondary`ã€‚

ä½†æ˜¯å‡è®¾ä½ æ­£åœ¨å†™è¿™ä¸ªä»£ç ï¼Œä½ æƒ³çœ‹çœ‹å®ƒæ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚é€šå¸¸çš„æ–¹æ³•æ˜¯è¿›å…¥ä½ çš„åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªé¡µé¢ï¼Œç„¶ååœ¨ä¸­é—´çš„æŸä¸ªåœ°æ–¹åŒ…å«è¿™ä¸ªæŒ‰é’®ï¼Œå‘å®ƒä¼ é€’é“å…·ï¼Œç„¶åçœ‹çœ‹å®ƒçœ‹èµ·æ¥åƒä»€ä¹ˆã€‚

### [](#comes-storybook)æ¥äº†æ•…äº‹ä¹¦

è¿™å°±æ˜¯ Storybook å‘æŒ¥ä½œç”¨çš„åœ°æ–¹:å®ƒåŸºæœ¬ä¸Šå…è®¸æ‚¨å¹¶è¡Œè¿è¡Œç¬¬äºŒä¸ªåº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æŒ‰é’®ç»„ä»¶ï¼Œè€Œä¸å¿…å°†å…¶åŒ…å«åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ã€‚ä½ å¯ä»¥**ç‹¬ç«‹å¼€å‘ä½ çš„ç»„ä»¶**ã€‚

ç°åœ¨ï¼Œå‡è®¾æ”¯æŒå›¢é˜Ÿä¸­çš„æŸä¸ªäººæ­£åœ¨ä¸ä¸€ä¸ªæ— æ³•ç™»å½•çš„å®¢æˆ·äº¤è°ˆã€‚ä»–ä»¬è¿‡æ¥é—®ä½ :â€œå˜¿ï¼Œä½ èƒ½ç»™æˆ‘çœ‹çœ‹è¿™ä¸ªé”™è¯¯å±å¹•å—ï¼Ÿâ€ã€‚

å¦‚æœæ²¡æœ‰ Storybookï¼Œç­”æ¡ˆåŒ…æ‹¬å¿…é¡»å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œå°è¯•é‡æ”¾ç”¨æˆ·æ‰€åšçš„äº‹æƒ…ï¼Œé˜…è¯»ä¸€äº›ä»£ç ä»¥ç†è§£å¦‚ä½•è®©å®ƒå‡ºç°ï¼Œç­‰ç­‰ã€‚

æœ‰äº† Storybookï¼Œä½ åªéœ€åœ¨æœç´¢æ ä¸­è¾“å…¥â€œé”™è¯¯å±å¹•â€ï¼Œä½ å°±èƒ½ç«‹å³çœ‹åˆ°å®ƒï¼

## [](#set-up-storybook-in-a-react-app)åœ¨ React åº”ç”¨ä¸­è®¾ç½®æ•…äº‹ä¹¦

æ­¤æ—¶ï¼Œæ‚¨å°†éœ€è¦ä¸€ä¸ª React åº”ç”¨ç¨‹åºã€‚å¦‚æœä½ æ²¡æœ‰ï¼Œå¯ä»¥éšæ„å…‹éš†è¿™ä¸ªï¼Œæˆ–è€…æŒ‰ç…§[è¿™ç¯‡æ–‡ç« ](https://dev.tothis%20article)ä¸­çš„æ­¥éª¤æ¥åˆ›å»ºä¸€ä¸ªã€‚æœ¬æ•™ç¨‹å°†å‡è®¾ä½ ä½¿ç”¨[åˆ›å»º-ååº”-åº”ç”¨](https://github.com/facebook/create-react-app)ã€‚

Storybook ä½¿è®¾ç½®ä¸€åˆ‡å˜å¾—éå¸¸å®¹æ˜“ã€‚åœ¨æ‚¨çš„ç»ˆç«¯ä¸­ï¼Œåªéœ€è¿è¡Œ:

```
npx -p @storybook/cli sb init 
```

è¿™å°†åŸºæœ¬ä¸Šæ£€æŸ¥æ‚¨çš„`package.json`ä»¥ç¡®å®šæ‚¨æ­£åœ¨ä½¿ç”¨çš„æ¡†æ¶ï¼Œç„¶åä¸ºæ‚¨çš„é¡¹ç›®ç”Ÿæˆæ­£ç¡®çš„é…ç½®ã€‚

è¯¥å‘½ä»¤åº”è¯¥å·²ç»æ›´æ–°äº†æ‚¨çš„`package.json`è„šæœ¬ï¼Œæ·»åŠ äº†:

```
"storybook":  "start-storybook -p 9009 -s public",  "build-storybook":  "build-storybook -s public" 
```

ç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬æ„Ÿå…´è¶£çš„ã€‚è¿è¡Œ:

```
npm run storybook 
```

è¿™åº”è¯¥ä¼šåœ¨æ‚¨çš„æµè§ˆå™¨ä¸­æ‰“å¼€ç±»ä¼¼è¿™æ ·çš„å†…å®¹(å¦‚æœæ²¡æœ‰ï¼Œåªéœ€å¯¼èˆªåˆ°`localhost:9009` ):
[![storybook-home.png](../Images/857f06b0a880b55b009200d5f2ca8a99.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--qMSZrTqF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1561039162383/EMeJv4krE.png)

è®©æˆ‘ä»¬çœ‹çœ‹è¿™é‡Œçš„ç•Œé¢:

*   å·¦è¾¹æ˜¯ä¾§è¾¹æ :è¿™æ˜¯ä½ æ‰¾åˆ°ç»„ä»¶çš„åœ°æ–¹ã€‚ç‚¹å‡»`Button`ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆï¼
*   åœ¨åº•éƒ¨ï¼Œä¸€äº›çœ‹èµ·æ¥åƒæ§åˆ¶å°çš„ä¸œè¥¿:è¿™å®é™…ä¸Šæ˜¯â€œæ’ä»¶â€éƒ¨åˆ†ã€‚Storybook æœ‰å¾ˆå¤šæ’ä»¶ï¼Œå¯ä»¥è®©ä½ åœ¨å¼€å‘ç»„ä»¶æ—¶å¢å¼ºä½“éªŒ:åŠ¨æ€æ”¹å˜é“å…·ï¼Œæ—¥å¿—è¾“å‡ºï¼Œåˆ‡æ¢è¯­è¨€ç­‰ã€‚

é‚£ä¹ˆè¿™äº›ç»„ä»¶æ¥è‡ªå“ªé‡Œå‘¢ï¼Ÿå½“æˆ‘ä»¬å®‰è£… Storybook æ—¶ï¼Œå®ƒä¼šç”Ÿæˆè¿™äº›â€œæ¼”ç¤ºâ€æ•…äº‹ã€‚ä»–ä»¬åœ¨`src/stories/index.js` :

```
import React from "react";

import { storiesOf } from "@storybook/react";
import { action } from "@storybook/addon-actions";
import { linkTo } from "@storybook/addon-links";
// Importing the demo components from storybook itself
import { Button, Welcome } from "@storybook/react/demo";

storiesOf("Welcome", module).add("to Storybook", () => (
  <Welcome showApp={linkTo("Button")} />
));

storiesOf("Button", module)
  .add("with text", () => (
    <Button onClick={action("clicked")}>Hello Button</Button>
  ))
  .add("with some emoji", () => (
    <Button onClick={action("clicked")}>
      <span role="img" aria-label="so cool">
        ğŸ˜€ ğŸ˜ ğŸ‘ ğŸ’¯
      </span>
    </Button>
  )); 
```

å°†å®ƒä»¬æ·»åŠ åˆ°æ•…äº‹ä¹¦çš„é­”åŠ›åœ¨`.storybook/config.js` :

```
import { configure } from '@storybook/react';

function loadStories() {
  require('../src/stories');
}

configure(loadStories, module); 
```

## [](#write-your-first-stories)å†™å‡ºä½ çš„ç¬¬ä¸€ä¸ªæ•…äº‹

### [](#configuring-storybook)é…ç½®æ•…äº‹ä¹¦

æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å»æ‰è¿™äº›æ¼”ç¤ºæ•…äº‹ï¼Œå¹¶æ”¹å˜æ•…äº‹åŠ å…¥æ•…äº‹ä¹¦çš„æ–¹å¼ã€‚å®Œå…¨åˆ é™¤`src/stories/`æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ƒã€‚

å°†`.storybook/config.js`ä¸­çš„æ‰€æœ‰å†…å®¹æ›¿æ¢ä¸º:

```
import { configure } from '@storybook/react';

const req = require.context('../src/', true, /\.stories\.js$/);

function loadStories() {
  req.keys().forEach(filename => req(filename));
}

configure(loadStories, module); 
```

è¿™å°†å‘Šè¯‰ Storybook é€‰æ‹©æ¯ä¸€ä¸ªä»¥`.stories.js`ç»“å°¾çš„æ–‡ä»¶ã€‚æ‚¨å°†ä¼šçœ‹åˆ°(ä¸€èˆ¬æ¥è¯´)è®©æ•…äº‹é è¿‘å®ƒä»¬æµ‹è¯•çš„ç»„ä»¶è¦å®¹æ˜“å¾—å¤šã€‚

### [](#a-simple-button-component)ä¸€ä¸ªç®€å•çš„æŒ‰é’®ç»„ä»¶

ç°åœ¨è®©æˆ‘ä»¬å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ•…äº‹ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æˆ‘çš„ github ç¤ºä¾‹ï¼Œè¯·è½¬åˆ°`src/components/atoms`å¹¶åˆ›å»ºä»¥ä¸‹æ–‡ä»¶:

```
|â€“â€“atoms
  |â€“â€“Button
    |â€“â€“index.js
    |â€“â€“Button.js
    |â€“â€“Button.stories.js 
```

`Button.js` :

```
import React from "react";

const Button = props => {
  const { variant, disabled, children } = props;

  // This is the default style
  let backgroundColor = "white";
  let color = "black";

  // Which variant do we want?
  switch (variant) {
    case "primary":
      backgroundColor = "red";
      color = "white";
      break;
    case "secondary":
      backgroundColor = "green";
      color = "white";
      break;
    default:
      break;
  }

  // Let's build the style based on the variant
  // We also add properties depending on the `disabled` state
  const style = {
    backgroundColor,
    color,
    cursor: disabled ? "not-allowed" : "pointer",
    opacity: disabled ? 0.5 : 1
  };

  return (
    <button disabled={disabled} style={style}>
      {children}
    </button>
  );
};

export default Button; 
```

`Button.stories.js` :

```
import React from "react";
import { storiesOf } from "@storybook/react";
import Button from "./Button";

// You can see this as "folders" in Storybook's sidebar
const stories = storiesOf("atoms/Button", module);

// Every story represents a state for our Button component
stories.add("default", () => <Button>Button</Button>);
stories.add("default disabled", () => <Button disabled>Button</Button>);
stories.add("primary", () => <Button variant="primary">Button</Button>);
// Passing a prop without a value is basically the same as passing `true`
stories.add("primary disabled", () => (
  <Button variant="primary" disabled>
    Button
  </Button>
));
stories.add("secondary", () => <Button variant="secondary">Button</Button>);
stories.add("secondary disabled", () => (
  <Button variant="secondary" disabled>
    Button
  </Button>
)); 
```

`index.js` :

```
// This allows us to import `src/components/Button` directly,
// without having to go all the way to `src/components/Button/Button`
export { default } from "./Button"; 
```

ç°åœ¨å†å»æ•…äº‹ä¹¦ï¼Œçœ‹çœ‹ä½ çš„æ•…äº‹åˆ›é€ äº†ä»€ä¹ˆ:
[![storybook-button.png](../Images/906fc09f608807c81f24d6a29d2b4641.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--YzAcUsQ---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1561039170087/YVsdE-HUs.png)

æµè§ˆæˆ‘ä»¬åˆ›å»ºçš„ä¸åŒæ•…äº‹ï¼Œæ³¨æ„æŒ‰é’®æ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚

### [](#everything-is-realtime)ä¸€åˆ‡éƒ½æ˜¯å®æ—¶çš„

Storybook æœ‰ä¸€ä¸ª*éå¸¸*å¿«é€Ÿçƒ­é‡è£…æœºåˆ¶ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥è½¬åˆ°ä½ çš„ç»„ä»¶ï¼Œå°†â€œçº¢è‰²â€æ”¹ä¸ºè“è‰²ï¼ŒStorybook ç«‹å³é‡æ–°ç¼–è¯‘ä½ çš„æ•…äº‹ï¼Œä»¥åŒ…å«ä½ çš„å˜åŒ–ï¼

## [](#addons)æ’ä»¶

Storybook æä¾›äº†[å„ç§éå¸¸æ–¹ä¾¿çš„æ’ä»¶](https://storybook.js.org/addons/)æ¥å¸®åŠ©æˆ‘ä»¬è‡ªä¿¡åœ°ç‹¬ç«‹å¼€å‘ç»„ä»¶ã€‚è®©æˆ‘ä»¬è®¾ç½®å…¶ä¸­çš„ä¸€äº›ã€‚

### [](#addoninfo)é™„åŠ ä¿¡æ¯

æœ‰æ—¶å€™å½“ä½ æµè§ˆæ•…äº‹ä¹¦çš„æ—¶å€™ï¼Œä½ æƒ³è¯»ä¸€ä¸ªç‰¹å®šæ•…äº‹çš„ä»£ç ã€‚è¿™æ­£æ˜¯`info`æ’ä»¶æ‰€åšçš„ã€‚è¦å®‰è£…å®ƒ:

```
npm i -D @storybook/addon-info 
```

é€šè¿‡ç¼–è¾‘`.storybook/config.js` :
å…¨å±€æ·»åŠ æ’ä»¶

```
...
import { addDecorator } from '@storybook/react';
import { withInfo } from '@storybook/addon-info';

addDecorator(withInfo);
... 
```

è¿™å°†åœ¨ä½ çš„æ•…äº‹å³ä¸Šè§’å¢åŠ ä¸€ä¸ª`show info`æŒ‰é’®ï¼Œæ˜¾ç¤ºå…³äºæ•…äº‹çš„ä¸€äº›ä¿¡æ¯:
[![addon-info.png](../Images/5fd2d78d763e8a7272afc8154326e0a9.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--4wmT96WT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1561039243071/-ifi4_la0.png)

### [](#addonactions)æ’ä»¶-åŠ¨ä½œ

å½“ä¸€ä¸ªåŠ¨ä½œåœ¨æˆ‘ä»¬çš„ç»„ä»¶ä¸­å‘ç”Ÿæ—¶ï¼Œè®°å½•å®ƒå¯èƒ½æ˜¯æœ‰ç”¨çš„ã€‚æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†æŒ‰é’®ç»„ä»¶ï¼Œä½¿å…¶æ¥å—ä¸€ä¸ª`onClick`å±æ€§:

```
...
const Button = props => {
  const { variant, disabled, children, onClick } = props;
  ...
return (
    <button onClick={onClick} disabled={disabled} style={style}>
      {children}
    </button>
  ); 
```

æˆ‘ä»¬å¦‚ä½•æµ‹è¯•ç‚¹å‡»æŒ‰é’®ä¼šè§¦å‘`onClick`å¤„ç†ç¨‹åºï¼ŸStorybook æä¾›äº†ä¸€ä¸ªå·²ç»å®‰è£…çš„å®˜æ–¹æ’ä»¶ï¼Œå¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨ä½ çš„æ•…äº‹ä¸­ï¼Œå¯¼å…¥`action`ï¼Œç„¶åæ·»åŠ `onClick`é“å…·:

```
import { action } from "@storybook/addon-actions";
...
stories.add("default", () => (
  <Button onClick={action("clicked!")}>Button</Button>
));
stories.add("default disabled", () => (
  <Button onClick={action("clicked!")} disabled>
    Button
  </Button>
));
stories.add("primary", () => (
  <Button onClick={action("clicked!")} variant="primary">
    Button
  </Button>
));
stories.add("primary disabled", () => (
  <Button onClick={action("clicked!")} variant="primary" disabled>
    Button
  </Button>
));
stories.add("secondary", () => (
  <Button onClick={action("clicked!")} variant="secondary">
    Button
  </Button>
));
stories.add("secondary disabled", () => (
  <Button onClick={action("clicked!")} variant="secondary" disabled>
    Button
  </Button>
)); 
```

ç°åœ¨ï¼Œæ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼ŒStorybook éƒ½ä¼šæ‰“å°ä¸€ä¸ªæ–°çš„æ—¥å¿—:
[![clicked.png](../Images/d2255d1ff1f64b69db4b05c5db48ba65.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Ecbj7Ai6--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1561039262725/WLV9ZKEN4.png)

### [](#addonknobs)é™„åŠ æŒ‰é’®

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºåŒä¸€ä¸ªç»„ä»¶ç¼–å†™è®¸å¤šä¸åŒçš„æ•…äº‹ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å¤„ç†æ¯ä¸ªé“å…·ç»„åˆã€‚å¦‚æœæˆ‘ä»¬èƒ½åœ¨æ•…äº‹ä¹¦é‡Œå®æ—¶ç¼–è¾‘é“å…·ä¼šæ€ä¹ˆæ ·ï¼Ÿè§£å†³æ–¹æ¡ˆæ˜¯[é™„åŠ æŒ‰é’®](https://github.com/storybookjs/storybook/tree/next/addons/knobs)ï¼Œå®ƒæå¤§åœ°ç®€åŒ–äº†æˆ‘ä»¬å†™æ•…äº‹çš„æ–¹å¼ã€‚

é¦–å…ˆï¼Œç”¨
å®‰è£…æ’ä»¶

```
npm i -D @storybook/addon-knobs 
```

ç„¶åï¼Œå°†å…¶æ·»åŠ åˆ°`.storybook/addons.js` :

```
import '@storybook/addon-actions/register';
import '@storybook/addon-links/register';
// add this line
import '@storybook/addon-knobs/register'; 
```

é‡å†™ä½ çš„æ•…äº‹æ¥ä½¿ç”¨æ–°çš„æ’ä»¶:

```
import React from "react";
import { storiesOf } from "@storybook/react";
import Button from "./Button";
import { action } from "@storybook/addon-actions";
// add this line
import { withKnobs, select, boolean } from "@storybook/addon-knobs";

// You can see this as "folders" in Storybook's sidebar
const stories = storiesOf("atoms/Button", module);

// add this line
stories.addDecorator(withKnobs);

// ---- add this block
const variantOptions = {
  none: "",
  primary: "primary",
  secondary: "secondary"
};
// ----

stories.add("with knobs", () => (
  <Button
    onClick={action("clicked!")}
    // ---- and this one
    // syntax is (name, options, default)
    variant={select("variant", variantOptions, "")}
    // syntax is (name, default)
    disabled={boolean("disabled", false)}
    // ----
  >
    Button
  </Button>
)); 
```

ç°åœ¨ï¼Œå½“ä½ è¿›å…¥ä½ çš„æ•…äº‹ï¼Œåœ¨æ’ä»¶éƒ¨åˆ†ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ–°çš„æ ‡ç­¾ï¼Œå«åšæ—‹é’®ï¼Œä½ å¯ä»¥é€šè¿‡ç©å®ƒä»¬æ¥æ”¹å˜ä½ çš„ç»„ä»¶çš„é“å…·:
[![knobs.png](../Images/d3f21d5ab4ec5e4c747bbb8d2bdde809.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--SHSepFHT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1561039273640/JeDLmitXG.png)

æ›´é…·çš„æ˜¯`addon-info`å’Œè¿™äº›é“å…·ä¿æŒåŒæ­¥ï¼
[![knobs-sync.png](../Images/b94f2eec874e52459d05bb87d5ccc94d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Xhbv4guT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1561039288563/OZ9Tqm4xD.png)

## [](#snapshot-testing)å¿«ç…§æµ‹è¯•

å› ä¸º React ç»„ä»¶æ˜¯å¯é‡ç”¨çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªç»„ä»¶åŒ…å«åœ¨è®¸å¤šå…¶ä»–ç»„ä»¶ä¸­æ˜¯å¾ˆå¸¸è§çš„ã€‚è·Ÿè¸ªç»„ä»¶æˆä¸ºä¾èµ–é¡¹çš„æ‰€æœ‰åœ°æ–¹å¹¶ä¼°è®¡ä¸€ä¸ªå°å˜åŒ–çš„å½±å“ä¼šå˜å¾—éå¸¸å›°éš¾ã€‚Storybook ä½¿å¾—è®¾ç½®**å¿«ç…§æµ‹è¯•**ï¼Œç»“åˆ [jest](https://jestjs.io/) å˜å¾—éå¸¸å®¹æ˜“(create-react-app å·²ç»è‡ªå¸¦)ã€‚

é¦–å…ˆï¼Œå®‰è£…æ‰€éœ€çš„ä¾èµ–é¡¹:

```
npm i -D @storybook/addon-storyshots react-test-renderer require-context.macro 
```

ç„¶åï¼Œåœ¨`.storybook/config.js` :

```
import requireContext from 'require-context.macro';

// const req = require.context('../src', true, /\.stories\.js$/); <-- replaced
const req = requireContext('../src', true, /\.stories\.js$/); 
```

åœ¨`src`ä¸­åˆ›å»ºä»¥ä¸‹ç»“æ„:

```
|â€“â€“test
  |â€“â€“storyshots.test.js 
```

å¹¶æŠŠè¿™ä¸ªåŠ åˆ°`storyshots.test.js`

```
import initStoryshots from '@storybook/addon-storyshots';

initStoryshots(); 
```

æœ€åï¼Œè¿è¡Œ`npm run test`(æˆ–`npm test`ç®€å†™)ã€‚è¿™å°†åœ¨`src/test/__snapshots__/storyshots.test.js.snap`åˆ›å»ºä¸€ä¸ªå¿«ç…§æ–‡ä»¶ã€‚

ç°åœ¨ï¼Œå½“æ‚¨è¿è¡Œæµ‹è¯•æ—¶ï¼ŒStorybook å°†å‘ˆç°æ¯ä¸ªæ•…äº‹ï¼Œå¹¶å°†å…¶ä¸ä¹‹å‰åˆ›å»ºçš„å¿«ç…§è¿›è¡Œæ¯”è¾ƒã€‚å°è¯•æ›´æ”¹æŒ‰é’®ç»„ä»¶ä¸­çš„æŸäº›å†…å®¹ï¼Œç„¶åå†æ¬¡è¿è¡Œæµ‹è¯•ï¼Œä¾‹å¦‚:

```
switch (variant) {
    case "primary":
      backgroundColor = "red";
      color = "white";
      break;
    case "secondary":
      // change this...
      //backgroundColor = "green";
      // ...into this
      backgroundColor = "gray";
      color = "white";
      break;
    default:
      break;
  } 
```

Jest ä¼šæŠ±æ€¨å¿«ç…§ä¸å¯¹ï¼Œç»™ä½ ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„æŠ¥å‘Š:
[![snapshot-failed.png](../Images/e4d272d0e00d9415e838c793b8d1c598.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--P46EdGXH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1561039306247/vMBUxMic4.png)

æ‚¨å¯ä»¥æ£€æŸ¥æ›´æ”¹ï¼Œå¹¶ç¡®å®šæ‚¨æ˜¯å¦ç ´åäº†æŸäº›ä¸œè¥¿ï¼Œæˆ–è€…æ¯ä¸ªæ›´æ”¹æ˜¯å¦éƒ½æ˜¯æœ‰æ„çš„ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨:
æ›´æ–°å¿«ç…§

```
npm run test -- -u 
```

åœ¨å¼€å‘ä¸€ä¸ªå¤§çš„ç‰¹æ€§ä¹‹åè¿è¡Œå¿«ç…§æµ‹è¯•å¯¹äºå›é¡¾æ‚¨æ‰€åšçš„å·¥ä½œå’Œæ‚¨çš„å˜æ›´çš„å½±å“æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚

*åœ¨ [GitHub](https://github.com/tducasse/setup-storybook) ä¸Šæ‰¾åˆ°æœ€ç»ˆä»£ç ã€‚*