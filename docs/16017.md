# GraphQL:ä½¿ç”¨å¸¦æœ‰ Rakkit çš„ TypeScript å’Œ decorators åˆ›å»º API

> åŸæ–‡ï¼š<https://dev.to/daven/graphql-create-your-api-using-typescript-and-decorators-with-rakkit-2koo>

# ä»€ä¹ˆï¼Ÿ

**å¥½å§ï¼Œè¿™ä¸æˆ‘ä¹‹å‰çš„[ç¯‡å…³äº T2 çš„æ–‡ç« æœ‰å…³ã€‚æ‰€ä»¥æˆ‘å»ºè®®ä½ å»å‘¨å›´çœ‹çœ‹ğŸ˜Šã€‚](https://dev.to/owen/rakkit-create-your-graphql-and-rest-apis-with-typescript-and-decorators-cnj)**

å› æ­¤ï¼Œåœ¨è¿™é‡Œæˆ‘å°†å‘æ‚¨å±•ç¤ºä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Rakkit åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ç”¨æˆ·ç®¡ç†ç³»ç»Ÿçš„ GraphQL APIã€‚

# ä½†é¦–å…ˆ:å®‰è£… RakkitğŸ’¾

å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£…ä¸€äº›ä¾èµ–é¡¹æ‰èƒ½ç»§ç»­:

> åœ¨è¿™é‡Œï¼Œæˆ‘ä¼šä½¿ç”¨`apollo-server`ï¼Œä½†æ˜¯å¦‚æœä½ ä½¿ç”¨ Rakkit for REST å’Œ GraphQL æ¥é“¾æ¥ä¸Šä¸‹æ–‡ï¼Œä¹Ÿå¯ä»¥å®‰è£…`apollo-server-koa`ã€‚

åªéœ€è¿è¡Œè¿™ä¸ªå‘½ä»¤æ¥å®‰è£…æ‰€éœ€çš„ä¾èµ–é¡¹:

```
npm i rakkit graphql @types/graphql apollo-server reflect-metadata 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> reflect-metadata å…è®¸æˆ‘ä»¬åœ¨ TypeScript ä¸­ä½¿ç”¨ decorators

å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦é…ç½® TypeScript æ¥å¯ç”¨è£…é¥°å™¨ï¼Œæ–¹æ³•æ˜¯åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª *tsconfig.json* æ–‡ä»¶ï¼ŒåŒ…å«è¿™ä¸ª:

```
{  "compileOptions":  {  "emitDecoratorMetadata":  true,  "experimentalDecorators":  true,  "module":  "commonjs",  "target":  "es2016",  "noImplicitAny":  false,  "sourceMap":  true,  "outDir":  "build",  "declaration":  true,  "importHelpers":  true,  "forceConsistentCasingInFileNames":  true,  "lib":  [  "es2016",  "esnext.asyncitable"  ],  "moduleResolution":  "node"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*ã€‚/tsconfig.json*

# ç±»å‹çš„å®šä¹‰ğŸš»

å¥½çš„ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬ä»åˆ›å»ºæˆ‘ä»¬çš„`User`ç±»å¼€å§‹ï¼Œæˆ‘ä»¬å¿…é¡»ç”¨`@ObjectType()` :
æ¥è£…é¥°å®ƒ

```
import { ObjectType, Field } from "rakkit";
import * as Crypto from "crypto";

@ObjectType()
export class User {
  @Field()
  username: string;

  @Field()
  email: string;

  @Field()
  id: string;

  // Just to show a computed property:
  @Field(type => String)
  get flatInfos(): string {
    return [this.name, this.email, this.id].join(":");
  }

  constructor(username: string, email: string) {
    this.username = username;
    this.email = email;
    this.id = Crypto.randomBytes(16).toString("hex");
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*ã€‚/types/User.ts*

# ä½ éœ€è¦ä¸€ä¸ªå°å°çš„â€œğŸ—‚æ•°æ®åº“â€

å› æ­¤ï¼Œä¸ºäº†æµ‹è¯•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ä¸ä¸€äº›ç”¨æˆ·ä¸€èµ·ç©ï¼Œæ‰€ä»¥æˆ‘å°†åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®ä¾‹åˆ—è¡¨ï¼Œä»¥ä½¿å…¶æ›´åŠ æ¸…æ™°:

> ä½ å¯ä»¥ä¸ºä½ çš„é¡¹ç›®
> ä½¿ç”¨ä¸€ä¸ªçœŸæ­£çš„æ•°æ®åº“å’Œä¸€ä¸ªç±»ä¼¼[ç±»å‹çš„ ORM](//typeorm.io)

```
import { User } from "../types/User";

export const users = [
  new User("JohnDoe", "john@doe.com"),
  new User("JaneDoe", "jane@doe.com"),
  new User("Ben", "ben@doe.com")
]; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*ã€‚/db/users.ts*

# è§£æå™¨(æŸ¥è¯¢ã€å˜å¼‚ã€è®¢é˜…)ğŸš€

æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ç±»ä¸­å®šä¹‰æˆ‘ä»¬çš„æŸ¥è¯¢/å˜å¼‚/è®¢é˜…ã€‚å®ƒå°†åŒ…å«ä¸€ä¸ªç®€å•çš„ CRUD å’Œä¸€ä¸ªç”¨æˆ·æ³¨å†Œæ—¶è¦é€šçŸ¥çš„è®¢é˜…:

```
import {
  Resolve,
  Query,
  Mutation,
  Subscription,
  IContext,
  Arg
} from "rakkit";
import { User } from "../types/User";
import { users } from "../db/users";

@Resolver()
export class UserResolver {
  @Query(returns => [User])
  getAllUsers() { {
    return users;
  }

  @Query({ nullable: true })
  getOneUserByName(@Arg("name") name: string): User {
    return users.find((user) => user.name ==== name);
  }

  @Mutation()
  addUser(
    // Defining the mutation arguments
    @Arg("name") name: string,
    @Arg("email") email: string,
    context: IContext
  ): User {
    const user = new User(name, email);
    users.push(user);
    // Publish the event for subscriptions with the created user
    context.gql.pubSub.publish("USER_ADDED", user);
    return user;
  }

  @Subscription({ topics: "USER_ADDED" })
  userAddedNotif(createdUser: User): User {
    // Send the created user to the client
    return createdUser;
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*ã€‚/resolvers/UserResolver.ts*

# åˆ‡å…¥ç‚¹ğŸšª

ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè®¾ç½®ä¸€ä¸ªå…¥å£ç‚¹:

```
// It allows us to use decorators:
import "reflect-metadata";

import { Rakkit } from "rakkit";
import { ApolloServer } from "apollo-server";

async function bootstrap() {
  await Rakkit.start({
    gql: {
      // You give an array of glob string:
      resolvers: [`${__dirname}/resolvers/*Resolver.ts`]
    }
  });
  // Retrieve the GraphQL compiled schema:
  const schema = Rakkit.MetadataStorage.Gql.Schema;

  const server = new ApolloServer({
    schema
  });

  server.listen();
}

bootstrap(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*ã€‚/bootstrap.ts*

# æå®šäº†ï¼Œé‚£å°±å¼€å§‹æµ‹è¯•å§ï¼ğŸ‰

è¦å¯åŠ¨å®ƒï¼Œä½ å¿…é¡»å…¨å±€å®‰è£…`ts-node`æ¥ç›´æ¥è¿è¡Œä½ çš„ TypeScript åº”ç”¨:

```
npm i -g ts-node 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åè¿è¡Œè¿™ä¸ª:

```
ts-node relative-path-to/bootstrap.ts 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åªéœ€ä½¿ç”¨æ‚¨æœ€å–œæ¬¢çš„æµè§ˆå™¨è¿›å…¥ [http://localhost:4000](http://localhost:4000) è¿›è¡Œä¸€äº› GraphQL æŸ¥è¯¢ï¼ğŸ”¥

**getAllUsers** -è·å–æ‰€æœ‰ç”¨æˆ·:
[![](img/e52e24f723c3f6b366a3a6674519bff4.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ANeW3g2r--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/0t475yrvb22no391rdet.png)

**getOneUserByName** -æ ¹æ®åç§°è·å–ç‰¹å®šç”¨æˆ·:
[![](img/6c0062482ef1183921b027165bd03ad9.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--z7UEowQK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/t9woq8td8n9g5dgv2w5w.png)

**addUser** -æ·»åŠ ç”¨æˆ·:
[![](img/87e65078e3d5f18dd0841fd8cddcd2e4.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--7zOrVkk0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ny8bbw3993ynrb7vcenc.png)

**userAddedNotif** -ç›‘å¬ç”¨æˆ·åˆ›å»ºäº‹ä»¶:
[![](img/cbf9e519dfc10d7d8903beb8c2b52b82.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--iSBYI2PQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8xt2lbt6zxg0a5ouo6eu.png)

# å°±è¿™æ ·ï¼[è¿™ä¸ªä¾‹å­å¯ä»¥åœ¨ GitHub](https://github.com/OwenCalvin/RakkitExamples/tree/graphql) ä¸Šæ‰¾åˆ°ğŸ˜Šï¼Œè°¢è°¢ï¼