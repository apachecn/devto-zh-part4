# Python çš„æŠ€å·§å’Œè¯€çªï¼Œä½ è¿˜æ²¡æœ‰çœ‹è¿‡

> åŸæ–‡:[https://dev . to/Martin Heinz/python-tips-and-trick-you-have-not-behind-seen-1p 41](https://dev.to/martinheinz/python-tips-and-trick-you-haven-t-already-seen-1p41)

*æ³¨:è¿™æœ€åˆå‘å¸ƒåœ¨[martinheinz . dev](https://martinheinz.dev/blog/1)T3ã€‘*

å…³äº Python ä¸­çš„è®¸å¤šå¾ˆé…·çš„ç‰¹æ€§ï¼Œæ¯”å¦‚å˜é‡è§£åŒ…ã€éƒ¨åˆ†å‡½æ•°ã€æšä¸¾å¯è¿­ä»£å¯¹è±¡ï¼Œå·²ç»æœ‰å¾ˆå¤šæ–‡ç« ï¼Œä½†æ˜¯å¯¹äº Python æ¥è¯´ï¼Œè¿˜æœ‰æ›´å¤šçš„ä¸œè¥¿è¦è®¨è®ºï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘å°†å°è¯•å±•ç¤ºä¸€äº›æˆ‘çŸ¥é“å¹¶ä½¿ç”¨çš„ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§æˆ‘è¿˜æ²¡æœ‰åœ¨å…¶ä»–åœ°æ–¹æåˆ°è¿‡ã€‚æ‰€ä»¥æˆ‘ä»¬å¼€å§‹å§ã€‚

## [](#sanitizing-string-input)å‡€åŒ–å­—ç¬¦ä¸²è¾“å…¥

å‡€åŒ–ç”¨æˆ·è¾“å…¥çš„é—®é¢˜å‡ ä¹å­˜åœ¨äºä½ ç¼–å†™çš„æ¯ä¸€ä¸ªç¨‹åºä¸­ã€‚é€šå¸¸å°†å­—ç¬¦è½¬æ¢æˆå°å†™æˆ–å¤§å†™å°±è¶³å¤Ÿäº†ï¼Œæœ‰æ—¶æ‚¨å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼Œä½†æ˜¯å¯¹äºå¤æ‚çš„æƒ…å†µï¼Œå¯èƒ½æœ‰æ›´å¥½çš„æ–¹æ³•:

```
user_input = "This\nstring has\tsome whitespaces...\r\n"

character_map = {
    ord('\n') : ' ',
    ord('\t') : ' ',
    ord('\r') : None
}
user_input.translate(character_map)  # This string has some whitespaces... 
```

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ç©ºç™½å­—ç¬¦â€œ\nâ€å’Œâ€œ\tâ€å·²è¢«æ›¿æ¢ä¸ºå•ä¸ªç©ºæ ¼ï¼Œå¹¶ä¸”â€œ\râ€å·²è¢«å®Œå…¨åˆ é™¤ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œä½¿ç”¨`unicodedata`åŒ…å’Œå®ƒçš„`combining()`å‡½æ•°ç”Ÿæˆå¤§çš„é‡æ˜ å°„è¡¨ï¼Œæ¥ç”Ÿæˆå’Œæ˜ å°„æˆ‘ä»¬å¯ä»¥ç”¨æ¥ä»å­—ç¬¦ä¸²ä¸­åˆ é™¤æ‰€æœ‰é‡éŸ³ç¬¦å·çš„è¡¨ã€‚

## [](#taking-slice-of-an-iterator)å–è¿­ä»£å™¨çš„åˆ‡ç‰‡

å¦‚æœä½ å°è¯•è·å–è¿­ä»£å™¨çš„ä¸€éƒ¨åˆ†ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ª`TypeError`ï¼Œå£°æ˜ç”Ÿæˆå™¨å¯¹è±¡æ˜¯ä¸å¯ä¸‹æ ‡çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆ:

```
import itertools

s = itertools.islice(range(50), 10, 20)  # <itertools.islice object at 0x7f70fab88138> for val in s:
    ... 
```

ä½¿ç”¨`itertools.islice`æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª`islice`å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œäº§ç”Ÿæƒ³è¦çš„é¡¹ç›®ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å°†æ¶ˆè€—æ‰€æœ‰ç”Ÿæˆå™¨é¡¹ç›®ï¼Œç›´åˆ°åˆ‡ç‰‡å¼€å§‹ï¼Œä»¥åŠæˆ‘ä»¬çš„`islice`å¯¹è±¡ä¸­çš„æ‰€æœ‰é¡¹ç›®ã€‚

## [](#skipping-begining-of-iterable)è·³è¿‡è¿­ä»£çš„å¼€å§‹

æœ‰æ—¶ä½ ä¸å¾—ä¸å¤„ç†é‚£äº›ä½ çŸ¥é“ä»¥å¯å˜æ•°é‡çš„ä¸éœ€è¦çš„è¡Œå¼€å§‹çš„æ–‡ä»¶ï¼Œæ¯”å¦‚æ³¨é‡Šã€‚`itertools`å†æ¬¡æä¾›äº†ç®€å•çš„è§£å†³æ–¹æ¡ˆ:

```
string_from_file = """
// Author: ...
// License: ...
//
// Date: ...

Actual content...
"""

import itertools

for line in itertools.dropwhile(lambda line: line.startswith("//"), string_from_file.split("\n")):
    print(line) 
```

è¯¥ä»£ç ç‰‡æ®µåªåœ¨åˆå§‹æ³¨é‡Šéƒ¨åˆ†åç”Ÿæˆå‡ è¡Œã€‚å¦‚æœæˆ‘ä»¬åªæƒ³ä¸¢å¼ƒ iterable å¼€å¤´çš„æ¡ç›®(æœ¬ä¾‹ä¸­æ˜¯è¡Œ),è€Œä¸çŸ¥é“æœ‰å¤šå°‘æ¡ç›®ï¼Œè¿™ç§æ–¹æ³•ä¼šå¾ˆæœ‰ç”¨ã€‚

## [](#functions-with-only-keyword-arguments-kwargs)åªæœ‰å…³é”®å­—å‚æ•°çš„å‡½æ•°(kwargs)

åˆ›å»ºåªæ¥å—å…³é”®å­—å‚æ•°çš„å‡½æ•°ä¼šæœ‰æ‰€å¸®åŠ©ï¼Œä»¥ä¾¿åœ¨ä½¿ç”¨è¿™æ ·çš„å‡½æ•°æ—¶æä¾›(å¼ºåˆ¶)æ›´å¤§çš„æ¸…æ™°åº¦:

```
def test(*, a, b):
    pass

test("value for a", "value for b")  # TypeError: test() takes 0 positional arguments... test(a="value", b="value 2")  # Works... 
```

å¦‚ä½ æ‰€è§ï¼Œè¿™å¯ä»¥é€šè¿‡åœ¨å…³é”®å­—å‚æ•°å‰æ”¾ç½®å•ä¸ª`*`å‚æ•°æ¥è½»æ¾è§£å†³ã€‚å¦‚æœæˆ‘ä»¬æŠŠä½ç½®å‚æ•°æ”¾åœ¨`*`å‚æ•°ä¹‹å‰ï¼Œæ˜¾ç„¶ä¼šæœ‰ä½ç½®å‚æ•°ã€‚

## [](#creating-object-that-supports-raw-with-endraw-statements)åˆ›å»ºæ”¯æŒ`with`è¯­å¥çš„å¯¹è±¡

æˆ‘ä»¬éƒ½çŸ¥é“å¦‚ä½•ä½¿ç”¨`with`è¯­å¥æ‰“å¼€æ–‡ä»¶æˆ–è€…è·å–é”ï¼Œä½†æ˜¯æˆ‘ä»¬çœŸçš„èƒ½å®ç°æˆ‘ä»¬è‡ªå·±çš„å—ï¼Ÿæ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`__enter__`å’Œ`__exit__`æ–¹æ³•:
å®ç°ä¸Šä¸‹æ–‡ç®¡ç†å™¨åè®®

```
class Connection:
    def __init__(self):
        ...

    def __enter__(self):
        # Initialize connection... 
    def __exit__(self, type, value, traceback):
        # Close connection... 
with Connection() as c:
    # __enter__() executes
    ...
    # conn.__exit__() executes 
```

è¿™æ˜¯åœ¨ Python ä¸­å®ç°ä¸Šä¸‹æ–‡ç®¡ç†çš„æœ€å¸¸è§çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿˜æœ‰æ›´ç®€å•çš„æ–¹æ³•:

```
from contextlib import contextmanager

@contextmanager
def tag(name):
    print(f"<{name}>")
    yield
    print(f"</{name}>")

with tag("h1"):
    print("This is Title.") 
```

ä¸Šé¢çš„ä»£ç ç‰‡æ®µä½¿ç”¨`contextmanager` manager decorator å®ç°äº†å†…å®¹ç®¡ç†åè®®ã€‚è¿›å…¥`with`ç¨‹åºå—æ—¶ï¼Œæ‰§è¡Œ`tag`åŠŸèƒ½çš„ç¬¬ä¸€éƒ¨åˆ†(åœ¨`yield`ä¹‹å‰)ï¼Œç„¶åæ‰§è¡Œè¯¥ç¨‹åºå—ï¼Œæœ€åæ‰§è¡Œå‰©ä½™çš„`tag`åŠŸèƒ½ã€‚

## [](#saving-memory-with-raw-slots-endraw-)ç”¨`__slots__`ä¿å­˜è®°å¿†

å¦‚æœä½ æ›¾ç»å†™è¿‡ä¸€ä¸ªç¨‹åºï¼Œå®ƒåˆ›å»ºäº†æŸä¸ªç±»çš„å¤§é‡å®ä¾‹ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ä½ çš„ç¨‹åºçªç„¶éœ€è¦å¤§é‡çš„å†…å­˜ã€‚è¿™æ˜¯å› ä¸º Python ä½¿ç”¨å­—å…¸æ¥è¡¨ç¤ºç±»çš„å®ä¾‹çš„å±æ€§ï¼Œè¿™ä½¿å¾—å®ƒå¾ˆå¿«ï¼Œä½†ä¸æ˜¯éå¸¸æœ‰æ•ˆçš„å†…å­˜ï¼Œè¿™é€šå¸¸ä¸æ˜¯é—®é¢˜ã€‚ç„¶è€Œï¼Œå¦‚æœè¿™å¯¹ä½ çš„ç¨‹åºæ¥è¯´æ˜¯ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨`__slots__` :

```
class Person:
    __slots__ = ["first_name", "last_name", "phone"]
    def __init__(self, first_name, last_name, phone):
        self.first_name = first_name
        self.last_name = last_name
        self.phone = phone 
```

è¿™é‡Œå‘ç”Ÿçš„äº‹æƒ…æ˜¯ï¼Œå½“æˆ‘ä»¬å®šä¹‰`__slots__`å±æ€§æ—¶ï¼ŒPython ä½¿ç”¨å°çš„å›ºå®šå¤§å°çš„å±æ€§æ•°ç»„è€Œä¸æ˜¯å­—å…¸ï¼Œè¿™å¤§å¤§å‡å°‘äº†æ¯ä¸ªå®ä¾‹æ‰€éœ€çš„å†…å­˜ã€‚ä½¿ç”¨`__slots__`ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹â€”â€”æˆ‘ä»¬ä¸èƒ½å£°æ˜ä»»ä½•æ–°çš„å±æ€§ï¼Œå¹¶ä¸”æˆ‘ä»¬è¢«é™åˆ¶åœ¨`__slots__`ä¸Šä½¿ç”¨ã€‚è¿˜æœ‰å¸¦`__slots__`çš„ç±»ä¸èƒ½ä½¿ç”¨å¤šé‡ç»§æ‰¿ã€‚

## [](#limiting-cpu-and-memory-usage)é™åˆ¶ CPU å’Œå†…å­˜çš„ä½¿ç”¨

å¦‚æœä¸æ˜¯ä¼˜åŒ–ä½ çš„ç¨‹åºå†…å­˜æˆ– CPU çš„ä½¿ç”¨ï¼Œä½ åªæ˜¯æƒ³ç›´æ¥æŠŠå®ƒé™åˆ¶åœ¨æŸä¸ªç¡¬æ•°å­—ï¼Œé‚£ä¹ˆ Python ä¹Ÿæœ‰ä¸€ä¸ªè¿™æ ·çš„åº“:

```
import signal
import resource
import os

# To Limit CPU time def time_exceeded(signo, frame):
    print("CPU exceeded...")
    raise SystemExit(1)

def set_max_runtime(seconds):
    # Install the signal handler and set a resource limit
    soft, hard = resource.getrlimit(resource.RLIMIT_CPU)
    resource.setrlimit(resource.RLIMIT_CPU, (seconds, hard))
    signal.signal(signal.SIGXCPU, time_exceeded)

# To limit memory usage def set_max_memory(size):
    soft, hard = resource.getrlimit(resource.RLIMIT_AS)
    resource.setrlimit(resource.RLIMIT_AS, (size, hard)) 
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è®¾ç½®æœ€å¤§ CPU è¿è¡Œæ—¶é—´å’Œæœ€å¤§å†…å­˜ä½¿ç”¨é™åˆ¶çš„ä¸¤ä¸ªé€‰é¡¹ã€‚å¯¹äº CPU é™åˆ¶ï¼Œæˆ‘ä»¬é¦–å…ˆè·å¾—ç‰¹å®šèµ„æº(`RLIMIT_CPU`)è½¯é™åˆ¶å’Œç¡¬é™åˆ¶ï¼Œç„¶åä½¿ç”¨å‚æ•°æŒ‡å®šçš„ç§’æ•°å’Œå…ˆå‰æ£€ç´¢çš„ç¡¬é™åˆ¶æ¥è®¾ç½®å®ƒã€‚æœ€åï¼Œå¦‚æœ CPU æ—¶é—´è¶…æ—¶ï¼Œæˆ‘ä»¬æ³¨å†Œå¯¼è‡´ç³»ç»Ÿé€€å‡ºçš„ä¿¡å·ã€‚è‡³äºå†…å­˜ï¼Œæˆ‘ä»¬å†æ¬¡æ£€ç´¢è½¯é™åˆ¶å’Œç¡¬é™åˆ¶ï¼Œå¹¶ä½¿ç”¨å¸¦æœ‰å¤§å°å‚æ•°å’Œæ£€ç´¢åˆ°çš„ç¡¬é™åˆ¶çš„`setrlimit`æ¥è®¾ç½®å®ƒã€‚

## [](#controlling-what-can-be-imported-and-what-not)æ§åˆ¶ä»€ä¹ˆå¯ä»¥å¯¼å…¥ï¼Œä»€ä¹ˆä¸å¯ä»¥å¯¼å…¥

æœ‰äº›è¯­è¨€æœ‰éå¸¸æ˜æ˜¾çš„å¯¼å‡ºæˆå‘˜(å˜é‡ã€æ–¹æ³•ã€æ¥å£)çš„æœºåˆ¶ï¼Œæ¯”å¦‚ Golangï¼Œåªå¯¼å‡ºä»¥å¤§å†™å­—æ¯å¼€å¤´çš„æˆå‘˜ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨ Python ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯å¯¼å‡ºçš„ï¼Œé™¤éæˆ‘ä»¬ä½¿ç”¨`__all__` :

```
def foo():
    pass

def bar():
    pass

__all__ = ["bar"] 
```

ä½¿ç”¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶ä½¿ç”¨`from some_module import *`æ—¶å¯ä»¥å¯¼å…¥çš„å†…å®¹ã€‚å¯¹äºè¿™ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œ*é€šé…ç¬¦å¯¼å…¥*è€Œåªæœ‰å¯¼å…¥`bar`ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å°†`__all__`ç•™ç©ºï¼Œå½“ä½¿ç”¨*é€šé…ç¬¦å¯¼å…¥*ä»è¯¥æ¨¡å—å¯¼å…¥æ—¶ï¼Œä¸ä¼šå¯¼å‡ºä»»ä½•å†…å®¹ï¼Œå¯¼è‡´`AttributeError`ã€‚

## [](#comparison-operators-the-easy-way)æ¯”è¾ƒè¿ç®—ç¬¦çš„ç®€ä¾¿æ–¹æ³•

è€ƒè™‘åˆ°æœ‰ç›¸å½“å¤šçš„æ¯”è¾ƒæ“ä½œç¬¦- `__lt__ , __le__ , __gt__ ,`æˆ–`__ge__`ï¼Œä¸ºä¸€ä¸ªç±»å®ç°æ‰€æœ‰çš„æ¯”è¾ƒæ“ä½œç¬¦å¯èƒ½ä¼šå¾ˆçƒ¦äººã€‚ä½†æ˜¯å¦‚æœæœ‰æ›´ç®€å•çš„æ–¹æ³•å‘¢ï¼Ÿ`functools.total_ordering`æ¥æ•‘æ´:

```
from functools import total_ordering

@total_ordering
class Number:
    def __init__(self, value):
        self.value = value

    def __lt__(self, other):
        return self.value < other.value

    def __eq__(self, other):
        return self.value == other.value

print(Number(20) > Number(3))
print(Number(1) < Number(5))
print(Number(15) >= Number(15))
print(Number(10) <= Number(2)) 
```

è¿™å®é™…ä¸Šæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿdecorator ç”¨äºç®€åŒ–æˆ‘ä»¬çš„ç±»å®ç°å®ä¾‹æ’åºçš„è¿‡ç¨‹ã€‚åªéœ€è¦å®šä¹‰`__lt__`å’Œ`__eq__`ï¼Œè¿™æ˜¯æ˜ å°„å‰©ä½™æ“ä½œçš„æœ€ä½è¦æ±‚ï¼Œè¿™æ˜¯è£…é¥°è€…çš„å·¥ä½œâ€”â€”å®ƒä¸ºæˆ‘ä»¬å¡«è¡¥äº†ç©ºç™½ã€‚

## [](#conclusion)ç»“è®º

åœ¨æ—¥å¸¸ Python ç¼–ç¨‹ä¸­ï¼Œå¹¶éæ‰€æœ‰è¿™äº›ç‰¹æ€§éƒ½æ˜¯å¿…ä¸å¯å°‘çš„å’Œæœ‰ç”¨çš„ï¼Œä½†å…¶ä¸­ä¸€äº›æœ‰æ—¶å¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºï¼Œå®ƒä»¬è¿˜å¯èƒ½ä¼šç®€åŒ–ä»»åŠ¡ï¼Œå¦åˆ™å®ç°èµ·æ¥ä¼šéå¸¸å†—é•¿å’Œçƒ¦äººã€‚æˆ‘è¿˜æƒ³æŒ‡å‡ºçš„æ˜¯ï¼Œæ‰€æœ‰è¿™äº›ç‰¹æ€§éƒ½æ˜¯ Python æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œè€Œå…¶ä¸­ä¸€äº›åœ¨æˆ‘çœ‹æ¥å°±åƒæ˜¯æ ‡å‡†åº“ä¸­éå¸¸éæ ‡å‡†çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æ¯å½“ä½ å†³å®šç”¨ Python å®ç°æŸä¸ªä¸œè¥¿æ—¶ï¼Œé¦–å…ˆè¦åœ¨æ ‡å‡†åº“ä¸­å¯»æ‰¾å®ƒï¼Œå¦‚æœä½ æ‰¾ä¸åˆ°å®ƒï¼Œé‚£ä¹ˆä½ å¯èƒ½æ‰¾å¾—ä¸å¤Ÿä»”ç»†(å¦‚æœå®ƒçœŸçš„ä¸åœ¨é‚£é‡Œï¼Œé‚£ä¹ˆå®ƒè‚¯å®šåœ¨æŸä¸ªç¬¬ä¸‰æ–¹åº“ä¸­)ã€‚ğŸ™‚