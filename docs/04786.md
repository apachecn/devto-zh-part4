# æ„å»º React & Firebase åšå®¢ç«™ç‚¹:ç¬¬ 3 éƒ¨åˆ†

> åŸæ–‡:[https://dev . to/ashleemboyer/build-a-react-firebase-blog-site-part-3-4c5e](https://dev.to/ashleemboyer/build-a-react-firebase-blog-site-part-3-4c5e)

*è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨äº[æˆ‘çš„ä¸ªäººåšå®¢ç½‘ç«™](https://ashleemboyer.com/react-firebase-blog-03)ã€‚*

æˆ‘ä»¬å·²ç»åˆ°äº† React & Firebase ç³»åˆ—çš„ç¬¬ä¸‰éƒ¨åˆ†ã€‚åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•è®¾ç½®ä¸€åˆ‡ã€‚[ä¸Šæ¬¡](https://ashleemboyer.com/react-firebase-blog-02)ï¼Œæˆ‘ä»¬åšäº†ä¸€ä¸ªåˆ›å»ºæ–°åšæ–‡çš„é¡µé¢ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ä» Firebase å®æ—¶æ•°æ®åº“ä¸­è¯»å–å•ä¸ªå¸–å­ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æ˜¾ç¤ºå®ƒä»¬ã€‚

å¦‚æœä½ è¿˜æ²¡æœ‰é˜…è¯»å‰ä¸¤ç¯‡æ–‡ç« ï¼Œæˆ‘æœ‰ä¸€äº›ä½ å¯ä»¥ç”¨çš„å…¥é—¨ä»£ç ã€‚åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨éµå¾ªç¬¬ä¸€éƒ¨åˆ†çš„ç¬¬ 1ã€2 å’Œ 5 æ­¥ã€‚

## [](#table-of-contents)ç›®å½•

1.  å…‹éš†(ç¬¬ 3 éƒ¨åˆ†)å¯åŠ¨ä»£ç [å¯é€‰]
2.  æ£€æŸ¥`Post`ç»„ä»¶
3.  å°†`Post`ç»„ä»¶è¿æ¥åˆ° Firebase

* * *

## [](#1-clone-the-part-3-starter-code-optional)1ã€‚å…‹éš†(ç¬¬ 3 éƒ¨åˆ†)å¯åŠ¨ä»£ç [å¯é€‰]

å¦‚æœæ‚¨å·²ç»æˆåŠŸå®Œæˆäº†ç¬¬ 2 éƒ¨åˆ†ï¼Œè¯·è·³è¿‡è¿™ä¸€æ­¥ã€‚å¦åˆ™ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å…‹éš†ä»£ç :

```
git clone https://github.com/ashleemboyer/react-firebase-blog-starter-part-3.git 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ç»§ç»­ä¹‹å‰ï¼Œæ‚¨éœ€è¦æ›´æ”¹ä¸€ä¸ªæ–‡ä»¶:`src/firebase.js`ã€‚å¦‚æœä½ æ‰“å¼€å®ƒï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„`config`å¸¸é‡:

```
const config = {
  apiKey: "<YOUR-API-KEY>",
  authDomain: "<YOUR-AUTH-DOMAIN>",
  databaseURL: "<YOUR-DATABASE-URL>",
  projectId: "<YOUR-PROJECT-ID>",
  storageBucket: "<YOUR-STORAGE-BUCKET>",
  messagingSenderId: "<YOUR-MESSAGE-SENDER-ID>",
  appId: "<YOUR-APP-ID>"
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¸¸é‡ä¸­çš„å±æ€§ç”¨äºå°†æ‚¨çš„åº”ç”¨ç¨‹åºè¿æ¥åˆ° Firebase é¡¹ç›®ã€‚è¦æ‰¾åˆ°è¿™äº›å€¼ï¼Œé€šè¿‡ [Firebase æ§åˆ¶å°](https://console.firebase.google.com)å·¦ä¾§æ ä¸­çš„é½¿è½®å›¾æ ‡è¿›å…¥ä½ çš„é¡¹ç›®è®¾ç½®ã€‚å‘ä¸‹æ»šåŠ¨åˆ°â€œä½ çš„åº”ç”¨â€ä¸‹çš„â€œFirebase SDK ç‰‡æ®µâ€,ä»ä»–ä»¬è°ƒç”¨çš„`firebaseConfig`ä¸­å¤åˆ¶å±æ€§ã€‚ç”¨è¿™äº›å€¼æ›¿æ¢æ‚¨çš„`config`å¸¸é‡ä¸­çš„å±æ€§ã€‚

ç°åœ¨ä½ å¯ä»¥è¿è¡Œ`npm install`ç„¶å`npm run start`åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ä½ çš„é¡¹ç›®ã€‚

## [](#2-inspect-the-raw-post-endraw-component)2ã€‚æ£€æŸ¥`Post`ç»„ä»¶

ä½ å¯ä»¥åœ¨`src/pages/post.js`æ–‡ä»¶ä¸­æ‰¾åˆ°è¿™ä¸ªç»„ä»¶ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒç°åœ¨åœ¨åšä»€ä¹ˆã€‚

é¦–å…ˆï¼Œå®ƒä½¿ç”¨æˆ‘ä»¬åœ¨`src/App.js`ä¸­è®¾ç½®çš„`Router`ä» URL ä¸­è·å– slugã€‚ä¼ é€’ç»™`Route`çš„ç»„ä»¶åœ¨`Router`å†…æœ‰ä¸€ä¸ª`match`é“å…·å‘é€ç»™å®ƒä»¬ã€‚è¿™ä¸ªé“å…·è¿˜æœ‰å…¶ä»–æ–¹å¼å‘é€ç»™ç»„ä»¶ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºé‚£ä¸ª[çš„å†…å®¹ã€‚](https://reacttraining.com/react-router/web/api/match)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª`postSlugs`å¸¸é‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªçœŸå®åšå®¢æ–‡ç« ä¸­å­˜åœ¨çš„ slugs æ•°ç»„ã€‚å¦‚æœä½ æŸ¥çœ‹æ•°æ®åº“ï¼Œè¿™äº›ä¸æˆ‘ä»¬ç»™ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªåšå®¢å¸–å­çš„å­å¼¹ç›¸åŒ¹é…ã€‚é—®é¢˜æ˜¯è¿™ä¸ªä»£ç ä¸æ˜¯åŠ¨æ€çš„ï¼Œä¹Ÿæ²¡æœ‰è¿æ¥åˆ°æ•°æ®åº“ã€‚æˆ‘ä»¬ä¸€ä¼šå„¿ä¼šå›æ¥è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ£€æŸ¥åœ°å€æ ä¸­çš„`slug`æ˜¯å¦æ˜¯`postSlugs`ä¸­çš„ä¸€ä¸ªã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆç”¨æˆ·è¯•å›¾çœ‹åˆ°çš„å¸–å­å®é™…ä¸Šå¹¶ä¸å­˜åœ¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ª`Redirect`è¿”å›ç»™æˆ‘ä»¬çš„`404`ç»„ä»¶ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äº`Redirect`ã€‚

æœ€åï¼Œæˆ‘ä»¬æœ‰æˆ‘ä»¬çš„è¿”å›å£°æ˜ã€‚ç°åœ¨ï¼Œå®ƒä¸ºæ¯ä¸ªæœ‰æ•ˆçš„å¸–å­`slug`è¿”å›ç›¸åŒçš„ä¸œè¥¿ã€‚ç›¸åï¼Œæˆ‘ä»¬å¸Œæœ›å±•ç¤ºæˆ‘ä»¬å­˜å‚¨åœ¨ Firebase ä¸­çš„çœŸå®çš„åšæ–‡å†…å®¹ã€‚

## [](#3-connect-the-raw-post-endraw-component-to-firebase)3ã€‚å°†`Post`ç»„ä»¶è¿æ¥åˆ° Firebase

é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ·»åŠ  import å‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°è¯•ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ã€‚å½“æˆ‘ä»¬è¿™ä¹ˆåšçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥å¯¼å…¥`useState`æ¥å¸®åŠ©ç®¡ç†ä¸€äº›äº‹æƒ…ã€‚

```
import React, { useState } from "react";

import { getFirebase } from "../firebase"; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹æˆ‘ä»¬æƒ³è¦ç”¨`useState`æ¥ç®¡ç†ä»€ä¹ˆã€‚é¦–å…ˆæƒ³åˆ°çš„æ˜¯ä¸€ä¸ª`loading`çŠ¶æ€ã€‚è¿™å°†æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå®ƒæè¿°äº†æˆ‘ä»¬æ˜¯å¦è¯•å›¾ä»æ•°æ®åº“ä¸­åŠ è½½ä¸€äº›ä¸œè¥¿ã€‚æˆ‘ä»¬è¿˜å¸Œæœ›æˆ‘ä»¬çš„`currentPost`æœ‰ä¸€ä¸ªå˜é‡ï¼Œæˆ‘ä»¬è¯•å›¾ä»æ•°æ®åº“ä¸­è¯»å–ã€‚ç”¨ä¸‹é¢ä¸¤è¡Œä»£ç æ›¿æ¢`postSlugs`è¡Œ:

```
const [loading, setLoading] = useState(true);
const [currentPost, setCurrentPost] = useState(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¸Œæœ›åœ¨åŠ è½½çŠ¶æ€ä¸‹å¼€å§‹ï¼Œè¿™æ ·é¡µé¢å¯ä»¥æ˜¾ç¤ºä¸€äº›ä¸åŒçš„å†…å®¹ï¼Œå‘ç”¨æˆ·è¡¨æ˜é¡µé¢æ­£åœ¨åŠ è½½ã€‚ä½ å¯ä»¥å±•ç¤ºä¸€ä¸ªåŠ¨ç”»ï¼ŒGIFï¼Œçº¯æ–‡æœ¬ï¼Œéšä¾¿ä½ ã€‚æˆ‘ä»¬æš‚æ—¶ä¿æŒç®€å•ï¼Œåªè¿”å›ä¸€äº›æ–‡æœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
if (loading) {
  return <h1>Loading...</h1>; } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶è€Œï¼Œæˆ‘ä»¬çš„æ•°æ®åº“è°ƒç”¨éœ€è¦æ”¾åœ¨è¿™ä¸ª`if`è¯­å¥ä¹‹å‰ã€‚å¦‚æœæˆ‘ä»¬æŠŠå®ƒæ”¾åœ¨ afterï¼Œå®ƒå°†æ°¸è¿œä¸ä¼šåˆ°è¾¾ï¼Œå› ä¸º`if`è¯­å¥ä½¿ä»£ç æå‰è¿”å›ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬åœ¨è°ƒç”¨`useState`ä¹‹åå’Œåˆšåˆšå†™çš„`if`è¯­å¥ä¹‹å‰è¦æ·»åŠ çš„å†…å®¹:

```
if (loading && !currentPost) {
  getFirebase()
    .database()
    .ref()
    .child(`/posts/${slug}`)
    .once("value")
    .then(snapshot => {
      if (snapshot.val()) {
        setCurrentPost(snapshot.val());
      }
      setLoading(false);
    });
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬å¯¹ä¸€ä¸ªå¸–å­æ˜¯å¦å­˜åœ¨çš„æ£€æŸ¥ã€‚å°†`postDoesNotExist`æ›´æ–°ä¸º:

```
const postDoesNotExist = !currentPost; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™äº›æƒ…å†µä¸€å¼€å§‹å¯èƒ½ä¼šæœ‰ç‚¹æ··ä¹±ã€‚æˆ‘ä»¬åœ¨æ£€æŸ¥ä»€ä¹ˆï¼Ÿåœ¨è¿™é‡Œåˆ—å‡ºæ‰§è¡Œçš„æ­¥éª¤å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ï¼Œæ‚¨å¯ä»¥é€šè¿‡å‘æ–‡ä»¶ä¸­æ·»åŠ ä¸€äº›æ§åˆ¶å°æ—¥å¿—æ¥è¯•éªŒä¸€ä¸‹ã€‚

1.  åœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶:`loading`ä¸ºçœŸï¼Œ`setCurrentPost`æœªå®šä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿›å…¥`if`è¯­å¥å†…éƒ¨ã€‚ä¸€æ—¦æˆ‘ä»¬å°†å®ƒæ”¾å…¥`then`ï¼Œå¦‚æœ`snapshot.val()`è¿”å›ä¸€ä¸ªå¯¹è±¡(å¦‚æœç»™å®šçš„`slug`ä¸å­˜åœ¨ postï¼Œå®ƒå°†ä¸ºç©º)ï¼Œæˆ‘ä»¬è°ƒç”¨`setCurrentPost`ï¼Œä½¿`currentPost`ä¸å†æœªå®šä¹‰ã€‚
2.  åœ¨`setCurrentPost`è°ƒç”¨ä¹‹å:è¿›è¡Œè¿™ä¸ªè°ƒç”¨å°†é‡æ–°å‘ˆç°ç»„ä»¶ã€‚æˆ‘ä»¬å†æ¬¡åˆ°è¾¾æˆ‘ä»¬çš„`if (loading && !currentPost)`è¯­å¥ã€‚å› ä¸ºç°åœ¨å·²ç»å®šä¹‰äº†`currentPost`,æ‰€ä»¥æˆ‘ä»¬ä¸å†è¿›å…¥ä»£ç å—ï¼Œä»è€Œé¿å…å¯¹æ•°æ®åº“è¿›è¡Œä¸å¿…è¦çš„è°ƒç”¨ã€‚æˆ‘ä»¬åˆ°è¾¾`if (loading)`è¯­å¥ã€‚`loading`ä»ç„¶ä¸ºçœŸï¼Œæ‰€ä»¥ç»„ä»¶è¿”å›ä¸€äº›æ–‡æœ¬ï¼Œä¸åšä»»ä½•å…¶ä»–äº‹æƒ…ã€‚
3.  åœ¨`setLoading`è°ƒç”¨ä¹‹å:è¿›è¡Œè¿™ä¸ªè°ƒç”¨å°†é‡æ–°å‘ˆç°ç»„ä»¶ã€‚`loading`ç°åœ¨æ˜¯å‡çš„ï¼Œ`currentPost`å¯èƒ½æ˜¯æœªå®šä¹‰çš„æˆ–æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚è¿™å°±æ˜¯`if (postDoesNotExist)`æ”¯ç¥¨çš„ç”¨æ­¦ä¹‹åœ°ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰ä»æ•°æ®åº“ä¸­å¾—åˆ°ä¸€ä¸ªå¸–å­ï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ª`Redirect`ï¼Œå°±åƒä¹‹å‰ä¸€æ ·ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬ç»§ç»­è¿›è¡Œæœ€åçš„`return`ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬æ˜¾ç¤ºå¸–å­ã€‚

æˆ‘å¸Œæœ›è¿™äº›æ­¥éª¤ä¸ä¼šè®©ä½ ä¸çŸ¥æ‰€æªï¼Œå®ƒä»¬ä¼šå¸®åŠ©ä½ çœ‹åˆ°é’©å­å’ŒçŠ¶æ€ç®¡ç†çš„åŠ›é‡ï¼å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒä»¬æ˜¯ React æœ€é…·çš„ä¸œè¥¿ã€‚

ä»¥ä¸‹æ˜¯æˆ‘å±•ç¤ºå¸–å­çš„æ–¹å¼:

```
return (
  <>
    <img src={currentPost.coverImage} alt={currentPost.coverImageAlt} />
    <h1>{currentPost.title}</h1>
    <em>{currentPost.datePretty}</em>
    <p dangerouslySetInnerHTML={{ __html: currentPost.content }}></p>
  </> ); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘è¿˜åœ¨`src/index.js`ä¸­çš„`<p>`å…ƒç´ é¡¶éƒ¨æ·»åŠ äº†ä¸€ä¸ª`12px`è¾¹è·ã€‚

ç°åœ¨ï¼Œå½“ä½ ç‚¹å‡»â€œç»§ç»­é˜…è¯»â€¦â€é“¾æ¥æˆ–æ‰‹åŠ¨å¯¼èˆªåˆ°æ‚¨çš„ä¸€ä¸ªå¸–å­ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:

[![Screenshot of a single blog post's page.](../Images/7d7da779eebf91755a2299c903ac3fa0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jTRokSje--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://firebasestorage.googleapis.com/v0/b/ashleemboyer-2018.appspot.com/o/images%252Freact-firebase-blog%252Fpart-03%252Fpost.png%3Falt%3Dmedia%26token%3D4a9abd6a-9549-467f-a473-ff86ae47357a)

* * *

ä½ çŸ¥é“æˆ‘æœ‰æ—¶äº‹é€šè®¯å—ï¼ŸğŸ“¬

å¦‚æœä½ æƒ³åœ¨æˆ‘å‘å¸ƒæ–°çš„åšå®¢å¸–å­æˆ–å®£å¸ƒé‡å¤§é¡¹ç›®æ—¶å¾—åˆ°é€šçŸ¥ï¼Œè¯·è”ç³» https://ashleemboyer.com/newsletterã€‚

* * *

å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–ç–‘è™‘ï¼Œè¯·[ç»™æˆ‘å‘ç”µå­é‚®ä»¶](//mailto:hello@ashleemboyer.com)æˆ–[å‘æ¨ç‰¹æ¶ˆæ¯](https://twitter.com/ashleemboyer)ã€‚æˆ‘å–œæ¬¢æ”¶åˆ°ä½ çš„æ¥ä¿¡ï¼ğŸ˜Š