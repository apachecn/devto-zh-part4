# Jest ä»æµ‹è¯•è¦†ç›–ä¸­æ’é™¤æ–‡ä»¶/å‡½æ•°/è¯­å¥

> åŸæ–‡ï¼š<https://dev.to/hugo__df/jest-exclude-file-function-statement-from-test-coverage-b1b>

> åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œæµ‹è¯•è¦†ç›–ç‡æ˜¯ä¸€ç§åº¦é‡ï¼Œç”¨äºæè¿°åœ¨ç‰¹å®šæµ‹è¯•å¥—ä»¶è¿è¡Œæ—¶ç¨‹åºæºä»£ç çš„æ‰§è¡Œç¨‹åº¦ã€‚
> 
> [ä»£ç è¦†ç›–ç‡-ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Code_coverage)

ä»£ç è¦†ç›–ç‡é€šå¸¸è¢«ç”¨ä½œè½¯ä»¶çš„è´¨é‡åº¦é‡ï¼Œä¾‹å¦‚â€œæˆ‘ä»¬çš„ä»£ç å¿…é¡»æœ‰ 80%ä»¥ä¸Šçš„æµ‹è¯•è¦†ç›–ç‡â€ã€‚ç”¨ Jest æ”¶é›†æµ‹è¯•è¦†ç›–ç‡å°±åƒåœ¨è°ƒç”¨æ—¶ä½¿ç”¨`--coverage`æ ‡å¿—ä¸€æ ·ç®€å•ã€‚

è¿™ç¯‡æ–‡ç« è®²è¿°äº†å¦‚ä½•ä½¿ç”¨é…ç½®æˆ–ä¼Šæ–¯å¦å¸ƒå°”æ‚æ³¨å¿½ç•¥ Jest ä¸­çš„æ–‡ä»¶ã€å‡½æ•°å’Œè¯­å¥ã€‚ä»¥åŠä½ ä¸ºä»€ä¹ˆ/å¦‚ä½•åšè¿™æ ·çš„äº‹æƒ…çš„åŸå› å’Œé™åˆ¶ã€‚

ä½ å¯ä»¥åœ¨ github.com/HugoDF/jest-ignore-coverage æ‰¾åˆ°ä¸€ä¸ªå·¥ä½œèŒƒä¾‹åº“ã€‚

## Jest è¿è¦†ç›–ç‡æ€ä¹ˆç®—ï¼Ÿ

Jest ä½¿ç”¨[ä¼Šæ–¯å¦å¸ƒå°”](https://github.com/istanbuljs/istanbuljs)æ¥è®¡ç®—è¦†ç›–ç‡ã€‚Jest é€šå¸¸ä»æœ€ç»ˆç”¨æˆ·é‚£é‡ŒæŠ½è±¡å‡ºè¿™ä¸€ç‚¹ï¼Œæ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­æ‰€è¦åšçš„å°±æ˜¯è°ƒç”¨`jest --coverage`(å¹¶é…ç½®é€‚å½“çš„è¦†ç›–é…ç½®å­—æ®µ)ã€‚ä¼Šæ–¯å¦å¸ƒå°”åœ¨å†…éƒ¨ä½¿ç”¨çš„äº‹å®è¡¨æ˜ï¼Œä¾‹å¦‚ï¼ŒæŠ¥é“è®°è€…çš„[æ–‡æ¡£æåˆ°â€œä»»ä½•](https://jestjs.io/docs/en/configuration.html#coveragereporters-array-string)[ä¼Šæ–¯å¦å¸ƒå°”è®°è€…](https://github.com/istanbuljs/istanbuljs/tree/master/packages/istanbul-reports/lib)éƒ½å¯ä»¥ä½¿ç”¨ã€‚â€ï¼Œå®ƒæ˜¾ç¤ºäº†å®é™…æ”¶é›†è¦†ç›–æ•°æ®å’Œç”ŸæˆæŠ¥å‘Šçš„å†…å®¹ã€‚

## ä¸ºä»€ä¹ˆæˆ‘è¦å°†æ–‡ä»¶æ’é™¤åœ¨è¦†ç›–èŒƒå›´ä¹‹å¤–ï¼Ÿ

æ­£å¦‚ä¼Šæ–¯å¦å¸ƒå°”æŠ¥é“å›¾ä¹¦é¦†çš„ç»´æŠ¤è€…å’Œä½œè€…æ‰€è¯´:

> JS ä»£ç ä¸­çš„ä¸€äº›åˆ†æ”¯é€šå¸¸å¾ˆéš¾æµ‹è¯•ï¼Œå¦‚æœä¸æ˜¯ä¸å¯èƒ½çš„è¯ã€‚ä¾‹å¦‚ hasOwnProperty æ£€æŸ¥ã€UMD åŒ…è£…å™¨ç­‰ç­‰ã€‚ä¼Šæ–¯å¦å¸ƒå°”ç°åœ¨æœ‰ä¸€ä¸ªè®¾æ–½ï¼Œé€šè¿‡å®ƒå¯ä»¥æ’é™¤æŸäº›ä»£ç æ®µçš„è¦†ç›–ã€‚
> 
> [ä¼Šæ–¯å¦å¸ƒå°”-å‡ºäºè¦†ç›–ç›®çš„å¿½ç•¥ä»£ç ](https://github.com/gotwarlost/istanbul/blob/master/ignoring-code-for-coverage.md#ignoring-code-for-coverage-purposes)

æ­¤å¤–ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ100%çš„è¦†ç›–ç‡æ˜¯ä¸å¿…è¦çš„ï¼Œç”šè‡³æ˜¯ä¸åˆç†çš„ã€‚æœ‰äº›æ–‡ä»¶ä¸åŒ…å«ä»»ä½•(ä¸šåŠ¡)é€»è¾‘ã€‚æˆ–è€…å®ƒä»¬åŒ…å«ä»¥éå¸¸æ˜æ˜¾çš„æ–¹å¼å¤±è´¥çš„é€»è¾‘(ä¾‹å¦‚ï¼Œå¯åŠ¨å™¨åœ¨å¯åŠ¨æ—¶å´©æºƒ)ã€‚

ä¾‹å¦‚ï¼Œå¼•å¯¼åº”ç”¨ç¨‹åºçš„è„šæœ¬å¯èƒ½ä¼šç»‘å®šåˆ°ä¸€ä¸ªç«¯å£ï¼Œè¿™ä½¿å¾—æµ‹è¯•å˜å¾—ä¸æ–¹ä¾¿ã€‚å¯¼å…¥æ‰€æœ‰ä¸åŒä¾èµ–é¡¹å¹¶åœ¨ Express è®¾ç½®ä¸­`app.use()` -es å®ƒä»¬çš„æ–‡ä»¶å¯èƒ½æ˜¯é¿å…å•å…ƒæµ‹è¯•/ä¾èµ–æ¨¡ä»¿åœ°ç‹±çš„å¦ä¸€ä¸ªå€™é€‰æ–‡ä»¶ã€‚

å‡ºäºè¦†ç›–ç‡çš„ç›®çš„ï¼Œæ‚¨å¯èƒ½æƒ³è¦å¿½ç•¥çš„å¦ä¸€ç±»æ–‡ä»¶/å‡½æ•°æ˜¯ç‰¹å®šäºæµ‹è¯•çš„åŠ©æ‰‹ã€‚å®ƒä»¬ä¸­çš„ä¸€äº›ä¸ä½œä¸ºæµ‹è¯•çš„ä¸€éƒ¨åˆ†è¿è¡Œä¹Ÿæ²¡å…³ç³»ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯è¢«æµ‹è¯•çš„ä»£ç ã€‚

æ­£å¦‚è½¯ä»¶ä¸­çš„è®¸å¤šäº‹æƒ…ä¸€æ ·ï¼Œè¿™æ˜¯å…³äºæƒè¡¡çš„ã€‚

## é€šè¿‡ä¸ä½¿ç”¨é…ç½®è¿è¡Œç›¸å…³æµ‹è¯•ï¼Œå°†æ–‡ä»¶ä» Jest è¦†ç›–èŒƒå›´ä¸­æ’é™¤

æœ‰ä¸€ä¸ª Jest é…ç½®é€‰é¡¹`testPathIgnorePatterns` ( [å‚è§ testPathIgnorePatterns](https://jestjs.io/docs/en/configuration.html#testpathignorepatterns-array-string) çš„æ–‡æ¡£)

æœ€ç®€å•çš„é…ç½®æ–¹æ³•æ˜¯é€šè¿‡`package.json` :

```
{  "jest":  {  "testPathIgnorePatterns"  :  [  "<rootDir>/ignore/this/path/"  ]  }  } 
```

åœ¨[ä½¿ç”¨ GitHub](https://github.com/HugoDF/jest-ignore-coverage#exclude-files-from-jest-coverage-using-configuration) ä¸Šçš„é…ç½®ä» Jest è¦†ç›–ä¸­æ’é™¤æ–‡ä»¶ã€‚

## é€šè¿‡ä¸å°†æ–‡ä»¶åŒ…æ‹¬åœ¨è¦†ç›–èŒƒå›´é›†åˆé…ç½®ä¸­ï¼Œä»è¦†ç›–èŒƒå›´ä¸­æ’é™¤æ–‡ä»¶

ä½œä¸ºä¸è¿è¡Œæµ‹è¯•(å‚è§â€œé€šè¿‡ä¸ä½¿ç”¨é…ç½®è¿è¡Œç›¸å…³æµ‹è¯•ä» Jest è¦†ç›–ä¸­æ’é™¤æ–‡ä»¶â€)çš„æ›¿ä»£æˆ–è¡¥å……ï¼Œé€šè¿‡ä¸å°†å…¶åŒ…æ‹¬åœ¨è¦†ç›–æŠ¥å‘Šä¸­ï¼Œè¿™ç”±`collectCoverageFrom` Jest é…ç½®é€‰é¡¹æ§åˆ¶([å‚è§æ¥è‡ª](https://jestjs.io/docs/en/configuration.html#collectcoveragefrom-array)çš„ Jest collectCoverageFrom çš„æ–‡æ¡£)ã€‚

ä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„å†…å®¹:

```
{  "jest":  {  "collectCoverageFrom":  [  "src/**/{!(ignore-me),}.js"  ]  }  } 
```

**é‡è¦çš„**:ä¸€å®šè¦ç”¨`()`æŠŠè¢«å¿½ç•¥çš„æ–‡ä»¶åæ‹¬èµ·æ¥ã€‚

åœ¨[ä½¿ç”¨ GitHub](https://github.com/HugoDF/jest-ignore-coverage#exclude-files-from-jest-coverage-using-configuration) ä¸Šçš„é…ç½®ä» Jest è¦†ç›–ä¸­æ’é™¤æ–‡ä»¶ã€‚

## ä»æ–‡ä»¶çº§ Jest è¦†ç›–ä¸­æ’é™¤æ–‡ä»¶

æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•æ–‡ä»¶çš„é¡¶éƒ¨ä½¿ç”¨ä¸‹é¢çš„æ³¨é‡Šæ¥ä½¿ç”¨ä¼Šæ–¯å¦å¸ƒå°”æ‚æ³¨æ¥å¿½ç•¥æ–‡ä»¶:

```
/* istanbul ignore file */ 
```

åœ¨ GitHub ä¸Šçš„æ–‡ä»¶çº§ä» Jest æŠ¥é“ä¸­æ’é™¤æ–‡ä»¶

## ä» Jest è¦†ç›–ä¸­æ’é™¤åŠŸèƒ½

```
/* istanbul ignore next */
function myFunc() {
  console.log(
    "Not covered but won't appear on coverage reports as such"
  );
} 
```

ä» GitHub ä¸Šçš„ Jest æŠ¥é“ä¸­æ’é™¤å‡½æ•°æˆ–è¯­å¥ã€‚

## ä» Jest æŠ¥é“ä¸­æ’é™¤é™ˆè¿°

å¦‚æœå¯ä»¥çš„è¯ï¼Œé¿å…è¿™ç§æƒ…å†µï¼Œå¦‚æœä½ æ­£åœ¨æµ‹è¯•ä¸€äº›ä»£ç ï¼Œä½ å¯èƒ½åº”è¯¥æµ‹è¯•æ‰€æœ‰ä»£ç çš„***ã€‚*** 

```
function myFunc(a) {
  /* istanbul ignore else */
  if (a) {
    // do some work
  } else {
    // do some other work
  }
} 
```

ä» GitHub ä¸Šçš„ Jest æŠ¥é“ä¸­æ’é™¤å‡½æ•°æˆ–è¯­å¥ã€‚

## è¿›ä¸€æ­¥é˜…è¯»

å‚è§[å…³äºå¿½ç•¥ä»£ç è¦†ç›–ç‡çš„åŸå§‹ä¼Šæ–¯å¦å¸ƒå°”æ–‡æ¡£](https://github.com/gotwarlost/istanbul/blob/master/ignoring-code-for-coverage.md)ä»¥æ›´å¹¿æ³›åœ°äº†è§£å¦‚ä½•åœ¨ä¸åŒæƒ…å†µä¸‹åšåˆ°è¿™ä¸€ç‚¹ã€‚

æˆ‘è¿˜æ•´ç†äº†ä¸€ä»½æ¡ˆä¾‹æŠ¥å‘Šï¼ŒåŒ…æ‹¬æ‰€æœ‰ä¸åŒçš„æ¡ˆä¾‹[github.com/HugoDF/jest-ignore-coverage](https://github.com/HugoDF/jest-ignore-coverage)ã€‚

æŸ¥å°”æ–¯ğŸ‡µğŸ‡­*