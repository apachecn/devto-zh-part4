# ä½ è®©æˆ‘æ—‹è½¬å§ï¼ŒrâŸ³und

> åŸæ–‡:[https://dev.to/rowan_m/you-spin-me-right-r-und-k32](https://dev.to/rowan_m/you-spin-me-right-r-und-k32)

è¿™æ˜¯æˆ‘å¦‚ä½•å»ºé€  [ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ğŸ¥‘ *Rotavo PWA*](https://bit.ly/rotavo-pwa) *ã€‚è¯•ä¸€è¯•ï¼Œçœ‹çœ‹ä½ èƒ½ç”»å‡ºä»€ä¹ˆï¼*

æ²¡æœ‰ä¸€ä¸ªé…·å­©å­å†å¯¹ skeuomorphism æ„Ÿå…´è¶£äº†ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€åœ¨è½¯ä»¶ä¸–ç•Œé‡Œæ²¡æœ‰ç‰©ç†æ§åˆ¶çš„æ¨¡æ‹Ÿã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•é‡æ–°åˆ›é€ (å¸Œæœ›)è°ƒæ•´ç«‹ä½“å£°éŸ³é‡çš„ç›´è§‚ä½“éªŒğŸ“»é€šè¿‡æ„å»ºæˆ‘ä»¬è‡ªå·±çš„æ—‹è½¬ã€è§¦æ‘¸æ„Ÿåº”æ—‹é’®ç½‘ç»œç»„ä»¶ã€‚

## [](#contents)ç›®å½•

*   [ğŸ›ï¸æ»‘å—ã€ç£å¸¦å’Œåˆ»åº¦ç›˜](#sliders-tapes-and-dials)
*   [âš›ï¸ä¸€ä¸ªåŸºæœ¬çš„å®šåˆ¶å…ƒç´ ](#a-basic-custom-element)
*   [ğŸ‘»è¿›å…¥é˜´å½± DOM](#enter-the-shadow-dom)
*   [ğŸš§æµè§ˆå™¨æ”¯æŒ](#browser-support)
*   [ğŸ¤æ‰‹æŸ„è§¦æ‘¸](#handle-touch)
*   [ğŸ‘†æŒ‡é’ˆäº‹ä»¶å’Œé»˜è®¤è¡Œä¸º](#pointer-events-and-default-behaviour)
*   [ğŸ“è§¦æ‘¸ä¸‰è§’å­¦](#touching-trigonometry)
*   [ğŸ”„æ„Ÿäººçš„æ¼”ç¤º](#a-touching-demo)
*   [ğŸš§å“¦ç­‰ç­‰â€¦æµè§ˆå™¨æ”¯æŒ](#oh-wait-browser-support)
*   [ğŸ–Œï¸ç»˜ç”»å’Œè¡¨æ¼”](#painting-and-performance)
*   [ğŸ†å¥–åŠ±å†…å®¹](#bonus-content)

## [](#sliders-tapes-and-dials)ğŸ›ï¸æ»‘å—ã€ç£å¸¦å’Œè¡¨ç›˜

æˆ‘ä»¬å°†ä½¿ç”¨`input type="range"`ä½œä¸ºæˆ‘ä»¬å¸Œæœ›ç»„ä»¶å‘ˆç°çš„ API çš„åŸºç¡€ã€‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µå°†åˆ›å»ºä¸€ä¸ªå°æ»‘å—ï¼Œä» 0 åˆ° 100ï¼Œèµ·å§‹å€¼ä¸º 42ã€‚

```
<input type="range" name="volume" min="0" max="100" value="42" /> 
```

[![The default slider view in Chrome](../Images/9efdf138db66337dd809c7ef17ef48fd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Gkl_9csz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9pngvopkw7hjeliptpdt.png)

åšå®çš„åŸºç¡€ï¼Œä½†è¿™æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿå¦‚æœä½ å’Œæˆ‘ä¸€æ ·ï¼Œå–œæ¬¢é˜…è¯»ä½œä¸º HCI International 2009 çš„ä¸€éƒ¨åˆ†ä¸¾è¡Œçš„[2009 äººæœºç•Œé¢ç ”è®¨ä¼šçš„ä¼šè®®è®°å½•ï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒéƒ¨åˆ†ç¬¬ 773 é¡µå·¦å³ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªæœ‰ä»·å€¼çš„ä¿¡æ¯:](https://books.google.co.uk/books?id=I47_sQnnf_IC&pg=PA773&lpg=PA773&dq=)

> é£è¡Œå‘˜å‘ç°é˜…è¯»ç£å¸¦æ˜¾ç¤ºæ¯”æ¨¡æ‹Ÿåˆ»åº¦ç›˜æ›´éš¾

æˆ‘ä»¬å°†éœ€è¦ä¸€ç‚¹è¯•ç‚¹è¡Œè¯ï¼Œä½¿ UX çŸ¥è¯†çš„æ„ä¹‰ï¼Œæ˜¯åœ¨è¿™é‡Œä¸‹é™ã€‚

[![Diagram showing a linear "tape" display compared to a round "dial".](../Images/4affd2ad0825b0a747bd0faba4f8608d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Ala0Wdyj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/58coq9g7vyip5cgt328h.png)

â€œç£å¸¦â€æ˜¾ç¤ºå™¨ä»¥çº¿æ€§æ–¹å¼æ˜¾ç¤ºä¿¡æ¯ï¼Œä¹‹æ‰€ä»¥è¿™æ ·å‘½åï¼Œæ˜¯å› ä¸ºå®ƒå®é™…ä¸Šæ˜¯ä¸€æ¡åœ¨ç»ç’ƒåé¢ä¸Šä¸‹ç¼ ç»•çš„ç£å¸¦ã€‚è¿™å¯ä»¥ç”¨æ¥æ˜¾ç¤ºé«˜åº¦æˆ–ç©ºæ°”é€Ÿåº¦ã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯åˆ»åº¦ç›˜æŒ‡ç¤ºå™¨ï¼Œä»¥åœ†å½¢å¸ƒå±€æ˜¾ç¤ºç›¸åŒçš„çº¿æ€§ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºæ±½è½¦ä»ªè¡¨æ¿ä¸Šæ˜¾ç¤ºé€Ÿåº¦å’Œç‡ƒæ²¹æ²¹ä½ã€‚è¿™é‡Œçš„å‡è®¾æ˜¯ï¼Œä¸å·å°ºç›¸æ¯”ï¼Œäººå¯ä»¥æ›´å¿«åœ°è§£è¯»åˆ»åº¦ç›˜ä¸Šçš„ç²—ç•¥å€¼ï¼Œå› ä¸ºæ•´ä¸ªé‡ç¨‹éƒ½æ˜¯å¯è§çš„ã€‚

è€å®è¯´ï¼Œè¿™ä¸æ„å»ºæˆ‘ä»¬çš„ç»„ä»¶æ²¡æœ‰å¤ªå¤§å…³ç³»ï¼Œä½†æ˜¯æˆ‘å¸Œæœ›æ‚¨çš„ç¬¬ä¸€å°è±¡æ˜¯æˆ‘åœ¨å·¥ä½œä¸­é‡‡ç”¨äº†åŸºäºè¯æ®çš„æ–¹æ³•ã€‚å¦å¤–ï¼Œæˆ‘æƒ³å¾—è¶Šå¤šï¼Œæˆ‘ä¸ç¡®å®šåœ¨è¡¨ç›˜ä¸Šä¸€æ¬¡çœ‹åˆ°æ•´ä¸ªåˆ»åº¦çš„å¥½å¤„æ˜¯å¦çœŸçš„é€‚ç”¨äºæˆ‘ä»¬å¯ä»¥æ—‹è½¬å¤šæ¬¡çš„æ—‹é’®â€¦äº‹å®æ˜¯ï¼Œæˆ‘åšè¿™ä¸ªæ˜¯ä¸ºäº†å¥½ç©ï¼Œå¾ˆé«˜å…´æ„å¤–åœ°ä»ä¸­è·å¾—äº†ä¸€äº›æœ‰ä»·å€¼çš„ä¸œè¥¿ã€‚æˆ‘ä»¬å°†æš‚æ—¶æç½®å·¥ç¨‹ä¸è‰ºæœ¯çš„äº‰è®ºï¼Œç»§ç»­åˆ›ä½œè¿™ä¸ªéƒ¨åˆ†ã€‚

## [](#a-basic-custom-element)âš›ï¸ä¸€ç§åŸºæœ¬çš„é£ä¿—å…ƒç´ 

æˆ‘å°†å¿«é€Ÿæµè§ˆä¸€ä¸‹åŸºç¡€çŸ¥è¯†ï¼Œæ‰€ä»¥å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªåˆé€‚çš„ä»‹ç»ï¼Œä½ åº”è¯¥å‰å¾€â€œ[å®šåˆ¶å…ƒç´  v1:å¯é‡ç”¨ Web ç»„ä»¶](https://developers.google.com/web/fundamentals/web-components/customelements)â€ã€‚

æˆ‘ä»¬ä»ç®€å•çš„å¼€å§‹:ä¸€ä¸ªåªæœ‰ä¸€ä¸ª`value`å±æ€§çš„å…ƒç´ ã€‚å®šåˆ¶å…ƒç´ çš„åç§°ä¸­éœ€è¦ä¸€ä¸ªâ€œ`-`â€æ¥åŒºåˆ«äºå†…ç½®å…ƒç´ ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä½¿ç”¨`<input-knob>`æ¥æä¾›è¿”å›åˆ°`<input type="range">`çš„é“¾æ¥:

```
<input-knob value="1"></input-knob> 
```

ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬ä¹Ÿå°† HTML å…ƒç´ çš„å±æ€§æ˜ å°„åˆ° JavaScript ç±»ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿™æ ·åš:

```
const knob = document.querySelector('input-knob');
knob.value = 2; 
```

è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ‰©å±•`HTMLElement`ç±»ï¼Œè¿æ¥å±æ€§ï¼Œç„¶åå°†å®ƒè¿æ¥åˆ°æˆ‘ä»¬çš„é¡µé¢:

```
class InputKnob extends HTMLElement {
  constructor() {
    // Nothing to do in here at the moment, but we do need to call the parent
    // constructor
    super();
  }

  // Watch for changes on the 'value' attribute
  static get observedAttributes() {
    return ['value'];
  }

  // Map the JavaScript property to the HTML attribute
  get value() {
    return this.hasAttribute('value') ? this.getAttribute('value') : 0;
  }

  set value(value) {
    this.setAttribute('value', value);
  }

  // Respond to any changes to the observed attributes
  attributeChangedCallback(attrName, oldVal, newVal) {
    // nothing yet
  }
}

// Map the class to an element name and make it available to the page!
window.customElements.define('input-knob', InputKnob); 
```

ç°åœ¨ï¼Œå¦‚æœä½ åœ¨æµè§ˆå™¨ä¸­åŠ è½½ï¼Œä½ ä¼šçœ‹åˆ°â€¦ä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚é¡µé¢ä¸Šæ²¡æœ‰ï¼Œæ§åˆ¶å°ä¸Šä¹Ÿæ²¡æœ‰ã€‚æ²¡æœ‰æ˜¾ç¤ºä»»ä½•å†…å®¹ï¼Œä½†ä¹Ÿæ²¡æœ‰ä»»ä½•å†…å®¹è¢«æ˜¾å¼ç ´åã€‚æˆ‘ä»¬å·²ç»æˆåŠŸåœ°åœ¨é¡µé¢ä¸­é™„åŠ äº†ä¸€ä¸ªæ–°å…ƒç´ ï¼Œä½†æ˜¯æˆ‘ä»¬åˆ›å»ºçš„åªæ˜¯ä¸€ä¸ªç©ºå…ƒç´ ã€‚å› æ­¤ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ä¸å‘é¡µé¢æ·»åŠ ä¸€ä¸ªç©ºçš„`<span>`æ˜¯ä¸€æ ·çš„ã€‚ä¸è¿‡æ–¹ä¾¿çš„æ˜¯ï¼Œæˆ‘ä»¬çš„æ–°`<input-knob>`å…ƒç´ å¯ä»¥åƒé¡µé¢ä¸Šçš„å…¶ä»–ä»»ä½•ä¸œè¥¿ä¸€æ ·è¿›è¡Œæ ·å¼åŒ–â€”â€”è®©äº‹æƒ…å˜å¾—æ›´æ˜æ˜¾ä¸€äº›ã€‚

```
input-knob {
  display: block;
  background: #cadbbc;
  border: 1rem dashed #356211;
  box-shadow: 0.3rem 0.3rem 0.3rem rgba(0, 0, 0, 0.5);
  width: 8rem;
  height: 8rem;
} 
```

[![A light-green square with a dark-green dashed border on a light-yellow background](../Images/2cce752d0602c642fba09fa3f3850297.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--CvaKYZU3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/oflojqapbalhth5i2v7d.png)

å¥½äº†ï¼Œåœ¨æ˜¾çœ¼çš„å¹¿åœºï¼

## [](#enter-the-shadow-dom)ğŸ‘»è¿›å…¥å½±å­ç‹å›½

å¯¹äºå…ƒç´ æ˜¾ç¤ºï¼Œæˆ‘ä»¬åº”è¯¥å¯¹`value`å±æ€§åšäº›ä»€ä¹ˆã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›æ ¹æ®å±æ€§å€¼æ—‹è½¬å…ƒç´ ã€‚å®ƒçš„æ ¸å¿ƒå°†æ˜¯æˆ‘ä»¬åœ¨`transform`ä¸­ä½¿ç”¨çš„ [CSS å˜é‡](https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties)ï¼Œå°±åƒè¿™æ ·:

```
{
  --angle: 0rad;
  transform: rotate(var(--angle));
} 
```

ç„¶è€Œï¼Œæˆ‘ä»¬ä¸æƒ³ç›´æ¥åœ¨`<input-knob>`å…ƒç´ ä¸Šè®¾ç½®è¿™ä¸ªæ ·å¼ï¼Œå› ä¸ºå®ƒå‘ç»„ä»¶çš„ç”¨æˆ·å…¬å¼€äº†å®ç°ç»†èŠ‚ã€‚å¦‚æœä¸€ä¸ªå¼€å‘è€…æƒ³åœ¨ä»–ä»¬çš„é¡µé¢ä¸Šæ·»åŠ `<input-knob>`å¹¶åº”ç”¨æ—‹è½¬ï¼Œè¿™å°†ä¼šå‘ç”Ÿå†²çªã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨[å½±å­ DOM](https://developers.google.com/web/fundamentals/web-components/shadowdom) æ¥åˆ›å»ºä¸€äº›æ ‡è®°ï¼Œè¿™äº›æ ‡è®°æœ¬è´¨ä¸Šæ˜¯æˆ‘ä»¬ç»„ä»¶çš„ç§æœ‰æ ‡è®°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„ç»“æ„å’Œæ ·å¼æ¥æ”¯æŒç»„ä»¶çš„è¡Œä¸ºã€‚

æˆ‘ä»¬å°†ä»è¿™ä¸ª HTML å¼€å§‹:

```
<style>
  #container {
    --angle: 0rad;
    transform: rotate(var(--angle));
  }
</style>
<div id="container" part="container">
  <slot></slot>
</div> 
```

è®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆ:

*   `--angle` CSS å˜é‡å°†è¢«æ›´æ–°ä»¥æ§åˆ¶å…ƒç´ çš„æ—‹è½¬
*   `<div>`ä¸­çš„`id="container"`å®šä¹‰äº†æˆ‘ä»¬å°†è¦æ—‹è½¬çš„åŒ…è£…å…ƒç´ 
*   `<div>`ä¸­çš„`part="container"`æŒ‡ç¤ºæˆ‘ä»¬æƒ³è¦ä½¿å…ƒç´ å¯ç”¨äºå¤–éƒ¨æ ·å¼
*   å…ƒç´ å®šä¹‰äº†æ ‡ç­¾`</input-knob>`ä¸­çš„`<input-knob>`å†…å®¹åº”è¯¥å‘ˆç°åœ¨å“ªé‡Œ

æˆ‘ä»¬æƒ³è¦é€šè¿‡`part="container"`æš´éœ²`<div>`è¿›è¡Œæ ·å¼åŒ–çš„åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬çš„`<input-knob>`å…ƒç´ ä¸ä¼šæ—‹è½¬ã€‚æ‰€ä»¥ï¼Œå®ƒä»ç„¶å¯ä»¥è¢«æ ·å¼åŒ–â€”â€”ä½†æ˜¯å½“å€¼æ”¹å˜æ—¶ï¼Œå®ƒå°†ä¿æŒä¸å˜ã€‚ç›¸åï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ ·å¼è¡¨ä¸­ä½¿ç”¨ [`::part()`é€‰æ‹©å™¨](https://meowni.ca/posts/part-theme-explainer/)ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„åŠ æ³•ã€‚

```
input-knob::part(container) {
  display: block;
  background: #cadbbc;
  border: 1rem dashed #356211;
  box-shadow: 0.3rem 0.3rem 0.3rem rgba(0, 0, 0, 0.5);
  width: 8rem;
  height: 8rem;
} 
```

å›åˆ°æˆ‘ä»¬çš„å…ƒç´ ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†æˆ‘ä»¬æƒ³è¦çš„ç»“æ„ï¼Œæ˜¯æ—¶å€™æŠŠå®ƒæ”¾åˆ°æˆ‘ä»¬çš„å…ƒç´ å¯ä»¥ä½¿ç”¨çš„æ¨¡æ¿ä¸­äº†ã€‚æˆ‘ä»¬å°†åœ¨`InputKnob`ç±»ä¹‹å¤–å®šä¹‰å®ƒ:

```
const template = document.createElement('template');
template.innerHTML = `
  <style>
    #container {
      --angle: 0rad;
      transform: rotate(var(--angle));
    }
  </style>
  <div id="container" part="container">
    <slot></slot>
  </div>`; 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æƒ³ä¸ºå…ƒç´ æ·»åŠ ä¸€ä¸ªå½±å­æ ¹ï¼Œå¹¶å°†æ¨¡æ¿å…‹éš†åˆ°å…¶ä¸­:

```
class InputKnob extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
    this.shadowRoot.appendChild(template.content.cloneNode(true));
    this._container = this.shadowRoot.getElementById('container');
  } // âœ‚ï¸ rest of the class omitted
} 
```

æˆ‘ä»¬æ­£åœ¨è·å–å¯¹æˆ‘ä»¬çš„`#container`çš„å¼•ç”¨ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ›´æ–°é‚£ä¸ª`--angle`å˜é‡ã€‚

```
// class InputKnob
_drawState() {
  this._container.style.setProperty('--angle', `${this.value}rad`);
} 
```

æˆ‘ä»¬å¸Œæœ›åœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡è¢«æ·»åŠ åˆ°é¡µé¢æ—¶ä»¥åŠæ¯å½“`value`è¢«æ›´æ”¹æ—¶æ›´æ–°è¯¥å€¼ã€‚

```
// class InputKnob
connectedCallback() {
  this._drawState();
}

attributeChangedCallback(attrName, oldVal, newVal) {
  this._drawState();
} 
```

è¿™æ ·ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªåŸºäº`value`å±æ€§æ—‹è½¬çš„ç»„ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°å°è¯•è®¾ç½®è¿™äº›å€¼å¹¶è§‚å¯Ÿæ–¹å—æ—‹è½¬æ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚

[![Screenshot of Chrome with Developer tools open](../Images/a0ca23ab096fbc3f7c41c29fd11b5ba3.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Ttfv-FnX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/07jcf5s47vsdznp9xo68.png)

å¥½å§ï¼Œå¥½å§â€”â€”ä½ ä¸æ„Ÿå…´è¶£ï¼Œæˆ‘åº”è¯¥ç»™ä½ ä¸€äº›äº’åŠ¨çš„ä¸œè¥¿ã€‚è®©æˆ‘ä»¬æŠŠå®ƒæ•´åœ†ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªæ»‘å—æ¥æ§åˆ¶æ—‹è½¬ã€‚è¿™å¾ˆç®€å•ï¼Œå› ä¸º:

```
<input-knob value="2.5"></input-knob>
<input type="range" name="angle" min="0" max="6.28" step="0.1" value="1" />
<script>
  const knob = document.querySelector('input-knob');
  const slider = document.querySelector('input[type=range]');
  // Just take the value from the slider and set it straight on the knob
  slider.addEventListener('input', () => { knob.value = slider.value; });
</script> 
```

è¯·åœ¨ä¸‹é¢äº²è‡ªå°è¯•ä¸€ä¸‹ã€‚æ»‘å—åº”è¯¥å°†å¹³æ–¹ä» 0 åˆ° 2Ï€ (6.28)å¼§åº¦æˆ–ä¸€æ•´åœˆã€‚

[https://glitch.com/embed/#!/embed/building-rotavo-01?previewSize=100&path=index.html](https://glitch.com/embed/#!/embed/building-rotavo-01?previewSize=100&path=index.html)

## [](#browser-support)ğŸš§æµè§ˆå™¨æ”¯æŒ

ä¸è¿‡ï¼Œæœ‰ç‚¹å¤ªå¹²å‡€äº†ï¼Œæ˜¯å§ï¼Ÿå‡ ä¹ä¸æ˜¯ç°ä»£ web å¼€å‘çš„å…¨éƒ¨ã€‚æˆ‘å¯èƒ½æ²¡æœ‰æåˆ°ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸ºäº†è®©å®ƒåœ¨ä¸åŒçš„æµè§ˆå™¨ä¸­æ˜¾ç¤ºï¼Œè¿˜éœ€è¦åšæ›´å¤šçš„äº‹æƒ…ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä½ æŸ¥çœ‹äº† [MDN å…³äºæµè§ˆå™¨å¯¹`::part()`](https://developer.mozilla.org/en-US/docs/Web/CSS/::part#Browser_compatibility) æ”¯æŒçš„éƒ¨åˆ†â€”â€”å—¯ï¼Œæˆ‘å¯èƒ½ä¼šä¸ºæ­¤æäº¤ä¸€ä¸ªæ‹‰å–è¯·æ±‚ã€‚åŸºæœ¬ä¸Šï¼Œè¿™æ˜¯ [Chrome å’Œå…¶ä»–æµè§ˆå™¨å‘å‡ºäº†ç§¯æçš„å£°éŸ³](https://chromestatus.com/features/5763933658939392)ï¼Œä½†æˆ‘ä»¬è¿˜æ²¡æœ‰åˆ°é‚£ä¸€æ­¥ã€‚

ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯è§£å†³é‚£äº›ä¸æ”¯æŒè‡ªå®šä¹‰å…ƒç´ æˆ–é˜´å½± DOM çš„æµè§ˆå™¨ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [`webcomponents.js` polyfill](https://github.com/webcomponents/polyfills/tree/master/packages/webcomponentsjs) æ¥æ£€æµ‹éœ€è¦ä»€ä¹ˆæ”¯æŒã€‚åœ¨å¯¼å…¥/å®šä¹‰å…ƒç´ ä¹‹å‰ï¼Œå°†è„šæœ¬æ”¾å…¥ã€‚æˆ‘æ˜¯ä»`unpkg.com`ä¸‹è½½çš„ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥ä¸‹è½½è¿™ä¸ªåŒ…æˆ–è€…æŒ‰ç…§è¯´æ˜ä½¿ç”¨`npm`ã€‚

```
<script src="https://unpkg.com/@webcomponents/webcomponentsjs"></script> 
```

ä¸è¦è¢«ä¸€ç§è™šå‡çš„å®‰å…¨æ„Ÿæ‰€è¿·æƒ‘â€”â€”å®ƒç°åœ¨å˜è„äº†ã€‚æˆ‘æ‰¾ä¸åˆ°æ£€æµ‹å¯¹`::part()`æ”¯æŒçš„å¥½æ–¹æ³•ï¼Œæ‰€ä»¥è¯·å¤šåŒ…æ¶µã€‚è¿˜è®°å¾—æˆ‘ä»¬ç»™å…ƒç´ æ·»åŠ äº†`part="container"`å±æ€§å—ï¼Ÿæˆ‘ä»¬å°†æµ‹è¯•è¯¥å±æ€§æ˜¯å¦å¯ä»¥é€šè¿‡ JavaScript è®¿é—®ã€‚å¦‚æœä¸æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€äº›æ›¿ä»£ç»“æ„æ¥è¿›è¡Œæ ·å¼åŒ–ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä¸€ä¸ª`<span>`åŒ…è£…å…ƒç´ ä¸­çš„ä»»ä½•å†…å®¹ï¼Œä¸€ä¸ª`.fallback`ç±»ã€‚

```
// connectedCallback()
if (!this._container.part) {
  // create a <span>
  const wrapper = document.createElement('span');
  // move this element's child nodes into it
  wrapper.append(...this.childNodes);
  // add the classes
  wrapper.classList.add('fallback');
  this.classList.add('fallback');
  // and add the wrapper into this element
  this.append(wrapper);
} 
```

ç°åœ¨æˆ‘ä»¬å¤åˆ¶å›é€€å…ƒç´ çš„æ ·å¼:

```
input-knob.fallback {
  display: block;
}

input-knob.fallback>span.fallback {
  display: block;
  background: #cadbbc;
  border: 1rem dashed #356211;
  box-shadow: 0.3rem 0.3rem 0.3rem rgba(0, 0, 0, 0.5);
  width: 8rem;
  height: 8rem;
} 
```

ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†é€‰æ‹©å™¨æ·»åŠ åˆ°ç°æœ‰çš„è§„åˆ™ä¸­ï¼Œè€Œä¸æ˜¯å¤åˆ¶æ•´ä¸ªå—â€”â€”ç„¶è€Œï¼Œè¿™ä¼šå¯¼è‡´è‡³å°‘ä¸€ä¸ªå…¶ä»–æµè§ˆå™¨å¿½ç•¥æ•´ä¸ªå—ã€‚æ‰€ä»¥ï¼Œå¤åˆ¶/ç²˜è´´å®ƒã€‚æ¶å¿ƒã€‚æ— è®ºå¦‚ä½•ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå‡ ä¹åœ¨ä»»ä½•åœ°æ–¹éƒ½æœ‰æ•ˆçš„å…ƒç´ ï¼Œæˆ‘ä»¬å°†æ°¸è¿œä¸ä¼šå†æåˆ°å®ƒã€‚è®©æˆ‘ä»¬æ¥ç‚¹æ›´æœ‰è¶£çš„ã€‚

## [](#handle-touch)ğŸ¤æ‰‹æŸ„è§¦æ‘¸

ä½¿ç”¨æ»‘å—è¯æ˜æˆ‘ä»¬å¯ä»¥æ§åˆ¶æ—‹è½¬ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿç‚¹å‡»å¹¶æ‹–åŠ¨å…ƒç´ ï¼Œäº‹æƒ…ä¼šå˜å¾—æœ‰ç‚¹å¤æ‚ã€‚æˆ‘ä»¬éœ€è¦åšä¸‰ä»¶äº‹:

*   ä½¿ç”¨[æŒ‡é’ˆäº‹ä»¶](https://developers.google.com/web/updates/2016/10/pointer-events)
*   æŠ‘åˆ¶ä¸€äº›é»˜è®¤çš„æµè§ˆå™¨è¡Œä¸º
*   æ‹¼å‘½åŠªåŠ›è®°ä½å­¦æ ¡é‡Œçš„ä¸€äº›ä¸‰è§’å­¦çŸ¥è¯†

## [](#pointer-events-and-default-behaviour)ğŸ‘†æŒ‡é’ˆäº‹ä»¶å’Œé»˜è®¤è¡Œä¸º

è®©æˆ‘ä»¬ä»æŒ‡é’ˆäº‹ä»¶(å¦ç™½åœ°è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯çˆ±çš„ API)å¼€å§‹ï¼Œå¹¶åŠ å…¥ä¸€ç‚¹å¤„ç†é»˜è®¤äº‹ä»¶çš„å†…å®¹ï¼Œå› ä¸ºè¿™ä¸¤è€…éƒ½ä¸ä¼šç»™æˆ‘ä»¬å¸¦æ¥å¤ªå¤šç—›è‹¦â€”â€”ä¸åƒåˆ—è¡¨ä¸­çš„æœ€åä¸€é¡¹ã€‚

```
class InputKnob extends HTMLElement {
  // âœ‚ï¸ existing code has been removed
  constructor() {
    // Capture the pointer so that the user can still rotate the element even
    // if they leave the bounding area of it.
    this.setPointerCapture(e.pointerId);
    // Re-bind this for listeners so that this == instance of this class
    this._onPointerdown = this._onPointerdown.bind(this);
    this._onPointermove = this._onPointermove.bind(this);
    this._onPointerup = this._onPointerup.bind(this);
  }

  connectedCallback() {
    // Listen for pointerdown events when the element is connected to the page
    this.addEventListener('pointerdown', this._onPointerdown);
  }

  disconnectedCallback() {
    // And stop listening if the element is removed
    this.removeEventListener('pointerdown', this._onPointerdown);
  }

  _onPointerdown(e) {
    e.preventDefault();
    // A long press can bring up the context menu, we want to disable that when
    // the user is controlling the element
    window.oncontextmenu = () => { return false; };
    // Only add listeners for the other events once interaction has started
    this.addEventListener('pointermove', this._onPointermove);
    this.addEventListener('pointerup', this._onPointerup);
    this.addEventListener('pointercancel', this._onPointerup);
  }

  _onPointermove(e) {
    // On all of these we're preventing the default behaviour as we assume our
    // web developer won't do something like put a <button> inside the element.
    e.preventDefault();
  }

  _onPointerup(e) {
    e.preventDefault();
    // Re-enable the context menu
    window.oncontextmenu = null;
    // Release the pointer we captured earlier
    this.releasePointerCapture(e.pointerId);
    // Remove all our listeners
    this.removeEventListener('pointermove', this._onPointermove);
    this.removeEventListener('pointerup', this._onPointerup);
    this.removeEventListener('pointercancel', this._onPointerup);
  }
} 
```

æˆ‘ä»¬è¿˜æƒ³æ›´æ–°æˆ‘ä»¬çš„`template`ä¸­çš„ CSSï¼Œä»¥ç¡®ä¿ä¸€äº›åˆç†çš„äº¤äº’ã€‚æˆ‘ä»¬å°†åˆ©ç”¨`:host`ä¼ªç±»æ¥é€‰æ‹©å¤–éƒ¨çš„`<input-knob>`æ ‡ç­¾ã€‚

```
host {
  display: inline-block;
  user-select: none;
  -webkit-user-select: none;
  touch-action: none;
}
#container {
  --angle: 0rad;
  transform: rotate(var(--angle));
} 
```

åœ¨ä¸Šè¿°é£æ ¼ä¸­å‘ç”Ÿäº†ä¸‰ä»¶äº‹:

*   é¦–å…ˆï¼Œå¦‚æœæ‚¨åœ¨ DevTools ä¸­æ£€æŸ¥å‰é¢ä¾‹å­ä¸­çš„`<input-knob>`å…ƒç´ ï¼Œæ‚¨å°†çœ‹åˆ°å®ƒæœ‰ä¸€ä¸ª`auto`å®½åº¦å’Œé«˜åº¦ï¼Œå¹¶ä¸”æ²¡æœ‰å ç”¨æ–‡æ¡£ä¸­çš„ç©ºé—´ã€‚å¦‚æœæˆ‘ä»¬çš„ç”¨æˆ·è¦è§¦æ‘¸ä»»ä½•ä¸œè¥¿ï¼Œæˆ‘ä»¬éœ€è¦å…ƒç´ æœ‰ä¸€ä¸ªå¤§å°ï¼
*   å…¶æ¬¡ï¼Œ`user-select`è¡Œé˜»æ­¢ç”¨æˆ·é€‰æ‹©æ§ä»¶ä¸­çš„ä»»ä½•æ–‡æœ¬ã€‚å°±åƒé˜²æ­¢ä¸Šä¸‹æ–‡èœå•å¼¹å‡ºä¸€æ ·ï¼Œè¿™å¯ä»¥é˜²æ­¢ç”¨æˆ·æŒ‰ä½æ‰‹æŒ‡æ—¶å‡ºç°å¥‡æ€ªçš„æ–‡æœ¬é€‰æ‹©æ•ˆæœã€‚
*   ç¬¬ä¸‰ï¼Œ`touch-action`å‘Šè¯‰æµè§ˆå™¨ä¸è¦åœ¨è¿™ä¸ªå…ƒç´ ä¸Šå¤„ç†ä»»ä½•å¸¸è§çš„æ‰‹åŠ¿â€”â€”æ¯”å¦‚å¹³ç§»ã€ç¼©æ”¾ç­‰ã€‚å› ä¸ºæˆ‘ä»¬è¦åœ¨è¿™é‡Œå®ç°æˆ‘ä»¬è‡ªå·±çš„è¡Œä¸ºã€‚

## [](#touching-trigonometry)ğŸ“è§¦æ‘¸ä¸‰è§’å­¦

ç°åœ¨ç›‘å¬å™¨å·²ç»è¿æ¥å¥½äº†ï¼Œæˆ‘ä»¬çš„å…ƒç´ å°†æ¥æ”¶æŒ‡é’ˆäº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å“åº”è¿™äº›äº‹ä»¶ã€‚è®©æˆ‘ä»¬æ·±å…¥æ•°å­¦ï¼

ä½œä¸ºä¸€ä¸ªæ¸©å’Œçš„ä»‹ç»ï¼Œæˆ‘ä»¬åœ¨ç±»å¤–åˆ›å»ºäº†ä¸€ä¸ªæ–¹ä¾¿çš„å¸¸é‡ä¾›ä»¥åä½¿ç”¨:

```
const TWO_PI = 2 * Math.PI; 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡è§¦æ‘¸å…ƒç´ æ—¶åˆå§‹åŒ–ä¸€äº›å€¼ã€‚å®¹æ˜“å¾—åˆ°çš„æ˜¯æŒ‡é’ˆäº‹ä»¶çš„åæ ‡ã€å…ƒç´ çš„ä¸­å¿ƒå’Œèµ·å§‹è§’åº¦ã€‚

[![A square element with a point indicated at the centre and one in the upper right of the square](../Images/0c8bddb819e006b9a1bbce663bd1c98d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--y8NjgkzF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/2110ud35kriggj0ie5kd.png)

```
// _onPointerdown(e)
this._touchX = e.clientX;
this._touchY = e.clientY;
this._centerX =
  this.offsetLeft - this.scrollLeft + this.clientLeft + this.offsetWidth / 2;
this._centerY =
  this.offsetTop - this.scrollTop + this.clientTop + this.offsetHeight / 2;
this._initialAngle = this._angle; 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è§¦æ‘¸çš„èµ·å§‹è§’åº¦è¿œç¦»é›¶æ—‹è½¬ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™æƒ³è±¡æˆç”»ä¸€ä¸ªç›´è§’ä¸‰è§’å½¢ï¼Œå…¶ä¸­ä¸€ä¸ªè§’åœ¨å¯¹è±¡çš„ä¸­å¿ƒï¼Œæ–œè¾¹å‘å¤–å»¶ä¼¸åˆ°ç”¨æˆ·çš„æŒ‡é’ˆã€‚æˆ‘ä»¬å¯ä»¥ä» 2 ä¸ªè‡ªå˜é‡çš„åæ­£åˆ‡å‡½æ•°å¾—åˆ°è¿™ä¸ªè§’åº¦ï¼Œåˆå [`Math.atan2()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/atan2) ã€‚é€šè¿‡è·å–æŒ‡é’ˆäº‹ä»¶åæ ‡å¹¶å‡å»å…ƒç´ çš„ä¸­å¿ƒåæ ‡ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯å°†å®ƒä»¬å½’ä¸€åŒ–ï¼Œå°±å¥½åƒå…ƒç´ çš„ä¸­å¿ƒæ˜¯ 0ï¼Œ0ã€‚

[![A square element with a point indicated at the centre and one in the upper right of the square with a right angle triangle drawn through those points](../Images/cccea4cd0fb8403e0a2be3fd92a567b1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--7mF_hSTu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/b70nzebozzzallam1mru.png)

```
// _onPointerdown(e)
this._initialTouchAngle = Math.atan2(
  this._touchY - this._centerY,
  this._touchX - this._centerX
); 
```

ç°åœ¨ï¼Œå½“ç”¨æˆ·ç§»åŠ¨æŒ‡é’ˆæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›è·Ÿè¸ªè¯¥ç§»åŠ¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›¸åº”åœ°æ—‹è½¬å…ƒç´ ã€‚

[![The same square showing the point in the upper right moving down and further to the right](../Images/4772a0297389b9828d1dd747222c1afe.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--th6NdMvo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zndqa2xonoxq1m37zzm3.png)

æˆ‘ä»¬æ€ä¹ˆçŸ¥é“è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯æ›´å¤šçš„ä¸‰è§’å½¢ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸ä¹‹å‰å®Œå…¨ç›¸åŒçš„`atan2()`è®¡ç®—ï¼Œä½†æ˜¯ä½¿ç”¨æ–°çš„æŒ‡é’ˆä½ç½®ã€‚å¦‚æœæˆ‘ä»¬ä»å½“å‰è§’åº¦å‡å»èµ·å§‹è§’åº¦ï¼Œå°±å¾—åˆ°æˆ‘ä»¬åœ¨è§¦æ‘¸ä¸­æ—‹è½¬çš„é‡ã€‚å¯¹äºå…ƒç´ çš„æœ€ç»ˆè§’åº¦ï¼Œæˆ‘ä»¬å–å®ƒå½“å‰çš„æ—‹è½¬è§’åº¦ï¼Œå³`value`ï¼Œç„¶ååŠ ä¸Šæˆ‘ä»¬å·²ç»æ—‹è½¬çš„è§’åº¦ã€‚

[![The same square but rotated by the change in angle](../Images/94a3e698c8470136ff754ad2d7898b47.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--sQ1JRRgi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8nw32osdu2f3y2tj0s34.png)

åœ¨ä»£ç ä¸­ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·:

```
// _onPointermove(e)
this._touchX = e.clientX;
this._touchY = e.clientY;
this._angle =
  // initial rotation of the element
  this._initialAngle
  // subtract the starting touch angle
  - this._initialTouchAngle
  // add the current touch angle
  + Math.atan2(this._touchY - this._centerY, this._touchX - this._centerX);
// Normalise value back into a 2Ï€ range
this._angle = (this._angle + TWO_PI) % TWO_PI;
// Done, update the value!
this.value = this._angle; 
```

## [](#a-touching-demo)ğŸ”„æ„Ÿäººçš„æ¼”ç¤º

å¤©å•Šï¼Œå–˜å£æ°”å§ã€‚å¦‚æœä½ è¿˜å’Œæˆ‘åœ¨ä¸€èµ·ï¼Œä½ â€¦è¿™æ˜¯ä½ åº”å¾—çš„ã€‚ä½ å¯ä»¥ä¼¸å‡ºä½ çš„é¼ æ ‡æˆ–æ‰‹æŒ‡ï¼Œæ—‹è½¬ä½ å–œæ¬¢çš„é‚£ä¸ªæ–¹å—ã€‚

[https://glitch.com/embed/#!/embed/building-rotavo-02?previewSize=100&path=index.html](https://glitch.com/embed/#!/embed/building-rotavo-02?previewSize=100&path=index.html)

## [](#oh-wait-browser-support)ğŸš§å“¦ï¼Œç­‰ç­‰â€¦æµè§ˆå™¨æ”¯æŒ

æŠ±æ­‰ï¼Œæˆ‘çŸ¥é“ï¼Œæˆ‘çŸ¥é“ã€‚[æŒ‡é’ˆäº‹ä»¶åœ¨æ”¯æŒæ–¹é¢æœ‰æ‰€è¿›å±•](https://caniuse.com/#feat=pointer)ï¼Œä½†å¹¶éæ— å¤„ä¸åœ¨ã€‚å½“æŒ‡é’ˆä¸è¢«æ”¯æŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ¢å…¥[é¼ æ ‡](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent)å’Œ[è§¦æ‘¸](https://developer.mozilla.org/en-US/docs/Web/API/Touch_events)äº‹ä»¶ã€‚

ç¬¬ä¸€æ­¥æ˜¯å°†ç‰¹å®šäºæŒ‡é’ˆçš„é€»è¾‘ä¸å®é™…å“åº”äº‹ä»¶çš„ä¸šåŠ¡åˆ†å¼€ã€‚è€å®è¯´ï¼Œè¿™æ— è®ºå¦‚ä½•éƒ½æ˜¯å¾ˆå¥½çš„è½¯ä»¶å·¥ç¨‹å®è·µï¼Œå¹¶ä¸”å¯èƒ½æ˜¯å®ƒæœ€åˆåº”è¯¥è¢«ç¼–å†™çš„æ–¹å¼ã€‚æˆ‘æ²¡æœ‰å±•ç¤º`_rotation*()`æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬å®é™…ä¸Šå°±æ˜¯ä¹‹å‰çš„ä»£ç ã€‚

```
_onPointerdown(e) {
  e.preventDefault();
  this._touchX = e.clientX;
  this._touchY = e.clientY;
  // âœ‚ï¸ Chop out existing code, extract into new method
  this._rotationStart();
  this.setPointerCapture(e.pointerId);
  this.addEventListener('pointermove', this._onPointermove);
  this.addEventListener('pointerup', this._onPointerup);
  this.addEventListener('pointercancel', this._onPointerup);
}

_onPointermove(e) {
  e.preventDefault();
  this._touchX = e.clientX;
  this._touchY = e.clientY;
  // âœ‚ï¸ Cut and paste again
  this._rotationChange();
}

_onPointerup(e) {
  e.preventDefault();
  // âœ‚ï¸ One last time!
  this._rotationEnd();
  this.releasePointerCapture(e.pointerId);
  this.removeEventListener('pointermove', this._onPointermove);
  this.removeEventListener('pointerup', this._onPointerup);
  this.removeEventListener('pointercancel', this._onPointerup);
} 
```

å¦‚æœæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨æŒ‡é’ˆäº‹ä»¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿æ¥æ–°çš„ç›‘å¬å™¨:

```
// connectedCallback()
if ('PointerEvent' in window) {
  this.addEventListener('pointerdown', this._onPointerdown);
} else {
  this.addEventListener('touchstart', this._onTouchstart);
  this.addEventListener('mousedown', this._onMousedown);
} 
```

å®Œäº‹ä¹‹åæ”¶æ‹¾å¹²å‡€ã€‚

```
// disconnectedCallback
if ('PointerEvent' in window) {
  this.removeEventListener('pointerdown', this._onPointerdown);
} else {
  this.removeEventListener('touchstart', this._onTouchstart);
  this.removeEventListener('mousedown', this._onMousedown);
} 
```

é¼ æ ‡äº‹ä»¶å¾ˆå®¹æ˜“æ·»åŠ è¿›æ¥ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„è¡¨é¢ä¸æŒ‡é’ˆç­‰åŒ:

```
_onMousedown(e) {
  this._touchX = e.clientX;
  this._touchY = e.clientY;
  this._rotationStart();
  document.addEventListener('mousemove', this._onMousemove);
  document.addEventListener('mouseup', this._onMouseup);
}

_onMousemove(e) {
  e.preventDefault();
  this._touchX = e.clientX;
  this._touchY = e.clientY;
  this._rotationChange();
}

_onMouseup(e) {
  e.preventDefault();
  document.removeEventListener('mousemove', this._onMousemove);
  document.removeEventListener('mouseup', this._onMouseup);
  this._rotationEnd();
} 
```

è§¦æ‘¸äº‹ä»¶ç¨å¾®å¤æ‚ä¸€äº›ï¼Œå› ä¸ºå­˜åœ¨å¤šç‚¹è§¦æ‘¸çš„èŒƒå›´ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬åªæ˜¯å‡è®¾ç¬¬ä¸€æ¬¡è§¦æ‘¸æ˜¯æˆ‘ä»¬æ‰€å…³å¿ƒçš„ï¼Œè€Œä¸”â€¦å—¯ï¼Œå®ƒè¿˜æ²¡æœ‰é€ æˆé—®é¢˜ã€‚

```
_onTouchstart(e) {
  e.preventDefault();
  this._touchX = e.changedTouches[0].clientX;
  this._touchY = e.changedTouches[0].clientY;
  this._rotationStart();
  this.addEventListener('touchmove', this._onTouchmove);
  this.addEventListener('touchend', this._onTouchend);
  this.addEventListener('touchcancel', this._onTouchend);
}

_onTouchmove(e) {
  e.preventDefault();
  this._touchX = e.targetTouches[0].clientX;
  this._touchY = e.targetTouches[0].clientY;
  this._rotationChange();
}

_onTouchend(e) {
  e.preventDefault();
  this.removeEventListener('touchmove', this._onTouchmove);
  this.removeEventListener('touchend', this._onTouchend);
  this.removeEventListener('touchcancel', this._onTouchend);
  this._rotationEnd();
} 
```

å–”ï¼è¿™è¿˜ä¸ç®—å¤ªç³Ÿâ€”â€”ç°åœ¨æˆ‘ä»¬çš„ä»£ç æœ‰äº†æ›´å¥½çš„å…³æ³¨ç‚¹åˆ†ç¦»å’Œè·¨æµè§ˆå™¨æ”¯æŒï¼

## [](#painting-and-performance)ğŸ–Œï¸çš„ç»˜ç”»å’Œè¡¨æ¼”

ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æ²¡å®Œã€‚å³ä½¿è¯¥å…ƒç´ æ­£åœ¨è¿è¡Œï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥çœ‹ä¸€çœ‹è¯¥å…ƒç´ è¿è¡Œå¾—æœ‰å¤šå¥½ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦åœ¨ä¸€ä¸ªæ–°çª—å£ä¸­æ‰“å¼€[ä¹‹å‰çš„å°æ•…éšœæ¼”ç¤º](https://building-rotavo-02.glitch.me)ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å¯åŠ¨ Chrome çš„ DevTools äº†ã€‚æˆ‘ä»¬æƒ³å¯ç”¨â€œæ²¹æ¼†é—ªçƒâ€â€”â€”ä½ å¯ä»¥åœ¨ 3 ç‚¹èœå•ä¸‹æ‰¾åˆ°å®ƒâ†’æ›´å¤šå·¥å…·â†’æ¸²æŸ“â†’æ²¹æ¼†é—ªçƒï¼Œæˆ–è€…å¦‚æœä½ ä¸å–œæ¬¢ä¸‰çº§èœå•ï¼Œç„¶åç”¨`Ctrl / Cmd + Shift + P`è°ƒå‡ºå‘½ä»¤è°ƒè‰²æ¿ï¼Œé”®å…¥â€œæ²¹æ¼†é—ªçƒâ€ã€‚å½“ä½ å°è¯•æ—‹è½¬å…ƒç´ æ—¶ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªç»¿è‰²çš„çŸ©å½¢ä¸€ç›´ç”»åœ¨ä¸Šé¢ã€‚

[![Paint flashing rectangle displaying when the element moves](../Images/a0e8ff4305d3da8e19c0b95fca6abf06.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--SUPOiE9F--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/g9l606dermuf6ohmqbkw.png)

è¿™å¾ˆç³Ÿç³•ã€‚è¿™æ„å‘³ç€æµè§ˆå™¨ä¸å¾—ä¸åœ¨æ¯ä¸€ä¸ªäº¤äº’ä¸Šç»˜ç”»ï¼Œè¿™å¹¶ä¸æ€»æ˜¯ä¸€ä¸ªä¾¿å®œçš„æ“ä½œã€‚å¦‚æœä½ åœ¨ç¬”è®°æœ¬ç”µè„‘æˆ–é«˜ç«¯æ‰‹æœºä¸Šï¼Œä½ å¯èƒ½ä¸ä¼šæ³¨æ„åˆ°ä»€ä¹ˆï¼Œä½†è¿™ä¼šå½±å“ä½ åœ¨ä½ç«¯æˆ–ç¹å¿™è®¾å¤‡ä¸Šçš„å¸§ç‡ã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸ªè¡¥ä¸æ·»åŠ èµ·æ¥éå¸¸ç®€å•ã€‚æˆ‘ä»¬å¸Œæœ›å‘æµè§ˆå™¨æä¾›ä¸€ä¸ªæŒ‡ç¤ºï¼Œè¡¨æ˜æˆ‘ä»¬æ‰“ç®—ä»¥æŸç§æ–¹å¼æ”¹å˜å…ƒç´ ã€‚å¾ˆæ–¹ä¾¿çš„æ˜¯ï¼Œ`will-change`å±æ€§å…è®¸æˆ‘ä»¬è¿™æ ·åšã€‚æˆ‘ä»¬åœ¨å†…éƒ¨`#container`çš„æ ·å¼ä¸ŠæŒ‡å®šäº†è¿™ä¸€ç‚¹ã€‚

```
#container {
  --angle: 0rad;
  transform: rotate(var(--angle));
  will-change: transform;
} 
```

ç°åœ¨æµè§ˆå™¨çŸ¥é“æˆ‘ä»¬æ‰“ç®—æ”¹å˜`transform`å±æ€§ï¼Œå®ƒå¯ä»¥ä¼˜åŒ–ç»“æœã€‚æ¯”è¾ƒè¿™ä¸ª[æ›´æ–°çš„å°æ•…éšœæ¼”ç¤º](https://building-rotavo-03.glitch.me)å’Œå¢åŠ çš„è¿™ä¸€è¡Œã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªçŸ­æš‚çš„åˆå§‹é—ªå…‰ï¼Œä½†ä¹‹å-æ²¡æœ‰ä»»ä½•ç»˜ç”»äº‹ä»¶ã€‚æˆåŠŸï¼

## [](#bonus-content)ğŸ†é¢å¤–å†…å®¹

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰åœ¨å…ƒç´ ä¸­æ”¾å…¥ä»»ä½•å†…å®¹â€”â€”æˆ‘ä»¬åªæ˜¯å¯¹å…ƒç´ æœ¬èº«è¿›è¡Œäº†æ ·å¼åŒ–ã€‚å¦‚æœä½ çœ‹ä¸€ä¸‹ [Rotavo åº”ç”¨ç¨‹åº](https://bit.ly/rotavo-pwa)ä½ ä¼šå‘ç°ğŸ¥‘æ§ä»¶åªæ˜¯æ ‡ç­¾ä¸­çš„ SVGã€‚åŸæ¥ä½ å¯ä»¥æŠŠä»»ä½•ä½ æƒ³è¦çš„å†…å®¹æ”¾åœ¨é‚£ä¸ªæ ‡ç­¾é‡Œå¹¶å‘ˆç°å®ƒã€‚æ‰€ä»¥ï¼Œä½œä¸ºè¿™ç¯‡æ–‡ç« çš„ç»“å°¾ *( **éå¸¸æ„Ÿè°¢æ°¸è¿œæœ‰è€å¿ƒçš„[ä¿ç½—Â·é‡‘å…°](https://twitter.com/Paul_Kinlan)å€Ÿç»™æˆ‘ä»–çš„è„¸** )* è¯·éšæ„å»è®¤è¯†â€¦â€¦ä¿ç½—Â·æ–¯å¹³å…°ã€‚

[https://glitch.com/embed/#!/embed/paul-spinlan?previewSize=100&path=index.html](https://glitch.com/embed/#!/embed/paul-spinlan?previewSize=100&path=index.html)

ä¸‹ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†æ¢ç´¢æ·»åŠ è‡ªå®šä¹‰äº‹ä»¶ã€æœ€å°/æœ€å¤§å€¼å’Œè®¡æ•°æ—‹è½¬åˆ°å…ƒç´ ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å›´ç»•å®ƒæ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼