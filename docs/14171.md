# WebGL æœˆä»½ã€‚ç¬¬åå¤©ã€‚å¤šé‡çº¹ç†

> åŸæ–‡:[https://dev . to/lesnitsky/web GL-month-day-10-multiple-textures-gf3](https://dev.to/lesnitsky/webgl-month-day-10-multiple-textures-gf3)

## [](#multiple-textures)å¤šä¸ªçº¹ç†

è¿™æ˜¯ä¸€ç³»åˆ—ä¸ WebGL ç›¸å…³çš„åšæ–‡ã€‚æ¯å¤©éƒ½ä¼šæœ‰æ–°å¸–å­

[![GitHub stars](../Images/433354a9395fe83c4661db01a546c8c3.png)](https://github.com/lesnitsky/webgl-month)
[![Twitter Follow](../Images/3e130d395765fae6559a50ae2501dc92.png)T6ã€‘](https://twitter.com/lesnitsky_a)

[åŠ å…¥é‚®ä»¶åˆ—è¡¨](http://eepurl.com/gwiSeH),è®©æ–°é‚®ä»¶ç›´æ¥è¿›å…¥ä½ çš„æ”¶ä»¶ç®±

[æ­¤å¤„æä¾›æºä»£ç ](https://github.com/lesnitsky/webgl-month)

å»ºé€ äº

[![Git Tutor Logo](../Images/4a5fcbd1126401b65ca7fbe362404aa0.png)T2ã€‘](https://github.com/lesnitsky/git-tutor)

* * *

å˜¿ğŸ‘‹æ¬¢è¿å›åˆ° WebGL æœˆã€‚æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•ä½¿ç”¨å•å¹…å›¾åƒä½œä¸ºçº¹ç†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦æ¸²æŸ“å¤šå¹…å›¾åƒå‘¢ï¼Ÿ

æˆ‘ä»¬ä»Šå¤©å°†å­¦ä¹ å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­å®šä¹‰å¦ä¸€ä¸ª`sampler2D`

ğŸ“„src/shaders/texture.f.glsl

```
 precision mediump float;

  uniform sampler2D texture;
+ uniform sampler2D otherTexture;
  uniform vec2 resolution;

  vec4 inverse(vec4 color) { 
```

å¹¶å‘ˆç°ä¸¤ä¸ªçŸ©å½¢è€Œä¸æ˜¯ä¸€ä¸ªã€‚å·¦è¾¹çš„çŸ©å½¢å°†ä½¿ç”¨å·²ç»å­˜åœ¨çš„çº¹ç†ï¼Œå³è¾¹çš„æ˜¯æ–°çš„ã€‚

ğŸ“„src/texture.js

```
 gl.linkProgram(program);
  gl.useProgram(program);

- const vertexPosition = new Float32Array(createRect(-1, -1, 2, 2));
+ const vertexPosition = new Float32Array([
+     ...createRect(-1, -1, 1, 2), // left rect
+     ...createRect(-1, 0, 1, 2), // right rect
+ ]);
  const vertexPositionBuffer = gl.createBuffer();

  gl.bindBuffer(gl.ARRAY_BUFFER, vertexPositionBuffer);
  gl.enableVertexAttribArray(attributeLocations.position);
  gl.vertexAttribPointer(attributeLocations.position, 2, gl.FLOAT, false, 0, 0);

- const vertexIndices = new Uint8Array([0, 1, 2, 1, 2, 3]);
+ const vertexIndices = new Uint8Array([
+     // left rect
+     0, 1, 2, 
+     1, 2, 3, 
+     
+     // right rect
+     4, 5, 6, 
+     5, 6, 7,
+ ]);
  const indexBuffer = gl.createBuffer();

  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer); 
```

æˆ‘ä»¬è¿˜éœ€è¦ä¸€ç§æ–¹æ³•æ¥æŒ‡å®šæ¯ä¸ªçŸ©å½¢çš„çº¹ç†åæ ‡ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½å†ä½¿ç”¨`gl_FragCoord`ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä¹‰å¦ä¸€ä¸ªå±æ€§(`texCoord`

ğŸ“„src/shaders/texture.v.glsl

```
 attribute vec2 position;
+ attribute vec2 texCoord; 
  void main() {
      gl_Position = vec4(position, 0, 1); 
```

è¿™ä¸ªå±æ€§çš„å†…å®¹åº”è¯¥æ˜¯ä¸¤ä¸ªçŸ©å½¢çš„åæ ‡ã€‚å·¦ä¸Šä¸º`0,0`ï¼Œå®½åº¦å’Œé«˜åº¦ä¸º`1.0`

ğŸ“„src/texture.js

```
 gl.linkProgram(program);
  gl.useProgram(program);

+ const texCoords = new Float32Array([
+     ...createRect(0, 0, 1, 1), // left rect
+     ...createRect(0, 0, 1, 1), // right rect
+ ]);
+ const texCoordsBuffer = gl.createBuffer();
+ 
+ gl.bindBuffer(gl.ARRAY_BUFFER, texCoordsBuffer);
+ gl.bufferData(gl.ARRAY_BUFFER, texCoords, gl.STATIC_DRAW);
+ 
  const vertexPosition = new Float32Array([
      ...createRect(-1, -1, 1, 2), // left rect
      ...createRect(-1, 0, 1, 2), // right rect 
```

æˆ‘ä»¬è¿˜éœ€è¦åœ¨ JS ä¸­è®¾ç½® texCoord å±æ€§

ğŸ“„src/texture.js

```
 const attributeLocations = {
      position: gl.getAttribLocation(program, 'position'),
+     texCoord: gl.getAttribLocation(program, 'texCoord'),
  };

  const uniformLocations = {
  gl.enableVertexAttribArray(attributeLocations.position);
  gl.vertexAttribPointer(attributeLocations.position, 2, gl.FLOAT, false, 0, 0);

+ gl.bindBuffer(gl.ARRAY_BUFFER, texCoordsBuffer);
+ 
+ gl.enableVertexAttribArray(attributeLocations.texCoord);
+ gl.vertexAttribPointer(attributeLocations.texCoord, 2, gl.FLOAT, false, 0, 0);
+ 
  const vertexIndices = new Uint8Array([
      // left rect
      0, 1, 2, 
```

å¹¶å°†è¯¥æ•°æ®ä¼ é€’ç»™ç‰‡æ®µç€è‰²å™¨

ğŸ“„src/shaders/texture.f.glsl

```
 );
  }

+ varying vec2 vTexCoord;
+ 
  void main() {
-     vec2 texCoord = gl_FragCoord.xy / resolution; +     vec2 texCoord = vTexCoord;
      gl_FragColor = texture2D(texture, texCoord);

      gl_FragColor = sepia(gl_FragColor); 
```

ğŸ“„src/shaders/texture.v.glsl

```
 attribute vec2 position;
  attribute vec2 texCoord;

+ varying vec2 vTexCoord;
+ 
  void main() {
      gl_Position = vec4(position, 0, 1);
+ 
+     vTexCoord = texCoord;
  } 
```

å¥½çš„ï¼Œæˆ‘ä»¬æ¸²æŸ“äº†ä¸¤ä¸ªçŸ©å½¢ï¼Œä½†æ˜¯å®ƒä»¬ä½¿ç”¨äº†ç›¸åŒçš„çº¹ç†ã€‚è®©æˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œå®ƒå°†æŒ‡å®šä½¿ç”¨å“ªä¸ªçº¹ç†ï¼Œå¹¶é€šè¿‡å¦ä¸€ä¸ªå˜é‡å°†è¯¥æ•°æ®ä¼ é€’ç»™ç‰‡æ®µç€è‰²å™¨

ğŸ“„src/shaders/texture.v.glsl

```
 attribute vec2 position;
  attribute vec2 texCoord;
+ attribute float texIndex; 
  varying vec2 vTexCoord;
+ varying float vTexIndex; 
  void main() {
      gl_Position = vec4(position, 0, 1);

      vTexCoord = texCoord;
+     vTexIndex = texIndex;
  } 
```

æ‰€ä»¥ç°åœ¨ç‰‡æ®µç€è‰²å™¨å°†çŸ¥é“ä½¿ç”¨å“ªä¸ªçº¹ç†

> æŠ«éœ²è€…:è¿™ä¸æ˜¯åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­ä½¿ç”¨å¤šä¸ªçº¹ç†çš„å®Œç¾æ–¹å¼ï¼Œè€Œæ˜¯å¦‚ä½•å®ç°è¿™ä¸€ç‚¹çš„ä¸€ä¸ªä¾‹å­

ğŸ“„src/shaders/texture.f.glsl

```
 }

  varying vec2 vTexCoord;
+ varying float vTexIndex; 
  void main() {
      vec2 texCoord = vTexCoord;
-     gl_FragColor = texture2D(texture, texCoord); 
-     gl_FragColor = sepia(gl_FragColor);
+     if (vTexIndex == 0.0) {
+         gl_FragColor = texture2D(texture, texCoord);
+     } else {
+         gl_FragColor = texture2D(otherTexture, texCoord);
+     }
  } 
```

å·¦çŸ©å½¢çš„çº¹ç†ç´¢å¼•ä¸º 0ï¼Œå³çŸ©å½¢çš„çº¹ç†ç´¢å¼•ä¸º 1

ğŸ“„src/texture.js

```
 gl.bindBuffer(gl.ARRAY_BUFFER, texCoordsBuffer);
  gl.bufferData(gl.ARRAY_BUFFER, texCoords, gl.STATIC_DRAW);

+ const texIndicies = new Float32Array([
+     ...Array.from({ length: 4 }).fill(0), // left rect
+     ...Array.from({ length: 4 }).fill(1), // right rect
+ ]);
+ const texIndiciesBuffer = gl.createBuffer();
+ 
+ gl.bindBuffer(gl.ARRAY_BUFFER, texIndiciesBuffer);
+ gl.bufferData(gl.ARRAY_BUFFER, texIndicies, gl.STATIC_DRAW);
+ 
  const vertexPosition = new Float32Array([
      ...createRect(-1, -1, 1, 2), // left rect
      ...createRect(-1, 0, 1, 2), // right rect 
```

åŒæ ·ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®é¡¶ç‚¹å±æ€§

ğŸ“„src/texture.js

```
 const attributeLocations = {
      position: gl.getAttribLocation(program, 'position'),
      texCoord: gl.getAttribLocation(program, 'texCoord'),
+     texIndex: gl.getAttribLocation(program, 'texIndex'),
  };

  const uniformLocations = {
  gl.enableVertexAttribArray(attributeLocations.texCoord);
  gl.vertexAttribPointer(attributeLocations.texCoord, 2, gl.FLOAT, false, 0, 0);

+ gl.bindBuffer(gl.ARRAY_BUFFER, texIndiciesBuffer);
+ 
+ gl.enableVertexAttribArray(attributeLocations.texIndex);
+ gl.vertexAttribPointer(attributeLocations.texIndex, 1, gl.FLOAT, false, 0, 0);
+ 
  const vertexIndices = new Uint8Array([
      // left rect
      0, 1, 2, 
```

ç°åœ¨è®©æˆ‘ä»¬åŠ è½½æˆ‘ä»¬çš„ç¬¬äºŒä¸ªçº¹ç†å›¾åƒ

ğŸ“„src/texture.js

```
 import { createRect } from './shape-helpers';

  import textureImageSrc from '../assets/images/texture.jpg';
+ import textureGreenImageSrc from '../assets/images/texture-green.jpg'; 
  const canvas = document.querySelector('canvas');
  const gl = canvas.getContext('webgl');
  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);
  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, vertexIndices, gl.STATIC_DRAW);

- loadImage(textureImageSrc).then((textureImg) => {
+ Promise.all([
+     loadImage(textureImageSrc),
+     loadImage(textureGreenImageSrc),
+ ]).then(([textureImg, textureGreenImg]) => {
      const texture = gl.createTexture();

      gl.bindTexture(gl.TEXTURE_2D, texture); 
```

å› ä¸ºæˆ‘ä»¬å¿…é¡»åˆ›å»ºå¦ä¸€ä¸ªçº¹ç†â€”â€”æˆ‘ä»¬éœ€è¦æå–ä¸€äº›å…¬å…±ä»£ç æ¥åˆ†ç¦»è¾…åŠ©å‡½æ•°

ğŸ“„src/gl-helpers.js

```
 return p;
  }
+ 
+ export function createTexture(gl) {
+     const texture = gl.createTexture();
+     
+     gl.bindTexture(gl.TEXTURE_2D, texture);
+     
+     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
+     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
+     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
+     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
+ 
+     return texture;
+ }
+ 
+ export function setImage(gl, texture, img) {
+     gl.bindTexture(gl.TEXTURE_2D, texture);
+ 
+     gl.texImage2D(
+         gl.TEXTURE_2D,
+         0,
+         gl.RGBA,
+         gl.RGBA,
+         gl.UNSIGNED_BYTE,
+         img,
+     );
+ } 
```

ğŸ“„src/texture.js

```
 loadImage(textureImageSrc),
      loadImage(textureGreenImageSrc),
  ]).then(([textureImg, textureGreenImg]) => {
-     const texture = gl.createTexture();
- 
-     gl.bindTexture(gl.TEXTURE_2D, texture);
- 
-     gl.texImage2D(
-         gl.TEXTURE_2D,
-         0,
-         gl.RGBA,
-         gl.RGBA,
-         gl.UNSIGNED_BYTE,
-         textureImg,
-     );
- 
-     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
-     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
-     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
-     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR); + 
      gl.activeTexture(gl.TEXTURE0);
      gl.uniform1i(uniformLocations.texture, 0); 
```

ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨æ–°åˆ›å»ºçš„åŠ©æ‰‹

ğŸ“„src/texture.js

```
 import vShaderSource from './shaders/texture.v.glsl';
  import fShaderSource from './shaders/texture.f.glsl';
- import { compileShader, loadImage } from './gl-helpers'; + import { compileShader, loadImage, createTexture, setImage } from './gl-helpers';
  import { createRect } from './shape-helpers';

  import textureImageSrc from '../assets/images/texture.jpg';
      loadImage(textureImageSrc),
      loadImage(textureGreenImageSrc),
  ]).then(([textureImg, textureGreenImg]) => {
+     const texture = createTexture(gl);
+     setImage(gl, texture, textureImg); 
+     const otherTexture = createTexture(gl);
+     setImage(gl, otherTexture, textureGreenImg); 
      gl.activeTexture(gl.TEXTURE0);
      gl.uniform1i(uniformLocations.texture, 0); 
```

è·å¾—ç»Ÿä¸€çš„ä½ç½®

ğŸ“„src/texture.js

```
 const uniformLocations = {
      texture: gl.getUniformLocation(program, 'texture'),
+     otherTexture: gl.getUniformLocation(program, 'otherTexture'),
      resolution: gl.getUniformLocation(program, 'resolution'),
  }; 
```

å¹¶ä¸ºå¿…è¦çš„åˆ¶æœè®¾ç½®å¿…è¦çš„çº¹ç†

è¦å°†çº¹ç†è®¾ç½®ä¸ºç»Ÿä¸€çš„ï¼Œæ‚¨åº”è¯¥æŒ‡å®š

*   èŒƒå›´`[gl.TEXTURE0..gl.TEXTURE31]`ä¸­çš„æ´»åŠ¨çº¹ç†å•å…ƒ(çº¹ç†å•å…ƒçš„æ•°é‡å–å†³äº GPUï¼Œå¯ä»¥ç”¨`gl.getParameter`æ£€ç´¢)
*   å°†çº¹ç†ç»‘å®šåˆ°çº¹ç†å•å…ƒ
*   å°†çº¹ç†å•å…ƒâ€œç´¢å¼•â€è®¾ç½®ä¸º`sampler2D`ç»Ÿä¸€

ğŸ“„src/texture.js

```
 setImage(gl, otherTexture, textureGreenImg);

      gl.activeTexture(gl.TEXTURE0);
+     gl.bindTexture(gl.TEXTURE_2D, texture);
      gl.uniform1i(uniformLocations.texture, 0);

+     gl.activeTexture(gl.TEXTURE1);
+     gl.bindTexture(gl.TEXTURE_2D, otherTexture);
+     gl.uniform1i(uniformLocations.otherTexture, 1);
+ 
      gl.uniform2fv(uniformLocations.resolution, [canvas.width, canvas.height]);

      gl.drawElements(gl.TRIANGLES, vertexIndices.length, gl.UNSIGNED_BYTE, 0); 
```

å°±è¿™æ ·ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ¸²æŸ“å¤šä¸ªçº¹ç†äº†

æ˜å¤©è§ğŸ‘‹

* * *

è¿™æ˜¯ä¸€ç³»åˆ—ä¸ WebGL ç›¸å…³çš„åšæ–‡ã€‚æ¯å¤©éƒ½ä¼šæœ‰æ–°å¸–å­

[![GitHub stars](../Images/433354a9395fe83c4661db01a546c8c3.png)](https://github.com/lesnitsky/webgl-month)
[![Twitter Follow](../Images/3e130d395765fae6559a50ae2501dc92.png)T6ã€‘](https://twitter.com/lesnitsky_a)

[åŠ å…¥é‚®ä»¶åˆ—è¡¨](http://eepurl.com/gwiSeH),è®©æ–°é‚®ä»¶ç›´æ¥è¿›å…¥ä½ çš„æ”¶ä»¶ç®±

[æ­¤å¤„æä¾›æºä»£ç ](https://github.com/lesnitsky/webgl-month)

å»ºé€ äº

[![Git Tutor Logo](../Images/4a5fcbd1126401b65ca7fbe362404aa0.png)T2ã€‘](https://github.com/lesnitsky/git-tutor)