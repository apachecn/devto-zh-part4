# ç€è‰²å™¨å’Œç‚¹

> åŸæ–‡:[https://dev.to/lesnitsky/shaders-and-points-3h2c](https://dev.to/lesnitsky/shaders-and-points-3h2c)

## [](#day-2-simple-shader-and-triangle)ç¬¬äºŒå¤©ã€‚ç®€å•ç€è‰²å™¨å’Œä¸‰è§’å½¢

è¿™æ˜¯ä¸€ç³»åˆ—ä¸ WebGL ç›¸å…³çš„åšæ–‡ã€‚æ¯å¤©éƒ½ä¼šæœ‰æ–°å¸–å­

[![GitHub stars](../Images/8a2abf4d98412e88024769cb04b37b79.png)](https://github.com/lesnitsky/webgl-month)
[![Twitter Follow](../Images/4f47dc9853f692fb8d8fa51375017962.png)T6ã€‘](https://twitter.com/lesnitsky_a)

[åŠ å…¥é‚®ä»¶åˆ—è¡¨](http://eepurl.com/gwiSeH),è®©æ–°é‚®ä»¶ç›´æ¥è¿›å…¥ä½ çš„æ”¶ä»¶ç®±

[æ­¤å¤„æä¾›æºä»£ç ](https://github.com/lesnitsky/webgl-month)

å»ºé€ äº

[![Git Tutor Logo](../Images/4a5fcbd1126401b65ca7fbe362404aa0.png)T2ã€‘](https://github.com/lesnitsky/git-tutor)

* * *

[æ˜¨å¤©](https://dev.to/lesnitsky/webgl-month-day-1-19ha)æˆ‘ä»¬å­¦ä¹ äº† WebGL çš„åŠŸèƒ½â€”â€”è®¡ç®—å¯æ¸²æŸ“åŒºåŸŸå†…çš„æ¯ä¸ªåƒç´ é¢œè‰²ã€‚ä½†æ˜¯å®ƒå®é™…ä¸Šæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ

WebGL æ˜¯ä¸€ä¸ª APIï¼Œå®ƒå¯ä»¥å’Œä½ çš„ GPU ä¸€èµ·æ¸²æŸ“ä¸œè¥¿ã€‚è™½ç„¶ JavaScript ç”± v8 åœ¨ CPU ä¸Šæ‰§è¡Œï¼Œä½† GPU ä¸èƒ½æ‰§è¡Œ JavaScriptï¼Œä½†å®ƒä»ç„¶æ˜¯å¯ç¼–ç¨‹çš„

GPUâ€œç†è§£â€çš„è¯­è¨€ä¹‹ä¸€æ˜¯ [GLSL](https://en.wikipedia.org/wiki/OpenGL_Shading_Language) ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä»…è¦ç†Ÿæ‚‰ WebGL APIï¼Œè¿˜è¦ç†Ÿæ‚‰è¿™ç§æ–°è¯­è¨€ã€‚

GLSL æ˜¯ä¸€ç§ç±»ä¼¼ C çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ‰€ä»¥å¯¹äº JavaScript å¼€å‘è€…æ¥è¯´ï¼Œå®ƒå¾ˆå®¹æ˜“å­¦ä¹ å’Œç¼–å†™ã€‚

ä½†æ˜¯æˆ‘ä»¬åœ¨å“ªé‡Œå†™ glsl ä»£ç å‘¢ï¼Ÿå¦‚ä½•ä¼ é€’ç»™ GPU æ‰èƒ½æ‰§è¡Œï¼Ÿ

è®©æˆ‘ä»¬å†™ä¸€äº›ä»£ç 

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ js æ–‡ä»¶ï¼Œå¹¶è·å–å¯¹ WebGL æ¸²æŸ“ä¸Šä¸‹æ–‡çš„å¼•ç”¨

ğŸ“„index.html

```
 </head>
    <body>
      <canvas></canvas>
-     <script src="./src/canvas2d.js"></script> +     <script src="./src/webgl-hello-world.js"></script>
    </body>
  </html> 
```

ğŸ“„src/webgl-hello-world.js

```
const canvas = document.querySelector('canvas');
const gl = canvas.getContext('webgl'); 
```

GPU å¯æ‰§è¡Œçš„ç¨‹åºé€šè¿‡ WebGL æ¸²æŸ“ä¸Šä¸‹æ–‡çš„æ–¹æ³•ç”Ÿæˆ

ğŸ“„src/webgl-hello-world.js

```
 const canvas = document.querySelector('canvas');
  const gl = canvas.getContext('webgl');
+ 
+ const program = gl.createProgram(); 
```

GPU ç¨‹åºç”±ä¸¤ä¸ªã€å‡½æ•°ã€‘ç»„æˆ
è¿™äº›å‡½æ•°è¢«ç§°ä¸º`shaders`
WebGL æ”¯æŒå‡ ç§ç±»å‹çš„ç€è‰²å™¨

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`vertex`å’Œ`fragment`ç€è‰²å™¨ã€‚
ä¸¤è€…éƒ½å¯ä»¥ç”¨`createShader`çš„æ–¹æ³•åˆ›é€ å‡ºæ¥

ğŸ“„src/webgl-hello-world.js

```
 const gl = canvas.getContext('webgl');

  const program = gl.createProgram();
+ 
+ const vertexShader = gl.createShader(gl.VERTEX_SHADER);
+ const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER); 
```

ç°åœ¨è®©æˆ‘ä»¬ç¼–å†™å°½å¯èƒ½ç®€å•çš„ç€è‰²å™¨

ğŸ“„src/webgl-hello-world.js

```
 const vertexShader = gl.createShader(gl.VERTEX_SHADER);
  const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
+ 
+ const vShaderSource = `
+ void main() {
+     
+ }
+ `; 
```

å¯¹äºé‚£äº›æœ‰ä¸€äº› C/C++ç»éªŒçš„äººæ¥è¯´ï¼Œè¿™åº”è¯¥çœ‹èµ·æ¥å¾ˆç†Ÿæ‚‰

ä¸åƒ C æˆ– C++ `main`ä¸è¿”å›ä»»ä½•ä¸œè¥¿ï¼Œè€Œæ˜¯ç»™ä¸€ä¸ªå…¨å±€å˜é‡`gl_Position`èµ‹å€¼

ğŸ“„src/webgl-hello-world.js

```
 const vShaderSource = `
  void main() {
- +     gl_Position = vec4(0, 0, 0, 1);
  }
  `; 
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ›´ä»”ç»†åœ°çœ‹çœ‹åˆ†é…äº†ä»€ä¹ˆã€‚

ç€è‰²å™¨ä¸­æœ‰è®¸å¤šå¯ç”¨çš„å‡½æ•°ã€‚

`vec4`å‡½æ•°åˆ›å»º 4 ä¸ªåˆ†é‡çš„çŸ¢é‡ã€‚

`gl_Position = vec4(0, 0, 0, 1);`

çœ‹èµ·æ¥å¾ˆå¥‡æ€ª..æˆ‘ä»¬ç”Ÿæ´»åœ¨ä¸‰ç»´ä¸–ç•Œä¸­ï¼Œç¬¬å››ä¸ªå…ƒç´ åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿéš¾é“æ˜¯`time`ï¼ŸğŸ˜•

ä¸è§å¾—

[æ¥è‡ª MDN çš„æŠ¥ä»·](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_model_view_projection#Homogeneous_Coordinates)

> äº‹å®è¯æ˜ï¼Œè¿™ç§æ·»åŠ å…è®¸è®¸å¤šæ“çºµ 3D æ•°æ®çš„å¥½æŠ€æœ¯ã€‚
> ä¸‰ç»´ç‚¹æ˜¯åœ¨å…¸å‹çš„ç¬›å¡å°”åæ ‡ç³»ä¸­å®šä¹‰çš„ã€‚æ·»åŠ çš„ç¬¬å››ç»´å°†è¯¥ç‚¹å˜ä¸ºé½æ¬¡åæ ‡ã€‚å®ƒä»ç„¶è¡¨ç¤º 3D ç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå®¹æ˜“åœ°æ¼”ç¤ºå¦‚ä½•é€šè¿‡ä¸€å¯¹ç®€å•çš„å‡½æ•°æ¥æ„é€ è¿™ç§ç±»å‹çš„åæ ‡ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥å¿½ç•¥ç¬¬å››ä¸ªç»„ä»¶ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º`1.0`,å› ä¸º

å¥½äº†ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç€è‰²å™¨å˜é‡ï¼Œç€è‰²å™¨æºåœ¨å¦ä¸€ä¸ªå˜é‡ä¸­ã€‚æˆ‘ä»¬å¦‚ä½•å°†è¿™ä¸¤è€…è”ç³»èµ·æ¥ï¼Ÿéšç€

ğŸ“„src/webgl-hello-world.js

```
 gl_Position = vec4(0, 0, 0, 1);
  }
  `;
+ 
+ gl.shaderSource(vertexShader, vShaderSource); 
```

åº”è¯¥ç¼–è¯‘ GLSL ç€è‰²å™¨æ‰èƒ½æ‰§è¡Œ

ğŸ“„src/webgl-hello-world.js

```
 `;

  gl.shaderSource(vertexShader, vShaderSource);
+ gl.compileShader(vertexShader); 
```

ç¼–è¯‘ç»“æœå¯ä»¥ç”±ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªâ€œç¼–è¯‘å™¨â€è¾“å‡ºã€‚å¦‚æœæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½æ˜¯å¥½çš„

ğŸ“„src/webgl-hello-world.js

```
 gl.shaderSource(vertexShader, vShaderSource);
  gl.compileShader(vertexShader);
+ 
+ console.log(gl.getShaderInfoLog(vertexShader)); 
```

æˆ‘ä»¬éœ€è¦å¯¹ç‰‡æ®µç€è‰²å™¨åšåŒæ ·çš„äº‹æƒ…ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå°†ç”¨äºç‰‡æ®µç€è‰²å™¨

ğŸ“„src/webgl-hello-world.js

```
 }
  `;

- gl.shaderSource(vertexShader, vShaderSource);
- gl.compileShader(vertexShader); + function compileShader(shader, source) {
+     gl.shaderSource(shader, source);
+     gl.compileShader(shader); 
- console.log(gl.getShaderInfoLog(vertexShader));
+     const log = gl.getShaderInfoLog(shader);
+ 
+     if (log) {
+         throw new Error(log);
+     }
+ }
+ 
+ compileShader(vertexShader, vShaderSource); 
```

æœ€ç®€å•çš„ç‰‡æ®µç€è‰²å™¨æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿå®Œå…¨ä¸€æ ·

ğŸ“„src/webgl-hello-world.js

```
 }
  `;

+ const fShaderSource = `
+     void main() {
+         
+     }
+ `;
+ 
  function compileShader(shader, source) {
      gl.shaderSource(shader, source);
      gl.compileShader(shader); 
```

ç‰‡æ®µç€è‰²å™¨çš„è®¡ç®—ç»“æœæ˜¯é¢œè‰²ï¼Œå®ƒä¹Ÿæ˜¯ 4 ä¸ªåˆ†é‡(rï¼Œgï¼Œbï¼Œa)çš„å‘é‡ã€‚ä¸ CSS ä¸åŒï¼Œå€¼åœ¨`[0..1]`è€Œä¸æ˜¯`[0..255]`çš„èŒƒå›´å†…ã€‚ç‰‡æ®µç€è‰²å™¨çš„è®¡ç®—ç»“æœåº”è¯¥èµ‹ç»™å˜é‡`gl_FragColor`

ğŸ“„src/webgl-hello-world.js

```
 const fShaderSource = `
      void main() {
- +         gl_FragColor = vec4(1, 0, 0, 1);
      }
  `;

  }

  compileShader(vertexShader, vShaderSource);
+ compileShader(fragmentShader, fShaderSource); 
```

ç°åœ¨æˆ‘ä»¬åº”è¯¥æŠŠ`program`å’Œæˆ‘ä»¬çš„ç€è‰²å™¨è¿æ¥èµ·æ¥

ğŸ“„src/webgl-hello-world.js

```
 compileShader(vertexShader, vShaderSource);
  compileShader(fragmentShader, fShaderSource);
+ 
+ gl.attachShader(program, vertexShader);
+ gl.attachShader(program, fragmentShader); 
```

ä¸‹ä¸€æ­¥â€“é“¾æ¥ç¨‹åºã€‚è¿™ä¸ªé˜¶æ®µéœ€è¦éªŒè¯é¡¶ç‚¹å’Œç‰‡æ®µç€è‰²å™¨æ˜¯å¦ç›¸äº’å…¼å®¹(æˆ‘ä»¬å°†åœ¨åé¢è·å¾—æ›´å¤šç»†èŠ‚)

ğŸ“„src/webgl-hello-world.js

```
 gl.attachShader(program, vertexShader);
  gl.attachShader(program, fragmentShader);
+ 
+ gl.linkProgram(program); 
```

æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯èƒ½æœ‰å‡ ä¸ªç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥åœ¨å‘å‡º draw è°ƒç”¨ä¹‹å‰å‘Šè¯‰ gpu æˆ‘ä»¬æƒ³è¦ä½¿ç”¨å“ªä¸ªç¨‹åº

ğŸ“„src/webgl-hello-world.js

```
 gl.attachShader(program, fragmentShader);

  gl.linkProgram(program);
+ 
+ gl.useProgram(program); 
```

å¥½äº†ï¼Œæˆ‘ä»¬å‡†å¤‡ç”»ç‚¹ä¸œè¥¿äº†

ğŸ“„src/webgl-hello-world.js

```
 gl.linkProgram(program);

  gl.useProgram(program);
+ 
+ gl.drawArrays(); 
```

WebGL å¯ä»¥å‘ˆç°å‡ ç§ç±»å‹çš„â€œå›¾å…ƒâ€

*   ç‚¹
*   çº¿
*   ä¸‰è§’å½¢çš„

æˆ‘ä»¬åº”è¯¥ä¼ é€’ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦å‘ˆç°çš„åŸå§‹ç±»å‹

ğŸ“„src/webgl-hello-world.js

```
 gl.useProgram(program);

- gl.drawArrays();
+ gl.drawArrays(gl.POINTS); 
```

æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å°†åŒ…å«å›¾å…ƒä½ç½®ä¿¡æ¯çš„è¾“å…¥æ•°æ®ä¼ é€’ç»™é¡¶ç‚¹ç€è‰²å™¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¼ é€’è¦æ¸²æŸ“çš„ç¬¬ä¸€ä¸ªå›¾å…ƒçš„ç´¢å¼•

ğŸ“„src/webgl-hello-world.js

```
 gl.useProgram(program);

- gl.drawArrays(gl.POINTS);
+ gl.drawArrays(gl.POINTS, 0); 
```

å’Œå›¾å…ƒè®¡æ•°

ğŸ“„src/webgl-hello-world.js

```
 gl.useProgram(program);

- gl.drawArrays(gl.POINTS, 0);
+ gl.drawArrays(gl.POINTS, 0, 1); 
```

æ— æ¸²æŸ“ğŸ˜¢
æ€ä¹ˆäº†ï¼Ÿ

å®é™…ä¸Šï¼Œä¸ºäº†æ¸²æŸ“ç‚¹ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­æŒ‡å®šç‚¹çš„å¤§å°

ğŸ“„src/webgl-hello-world.js

```
 const vShaderSource = `
  void main() {
+     gl_PointSize = 20.0;
      gl_Position = vec4(0, 0, 0, 1);
  }
  `; 
```

æƒŠå¹å£°ğŸ‰æˆ‘ä»¬è¯´å¾—æœ‰é“ç†ï¼

[![WebGL Point](../Images/f8045e8fe16752c2a12af4394bc25679.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--9bTiwkyg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://git-tutor-assets.s3.eu-west-2.amazonaws.com/webgl-point.png)

å› ä¸º`gl_Position`æ˜¯`vec4(0, 0, 0, 1)` = > `x == 0`å’Œ`y == 0`
WebGL åæ ‡ç³»ä¸`canvas2d`ä¸åŒï¼Œæ‰€ä»¥æ¸²æŸ“åœ¨ç”»å¸ƒä¸­å¤®

`canvas2d`

```
0.0
-----------------------â†’ width (px)
|
|
|
â†“
height (px) 
```

`webgl`

```
 (0, 1)
                      â†‘
                      |
                      |
                      |
(-1, 0) ------ (0, 0)-Â·---------> (1, 0)
                      |
                      |
                      |
                      |
                    (0, -1) 
```

ç°åœ¨è®©æˆ‘ä»¬ä» JS ä¸­ä¼ é€’ç‚¹åæ ‡ï¼Œè€Œä¸æ˜¯åœ¨ shader ä¸­ç¡¬ç¼–ç å®ƒ

é¡¶ç‚¹ç€è‰²å™¨çš„è¾“å…¥æ•°æ®è¢«ç§°ä¸º`attribute`
è®©æˆ‘ä»¬å®šä¹‰`position`å±æ€§

ğŸ“„src/webgl-hello-world.js

```
 const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);

  const vShaderSource = `
+ attribute vec2 position;
+ 
  void main() {
      gl_PointSize = 20.0;
-     gl_Position = vec4(0, 0, 0, 1); +     gl_Position = vec4(position.x, position.y, 0, 1);
  }
  `; 
```

ä¸ºäº†ç”¨æ•°æ®å¡«å……å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦è·å–å±æ€§ä½ç½®ã€‚å¯ä»¥æŠŠå®ƒçœ‹ä½œ javascript ä¸–ç•Œä¸­å±æ€§çš„å”¯ä¸€æ ‡è¯†ç¬¦

ğŸ“„src/webgl-hello-world.js

```
 gl.useProgram(program);

+ const positionPointer = gl.getAttribLocation(program, 'position');
+ 
  gl.drawArrays(gl.POINTS, 0, 1); 
```

GPU åªæ¥å—ç±»å‹åŒ–æ•°ç»„ä½œä¸ºè¾“å…¥ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª`Float32Array`ä½œä¸ºæŒ‡é’ˆä½ç½®çš„å­˜å‚¨

ğŸ“„src/webgl-hello-world.js

```
 const positionPointer = gl.getAttribLocation(program, 'position');

+ const positionData = new Float32Array([0, 0]);
+ 
  gl.drawArrays(gl.POINTS, 0, 1); 
```

ä½†æ˜¯è¿™ä¸ªæ•°ç»„ä¸èƒ½åŸæ ·ä¼ é€’ç»™ GPUï¼ŒGPU åº”è¯¥æœ‰è‡ªå·±çš„ç¼“å†²åŒºã€‚
åœ¨ GPU ä¸–ç•Œä¸­æœ‰ä¸åŒç§ç±»çš„â€œç¼“å†²åŒºâ€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦`ARRAY_BUFFER`

ğŸ“„src/webgl-hello-world.js

```
 const positionData = new Float32Array([0, 0]);

+ const positionBuffer = gl.createBuffer(gl.ARRAY_BUFFER);
+ 
  gl.drawArrays(gl.POINTS, 0, 1); 
```

è¦å¯¹ GPU ç¼“å†²åŒºè¿›è¡Œä»»ä½•æ›´æ”¹ï¼Œæˆ‘ä»¬éœ€è¦â€œç»‘å®šâ€å®ƒã€‚buffer ç»‘å®šåï¼Œä½œä¸ºâ€œå½“å‰â€å¤„ç†ï¼Œä»»ä½•ç¼“å†²åŒºä¿®æ”¹æ“ä½œéƒ½å°†åœ¨â€œå½“å‰â€ç¼“å†²åŒºä¸Šæ‰§è¡Œã€‚

ğŸ“„src/webgl-hello-world.js

```
 const positionBuffer = gl.createBuffer(gl.ARRAY_BUFFER);

+ gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
+ 
  gl.drawArrays(gl.POINTS, 0, 1); 
```

ä¸ºäº†ç”¨ä¸€äº›æ•°æ®å¡«å……ç¼“å†²åŒºï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨`bufferData`æ–¹æ³•

ğŸ“„src/webgl-hello-world.js

```
 const positionBuffer = gl.createBuffer(gl.ARRAY_BUFFER);

  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
+ gl.bufferData(gl.ARRAY_BUFFER, positionData); 
  gl.drawArrays(gl.POINTS, 0, 1); 
```

ä¸ºäº†ä¼˜åŒ– GPU ç«¯çš„ç¼“å†²åŒºæ“ä½œ(å†…å­˜ç®¡ç†)ï¼Œæˆ‘ä»¬åº”è¯¥å‘ GPU ä¼ é€’ä¸€ä¸ªâ€œæç¤ºâ€ï¼ŒæŒ‡ç¤ºå¦‚ä½•ä½¿ç”¨è¿™ä¸ªç¼“å†²åŒºã€‚[æœ‰å‡ ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨ç¼“å†²å™¨](https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/bufferData#Parameters)

*   `gl.STATIC_DRAW`:ç¼“å†²åŒºçš„å†…å®¹å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨ï¼Œä¸ä¼šç»å¸¸æ”¹å˜ã€‚å†…å®¹è¢«å†™å…¥ç¼“å†²åŒºï¼Œä½†ä¸è¢«è¯»å–ã€‚
*   `gl.DYNAMIC_DRAW`:ç¼“å†²åŒºçš„å†…å®¹å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨ï¼Œç»å¸¸æ”¹å˜ã€‚å†…å®¹è¢«å†™å…¥ç¼“å†²åŒºï¼Œä½†ä¸è¢«è¯»å–ã€‚
*   `gl.STREAM_DRAW`:ç¼“å†²åŒºçš„å†…å®¹å¯èƒ½ä¸ä¼šç»å¸¸ä½¿ç”¨ã€‚å†…å®¹è¢«å†™å…¥ç¼“å†²åŒºï¼Œä½†ä¸è¢«è¯»å–ã€‚

    ä½¿ç”¨ WebGL 2 ä¸Šä¸‹æ–‡æ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å€¼:

*   `gl.STATIC_READ`:ç¼“å†²åŒºçš„å†…å®¹å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨ï¼Œä¸ä¼šç»å¸¸æ”¹å˜ã€‚ä»ç¼“å†²åŒºè¯»å–å†…å®¹ï¼Œä½†ä¸å†™å…¥å†…å®¹ã€‚

*   `gl.DYNAMIC_READ`:ç¼“å†²åŒºçš„å†…å®¹å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨ï¼Œç»å¸¸æ”¹å˜ã€‚ä»ç¼“å†²åŒºè¯»å–å†…å®¹ï¼Œä½†ä¸å†™å…¥å†…å®¹ã€‚

*   `gl.STREAM_READ`:ç¼“å†²åŒºçš„å†…å®¹å¯èƒ½ä¸ä¼šç»å¸¸ä½¿ç”¨ã€‚ä»ç¼“å†²åŒºè¯»å–å†…å®¹ï¼Œä½†ä¸å†™å…¥å†…å®¹ã€‚

*   `gl.STATIC_COPY`:ç¼“å†²åŒºçš„å†…å®¹å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨ï¼Œä¸ä¼šç»å¸¸æ”¹å˜ã€‚ç”¨æˆ·æ—¢ä¸å†™ä¹Ÿä¸è¯»å†…å®¹ã€‚

*   `gl.DYNAMIC_COPY`:ç¼“å†²åŒºçš„å†…å®¹å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨ï¼Œç»å¸¸æ”¹å˜ã€‚ç”¨æˆ·æ—¢ä¸å†™ä¹Ÿä¸è¯»å†…å®¹ã€‚

*   `gl.STREAM_COPY`:ç¼“å†²åŒºçš„å†…å®¹å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨ï¼Œä¸ä¼šç»å¸¸æ”¹å˜ã€‚ç”¨æˆ·æ—¢ä¸å†™ä¹Ÿä¸è¯»å†…å®¹ã€‚

ğŸ“„src/webgl-hello-world.js

```
 const positionBuffer = gl.createBuffer(gl.ARRAY_BUFFER);

  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
- gl.bufferData(gl.ARRAY_BUFFER, positionData); + gl.bufferData(gl.ARRAY_BUFFER, positionData, gl.STATIC_DRAW); 
  gl.drawArrays(gl.POINTS, 0, 1); 
```

ç°åœ¨æˆ‘ä»¬éœ€è¦å‘Šè¯‰ GPU åº”è¯¥å¦‚ä½•ä»æˆ‘ä»¬çš„ç¼“å†²åŒºè¯»å–æ•°æ®

å¿…éœ€çš„ä¿¡æ¯:

å±æ€§å¤§å°(å¯¹äº`vec2`ä¸º 2ï¼Œå¯¹äº`vec3`ä¸º 3ï¼Œä»¥æ­¤ç±»æ¨)

ğŸ“„src/webgl-hello-world.js

```
 gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
  gl.bufferData(gl.ARRAY_BUFFER, positionData, gl.STATIC_DRAW);

+ const attributeSize = 2;
+ 
  gl.drawArrays(gl.POINTS, 0, 1); 
```

ç¼“å†²åŒºä¸­çš„æ•°æ®ç±»å‹

ğŸ“„src/webgl-hello-world.js

```
 gl.bufferData(gl.ARRAY_BUFFER, positionData, gl.STATIC_DRAW);

  const attributeSize = 2;
+ const type = gl.FLOAT; 
  gl.drawArrays(gl.POINTS, 0, 1); 
```

æ­£å¸¸åŒ–â€“æŒ‡ç¤ºæ•°æ®å€¼æ˜¯å¦åº”è¯¥è¢«é™åˆ¶åœ¨æŸä¸ªèŒƒå›´å†…

å¯¹äº`gl.BYTE`å’Œ`gl.SHORT`ï¼Œå¦‚æœä¸ºçœŸï¼Œåˆ™å°†å€¼ç®ä½åˆ°`[-1, 1]`

å¯¹äº`gl.UNSIGNED_BYTE`å’Œ`gl.UNSIGNED_SHORT`ï¼Œå¦‚æœä¸ºçœŸï¼Œåˆ™å°†å€¼ç®ä½åˆ°`[0, 1]`

å¯¹äºç±»å‹`gl.FLOAT`å’Œ`gl.HALF_FLOAT`ï¼Œè¯¥å‚æ•°æ²¡æœ‰å½±å“ã€‚

ğŸ“„src/webgl-hello-world.js

```
 const attributeSize = 2;
  const type = gl.FLOAT;
+ const nomralized = false; 
  gl.drawArrays(gl.POINTS, 0, 1); 
```

è¿™ä¸¤ä¸ªæˆ‘ä»¬ä»¥åå†è¯´ğŸ˜‰

ğŸ“„src/webgl-hello-world.js

```
 const attributeSize = 2;
  const type = gl.FLOAT;
  const nomralized = false;
+ const stride = 0;
+ const offset = 0; 
  gl.drawArrays(gl.POINTS, 0, 1); 
```

ç°åœ¨æˆ‘ä»¬éœ€è¦è°ƒç”¨`vertexAttribPointer`æ¥è®¾ç½®æˆ‘ä»¬çš„`position`å±æ€§

ğŸ“„src/webgl-hello-world.js

```
 const stride = 0;
  const offset = 0;

+ gl.vertexAttribPointer(positionPointer, attributeSize, type, nomralized, stride, offset);
+ 
  gl.drawArrays(gl.POINTS, 0, 1); 
```

è®©æˆ‘ä»¬è¯•ç€æ”¹å˜ç‚¹çš„ä½ç½®

ğŸ“„src/webgl-hello-world.js

```
 const positionPointer = gl.getAttribLocation(program, 'position');

- const positionData = new Float32Array([0, 0]);
+ const positionData = new Float32Array([1.0, 0.0]); 
  const positionBuffer = gl.createBuffer(gl.ARRAY_BUFFER); 
```

ä»€ä¹ˆéƒ½æ²¡å˜ğŸ˜¢ä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

åŸæ¥â€”â€”é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰å±æ€§éƒ½æ˜¯ç¦ç”¨çš„(ç”¨ 0 å¡«å……),æ‰€ä»¥æˆ‘ä»¬éœ€è¦`enable`æˆ‘ä»¬åœ¨å±æ€§ä¸­çš„ä½ç½®

ğŸ“„src/webgl-hello-world.js

```
 const stride = 0;
  const offset = 0;

+ gl.enableVertexAttribArray(positionPointer);
  gl.vertexAttribPointer(positionPointer, attributeSize, type, nomralized, stride, offset);

  gl.drawArrays(gl.POINTS, 0, 1); 
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥æ¸²æŸ“æ›´å¤šçš„ç‚¹ï¼è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç‚¹æ¥æ ‡è®°ç”»å¸ƒçš„æ¯ä¸€ä¸ªè§’è½

ğŸ“„src/webgl-hello-world.js

```
 const positionPointer = gl.getAttribLocation(program, 'position');

- const positionData = new Float32Array([1.0, 0.0]);
+ const positionData = new Float32Array([
+     -1.0, // point 1 x
+     -1.0, // point 1 y
+ 
+     1.0, // point 2 x
+     1.0, // point 2 y
+ 
+     -1.0, // point 3 x
+     1.0, // point 3 y
+ 
+     1.0, // point 4 x
+     -1.0, // point 4 y
+ ]); 
  const positionBuffer = gl.createBuffer(gl.ARRAY_BUFFER);

  gl.enableVertexAttribArray(positionPointer);
  gl.vertexAttribPointer(positionPointer, attributeSize, type, nomralized, stride, offset);

- gl.drawArrays(gl.POINTS, 0, 1);
+ gl.drawArrays(gl.POINTS, 0, positionData.length / 2); 
```

è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ç€è‰²å™¨

æˆ‘ä»¬ä¸ä¸€å®šéœ€è¦æ˜¾å¼åœ°å°†`position.x`å’Œ`position.y`ä¼ é€’ç»™`vec4`æ„é€ å‡½æ•°ï¼Œæœ‰ä¸€ä¸ª`vec4(vec2, float, float)`è¦†ç›–

ğŸ“„src/webgl-hello-world.js

```
 void main() {
      gl_PointSize = 20.0;
-     gl_Position = vec4(position.x, position.y, 0, 1); +     gl_Position = vec4(position, 0, 1);
  }
  `;

  const positionPointer = gl.getAttribLocation(program, 'position');

  const positionData = new Float32Array([
-     -1.0, // point 1 x
-     -1.0, // point 1 y +     -1.0, // top left x
+     -1.0, // top left y 
      1.0, // point 2 x
      1.0, // point 2 y 
```

ç°åœ¨è®©æˆ‘ä»¬é€šè¿‡å°†æ¯ä¸ªä½ç½®é™¤ä»¥ 2.0 æ¥ç§»åŠ¨æ‰€æœ‰ç‚¹æ›´é è¿‘ä¸­å¿ƒ

ğŸ“„src/webgl-hello-world.js

```
 void main() {
      gl_PointSize = 20.0;
-     gl_Position = vec4(position, 0, 1); +     gl_Position = vec4(position / 2.0, 0, 1);
  }
  `; 
```

ç»“æœ:

[![Result](../Images/4c01b6560f989f91c42fb1c0518e57df.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--3THZ6C5E--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://git-tutor-assets.s3.eu-west-2.amazonaws.com/4points.png)

### [](#conclusion)ç»“è®º

æˆ‘ä»¬ç°åœ¨å¯¹ GPU å’Œ WebGL çš„å·¥ä½œåŸç†æœ‰äº†æ›´å¥½çš„ç†è§£ï¼Œå¯ä»¥æ¸²æŸ“ä¸€äº›éå¸¸åŸºæœ¬çš„ä¸œè¥¿
æˆ‘ä»¬æ˜å¤©å°†æ¢ç´¢æ›´å¤šçš„åŸå§‹ç±»å‹ï¼

### [](#homework)ä½œä¸š

ç”¨ç‚¹
ç»˜åˆ¶ä¸€ä¸ª`Math.cos`å›¾æç¤º:ä½ æ‰€éœ€è¦çš„å°±æ˜¯ç”¨æœ‰æ•ˆå€¼å¡«å……`positionData`

* * *

[![GitHub stars](../Images/8a2abf4d98412e88024769cb04b37b79.png)](https://github.com/lesnitsky/webgl-month)
[![Twitter Follow](../Images/4f47dc9853f692fb8d8fa51375017962.png)T6ã€‘](https://twitter.com/lesnitsky_a)

[åŠ å…¥é‚®ä»¶åˆ—è¡¨](http://eepurl.com/gwiSeH),è®©æ–°é‚®ä»¶ç›´æ¥è¿›å…¥ä½ çš„æ”¶ä»¶ç®±

[æ­¤å¤„æä¾›æºä»£ç ](https://github.com/lesnitsky/webgl-month)

å»ºé€ äº

[![Git Tutor Logo](../Images/4a5fcbd1126401b65ca7fbe362404aa0.png)T2ã€‘](https://github.com/lesnitsky/git-tutor)