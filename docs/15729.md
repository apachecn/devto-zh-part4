# ä¸ºæ‚¨çš„æ¸è¿›å¼ Web åº”ç”¨ç¨‹åºè‡ªåŠ¨åŒ–ç¯å¡”å®¡è®¡

> åŸæ–‡ï¼š<https://dev.to/rishikc/automate-lighthouse-audits-for-your-progressive-web-application-3lfc>

æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå½“æˆ‘ä»¬å¼€å‘ web åº”ç”¨ç¨‹åºæ—¶ï¼Œæ¥è‡ª lighthouse å®¡è®¡çš„è§è§£æ˜¯å¤šä¹ˆé‡è¦å’Œæœ‰ç”¨ã€‚ä½†æˆ‘ä»¬å¤§å¤šæ•°äººæ£€æŸ¥çš„æ–¹å¼æ˜¯é€šè¿‡ Chrome devtools æˆ– lighthouse æ‰©å±•æ‰‹åŠ¨è¿›è¡Œï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸æ˜¯å¾ˆæœ‰æˆæ•ˆã€‚

å¯¹äºæˆ‘ä»¬è¿™äº›ä¸çŸ¥é“çš„äººæ¥è¯´ï¼Œä½¿ç”¨ lighthouse å®¡è®¡æˆ‘ä»¬çš„ web åº”ç”¨ç¨‹åºä¸»è¦æœ‰å››ç§æ–¹å¼:

*   Chrome å¼€å‘å·¥å…·

*   å‘½ä»¤è¡Œ

*   NPM æ¨¡å—(æˆ‘ä»¬ä¸€ä¼šå„¿ä¼šç”¨åˆ°)

*   [é¡µé¢é€Ÿåº¦æ´å¯Ÿ](https://developers.google.com/speed/pagespeed/insights/)

å‡ºäºä»¥ç¼–ç¨‹æ–¹å¼æ‰§è¡Œ lighthouse å®¡è®¡çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [lighthouse npm åŒ…](https://www.npmjs.com/package/lighthouse)ã€ [mocha](https://mochajs.org/) å’Œ [chai](https://www.chaijs.com) æ¥ç¼–å†™æˆ‘ä»¬çš„æµ‹è¯•ï¼Œä½¿ç”¨ [chrome-launcher](https://www.npmjs.com/package/chrome-launcher) æ¥è¿è¡Œæˆ‘ä»¬çš„ lighthouse æµ‹è¯•ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°†ä¸Šé¢çš„åŒ…ä½œä¸ºå¼€å‘ä¾èµ–é¡¹å®‰è£…åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­:

```
npm install lighthouse chrome-launcher chai mocha --save-dev 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„`tests`ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`lighthouse.tests.js`çš„æ–‡ä»¶ã€‚æˆ‘ä»¬å°†é€šè¿‡è¿™ä¸ªæ–‡ä»¶è¿è¡Œæˆ‘ä»¬çš„ç¯å¡”å®¡è®¡ã€‚
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å¯¼å…¥ lighthouse æ¨¡å—å’Œ chrome å¯åŠ¨å™¨â€”â€”è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»æœ¬åœ°å¼€å‘æœåŠ¡å™¨æ‰“å¼€æˆ‘ä»¬çš„ç½‘é¡µï¼Œå¹¶è¿è¡Œå®¡è®¡æ¥æµ‹è¯•æˆ‘ä»¬å¸Œæœ› lighthouse å¾—åˆ†è¾¾åˆ°çš„æœ€ä½é˜ˆå€¼ã€‚

è™½ç„¶è¿™å¬èµ·æ¥æœ‰å¾ˆå¤šäº‹æƒ…è¦åšï¼Œä½†å…¶å®å¹¶ä¸å¤šã€‚ä¸‹é¢æ˜¯å®ƒåœ¨å®é™…ä»£ç ä¸­çš„æ ·å­:

```
const lighthouse = require("lighthouse");
const chromeLauncher = require("chrome-launcher");

function launchChromeAndRunLighthouse(url, opts, conf = null) {
  return chromeLauncher
    .launch({ chromeFlags: opts.chromeFlags })
    .then(chrome => {
      opts.port = chrome.port;
      return lighthouse(url, opts, conf).then(res =>
        chrome.kill().then(() => res.lhr)
      );
    });
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±è¿™ä¹ˆç®€å•ã€‚æˆ‘ä»¬ç”¨`chromeLauncher.launch`æ–¹æ³•å¯åŠ¨ chrome æµè§ˆå™¨å®ä¾‹ï¼Œç„¶åç”¨ç«™ç‚¹ url å’Œå®¡è®¡é…ç½®è¿è¡Œ lighthouse æµ‹è¯•ã€‚å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å…³é—­/ç»ˆæ­¢ chrome å®ä¾‹å¹¶è¿”å›ç»“æœã€‚è¿™æ˜¯å®ƒåœ¨ä½¿ç”¨æ—¶çš„æ ·å­:

```
launchChromeAndRunLighthouse(testUrl, opts, config).then(res => {
  // Results are available in `res`
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªè°ƒç”¨æ”¾åœ¨æˆ‘ä»¬çš„`before`é’©å­ä¸­è¿›è¡Œæµ‹è¯•ï¼Œç„¶åå¯¹æ¯ä¸ªæŒ‡æ ‡è¿›è¡Œæµ‹è¯•ï¼Œå°±åƒè¿™æ ·:

```
describe("Lighthouse Audits", function() {
  // Timeout doesn't need to be same. It can be more or less depending on your project.
  this.timeout(50000);
  let results;
  before("run test", done => {
    launchChromeAndRunLighthouse(testUrl, opts, config).then(res => {
      // Extract the results you need for your assertions.
      done();
    });
  });
  it("performance test", done => {
    // test your performance score against the threshold
    done();
  });
  // Some more tests..
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

çœ‹èµ·æ¥è¿˜æ˜¯æ€ªæ€ªçš„ï¼Ÿæ”¾å¿ƒå§ï¼æ£€æŸ¥è¿™ä¸ªå­˜å‚¨åº“ï¼Œä¾‹å¦‚ç”¨ mocha è®¾ç½® [lighthouse æµ‹è¯•ï¼Œå¹¶åœ¨æ‚¨çš„ web åº”ç”¨ç¨‹åºä¸­è¿›è¡Œå°è¯•ï¼](https://github.com/rishichawda/lighthouse-mocha-example)

*(å¯ä»¥é€šè¿‡[è¿™ä¸ªé“¾æ¥](https://github.com/GoogleChrome/lighthouse#related-projects)æ‰¾åˆ°ç›¸å…³é¡¹ç›®åˆ—è¡¨ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå¸¦æœ‰ jest çš„ä¾‹å­)*

è¿™ç§æ–¹æ³•å¯ä»¥åº”ç”¨äºæŒç»­é›†æˆ/éƒ¨ç½²ç¯å¢ƒä¸­çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå› æ­¤æ‚¨ä¸å¿…æ‹…å¿ƒæ‰‹åŠ¨å®¡è®¡æ‚¨çš„ web åº”ç”¨ç¨‹åºå¹¶æ£€æŸ¥å®ƒæ˜¯å¦æ»¡è¶³æœ€ä½çš„æ»¡æ„æ°´å¹³ã€‚

æ‰€ä»¥ä½ èµ°å§ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºæ¸è¿›å¼ web åº”ç”¨ç¨‹åºè‡ªåŠ¨å®¡è®¡ç¯å¡”æ‰€è¦åšçš„ä¸€åˆ‡ï¼Œä»¥ç¡®ä¿å®ƒä»¬å§‹ç»ˆå€¼å¾—äº’è”ç½‘å’Œç”¨æˆ·çš„æ•°æ®åŒ…ä½¿ç”¨ï¼

[![worthy](img/9ce94423d84d32463d55181a3fd02bc2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--zPpPWJI9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://i.imgur.com/bTB3UGn.gif)

*æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼*ğŸ˜„

ä½ ä¹Ÿå¯ä»¥é€šè¿‡ [Twitter](https://twitter.com/rishiikc) å’Œæˆ‘è”ç³»ã€‚

é»‘å®¢å¿«ä¹ï¼å¹²æ¯ï¼ğŸ‰