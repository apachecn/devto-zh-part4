# å¦‚ä½•ç”¨ Ansible è¯»å–å¤–éƒ¨æ–‡ä»¶çš„å†…å®¹

> åŸæ–‡:[https://dev . to/mayeu/how-to-read-of-a-external-file-content-with-ansi ble-l7h](https://dev.to/mayeu/how-to-read-the-content-of-an-external-file-with-ansible-l7h)

æ‚¨å¸Œæœ›å°† JSON æ•°æ®ä»ä¸€ä¸ªæ–‡ä»¶ç›´æ¥åŠ è½½åˆ°æ‚¨çš„ Ansible å‰§æœ¬ã€ä»»åŠ¡æˆ–è§’è‰²ä¸­å—ï¼Ÿä½ æ˜¯å¦å¼€å§‹å°è¯•é€šè¿‡`shell`æˆ–å‘½ä»¤`module`æ¥è¯»å–å®ƒï¼Œå¹¶æƒ³çŸ¥é“æ˜¯å¦æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Ÿå—¯ï¼Œæœ‰ï¼Œå½¢å¼ä¸Šè¿˜æ˜¯`lookup`å¤–æŒ‚ã€‚è¯·ç»§ç»­é˜…è¯»ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨å®ƒã€‚

Ansible é™„å¸¦äº†ä¸€å¤§å †[æŸ¥æ‰¾æ’ä»¶](https://docs.ansible.com/ansible/latest/plugins/lookup.html#plugin-list)ï¼Œå…è®¸ä»ä½ çš„æ¸¸æˆä¹‹å¤–åŠ è½½å†…å®¹ã€‚æˆ‘ä»¬ä»Šå¤©æ„Ÿå…´è¶£çš„æ˜¯`file` [ä¸€](https://docs.ansible.com/ansible/latest/plugins/lookup/file.html)ã€‚é‚£ä¹ˆï¼Œæˆ‘å¦‚ä½•ç”¨è¿™ä¸ªåŠ è½½æˆ‘çš„æ–‡ä»¶å†…å®¹å‘¢ï¼Ÿ

å¾ˆç®€å•:

```
vars:
  file_contents: "{{lookup('file',  'path/to/file.json')}}" 
```

ç„¶åå˜­ï¼Œä½ å°±æœ‰äº†`file_contents`å˜é‡ä¸­çš„å†…å®¹ï¼

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æ­£åœ¨è°ƒç”¨`lookup()`å‡½æ•°ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨çš„æ’ä»¶æœ‰ç¬¬ä¸€ä¸ªå‚æ•°(åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯`file`)ï¼Œç„¶åæ˜¯æ–‡ä»¶çš„è·¯å¾„ã€‚å°±è¿™æ ·ï¼Œæˆ‘ä»¬åŠ è½½äº†æ–‡ä»¶å†…å®¹ï¼

**æ³¨æ„ï¼Œè¯¥æ–‡ä»¶å¿…é¡»åœ¨æ‚¨è´Ÿè´£çš„æ§åˆ¶å™¨**ä¸Š(å³:æ‚¨è¿è¡Œ`ansible`å‘½ä»¤çš„è®¡ç®—æœº)ã€‚

ä½ å¯ä»¥åœ¨ä»»ä½•æ¨¡å—ä¸­ç›´æ¥ä½¿ç”¨å®ƒï¼Œè€Œä¸éœ€è¦ä¸­é—´å˜é‡:

```
- name: Read the content of a file instead of copying it directly
  copy:
    content: "{{lookup('file',  'path/to/file.json')}}"
    dest: /etc/config/file.json 
```

ç§ğŸ™‚

*æœ¬å¸–åŸè½½äºæˆ‘çš„ç½‘ç«™: [mayeu.me](https://mayeu.me/post/how-to-read-the-content-of-an-external-file-with-ansible/) ã€‚*