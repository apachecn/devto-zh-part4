# ç”¨ Rust æ„å»ºå¼ºå¤§çš„ GraphQL æœåŠ¡å™¨

> åŸæ–‡ï¼š<https://dev.to/open-graphql/building-powerful-graphql-servers-with-rust-3gla>

*æ¯”å°”Â·ç‰›æ´¥åœ¨ Unsplash ä¸Šæ‹æ‘„çš„ç…§ç‰‡*

ç”¨ Rustã€Juniperã€Diesel å’Œ Actix è®¾ç½® GraphQL æœåŠ¡å™¨ï¼›äº†è§£ Rust çš„ web æ¡†æ¶å’Œå¼ºå¤§çš„å®ã€‚

æºä»£ç :[github.com/iwilsonq/rust-graphql-example](https://github.com/iwilsonq/rust-graphql-example)

é€šè¿‡ GraphQL æœåŠ¡åº”ç”¨ç¨‹åºæ­£è¿…é€Ÿæˆä¸ºå‘å®¢æˆ·äº¤ä»˜æ•°æ®çš„æœ€ç®€å•ã€æœ€æœ‰æ•ˆçš„æ–¹å¼ã€‚æ— è®ºæ‚¨æ˜¯åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè¿˜æ˜¯åœ¨æµè§ˆå™¨ä¸Šï¼Œå®ƒéƒ½ä¼šæä¾›æ‰€éœ€çš„æ•°æ®ï¼Œä»…æ­¤è€Œå·²ã€‚

å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸å†éœ€è¦å°†æ¥è‡ªä¸åŒæ•°æ®æºçš„ä¿¡æ¯æ‹¼æ¥åœ¨ä¸€èµ·ã€‚GraphQL æœåŠ¡å™¨è´Ÿè´£é›†æˆï¼Œæ¶ˆé™¤äº†å¯¹è¿‡é‡æ•°æ®å’Œå¾€è¿”æ•°æ®è¯·æ±‚çš„éœ€è¦ã€‚

å½“ç„¶ï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨å¿…é¡»å¤„ç†æ¥è‡ªä¸åŒæ¥æºçš„èšåˆæ•°æ®ï¼Œæ¯”å¦‚è‡ªæœ‰åç«¯æœåŠ¡ã€æ•°æ®åº“æˆ–ç¬¬ä¸‰æ–¹ APIã€‚è¿™å¯èƒ½æ˜¯èµ„æºå¯†é›†å‹çš„ï¼Œæˆ‘ä»¬å¦‚ä½•ä¼˜åŒ– CPU æ—¶é—´ï¼Ÿ

Rust æ˜¯ä¸€ç§è¯­è¨€çš„å¥‡è¿¹ï¼Œå®ƒå°† C ç­‰ä½çº§è¯­è¨€çš„åŸå§‹æ€§èƒ½ä¸ç°ä»£è¯­è¨€çš„è¡¨ç°åŠ›ç»“åˆåœ¨ä¸€èµ·ã€‚å®ƒå¼ºè°ƒç±»å‹å’Œå†…å­˜å®‰å…¨ï¼Œå°¤å…¶æ˜¯å½“å¹¶å‘æ“ä½œä¸­å­˜åœ¨æ½œåœ¨çš„æ•°æ®ç«äº‰æ—¶ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ç”¨ Rust æ„å»ºä¸€ä¸ª GraphQL æœåŠ¡å™¨éœ€è¦ä»€ä¹ˆã€‚æˆ‘ä»¬å°†äº†è§£

*   Juniper GraphQL æœåŠ¡å™¨
*   ä¸ Juniper é›†æˆçš„ Actix web æ¡†æ¶
*   diesel ç”¨äºæŸ¥è¯¢ sql æ•°æ®åº“
*   ä½¿ç”¨è¿™äº›åº“çš„æœ‰ç”¨çš„ Rust å®å’Œæ´¾ç”Ÿç‰¹å¾

> è¯·æ³¨æ„ï¼Œæˆ‘ä¸ä¼šå»è¯¦ç»†è¯´æ˜å®‰è£…ç”Ÿé”ˆæˆ–è´§ç‰©ã€‚æœ¬æ–‡å‡è®¾äº† Rust å·¥å…·é“¾çš„ä¸€äº›åˆæ­¥çŸ¥è¯†ã€‚

## è®¾ç½® HTTP æœåŠ¡å™¨

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç”¨`cargo`åˆå§‹åŒ–æˆ‘ä»¬çš„é¡¹ç›®ï¼Œç„¶åå®‰è£…ä¾èµ–é¡¹ã€‚

```
 cargo new rust-graphql-example
    cd rust-graphql-example 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åˆå§‹åŒ–å‘½ä»¤å¼•å¯¼æˆ‘ä»¬çš„ Cargo.toml æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æˆ‘ä»¬çš„é¡¹ç›®ä¾èµ–é¡¹ä»¥åŠä¸€ä¸ª [main.rs](http://main.rs) æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªç®€å•çš„â€œHello Worldâ€ç¤ºä¾‹ã€‚

```
 // main.rs

    fn main() {
      println!("Hello, world!");
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½œä¸ºå¥å…¨æ€§æ£€æŸ¥ï¼Œå¯ä»¥éšæ„è¿è¡Œ`cargo run`æ¥æ‰§è¡Œç¨‹åºã€‚

åœ¨ Rust ä¸­å®‰è£…å¿…è¦çš„åº“æ„å‘³ç€æ·»åŠ ä¸€è¡ŒåŒ…å«åº“åå’Œç‰ˆæœ¬å·çš„ä»£ç ã€‚è®©æˆ‘ä»¬åƒè¿™æ ·æ›´æ–° Cargo.toml çš„ä¾èµ–é¡¹éƒ¨åˆ†:

```
 # Cargo.toml

    [dependencies]
    actix-web = "1.0.0"
    diesel = { version = "1.0.0", features = ["postgres"] }
    dotenv = "0.9.0"
    env_logger = "0.6"
    futures = "0.1"
    juniper = "0.13.1"
    serde = "1.0"
    serde_derive = "1.0"
    serde_json = "1.0" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ [Juniper](https://github.com/graphql-rust/juniper) ä½œä¸º GraphQL åº“ï¼Œä½¿ç”¨ [Actix](https://actix.rs/) ä½œä¸ºåº•å±‚ HTTP æœåŠ¡å™¨æ¥å®ç° GraphQL æœåŠ¡å™¨ã€‚Actix æœ‰ä¸€ä¸ªéå¸¸å¥½çš„ APIï¼Œä¸ Rust çš„ç¨³å®šç‰ˆæœ¬é…åˆå¾—å¾ˆå¥½ã€‚

æ·»åŠ è¿™äº›è¡Œåï¼Œä¸‹æ¬¡é¡¹ç›®ç¼–è¯‘æ—¶å°†åŒ…å«è¿™äº›åº“ã€‚åœ¨æˆ‘ä»¬ç¼–è¯‘ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç”¨ä¸€ä¸ªåŸºæœ¬çš„ HTTP æœåŠ¡å™¨æ›´æ–° main.rsï¼Œå¤„ç†ç´¢å¼•è·¯ç”±ã€‚

```
 // main.rs
    use std::io;

    use actix_web::{web, App, HttpResponse, HttpServer, Responder};

    fn main() -> io::Result<()> {
        HttpServer::new(|| {
            App::new()
                .route("/", web::get().to(index))
        })
        .bind("localhost:8080")?
        .run()
    }

    fn index() -> impl Responder {
        HttpResponse::Ok().body("Hello world!")
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é¡¶éƒ¨çš„å‰ä¸¤è¡Œå°†æˆ‘ä»¬éœ€è¦çš„æ¨¡å—çº³å…¥èŒƒå›´ã€‚è¿™é‡Œçš„ main å‡½æ•°è¿”å›ä¸€ä¸ª`io::Result`ç±»å‹ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨é—®å·ä½œä¸ºå¤„ç†ç»“æœçš„ç®€å†™ã€‚

æœåŠ¡å™¨çš„è·¯ç”±å’Œé…ç½®æ˜¯åœ¨`App`çš„å®ä¾‹ä¸­åˆ›å»ºçš„ï¼Œè¯¥å®ä¾‹æ˜¯åœ¨ HTTP æœåŠ¡å™¨çš„æ„é€ å‡½æ•°æä¾›çš„é—­åŒ…ä¸­åˆ›å»ºçš„ã€‚

è·¯ç”±æœ¬èº«ç”± index å‡½æ•°å¤„ç†ï¼Œå…¶åç§°æ˜¯ä»»æ„çš„ã€‚åªè¦è¿™ä¸ªå‡½æ•°æ­£ç¡®åœ°å®ç°äº†`Responder`,å®ƒå°±å¯ä»¥ç”¨ä½œç´¢å¼•è·¯å¾„ä¸Š GET è¯·æ±‚çš„å‚æ•°ã€‚

å¦‚æœæˆ‘ä»¬æ­£åœ¨ç¼–å†™ REST APIï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤šçš„è·¯ç”±å’Œç›¸å…³çš„å¤„ç†ç¨‹åºã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°ï¼Œæˆ‘ä»¬æ­£åœ¨ç”¨ä¸€ä¸ªè·¯ç”±å¤„ç†ç¨‹åºåˆ—è¡¨æ¥äº¤æ¢å¯¹è±¡åŠå…¶å…³ç³»ã€‚

ç°åœ¨æˆ‘ä»¬å°†ä»‹ç» GraphQL åº“ã€‚

## åˆ›å»º GraphQL æ¨¡å¼

æ¯ä¸ª GraphQL æ¨¡å¼çš„æ ¹æ˜¯ä¸€ä¸ªæ ¹æŸ¥è¯¢ã€‚ä»è¿™ä¸ªæ ¹ç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢å¯¹è±¡åˆ—è¡¨ã€ç‰¹å®šå¯¹è±¡ä»¥åŠå®ƒä»¬å¯èƒ½åŒ…å«çš„ä»»ä½•å­—æ®µã€‚

ç§°ä¹‹ä¸º QueryRootï¼Œæˆ‘ä»¬å°†åœ¨ä»£ç ä¸­ç”¨ç›¸åŒçš„åç§°è¡¨ç¤ºå®ƒã€‚ç”±äºæˆ‘ä»¬ä¸æ‰“ç®—å»ºç«‹ä¸€ä¸ªæ•°æ®åº“æˆ–ä»»ä½•ç¬¬ä¸‰æ–¹ APIï¼Œæˆ‘ä»¬å°†å¯¹è¿™é‡Œçš„å°‘é‡æ•°æ®è¿›è¡Œç¡¬ç¼–ç ã€‚

ä¸ºäº†ç»™è¿™ä¸ªä¾‹å­å¢åŠ ä¸€ç‚¹è‰²å½©ï¼Œæ¨¡å¼å°†æè¿°ä¸€ä¸ªæˆå‘˜çš„ä¸€èˆ¬åˆ—è¡¨ã€‚

åœ¨ src ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ªåä¸º graphql_schema.rs çš„æ–°æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹:

```
 // graphql_schema.rs
    use juniper::{EmptyMutation, RootNode};

    struct Member {
      id: i32,
      name: String,
    }

    #[juniper::object(description = "A member of a team")]
    impl Member {
      pub fn id(&self) -> i32 {
        self.id  
      }

      pub fn name(&self) -> &str {
        self.name.as_str()
      }
    }

    pub struct QueryRoot;

    #[juniper::object]
    impl QueryRoot {
      fn members() -> Vec<Member> {
        vec![
          Member {
            id: 1,
            name: "Link".to_owned(),
          },
          Member {
            id: 2,
            name: "Mario".to_owned(),
          }
        ]
      }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

éšç€æˆ‘ä»¬çš„å¯¼å…¥ï¼Œæˆ‘ä»¬å®šä¹‰äº†è¿™ä¸ªé¡¹ç›®ä¸­çš„ç¬¬ä¸€ä¸ª GraphQL å¯¹è±¡ï¼Œå³æˆå‘˜ã€‚ä»–ä»¬æ˜¯ç®€å•çš„ç”Ÿç‰©ï¼Œæœ‰èº«ä»½å’Œåå­—ã€‚æˆ‘ä»¬ç¨åä¼šè€ƒè™‘æ›´å¤æ‚çš„å­—æ®µå’Œæ¨¡å¼ã€‚

åœ¨å°†`QueryRoot`ç±»å‹ä½œä¸ºå•å…ƒç»“æ„å‰”é™¤ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹å®šä¹‰å­—æ®µæœ¬èº«ã€‚Juniper å…¬å¼€äº†ä¸€ä¸ªåä¸º`object`çš„ Rust å®ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨æ•´ä¸ªæ¨¡å¼çš„ä¸åŒèŠ‚ç‚¹ä¸Šå®šä¹‰å­—æ®µã€‚ç›®å‰ï¼Œæˆ‘ä»¬åªæœ‰ QueryRoot èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åœ¨å…¶ä¸Šå…¬å¼€ä¸€ä¸ªåä¸º members çš„å­—æ®µã€‚

ä¸æ ‡å‡†å‡½æ•°ç›¸æ¯”ï¼ŒRust å®é€šå¸¸å…·æœ‰ä¸å¯»å¸¸çš„è¯­æ³•ã€‚å®ƒä»¬ä¸ä»…ä»…æ¥å—ä¸€äº›å‚æ•°å¹¶äº§ç”Ÿä¸€ä¸ªç»“æœï¼Œå®ƒä»¬åœ¨ç¼–è¯‘æ—¶æ‰©å±•æˆæ›´å¤æ‚çš„ä»£ç ã€‚

## æš´éœ²æ¨¡å¼

åœ¨åˆ›å»º members å­—æ®µçš„å®è°ƒç”¨ä¸‹é¢ï¼Œæˆ‘ä»¬å°†å®šä¹‰åœ¨æ¨¡å¼ä¸­å…¬å¼€çš„`RootNode`ç±»å‹ã€‚

```
 // graphql_schema.rs

    pub type Schema = RootNode<'static, QueryRoot, EmptyMutation<()>>;

    pub fn create_schema() -> Schema {
      Schema::new(QueryRoot {}, EmptyMutation::new())
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç”±äº Rust ä¸­çš„å¼ºç±»å‹ï¼Œæˆ‘ä»¬è¢«è¿«æä¾›çªå˜å¯¹è±¡å‚æ•°ã€‚Juniper ä¸ºè¿™ç§æƒ…å†µå…¬å¼€äº†ä¸€ä¸ª`EmptyMutation`ç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªåªè¯»æ¨¡å¼æ—¶ã€‚

æ—¢ç„¶æ¨¡å¼å·²ç»å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ main.rs ä¸­æ›´æ–°æˆ‘ä»¬çš„æœåŠ¡å™¨æ¥å¤„ç†â€œ/graphqlâ€è·¯ç”±ã€‚ç”±äºæ‹¥æœ‰ä¸€ä¸ªæ¸¸ä¹åœºä¹Ÿå¾ˆå¥½ï¼Œæˆ‘ä»¬å°†ä¸º GraphQL æ·»åŠ ä¸€æ¡è·¯çº¿ï¼Œå³äº¤äº’å¼ graph QL æ¸¸ä¹åœºã€‚

```
 // main.rs
    #[macro_use]
    extern crate juniper;

    use std::io;
    use std::sync::Arc;

    use actix_web::{web, App, Error, HttpResponse, HttpServer};
    use futures::future::Future;
    use juniper::http::graphiql::graphiql_source;
    use juniper::http::GraphQLRequest;

    mod graphql_schema;

    use crate::graphql_schema::{create_schema, Schema};

    fn main() -> io::Result<()> {
        let schema = std::sync::Arc::new(create_schema());
        HttpServer::new(move || {
            App::new()
                .data(schema.clone())
                .service(web::resource("/graphql").route(web::post().to_async(graphql)))
                .service(web::resource("/graphiql").route(web::get().to(graphiql)))
        })
        .bind("localhost:8080")?
        .run()
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨ä¼šæ³¨æ„åˆ°æˆ‘å·²ç»æŒ‡å®šäº†ä¸€äº›æˆ‘ä»¬å°†ä½¿ç”¨çš„å¯¼å…¥ï¼ŒåŒ…æ‹¬æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„æ¨¡å¼ã€‚å¦è¯·å‚è§:

*   æˆ‘ä»¬åœ¨ä¸€ä¸ªå¼§å†…è°ƒç”¨`create_schema`(åŸå­å¼•ç”¨è®¡æ•°)ï¼Œä»¥å…è®¸çº¿ç¨‹é—´å…±äº«ä¸å¯å˜çŠ¶æ€(ç”¨ğŸ”¥è¿™é‡Œæˆ‘çŸ¥é“)
*   æˆ‘ä»¬åœ¨ HttpServer::new å†…éƒ¨ç”¨ **move** æ ‡è®°é—­åŒ…ï¼Œè¡¨æ˜é—­åŒ…å–å¾—äº†å†…éƒ¨å˜é‡çš„æ‰€æœ‰æƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒè·å¾—äº†`schema`çš„ä¸€ä¸ªå‰¯æœ¬
*   `schema`è¢«ä¼ é€’ç»™`data`æ–¹æ³•ï¼Œè¡¨æ˜å®ƒå°†ä½œä¸ºä¸¤ä¸ªæœåŠ¡ä¹‹é—´çš„å…±äº«çŠ¶æ€åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨ä½¿ç”¨

æˆ‘ä»¬ç°åœ¨å¿…é¡»å®ç°è¿™ä¸¤ä¸ªæœåŠ¡çš„å¤„ç†ç¨‹åºã€‚ä»â€œ/graphqlâ€è·¯å¾„å¼€å§‹:

```
 // main.rs

    // fn main() ...

    fn graphql(
        st: web::Data<Arc<Schema>>,
        data: web::Json<GraphQLRequest>,
    ) -> impl Future<Item = HttpResponse, Error = Error> {
        web::block(move || {
            let res = data.execute(&st, &());
            Ok::<_, serde_json::error::Error>(serde_json::to_string(&res)?)
        })
        .map_err(Error::from)
        .and_then(|user| {
            Ok(HttpResponse::Ok()
                .content_type("application/json")
                .body(user))
        })
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

â€œ/graphqlâ€è·¯ç”±çš„å®ç°ä»åº”ç”¨ç¨‹åºçŠ¶æ€å¯¹æˆ‘ä»¬çš„æ¨¡å¼æ‰§è¡Œ graphql è¯·æ±‚ã€‚è¿™æ˜¯é€šè¿‡ä»`web::block`åˆ›å»ºä¸€ä¸ª**æœªæ¥**å¹¶é“¾æ¥æˆåŠŸå’Œé”™è¯¯çŠ¶æ€çš„å¤„ç†ç¨‹åºæ¥å®ç°çš„ã€‚

æœŸè´§ç±»ä¼¼äº JavaScript ä¸­çš„æ‰¿è¯ºï¼Œè¿™è¶³ä»¥ç†è§£è¿™æ®µä»£ç ç‰‡æ®µã€‚ä¸ºäº†æ›´å¥½åœ°è§£é‡Š Rust çš„æœªæ¥ï¼Œæˆ‘æ¨èä¹”Â·æ°å…‹é€Šçš„è¿™ç¯‡æ–‡ç« ã€‚

ä¸ºäº†æµ‹è¯•æˆ‘ä»¬çš„ GraphQL æ¨¡å¼ï¼Œæˆ‘ä»¬è¿˜å°†ä¸ºâ€œ/graph QLâ€æ·»åŠ ä¸€ä¸ªå¤„ç†ç¨‹åºã€‚

```
 // main.rs

    // fn graphql() ...

    fn graphiql() -> HttpResponse {
        let html = graphiql_source("http://localhost:8080/graphql");
        HttpResponse::Ok()
            .content_type("text/html; charset=utf-8")
            .body(html)
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªå¤„ç†ç¨‹åºè¦ç®€å•å¾—å¤šï¼Œå®ƒä»…ä»…è¿”å› GraphiQL äº¤äº’å¼è¿åŠ¨åœºçš„ htmlã€‚æˆ‘ä»¬åªéœ€è¦æŒ‡å®šå“ªä¸ªè·¯å¾„æœåŠ¡äºæˆ‘ä»¬çš„ GraphQL æ¨¡å¼ï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯â€œ/graphqlâ€ã€‚

ä½¿ç”¨`cargo run`å¹¶å¯¼èˆªåˆ°[http://localhost:8080/graphiql](http://localhost:8080/graphiql)ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æˆ‘ä»¬é…ç½®çš„å­—æ®µã€‚

[![Members query in graphiql](img/dd08a0e3d9039113cf5d30f50a49c5df.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--26HdPS0g--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/t22qyi7xarthf9xm2yvl.png)

è¿™çœ‹èµ·æ¥ç¡®å®æ¯”ç”¨ [Node.js å’Œ Apollo](https://www.freecodecamp.org/news/learn-to-build-a-graphql-server-with-minimal-effort-fc7fcabe8ebd/) å»ºç«‹ä¸€ä¸ª GraphQL æœåŠ¡å™¨éœ€è¦æ›´å¤šçš„åŠªåŠ›ï¼Œä½†æ˜¯ Rust çš„é™æ€ç±»å‹å’Œå®ƒä»¤äººéš¾ä»¥ç½®ä¿¡çš„æ€§èƒ½ä½¿å®ƒæˆä¸ºä¸€ä¸ªå€¼å¾—çš„äº¤æ˜“â€”â€”å¦‚æœä½ æ„¿æ„åŠªåŠ›çš„è¯ã€‚

## ä¸ºçœŸå®æ•°æ®è®¾ç½® Postgres

å¦‚æœæˆ‘å°±æ­¤æ‰“ä½ï¼Œæˆ‘ç”šè‡³æ— æ³•å…¬æ­£åœ°çœ‹å¾…æ–‡ä»¶ä¸­çš„ä¾‹å­ã€‚æˆ‘åœ¨å¼€å‘æ—¶é—´ä¸ºè‡ªå·±å†™çš„ä¸¤ä¸ªæˆå‘˜*çš„é™æ€åˆ—è¡¨ä¸ä¼šå‡ºç°åœ¨æœ¬å‡ºç‰ˆç‰©ä¸­ã€‚*

å®‰è£… Postgres å’Œå»ºç«‹è‡ªå·±çš„æ•°æ®åº“å±äºå¦ä¸€ç¯‡æ–‡ç« ï¼Œä½†æ˜¯æˆ‘å°†ä»‹ç»å¦‚ä½•å®‰è£… [diesel](http://diesel.rs) ï¼Œè¿™æ˜¯ç”¨äºå¤„ç† SQL æ•°æ®åº“çš„æµè¡Œ Rust åº“ã€‚

> [ç‚¹å‡»è¿™é‡Œåœ¨ä½ çš„æœºå™¨ä¸Šå®‰è£… Postgresã€‘ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ï¼Œå¦‚ MySQLï¼Œä»¥é˜²ä½ å¯¹å®ƒæ›´ç†Ÿæ‚‰ã€‚](https://www.postgresql.org/download/)

diesel CLI å°†å¼•å¯¼æˆ‘ä»¬åˆå§‹åŒ–æˆ‘ä»¬çš„è¡¨ã€‚æ¥è£…å§:

```
 cargo install diesel_cli --no-default-features --features postgres 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¹‹åï¼Œæˆ‘ä»¬å°†åœ¨å·¥ä½œç›®å½•ä¸­æ·»åŠ ä¸€ä¸ª. env æ–‡ä»¶çš„è¿æ¥ URL:

```
 echo DATABASE_URL=postgres://localhost/rust_graphql_example > .env 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦æœ‰äº†ï¼Œä½ å°±å¯ä»¥è¿è¡Œ:

```
 diesel setup

    # followed by

    diesel migration generate create_members 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæ‚¨çš„ç›®å½•ä¸­å°†æœ‰ä¸€ä¸ªè¿ç§»æ–‡ä»¶å¤¹ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ª SQL æ–‡ä»¶:ä¸€ä¸ª up.sql ç”¨äºè®¾ç½®æ•°æ®åº“ï¼Œå¦ä¸€ä¸ª down.sql ç”¨äºæ‹†é™¤æ•°æ®åº“ã€‚

æˆ‘å°†åœ¨ up.sql ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
 CREATE TABLE teams (
      id SERIAL PRIMARY KEY,
      name VARCHAR NOT NULL
    );

    CREATE TABLE members (
      id SERIAL PRIMARY KEY,
      name VARCHAR NOT NULL,
      knockouts INT NOT NULL DEFAULT 0,
      team_id INT NOT NULL,
      FOREIGN KEY (team_id) REFERENCES teams(id)
    );

    INSERT INTO teams(id, name) VALUES (1, 'Heroes');
    INSERT INTO members(name, knockouts, team_id) VALUES ('Link', 14, 1);
    INSERT INTO members(name, knockouts, team_id) VALUES ('Mario', 11, 1);
    INSERT INTO members(name, knockouts, team_id) VALUES ('Kirby', 8, 1);

    INSERT INTO teams(id, name) VALUES (2, 'Villains');
    INSERT INTO members(name, knockouts, team_id) VALUES ('Ganondorf', 8, 2);
    INSERT INTO members(name, knockouts, team_id) VALUES ('Bowser', 11, 2);
    INSERT INTO members(name, knockouts, team_id) VALUES ('Mewtwo', 12, 2); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘å°†åœ¨ down.sql ä¸­æ·»åŠ :

```
 DROP TABLE members;
    DROP TABLE teams; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨è¿‡å»ç¼–å†™è¿‡ SQLï¼Œè¿™äº›è¯­å¥ä¼šæœ‰ä¸€äº›æ„ä¹‰ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªè¡¨ï¼Œä¸€ä¸ªå­˜å‚¨å›¢é˜Ÿï¼Œå¦ä¸€ä¸ªå­˜å‚¨è¿™äº›å›¢é˜Ÿçš„æˆå‘˜ã€‚

å¦‚æœä½ è¿˜æ²¡æœ‰æ³¨æ„åˆ°çš„è¯ï¼Œæˆ‘æ˜¯åŸºäº Smash Bros å¯¹è¿™äº›æ•°æ®å»ºæ¨¡çš„ã€‚è¿™æœ‰åŠ©äºåšæŒå­¦ä¹ ã€‚

ç°åœ¨è¿è¡Œè¿ç§»:

```
 diesel migration run 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨æƒ³éªŒè¯ down.sql è„šæœ¬å¯ä»¥é”€æ¯è¿™äº›è¡¨ï¼Œé‚£ä¹ˆè¿è¡Œ:`diesel migration redo`ã€‚

æˆ‘ä¹‹æ‰€ä»¥å°† GraphQL æ¨¡å¼æ–‡ä»¶å‘½åä¸º graphql_schema.rs è€Œä¸æ˜¯ schema.rsï¼Œæ˜¯å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œdiesel ä¼šåœ¨ src æ–¹å‘è¦†ç›–è¯¥æ–‡ä»¶ã€‚

å®ƒåœ¨é‚£ä¸ªæ–‡ä»¶ä¸­ä¿å­˜äº†æˆ‘ä»¬çš„ SQL è¡¨çš„ Rust å®è¡¨ç¤ºã€‚çŸ¥é“è¿™ä¸ª`table!`å®æ˜¯å¦‚ä½•å·¥ä½œçš„å¹¶ä¸é‡è¦ï¼Œä½†æ˜¯å°½é‡ä¸è¦ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶â€”â€”å­—æ®µçš„é¡ºåºå¾ˆé‡è¦ï¼

```
 // schema.rs (Generated by diesel cli)

    table! {
        members (id) {
            id -> Int4,
            name -> Varchar,
            knockouts -> Int4,
            team_id -> Int4,
        }
    }

    table! {
        teams (id) {
            id -> Int4,
            name -> Varchar,
        }
    }

    joinable!(members -> teams (team_id));

    allow_tables_to_appear_in_same_query!(
        members,
        teams,
    ); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œæ„Ÿè°¢ä¸€æ¡æ³¨é‡Šï¼Œæˆ‘ä»¬å°†æƒ³è¦å¯¼å…¥ diesel å¹¶åœ¨ main.rs:
ä¸­å…¬å¼€æ¨¡å¼æ¨¡å—

```
 #[macro_use]
+   extern crate diesel;
    extern crate juniper;

    use std::io;
    use std::sync::Arc;

    use actix_web::{web, App, Error, HttpResponse, HttpServer};
    use futures::future::Future;
    use juniper::http::graphiql::graphiql_source;
    use juniper::http::GraphQLRequest;

    mod graphql_schema;
+   mod schema; 
    use crate::graphql_schema::{create_schema, Schema}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ç»™æˆ‘ä»¬çš„æ¬è¿å·¥è£…ä¸ŠæŸ´æ²¹

ä¸ºäº†æä¾›è¡¨ä¸­çš„æ•°æ®ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆç”¨æ–°å­—æ®µ
æ›´æ–°æˆ‘ä»¬çš„`Member`ç»“æ„

```
// graphql_schema.rs

+ #[derive(Queryable)]
pub struct Member {
  pub id: i32,
  pub name: String,
+ pub knockouts: i32,
+ pub team_id: i32, }

#[juniper::object(description = "A member of a team")]
impl Member {
  pub fn id(&self) -> i32 {
    self.id  
  }

  pub fn name(&self) -> &str {
    self.name.as_str()
  }

+ pub fn knockouts(&self) -> i32 {
+   self.knockouts
+ } 
+ pub fn team_id(&self) -> i32 {
+   self.team_id
+ } } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬è¿˜å‘`Member`æ·»åŠ äº†`Queryable`æ´¾ç”Ÿå±æ€§ã€‚è¿™å‘Šè¯‰ Diesel å®ƒéœ€è¦çŸ¥é“çš„ä¸€åˆ‡ï¼Œä»¥ä¾¿åœ¨ Postgres ä¸­æŸ¥è¯¢æ­£ç¡®çš„è¡¨ã€‚

å¦å¤–ï¼Œæ·»åŠ ä¸€ä¸ª`Team`ç»“æ„:

```
 // graphql_schema.rs

    #[derive(Queryable)]
    pub struct Team {
      pub id: i32,
      pub name: String,
    }

    #[juniper::object(description = "A team of members")]
    impl Team {
      pub fn id(&self) -> i32 {
        self.id
      }

      pub fn name(&self) -> &str {
        self.name.as_str()
      }

      pub fn members(&self) -> Vec<Member> {
        vec![]
      }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€ä¼šå„¿ï¼Œæˆ‘ä»¬å°†æ›´æ–°`Team`ä¸Šçš„`members`å‡½æ•°ï¼Œä»¥è¿”å›ä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢ã€‚ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä¸ºæˆå‘˜æ·»åŠ ä¸€ä¸ªæ ¹è°ƒç”¨ã€‚

```
 // graphql_schema.rs
    + extern crate dotenv;

    + use std::env;

    + use diesel::pg::PgConnection;
    + use diesel::prelude::*;
    + use dotenv::dotenv;
    use juniper::{EmptyMutation, RootNode};

    + use crate::schema::members;

    pub struct QueryRoot;

    +  fn establish_connection() -> PgConnection {
    +    dotenv().ok();
    +    let database_url = env::var("DATABASE_URL").expect("DATABASE_URL must be set");
    +    PgConnection::establish(&database_url).expect(&format!("Error connecting to {}", database_url))
    +  }

    #[juniper::object]
    impl QueryRoot {
      fn members() -> Vec<Member> {
    -   vec![
    -     Member {
    -       id: 1,
    -       name: "Link".to_owned(),
    -     },
    -     Member {
    -       id: 2,
    -       name: "Mario".to_owned(),
    -     }
    -   ]
    +   use crate::schema::members::dsl::*;
    +   let connection = establish_connection();
    +   members
    +     .limit(100)
    +     .load::<Member>(&connection)
    +     .expect("Error loading members")
      }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¾ˆå¥½ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡ä½¿ç”¨äº† diesel æŸ¥è¯¢ã€‚åˆå§‹åŒ–è¿æ¥åï¼Œæˆ‘ä»¬ä½¿ç”¨æˆå‘˜ dslï¼Œå®ƒæ˜¯ä» schema.rs ä¸­çš„`table!`å®ç”Ÿæˆçš„ï¼Œå¹¶è°ƒç”¨ **load** ï¼Œè¡¨æ˜æˆ‘ä»¬å¸Œæœ›åŠ è½½`Member`å¯¹è±¡ã€‚

å»ºç«‹è¿æ¥æ„å‘³ç€ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰å£°æ˜çš„ env å˜é‡è¿æ¥åˆ°æœ¬åœ° Postgres æ•°æ®åº“ã€‚

å‡è®¾æ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯æ­£ç¡®çš„ï¼Œç”¨`cargo run`é‡å¯æœåŠ¡å™¨ï¼Œæ‰“å¼€ GraphiQL å¹¶å‘å‡º members æŸ¥è¯¢ï¼Œå¯èƒ½ä¼šæ·»åŠ ä¸¤ä¸ªæ–°å­—æ®µã€‚

teams æŸ¥è¯¢å°†éå¸¸ç›¸ä¼¼â€”â€”ä¸åŒä¹‹å¤„åœ¨äºï¼Œæˆ‘ä»¬è¿˜å¿…é¡»å°†æŸ¥è¯¢çš„ä¸€éƒ¨åˆ†æ·»åŠ åˆ°`Team`ç»“æ„ä¸Šçš„ members å‡½æ•°ä¸­ï¼Œä»¥ä¾¿è§£æ GraphQL ç±»å‹ä¹‹é—´çš„å…³ç³»ã€‚

```
 // graphql_schema.rs

    #[juniper::object]
    impl QueryRoot {
      fn members() -> Vec<Member> {
        use crate::schema::members::dsl::*;
        let connection = establish_connection();
        members
          .limit(100)
          .load::<Member>(&connection)
          .expect("Error loading members")
      }

    +  fn teams() -> Vec<Team> {
    +    use crate::schema::teams::dsl::*;
    +    let connection = establish_connection();
    +    teams
    +      .limit(10)
    +      .load::<Team>(&connection)
    +      .expect("Error loading teams")
    +  }
    }

    // ...

    #[juniper::object(description = "A team of members")]
    impl Team {
      pub fn id(&self) -> i32 {
        self.id
      }

      pub fn name(&self) -> &str {
        self.name.as_str()
      }

      pub fn members(&self) -> Vec<Member> {
    -    vec![]
    +    use crate::schema::members::dsl::*;
    +    let connection = establish_connection();
    +    members
    +      .filter(team_id.eq(self.id))
    +      .limit(100)
    +      .load::<Member>(&connection)
    +      .expect("Error loading members")
      }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“è¿è¡Œ this is GraphiQL æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°:

[![More complex query in graphiql](img/db78ad9838e959da456f6668056b379d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--BnizTmBw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1gsj02nf5m8le9ujjbr8.png)

æˆ‘çœŸçš„å¾ˆå–œæ¬¢è¿™æ ·çš„ç»“æœï¼Œä½†æ˜¯ä¸ºäº†ä½¿æœ¬æ•™ç¨‹å®Œæ•´ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»æ·»åŠ ä¸€ç‚¹ä¸œè¥¿ã€‚

## åˆ›å»ºæˆå‘˜çªå˜

å¦‚æœæœåŠ¡å™¨æ˜¯åªè¯»çš„ï¼Œä¸å¯å†™çš„ï¼Œé‚£ä¹ˆå®ƒæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæˆ‘ç›¸ä¿¡è¿™äº›ä¹Ÿæœ‰å®ƒä»¬çš„ç”¨é€”ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³æŠŠæ•°æ®å†™åˆ°æˆ‘ä»¬çš„æ•°æ®åº“ä¸­ï¼Œè¿™æœ‰å¤šéš¾å‘¢ï¼Ÿ

é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª`MutationRoot`ç»“æ„ï¼Œå®ƒå°†æœ€ç»ˆå–ä»£æˆ‘ä»¬å¯¹`EmptyMutation`çš„ä½¿ç”¨ã€‚ç„¶åæˆ‘ä»¬å°†æ·»åŠ  diesel æ’å…¥æŸ¥è¯¢ã€‚

```
 // graphql_schema.rs

    // ...

    pub struct MutationRoot;

    #[juniper::object]
    impl MutationRoot {
      fn create_member(data: NewMember) -> Member {
        let connection = establish_connection();
        diesel::insert_into(members::table)
          .values(&data)
          .get_result(&connection)
          .expect("Error saving new post")
      }
    }

    #[derive(juniper::GraphQLInputObject, Insertable)]
    #[table_name = "members"]
    pub struct NewMember {
      pub name: String,
      pub knockouts: i32,
      pub team_id: i32,
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­£å¦‚ GraphQL å˜å¼‚é€šå¸¸æ‰€åšçš„é‚£æ ·ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º`NewMember`çš„è¾“å…¥å¯¹è±¡ï¼Œå¹¶å°†å…¶ä½œä¸º`create_member`å‡½æ•°çš„å‚æ•°ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªè¿æ¥ï¼Œå¹¶è°ƒç”¨æˆå‘˜è¡¨ä¸Šçš„æ’å…¥æŸ¥è¯¢ï¼Œä¼ é€’æ•´ä¸ªè¾“å…¥å¯¹è±¡ã€‚

Rust å…è®¸æˆ‘ä»¬å¯¹ GraphQL è¾“å…¥å¯¹è±¡å’Œ Diesel å¯æ’å…¥å¯¹è±¡ä½¿ç”¨ç›¸åŒçš„ç»“æ„ï¼Œè¿™éå¸¸æ–¹ä¾¿ã€‚

è®©æˆ‘æ›´æ¸…æ¥šåœ°è¯´æ˜ä¸€ä¸‹ï¼Œå¯¹äº`NewMember`ç»“æ„:

*   æˆ‘ä»¬æ´¾ç”Ÿ`juniper::GraphQLInputObject`ä»¥ä¾¿ä¸ºæˆ‘ä»¬çš„ GraphQL æ¨¡å¼åˆ›å»ºä¸€ä¸ªè¾“å…¥å¯¹è±¡
*   æˆ‘ä»¬æ´¾ç”Ÿ`Insertable`æ˜¯ä¸ºäº†è®© Diesel çŸ¥é“è¿™ä¸ªç»“æ„æ˜¯æ’å…¥ SQL è¯­å¥çš„æœ‰æ•ˆè¾“å…¥
*   æˆ‘ä»¬æ·»åŠ äº†`table_name`å±æ€§ï¼Œä»¥ä¾¿ Diesel çŸ¥é“å°†å®ƒæ’å…¥å“ªä¸ªè¡¨

è¿™é‡Œæœ‰å¾ˆå¤šç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿã€‚è¿™å°±æ˜¯æˆ‘å–œæ¬¢ Rust çš„åœ°æ–¹ï¼Œå®ƒæœ‰å¾ˆå¥½çš„æ€§èƒ½ï¼Œä½†æ˜¯ä»£ç æœ‰åƒå®å’Œæ´¾ç”Ÿç‰¹å¾è¿™æ ·çš„ç‰¹æ€§æ¥æŠ½è±¡æ ·æ¿æ–‡ä»¶å’Œå¢åŠ åŠŸèƒ½ã€‚

æœ€åï¼Œåœ¨æ–‡ä»¶çš„åº•éƒ¨ï¼Œå°†`MutationRoot`æ·»åŠ åˆ°æ¨¡å¼:

```
 // graphql_schema.rs

    pub type Schema = RootNode<'static, QueryRoot, MutationRoot>;

    pub fn create_schema() -> Schema {
      Schema::new(QueryRoot {}, MutationRoot {})
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘å¸Œæœ›ä¸€åˆ‡éƒ½å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æµ‹è¯•åˆ°ç›®å‰ä¸ºæ­¢æ‰€æœ‰çš„æŸ¥è¯¢å’Œçªå˜:

```
 # GraphiQL  mutation  CreateMemberMutation($data:  NewMember!)  {  createMember(data:  $data)  {  id  name  knockouts  teamId  }  }  # example query variables  # {  #   "data": {  #     "name": "Samus",  #     "knockouts": 19,  #     "teamId": 1  #   }  # } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœè¿™ç§å˜å¼‚è¿è¡ŒæˆåŠŸï¼Œæ‚¨å°±å¯ä»¥æ‰“å¼€ä¸€ç“¶é¦™æ§Ÿï¼Œå¼€å§‹ç”¨ Rust æ„å»ºé«˜æ€§èƒ½ã€ç±»å‹å®‰å…¨çš„ GraphQL æœåŠ¡å™¨äº†ã€‚

## æ„Ÿè°¢é˜…è¯»

æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä¹Ÿå¸Œæœ›å®ƒèƒ½ç»™ä½ çš„å·¥ä½œå¸¦æ¥ä¸€äº›å¯å‘ã€‚

å¦‚æœä¸‹æ¬¡æˆ‘åœ¨ Rustã€ReasonMLã€GraphQL æˆ–è½¯ä»¶å¼€å‘é¢†åŸŸå‘è¡¨æ–‡ç« æ—¶ï¼Œä½ æƒ³ç»§ç»­å…³æ³¨æˆ‘ï¼Œè¯·éšæ—¶å…³æ³¨æˆ‘åœ¨ [Twitter](https://twitter.com/iwilson) ã€ [dev.to](https://dev.to/iwilsonq) æˆ–æˆ‘çš„ç½‘ç«™ [ianwilson.io](https://ianwilson.io) ä¸Šçš„æ–‡ç« ã€‚

æºä»£ç åœ¨è¿™é‡Œ[github.com/iwilsonq/rust-graphql-example](https://github.com/iwilsonq/rust-graphql-example)ã€‚

### å…¶ä»–æ•´æ´çš„é˜…è¯»ææ–™

è¿™é‡Œæœ‰ä¸€äº›æˆ‘ä»¬åˆä½œè¿‡çš„å›¾ä¹¦é¦†ã€‚ä»–ä»¬æœ‰å¾ˆæ£’çš„æ–‡æ¡£å’ŒæŒ‡å—ï¼Œæ‰€ä»¥ä¸€å®šè¦ç»™ä»–ä»¬çœ‹ä¸€ä¸‹:)

*   [åœ¨ä¸œäº¬å®æ–½é“é”ˆæœŸè´§](https://tokio.rs/docs/getting-started/futures/)
*   [Juniper - GraphQL æœåŠ¡å™¨ä¿¡ä»»åº¦](https://graphql-rust.github.io/juniper/master/index.html)
*   [æŸ´æ²¹å®‰å…¨ã€å¯æ‰©å±•çš„ ORM å’Œ Rust æŸ¥è¯¢ç”Ÿæˆå™¨](http://diesel.rs/)
*   [Actix - Rust å¼ºå¤§çš„æ¼”å‘˜ç³»ç»Ÿå’Œæœ€å¥½ç©çš„ web æ¡†æ¶](https://actix.rs/)