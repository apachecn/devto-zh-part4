# åˆåŒæµ‹è¯•çš„ç¬¬ä¸€ç§æ–¹æ³•

> åŸæ–‡ï¼š<https://dev.to/chicio/a-first-approach-to-contract-test-5g01>

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†è°ˆè®ºåˆåŒæµ‹è¯•:å®ƒä»¬æ˜¯ä»€ä¹ˆä»¥åŠä½ å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚

æœ‰æ—¶ï¼Œæ‚¨å¿…é¡»å¯¹åŒä¸€æ¥å£çš„å¤šä¸ªå®ç°è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚åŸºæœ¬ä¸Šï¼Œæ‚¨å¯ä»¥å¯¹åŒä¸€æ¥å£çš„å¤šä¸ªå…·ä½“å®ç°è¿›è¡Œç›¸åŒçš„æµ‹è¯•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**åˆåŒæµ‹è¯•**å¯ä»¥å¸®ä½ èŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚é€šè¿‡ä½¿ç”¨å¥‘çº¦æµ‹è¯•ï¼Œæ‚¨å°†èƒ½å¤Ÿä¸ºä¸åŒçš„å…·ä½“å®ç°è¿è¡Œç›¸åŒçš„æµ‹è¯•é›†ã€‚

æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿè¦ç‚¹æ˜¯æœ‰ä¸€ä¸ªæ¨¡æ¿åŸºç¡€æŠ½è±¡â€œContractTestâ€æµ‹è¯•ç±»ï¼Œå®ƒä½¿ç”¨æŠ½è±¡æ–¹æ³•å°è£…æµ‹è¯•çš„é€»è¾‘ï¼Œè¿™äº›æ–¹æ³•ä½¿ç”¨è¢«æµ‹è¯•å¯¹è±¡çš„åŸºç¡€æ¥å£ã€‚è¿™äº›æŠ½è±¡æ–¹æ³•å°†åœ¨è¿™ä¸ªâ€œContractTestâ€ç±»çš„å­ç±»ä¸­å®ç°ï¼Œå®ƒä»¬å°†ä¸ºæµ‹è¯•æä¾›æŠ½è±¡æ–¹æ³•å£°æ˜ä¸­ä½¿ç”¨çš„æ¥å£çš„å…·ä½“å®ç°ã€‚

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œè®©ä¸€åˆ‡æ›´æ¸…æ¥šï¼ï¼ï¼è¿™ä¸ªä¾‹å­æ˜¯ä¸€ä¸ªä½¿ç”¨ JUnit 4 å’Œ Mockito 2.8 çš„ç‹¬ç«‹ Java é¡¹ç›®ã€‚æ˜¾ç„¶ï¼Œä½ å¯ä»¥å°†è¿™ä¸ªæ¦‚å¿µåº”ç”¨åˆ°å…¶ä»–è¯­è¨€/å¹³å°ä¸Š(äº‹å®ä¸Šï¼Œå½“æˆ‘åœ¨ä¸€ä¸ª Android åº”ç”¨ä¸­å¼€å‘ä¸€ä¸ªæ–°ç‰¹æ€§æ—¶ï¼Œæˆ‘å­¦ä¹ å¹¶å®ç°äº†å¥‘çº¦æµ‹è¯•)ğŸ˜).

ä¾‹å¦‚å‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹æ¥å£:

```
public interface Command {
    void execute();
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æœ‰ä¸¤ä¸ªå®ç°è¯¥æ¥å£çš„å¯¹è±¡:AccountCommand å’Œ SettingsCommandã€‚

```
class AccountCommand implements Command {
    private MenuActionsListener menuActionsListener;

    AccountCommand(MenuActionsListener menuActionsListener) {
        this.menuActionsListener = menuActionsListener;
    }

    public void execute() {
        menuActionsListener.onAccountSelected();
    }
}

public class SettingsCommand implements Command {
    private MenuActionsListener menuActionsListener;

    SettingsCommand(MenuActionsListener menuActionsListener) {
        this.menuActionsListener = menuActionsListener;
    }

    public void execute() {
        menuActionsListener.onSettingsSelected();
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æ‚¨æ‰€è§ï¼Œè¿™ä¸¤ä¸ªå®ç°çœ‹èµ·æ¥éå¸¸ç›¸ä¼¼ã€‚æ‰€ä»¥æ˜¯æ—¶å€™çœ‹çœ‹å¥‘çº¦æµ‹è¯•å¦‚ä½•å¸®åŠ©æˆ‘ä»¬äº†ğŸ¤˜ï¼ï¼ï¼ï¼

æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ª`CommandContract`åŸºæœ¬æµ‹è¯•ç±»ï¼ŒåŒ…å«æˆ‘ä»¬æƒ³è¦ç¼–å†™çš„æµ‹è¯•çš„é€»è¾‘ã€‚åœ¨æˆ‘ä»¬çš„å…·ä½“ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡è°ƒç”¨`execute()`æ–¹æ³•æ¥ç¡®ä¿å½“å‘½ä»¤è¢«æ‰§è¡Œæ—¶ï¼Œåœ¨`Command`çš„æ¯ä¸ªå…·ä½“å®ç°ä¸Šç”¨æ­£ç¡®çš„æ–¹æ³•è°ƒç”¨`menuActionsListener`ã€‚æ‰€ä»¥æˆ‘ä»¬çš„`CommandContract`å®ç°æ˜¯:

```
abstract class CommandContract {
    private Command command;
    private MenuActionsListener menuActionsListener;

    @Test
    public void commandIsExecuted() throws Exception {
        givenAMenuActionListener();
        command = givenACommand(menuActionsListener);
        whenACommandIsExecuted();
        thenTheCorrectMenuActionIsInvoked(menuActionsListener);
    }

    private void givenAMenuActionListener() {
        menuActionsListener = mock(MenuActionsListener.class);
    }

    protected abstract Command givenACommand(MenuActionsListener menuActionsListener);

    private void whenACommandIsExecuted() {
        command.execute();
    }

    protected abstract void thenTheCorrectMenuActionIsInvoked(MenuActionsListener menuActionsListener);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­£å¦‚ä½ åœ¨`commandIsExecuted()`æµ‹è¯•ä¸­æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨æ‰€æœ‰çš„æŠ½è±¡æ–¹æ³•æ¥å®šä¹‰æµ‹è¯•çš„é€šç”¨å‘½ä»¤å®ç°ã€‚ç°åœ¨ï¼Œåœ¨ test å­ç±»ä¸­ï¼Œæˆ‘ä»¬å°†å®ç°æŠ½è±¡æ–¹æ³•ï¼Œä¸ºæµ‹è¯•æä¾›å…·ä½“å‘½ä»¤çš„å„ç§å®ç°ã€‚

æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`AccountCommandTest`ç±»ï¼Œä½œä¸º`CommandContract`çš„å­ç±»ï¼Œæ¥æµ‹è¯•æˆ‘ä»¬çš„`AccountCommand`ç±»:

```
public class AccountCommandTest extends CommandContract {

    protected Command givenACommand(MenuActionsListener menuActionsListener) {
        return new AccountCommand(menuActionsListener);
    }

    protected void thenTheCorrectMenuActionIsInvoked(MenuActionsListener menuActionsListener) {
        Mockito.verify(menuActionsListener).onAccountSelected();
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ª`SettingsCommandTest`ç±»ï¼Œå®ƒæ˜¯`CommandContract`çš„å­ç±»ï¼Œç”¨æ¥æµ‹è¯•æˆ‘ä»¬çš„`AccountCommand`ç±»:

```
public class SettingsCommandTest extends CommandContract {

    protected Command givenACommand(MenuActionsListener menuActionsListener) {
        return new SettingsCommand(menuActionsListener);
    }

    protected void thenTheCorrectMenuActionIsInvoked(MenuActionsListener menuActionsListener) {
        Mockito.verify(menuActionsListener).onSettingsSelected();
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬æµ‹è¯•äº†æ‰€æœ‰å…·ä½“çš„`Command`å®ç°ï¼Œæ²¡æœ‰å¤åˆ¶å•å…ƒæµ‹è¯•é€»è¾‘ã€‚
ç²¾å½©ğŸ˜®ğŸ˜ï¼ï¼ï¼

[åœ¨è¿™é‡Œ](https://github.com/chicio/Contract-Tests)ä½ å¯ä»¥æ‰¾åˆ°å®Œæ•´çš„ä¾‹å­(ä¸€ä¸ªä½¿ç”¨ IntelliJã€JUnit4ã€Mockito å¼€å‘çš„ Maven é¡¹ç›®)ã€‚

æ˜¯æ—¶å€™å¯¹ä½ çš„é¡¹ç›®è¿›è¡ŒåˆåŒæµ‹è¯•äº†ğŸ˜‚ğŸ˜†ï¼ï¼ï¼