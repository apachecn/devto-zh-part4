# æ„å»ºå¯ä¼¸ç¼©çš„å¥å£®çš„ç±»å‹å®‰å…¨çš„çª—ä½“

> åŸæ–‡ï¼š<https://dev.to/maxime1992/building-scalable-robust-and-type-safe-forms-with-angular-3nf9>

ä½ å¥½ğŸ‘‹ï¼

ä»Šå¤©æˆ‘æƒ³åˆ†äº«ä¸€äº›æˆ‘ç”¨ Angular æ„å»º(æˆ‘è®¤ä¸ºæ˜¯)å¤§å‹å¤æ‚è¡¨å•çš„ç»éªŒã€‚ä¸è¿‡æœ‰ä¸€ç‚¹è¦è®°ä½:å¦‚æœä½ ä¸æ‹…å¿ƒâ€œå¯æ‰©å±•â€æˆ–â€œå¤§è¡¨å•â€éƒ¨åˆ†ï¼Œè¯·æ³¨æ„ä»¥ä¸‹æ‰€æœ‰å†…å®¹ä»ç„¶å¯ä»¥åº”ç”¨äºè¶…å°è¡¨å•ï¼Œä½ ä»ç„¶ä¼šå¾—åˆ°å¾ˆå¤šå¥½å¤„ï¼

å…è´£å£°æ˜:æˆ‘ä¸æ˜¯å”¯ä¸€ä¸€ä¸ªèŠ±è´¹æ•°å°æ—¶æ€è€ƒå¤„ç†è¡¨å•çš„æ›´å¥½æ–¹æ³•çš„äººã€‚æ‰å…‹Â·äº¨åˆ©([@æ‰å…‹](https://twitter.com/zak))å’Œæˆ‘éƒ½æƒ³åˆ°äº†æˆ‘ä»Šå¤©è¦ä»‹ç»çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘è¦æ„Ÿè°¢ä»–èŠ±äº†è¿™ä¹ˆå¤šæ—¶é—´åœ¨è®¾è®¡ã€ç¼–ç å’Œè¿›è¡Œä»£ç å®¡æŸ¥ä¸ŠğŸ‘ ğŸ‘ ğŸ‘ã€‚

# ç›®å½•

*   [è¯­å¢ƒ](#context)
*   [æ¼”ç¤ºç®€ä»‹ï¼Œäº†è§£æˆ‘ä»¬æƒ³è¦æ„å»ºçš„ç¤ºä¾‹](#introduction-the-demo-and-understand-what-we-want-to-build-as-an-example)
*   [ååº”å½¢å¼](#reactive-forms)
    *   [ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹](#everything-in-one-file-fire)
    *   [å°†è¡¨å•åˆ†è§£æˆå­ç»„ä»¶](#breaking-down-the-form-into-sub-components-thumbsup)
    *   ä»¥æ­£ç¡®çš„æ–¹å¼å°†è¡¨å•åˆ†è§£æˆå­ç»„ä»¶ï¼
    *   [äº†è§£ ControlValueAccessor çš„å¨åŠ›](#understanding-the-power-of-raw-controlvalueaccessor-endraw-)
*   [Ngx-å­è¡¨å•:å°†è§’åº¦è¡¨å•åˆ†è§£æˆå¤šä¸ªå­ç»„ä»¶çš„å®ç”¨ç¨‹åºåº“](#ngxsubform-utility-library-to-break-down-an-angular-form-into-multiple-sub-components)
    *   [ngx-å­è¡¨å•å¿…é¡»æä¾›ä»€ä¹ˆ](#what-raw-ngxsubform-endraw-has-to-offer)
    *   ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨å®ƒï¼Ÿ
    *   [æ„å»ºæ¼”ç¤º](#building-the-demo)
    *   [è¿›ä¸€æ­¥ä½¿ç”¨é‡æ˜ å°„å’Œ/æˆ–å¤šæ€æ€§](#going-further-with-remapping-andor-polymorphism)
*   [æ€»ç»“å¹¶å¸¦èµ°](#summary-and-take-away)
*   [æœ‰ç”¨çš„é“¾æ¥](#useful-links)

# ä¸Šä¸‹æ–‡

åœ¨æˆ‘ä»¬æ·±å…¥ä¸»é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ç»™ä½ ä¸€ç‚¹èƒŒæ™¯æ¥è§£é‡Šä¸ºä»€ä¹ˆæˆ‘åœ¨å·¥ä½œä¸­æ„å»ºå¤§å‹è¡¨å•ï¼Œä»¥åŠä¸ºä»€ä¹ˆæˆ‘çœŸçš„éœ€è¦æ‰¾åˆ°ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ¥åšå¾—æ›´å¥½ã€‚

æˆ‘ç›®å‰åœ¨ [CloudNC](https://cloudnc.com) å·¥ä½œï¼Œè¿™æ˜¯ä¸€å®¶ä½äºä¼¦æ•¦çš„åˆåˆ›å…¬å¸ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ç”¨[æ•°æ§é“£åºŠ](https://youtu.be/Dh1eUb_UWUQ?t=8)å¤§å¤§ç®€åŒ–ã€åŠ å¿«å’Œæ”¹è¿›åŠ å·¥é›¶ä»¶çš„è¿‡ç¨‹ã€‚åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç¯å¢ƒ(æœºå™¨ã€å·¥å…·ç­‰)å»ºæ¨¡ï¼Œä½œä¸ºç”Ÿæˆæœºå™¨è¿åŠ¨çš„ç®—æ³•çš„è¾“å…¥ã€‚è¿™ä¸ªç¯å¢ƒæœ‰å¤§é‡çš„å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ç›¸å½“å¤šçš„è¡¨å•ã€‚

[![](img/eca165f03cfde5cf63a3746e783d5115.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Ap4_oNya--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/sgrwp78td5w2loat4ulj.png)
*3D visualiser æ¨¡æ‹Ÿæœºå™¨å°†å¦‚ä½•åˆ‡å‰²é›¶ä»¶ã€‚*

æˆ‘ä»¬è¡¨å•ä¸­çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯å½“æˆ‘ä»¬æƒ³åœ¨ä¸€ä¸ªé›¶ä»¶ä¸Šæ ‡æ³¨ä¸€ä¸ªç‰¹å®šçš„å­”æ—¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒç±»å‹çš„æ³¨é‡Šä¸­è¿›è¡Œé€‰æ‹©ï¼Œå¹¶é€‰æ‹©ç‰¹å®šçš„è¡Œä¸º:

[![](img/2a78351c6c699d4ff4afcfed0e6fabbc.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--MzYJW9_8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zf5h3re7gnsn7pfgdwdd.png)
*2 ç§å½¢å¼æ³¨é‡Šä¸€ä¸ªå­”çš„ä¾‹å­ã€‚*

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„è¡¨å•ï¼Œæ¯ä¸ªè¡¨å•ç”±ä¸€ä¸ªä¸‹æ‹‰èœå•é€‰æ‹©(è¿™å½¢æˆäº†ä¸€ä¸ªå¤šæ€æ¨¡å‹â€”â€”ç¨åè§£é‡Šï¼).æ¯ä¸ªè¡¨å•éƒ½ä½¿ç”¨ç›¸åŒçš„â€œå®šä½ç­–ç•¥â€å­è¡¨å•ã€‚è¿™ç”šè‡³è¿˜ä¸æ˜¯æˆ‘ä»¬æœ€å¤æ‚çš„è¡¨å•ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥å¼€å§‹ç†è§£æå‡ºä¸€ä¸ªé€šç”¨è§£å†³æ–¹æ¡ˆçš„åŠ¨æœºï¼Œå°†è¡¨å•åˆ†è§£æˆå®¹æ˜“ç»„åˆçš„é€»è¾‘ç»„ä»¶ã€‚

# ä»‹ç»æ¼”ç¤ºå¹¶ç†è§£æˆ‘ä»¬è¦æ„å»ºçš„ç¤ºä¾‹

ä¸ºäº†å±•ç¤ºæ„å»ºä¸€ä¸ªå¥½çš„è¡¨å•æœ‰å¤šå›°éš¾ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ä¸»è¦æƒ³æ³•æ˜¯:â€œé“¶æ²³é”€å”®â€ï¼Œäººä»¬å¯ä»¥å†³å®šå‡ºå”®`Droid` ( `Assassin`ã€`Astromech`ã€`Medical`ã€`Protocol`)æˆ–`Vehicle` ( `Spaceship`ã€`Speeder`)ã€‚

[![](img/efb885454814699c56861de0170cda81.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--BpcR0u8c--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/dpkth2zu4axvrnqh23bn.png)

åœ¨å·¦ä¾§ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç®€å•çš„åˆ—è¡¨ï¼Œæ˜¾ç¤ºè¦é”€å”®çš„å•†å“ã€‚

åœ¨å³è¾¹ï¼Œæœ‰ä¸€ä¸ªè¡¨å•æ˜¾ç¤ºäº†è¢«ç‚¹å‡»çš„æ¡ç›®(æ‰€ä»¥å¯ä»¥ç¼–è¾‘ï¼ŒæŠŠå®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªç®¡ç†è§†å›¾)ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ç‚¹å‡»â€œæ–°å»ºâ€æŒ‰é’®æ¥åˆ›å»ºä¸€ä¸ªæ–°æ¡ç›®ã€‚

å¦‚æœä½ æƒ³ç©è¯•ç©çš„ **live ç‰ˆ**ï¼Œä½ å¯ä»¥è¯•è¯•è¿™é‡Œ:ã€https://cloudnc.github.io/ngx-sub-formã€‘

å¦‚æœä½ æƒ³çœ‹çœ‹è¯•ç©çš„æºä»£ç ï¼Œä½ å¯ä»¥è¯•è¯•è¿™é‡Œ:[https://github.com/cloudnc/ngx-sub-form/tree/master/src/app](https://github.com/cloudnc/ngx-sub-form/tree/master/src/app)

ç°åœ¨è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹è¿™äº›æ¨¡å‹(`interfaces`ã€`enums`ç­‰)æ¥æ„å»ºå®ƒçš„ç®€åŒ–ç‰ˆæœ¬ã€‚è¶³ä»¥ç†è§£æ‰€æœ‰æ¦‚å¿µä½†é¿å…é‡å¤ã€‚

A `Listing`æ˜¯å¾…å”®å•†å“:

```
// can either be a vehicle or a droid
export enum ListingType {
  VEHICLE = 'Vehicle',
  DROID = 'Droid',
}

export interface BaseListing {
  id: string;
  title: string;
  imageUrl: string;
  price: number;
}

export interface VehicleListing extends BaseListing {
  listingType: ListingType.VEHICLE;
  product: OneVehicle;
}

export interface DroidListing extends BaseListing {
  listingType: ListingType.DROID;
  product: OneDroid;
}

export type OneListing = VehicleListing | DroidListing; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹`Vehicle`æ¨¡å‹:

```
export enum VehicleType {
  SPACESHIP = 'Spaceship',
  SPEEDER = 'Speeder',
}

export interface BaseVehicle {
  color: string;
  canFire: boolean;
  numberOfPeopleOnBoard: number;
}

export interface Spaceship extends BaseVehicle {
  vehicleType: VehicleType.SPACESHIP;
  numberOfWings: number;
}

export interface Speeder extends BaseVehicle {
  vehicleType: VehicleType.SPEEDER;
  maximumSpeed: number;
}

export type OneVehicle = Spaceship | Speeder; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ä»¶é‡è¦äº‹æƒ…æ˜¯ï¼Œ`OneListing`æ˜¯ä¸€ä¸ªå¤šæ€ç±»å‹(å¹¶ä¸”`OneVehicle`ä¹Ÿæ˜¯):

```
export type OneListing = VehicleListing | DroidListing; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™é‡Œä¿å­˜å€¼çš„å¯¹è±¡å¯ä»¥æ˜¯ä¸€ä¸ª`VehicleListing`æˆ–è€…ä¸€ä¸ª`DroidListing`ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒTypescript åªèƒ½é€šè¿‡æŸ¥çœ‹å±æ€§æ¥ç¡®ä¿ç±»å‹å®‰å…¨ï¼Œä½†æ˜¯ä¸ºäº†æ›´å®‰å…¨ï¼Œä¹Ÿä¸ºäº†ä»¥åæ›´å®¹æ˜“çŸ¥é“å¯¹è±¡çš„ç±»å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªåˆ¤åˆ«å±æ€§:`listingType`ã€‚

ç°åœ¨è®©æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œç†è§£æ„å»ºä¸€ä¸ªå¯ä»¥è¡¨ç¤ºè¯¥æ•°æ®ç»“æ„çš„è¡¨å•çš„æŒ‘æˆ˜ã€‚

# ååº”å½¢å¼

å®ƒä»¬åœ¨ Angular çš„æ—©æœŸç‰ˆæœ¬ä¸­è¢«å¼•å…¥ï¼Œå¹¶å®Œå…¨æ”¹å˜äº†å¯¹å½¢å¼çš„æ¨ç†æ–¹å¼ã€‚å¥½çš„æ–¹é¢ï¼æˆ‘ä»¬å¯ä»¥ä» Typescript/Components æ–‡ä»¶ä¸­ç®¡ç†è¡¨å•çš„æ‰€æœ‰é€»è¾‘ï¼Œè€Œä¸æ˜¯ä»æ¨¡æ¿ä¸­ç®¡ç†ã€‚å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰çš„è¡¨å•ä¸Šäº«å—ç±»å‹å®‰å…¨ï¼

[![](img/22b9265549cd742779a03231801a5f9b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--IiH6J1uC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/prlx7do0rrb70kpw5tyq.png)

è‰¯å¥½çš„...ä¸å®Œå…¨æ˜¯ã€‚Github ä¸Šæœ‰ä¸€ä¸ªé•¿æœŸå­˜åœ¨çš„é—®é¢˜ã€‚

# [![GitHub logo](img/a73f630113876d78cff79f59c2125b24.png) ååº”å½¢å¼ä¸å¼ºçƒˆ #13721](https://github.com/angular/angular/issues/13721) 

[![asfernandes avatar](img/6e2d8f2aa6e23902c465b0c8661f9a98.png)](https://github.com/asfernandes) **[asfernandes](https://github.com/asfernandes)** posted on [<time datetime="2016-12-30T15:14:52Z">Dec 30, 2016</time>](https://github.com/angular/angular/issues/13721)

```
[x] feature request 
```

*   **è§’ç‰ˆ:** 2

ååº”å¼è¡¨å•åº”è¯¥åœ¨å¤æ‚çš„è¡¨å•ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯æ§ä»¶çš„`valueChanges`æ˜¯`Observable<any>`ï¼Œè¿™å®Œå…¨è¿èƒŒäº†å¤æ‚ä»£ç çš„è‰¯å¥½å®è·µã€‚

åº”è¯¥æœ‰ä¸€ç§åˆ›å»ºå¼ºç±»å‹è¡¨å•æ§ä»¶çš„æ–¹æ³•ã€‚

[View on GitHub](https://github.com/angular/angular/issues/13721)

æˆ‘é‚€è¯·ä½ è¡¨ç¤ºä¸€äº›æ”¯æŒğŸ‘ä»¥ä¾¿å®ƒæœ€ç»ˆèƒ½è¢«ä¼˜å…ˆå¤„ç†ã€‚

å³ä½¿æˆ‘ä»¬ç›®å‰ä¸èƒ½çœŸæ­£ä»ç±»å‹å®‰å…¨ä¸­å—ç›Šï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨ååº”å½¢å¼æ¥æ„å»ºå®ƒã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸åŒçš„è§£å†³æ–¹æ¡ˆæ¥å®ç°è¿™ä¸€ç‚¹ã€‚

## ä¸€åˆ‡å°½åœ¨ä¸€æ¡£ğŸ”¥

ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯å°†æ‰€æœ‰ä¸œè¥¿éƒ½æ”¾åœ¨åŒä¸€ä¸ªç»„ä»¶ä¸­ã€‚å¯ä»¥æƒ³è±¡ï¼Œè¿™è¿œéç†æƒ³:

*   å·¨å¤§çš„æ–‡ä»¶
*   å¾ˆéš¾ä¸å¤šä¸ªå¼€å‘äººå‘˜å¹¶è¡Œå¤„ç†åŒä¸€ä¸ªæ–‡ä»¶
*   ä¸è¦å°†é€»è¾‘åˆ†æˆä¸åŒçš„ç»„ï¼Œå°†é—®é¢˜åˆ†è§£æˆæ›´å°çš„éƒ¨åˆ†
*   ä¸èƒ½é‡å¤ä½¿ç”¨è¡¨å•çš„å­éƒ¨åˆ†(ä¾‹å¦‚ï¼Œåªç¼–è¾‘ä¸€ä¸ªè¾ƒå°çš„å­é›†)

## å°†è¡¨å•åˆ†è§£æˆå­ç»„ä»¶ğŸ‘

å› æ­¤ï¼Œå°±åƒæ‚¨å¤„ç†ä»»ä½•å…¶ä»–ç»„ä»¶æˆ–åŠŸèƒ½ä¸€æ ·ï¼Œæ‚¨å¼€å§‹è€ƒè™‘å¦‚ä½•å°†å…¶åˆ†è§£ä¸ºæ›´ç®€å•ã€æ›´å°çš„å­ç»„ä»¶æ¥å¤„ç†å®ƒä»¬è‡ªå·±çš„é€»è¾‘ã€‚ä»é‚£é‡Œï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°ä¸€äº›åšå®¢æ–‡ç« å’Œå †æ ˆæº¢å‡ºé—®é¢˜ï¼Œå»ºè®®å°†è¡¨å•ç»„å®ä¾‹ä½œä¸º`@Input()`ä¼ é€’ï¼Œç„¶åä»ä¸€ä¸ªå­ç»„ä»¶åŠ¨æ€æ·»åŠ æ‰€éœ€çš„æ–°è¡¨å•å±æ€§ã€‚

ä½†æœ‰äº›äº‹æ„Ÿè§‰ä¸å¯¹åŠ²ï¼Œæ˜¯å—ï¼Ÿå¦‚æœå®ƒä¸æ˜¯ä¸€ä¸ªè¡¨å•ï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„å¯¹è±¡ï¼Œä½ ä¼šå°†`Listing`å¯¹è±¡ä¼ é€’ç»™ä¸€ä¸ª`Vehicle`ç»„ä»¶å—ï¼Ÿç„¶åå®ƒå°±å¯ä»¥è¿›å…¥æˆ¿äº§`listing.vehicle`ï¼Œè¿™å¾ˆå¥½ï¼Œä½†ä¹Ÿå¯ä»¥è¿›å…¥`listing`æœ¬èº«ï¼Œè¿™æ„Ÿè§‰å¾ˆå±é™©ã€‚æœ€ç³Ÿç³•çš„æ˜¯ï¼Œå®ƒèƒ½å¤Ÿå˜å¼‚`listing.vehicle`(æ·»åŠ /åˆ é™¤å±æ€§)ã€‚éµå¾ªå•å‘æ•°æ®ç»‘å®šåŸåˆ™ï¼Œæ‚¨æ„è¯†åˆ°è¿™æ˜¯é”™è¯¯çš„ã€‚æˆ‘æƒ³è¿™ä¹Ÿé€‚ç”¨äºè¡¨æ ¼ã€‚

## æŠŠè¡¨å•åˆ†è§£æˆå­ç»„ä»¶ï¼Œæ­£ç¡®çš„æ–¹å¼ï¼ğŸ‰

[å¡æ‹‰](https://twitter.com/karaforthewin)åœ¨ 2017 å¹´ Angular Connect çš„è¿™åœºç²¾å½©æ¼”è®²ä¸­è°ˆåˆ°äº†`ControlValueAccessor`:[https://youtu.be/CD_t3m2WMM8](https://youtu.be/CD_t3m2WMM8)

å¦‚æœæ‚¨ä»æœªå¬è¯´è¿‡`ControlValueAccessor`ï¼Œå®ƒå°†è®©æ‚¨åˆ›å»ºä¸€ä¸ªå¯ä»¥ç”¨ä½œ`FormControl`çš„ç»„ä»¶ã€‚åŸºæœ¬ä¸Šï¼Œä½ å¯ä»¥è¿™æ ·åš:

```
@Component({
  selector: 'my-custom-input',
  // ...
  providers: [
    {
      provide: NG_VALUE_ACCESSOR,
      useExisting: forwardRef(() => MyCustomInput),
      multi: true,
    },
  ],
})
export class MyCustomInput implements ControlValueAccessor {
  writeValue(obj: any): void {
    // every time the form control is
    // being updated from the parent
  }
  registerOnChange(fn: any): void {
    // when we want to let the parent
    // know that the value of the
    // form control should be updated
    // call `fn` callback
  }
  registerOnTouched(fn: any): void {
    // when we want to let the parent
    // know that the form control
    // has been touched
    // call `fn` callback
  }
  setDisabledState?(isDisabled: boolean): void {
    // when the parent updates the
    // state of the form control
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨èƒ½çœ‹å‡ºä¼ é€’`FormGroup`å®ä¾‹å’Œä½¿ç”¨`ControlValueAccessor`ä¹‹é—´çš„ä¸»è¦åŒºåˆ«å—ï¼Ÿç°åœ¨ï¼Œæˆ‘ä»¬åˆ¶ä½œä¸€ä¸ªæ„šè ¢çš„ç»„ä»¶æ—¶ä½¿ç”¨çš„æ¨¡å¼å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼

ä»¥ä¸‹æ˜¯ Angular ä¸­æ²¡æœ‰çš„ä¸œè¥¿ï¼Œä½†åªæ˜¯ä¸ºäº†è¯´æ˜æˆ‘çš„è§‚ç‚¹ï¼Œä½ å¯ä»¥è¿™æ ·æƒ³

```
 @Input() set value(obj: any) {}
  @Input() set disabledState(isDisabled: boolean): void {}

  @Output() updated: EventEmitter<any> = new EventEmitter();
  @Output() touched: EventEmitter<any> = new EventEmitter(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„:

*   å•å‘æ•°æ®æµå—åˆ°é‡è§†
*   å­ç»„ä»¶ä¸èƒ½è®¿é—®æ•´ä¸ªè¡¨å•

å¦‚æœä½ çœ‹ä¸€ä¸‹ Angular Material æºä»£ç ï¼Œä½ ä¼šæ³¨æ„åˆ°è®¸å¤šç»„ä»¶(ä½œä¸ºè¾“å…¥)æ˜¯å¦‚ä½•æ„å»ºçš„ï¼ä¾‹å¦‚ï¼Œ[é€‰æ‹©](https://github.com/angular/components/blob/c3eac1759c80a6cb34dc1d74215fce97b81316d7/src/material/select/select.ts#L228)ï¼Œ[å•é€‰](https://github.com/angular/components/blob/c3eac1759c80a6cb34dc1d74215fce97b81316d7/src/material/radio/radio.ts#L98)ï¼Œ[æ»‘åŠ¨åˆ‡æ¢](https://github.com/angular/components/blob/c3eac1759c80a6cb34dc1d74215fce97b81316d7/src/material/slide-toggle/slide-toggle.ts#L104)ï¼Œ[æ»‘å—](https://github.com/angular/components/blob/c3eac1759c80a6cb34dc1d74215fce97b81316d7/src/material/slider/slider.ts#L149)ï¼Œ...

## äº†è§£`ControlValueAccessor`çš„åŠ›é‡

åœ¨å†™å‰é¢çš„ä¾‹å­æ—¶ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå®ç°`ControlValueAccessor`çš„ç©ºç±»ï¼Œç„¶åæˆ‘çš„ IDE ç”Ÿæˆäº†æ‰€éœ€çš„æ–¹æ³•ã€‚ä½†æ˜¯è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹å…¶ä¸­çš„ä¸€ä¸ª:

```
writeValue(obj: any): void 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ æ³¨æ„åˆ°å‚æ•°çš„åå­—äº†å—ï¼Ÿ`obj`ã€‚é‚£å¾ˆæœ‰è¶£ğŸ¤”ã€‚

å¯ä»¥ä¼ é€’ä»»ä½•ç§ç±»çš„å¯¹è±¡ç»™`writeValue`ï¼ä½ ä¸å±€é™äºåƒ`string`æˆ–`number`è¿™æ ·çš„åŸå§‹ç±»å‹ã€‚ä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªæ•°ç»„ï¼Œ...å¼€å§‹æ„å»º**æ·±åº¦åµŒå¥—è¡¨å•**æ‰€éœ€çš„ä¸€åˆ‡ã€‚

å› æ­¤ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦æ„å»ºä¸€ä¸ªè¡¨å•æ¥å¤„ç†ä¸‹é¢çš„å¯¹è±¡:

```
export interface Spaceship {
  name: string;
  builtInYear: number;
  config: {
    maxSpeed: number;
    nbCanons: number;
  };
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯ä»¥:

*   åˆ›å»ºä¸€ä¸ª`SpaceshipForm`ç»„ä»¶
*   è¿™ä¸ªç»„ä»¶å°†åªå¤„ç†åŸå§‹å€¼(è¿™é‡Œæ˜¯`name`å’Œ`builtInYear`)ï¼Œå¹¶ä»å¦ä¸€ä¸ªç»„ä»¶è¯·æ±‚é…ç½®
*   åˆ›å»ºä¸€ä¸ªå­ç»„ä»¶`SpaceshipConfigForm`ï¼Œå®ƒæœ¬èº«åªå¤„ç†åŸå§‹å€¼(åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯æ‰€æœ‰çš„åŸå§‹å€¼)

ä½†æ˜¯è®©æˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬ä¸€çº§ç»„ä»¶(`SpaceshipForm`)ï¼Œçœ‹çœ‹ä¸ºä»€ä¹ˆåœ¨æ¯ä¸ªå­ç»„ä»¶ä¸Šè¿™æ ·åšè´Ÿæ‹…å¾ˆå°:

```
@Component({
  selector: 'my-custom-input',
  // ...
  providers: [
    {
      provide: NG_VALUE_ACCESSOR,
      useExisting: forwardRef(() => MyCustomInput),
      multi: true,
    },
  ],
})
export class MyCustomInput implements ControlValueAccessor, OnInit, OnDestroy {
  private onChange: (value: any) => void;
  private onTouched: () => void;
  private onDestroy$: Subject<void> = new Subject();

  public internalFormGroup: FormGroup = new FormGroup({
    name: new FormControl(),
    builtInYear: new FormControl(),
    config: new FormControl(),
  });

  public ngOnInit(): void {
    this.internalFormGroup.valueChanges
      .pipe(
        tap(value => {
          this.onChange(value);
          this.onTouched();
        }),
        takeUntil(this.onDestroy$),
      )
      .subscribe();
  }

  public ngOnDestroy(): void {
    this.onDestroy$.next();
    this.onDestroy$.complete();
  }

  writeValue(obj: any): void {
    // every time the form control is
    // being updated from the parent

    this.internalFormGroup.setValue(obj, { emitEvent: false });

    this.internalFormGroup.markAsPristine();
    this.internalFormGroup.markAsUntouched();
  }
  registerOnChange(fn: any): void {
    // when we want to let the parent
    // know that the value of the
    // form control should be updated

    this.onChange = fn;
  }
  registerOnTouched(fn: any): void {
    // when we want to let the parent
    // know that the form control
    // has been touched

    this.onTouched = fn;
  }
  setDisabledState?(isDisabled: boolean): void {
    // when the parent updates the
    // state of the form control

    if (isDisabled) {
      this.internalFormGroup.disable();
    } else {
      this.internalFormGroup.enable();
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€»è¾‘æœ¬èº«å¹¶ä¸å¤æ‚ï¼Œä½†æœ‰ä¸€ç‚¹æ˜¯è‚¯å®šçš„:**å®ƒå¾ˆå†—é•¿**ã€‚è¿™åªæ˜¯ä¸€ä¸ªå¾ˆå°çš„ä¾‹å­ï¼Œä½ å¯ä»¥æŠŠäº‹æƒ…åšå¾—æ›´è¿›ä¸€æ­¥ã€‚ä½†æ˜¯å·²ç»~75 è¡Œäº†ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œä»…ä»…å¤„ç†æ¥è‡ªé‚£ä¸ªç»„ä»¶çš„ 2 ä¸ªè¾“å…¥ä¼¼ä¹å¤ªå¤šäº†ğŸ¤·â€â™‚ï¸.

å¸Œæœ›ä½ èƒ½å‘ç°ä¸ºä»€ä¹ˆå†™è¿™ç¯‡åšå®¢(æ˜¯æ—¶å€™äº†å§ï¼Ÿ)ä»¥åŠå¦‚ä½•æ›´å¥½åœ°å¤„ç†ä¸Šè¿°ä»£ç ã€‚

# Ngx-å­è¡¨å•:å°†ä¸€ä¸ªè§’åº¦è¡¨å•åˆ†è§£æˆå¤šä¸ªå­ç»„ä»¶çš„å®ç”¨ç¨‹åºåº“

æ­£å¦‚é‚£ç¯‡æ–‡ç« çš„ä¸Šä¸‹æ–‡éƒ¨åˆ†ç®€è¦è§£é‡Šçš„é‚£æ ·ï¼Œæˆ‘ä»¬å·²ç»åœ¨ [CloudNC](https://cloudnc.com) å¼€å‘äº†ä¸€ä¸ªåº“ï¼Œå®ƒå°†ä¸ºæ‚¨å¤„ç†æ‰€æœ‰çš„æ ·æ¿æ–‡ä»¶ï¼Œå¹¶ä¸ºæ‚¨æä¾›ä¸€äº›å¾ˆå¥½çš„å¸®åŠ©ã€‚å®ƒå« [`ngx-sub-form`](https://github.com/cloudnc/ngx-sub-form) ã€‚

è¿™ä¸ªåº“è¢«å‘å¸ƒåœ¨ Github å’Œ T2 NPM ä¸Šï¼Œå¹¶è·å¾—äº†éº»çœç†å·¥å­¦é™¢çš„è®¸å¯ï¼Œå·²ç»å¯ä»¥ä½¿ç”¨äº†ã€‚æˆ‘ä»¬åœ¨ Github åº“ä¸Šåšäº†ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­/æ¼”ç¤ºï¼Œä¹Ÿç»è¿‡äº†å¾ˆå¥½çš„æµ‹è¯•(åŒ…æ‹¬ E2E å’Œé›†æˆ)ã€‚æˆ‘ä»¬ä¹Ÿç”¨å®ƒé‡å†™äº†å¾ˆå¤šæˆ‘ä»¬è‡ªå·±çš„è¡¨å•ï¼Œæˆ‘ä»¬ç›¸ä¿¡å®ƒç°åœ¨è¶³å¤Ÿç¨³å®šï¼Œå¯ä»¥è¢«å…¶ä»–äººä½¿ç”¨ï¼Œæ‰€ä»¥è¯·åœ¨æ‚¨è‡ªå·±çš„é¡¹ç›®ä¸­å°è¯•ä¸€ä¸‹å§ï¼

## `ngx-sub-form`èƒ½æä¾›ä»€ä¹ˆ

*   ç”¨æœ€å°‘çš„æ ·æ¿æ–‡ä»¶è½»æ¾åˆ›å»ºå­è¡¨å•æˆ–è‡ªå®šä¹‰`ControlValueAccessor`
*   åœ¨ç»„ä»¶çš„`.ts`å’Œ`.html`æ–‡ä»¶ä¸­é”®å…¥ safety
*   è®¿é—®è¡¨å•çš„æ‰€æœ‰å€¼ï¼Œç”šè‡³æ˜¯åµŒå¥—çš„å€¼
*   è®¿é—®è¡¨å•çš„æ‰€æœ‰é”™è¯¯ï¼Œç”šè‡³æ˜¯åµŒå¥—çš„é”™è¯¯(è¿™åœ¨`FormGroup` s ä¸Šä¸æ˜¯æœ¬åœ°æ”¯æŒçš„ï¼Œå‚è§[https://github.com/angular/angular/issues/10530](https://github.com/angular/angular/issues/10530)
*   æ‚¨åº”è¯¥èƒ½å¤Ÿå¤„ç†å¤§éƒ¨åˆ†åŒæ­¥å€¼ï¼Œè€Œä¸å¿…å¤„ç†æµ
*   å°†åŸå§‹æ•°æ®é‡æ–°æ˜ å°„åˆ°æ¯ä¸ªçª—ä½“/å­çª—ä½“æ‰€éœ€çš„å½¢çŠ¶(å¹¶ä¿æŒå…¶ç±»å‹å®‰å…¨)
*   ä»¥ä¸€ç§ç®€å•çš„æ–¹å¼å¤„ç†è¡¨å•ä¸­çš„å¤šæ€æ•°æ®

## åº”è¯¥ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ

ä½ æœ‰è¡¨æ ¼å—ï¼Ÿ

> æ˜¯

é‚£å°±ç”¨å§ã€‚

> æˆ‘çš„è¡¨å•å¾ˆå°è€Œä¸”éå¸¸ç®€å•ï¼Œæˆ‘ä¸ç¡®å®šå®ƒæ˜¯å¦å€¼å¾—

ä½ å°†å¾—åˆ°ç±»å‹å®‰å…¨ï¼Œæ›´å°‘çš„æ ·æ¿æ–‡ä»¶å’Œä¸€äº›å…è´¹çš„åŠ©æ‰‹ã€‚

é™¤éä½ çœŸçš„åªæœ‰ä¸€ä¸ª`FormControl`æ¥å¤„ç†ä¸€ä¸ªæœç´¢è¾“å…¥ï¼Œä½ åº”è¯¥ä½¿ç”¨å®ƒã€‚

[![](img/6f59e463dd771d48b25aa3dda704748d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--s7TlxUCy--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/dknl4ccqo9ikw2v60vie.png)

> è¯å¤Ÿäº†ï¼Œç»™æˆ‘çœ‹çœ‹ä»£ç ï¼

## æ„å»ºæ¼”ç¤º

æˆ‘ä»¬ç°åœ¨å°†é‡æ„å‰é¢çš„ç»„ä»¶ï¼Œåªæ˜¯è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†æ„å»ºæ•´ä¸ªè¡¨å•(åŒ…æ‹¬é…ç½®ï¼).

è¿™é‡Œæœ‰ä¸€ä¸ªæ¥å£ä½œä¸ºæé†’:

*æˆ‘ç°åœ¨å·²ç»æŠŠå®ƒåˆ†è§£æˆäº† 2 ä¸ªï¼Œå°±åƒæˆ‘ä»¬é€šå¸¸ä¼š/åº”è¯¥åšçš„é‚£æ ·ï¼*

```
export interface SpaceshipConfig {
  maxSpeed: number;
  nbCanons: number;
}

export interface Spaceship {
  name: string;
  builtInYear: number;
  config: SpaceshipConfig;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

çœ‹ç€ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°çŒœåˆ°æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆæ ·çš„æ¶æ„:

*   **spaceship-container** :æ™ºèƒ½ç»„ä»¶ï¼Œå½“è¡¨å•æœ‰æ•ˆä¸”æ­£åœ¨å‘é€æ—¶ï¼Œå®ƒå°†æ³¨å…¥ä¸€ä¸ªæœåŠ¡æ¥æ£€ç´¢æˆ–ä¿å­˜ä¸€è‰˜é£èˆ¹
*   **é£èˆ¹è¡¨å•**:é¡¶å±‚è¡¨å•çš„å“‘ç»„ä»¶ï¼Œè´Ÿè´£å¤„ç†`Spaceship`çš„ç¬¬ä¸€ä¸ªå€¼
*   **spaceship-config-form** :å“‘ç»„ä»¶ï¼Œæ˜¯ä¸€ä¸ªå­è¡¨å•ï¼Œåªè´Ÿè´£é…ç½®éƒ¨åˆ†

[![](img/73078129c14853b60d5129b221721aea.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--om7l9prY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/f8x6ojs1xaaui965q8h4.png)

æˆ‘ä»¬å°†ä»åº•éƒ¨ç»„ä»¶å¼€å§‹ï¼Œç„¶åä»é‚£é‡Œå‘ä¸Šã€‚ä¸‹é¢æ˜¯æˆ‘å°†è¦ä»‹ç»çš„å†…å®¹çš„ç°åœºæ¼”ç¤º:[https://stackblitz.com/edit/ngx-sub-form-basics](https://stackblitz.com/edit/ngx-sub-form-basics)

å½“æ‚¨æƒ³åœ¨ä¸Šä¸‹æ–‡ä¸­æŸ¥çœ‹ä»£ç æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Stackblitz å¹¶è·Ÿéšå®ƒã€‚

[https://stackblitz.com/edit/ngx-sub-form-basics?embed=1&view=preview&](https://stackblitz.com/edit/ngx-sub-form-basics?embed=1&view=preview&)

**é£èˆ¹-é…ç½®-è¡¨å•.ç»„ä»¶. ts** :

```
@Component({
  selector: 'app-spaceship-config-form',
  templateUrl: './spaceship-config-form.component.html',
  providers: subformComponentProviders(SpaceshipConfigFormComponent),
})
export class SpaceshipConfigFormComponent extends NgxSubFormComponent<SpaceshipConfig> {
  protected getFormControls(): Controls<SpaceshipConfig> {
    return {
      maxSpeed: new FormControl(),
      nbCanons: new FormControl(),
    };
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æ‚¨æ‰€è§ï¼Œè¿™æ˜¯ä¸€ä¸ªå­è¡¨å•ç»„ä»¶ï¼Œæ ·æ¿æ–‡ä»¶å¾ˆå°‘ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹çº¿

```
providers: subformComponentProviders(SpaceshipConfigFormComponent), 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“æ„å»ºä¸€ä¸ª`ControlValueAccessor`æ—¶ï¼Œå¦‚æœå¸Œæœ›èƒ½å¤Ÿå¤„ç†éªŒè¯ï¼Œæ‚¨è‡³å°‘éœ€è¦æä¾›`NG_VALUE_ACCESSOR`å¹¶é€šè¿‡`NG_VALIDATORS`ã€‚å®ƒé€šå¸¸çœ‹èµ·æ¥å¦‚ä¸‹:

```
{
  // ...
  providers: [
    {
      provide: NG_VALUE_ACCESSOR,
      useExisting: forwardRef(() => component),
      multi: true,
    },
    {
      provide: NG_VALIDATORS,
      useExisting: forwardRef(() => component),
      multi: true,
    },
  ];
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€æœ‰è¿™äº›éƒ½è¢«ç®€åŒ–ä¸ºä¸€è¡Œå®ç”¨å‡½æ•°`subformComponentProviders`,æ‚¨åªéœ€è¦æä¾›å½“å‰çš„ç±»ã€‚å®ƒè¿˜å¯ä»¥ä¸ AoT ç¼–è¯‘å™¨ä¸€èµ·å·¥ä½œã€‚

ç„¶åï¼Œæ³¨æ„è¿™ä¸€è¡Œ:

```
export class SpaceshipConfigFormComponent extends NgxSubFormComponent<SpaceshipConfig> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€šè¿‡è¿™æ ·åšï¼Œä½ å¯ä»¥æ¥è§¦åˆ°å¾ˆå¤š

**å±æ€§**:

*   `formGroup`:å®é™…çš„è¡¨å•ç»„ï¼Œç”¨äºå®šä¹‰è§†å›¾çš„ç»‘å®š`[formGroup]="formGroup"`
*   `formControlNames`:è¡¨å•ä¸­æ‰€æœ‰å¯ç”¨çš„æ§ä»¶åç§°ã€‚å½“å®šä¹‰ä¸€ä¸ª`formControlName`æ—¶ä½¿ç”¨å®ƒï¼Œæ¯”å¦‚:`<input [formControlName]="formControlNames.yourControl">`ï¼Œå¦‚æœä½ æ”¹å˜ä¸€ä¸ªæ¥å£ï¼Œå®ƒä¼šåœ¨ç¼–è¯‘æ—¶(ç”¨ AOT)æ•æ‰é”™è¯¯ï¼
*   `formGroupControls`:ä½ çš„çª—ä½“çš„æ‰€æœ‰æ§ä»¶ï¼Œæœ‰åŠ©äºé¿å…åš`formGroup.get(formControlNames.yourControl)`ï¼›ç›¸ååªæ˜¯åš`formGroupControls.yourControl`
*   `formGroupValues`:ç›´æ¥è®¿é—®ä½ çš„è¡¨å•çš„æ‰€æœ‰å€¼ï¼Œä¸éœ€è¦åš`formGroup.get(formControlNames.yourControl).value`ï¼Œåªéœ€è¦åš`formGroupValues.yourControl`(å°±èƒ½æ­£ç¡®è¾“å…¥äº†ï¼)
*   `formGroupErrors`:å½“å‰è¡¨æ ¼**çš„æ‰€æœ‰é”™è¯¯ï¼ŒåŒ…æ‹¬**å­é”™è¯¯(å¦‚æœæœ‰)ã€‚ç”¨`formGroupErrors`æˆ–è€…`formGroupErrors?.yourControl`å°±å¯ä»¥äº†ã€‚æ³¨æ„`formGroupErrors?.yourControl`ä¸­çš„é—®å·ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯**å°†è¿”å›`null`**

**æ–¹æ³•**:

*   é’©å­:å…è®¸ä½ åœ¨è¡¨å•è¢«ä¿®æ”¹æ—¶åšå‡ºååº”ã€‚ä¸ç”¨è®¢é˜…`this.formGroup.valueChanges`æˆ–`this.formControls.someProp.valueChanges`ï¼Œä½ ä¸å¿…å¤„ç†ä»»ä½•å¼‚æ­¥çš„äº‹æƒ…ï¼Œä¹Ÿä¸å¿…æ‹…å¿ƒè®¢é˜…å’Œå†…å­˜æ³„æ¼ã€‚åªéœ€å®ç°æ–¹æ³•`onFormUpdate(formUpdate: FormUpdate<FormInterface>): void`ï¼Œå¦‚æœæ‚¨éœ€è¦çŸ¥é“å“ªä¸ªå±æ€§å‘ç”Ÿäº†å˜åŒ–ï¼Œè¯·è¿›è¡Œå¦‚ä¸‹æ£€æŸ¥:`if (formUpdate.yourProperty) {}`ã€‚è¯·æ³¨æ„ï¼Œåªæœ‰å½“çª—ä½“å‘ç”Ÿæœ¬åœ°æ›´æ”¹æˆ–å­çª—ä½“å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œæ‰ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚å¦‚æœçˆ¶æ–¹æ³•è°ƒç”¨äº†`setValue`æˆ–`patchValue`ï¼Œè¿™ä¸ªæ–¹æ³•å°†ä¸ä¼šè¢«è°ƒç”¨
*   `getFormGroupControlOptions` hook:å…è®¸æ‚¨å®šä¹‰å†…éƒ¨`FormGroup`æ„é€ çš„æ§åˆ¶é€‰é¡¹ã€‚ä½¿ç”¨å®ƒæ¥å®šä¹‰`FormGroup`çº§éªŒè¯å™¨
*   `handleEmissionRate` hook:å…è®¸æ‚¨å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰æ’æ”¾ç‡(é¡¶å±‚æˆ–ä»»ä½•å­å±‚)

ç°åœ¨ä½ ä¸€å®šè®¤ä¸ºå®ƒå¼€å§‹å˜å¾—å¾ˆå¤šäº†ï¼Œå¸Œæœ›åœ¨é‚£ä¹‹åæˆ‘ä»¬ä¸ä¼šå¢åŠ å¤ªå¤šã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šå¾ˆé«˜å…´åœ°çŸ¥é“ï¼Œè¿™æ¶µç›–äº†å¤§éƒ¨åˆ†çš„`ngx-sub-form`ï¼Œå…¶ä½™çš„ç°åœ¨ä¼šæ„Ÿè§‰ä¼¼æ›¾ç›¸è¯†ã€‚

**spaceship-config-form.component.html**:

```
<fieldset [formGroup]="formGroup">
  <legend>Config</legend>

  Maximum speed
  <input type="number" [formControlName]="formControlNames.maxSpeed" />

  Number of canons
  <input type="number" [formControlName]="formControlNames.nbCanons" />
</fieldset> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘è®¤ä¸ºä¸éœ€è¦è¿›ä¸€æ­¥çš„è§£é‡Šã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è½¬åˆ°é¡¶çº§è¡¨å•ã€‚

**é£èˆ¹-è¡¨å•.ç»„ä»¶. ts** :

```
@Component({
  selector: 'app-spaceship-form',
  templateUrl: './spaceship-form.component.html',
})
export class SpaceshipFormComponent extends NgxRootFormComponent<Spaceship> {
  @DataInput()
  @Input('spaceship')
  public dataInput: Spaceship | null | undefined;

  @Output('spaceshipUpdated')
  public dataOutput: EventEmitter<Spaceship> = new EventEmitter();

  protected getFormControls(): Controls<Spaceship> {
    return {
      name: new FormControl(),
      builtInYear: new FormControl(),
      config: new FormControl(),
    };
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯¥ç»„ä»¶çš„ç›®çš„ä¸æ˜¯åƒä»¥å‰çš„ç»„ä»¶ä¸€æ ·ç»‘å®šåˆ°`FormControl`,è€Œæ˜¯:

*   èƒ½å¤Ÿä»ä¸€ä¸ª`Input` ( `dataInput`ï¼Œä½ å½“ç„¶å¯ä»¥é‡å‘½å)æ›´æ–°è¡¨å•
*   ä¸€æ—¦è¡¨å•æœ‰æ•ˆå¹¶ä¿å­˜(é€šè¿‡`Output` `dataOutput`ï¼Œä¹Ÿå¯ä»¥é‡å‘½å)ï¼Œå°±èƒ½å¤Ÿå…±äº«(å‘å‡º)æ–°å€¼

æ³¨æ„:ä½¿ç”¨`NgxRootFormComponent`ã€`dataInput`æ—¶**æ˜¯å¦éœ€è¦**é…åˆ`@DataInput()`è£…é¥°å™¨ä½¿ç”¨ã€‚èƒŒåçš„åŸå› å¾ˆç®€å•:`ngx-sub-form`æ²¡æœ‰åŠæ³•çŸ¥é“ä½ å°†å¦‚ä½•é‡å‘½åä½ çš„è¾“å…¥ï¼Œå®ƒç¡®å®éœ€è¦ä¸€ä¸ªé’©å­åœ¨å€¼æ”¹å˜æ—¶å¾—åˆ°è­¦å‘Šã€‚æˆ‘ä»¬ç”¨[è£…é¥°å™¨](https://github.com/cloudnc/ngx-sub-form/blob/master/projects/ngx-sub-form/src/lib/ngx-sub-form.decorators.ts)æ¥å¤„ç†æ‰€æœ‰çš„äº‹æƒ…ï¼Œè€Œä¸æ˜¯è®©ä½ ä»`ngOnChanges`é’©å­ä¸­è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ–è€…åœ¨è¾“å…¥ä¸Šåˆ›å»ºä¸€ä¸ª setter å¹¶è°ƒç”¨ç›¸åŒçš„æ–¹æ³•ã€‚

è®©æˆ‘ä»¬å¿«é€Ÿæµè§ˆä¸€ä¸‹é£æ™¯ã€‚

**spaceship-form.component.html**:

```
<form [formGroup]="formGroup">
  <fieldset>
    <legend>Spaceship</legend>
    Name
    <input type="text" [formControlName]="formControlNames.name" />

    Built in year
    <input type="number" [formControlName]="formControlNames.builtInYear" />

    <app-spaceship-config-form [formControlName]="formControlNames.config"></app-spaceship-config-form>

    <button (click)="manualSave()">Save</button>
  </fieldset>
</form>

<pre>{{ formGroup.value | json }}</pre> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ²¡ä»€ä¹ˆç‰¹åˆ«æ–°çš„ï¼Œä½†æ˜¯æ³¨æ„æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨`formGroup.value`æ¥æ˜¾ç¤ºæ•´ä¸ªè¡¨å•å€¼(è¿™é‡Œæ˜¯ä¸ºäº†è°ƒè¯•ç›®çš„),å¹¶ä¸”ä¸ºäº†ä¿å­˜è¡¨å•ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨`NgxRootFormComponent`æ—¶ç®€å•åœ°è°ƒç”¨`ngx-sub-form`æä¾›çš„`manualSave`æ–¹æ³•ã€‚

ä¸€æ—¦æˆ‘ä»¬è°ƒç”¨`manualSave`ï¼Œå¦‚æœè¡¨å•æœ‰æ•ˆï¼Œå®ƒå°†é€šè¿‡è¾“å‡ºå‘å‡ºè¡¨å•çš„å€¼ã€‚è¿™æ ·ï¼Œçˆ¶å¯¹è±¡å¯ä»¥ç®€å•åœ°æ£€ç´¢ä¸€ä¸ªæ–°çš„`Spaceship`å¯¹è±¡å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†(å°†å®ƒæ”¾å…¥æœ¬åœ°å­˜å‚¨ï¼Œå°†å…¶ä¼ é€’ç»™ä¸€ä¸ªæœåŠ¡ä»¥ä¾¿ç”¨å®ƒè¿›è¡Œ HTTP è°ƒç”¨ï¼Œç­‰ç­‰)ã€‚ä½†æ˜¯**è¡¨å•åªå¯¹è¡¨å•æœ¬èº«è´Ÿè´£**ï¼Œæ™ºèƒ½ç»„ä»¶(çˆ¶)ç”šè‡³ä¸çŸ¥é“è¡¨å•ã€‚å®ƒåªæ˜¯çŸ¥é“æœ‰æ–°çš„å€¼å¯ç”¨ã€‚

è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹çˆ¶ç»„ä»¶ã€‚

**é£èˆ¹-å®¹å™¨.ç»„ä»¶. ts**

```
// only to demo that passing a value as input will update the form
// but this info might come from a server for example when you want to
// edit an existing value
const getDefaultSpaceship = (): Spaceship => ({
  name: 'Galactico',
  builtInYear: 2500,
  config: {
    maxSpeed: 8000,
    nbCanons: 10,
  },
});

@Component({
  selector: 'app-spaceship-container',
  templateUrl: './spaceship-container.component.html',
})
export class SpaceshipContainerComponent {
  public spaceship$: Subject<Spaceship> = new Subject();

  public preFillForm(): void {
    this.spaceship$.next(getDefaultSpaceship());
  }

  public spaceshipUpdated(spaceship: Spaceship): void {
    // from here, you can pass that value to a
    // service to save/update it on a backend for example
    console.log(spaceship);
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ‰è¶£çš„æ˜¯ï¼Œå½“ä¿å­˜è¡¨å•æ—¶ï¼Œæ£€ç´¢æ•°æ®å¡«å……è¡¨å•å¹¶æ”¶é›†è¡¨å•æ–°å€¼çš„æ™ºèƒ½ç»„ä»¶åªæœ‰**å’Œ**å¤„ç†ç±»å‹ä¸º`Spaceship`çš„å¯¹è±¡ã€‚æ²¡æœ‰ä¸€ä¸ª`FormGroup`å®ä¾‹æˆ–`FormControl`è¢«å£°æ˜/ä½¿ç”¨ã€‚æˆ‘ä»¬åªæ˜¯å°†è¿™ä¸€èŒè´£å§”æ‰˜ç»™`SpaceshipFormComponent`ã€‚è¿™çœŸçš„å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºå¦‚æœä»¥åæˆ‘ä»¬æƒ³åœ¨åº”ç”¨ç¨‹åºä¸­æ˜¾ç¤ºä¸€ä¸ª`Spaceship`ï¼Œæˆ‘ä»¬å¯ä»¥é‡ç”¨è¿™ä¸ªè¡¨å•å¹¶ç¦ç”¨å®ƒï¼Œæ‰€ä»¥å®ƒæ˜¯åªè¯»çš„ã€‚ä¸ºä»€ä¹ˆ`NgxRootFormComponent`å’Œ`NgxAutomaticRootFormComponent`éƒ½æœ‰å¯é€‰çš„è¾“å…¥å±æ€§`disabled`ã€‚ç®€å•åœ°ç»‘å®šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå½“å€¼ä¸º`true`æ—¶ï¼Œè¡¨å•å°†æ˜¯åªè¯»çš„ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œæ•´ä¸ªè¡¨å•å°†æ˜¯åªè¯»çš„ï¼Œä¹ŸåŒ…æ‹¬æ‰€æœ‰å­è¡¨å•ç»„ä»¶ğŸ‘ã€‚

è¿™é‡Œçš„è§†å›¾éå¸¸ç®€å•ï¼Œä½†ä¸ºäº†å®Œæ•´èµ·è§:

**spaceship-container.component.html**T2ã€‘

```
<button (click)="preFillForm()">Pre fill form (demo)</button>

<app-spaceship-form [spaceship]="spaceship$ | async" (spaceshipUpdated)="spaceshipUpdated($event)"></app-spaceship-form> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## è¿›ä¸€æ­¥ä½¿ç”¨é‡æ˜ å°„å’Œ/æˆ–å¤šæ€

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•å°†è¡¨å•åˆ†è§£æˆæ›´å°çš„ç»„ä»¶ã€‚ç°åœ¨å‰©ä¸‹çš„æœ€åä¸€ç‚¹æ˜¯å‘ç°å¦‚ä½•å¤„ç†å¸¦æœ‰å¤šæ€æ•°æ®çš„è¡¨å•ã€‚

å…ˆæ¥ä¸ªå…³äº`polymorphism` ( [ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Polymorphism_(computer_science)))çš„å°æé†’:

> åœ¨ç¼–ç¨‹è¯­è¨€å’Œç±»å‹ç†è®ºä¸­ï¼Œå¤šæ€æ€§æ˜¯æŒ‡ä¸ºä¸åŒç±»å‹çš„å®ä½“æä¾›ä¸€ä¸ªæ¥å£ï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªç¬¦å·æ¥è¡¨ç¤ºå¤šä¸ªä¸åŒçš„ç±»å‹ã€‚

æœ¬æ–‡å¼€å¤´ä½¿ç”¨æ¥å£çš„ä¾‹å­:

```
export type OneListing = VehicleListing | DroidListing; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€ä¸ªç±»å‹ä¸º`OneListing`çš„å¯¹è±¡æ—¢å¯ä»¥æ˜¯`VehicleListing`ä¹Ÿå¯ä»¥æ˜¯`DroidListing`ã€‚

å³ä½¿å®ƒå¯èƒ½ä¸æ˜¯ä½ åœ¨è¡¨å•ä¸­ä¸€ç›´ä½¿ç”¨çš„é‚£ç§ç»“æ„ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªç›¸å½“å¸¸è§çš„ç”¨ä¾‹ï¼Œ`ngx-sub-form`æä¾›äº†ä¸€ä¸ªä¸“é—¨çš„ç±»æ¥å¤„ç†å®ƒ:`NgxSubFormRemapComponent<ControlInterface, FormInterface>`ã€‚

*æ³¨æ„`NgxRootFormComponent`å’Œ`NgxAutomaticRootFormComponent`éƒ½ä½¿ç”¨`NgxSubFormRemapComponent`ä½œä¸ºåŸºç±»ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æä¾›çš„æ–¹æ³•åœ¨å®ƒä»¬ä¹‹é—´é‡æ–°æ˜ å°„ã€‚*

ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬å°†ä¸ºè¡¨å•çš„è¿™ä¸€éƒ¨åˆ†åˆ›å»ºä¸€ä¸ªæ–°çš„ç•Œé¢ï¼Œå®ƒå°†å…·æœ‰:

*   ä¸€ä¸ªæ¡ç›®ï¼Œäº†è§£å½“å‰é€‰æ‹©çš„ç±»å‹
*   æ¯ç§å¯èƒ½çš„ç±»å‹éƒ½æœ‰ä¸åŒçš„æ¡ç›®

æˆ‘ä»¬çš„ä¾‹å­:

```
export type OneListing = VehicleListing | DroidListing;

export enum OneListingType {
  VEHICLE = 'Vehicle',
  DROID = 'Droid',
}

export interface OneListingForm {
  listingType: OneListingType | null;
  vehicle: VehicleListing | null;
  droid: DroidListing | null;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·åˆ›å»ºæˆ‘ä»¬çš„ç»„ä»¶:

```
@Component({
  selector: 'app-one-listing-form',
  templateUrl: '...',
})
export class OneListingForm extends NgxRootFormComponent<OneListing, OneListingForm> {
  // note that we use `NgxRootFormComponent` as it extends `NgxSubFormRemapComponent`
  // and this is the top level form; that's why we will be using `NgxRootFormComponent`
  // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­¤æ—¶ï¼ŒTypescript å°†æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ï¼Œå¹¶å‘Šè¯‰æ‚¨éœ€è¦æ­£ç¡®å®ç°è¯¥ç±»ã€‚

```
@Component({
  selector: 'app-one-listing-form',
  templateUrl: '...',
})
export class OneListingForm extends NgxSubFormRemapComponent<OneListing, OneListingForm> {
  @DataInput()
  @Input('listing')
  public dataInput: OneListing | null | undefined;

  @Output('listingUpdated')
  public dataOutput: EventEmitter<OneListing> = new EventEmitter();

  public OneListingType: typeof OneListingType = OneListingType;

  protected getFormControls(): Controls<OneListingForm> {
    return {
      listingType: new FormControl(null, { validators: [Validators.required] }),
      vehicle: new FormControl(null),
      droid: new FormControl(null),
    };
  }

  protected transformToFormGroup(obj: OneListing): OneListingForm {
    return {
      listingType: obj.listingType,
      vehicle: obj.listingType === OneListingType.VEHICLE ? obj : null,
      droid: obj.listingType === OneListingType.DROID ? obj : null,
    };
  }

  protected transformFromFormGroup(formValue: OneListingForm): OneListing | null {
    switch (formValue.listingType) {
      case OneListingType.VEHICLE:
        return formValue.vehicle;
      case OneListingType.DROID:
        return formValue.droid;
      case null:
        return null;
      default:
        throw new UnreachableCase(formValue.listingType);
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ç§æ–°æ–¹æ³•æ¥å¤„ç†å¤šæ€æ•°æ®:

*   `transformToFormGroup`:å°†å†™åœ¨è¯¥å­ç»„ä»¶ä¸Šçš„å€¼ä½œä¸ºå‚æ•°ä¼ é€’(æˆ–è€…å¦‚æœä½¿ç”¨é¡¶çº§ç»„ä»¶ï¼Œåˆ™é€šè¿‡`dataInput`),å¹¶å°†è¯¥å€¼é‡æ–°æ˜ å°„åˆ°ä¸€ä¸ªå†…éƒ¨å€¼ï¼Œè¯¥å€¼å°†å¤šæ€å¯¹è±¡åˆ†å‰²æˆå•ç‹¬çš„å®ä½“
*   `transformFromFormGroup`:ä¼ é€’è¡¨å•çš„å€¼ï¼Œå¹¶æœŸæœ›è¾“å‡ºä¸€ä¸ªä¸åŸå§‹æ¥å£åŒ¹é…çš„å¯¹è±¡

åœ¨`transformToFormGroup`æ–¹æ³•ä¸­ï¼Œå¦‚æœä½ çš„ä¸åŒå¯¹è±¡æœ‰ä¸€ä¸ª**é‰´åˆ«å™¨**å±æ€§ï¼Œè¿™å°†éå¸¸ç®€å•ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒä»¬æ˜¯:

```
export interface VehicleListing extends BaseListing {
  listingType: ListingType.VEHICLE; // discriminator
  product: OneVehicle;
}

export interface DroidListing extends BaseListing {
  listingType: ListingType.DROID; // discriminator
  product: OneDroid;
}

export type OneListing = VehicleListing | DroidListing; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`listingType`å±æ€§æ˜¯`VehicleListing`å’Œ`DroidListing`å…±æœ‰çš„ï¼Œä½†æ˜¯åœ¨ä¸¤ç§æƒ…å†µä¸‹éƒ½è¢«è®¾ç½®ä¸ºä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„å€¼ã€‚è¿™å…è®¸æˆ‘ä»¬åšä¸€ä¸ªéå¸¸ç®€å•çš„æ£€æŸ¥ï¼Œå¦‚ä¸‹:

```
protected transformToFormGroup(obj: OneListing): OneListingForm {
  return {
    listingType: obj.listingType,
    vehicle: obj.listingType === OneListingType.VEHICLE ? obj : null,
    droid: obj.listingType === OneListingType.DROID ? obj : null,
  };
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ çš„å±æ€§æ²¡æœ‰é‰´åˆ«å™¨ï¼Œä½ éœ€è¦æ ¹æ®å…¶ä»–å±æ€§æ¥åŒºåˆ†å®ƒä»¬ï¼Œä½†æ˜¯æˆ‘å¼ºçƒˆå»ºè®®ä½ æ·»åŠ ä¸€ä¸ªé‰´åˆ«å™¨ï¼Œå¦‚æœä½ èƒ½æ§åˆ¶ç•Œé¢çš„è¯ï¼Œå› ä¸ºè¿™å°†ä½¿äº‹æƒ…å˜å¾—æ›´å®¹æ˜“ï¼Œä¸ä»…ä»…æ˜¯å¯¹ä½ çš„è¡¨å•ã€‚

`transformFromFormGroup`æ–¹æ³•ä¹Ÿå¾ˆç®€å•â€”â€”åŸºäºè¡¨å•å€¼`listingType`,æˆ‘ä»¬å°†ä»è¡¨å•ä¸­è¿”å›é€‚å½“çš„å€¼:

```
protected transformFromFormGroup(formValue: OneListingForm): OneListing | null {
  switch (formValue.listingType) {
    case OneListingType.VEHICLE:
      return formValue.vehicle;
    case OneListingType.DROID:
      return formValue.droid;
    case null:
      return null;
    default:
      throw new UnreachableCase(formValue.listingType);
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æŠ›å‡ºé”™è¯¯çš„ä»£ç è¡Œä¸åº”è¯¥å‘ç”Ÿï¼Œè¿™é‡Œä¸»è¦æ˜¯å› ä¸ºç±»å‹å®‰å…¨çš„åŸå› ï¼Œå› ä¸ºå®ƒä¼šå¼ºè¿«ä½ å®ç°æ‰€æœ‰çš„æƒ…å†µ:

```
throw new UnreachableCase(formValue.listingType); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨è‡ªå·±çš„é¡¹ç›®ä¸­æ²¡æœ‰ç±»ä¼¼çš„ä¸œè¥¿ï¼Œæ‚¨å¯ä»¥å°†ä»¥ä¸‹å†…å®¹æ”¾åœ¨ä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹ä¸­

```
export class UnreachableCase {
  constructor(payload: never) {}
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœå°†æ¥æˆ‘ä»¬å‘`OneListingType`æšä¸¾æ·»åŠ æˆ–ç§»é™¤å…¶ä¸­ä¸€ä¸ªå€¼ï¼ŒTypescript å°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå¹¶ç¡®ä¿æˆ‘ä»¬ä¸ä¼šå¿˜è®°ä»»ä½•ç”¨ä¾‹ã€‚

# æ±‡æ€»å¹¶å–èµ°

è¿™ç¯‡æ–‡ç« ç°åœ¨å³å°†ç»“æŸï¼Œæˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ä¸ª(æ–°ï¼Ÿ)å¤„ç†è¡¨å•çš„æ–¹å¼ã€‚ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬å·²ç»éå¸¸æ·±å…¥åœ°äº†è§£äº†ç»†èŠ‚ï¼Œå¹¶ä¸”è¿™æ˜¯ä¸€ä¸ªå°†è¿‘ 20 åˆ†é’Ÿçš„é˜…è¯»ï¼Œæˆ‘æƒ³å¯¹æ‚¨åº”è¯¥è®°ä½çš„é‡è¦å†…å®¹åšä¸€ä¸ªå°æ€»ç»“:

*   åˆ†è§£ä½ çš„è¡¨æ ¼ï¼Œè¿™ä¼šè®©äº‹æƒ…æ›´å®¹æ˜“æ¨ç†å’Œå¤„ç†
*   æ›´å–œæ¬¢ä¸€ä¸ª`ControlValueAccessor`ï¼Œè€Œä¸æ˜¯å°†ä½ çš„`FormGroup`æˆ–`FormControl`ä½œä¸ºè¾“å…¥ä¼ é€’ç»™ä¸€ä¸ªå­ç»„ä»¶
*   æˆ´ä¸Šæ‰‹å¥—ã€ç›”ç”²å’Œå¤´ç›”ï¼Œç›¯ç€ä½ çš„ç»ˆç«¯çœ‹å‡ ç§’é’Ÿï¼Œç„¶åè¿è¡Œ`yarn install ngx-sub-form`ä»¥é¿å…åˆ›å»ºè‡ªå®šä¹‰`ControlValueAccessor`çš„æ ·æ¿æ–‡ä»¶(å¦å¤–ï¼Œäº«å—ä¸€äº›ä¸é”™çš„åŠ©æ‰‹å’Œç±»å‹å®‰å…¨ï¼)
*   å¦‚æœæ‚¨æ­£åœ¨æ„å»ºä¸€ä¸ªé¡¶çº§è¡¨å•ç»„ä»¶ï¼Œè¯·åœ¨`NgxRootFormComponent`å’Œ`NgxAutomaticRootFormComponent`ä¹‹é—´åšå‡ºé€‰æ‹©(æ‰‹åŠ¨ä¿å­˜æˆ–ä¸€æ—¦æœ‰æ›´æ”¹å°±ç«‹å³ä¿å­˜)
*   å¦‚æœæ‚¨æ­£åœ¨æ„å»ºå­è¡¨å•ç»„ä»¶ï¼Œæ ¹æ®æ‚¨æ˜¯å¦éœ€è¦é‡æ–°æ˜ å°„æ•°æ®ï¼Œåœ¨`NgxSubFormComponent`å’Œ`NgxSubFormRemapComponent`ä¹‹é—´è¿›è¡Œé€‰æ‹©
*   äº«å—

æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œè¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡åšæ–‡ï¼Œæ‰€ä»¥è¯·è®©æˆ‘çŸ¥é“ä½ æ˜¯å¦‚ä½•å‘ç°çš„ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­æ”¹è¿›äº†ï¼æˆ‘ä»¬å¯èƒ½åœ¨æŸäº›é—®é¢˜ä¸Šæœ‰åˆ†æ­§ï¼Œæˆ–è€…æˆ‘è§£é‡Šå¾—ä¸å¤Ÿæ¸…æ¥šã€‚æ— è®ºå“ªç§æ–¹å¼æˆ‘éƒ½æƒ³çŸ¥é“ï¼Œæ‰€ä»¥è¯·ä¸è¦å®³ç¾ï¼Œåˆ†äº«ä½ ä¸å–œæ¬¢çš„ï¼Œæˆ‘å¯ä»¥è·³è¿‡çš„ï¼Œå¦‚æœå¤ªé•¿ï¼Œä¸å¤Ÿè¯¦ç»†ï¼Œç­‰ç­‰ã€‚

å¦‚æœä½ æœ‰å…¶ä»–æ”¹è¿›`ngx-sub-form`çš„æƒ³æ³•ï¼Œè¯·éšæ„è®¿é—® Github é¡¹ç›®ï¼Œæˆ–è€…å†™ä¸€ä¸ªé—®é¢˜æˆ–è€…æå‡ºä¸€ä¸ªè¯·æ±‚ğŸ”¥ã€‚

# æœ‰ç”¨çš„é“¾æ¥

*   Github åº“:[https://github.com/cloudnc/ngx-sub-form](https://github.com/cloudnc/ngx-sub-form)
*   ä¸€ä¸ªå…·æœ‰å¤šæ€æ•°æ®çš„è¡¨å•çš„ç°åœºæ¼”ç¤ºï¼Œè¯¥è¡¨å•å·²è¢«åˆ†è§£æˆä¸åŒçš„å­ç»„ä»¶:[https://cloudnc.github.io/ngx-sub-form](https://cloudnc.github.io/ngx-sub-form)
*   ç°åœºæ¼”ç¤ºçš„æºä»£ç :[https://github.com/cloudnc/ngx-sub-form/tree/master/src/app](https://github.com/cloudnc/ngx-sub-form/tree/master/src/app)
*   æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­æ„å»ºçš„æ¼”ç¤ºçš„ stack blitz:[https://stackblitz.com/edit/ngx-sub-form-basics](https://stackblitz.com/edit/ngx-sub-form-basics)

* * *

*   åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘:[https://twitter.com/maxime1992](https://twitter.com/maxime1992)(æˆ‘åˆ†äº«å…³äº Angular çš„äº‹æƒ…ğŸŒˆ)
*   åœ¨ Github ä¸Šå…³æ³¨æˆ‘:[https://github.com/maxime1992](https://github.com/maxime1992)(æˆ‘å°è¯•å¼€æºå°½å¯èƒ½å¤šçš„ä¸œè¥¿ï¼Œå¤§éƒ¨åˆ†æ—¶é—´å›´ç»•ç€ Typescriptã€Nodeã€Angularã€NestJs)

* * *

*   æ‰å…‹çš„æ¨ç‰¹:[https://twitter.com/zak](https://twitter.com/zak)
*   æ‰å…‹çš„ Github é¡µé¢:[https://github.com/zakhenry](https://github.com/zakhenry)

* * *

*   CloudNC ç½‘ç«™:[https://cloudnc.com](https://cloudnc.com)(å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œä¼¦æ•¦æœ‰å¾ˆå¤š[çš„å·¥ä½œ](https://cloudnc.com/careers)ï¼)
*   CloudNC çš„ Github é¡µé¢:[https://github.com/cloudnc](https://github.com/cloudnc)(æˆ‘ä»¬å‡ ä¹æ²¡æœ‰å…¶ä»–ä¸ºå›¾æ ‡å’Œç½‘ç»œå·¥ä½œè€…å‡†å¤‡çš„åº“)

å†æ¬¡æ„Ÿè°¢é˜…è¯»ï¼