# ä¸ºå¤§å®¶å¹²æ¯ğŸ’¡ğŸ‰

> åŸæ–‡:[https://dev.to/sendilkumarn/kubernetes-for-everyone-opb](https://dev.to/sendilkumarn/kubernetes-for-everyone-opb)

# [](#kubernetes)Kubernetes

Kubernetes æ˜¯è¿è¡Œå®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„æ ‡å‡†ã€‚

> Kubernetes (K8s)æ˜¯ä¸€ä¸ªé’ˆå¯¹å®¹å™¨åŒ–åº”ç”¨çš„`automating deployment`ã€`scaling`å’Œ`management`çš„å¼€æºç³»ç»Ÿã€‚

[![](../Images/be636842c82bb87139cff50f9f9aebc1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--abAth0MU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/idtqaj43wbzw5704fwdb.png)

Kubernetes ä½¿éƒ¨ç½²å’Œè¿è¡Œå®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºå˜å¾—å®¹æ˜“ã€‚Kubernetes ä½¿ç”¨ç®€å•ã€‚

Kubernetes å¾ˆéš¾ç†è§£ï¼Œå› ä¸ºå®ƒæä¾›äº†å¤§é‡é€‰é¡¹æ¥ç®€åŒ–æ‚¨çš„éƒ¨ç½²ã€‚

é¡¾åæ€ä¹‰ï¼ŒKubernetes æ˜¯ä¸€ä¸ªé¢†èˆªå‘˜(æˆ–)èˆµæ‰‹ï¼Œå¸®åŠ©ä½ èˆªè¡Œçš„é›†è£…ç®±ä¸–ç•Œã€‚Kubernetes æ˜¯ç¤¾åŒºä¸ºç¤¾åŒºæ„å»ºçš„å¯ç§»æ¤ã€å¯æ‰©å±•çš„ç³»ç»Ÿã€‚

æ­£å¦‚å‡¯å°”è¥¿æ­£ç¡®å¼•ç”¨çš„

> Kubernetes å¯ä»¥åšæœ€å¥½çš„ç³»ç»Ÿç®¡ç†å‘˜ä¼šåšçš„äº‹æƒ…:è‡ªåŠ¨åŒ–ã€æ•…éšœè½¬ç§»ã€é›†ä¸­æ—¥å¿—è®°å½•å’Œç›‘æ§ã€‚å®ƒé‡‡ç”¨äº†æˆ‘ä»¬åœ¨ DevOps ç¤¾åŒºä¸­å­¦åˆ°çš„çŸ¥è¯†ï¼Œå¹¶å°†å…¶é»˜è®¤ä¸ºå¼€ç®±å³ç”¨ã€‚

ä¸ºäº†ä¸ Kubernetes åˆä½œï¼Œäº†è§£ä»¥ä¸‹å†…å®¹éå¸¸é‡è¦

*   å¤šä¹ˆä¸å¯æ€è®®çš„ä½œå“ï¼Ÿ
*   Kubernetes æ˜¯å¦‚ä½•æ„å»ºçš„ï¼Ÿ
*   Kubernetes ä¸­çš„å„ç§æˆåˆ†æ˜¯ä»€ä¹ˆï¼Ÿ

è®©æˆ‘ä»¬å¼€å§‹é»‘ Kubernetesã€‚

## Kubernetes æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

Kubernetes ä»¥é«˜åº¦å¯ç”¨çš„é›†ç¾¤æ¨¡å¼è¿è¡Œã€‚æ¯ä¸ª Kubernetes é›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªä¸»èŠ‚ç‚¹å’Œå‡ ä¸ªå·¥ä½œèŠ‚ç‚¹ç»„æˆã€‚

[![Alt Text](../Images/ca9121fe88656acd30dcb0c5d5ab5f83.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--KdhR6bGv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/gkc90lkkd9cdfqjx2i2m.png)

#### [](#master-node)ä¸»èŠ‚ç‚¹

ä¸»èŠ‚ç‚¹ç”± API æœåŠ¡å™¨ã€è°ƒåº¦ç¨‹åºã€æ§åˆ¶å™¨ç­‰ç»„æˆã€‚è¿™ä¸ªèŠ‚ç‚¹è¢«ç§°ä¸º Kubernetes çš„`control plane`ã€‚è¿™ä¸ªæ§åˆ¶å¹³é¢å°±æ˜¯ Kubernetes çš„`brain`ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæ§åˆ¶å¹³é¢è´Ÿè´£ Kubernetes å†…éƒ¨çš„æ‰€æœ‰æ“ä½œã€‚

[![Alt Text](../Images/88c5e5b1cda53c29ecb335ce69506c36.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--i1t8r2LU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/wgenne5f9y8a25shgb29.png)

é€šè¿‡`API server`ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡ç¤ºåº“ä¼¯å†…ç‰¹äººæˆ–è€…ä»åº“ä¼¯å†…ç‰¹äººé‚£é‡Œè·å¾—ä¿¡æ¯ã€‚

`Scheduler`è´Ÿè´£è°ƒåº¦åŠèˆ±ã€‚

`controllers`è´Ÿè´£è¿è¡Œèµ„æºæ§åˆ¶å™¨ã€‚

`etcd`æ˜¯åº“ä¼¯å†…ç‰¹äººçš„å‚¨è—å®¤ã€‚å®ƒæ˜¯é”®å€¼å­˜å‚¨ã€‚

#### [](#node)èŠ‚ç‚¹

[![Alt Text](../Images/9ba1cc30970ea63dfe223f0d47bcfd2f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xcWH2nLa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/g9w3a7g1ytmxz83m46n3.png)

å·¥ä½œè€…èŠ‚ç‚¹æœ‰ä¸€ä¸ª Kubelet å’Œä»£ç†ã€‚

Kubelets æ˜¯å®é™…çš„ä¸»åŠ›ï¼ŒKube-proxy å¤„ç†ç½‘ç»œã€‚

#### [](#working)å·¥ä½œ

[![Alt Text](../Images/b5614442db01d03662b94bdaa59238a9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--IlxAOYSR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/h0hxgch8ape716dwxl0t.png)

æˆ‘ä»¬é€šè¿‡`kubectl apply`å‘½ä»¤å‘ Kubernetes é›†ç¾¤æä¾›`yaml`æ–‡ä»¶ã€‚

`apply`å‘½ä»¤è°ƒç”¨ API æœåŠ¡å™¨ï¼ŒAPI æœåŠ¡å™¨å°†ä¿¡æ¯å‘é€ç»™`controller`ï¼ŒåŒæ—¶å°†ä¿¡æ¯å­˜å‚¨åˆ°`etcd`ã€‚

ç„¶å,`etcd`åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šå¤åˆ¶è¿™äº›ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨ä»»ä½•èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶éƒ½èƒ½å­˜æ´»ã€‚

`controller`å°†æ£€æŸ¥ç»™å®šçŠ¶æ€æ˜¯å¦ä¸æœŸæœ›çŠ¶æ€åŒ¹é…ã€‚å¦‚æœä¸æ˜¯ï¼Œå®ƒé€šè¿‡å‘`scheduler`å‘é€ä¿¡æ¯æ¥å¯åŠ¨åŠèˆ±éƒ¨ç½²

è¿™äº›æ£€æŸ¥è¢«ç§°ä¸ºåœ¨ Kubernetes å†…éƒ¨è¿è¡Œçš„**åè°ƒå¾ªç¯**ã€‚è¿™ä¸ªå¾ªç¯çš„å·¥ä½œæ˜¯éªŒè¯æ‰€è¯·æ±‚çš„çŠ¶æ€æ˜¯å¦è¢«æ­£ç¡®ç»´æŠ¤ã€‚å¦‚æœé¢„æœŸçŠ¶æ€å’Œå®é™…çŠ¶æ€ä¸åŒ¹é…ï¼Œè¯¥å¾ªç¯å°†æ‰§è¡Œå¿…è¦çš„æ“ä½œï¼Œå°†å®é™…çŠ¶æ€è½¬æ¢ä¸ºé¢„æœŸçŠ¶æ€ã€‚

`scheduler`é‡Œé¢æœ‰ä¸€ä¸ªé˜Ÿåˆ—ã€‚ä¸€æ—¦é˜Ÿåˆ—ä¸­æ”¶åˆ°æ¶ˆæ¯ã€‚

ç„¶å,`scheduler`å°†è°ƒç”¨ kubelet æ‰§è¡Œé¢„æœŸçš„æ“ä½œï¼Œæ¯”å¦‚éƒ¨ç½²å®¹å™¨ã€‚

è¿™æ˜¯ Kubernetes å¦‚ä½•éƒ¨ç½²çš„ 10000 è‹±å°ºé¸Ÿç°å›¾ã€‚

åº“ä¼¯å†…ç‰¹æ–¯æœ‰å„ç§å„æ ·çš„æˆåˆ†ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆç”¨å¤„ã€‚

## [](#components-of-kubernetes)åº“ä¼¯å†…ç‰¹æ–¯çš„æˆåˆ†

### [](#pods)è±†èš

> ä¸€èˆ¬æ¥è¯´ï¼Œè±†èšåªä¸è¿‡æ˜¯ä¸€ç¾¤æµ·è±šæˆ–é²¸é±¼ã€‚

[![](../Images/0014848c1e63b8c8179d61c8526a397d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--6dcWD7cK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/wri3njxsoku0z6na9zj8.png)

åŒæ ·ï¼Œåœ¨ Kubernetes çš„ä¸–ç•Œé‡Œï¼Œ`pods`æ˜¯ä¸€ç¾¤ç”Ÿæ´»åœ¨ä¸€èµ·çš„å®¹å™¨ã€‚ä¸€ä¸ª pod å¯èƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚

`pod`æ˜¯ Kubernetes æœ€å°çš„éƒ¨ç½²å•ä½ã€‚é€šå¸¸ï¼Œä¸èƒ½ç”Ÿæ´»åœ¨å¦ä¸€ä¸ªå®¹å™¨çš„èŒƒå›´ä¹‹å¤–çš„å®¹å™¨è¢«åˆ†ç»„ä»¥å½¢æˆä¸€ä¸ª podã€‚

è¿™å°±æ˜¯ä½ åœ¨ Kubernetes ä¸­å®šä¹‰ pod çš„æ–¹å¼ã€‚

```
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
  labels:
    app: myapp
spec:
  containers:
  - name: myapp-container
    image: busybox
    command: ['sh', '-c', 'echo  Hello  Kubernetes!  &&  sleep  3600'] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   *apiVersion* è¡¨ç¤º Kubernetes é›†ç¾¤åœ¨è§£æå’Œæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶æ—¶ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„ APIã€‚
*   *ç§ç±»*å®šä¹‰äº†åº“æœ¬å†…ç‰¹å¯¹è±¡çš„**ç§ç±»**ï¼Œè¯¥æ–‡ä»¶å°†å¼•ç”¨ã€‚
*   *å…ƒæ•°æ®*åŒ…æ‹¬è¯†åˆ« Pod æ‰€éœ€çš„æ‰€æœ‰å…ƒæ•°æ®ã€‚
*   *è§„æ ¼*åŒ…æ‹¬é›†è£…ç®±ä¿¡æ¯ã€‚

### [](#deployments)éƒ¨ç½²

è€Œè±†èšæ˜¯éƒ¨ç½²å•ä½ã€‚ä¸ºäº†è®©åº”ç”¨ç¨‹åºå·¥ä½œï¼Œå®ƒéœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ª podã€‚Kubernetes è®¤ä¸ºè¿™ä¸€æ•´å¥—éƒ½æ˜¯éƒ¨ç½²ã€‚

è¿™æ ·éƒ¨ç½²å°±è®°å½•äº†å…³äºåŠèˆ±çš„ä¿¡æ¯ã€‚Kubernetes ä½¿ç”¨è¿™äº›éƒ¨ç½²ä¿¡æ¯æ¥ç®¡ç†å’Œç›‘æ§éƒ¨ç½²åœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚

ä¸‹é¢çš„æ–‡ä»¶æ˜¯æ ·ä¾‹éƒ¨ç½²æ–‡ä»¶ï¼Œå®ƒå‘Šè¯‰ Kubernetes ä½¿ç”¨`nginx:1.7.9`å®¹å™¨åˆ›å»ºä¸€ä¸ª`nginx`çš„éƒ¨ç½²ã€‚

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.7.9
        ports:
        - containerPort: 80 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#replicasets)å¤åˆ¶é›†

è€Œéƒ¨ç½²å‘Šè¯‰ Kubernetes æ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦å“ªäº›å®¹å™¨ä»¥åŠè¦è¿è¡Œå¤šå°‘å‰¯æœ¬ã€‚`replica sets`æ˜¯ç¡®ä¿è¿™äº›å‰¯æœ¬æ­£å¸¸è¿è¡Œçš„å·¥å…·ã€‚

ReplicaSet è´Ÿè´£ç®¡ç†å’Œç›‘æ§å‰¯æœ¬ã€‚

### statefullset

æˆ‘ä»¬ç»å¸¸éœ€è¦æ°¸ä¹…å­˜å‚¨æˆ–æ°¸ä¹…ç½‘ç»œæ ‡è¯†ç¬¦ï¼Œæˆ–è€…æœ‰åºéƒ¨ç½²ã€æ‰©å±•å’Œæ›´æ–°ã€‚åœ¨è¿™æœŸé—´ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`StatefulSets`ã€‚

æ‚¨å¯ä»¥å¦‚ä¸‹å®šä¹‰ StatefulSetã€‘

```
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: web
spec:
  selector:
    matchLabels:
      app: nginx # has to match .spec.template.metadata.labels
  serviceName: "nginx"
  replicas: 3 # by default is 1
  template:
    metadata:
      labels:
        app: nginx # has to match .spec.selector.matchLabels
    spec:
      terminationGracePeriodSeconds: 10
      containers:
      - name: nginx
        image: k8s.gcr.io/nginx-slim:0.8
        ports:
        - containerPort: 80
          name: web
        volumeMounts:
        - name: www
          mountPath: /usr/share/nginx/html
  volumeClaimTemplates:
  - metadata:
      name: www
    spec:
      accessModes: [ "ReadWriteOnce" ]
      storageClassName: "my-storage-class"
      resources:
        requests:
          storage: 1Gi 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬è£…è½½äº†å·ï¼Œå¹¶å£°æ˜äº†å·å­˜å‚¨ã€‚

### [](#daemonset)DaemonSet

æœ‰æ—¶ï¼Œæ‚¨éœ€è¦åœ¨ Kubernetes é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ª podã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä»æ¯ä¸ªèŠ‚ç‚¹æ”¶é›†æŒ‡æ ‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†éœ€è¦åœ¨æ”¶é›†æŒ‡æ ‡çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šå®‰æ’ä¸€äº› podã€‚æˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›èŠ‚ç‚¹ä½¿ç”¨ DaemonSetã€‚

### [](#services)æœåŠ¡

éƒ¨ç½²å®šä¹‰äº†å®¹å™¨ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºçš„å®é™…çŠ¶æ€ã€‚ç”¨æˆ·å°†éœ€è¦è®¿é—®åº”ç”¨ç¨‹åºï¼Œæˆ–è€…æ‚¨å¯èƒ½éœ€è¦è¿æ¥åˆ°å®¹å™¨æ¥è°ƒè¯•å®ƒã€‚æœåŠ¡å°†å¸®åŠ©ä½ ã€‚

æœåŠ¡æ˜¯ Kubernetes å¯¹è±¡ï¼Œå®ƒæä¾›äº†ä»å¤–éƒ¨ä¸–ç•Œæˆ–åœ¨å®ƒä»¬ä¹‹é—´å¯¹å®¹å™¨çš„è®¿é—®ã€‚

æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹å®šä¹‰æœåŠ¡:

```
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: MyApp
  ports:
  - protocol: TCP
    port: 80
    targetPort: 9376 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢çš„`service`å°†ç«¯å£`80`ä¸Šçš„ä¼ å…¥è¿æ¥æ˜ å°„åˆ°ç›®æ ‡ç«¯å£`9376`ã€‚

> åœ¨ Kubernetes çš„ä¸–ç•Œä¸­ï¼Œæ‚¨å¯ä»¥å°†æœåŠ¡è§†ä¸ºè´Ÿè½½å¹³è¡¡å™¨ã€ä»£ç†æˆ–æµé‡è·¯ç”±å™¨ã€‚

### [](#networking)è”ç½‘

è¿™æ˜¯ Kubernetes æœ€é‡è¦çš„å…ƒç´ ã€‚æ­£åœ¨è¿è¡Œçš„ pod åº”è¯¥æš´éœ²åœ¨ç½‘ç»œä¸­ã€‚åœ¨ pod å†…éƒ¨è¿è¡Œçš„å®¹å™¨åº”è¯¥åœ¨å®ƒä»¬ä¹‹é—´ä»¥åŠä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œé€šä¿¡ã€‚

è™½ç„¶æœåŠ¡æä¾›äº†è¿æ¥åˆ° pod çš„æ–¹æ³•ï¼Œä½†æ˜¯ç½‘ç»œå†³å®šäº†å¦‚ä½•å…¬å¼€è¿™äº›æœåŠ¡ã€‚

åœ¨ Kubernetes ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å…¬å¼€æœåŠ¡:

*   è´Ÿè½½å¹³è¡¡
    *   è´Ÿè½½å¹³è¡¡å™¨æä¾›äº†ä¸€ä¸ªå¤–éƒ¨ IPï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥è®¿é—®å†…éƒ¨è¿è¡Œçš„ podã€‚
    *   Kubernetes å°†å¯åŠ¨æœåŠ¡ï¼Œç„¶å`asynchronously`å¯åŠ¨ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ã€‚

[![](../Images/5274ac15f915101d4428dd97e0241ab5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--0ga9dtoD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/29miv7gkc1bmpz0yfdze.gif)

*   èŠ‚ç‚¹ç«¯å£
    *   æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªåŠ¨æ€åˆ†é…çš„ç«¯å£ã€‚
    *   æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Kubernetes ä¸» IP è®¿é—®æœåŠ¡ã€‚

[![](../Images/a29b73e1e24df36fc6e74ac797c302d0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--5-WFXc6N--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/pactfmoby255r4pny8iq.gif)

*   è¿›å…¥
    *   æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„åœ°å€ã€‚
    *   è¿™äº›æœåŠ¡ç„¶åç”±å…¥å£æ§åˆ¶å™¨è®¿é—®ã€‚
    *   å…¥å£æ§åˆ¶å™¨ä¸æ˜¯å…¬å…± IP æˆ–å¤–éƒ¨ IPã€‚

[![](../Images/7c0f06c1948a7d66817343053046a8b4.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--PxM64GHi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/09tndignuksgqrjdqlze.gif)

### [](#secrets)ç§˜å¯†

é€šå¸¸å¯¹äºåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦æä¾›å¯†ç ã€ä»¤ç‰Œç­‰ã€‚ï¼ŒKubernetes æä¾›äº†`secrets`å¯¹è±¡æ¥å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¦‚ä¸‹çš„ç§˜å¯†:

```
apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
stringData:
  config.yaml: |-
    apiUrl: "https://my.api.com/api/v1"
    username: {{username}}
    password: {{password}} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#best-practices)æœ€ä½³å®è·µ

> è€Œ Kubernetes æ˜¯ä¸€ä¸ªæµ·æ´‹ï¼Œæˆ‘ä»¬æ‰€çœ‹åˆ°çš„åªæ˜¯å…¶ä¸­çš„ä¸€æ»´æ°´ã€‚ç”±äº Kubernetes æ”¯æŒå¹¿æ³›çš„åº”ç”¨ç¨‹åºå’Œé€‰é¡¹ï¼Œå› æ­¤æœ‰å„ç§ä¸åŒçš„é€‰é¡¹å’ŒåŠŸèƒ½å¯ç”¨ã€‚

ä½¿ç”¨ Kubernetes æ—¶å¯ä»¥éµå¾ªçš„ä¸€äº›æœ€ä½³å®è·µæ˜¯:

#### [](#make-smaller-yaml)è®© YAML å˜å°

`yaml`æ–‡ä»¶æ˜¯ Kubernetes é…ç½®çš„æ ¸å¿ƒã€‚

æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ª`yaml`ä¸­å®šä¹‰å¤šä¸ª Kubernetes é…ç½®ã€‚è€Œ`yaml`ä¸`JSON`ç›¸æ¯”å‡å°‘äº†æ ·æ¿æ–‡ä»¶ã€‚ä½†æ˜¯`yaml`æ–‡ä»¶ä»ç„¶å¯¹ç©ºé—´æ•æ„Ÿå¹¶ä¸”å®¹æ˜“å‡ºé”™ã€‚

æ‰€ä»¥æ€»æ˜¯å°½é‡å‡å°`yaml`æ–‡ä»¶çš„å¤§å°ã€‚

å¯¹äºæ¯ä¸ªæœåŠ¡ï¼Œéƒ¨ç½²ã€ç§˜å¯†å’Œå…¶ä»– Kubernetes å¯¹è±¡éƒ½åœ¨ä¸€ä¸ªå•ç‹¬çš„`yaml`æ–‡ä»¶ä¸­å®šä¹‰å®ƒä»¬ã€‚

> å°†ä½ çš„ yaml æ–‡ä»¶åˆ†å‰²æˆæ›´å°çš„æ–‡ä»¶ã€‚

`single responsibility principle`åœ¨è¿™é‡Œé€‚ç”¨ã€‚

#### [](#smaller-and-fast-boot-time-for-images)å›¾åƒå¯åŠ¨æ—¶é—´æ›´å°æ›´å¿«

Kubernetes ä¼šåœ¨ç³»ç»Ÿå´©æºƒã€å‡çº§æˆ–ä½¿ç”¨é‡å¢åŠ æ—¶è‡ªåŠ¨é‡å¯ podã€‚è®©æ˜ åƒæœ‰æ›´å¿«çš„å¯åŠ¨æ—¶é—´æ˜¯å¾ˆé‡è¦çš„ã€‚ä¸ºäº†æœ‰æ›´å¿«çš„å¯åŠ¨æ—¶é—´ï¼Œæˆ‘ä»¬éœ€è¦æ›´å°çš„æ˜ åƒã€‚

é«˜å±±å½±åƒæ˜¯ä½ çš„æœ‹å‹ã€‚ä½¿ç”¨ Alpine æ˜ åƒä½œä¸ºåŸºç¡€ï¼Œç„¶åä»…åœ¨ç»å¯¹å¿…è¦æ—¶å‘æ˜ åƒæ·»åŠ ç»„ä»¶æˆ–åº“ã€‚

> æ°¸è¿œè®°ä½ä½¿ç”¨è¾ƒå°çš„å›¾åƒå°ºå¯¸ã€‚ä½¿ç”¨`builder pattern`ä» Alpine å›¾åƒåˆ›å»ºå›¾åƒã€‚

#### [](#healthy-zombie-process)å¥åº·-åƒµå°¸è¿‡ç¨‹

Docker å®¹å™¨åªæœ‰åœ¨å®¹å™¨å†…è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹éƒ½ç»ˆæ­¢æ—¶æ‰ä¼šç»ˆæ­¢ã€‚å³ä½¿å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹è¢«ç»ˆæ­¢ï¼ŒDocker å®¹å™¨ä¹Ÿä¼šè¿”å›`healthy`çŠ¶æ€ã€‚è¿™å°±åˆ›å»ºäº†ä¸€ä¸ª`Healthy-Zombie`æµç¨‹ã€‚

å°è¯•åœ¨å®¹å™¨ä¸­æœ‰ä¸€ä¸ªå•ä¸€çš„è¿›ç¨‹ã€‚å¦‚æœæ— æ³•è¿è¡Œå•ä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆå°è¯•ä½¿ç”¨ä¸€ç§æœºåˆ¶æ¥åˆ¤æ–­æ˜¯å¦æ‰€æœ‰éœ€è¦çš„è¿›ç¨‹éƒ½åœ¨è¿è¡Œã€‚

#### [](#clean-up-unused-resources)æ¸…ç†æœªä½¿ç”¨çš„èµ„æº

åœ¨å®¹å™¨ä¸–ç•Œä¸­ï¼Œæœªä½¿ç”¨çš„èµ„æºå ç”¨å†…å­˜æ˜¯å¾ˆå¸¸è§çš„ã€‚ç¡®ä¿èµ„æºå¾—åˆ°æ­£ç¡®æ¸…ç†éå¸¸é‡è¦ã€‚

#### [](#think-about-requests-amp-limits)æƒ³æƒ³è¦æ±‚&é™åˆ¶

ç¡®ä¿ä¸ºæ‰€æœ‰å®¹å™¨æ­£ç¡®æŒ‡å®šè¦æ±‚å’Œé™åˆ¶ã€‚

```
resources:
    requests:
        memory: "100Mi"
        cpu: "100m"
    limits:
        memory: "200Mi"
        cpu: "500m" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`requests`æ˜¯å®¹å™¨ä¿è¯å¾—åˆ°çš„é™åˆ¶ã€‚`limits` are æ˜¯å…è®¸å®¹å™¨ä½¿ç”¨çš„æœ€å¤§æˆ–æœ€å°èµ„æºã€‚

> pod ä¸­çš„æ¯ä¸ªå®¹å™¨éƒ½å¯ä»¥è¯·æ±‚å’Œé™åˆ¶å®ƒä»¬çš„èµ„æºã€‚

#### [](#red-use-pattern)çº¢è‰²/ä½¿ç”¨å›¾æ¡ˆ

ä½¿ç”¨`RED`æ¨¡å¼ç›‘æ§å’Œç®¡ç†æ‚¨çš„æœåŠ¡ã€‚

*   è¦æ±‚
*   é”™è¯¯
*   æŒç»­æ—¶é—´

è·Ÿè¸ªè¯·æ±‚ã€å“åº”ä¸­çš„é”™è¯¯ä»¥åŠæ¥æ”¶å“åº”çš„æŒç»­æ—¶é—´ã€‚æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œè°ƒæ•´æ‚¨çš„æœåŠ¡ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚

å¯¹äºèµ„æºï¼Œä½¿ç”¨`USE`æ¨¡å¼ã€‚

*   åˆ©ç”¨
*   æµ¸é€
*   é”™è¯¯

ç›‘æ§èµ„æºåˆ©ç”¨ç‡å’Œèµ„æºé¥±å’Œç¨‹åº¦ï¼Œä»¥åŠæœ‰å“ªäº›é”™è¯¯ã€‚æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œè°ƒæ•´æ‚¨çš„èµ„æºä»¥ä¼˜åŒ–èµ„æºåˆ†é…ã€‚

å¸Œæœ›è¿™èƒ½è®©ä½ å¯¹`Kubernetes`æœ‰ä¸€ä¸ªç®€è¦çš„äº†è§£ã€‚ç‚¹å‡» [kubernetes.io](https://kubernetes.io) è·å–æ›´å¤šå…³äº kubernetes çš„ä¿¡æ¯ã€‚

ç°åœ¨ï¼Œæ‚¨å¸Œæœ›åœ¨ Kubernetes ä¸Šéƒ¨ç½²ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œå¹¶ä½¿ç”¨ Istio æ¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ã€‚

ä½ å¯ä»¥åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘ã€‚

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç•™ä¸‹èµæˆ–è¯„è®ºã€‚â¤ï¸