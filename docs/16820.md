# å¦‚ä½•åœ¨ Swift ä¸­åˆ¶ä½œç®€å•çš„è¡¨å•éªŒè¯å™¨

> åŸæ–‡:[https://dev . to/on myway 133/how-to-make-simple-form-validator-in-swift-1 hlg](https://dev.to/onmyway133/how-to-make-simple-form-validator-in-swift-1hlg)

æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›éªŒè¯åŒ…å«è®¸å¤šå­—æ®µçš„è¡¨å•ï¼Œä¾‹å¦‚å§“åã€ç”µè¯ã€ç”µå­é‚®ä»¶ä»¥åŠä¸åŒçš„è§„åˆ™ã€‚å¦‚æœéªŒè¯å¤±è´¥ï¼Œæˆ‘ä»¬ä¼šæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚

æˆ‘ä»¬å¯ä»¥åˆ¶ä½œç®€å•çš„`Validator`å’Œ`Rule`

```
class Validator {
    func validate(text: String, with rules: [Rule]) -> String? {
        return rules.compactMap({ $0.check(text) }).first
    }

    func validate(input: InputView, with rules: [Rule]) {
        guard let message = validate(text: input.textField.text ?? "", with: rules) else {
            input.messageLabel.isHidden = true
            return
        }

        input.messageLabel.isHidden = false
        input.messageLabel.text = message
    }
}

struct Rule {
    // Return nil if matches, error message otherwise
    let check: (String) -> String?

    static let notEmpty = Rule(check: {
        return $0.isEmpty ? "Must not be empty" : nil
    })

    static let validEmail = Rule(check: {
        let regex = #"[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,64}"#

        let predicate = NSPredicate(format: "SELF MATCHES %@", regex)
        return predicate.evaluate(with: $0) ? nil : "Must have valid email"
    })

    static let countryCode = Rule(check: {
        let regex = #"^\+\d+.*"#

        let predicate = NSPredicate(format: "SELF MATCHES %@", regex)
        return predicate.evaluate(with: $0) ? nil : "Must have prefix country code"
    })
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åæˆ‘ä»¬å¯ä»¥éå¸¸æœ‰è¡¨ç°åŠ›åœ°ä½¿ç”¨

```
let validator = Validator()
validator.validate(input: inputView, with: [.notEmpty, .validEmail]) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åè¿›è¡Œä¸€äº›æµ‹è¯•ä»¥ç¡®ä¿å®ƒèƒ½æ­£å¸¸å·¥ä½œ

```
class ValidatorTests: XCTestCase {
    let validator = Validator()

    func testEmpty() {
        XCTAssertNil(validator.validate(text: "a", with: [.notEmpty]))
        XCTAssertNotNil(validator.validate(text: "", with: [.notEmpty]))
    }

    func testEmail() {
        XCTAssertNil(validator.validate(text: "onmyway133@gmail.com", with: [.validEmail]))
        XCTAssertNotNil(validator.validate(text: "onmyway133", with: [.validEmail]))
        XCTAssertNotNil(validator.validate(text: "onmyway133.com", with: [.validEmail]))
    }

    func testCountryCode() {
        XCTAssertNil(validator.validate(text: "+47 11 222 333", with: [.countryCode]))
        XCTAssertNotNil(validator.validate(text: "11 222 333", with: [.countryCode]))
        XCTAssertNotNil(validator.validate(text: "47 11 222 333", with: [.countryCode]))
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

æ”¯æŒæˆ‘çš„åº”ç”¨ç¨‹åº

*   [æ¨é€ Hero -æµ‹è¯•æ¨é€é€šçŸ¥çš„çº¯ Swift åŸç”Ÿ macOS åº”ç”¨](https://onmyway133.com/pushhero)
*   [PastePal -ç²˜è´´æ¿ã€ä¾¿ç¬ºå’Œå¿«æ·æ–¹å¼ç®¡ç†å™¨](https://onmyway133.com/pastepal)
*   [å¿«é€Ÿæ£€æŸ¥-æ™ºèƒ½å¾…åŠäº‹é¡¹ç®¡ç†å™¨](https://onmyway133.com/quickcheck)
*   [Alias - App å’Œæ–‡ä»¶å¿«æ·æ–¹å¼ç®¡ç†å™¨](https://onmyway133.com/alias)
*   [æˆ‘çš„å…¶ä»–åº”ç”¨](https://onmyway133.com/apps/)

â¤ï¸â¤ï¸ğŸ˜‡ğŸ˜ğŸ¤˜â¤ï¸â¤ï¸