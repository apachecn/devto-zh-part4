# Ruby ä¸­çš„æ³¨å…¥ Ruby ä¾èµ–æ³¨å…¥ğŸŒˆ

> åŸæ–‡ï¼š<https://dev.to/eligoh/dependency-injection-in-ruby-55ja>

æˆ‘æ›¾ç»åœ¨ Medium ä¸Šå†™è¿‡ä¸€ç¯‡å…³äºä¾èµ–æ³¨å…¥çš„æ–‡ç« - [ä¾èµ–æ³¨å…¥å¹¶ä¸å¯æ€•ï¼](https://medium.com/@choonggg/dependency-injection-is-not-scary-refactoring-rails-the-clean-way-5ce5b305fd22)ã€‚æœ€è¿‘åŠ å…¥äº† dev.toï¼Œæˆ‘æƒ³æˆ‘ä¹Ÿåº”è¯¥æŠŠæˆ‘çš„æƒ³æ³•å¸¦åˆ°è¿™é‡Œã€‚

> å¥½çš„ï¼ŒEliï¼Œç”±äºè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ç°åœ¨çŸ¥é“å¦‚ä½•ä¾èµ–æ³¨å…¥äº†ã€‚ä½†æ˜¯ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®ƒå‘¢ï¼Ÿ

è¯·è€å¿ƒå¬æˆ‘è¯´ï¼Œæˆ‘å¾ˆå¿«å°±ä¼šè°ˆåˆ°è¿™ä¸€ç‚¹ã€‚ç›®å‰æ­£åœ¨æ„å»ºæ”¶ä»¶ç®±åŠŸèƒ½ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªè¡¨å•å¯¹è±¡æ¥åˆ›å»ºå¯¹è¯å’Œå›å¤/ç¼–è¾‘å¯¹è¯ã€‚

æˆ‘å¯ä»¥åšçš„æ˜¯åˆ›å»ºä¸€ä¸ªè¡¨å•å¯¹è±¡ï¼ŒæŠŠæˆ‘çš„æ‰‹æ“¦å¹²å‡€ï¼Œç„¶åå®Œæˆå®ƒã€‚æˆ–è€…æˆ‘ä¹Ÿå¯ä»¥è®©è¿™ä¸ªè¡¨å•åœ¨å…¶ä»–æ§åˆ¶å™¨ä¸­é‡ç”¨ã€‚ğŸ¤“

```
module Inbox
  class ConversationForm < BaseForm
    attr_reader :conversation, :message, :sender

    def initialize(conversation, params = {})
      @conversation = conversation
      @sender = build_sender
      @message = conversation.messages.build(user: @sender)
    end

    ...
  end
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†æ˜¯åˆ©ç”¨ä¾èµ–æ³¨å…¥ï¼Œæˆ‘èƒ½å¤Ÿä¸ºå¦ä¸€ä¸ªæ§åˆ¶å™¨é‡ç”¨è¡¨å•ã€‚

```
module Inbox
  class ConversationForm < BaseForm
    attr_reader :conversation, :message, :sender

    def self.build(params={})
      conversation = Conversation.new
      sender = build_sender
      new(conversation, sender, params)
    end

    def initialize(conversation, sender, params = {})
      @conversation = conversation
      @sender = sender
      @message = converation.messages.build(sender: sender)
    end

    ...
  end
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“æˆ‘æƒ³å»ºç«‹ä¸€ä¸ªæ–°çš„å¯¹è¯æ—¶ï¼Œæˆ‘ä¼šä½¿ç”¨`Inbox::ConversationForm.build`ã€‚åœ¨å¦ä¸€ä¸ªæ§åˆ¶å™¨/åŠ¨ä½œä¸­ï¼Œæˆ‘ä¼šé¢„å®šä¹‰å¯¹è¯å¹¶å°†å…¶æ³¨å…¥è¡¨å•ã€‚

```
# ConversationsController
# Creating a Conversation
def new
  @form = Inbox::ConversationForm.build
end

# My::ConversationsController
def new
  @form = Inbox::ConversationForm.new(fetch_conversation, Current.user)
end

# BOTH
def create/update
  if @form.save
    render :new
  else
    redirect_to some_path
  end
end

private

def fetch_conversation
  Inbox::Conversation.find(params[:conversation_id])
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å†ä¸€æ¬¡å‰è¿›ï¼Œä¾èµ–æ³¨å…¥ï¼