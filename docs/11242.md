# React ğŸ¥°ä¸­å¤„ç†è­¦å‘Šå¯¹è¯æ¡†çš„æœ€ä½³æ–¹å¼

> åŸæ–‡ï¼š<https://dev.to/dmtrkovalenko/the-neatest-way-to-handle-alert-dialogs-in-react-1aoe>

*é˜…è¯»æ—¶é—´â€” 5 åˆ†é’Ÿ* â˜•ï¸

ä½ å¥½ã€‚æ‡’æƒ°çš„å¼€å‘äººå‘˜åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åœ¨ react without tears ä¸­å¤„ç†å¯¹è¯æ¡†è­¦å‘ŠğŸ˜¢ã€‚å¦‚æœä½ åŒå€¦äº†å¤§é‡çš„å¤åˆ¶ç²˜è´´ï¼Œåªæ˜¯ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ–°çš„æ€ªå¼‚çš„ä¸€ä¸ªé—®é¢˜çš„æ¨¡æ€å¯¹è¯æ¡†â€”â€”å‡†å¤‡ä½ çš„å’–å•¡ï¼Œæˆ‘ä»¬å¼€å§‹äº†ã€‚

## ç›®æ ‡

æˆ‘ä»¬å¸Œæœ›ä¸ºæ˜¾ç¤ºè­¦æŠ¥æä¾›æœ€ç®€æ´çš„è§£å†³æ–¹æ¡ˆã€‚éå¸¸ç±»ä¼¼äºæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨çš„æœ¬åœ°`alert`åŠŸèƒ½ã€‚

```
const isConfirmed = alert("Are you sure you want to remove this burrito?");

if (isConfirmed) {
  await api.deleteThisAwfulBurrito();
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [å…ˆç¹ä¸ºå¿«](#sneak-peek)

æœ€ç»ˆæˆ‘ä»¬ä¼šå¾—åˆ°è¿™æ ·çš„ä¸œè¥¿ã€‚

```
const YourAwesomeComponent = () => {
  const confirm = useConfirmation()

  confirm({
    variant: "danger",
    title: "Are you sure you want to remove this burrito?",
    description: "If you will remove this burrito you will regret it ğŸ˜¡!!"
  }).then(() => {
    api.deleteThisAwfulBurrito();
  });
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ„Ÿå…´è¶£å—ï¼Ÿè®©æˆ‘ä»¬å†™ä¸€äº›ä»£ç ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä»å®é™…åˆ›å»ºæ¨¡æ€å¯¹è¯æ¡†å¼€å§‹ã€‚è¿™åªæ˜¯ä¸€ä¸ªç”¨â¤ï¸å’Œ [material-ui](https://material-ui.com/components/dialogs/#dialogs)
æ„å»ºçš„ç®€å•è­¦å‘Šå¯¹è¯æ¡†

```
import {
  Button,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogContentText,
  DialogActions,
} from "@material-ui/core";

export const ConfirmationDialog = ({
  open,
  title,
  variant,
  description,
  onSubmit,
  onClose
}) => {
  return (
    <Dialog open={open}>
      <DialogTitle>{title}</DialogTitle>
      <DialogContent>
        <DialogContentText>{description}</DialogContentText>
      </DialogContent>
      <DialogActions>
        <Button color="primary" onClick={onSubmit}>
          YES, I AGREE
        </Button>
        <Button color="primary" onClick={onClose} autoFocus>
          CANCEL
        </Button>
      </DialogActions>
    </Dialog>
  );
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å°†å¦‚ä½•é‡‡ç”¨å®ƒæ¥åŠ¨æ€åœ°å·¥ä½œå‘¢ï¼Ÿè¿™æ˜¯ä¸€ä»¶æœ‰è¶£çš„äº‹æƒ…ã€‚å¦‚æœç”¨æˆ·åªèƒ½åŒæ—¶çœ‹åˆ°**ä¸€ä¸ª**è­¦å‘Šå¯¹è¯æ¡†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦**å¾ˆå¤šå¯¹è¯æ¡†**ç»™æ¯ä¸ªç»„ä»¶ï¼Ÿ

> å¦‚æœæ‚¨åœ¨å¦ä¸€ä¸ªæŠ¥è­¦å¯¹è¯æ¡†ä¸Šæ˜¾ç¤ºä¸€ä¸ªæŠ¥è­¦å¯¹è¯æ¡†...ä½ å¯èƒ½éœ€è¦é‡æ–°è€ƒè™‘ä½ ç”³è¯·ä¸­çš„ UX éƒ¨åˆ†ã€‚
> [![No god please no image](img/f76a0fb8e5fdd4c51af95d4ea6567aac.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--c8n99gLd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://github.com/dmtrKovalenimg/blob/master/no_god_pls_no.gif%3Fraw%3Dtrue)

æ‰€ä»¥æˆ‘ä»¬å¼€å§‹å§ã€‚æˆ‘ä»¬æ‰€éœ€è¦çš„åªæ˜¯åœ¨åº”ç”¨ç¨‹åºçš„æ ¹å¤„åªå‘ˆç° **1 é¡¶çº§**æ¨¡æ€ï¼Œå¹¶åœ¨éœ€è¦æ—¶æ˜¾ç¤ºå®ƒã€‚æˆ‘ä»¬å°†ä½¿ç”¨ react é’©å­çš„èƒ½åŠ›æ¥ä½¿å®ƒçœ‹èµ·æ¥æ›´ä¼˜é›…ã€‚

## åŒ…è£¹ä¸Šä¸‹æ–‡

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡å®ä¾‹ï¼Œå¹¶ç”¨å®ƒåŒ…è£…ç»„ä»¶æ ‘ã€‚æ­¤å¤–ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„çŠ¶æ€ï¼Œå®ƒå°†ä¿å­˜è­¦æŠ¥çš„å½“å‰æ˜¾ç¤ºé€‰é¡¹(å¦‚æ ‡é¢˜ã€æè¿°å’Œæ‚¨éœ€è¦çš„ä¸€åˆ‡)ã€‚

```
interface ConfirmationOptions {
  title: string;
  description: string;
}

const ConfirmationServiceContext = React.createContext<
  // we will pass the openning dialog function directly to consumers
  (options: ConfirmationOptions) => Promise<void>
>(Promise.reject);

export const ConfirmationServiceProvider= ({ children }) => {
  const [
    confirmationState,
    setConfirmationState
  ] = React.useState<ConfirmationOptions | null>(null);

  const openConfirmation = (options: ConfirmationOptions) => {
    setConfirmationState(options);
    return Promise.resolve()
  };

  return (
    <>
      <ConfirmationServiceContext.Provider
        value={openConfirmation}
        children={children}
      />

      <Dialog open={Boolean(confirmationState)} {...confirmationState} />
    </>
  );
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œä¸€æ—¦æˆ‘ä»¬è¿æ¥ä»»ä½•æ¶ˆè´¹è€…å¹¶è°ƒç”¨æä¾›çš„å‡½æ•°ï¼Œæˆ‘ä»¬çš„å¯¹è¯æ¡†å°±ä¼šæ‰“å¼€ã€‚

## è§£å†³ç¡®è®¤

ç°åœ¨æˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼å¤„ç†å…³é—­å¯¹è¯å¹¶ä»æ¶ˆè´¹è€…é‚£é‡Œè·å¾—å›è°ƒã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯åŸºäº`Promise`çš„ APIï¼Œä½†æ˜¯ä½¿ç”¨å›è°ƒæ–¹å¼ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä¸€æ—¦ç”¨æˆ·æ¥å—æˆ–å–æ¶ˆæé†’ï¼Œæ‚¨çš„ç­‰å¾…æ‰¿è¯ºå°†è¢«è§£å†³æˆ–æ‹’ç»ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜`Promise`çš„è§£æå‡½æ•°ï¼Œå¹¶åœ¨é€‚å½“çš„ç”¨æˆ·æ“ä½œä¸­è°ƒç”¨å®ƒä»¬ã€‚React çš„`ref`æ˜¯æœ€å¥½çš„åœ°æ–¹ã€‚

```
 const awaitingPromiseRef = React.useRef<{
    resolve: () => void;
    reject: () => void;
  }>();

  const openConfirmation = (options: ConfirmationOptions) => {
    setConfirmationState(options);
    return new Promise((resolve, reject) => {
      // save the promise result to the ref
      awaitingPromiseRef.current = { resolve, reject };
    });
  };

  const handleClose = () => {
    // Mostly always you don't need to handle canceling of alert dialog
    // So shutting up the unhandledPromiseRejection errors 
    if (confirmationState.catchOnCancel && awaitingPromiseRef.current) {
      awaitingPromiseRef.current.reject();
    }

    setConfirmationState(null);
  };

  const handleSubmit = () => {
    if (awaitingPromiseRef.current) {
      awaitingPromiseRef.current.resolve();
    }

    setConfirmationState(null);
  }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±æ˜¯è¿™æ ·ï¼æˆ‘ä»¬çš„å¯¹è¯æœºå¿«å¥½äº†ï¼è¿˜æœ‰ä¸€ä»¶äº‹â€”â€”åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰é’©å­ä»¥è·å¾—æ›´å¥½çš„å¯è¯»æ€§

```
export const useConfirmationService = () =>
  React.useContext(ConfirmationServiceContext); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### å®šåˆ¶

æ‚¨å¯ä»¥é€šè¿‡ä¼ é€’é™„åŠ çš„`variant`å±æ€§æ¥è½»æ¾å®šåˆ¶å¯¹è¯æ¡†å†…å®¹ã€‚åªè¦æŠŠå®ƒåŠ åˆ°`ConfirmationOptions`

```
export interface ConfirmationOptions {
  variant: "danger" | "info";
  title: string;
  description: string;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶æ ¹æ®æ‚¨çš„æ„æ„¿å‘ˆç°ä¸åŒçš„å¯¹è¯å†…å®¹ã€‚

```
 <DialogActions>
    {variant === "danger" && (
      <>
        <Button color="primary" onClick={onSubmit}>
          Yes, I agree
        </Button>
        <Button color="primary" onClick={onClose} autoFocus>
          CANCEL
        </Button>
      </>
    )}

    {variant === "info" && (
      <Button color="primary" onClick={onSubmit}>
        OK
      </Button>
    )}
  </DialogActions> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## å‡†å¤‡å¥½äº†å—ï¼Ÿï¼

[![Are you ready kids?!](img/652ef6f1a3652a0d94533fcb8d3cb63f.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--PNbrn7b_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/dmtrKovalenimg/blob/master/hey%2520children.jpg%3Fraw%3Dtrue)

è¿™æ˜¯æœ€åä¸€ä¸ªå·¥ä½œç¤ºä¾‹ã€‚å¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥éšæ„çªƒå–`ConfirmationService.tsx`æ–‡ä»¶çš„å®ç°ã€‚è¿™æ˜¯æˆ‘ä»¬è°ˆè®ºçš„éå¸¸ç‹¬ç«‹å’Œå­¤ç«‹çš„é€»è¾‘ã€‚

[https://codesandbox.io/embed/neat-dialogs-3h5ou](https://codesandbox.io/embed/neat-dialogs-3h5ou)

> é™„æ³¨:åœ¨è¿™ç¯‡æ–‡ç« çš„åˆ¶ä½œè¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰å¢¨è¥¿å“¥å·é¥¼å—åˆ°ä¼¤å®³