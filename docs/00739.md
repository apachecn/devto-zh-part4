# Kentico 12:è®¾è®¡æ¨¡å¼ç¬¬ 14 éƒ¨åˆ†-æ–‡æ¡£æŸ¥è¯¢å’Œå¯¹è±¡æŸ¥è¯¢æŠ€å·§

> åŸæ–‡:[https://dev . to/seang Wright/kentico-12-design-patterns-part-14-document query-and-object query-tips-2c7h](https://dev.to/seangwright/kentico-12-design-patterns-part-14-documentquery-and-objectquery-tips-2c7h)

<figure>

[![Tip Jar](img/77596dda6b9188c53939688262dd68e1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--UBPZsRRO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/oi9ig7vr8woleczeoyb5.jpg)

<figcaption>Photo by [Sam Truong Dan](https://unsplash.com/@sam_truong) on [Unsplash](https://unsplash.com)</figcaption>

</figure>

## [](#kentico-data-access)Kentico æ•°æ®è®¿é—®

å¦‚æœæ‚¨ä»æœªç¼–å†™è¿‡å®šåˆ¶ä»£ç æ¥æ£€ç´¢å’Œæ“ä½œ Kentico CMS å­˜å‚¨çš„æ•°æ®ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¸ç†Ÿæ‚‰ä¸¤ç§ç±»å‹`DocumentQuery<T>`å’Œ`ObjectQuery<T>`ğŸ¤”ã€‚

è¿™ä¸¤ä¸ªç±»ï¼Œä»¥åŠå¤§é‡ç›¸å…³çš„åŸºç±»ï¼Œå…è®¸å¼€å‘äººå‘˜åœ¨ä»–ä»¬çš„ C#ä»£ç ä¸­ç¼–å†™æŸ¥è¯¢ï¼Œè¿™äº›æŸ¥è¯¢æœ€ç»ˆè¢«è¯„ä¼°ä¸ºä¸€ä¸ªå‚æ•°åŒ–çš„ SQL å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œã€‚

è¿™äº›ç±»å‹å’Œæ–¹æ³•ä»‹äºå¾®è½¯å¤æ‚ä¸”åŠŸèƒ½ä¸°å¯Œçš„å¯¹è±¡å…³ç³»æ˜ å°„å™¨(ORM)ã€[å®ä½“æ¡†æ¶](https://docs.microsoft.com/en-us/ef/ef6/querying/)å’Œæ¥è‡ªğŸ§. stack overflow çš„å¼€æºæç®€ ORM [Dapper](https://github.com/StackExchange/Dapper) ä¹‹é—´

Kentico çš„[æ–‡æ¡£](https://docs.kentico.com/k12sp/custom-development/retrieving-database-data-using-objectquery-api)è§£é‡Šäº†[å¦‚ä½•ä½¿ç”¨è¿™äº› API çš„åŸºæœ¬åŸç†](https://docs.kentico.com/k12sp/custom-development/working-with-pages-in-the-api)ï¼Œä½†æ˜¯å¯¹äºå¤æ‚çš„ç”¨ä¾‹å´å¾ˆå°‘æåŠ(è¿™æ˜¯å¯ä»¥ç†è§£çš„)ã€‚

æ–‡æ¡£ä¹Ÿæ²¡æœ‰åˆ—å‡ºå¯èƒ½å¸®åŠ©æ‚¨æ‰©å±•å’Œç»´æŠ¤åº”ç”¨ç¨‹åºçš„æ‰€æœ‰æœ€ä½³æ¨¡å¼â€”â€”è¿™æ˜¯æœ‰æ„çš„ä½çº§å’Œé€šç”¨æ¨¡å¼ã€‚

ä¸‹é¢ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å……åˆ†åˆ©ç”¨ä½ çš„`DocumentQuery<T>`å’Œ`ObjectQuery<T>`âš¡.çš„ä¸€äº›æŠ€å·§

## [](#use-raw-nameof-endraw-)ä½¿ç”¨`nameof()`

ä¸å®ä½“æ¡†æ¶ä¸åŒï¼ŒKentico çš„æŸ¥è¯¢ API ä¸æ¥å— [Lambda è¡¨è¾¾å¼](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/statements-expressions-operators/lambda-expressions)ä½œä¸ºå‚æ•°(å°½ç®¡å®ƒä»¬ä½¿ç”¨[è¡¨è¾¾å¼æ ‘](https://docs.microsoft.com/en-us/dotnet/csharp/expression-trees)æ¥ç”Ÿæˆæœ€ç»ˆçš„ SQL æ–‡æœ¬)ã€‚

ç›¸åï¼Œå®ƒä»¬ä½¿ç”¨æ¾æ•£ç±»å‹å’ŒåŸºäºå­—ç¬¦ä¸²çš„å‚æ•° APIã€‚

ä¾‹å¦‚ï¼Œè¦è·å¾—æ‰€æœ‰å·²å¯ç”¨ç”¨æˆ·çš„é›†åˆï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ª`bool`å€¼`true` :

```
var enabledUsers = UserInfoProvider
    .GetUsers()
    .WhereEquals("UserEnabled", true)
    .ToList(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ–è€…ä¸€ä¸ª`int`å€¼`1` :

```
var enabledUsers = UserInfoProvider
    .GetUsers()
    .WhereEquals("UserEnabled", 1)
    .ToList(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#avoiding-typos)é¿å…é”™åˆ«å­—

åˆ—`UserEnabled`æ²¡æœ‰ç±»å‹æ”¯æŒï¼Œå®ƒç›´æ¥æ˜ å°„åˆ°`UserInfo.UserEnabled`å±æ€§ï¼Œä¹Ÿä¸è¦æ±‚`"UserEnabled"`æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„åˆ—ï¼Œå¯ä»¥æ”¾åœ¨ç»“æœæŸ¥è¯¢çš„`WHERE`å­å¥ä¸­ã€‚

å› æ­¤ï¼Œä¸‹é¢çš„æŸ¥è¯¢ä¸èµ·ä½œç”¨:

```
var enabledUsers = UserInfoProvider
    .GetUsers()
    .WhereEquals("UsersEnabled", true)
    .ToList(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ å‘ç°å°åˆ·é”™è¯¯äº†å—ï¼Ÿ...`"UsersEnabled"`åº”è¯¥æ˜¯`"UserEnabled"`ğŸ˜£ã€‚

ä¸ºäº†å¸®åŠ©é¿å…è¿™äº›å®¹æ˜“çŠ¯çš„é”™åˆ«å­—ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸¤ä»¶äº‹:

*   Kentico å°†è¡¨ç¤ºå®ä½“çš„è¡¨ä¸­çš„æ‰€æœ‰åˆ—å‘½åä¸ºä¸è¯¥å®ä½“çš„ C#ç±»ä¸­çš„å±æ€§å®Œå…¨ç›¸åŒğŸ‘ã€‚
*   C#è®©æˆ‘ä»¬ä½¿ç”¨`nameof()`æ“ä½œç¬¦å°†ä¸€ä¸ªä»¤ç‰Œè½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ğŸ‘ã€‚

ä¸‹é¢æ˜¯æˆ‘å¯¹ä¸Šè¿°æŸ¥è¯¢çš„æ¨èæ–¹æ³•:

```
var enabledUsers = UserInfoProvider
    .GetUsers()
    .WhereEquals(nameof(UserInfo.UserEnabled), true)
    .ToList(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#supporting-refactoring)æ”¯æŒé‡æ„

è¿™å¯¹æŸ¥è¯¢ Kentico çš„å†…ç½®ç±»å‹å¾ˆæœ‰å¸®åŠ©ï¼Œä½†æˆ‘å‘ç°å¯¹æŸ¥è¯¢æˆ‘ä»¬åˆ›å»ºçš„å®šåˆ¶æ¨¡å—ç±»å’Œé¡µé¢ç±»å‹æ›´æœ‰å¸®åŠ©ã€‚

è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ª`UserMembershipProfile` [å®šåˆ¶æ¨¡å—ç±»](https://docs.kentico.com/k12sp/custom-development/creating-custom-modules)ã€‚

åœ¨é¡¹ç›®è¿‡ç¨‹ä¸­ï¼Œå½“æˆ‘ä»¬è¿­ä»£ä¸€ä¸ªè®¾è®¡æ—¶ï¼Œæˆ‘ä»¬çš„`UserMembershipProfile`ç±»çš„åˆ—åå¯èƒ½ä¼šæ”¹å˜å‡ æ¬¡ã€‚

å¦‚æœæˆ‘ä»¬åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨`string`åˆ—åï¼Œé‚£ä¹ˆå¦‚æœæ²¡æœ‰å¥å£®çš„å•å…ƒå’Œé›†æˆæµ‹è¯•ï¼Œå°±å¾ˆéš¾æ•æ‰åˆ°è¿™äº›åˆ—åçš„å˜åŒ–ğŸ˜®ã€‚

ç„¶è€Œï¼Œä½¿ç”¨`nameof()`ç»™äº†æˆ‘ä»¬é’ˆå¯¹é‚£äº›æ•°æ®åº“åˆ—åçš„ç¼–è¯‘ç±»å‹æ£€æŸ¥ğŸ˜‰ã€‚

> æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ Kentico çš„åˆ—å‘½åçº¦å®šï¼Œå³åœ¨æ¯ä¸ªåˆ—åå‰é¢åŠ ä¸Šå®ä½“åã€‚è¿™æœ‰åŠ©äºåœ¨ SQL ä¸­æ‰§è¡Œ`JOIN`æ—¶é¿å…åˆ—æ¨¡ç³Šã€‚
> 
> å› æ­¤ï¼Œ`UserMembershipProfile`çš„`ID`åˆ—å°†æ˜¯`UserMembershipProfileID`ï¼Œè€Œå®šåˆ¶æ¨¡å—ç±»`UserMembershipProfile`ä¹Ÿå°†ç±»ä¼¼åœ°æ‹¥æœ‰å±æ€§`UserMembershipProfileID`ã€‚

* * *

## [](#create-reusable-extensions)åˆ›å»ºå¯é‡ç”¨çš„æ‰©å±•

Kentico ä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡çš„æ‰©å±•æ–¹æ³•ï¼Œå¯ç”¨äºæŸ¥è¯¢å¯¹è±¡å’Œæ–‡æ¡£ã€‚

åœ¨`CMS.DataEngine.WhereConditionBase`ä¸­å¯ä»¥æ‰¾åˆ°è¿™æ ·çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æ–¹æ³•:

```
public TParent Where(string columnName, QueryOperator op, object value);

public TParent WhereEquals(string columnName, object value);

public TParent WhereContains(string columnName, string value);

public TParent WhereNotNull(string columnName); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™äº›æ–¹æ³•éƒ½æ˜¯é€šè¿‡æ³›å‹ç±»å‹å‚æ•°`TParent`è¿”å›åŸå§‹æŸ¥è¯¢ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†å¤šä¸ªæ–¹æ³•é“¾æ¥åœ¨ä¸€èµ·ï¼Œè€Œä¸”è¿™äº›æ–¹æ³•éƒ½æ˜¯ä½çº§çš„ï¼Œå¯¹æˆ‘ä»¬çš„å…·ä½“åº”ç”¨ç¼ºä¹ä»»ä½•ä¸šåŠ¡æ„ä¹‰ã€‚

è¿™æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬è½»æ¾åœ°å°†è¿™äº›ç‰‡æ®µç»„åˆåœ¨ä¸€èµ·ã€‚

ç„¶è€Œï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›æä¾›ç±»ä¼¼äºä¸Šé¢çš„å¯é‡ç”¨æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åº”ç”¨ä¸€ç»„æ ‡å‡†çš„`SELECT`æˆ–`WHERE`å­å¥ï¼Œè€Œä¸ç ´åæˆ‘ä»¬çš„æŸ¥è¯¢è¯­æ³•æµã€‚

æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨`ObjectQuery<T>`æˆ–`DocumentQuery<T>`ä¸Šä½¿ç”¨æ‰©å±•æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªæ‰©å±•çš„ä¾‹å­ï¼Œå®ƒå‘æ‰€æä¾›çš„æŸ¥è¯¢ä¸­æ·»åŠ äº†ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¯¥è¿‡æ»¤å™¨åªåŒ…æ‹¬å·²å¯ç”¨ä¸”æœ€è¿‘ç™»å½•çš„`UserInfo`è¡Œ:

```
public static class UserInfoQueryExtensions
{
    public static ObjectQuery<UserInfo> WhereEnabledAndActive(
        this ObjectQuery<UserInfo> query)
    {
        DateTime thirtyDaysAgo = DateTime.Now.AddDays(-30);

        return query
            .WhereEquals(nameof(UserInfo.UserEnabled), true)
            .And()
            .WhereGreaterThan(nameof(UserInfo.LastLogon), thirtyDaysAgo);
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> ä½¿ç”¨`.And()`ä¸æ˜¯å¿…è¦çš„- `AND`æ˜¯éšå«çš„-ä½†æ˜¯å®ƒæœ‰åŠ©äºæ˜ç¡®ï¼Œç‰¹åˆ«æ˜¯åœ¨æ›´å¤æ‚çš„æŸ¥è¯¢ä¸­ã€‚
> 
> æ­¤å¤–ï¼Œæˆ‘ä¸å»ºè®®ç›´æ¥ä½¿ç”¨`DateTime.Now`ï¼Œå› ä¸ºå®ƒä¸æ˜¯å¯å•å…ƒæµ‹è¯•çš„ã€‚ç›¸åï¼Œä¸ºè¿™ä¸ªæ‰©å±•æ–¹æ³•æä¾›ä¸€ä¸ªæ¥å£ï¼Œæ¯”å¦‚`IDateTimeProvider`
> 
> <header>
> 
> # ![](img/540c2ba90e5a347bd57c676bb96dfee0.png) [å¤„ç†æ—¥æœŸæ—¶é—´çš„ç­–ç•¥ã€‚ç°åœ¨åœ¨å•å…ƒæµ‹è¯•ä¸­](https://stackoverflow.com/questions/4594652/strategies-for-dealing-with-datetime-now-in-unit-tests)
> 
> Jan 4 '11 Comments: 1 Answers: 3[![](img/83f13d376e6608cc602ae93b1cdbae4e.png)5![](img/fd423aaf5fec73c645f97544689ea934.png)](https://stackoverflow.com/questions/4594652/strategies-for-dealing-with-datetime-now-in-unit-tests) </header>
> 
> æˆ‘çš„ä¸šåŠ¡é€»è¾‘åœ¨å‘¨å…­æˆ–å‘¨æ—¥ä¸æ‰§è¡ŒæŸäº›åŠŸèƒ½ã€‚æˆ‘å¸Œæœ›æˆ‘çš„å•å…ƒæµ‹è¯•èƒ½å¤ŸéªŒè¯è¿™äº›åŠŸèƒ½æ˜¯å¦è¢«æ‰§è¡Œï¼Œä½†æ˜¯æµ‹è¯•å°†ä¼šåœ¨å‘¨å…­/å‘¨æ—¥å¤±è´¥ã€‚
> 
> æˆ‘è®¤ä¸ºæœ€ç®€å•çš„æ–¹æ³•æ˜¯è®©å•å…ƒæµ‹è¯•ä¼ è¾¾ä¸€ä¸ªå‹å¥½çš„ä¿¡æ¯ï¼Œè¡¨æ˜â€¦
> 
> <button class="ltag__stackexchange--btn" type="button">[Open Full Question](https://stackoverflow.com/questions/4594652/strategies-for-dealing-with-datetime-now-in-unit-tests)</button>

æˆ‘ä»¬ç°åœ¨å¯ä»¥å¦‚ä¸‹ä½¿ç”¨è¿™ä¸ªæ‰©å±•:

```
var activeUsers = UserInfoProvider
    .GetUsers()
    .WhereEnabledAndActive()
    .TypedResult
    .ToList(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åº(æˆ–åº“)ä¸­æ•´åˆç‰¹å®šé¢†åŸŸçš„å¯é‡ç”¨æŸ¥è¯¢é€»è¾‘çš„ä¸€ç§ç®€å•æ–¹æ³•ğŸ¤“ã€‚

* * *

## [](#trim-your-raw-select-endraw-s-and-then-project)ä¿®å‰ªä½ çš„`SELECT` s ç„¶åæŠ•å°„ï¼

å½“ç¼–å†™ä¸€ä¸ªæ–°çš„æŸ¥è¯¢æ—¶ï¼Œå¾ˆå®¹æ˜“è¿‡æ»¤å‡ºæƒ³è¦çš„è¡Œï¼Œè€Œå¿˜è®°è¿‡æ»¤åˆ—ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­`DocumentQuery`æ¥æ£€ç´¢ä¸€ä¸ªç«™ç‚¹`Sandbox` :
ä¸Šæ‰€æœ‰å‘å¸ƒçš„`Article`æ–‡æ¡£

```
string siteName = "Sandbox";

var articles = ArticleProvider
    .GetArticles()
    .OnSite(siteName)
    .Published(true)
    .TypedResult
    .ToList(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæˆ‘ä»¬åªä½¿ç”¨`DocumentName`(æ¥è‡ª`CMS_Document`è¡¨)ã€`NodeGUID`(æ¥è‡ª`CMS_Tree`è¡¨)å’Œ`ArticleSummary`(æ¥è‡ªè¿æ¥çš„`Sandbox_Article`è¡¨)ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ˜ç¡®è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”åªä½¿ç”¨`SELECT`é‚£äº›åˆ—:

```
string siteName = "Sandbox";

var articles = ArticleProvider
    .GetArticles()
    .OnSite(siteName)
    .Published(true)
    .Columns(
        nameof(TreeNode.NodeGUID),
        nameof(TreeNode.DocumentName),
        nameof(Article.ArticleSummary)
    )
    .TypedResult
    .ToList(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¤ªå¥½äº†ï¼æˆ‘ä»¬å·²ç»ç²¾ç®€äº†æˆ‘ä»¬çš„æŸ¥è¯¢ï¼Œä½¿å®ƒæ‰§è¡Œå¾—æ›´å¿«ï¼Œéœ€è¦çš„æ•°æ®åº“èµ„æºæ›´å°‘ğŸ‰ğŸ‰ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæœ‰æ¼æ´çš„æŠ½è±¡ğŸ˜©ï¼

`Article`ç±»å‹åº”è¯¥è¡¨ç¤ºæ¥è‡ª`CMS_Tree`ã€`CMS_Document`å’Œ`Sandbox_Article`è¡¨è¿æ¥çš„å®Œå…¨æ°´åˆçš„å¯¹è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬åªå¡«å……äº†å®ƒçš„ä¸‰ä¸ªå±æ€§ã€‚

å¦‚æœæˆ‘ä»¬ä»¥`IEnumerable<Article>`çš„å½¢å¼ä»ä¸€ä¸ªæ–¹æ³•è¿”å›è¿™ä¸ªæ•°æ®ï¼Œæˆ‘ä»¬è¦ä¹ˆ...

1.  âŒå¯¹æ¶ˆè´¹è€…ä¸è¯šå®ï¼Œæ¶ˆè´¹è€…è®¤ä¸ºä»–ä»¬å¯ä»¥ä½¿ç”¨`Article`ä¸Šçš„ä»»ä½•å±æ€§ã€‚
2.  âŒè¿«ä½¿æ¶ˆè´¹è€…çŸ¥é“æ­£åœ¨æ‰§è¡Œçš„æŸ¥è¯¢çš„ç¡®åˆ‡å½¢å¼å’Œè¯­æ³•ã€‚

è¿™ä¸¤ä¸ªé€‰é¡¹éƒ½ä¸ç†æƒ³ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ç»§ç»­ä½¿ç”¨`Article`ç±»å‹ï¼Œè€Œæ˜¯å°†æŸ¥è¯¢ç»“æœæŠ•å°„åˆ°ä¸€ä¸ªåŒ¿åç±»å‹(å¦‚æœå®ƒä¸éœ€è¦ç¦»å¼€æ–¹æ³•çš„èŒƒå›´)ï¼Œæˆ–è€…ä¸€ä¸ªå®šåˆ¶çš„ C#ç±»:

```
string siteName = "Sandbox";

var articles = ArticleProvider
    .GetArticles()
    .OnSite(siteName)
    .Published(true)
    .Columns(
        nameof(TreeNode.NodeGUID),
        nameof(TreeNode.DocumentName),
        nameof(Article.ArticleSummary)
    )
    .TypedResult
    .Select(a => new { a.NodeGUID, a.DocumentName, a.ArticleSummary })
    .ToList();

foreach(var article in articles)
{
    Debug.WriteLine($"{article.NodeGUID} - {article.DocumentName}");
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½¿ç”¨è¿™ç§æ–¹æ³•æ„å‘³ç€æŸ¥è¯¢åçš„ä»£ç æ˜¯é’ˆå¯¹æˆ‘ä»¬ä»æ•°æ®åº“ä¸­æ£€ç´¢çš„ç¡®åˆ‡æ•°æ®é›†çš„å¼ºç±»å‹ä»£ç ğŸ¤—ã€‚

ä¸¢å¤±å€¼çš„å±æ€§ä¸ä¼šæ„å¤–åœ°è¢«ä¾èµ–ï¼Œæ¶ˆè´¹è€…ä¹Ÿä¸å¿…çŸ¥é“æŸ¥è¯¢ä¸­çš„å†…å®¹ã€‚

æˆ‘çš„ç»éªŒæ³•åˆ™æ˜¯:

**å¦‚æœä½ æƒ³ç”¨`.Columns()`æ¥ä¿®æ•´ä½ çš„`SELECT`ï¼Œé‚£å°±åšä¸€ä¸ªå¥½çš„å¼€å‘è€…ï¼Œæ°¸è¿œåšé¡¹ç›®ï¼**

å®ƒæŠ¼éŸµï¼Œè¿™å°±æ˜¯ä½ çŸ¥é“å®ƒæ˜¯å¥½çš„ğŸ˜ã€‚

* * *

## [](#debug-your-queries)è°ƒè¯•æ‚¨çš„æŸ¥è¯¢

æˆ‘ä»¬å°†ç»å¸¸é‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬çš„æŸ¥è¯¢æ²¡æœ‰è¿”å›æˆ‘ä»¬æœŸæœ›çš„æ•°æ®ï¼Œå¹¶ä¸”å¾ˆéš¾å¼„æ¸…æ¥šå¹•åå‘ç”Ÿäº†ä»€ä¹ˆğŸ˜’ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ˜¯ä½¿ç”¨ ORM å¸¦æ¥çš„é—®é¢˜ä¹‹ä¸€ã€‚C#ä¸æ˜¯ SQLï¼ŒSQL ä¹Ÿä¸æ˜¯ C#ã€‚

> æœ‰ä¸€ç¯‡å…³äºå¼€å‘äººå‘˜åœ¨ä½¿ç”¨ ORM æ—¶ç»å¸¸çœ‹åˆ°çš„é—®é¢˜çš„é•¿è€Œæœ‰è¶£çš„å¸–å­ğŸ’¯ã€‚
> 
> å¦‚æœæœ‰å…´è¶£ï¼Œä½ å¯ä»¥é˜…è¯»æ°å¤«Â·é˜¿ç‰¹ä¼å¾·å¯¹æ–‡ç« çš„çœ‹æ³•æˆ– T2 çš„åŸè‘—ï¼Œåªè¦ä½ èƒ½æ‰¾åˆ°ä¸€æŠŠèˆ’é€‚çš„æ¤…å­ã€‚

æœ‰å‡ ç§æ–¹æ³•å¯ä»¥â€œè°ƒè¯•â€ç”±æˆ‘ä»¬ä» Kentico çš„åº“ä¸­ä½¿ç”¨çš„ API ç»„åˆç”Ÿæˆçš„ SQLã€‚

æœ€ç»å…¸ï¼Œä½†ä¹Ÿæœ€ç—›è‹¦ğŸ˜åœ¨æˆ‘çœ‹æ¥ï¼Œå°±æ˜¯ä»[SQL Server Management Studio(SSMS)](https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017)å†…éƒ¨ä½¿ç”¨ [SQL Profiler](https://docs.microsoft.com/en-us/sql/tools/sql-server-profiler/sql-server-profiler?view=sql-server-2017#sql-server-profiler-1) ã€‚

è¿™å°±åƒä½¿ç”¨å–·ç¯ğŸ”¥ç‚¹ç‡ƒèœ¡çƒ›ï¼ŒğŸ•¯ï¼

### [](#expressiondebugview)è¡¨æƒ…ã€‚è°ƒè¯•è§†å›¾

å¹¸è¿çš„æ˜¯ï¼ŒC#ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§ç°æˆçš„æ–¹æ³•æ¥è°ƒè¯•ç”Ÿæˆçš„ SQL æ–‡æœ¬ã€‚

ç”±äº Kentico çš„æŸ¥è¯¢ API ç”Ÿæˆä¸€ä¸ªè¢«è½¬æ¢æˆ SQL çš„`Expression`,æˆ‘ä»¬å¯ä»¥åœ¨è°ƒè¯•è¿è¡Œä¸­çš„åº”ç”¨ç¨‹åºæ—¶æŸ¥çœ‹ SQL æ–‡æœ¬ã€‚

è¯¥ SQL æ–‡æœ¬å¯ä»¥åœ¨`ObjectQuery<T>.Expression.DebugView`æˆ–`DocumentQuery<T>.Expression.DebugView`ä¸Šæ‰¾åˆ°ï¼Œå¦‚ä¸‹æ‰€ç¤º:

[![Expression DebugView](img/3d7fb68981ffda9c088944c7996a85df.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--NjPlUONi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ttfz85cqedw35wh9n60q.jpg)

è¿™æ˜¯ç”±ä¸‹é¢çš„`ObjectQuery<UserInfo>`ä»£ç ç”Ÿæˆçš„ SQL:

```
var usersQuery = UserInfoProvider
    .GetUsers()
    .WhereEquals(nameof(UserInfo.UserEnabled), true);

var users = usersQuery
    .TypedResult
    .ToList(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªä¸­é—´å˜é‡`usersQuery`ï¼Œæ‰èƒ½çœ‹åˆ°`DebugView`ã€‚

å¦‚æœæˆ‘ä»¬åªæœ‰ä¸€ä¸ªå˜é‡ï¼Œè¿™æ˜¯è°ƒç”¨`.ToList()`çš„ç»“æœï¼Œç»“æœå°†æ˜¯ç‰©åŒ–çš„æ•°æ®ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚

```
var users = UserInfoProvider
    .GetUsers()
    .WhereEquals(nameof(UserInfo.UserEnabled), true)
    .TypedResult
    .ToList();

// No `users.Expression` available here! 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ª`DebugView`å±æ€§æ˜¯`internal`ï¼Œæ‰€ä»¥åªèƒ½åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­é€šè¿‡åå°„è®¿é—®[ã€‚](https://stackoverflow.com/a/31360768/939634)

ä½†æ˜¯ä¸è¦æ‹…å¿ƒï¼Œæœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•ğŸ˜…ï¼

### [](#objectquerybasegetfullquerytext)ObjectQueryBase.GetFullQueryText

å¦ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡ Kentico åœ¨`CMS.DataEngine.ObjectQueryBase<TQuery>`ä¸Šæä¾›çš„åä¸º`GetFullQueryText()`çš„æ–¹æ³•ã€‚

å®ƒè¿”å›å°†è¦ç”Ÿæˆçš„ SQL çš„ä¸€ä¸ª`string`ğŸ˜ƒã€‚

```
public string GetFullQueryText(
    bool expand = false, 
    bool includeParameters = true, 
    DataQuerySettings settings = null); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è™½ç„¶è¿™å¯¹äºè·å–æŸ¥è¯¢æ–‡æœ¬æ¥è¯´å¾ˆå¥½ï¼Œä½†æ˜¯æˆ‘ä»¬å¯èƒ½ä¸å¸Œæœ›éå†ä¸€å †æŸ¥è¯¢ï¼Œå¹¶ä½¿`ObjectQuery<T>`çš„ä¸­é—´å˜é‡ä¸æˆ‘ä»¬æƒ³è¦å¤„ç†çš„ç»“æœæ•°æ®é›†åˆ†å¼€ğŸ˜«ã€‚

æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬åšä¸€ä¸ªæ‰©å±•æ–¹æ³•æ¥å¸®åŠ©æˆ‘ä»¬è°ƒè¯•ï¼Œè®©æˆ‘ä»¬çš„ä»£ç æ›´å®¹æ˜“é˜…è¯»å’Œä½¿ç”¨ï¼

```
public static class ObjectQueryExtensions
{
    public static ObjectQuery<T> PrintToDebug<T>(this ObjectQuery<T> query)
        where T : BaseInfo
    {
        string queryText = query.GetFullQueryText();

        Debug.WriteLine(queryText);

        return query;
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ‰äº†è¿™ä¸ªæ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ`.GetFullQueryText()`çš„ä»¥ä¸‹ç”¨æ³•:

```
var usersQuery = UserInfoProvider
    .GetUsers()
    .WhereEquals(nameof(UserInfo.UserEnabled), true);

string queryText = usersQuery.GetFullQueryText();

Debug.WriteLine(queryText);

var users = usersQuery
    .PrintToDebug()
    .TypedResult
    .ToList(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å˜æˆæ›´å®¹æ˜“é˜…è¯»å’Œç»´æŠ¤çš„ä¸œè¥¿:

```
var users = UserInfoProvider
    .GetUsers()
    .WhereEquals(nameof(UserInfo.UserEnabled), true)
    .PrintToDebug()
    .TypedResult
    .ToList(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å‡è®¾æ‚¨æ­£åœ¨è°ƒè¯•åº”ç”¨ç¨‹åºï¼Œè¿™ä¼šå°†å®Œæ•´çš„ SQL æ–‡æœ¬æ‰“å°åˆ° Visual Studio çš„è¾“å‡ºçª—å£ä¸­ğŸ‘ã€‚

[![SQL Query in Output window](img/b495628b4715a16eb688fae3d2f53517.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--wyBzj6zO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zs1k1ygvswjvcfsna73o.jpg)

ä½ å¯ä»¥å¤åˆ¶å¹¶ç²˜è´´åˆ° SSMSï¼ŒAzure æ•°æ®å·¥ä½œå®¤ï¼ŒLinqPad ç­‰...å°è¯•å¹¶è¯Šæ–­æ‚¨çš„æŸ¥è¯¢é—®é¢˜ã€‚

### [](#kenticoglimpse)è‚¯å¸é«˜ã€‚ä¸€ç¥

å¯¹äº Kentico 12 MVC åº”ç”¨ç¨‹åº(å®ƒä¹Ÿå…¼å®¹é—¨æˆ·å¼•æ“ç«™ç‚¹)ï¼ŒKentico æä¾›äº† [Kenticoã€‚æƒŠé¸¿ä¸€ç¥](https://www.nuget.org/packages/Kentico.Glimpse) NuGet åŒ…ã€‚

è¿™ç§ä¸ Glimpse çš„é›†æˆåœ¨ [Glimpse](https://github.com/Glimpse/Glimpse) UI é¢æ¿ä¸­åˆ›å»ºäº†ä¸€ä¸ªâ€œKentico SQLâ€é€‰é¡¹å¡ï¼Œåœ¨åº”ç”¨ç¨‹åºçš„æ¯ä¸ªé¡µé¢å“åº”ä¹‹åï¼Œè¯¥é€‰é¡¹å¡ä¼šå‡ºç°åœ¨æµè§ˆå™¨çš„åº•éƒ¨ã€‚

è¯¥ SQL é€‰é¡¹å¡åŒ…æ‹¬åœ¨é¡µé¢è¯·æ±‚æœŸé—´è¿è¡Œçš„æ‰€æœ‰æŸ¥è¯¢ï¼Œå¹¶åº”ç”¨äº†æ‰€æœ‰å‚æ•°ğŸ‘ã€‚

å¦‚æœæ‚¨å·²ç»å°† Glimpse é›†æˆåˆ°æ‚¨çš„ Kentico åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™æ˜¯è°ƒè¯•æŸ¥è¯¢çš„ä¸€ç§éå¸¸ç®€å•çš„æ–¹æ³•ã€‚

* * *

## [](#summary)æ€»ç»“

æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨`nameof()`æ“ä½œç¬¦æ¥ç¡®ä¿ç”Ÿæˆçš„ SQL æ–‡æœ¬ä¸­çš„åˆ—åæ²¡æœ‰è¾“å…¥é”™è¯¯ã€‚

å®ƒè¿˜æœ‰åŠ©äºæˆ‘ä»¬çš„ä»£ç é˜²é‡æ„ï¼Œé€šè¿‡ç¡®ä¿æˆ‘ä»¬çš„æŸ¥è¯¢åˆ—ä¸ Kentico æä¾›æˆ–ç”Ÿæˆçš„ä»£ç ä¸­çš„åç§°ç›¸åŒ¹é…æ¥æä¾›ä¸€äº›ç±»å‹æ”¯æŒã€‚

æˆ‘ä»¬ç ”ç©¶äº†å¦‚ä½•ä½¿ç”¨æ‰©å±•æ–¹æ³•æ¥åˆ›å»ºå¯é‡ç”¨çš„æŸ¥è¯¢ä»£ç å•å…ƒï¼Œæ¯”æ™®é€šæ–¹æ³•æ›´å°ï¼Œå¹¶ä¸”å‡ ä¹ä¸ Kentico çš„å†…ç½®æŸ¥è¯¢æ–¹æ³•ä¸€æ ·å¯ç»„åˆã€‚

åœ¨æˆ‘ä»¬å°è¯•ä¼˜åŒ–æŸ¥è¯¢ä»¥ä»æ•°æ®åº“ä¸­æ£€ç´¢`Article`æ–‡æ¡£æ—¶ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­åˆ›é€ äº†ä¸€ä¸ªæ··ä¹±ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç±»å‹`Article`ä¸å†åæ˜ æˆ‘ä»¬æŸ¥è¯¢çš„æ•°æ®é›†ã€‚

è¿™å¯¼è‡´äº†ç»éªŒæ³•åˆ™- **å¦‚æœä½ æƒ³ç”¨`.Columns()`æ¥ä¿®æ•´ä½ çš„`SELECT`ï¼Œåšä¸€ä¸ªå¥½çš„å¼€å‘è€…ï¼Œå¹¶ä¸”æ€»æ˜¯åšé¡¹ç›®ï¼æˆ‘æ°¸è¿œä¸ä¼šåŒå€¦è¯´è¿™å¥è¯ğŸ¤£ã€‚**

æœ€åï¼Œæˆ‘ä»¬ç ”ç©¶äº†è°ƒè¯•æŸ¥è¯¢çš„å„ç§æ–¹æ³•ï¼Œå¹¶ç¡®åˆ‡åœ°äº†è§£äº†æ­£åœ¨ç”Ÿæˆçš„ SQL æ–‡æœ¬ã€‚

ä½¿ç”¨æ‰©å±•æ–¹æ³•å’Œ`.GetFullQueryText()`æ–¹æ³•ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç®€å•ä¸”å¯é‡ç”¨çš„è°ƒè¯•è§£å†³æ–¹æ¡ˆã€‚

æˆ‘å¸Œæœ›å¯¹ Kentico çš„æ•°æ®è®¿é—® API`ObjectQuery<T>`å’Œ`DocumentQuery<T>`çš„åˆ†æå¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ã€‚

å¦‚æœä½ å·²ç»çŸ¥é“äº†æ‰€æœ‰è¿™äº›ï¼Œé‚£ä¹ˆå¸Œæœ›æˆ‘ä»¥åå…³äº Kentico çš„æŸ¥è¯¢ API çš„å¸–å­èƒ½å¤Ÿæ¯”è¿™ç¯‡æ–‡ç« æ›´æ·±å…¥åœ°æ¢è®¨è¿™ä¸ªé—®é¢˜ï¼

æ„Ÿè°¢é˜…è¯»ğŸ™ï¼

* * *

å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾æ›´å¤šçš„ Kentico å†…å®¹ï¼Œè¯·åœ¨ DEV:

## # [è‚¯è’‚ç§‘](https://dev.to/t/kentico) <button name="button" type="button" data-info="{&quot;className&quot;:&quot;Tag&quot;,&quot;style&quot;:&quot;full&quot;,&quot;id&quot;:5339,&quot;name&quot;:&quot;kentico&quot;}" class="crayons-btn follow-action-button whitespace-nowrap c-btn--secondary fs-base " aria-label="Follow tag: kentico" aria-pressed="false">è·Ÿéš</button>

æˆ–è€…æˆ‘çš„ Kentico åšå®¢ç³»åˆ—:

*   [Kentico 12:è®¾è®¡æ¨¡å¼](https://dev.to/search?q=Kentico%2012%20-%20Design%20Patterns)