# æ‚¨æƒ³äº†è§£æ›´å¤šå…³äºéšæœºæ£®æ—çš„ä¿¡æ¯å—ï¼Ÿ- fastai ç¬¬ 2 è¯¾

> åŸæ–‡ï¼š<https://dev.to/oyane806/do-you-want-to-learn-more-about-random-forests-fastai-lesson2-5bph>

ä½ å¥½ï¼Œ

ç›®å‰åœ¨è·Ÿ [fast.ai](http://course18.fast.ai/ml.html) å­¦ä¹ æœºå™¨å­¦ä¹ ã€‚è¿™æ˜¯ç¬¬äºŒè¯¾ï¼

æˆ‘æŠŠæˆ‘çš„ç¬”è®°åˆ†ä¸ºå››ç±»:RMSE & Rï¼Œå†³ç­–æ ‘ï¼Œä¸€åŒ…å°åŠ©æ¨å™¨ï¼Œè¶…å‚æ•°è°ƒæ•´ã€‚æœ€å¥½çš„å­¦ä¹ æ–¹æ³•æ˜¯èƒ½å¤Ÿé‡æ–°è§£é‡Šæ‰€æœ‰è¿™äº›ï¼Œå¹¶å°†è¿™äº›æ–°çŸ¥è¯†åº”ç”¨åˆ° Kaggle æ¯”èµ›ä¸­ã€‚

# 1ã€‚RMSE & R

**RMSE** =æ®‹å·®çš„æ ‡å‡†å·®ã€‚

[![RMSE](img/403ed42853c23bcf2e194f4641ac5947.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--JRwEu1al--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/jpwmikxw7006qn6o6xkw.gif)

æ®‹å·®æ˜¯å®é™…æ•°æ®å’Œé¢„æµ‹æ•°æ®ä¹‹é—´çš„å·®å€¼ã€‚åœ¨ä¸‹å›¾ä¸­æ˜¯é»„è‰²çš„ã€‚æ¯ä¸ªæ®‹å·®éƒ½æ˜¯å¹³æ–¹çš„ï¼Œè¿™ä½¿å¾—å¼‚å¸¸å€¼çš„å½±å“æ›´å¼ºï¼Œå¹¶é˜²æ­¢è´Ÿæ®‹å·®å’Œæ­£æ®‹å·®ç›¸äº’æŠµæ¶ˆã€‚

**R** è¡¡é‡ä¸ç®€å•å¹³å‡å€¼ç›¸æ¯”ï¼Œæ¨¡å‹èƒ½åœ¨å¤šå¤§ç¨‹åº¦ä¸Šè§£é‡Šæ•°æ®ã€‚

[![r2](img/e070517bad0c6f8a04485f6c13edd285.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--3NX9NONu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/t20zo8sffe2z3ix18yio.gif)

[![graph](img/ca5dbbcdaadb6ec339827b04c9579325.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--X5JRZm4y--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/aur32j4yysevupikhbby.JPG)

SSres æ˜¯æ®‹å·®çš„å¹³æ–¹å’Œï¼Œåœ¨ä¸Šå›¾ä¸­ç”¨é»„è‰²è¡¨ç¤ºã€‚SStot æ˜¯ä¸æ•°æ®æ–¹å·®æˆæ¯”ä¾‹çš„å¹³æ–¹å’Œï¼Œå®ƒä»¬è¡¨ç¤ºä¸ºä¸Šå›¾ä¸­é»„è‰²å’Œç´«è‰²éƒ¨åˆ†çš„æ€»å’Œã€‚

å½“ SSres ä¸ SStot ä¸€æ ·å¤§(R æ¥è¿‘ 0)æ—¶ï¼Œè¿™æ„å‘³ç€è¯¥æ¨¡å‹å¹¶ä¸æ¯”ç”¨äºé¢„æµ‹çš„ç®€å•å‡å€¼æ›´å¥½ã€‚

r æ˜¯ä½ çš„æ¨¡å‹æœ‰å¤šå¥½ä¸æœ´ç´ å‡å€¼æ¨¡å‹æœ‰å¤šå¥½çš„æ¯”ç‡ã€‚

# 2ã€‚ç®€å•çš„å†³ç­–æ ‘

[![decision-tree](img/63bac780927ab7cee19fb4497b0dde50.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--2YvDG57J--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/eapo4irs9rn5rsrn6fsf.png)

ä¸€æ£µæ ‘ç”±ä¸€ç³»åˆ—äºŒå…ƒå†³ç­–ç»„æˆã€‚

è¯¥ç®—æ³•ä¸ºæ¯ä¸ªå˜é‡(è€¦åˆå™¨ _ ç³»ç»Ÿã€å¤–å£³ç­‰)ã€è¯¥å˜é‡çš„æ¯ä¸ªå¯èƒ½å€¼(< 0.1ã€< 0.2 ç­‰)è®¡ç®—ä¸¤ä¸ªæ–°èŠ‚ç‚¹çš„åŠ æƒå¹³å‡å€¼(æ­¤å¤„ä¸ºç¬¬ä¸€æ¬¡åˆ†å‰² 16815 x 0.414 + 3185 x 0.109)ã€‚å®ƒä¿ç•™äº†æœ€ä½³åˆ†æ•°çš„å˜é‡å’Œå€¼ã€‚

# 3ã€‚ä¸€åŒ…å°é´å­

ä¸ºäº†æ”¹è¿›ä¸€ä¸ªç®€å•çš„å†³ç­–æ ‘ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ£®æ—ï¼Œä½¿ç”¨ä¸€ç§å«åš bagging çš„ç»Ÿè®¡æŠ€æœ¯ã€‚å…³é”®æ˜¯åœ¨ä¸åŒçš„æ•°æ®å­é›†ä¸Šæ„å»ºå¤šä¸ªæ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹æ¯”ä»€ä¹ˆéƒ½æ²¡æœ‰è¦å¥½ï¼Œå¹¶ä¸”å…¶ä¸­çš„è¯¯å·®å°½å¯èƒ½å½¼æ­¤ä¸ç›¸å…³ã€‚

å½“å–è¿™äº›æ¨¡å‹çš„å¹³å‡å€¼æ—¶ï¼Œç²¾ç¡®åº¦ä¼˜äºç®€å•å†³ç­–æ ‘çš„ç²¾ç¡®åº¦ã€‚

ä¸€ä¸ª **bootstrap** æ˜¯åŸå§‹æ•°æ®çš„ä¸€ä¸ªéšæœºå­é›†ï¼Œæœ‰æ—¶ç”¨æ›¿æ¢æ¥ç»˜åˆ¶ã€‚ä¸€äº›æ ·æœ¬å¯èƒ½åœ¨æ¯æ¬¡åˆ†å‰²ä¸­å‡ºç°å¤šæ¬¡ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯ï¼Œä¸€ä¸ª bootstrap åªåŒ…å«æ•´ä¸ªè§‚å¯Ÿé›†çš„ä¸€éƒ¨åˆ†ã€‚Bootstrap ç”¨äºæ¯æ¬¡åœ¨ä¸åŒçš„è§‚å¯Ÿé›†åˆä¸Šè®­ç»ƒä¸åŒçš„åˆ†ç±»å™¨ã€‚

æœªä½¿ç”¨çš„éƒ¨åˆ†å½¢æˆ**å‡ºè¢‹**ï¼Œå¯ç”¨äºè¯„ä¼°åˆ†ç±»å™¨çš„é”™è¯¯ç‡ã€‚Set `oob_score=True`å°†ä¸ºæ¨¡å‹åˆ›å»ºä¸€ä¸ªåä¸º`oob_score_`çš„å±æ€§ã€‚è¿™æ˜¯éå¸¸æœ‰ç”¨çš„è¶…å‚æ•°è°ƒæ•´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸éœ€è¦éªŒè¯é›†ã€‚

[![bootstrap](img/dc5eb98c5d7cb0ad10a1b5c262763b36.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--LyqhkKne--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/me7sj35oq0uyfht4400j.JPG)

åœ¨ scikit-learn ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªåä¸º`ExtraTreeClassifier`çš„ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæåº¦éšæœºåŒ–çš„æ ‘æ¨¡å‹ã€‚å®ƒä¸æ˜¯å°è¯•æ¯ä¸ªå˜é‡çš„æ¯ä¸ªåˆ†è£‚ï¼Œè€Œæ˜¯éšæœºå°è¯•å‡ ä¸ªå˜é‡çš„å‡ ä¸ªåˆ†è£‚ï¼Œè¿™ä½¿å¾—è®­ç»ƒæ›´å¿«ï¼Œå¹¶ä¸”å¯ä»¥å»ºç«‹æ›´å¤šçš„æ ‘â€”â€”æ›´å¥½çš„æ³›åŒ–èƒ½åŠ›ã€‚

ğŸ‘‰å°è´´å£«:å…ˆä» 20 æˆ– 30 æ£µæ ‘å¼€å§‹ï¼Œç„¶åè¯•ç€ç§ 1000 æ£µæ ‘ã€‚

åœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¢„æµ‹ç²¾åº¦éšç€éšæœºæ£®æ—ä¸­æ ‘æœ¨æ•°é‡çš„å¢åŠ è€Œæé«˜ã€‚

[![Alt Text](img/35b13d950889ee7150173febb320669d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--LOIxTgRp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ov67uziehl4nyrkw3686.JPG)

# 4ã€‚è¶…å‚æ•°è°ƒè°

`n_estimators=40`ä»£è¡¨å¹³å‡çš„æ ‘æ•°ã€‚

`max_depth=3`è¡¨ç¤ºå†³ç­–æ ‘å°†åªä½¿ç”¨ 3 çº§å†³ç­–ã€‚

å½“ä¸€ä¸ªå¶å­èŠ‚ç‚¹æœ‰ 3 ä¸ªæˆ–æ›´å°‘çš„æ ·æœ¬æ—¶ï¼Œå®ƒåœæ­¢è¿›ä¸€æ­¥è®­ç»ƒæ ‘(åœ¨æˆ‘ä»¬ä¸€ç›´ä¸‹é™åˆ° 1 ä¹‹å‰)ã€‚æ¯ä¸€ä¸ªæ ‘å°†ä¼šæ›´å¥½åœ°æ¦‚æ‹¬ï¼Œä½†æ˜¯åœ¨å®ƒè‡ªå·±èº«ä¸Šä¼šç¨å¾®ä¸é‚£ä¹ˆå¼ºå¤§ã€‚

ğŸ‘‰æç¤º:æ•ˆæœè¾ƒå¥½çš„æ•°å­—æ˜¯ 1ã€3ã€5ã€10ã€25ï¼Œä½†è¿™æ˜¯ç›¸å¯¹äºæ•´ä½“æ•°æ®é›†å¤§å°è€Œè¨€çš„ã€‚

è¿™ä¸ªæƒ³æ³•æ˜¯æ ‘ä¸æ ‘ä¹‹é—´çš„ç›¸å…³æ€§è¶Šå°è¶Šå¥½ã€‚å¯¹äºè¡Œé‡‡æ ·ï¼Œæ¯ä¸ªæ–°æ ‘éƒ½åŸºäºä¸€ç»„éšæœºçš„è¡Œã€‚å¯¹äºåˆ—é‡‡æ ·ï¼Œå¯¹äºæ¯ä¸ªå•ç‹¬çš„äºŒè¿›åˆ¶æ‹†åˆ†ï¼Œæˆ‘ä»¬ä»ä¸åŒçš„åˆ—å­é›†ä¸­è¿›è¡Œé€‰æ‹©ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†åªä½¿ç”¨ä¸€åŠçš„åˆ—ã€‚

ğŸ‘‰æç¤º:å¯ä»¥ä½¿ç”¨çš„å€¼æ˜¯ 1ã€0.5ã€log2 æˆ– sqrtã€‚

Scikit-learn æœ‰ä¸€ä¸ªåä¸º **grid-search** çš„å‡½æ•°ï¼Œå®ƒåˆ—å‡ºäº†æ‚¨æƒ³è¦è°ƒæ•´çš„æ‰€æœ‰è¶…å‚æ•°ä»¥åŠæ‚¨æƒ³è¦å°è¯•çš„è¿™äº›è¶…å‚æ•°çš„æ‰€æœ‰å€¼ã€‚å®ƒå°†åœ¨æ‰€æœ‰è¿™äº›è¶…å‚æ•°çš„æ¯ä¸ªå¯èƒ½ç»„åˆä¸Šè¿è¡Œæ¨¡å‹ï¼Œå¹¶å‘Šè¯‰å“ªä¸€ä¸ªæ˜¯æœ€å¥½çš„ã€‚

**è®­ç»ƒé›†/éªŒè¯é›†/æµ‹è¯•é›†**:è®­ç»ƒé›†ç”¨äºè®­ç»ƒæ¨¡å‹ï¼ŒéªŒè¯é›†ç”¨äºè°ƒæ•´è¶…å‚æ•°ï¼Œæµ‹è¯•é›†æœ‰åŠ©äºåœ¨æœ€åæ£€æŸ¥è°ƒæ•´åçš„æ¨¡å‹æ˜¯å¦é€‚ç”¨äºæœªçŸ¥æ•°æ®

åˆ›å»ºå®šå‹é›†å’ŒéªŒè¯é›†æœ‰ä¸åŒçš„æ–¹æ³•:

*   åˆ¶è¢‹ææ–™
*   k å€äº¤å‰éªŒè¯

[![dataset](img/b74cca8c7d810ec3d820cde788bd4f61.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--8uDUKUkG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/rm10okii013boihnxzyl.JPG)

å½“å¤„ç†ä¸€ä¸ªæ–°çš„æ•°æ®é¡¹ç›®æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å¿«é€Ÿè¿­ä»£ï¼Œå¦‚æœè¿è¡Œæ¨¡å‹éœ€è¦è¶…è¿‡ 10 ç§’ï¼Œé‚£ä¹ˆåˆ›å»ºä¸€ä¸ªæ•°æ®å­é›†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µã€‚

```
X_train, _ = split_vals(df_trn, 20000)
y_train, _ = split_vals(y_trn, 20000) 
```

* * *

*å¯ä»¥åœ¨ Instagram ä¸Šå…³æ³¨æˆ‘ [@oyane806](https://www.instagram.com/oyane806/) ï¼*