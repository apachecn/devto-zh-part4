# ä¸ºæ¯ä¸ªäººçš„â›µï¸ğŸ’¡ğŸ‰

> åŸæ–‡ï¼š<https://dev.to/sendilkumarn/istio-for-everyone-5hgb>

> è¿™éœ€è¦(éå¸¸)ä¸€ç‚¹ Kubernetes çŸ¥è¯†ã€‚

å‡è®¾æ‚¨æœ‰ä¸€ä¸ªç”µå­å•†åŠ¡åº”ç”¨ç¨‹åºã€‚è¯¥åº”ç”¨ç¨‹åºç”±ä»¥ä¸‹ç»„ä»¶ç»„æˆ:

1.  äº§å“æœåŠ¡â€”â€”è¯¥æœåŠ¡è´Ÿè´£å¤„ç†æ‰€æœ‰ä¸äº§å“ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚åç§°ã€ä»·æ ¼å’Œåº“å­˜ã€‚
2.  å‘ç¥¨æœåŠ¡â€”â€”è¯¥æœåŠ¡è´Ÿè´£å¤„ç†æ‰€æœ‰ä¸å‘ç¥¨ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚åˆ›å»ºè´¦å•ã€è·Ÿè¸ªè´¦å•æ˜¯å¦å·²æ”¯ä»˜ç­‰ã€‚
3.  é€šçŸ¥æœåŠ¡-è¯¥æœåŠ¡è´Ÿè´£å¤„ç†æ‰€æœ‰ä¸é€šçŸ¥ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚å‘é€ç”µå­é‚®ä»¶ã€‚

> æ³¨æ„ï¼Œè¿˜å¯ä»¥æœ‰å…¶ä»–æœåŠ¡ï¼Œä½†ä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘ä»¬å°±æ­¤æ‰“ä½ã€‚

åœ¨å•ä¸€çš„ä¸–ç•Œä¸­ï¼Œæ‰€æœ‰è¿™äº›æœåŠ¡å°†å­˜åœ¨äºåŒä¸€ä¸ªåº”ç”¨ç¨‹åº(æ‰§è¡Œç¯å¢ƒ)ä¸­ã€‚å› æ­¤ï¼Œæ¯å½“å‘ç¥¨æœåŠ¡éœ€è¦è°ƒç”¨é€šçŸ¥æœåŠ¡æ—¶ï¼Œå®ƒæ‰€è¦åšçš„å°±æ˜¯åšä¸€ä¸ªç®€å•çš„æ–¹æ³•è°ƒç”¨(å¤§å¤šæ•°æƒ…å†µä¸‹)ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘ç¥¨æœåŠ¡ä¸éœ€è¦æ£€æŸ¥é€šçŸ¥æ˜¯å¦å¯åŠ¨å¹¶è¿è¡Œï¼Œæ‰¾åˆ°å®ƒæ‰€åœ¨çš„ä½ç½®ï¼Œç„¶åé€šè¿‡ç½‘ç»œå‘å‡ºè¿æ¥è¯·æ±‚å¹¶ç­‰å¾…å›å¤ã€‚

[![](img/cb476cb04d5de947734a771cfe6d9bed.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--5iezoryg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/alsj967bv28h6kqurv97.gif)

åœ¨å¾®æœåŠ¡é¢†åŸŸï¼Œå½“å‘ç¥¨æœåŠ¡éœ€è¦è°ƒç”¨é€šçŸ¥æœåŠ¡æ—¶ã€‚

å‘ç¥¨æœåŠ¡é¦–å…ˆéœ€è¦éªŒè¯é€šçŸ¥æœåŠ¡æ˜¯å¦å¯ç”¨ã€‚(æˆ‘ä»¬æš‚ä¸”ç§°ä¹‹ä¸º`imaginary`æœåŠ¡ã€‚)

å¦‚æœé€šçŸ¥æœåŠ¡å¯ç”¨ï¼Œé‚£ä¹ˆå‘ç¥¨æœåŠ¡å¿…é¡»æ‰¾åˆ°è¿æ¥åˆ°é€šçŸ¥æœåŠ¡çš„æ–¹æ³•(ä¾‹å¦‚å®ƒçš„ DNS åç§°)ã€‚

ç„¶åï¼Œå‘ç¥¨æœåŠ¡å°†å‘é€šçŸ¥æœåŠ¡å‘å‡ºè¯·æ±‚ã€‚

[![](img/5c720c844638e453a34dd7e792ffd312.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--zjvraVyo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/z12vf8vp1ewu37xssqif.gif)

> TLï¼›åœ¨å¾®æœåŠ¡é¢†åŸŸï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚

`imaginary`æœåŠ¡è¢«ç§°ä¸º`Service registers`ã€‚

æœåŠ¡åœ¨å¯åŠ¨æˆ–å…³é—­æ—¶ä¼šé€šçŸ¥æœåŠ¡æ³¨å†Œå™¨å®ƒä»¬çš„ä½ç½®å’ŒçŠ¶æ€ã€‚

ä»»ä½•æƒ³è¦è¿æ¥åˆ°å¦ä¸€ä¸ªæœåŠ¡(å¦‚`notification`)çš„æœåŠ¡(å¦‚`invoice`)éƒ½å°†é¦–å…ˆæŸ¥è¯¢æœåŠ¡æ³¨å†Œå™¨ï¼Œä»¥è·å¾—å…³äºå¦‚ä½•è¿æ¥ä»¥åŠåœ¨å“ªé‡Œè¿æ¥çš„ä¿¡æ¯ï¼Œç„¶åå†è¿›è¡Œè¿æ¥ã€‚

ä½†æ˜¯å½“æœåŠ¡çªç„¶ç»ˆæ­¢æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚æœåŠ¡æ— æ³•å‘æœåŠ¡å¯„å­˜å™¨å‘é€æ­£ç¡®çš„`shut down`ä¿¡å·ã€‚è¿™æ„å‘³ç€æœåŠ¡æ³¨å†Œæ˜¾ç¤ºç‰¹å®šæœåŠ¡å·²å¯åŠ¨ï¼Œä½†å®ƒå¹¶æœªå¯åŠ¨ã€‚

ä¸ºäº†é¿å…è¿™äº›æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦`health checkers`ã€‚

å¥åº·æ£€æŸ¥å™¨å°†ä¸æ—¶åœ°å» ping æœåŠ¡æˆ–è€…æœåŠ¡é€šçŸ¥å¥åº·æ£€æŸ¥å™¨å®ƒä»¬çš„çŠ¶æ€ã€‚

è¿™äº›è„‰å†²è¢«ç§°ä¸º`heart beat`ğŸ’—ã€‚

æ¯å½“æœåŠ¡åœæ­¢å‘é€å¿ƒè·³(é€šå¸¸åœ¨é˜ˆå€¼æ°´å¹³ä¹‹åä»¥è¡¥å¿ç½‘ç»œæŸå¤±)ï¼ŒæœåŠ¡å°±è¢«æ ‡è®°ä¸ºå…³é—­ã€‚

ä»»ä½•å°†æ¥å‘æœåŠ¡æ³¨å†Œä¸­å¿ƒè¯·æ±‚æœåŠ¡çš„è¯·æ±‚éƒ½å°†è·å¾—ä¸€ä¸ªå¥åº·æœåŠ¡çš„åœ°å€ã€‚

ä¸ºäº†è®©å¾®æœåŠ¡æ­£å¸¸å·¥ä½œï¼Œå¥åº·æ£€æŸ¥å™¨å’ŒæœåŠ¡æ³¨å†Œè¡¨éœ€è¦æ˜¯é«˜åº¦å¯ç”¨çš„ç»„ä»¶ã€‚

> TLï¼›åœ¨å¾®æœåŠ¡é¢†åŸŸä¸­ï¼Œæˆ‘ä»¬éœ€è¦æœåŠ¡æ³¨å†Œå’Œå¥åº·æ£€æŸ¥å™¨æ¥ä½¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ­£å¸¸å·¥ä½œã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä»€ä¹ˆæ˜¯ Istioï¼Œä»¥åŠå®ƒå¦‚ä½•å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

åœ¨æ·±å…¥ç ”ç©¶ Istio ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£`service mesh`ã€‚

# ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼Ÿ

istio ç½‘ç«™å¯¹æœåŠ¡ç½‘æ ¼çš„æè¿°å¦‚ä¸‹:

> æœ¯è¯­â€œæœåŠ¡ç½‘æ ¼â€ç”¨äºæè¿°ç»„æˆæ­¤ç±»åº”ç”¨ç¨‹åºçš„å¾®æœåŠ¡ç½‘ç»œä»¥åŠå®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚

åœ¨å¾®æœåŠ¡ä¸–ç•Œä¸­ï¼Œå°†ä¼šæœ‰è®¸å¤šä»¥ä¸åŒå®¹é‡è¿è¡Œçš„æœåŠ¡çš„åŒ–èº«ã€‚å®ƒä»¬æ˜¯åˆ†å¸ƒå¼çš„ã€‚è¿™äº›æœåŠ¡åº”è¯¥æ˜¯äº’è¿çš„ã€‚æœåŠ¡ç½‘æ ¼æè¿°äº†è¿™äº›ç›¸äº’è¿æ¥çš„æœåŠ¡åŠå…¶äº¤äº’ã€‚

[![](img/0be6fa106782c7fff3880361c19395d0.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--xdlh0WHc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5thnuu55i9f974cvklit.jpeg)

# é‚£ä¹ˆï¼ŒIstio æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ

ç®€è€Œè¨€ä¹‹ï¼ŒIstio åšäº†ä»¥ä¸‹å·¥ä½œ:

[![](img/a947dd95fe939eaff797d63c675aaff2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--OegQZb4F--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ooj2o8g81waizec0n4ky.gif)

å¾®æœåŠ¡ä¸­çš„æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€äº›å…¬å…±æœåŠ¡ï¼ŒåŒ…æ‹¬æ—¥å¿—è®°å½•ã€ç›‘æ§å’Œè”ç½‘(ç”¨äºè´Ÿè½½å¹³è¡¡ç­‰)ã€‚Istio å°†å®ƒä»¬ä½œä¸ºå…¬å…±æœåŠ¡ä»æ‚¨çš„åº”ç”¨ç¨‹åºä¸­æå–å‡ºæ¥ã€‚ä»¥ä¾¿æ‚¨çš„åº”ç”¨ç¨‹åºä¸éœ€è¦æ‹…å¿ƒå®ƒä»¬ã€‚

Istio åœ¨æœåŠ¡ç½‘æ ¼ä¸­æ‰§è¡Œä»¥ä¸‹æœåŠ¡:

*   è¿æ¥
    *   è¿æ¥æœåŠ¡ç½‘æ ¼å†…éƒ¨çš„æœåŠ¡
    *   å¸®åŠ©ç®¡ç†äº¤é€š
        *   è‡ªåŠ¨è´Ÿè½½å¹³è¡¡
*   æ§åˆ¶
    *   æ§åˆ¶è¿›å…¥æœåŠ¡çš„è¯·æ±‚
        *   è·¯ç”±è§„åˆ™
        *   é‡è¯•æ¬¡æ•°
        *   æ•…éšœè½¬ç§»
        *   æ•…éšœæ³¨å…¥å’Œå…¶ä»–
*   å®‰å…¨çš„
    *   ä¿æŠ¤æœåŠ¡å¯¹æœåŠ¡çš„é€šä¿¡
    *   æˆæƒå¹¶éªŒè¯è¯·æ±‚
*   è§‚å¯Ÿ
    *   è‡ªåŠ¨æ”¶é›†æŒ‡æ ‡ã€æ—¥å¿—å’Œè·Ÿè¸ª

æœ€é‡è¦çš„æ˜¯ï¼Œå®ƒåšäº†æ‰€æœ‰è¿™äº›(å’Œå…¶ä»–çš„)ã€‚

å“‡å“¦ï¼ï¼ï¼ä½†æ˜¯ Istio æ˜¯å¦‚ä½•åœ¨ä¸åšä»»ä½•ä»£ç æ”¹åŠ¨çš„æƒ…å†µä¸‹å®ç°çš„å‘¢ï¼Ÿ

Istio é€šè¿‡`Sidecar pattern`å®ç°ã€‚

# é‚£ä¹ˆä»€ä¹ˆæ˜¯è¾¹è½¦æ ¼å±€å‘¢ï¼Ÿ

> ç›®å‰ï¼ŒIstio è¿è¡Œåœ¨ Kubernetes ä¹‹ä¸Šã€‚

å¦‚æœä½ æƒ³çŸ¥é“ Kubernetes æ˜¯ä»€ä¹ˆï¼Œçœ‹çœ‹è¿™ä¸ªå¸–å­ã€‚

åœ¨ Kubernetes ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸€ä¸ª Pod åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚Istio å°†ä¸€ä¸ªå®¹å™¨ä¸åº”ç”¨ç¨‹åºçš„å®¹å™¨ä¸€èµ·é™„åŠ åˆ° pod å†…éƒ¨ã€‚è¿™ä¸ªä¸åº”ç”¨ç¨‹åºçš„å®¹å™¨å¹¶è¡Œè¿è¡Œçš„å®¹å™¨è¢«ç§°ä¸º`sidecar`ã€‚

è¿™ç§é™„åŠ è¾¹è½¦å®¹å™¨çš„æ¨¡å¼(å°±åƒç»™ä½ çš„æ‘©æ‰˜è½¦é™„åŠ è¾¹è½¦ä¸€æ ·)è¢«ç§°ä¸º`sidecar pattern`ã€‚

ç‚¹å‡»æŸ¥çœ‹æ›´å¤šå…³äºè¾¹è½¦æ¨¡å¼[çš„ä¿¡æ¯ã€‚](https://docs.microsoft.com/en-us/azure/architecture/patterns/sidecar)

å¥½å§ï¼Œé‚£ä¹ˆè¿™ä¸ªè¾¹è½¦æ˜¯å¦‚ä½•å¸®åŠ© Istio å®ç°å®ƒçš„æ‰¿è¯ºçš„å‘¢ï¼Ÿ

*è¯»ä¸‹å»...*

# Istio æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

ç”¨ Istio æœ¯è¯­æ¥è¯´ï¼Œè¿™ä¸ªè¾¹è½¦é›†è£…ç®±å«åš`proxy`é›†è£…ç®±ã€‚ä»£ç†å®¹å™¨ä¸åº”ç”¨ç¨‹åºå®¹å™¨åŒç”ŸåŒæ­»ã€‚ä»£ç†å®¹å™¨ç°åœ¨å°†å†³å®šå¯ä»¥è¿›å‡ºåº”ç”¨ç¨‹åºå®¹å™¨çš„è¯·æ±‚ã€‚

> ç­‰ç­‰ï¼Œè¿™æ˜¯å¦æ„å‘³ç€ä½ çš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¼šé™ä½ï¼Ÿå»¶è¿Ÿæ˜¯å¦å¢åŠ ï¼Ÿ- `The short answer is yes.`

æ·»åŠ æ­¤ä»£ç†å®¹å™¨ä¼šå¢åŠ å»¶è¿Ÿå¹¶é™ä½æ€§èƒ½ã€‚

ä½†æ˜¯ä»£ç†å®¹å™¨å°†ä½¿ç”¨[ç‰¹ä½¿](https://envoyproxy.github.io/envoy/)ä»£ç†ã€‚

> Envoy æ˜¯ä¸€ä¸ª L7 ä»£ç†å’Œé€šä¿¡æ€»çº¿ï¼Œè®¾è®¡ç”¨äºå¤§å‹ç°ä»£é¢å‘æœåŠ¡çš„æ¶æ„ã€‚-ç‰¹ä½¿ç½‘ç«™

ç‰¹ä½¿æ˜¯å†™åœ¨ C++å’Œå®ƒæ˜¯è½»é‡çº§å’Œå‡è½»âš¡ï¸fast.

è¿™æ„å‘³ç€æ·»åŠ åˆ°æ¯ä¸ªæœåŠ¡è°ƒç”¨çš„å¼€é”€éå¸¸å°ã€‚

> æƒ³äº†è§£æ›´å¤šå…³äºç‰¹ä½¿ä»£ç†çš„ä¿¡æ¯-ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚

[![](img/cb7c138e292e07f6d86dfee8221a5621.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--UXDMbtiQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/nitj6wye15qtjkivwza6.gif)

è¿™äº›ä»£ç†è´Ÿè´£åº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„æ‰€æœ‰é€šä¿¡ã€‚

å¥½äº†ï¼Œç°åœ¨æœ‰äº† sidecar ä»£ç†ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶è¯·æ±‚ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•å‘ä»£ç†æä¾›è§„åˆ™æˆ–é…ç½®å‘¢ï¼Ÿæˆ‘ä»¬å¦‚ä½•ä»è¾¹è½¦ä»£ç†æ”¶é›†æ‰€æœ‰çš„é¥æµ‹æ•°æ®ï¼Ÿå¦‚æœè¿™äº›æ˜¯ä½ çš„é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨æ­£ç¡®çš„è½¨é“ä¸Šã€‚

è¾¹è½¦ä»£ç†çš„é¥æµ‹æ•°æ®ç”±æ··åˆå™¨æ”¶é›†ã€‚

æ··åˆå™¨è¿˜è´Ÿè´£è·¨æœåŠ¡ç½‘æ ¼åº”ç”¨ç­–ç•¥å’Œè®¿é—®æ§åˆ¶ã€‚

> æ··åˆå™¨+ç‰¹ä½¿ä»£ç†= >æ•°æ®å¹³é¢

[![](img/a22319922733450f71585492954e99c4.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--UCF9VU9u--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/44c7f0qwwvelu4tfdd3q.gif)

æ··åˆå™¨å’Œä»£ç†ä¸€èµ·è¢«ç§°ä¸º Istio çš„`data plane`ã€‚

> TLï¼›DR ç‰¹ä½¿ä»£ç†è´Ÿè´£å°†è¯·æ±‚å’Œå“åº”ä»£ç†åˆ°å®¹å™¨ä¸­ã€‚å¦ä¸€æ–¹é¢ï¼Œæ··åˆå™¨è´Ÿè´£åœ¨æœåŠ¡ç½‘æ ¼ä¸­å®æ–½è®¿é—®æ§åˆ¶å’Œä½¿ç”¨ç­–ç•¥ï¼Œå¹¶ä»ç‰¹ä½¿ä»£ç†(å’Œå…¶ä»–æœåŠ¡)æ”¶é›†é¥æµ‹æ•°æ®ã€‚

* * *

ä¸ Kubernetes ç±»ä¼¼ï¼ŒIstio ä¹Ÿæœ‰`control plane`ã€‚æ§åˆ¶å¹³é¢æ˜¯ Istio çš„`brain` ğŸ§ ã€‚

è¿™æ˜¯æˆ‘ä»¬å®šä¹‰ç­–ç•¥/é…ç½®/è§„åˆ™çš„åœ°æ–¹ã€‚è¿™äº›è§„åˆ™æ˜¯åŠ¨æ€åº”ç”¨çš„ï¼Œæ²¡æœ‰ä»»ä½•åœæœºæ—¶é—´ã€‚

Istio çš„æ§åˆ¶å¹³é¢ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆ:

*   é£è¡Œå‘˜ğŸ‘©â€âœˆï¸
*   åŸå ¡ğŸ›
*   èµ°å»Š

[![](img/c1789255829bc9e2dd13f61d2f444abe.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ffLrOj1L--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/q2ebrtfi39mux0019ptf.jpeg)

## é¢†èˆª

é¡¾åæ€ä¹‰ï¼Œpilot æ˜¯å¸®åŠ©ç‰¹ä½¿ä»£ç†å¯¼èˆªè¯·æ±‚çš„ pilotã€‚

ä»–ä»¬å‘ç‰¹ä½¿ä»£ç†æä¾›ä»¥ä¸‹å†…å®¹:

*   æœåŠ¡å‘ç°
*   äº¤é€šç®¡ç†
*   è·³å›

æˆ‘ä»¬é€šè¿‡`yaml`æ–‡ä»¶å‘ Istio æä¾›è·¯ç”±è§„åˆ™ã€‚ä¸€æ—¦åº”ç”¨äº†è¯¥è§„åˆ™ã€‚pilot å°†è·å¾—è¿™ä¸ªè§„åˆ™ï¼Œç„¶ååœ¨è¿è¡Œæ—¶å°†å®ƒæä¾›ç»™ envoy ä»£ç†ã€‚è¿™ä¸ºæˆ‘ä»¬æä¾›äº†åŠ¨æ€åº”ç”¨é…ç½®æ›´æ”¹çš„çµæ´»æ€§ã€‚

é€šè¿‡ pilotï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è·¯ç”±è§„åˆ™æä¾›æœåŠ¡å‘ç°é€‰é¡¹ã€‚æˆ‘ä»¬å¯ä»¥è¯´ï¼Œå¦‚æœ URI æ˜¯`/review`å°±è½¬åˆ°åœ¨ç«¯å£`9080`ä¸Šè¿è¡Œçš„`reviews`åº”ç”¨ç¨‹åºï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews
 http:
  - match:
    - uri:
        exact: /review
    route:
    - destination:
        host: reviews
        port:
          number: 9080 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç‚¹å‡»æŸ¥çœ‹æ›´å¤šå…³äº VirtualService [çš„ä¿¡æ¯ã€‚](https://istio.io/docs/reference/config/networking/v1alpha3/virtual-service/)

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ pilot ç®¡ç†æœåŠ¡çš„æµé‡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°† 90%çš„è¯·æ±‚å‘é€ç»™åº”ç”¨ç¨‹åºçš„`v1`ï¼Œè€Œå°†å‰©ä½™çš„`10%`å‘é€ç»™ä»¤äººæ•¬ç•çš„`v2`ï¼Œå¦‚ä¸‹:

```
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews
spec:
  hosts:
    - reviews
  http:
  - route:
    - destination:
        host: reviews
        subset: v1
      weight: 90
    - destination:
        host: reviews
        subset: v2
      weight: 10 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šç›®çš„åœ°çš„è§„åˆ™ã€‚

*   ä½¿ç”¨ä»€ä¹ˆç±»å‹çš„è´Ÿè½½å¹³è¡¡å™¨
*   æœ€å¤§è¿æ¥æ•°
*   è¶…æ—¶å’Œå…¶ä»–è§„åˆ™å¦‚ä¸‹ã€‚

```
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: destall
  namespace: testns
spec:
  # DNS name, prefix wildcard, short name relative to context
  # IP or CIDR only for services in gateways
  host: destall.default.svc.cluster.local
  trafficPolicy:
    loadBalancer:
      simple: ROUND_ROBIN
    connectionPool:
      tcp:
        maxConnections: 99
        connectTimeout: 6s 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æŸ¥çœ‹æ›´å¤šå…³äº [DestinationRule](https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/) çš„ä¿¡æ¯ã€‚

å„ç§è´Ÿè½½å¹³è¡¡å™¨é€‰é¡¹[æ­¤å¤„](https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/#LoadBalancerSettings-SimpleLB)

*æ³¨æ„:å¯èƒ½æœ‰æ•°ç™¾ç§ä¸åŒçš„é…ç½®ã€‚åœ¨ä¸€ç¯‡åšæ–‡ä¸­è§£é‡Šå®ƒæ˜¯éå¸¸ä¸å¯èƒ½çš„ã€‚*

> ## TLï¼› DR Pilot provides configuration data for special envoy agents.

## å¨æˆ¿

æˆ‘ä»¬æä¾›ç»™ Istio çš„æ‰€æœ‰é…ç½®éƒ½å¿…é¡»ç»è¿‡é€‚å½“çš„éªŒè¯ã€‚åº”è¯¥æ¥æ”¶å’Œå¤„ç†ç»è¿‡éªŒè¯çš„è§„åˆ™æˆ–é…ç½®ã€‚æœ€åï¼Œå¤„ç†åçš„æ•°æ®åº”å‘é€åˆ°è¯•ç‚¹å’Œæ··é¢‘å™¨ã€‚

å¨æˆ¿è´Ÿè´£éªŒè¯ã€æ¥æ”¶ã€å¤„ç†å’Œå‘é€é…ç½®ç»™é£è¡Œå‘˜å’Œæ··éŸ³å™¨ã€‚

Istio è¿è¡Œåœ¨ Kubernetes ä¹‹ä¸Šã€‚Galley è¿˜è´Ÿè´£ä» Kubernetes è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶å°†å…¶æä¾›ç»™ Istio ç»„ä»¶ã€‚

> TLï¼›DR Galley æ˜¯éªŒè¯å’Œåˆ†å‘ä»£ç†ï¼Œç”¨äºéªŒè¯å’Œåˆ†å‘é…ç½®æ•°æ®ç»™ Pilot å’Œ Mixerã€‚

* * *

## å ¡å’

Citadel è´Ÿè´£åŠ å¯†æœåŠ¡å¯¹æœåŠ¡çš„é€šä¿¡å’Œæœ€ç»ˆç”¨æˆ·è®¤è¯ã€‚ä½¿ç”¨ Citadelï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ç‰¹ä½¿ä»£ç†å®æ–½å®‰å…¨ç­–ç•¥ã€‚

> TLï¼›Citadel åšå£«æ˜¯ä»£ç†çš„ç­–ç•¥æä¾›è€…ã€‚

ç„¶åï¼Œä»£ç†ä½¿ç”¨æ¥è‡ª Citadel å’Œ Pilot çš„ä¿¡æ¯æ¥æ§åˆ¶ã€è¿æ¥(é™åˆ¶å’Œè·¯ç”±æµé‡)å’Œä¿æŠ¤æœåŠ¡ã€‚

* * *

å¸Œæœ›è¿™èƒ½è®©ä½ å¯¹`Istio`æœ‰ä¸€ä¸ªç®€è¦çš„äº†è§£ã€‚ç‚¹å‡» [istio.io](https://istio.io) äº†è§£æ›´å¤šå…³äº istio çš„ä¿¡æ¯ã€‚

ç°åœ¨ï¼Œæ‚¨å¸Œæœ›åœ¨ Kubernetes ä¸Šéƒ¨ç½²ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œå¹¶ä½¿ç”¨ Istio æ¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ã€‚

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç•™ä¸‹èµæˆ–è¯„è®ºã€‚â¤ï¸

å¦‚æœæ‚¨è§‰å¾—æ–‡ç« ä¸­æœ‰é”™è¯¯/é—æ¼ä¹‹å¤„ï¼Œè¯·éšæ—¶è¯„è®º:)

ä½ å¯ä»¥åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘ã€‚