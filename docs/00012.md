# NGRX çŠ¶æ€ç®¡ç†-ç®€ä»‹

> åŸæ–‡:[https://dev . to/GC _ PSK/state-management-with-ngrx-introduction-1g2m](https://dev.to/gc_psk/state-management-with-ngrx-introduction-1g2m)

## NGRX çŠ¶æ€ç®¡ç†â€”ç®€ä»‹

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³å‘æ‚¨ä»‹ç»æ„æˆ NGRX å¹³å°çš„æ¦‚å¿µåŠå…¶æ‰€æœ‰éƒ¨åˆ†ï¼Œä»¥å……åˆ†ç†è§£å®ƒå¦‚ä½•å¸®åŠ©æˆ‘ä»¬åˆ›å»ºæ›´å¥½çš„åº”ç”¨ç¨‹åºã€‚

*NGRX* ï¼Œå¯¹äºè¿˜ä¸çŸ¥é“çš„äººæ¥è¯´ï¼Œæ˜¯ *Angular* çš„ *Redux* åº“ã€‚å®ƒå¸®åŠ©æˆ‘ä»¬è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œè¿™å¯ä»¥è¯´æ˜¯ç°ä»£å¤§è§„æ¨¡å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­æœ€éš¾ç®¡ç†çš„éƒ¨åˆ†ã€‚

ç›¸æ¯”äº *Redux* åªæä¾›å•†åº—çš„å›¾å±‚ï¼Œ *NGRX* è‡ªå¸¦äº†ä¸å°‘å¼ºå¤§çš„åŠŸèƒ½ã€‚

æ³¨æ„:æœ¬æ–‡ä¸­çš„ä»£ç ç‰‡æ®µæ²¡æœ‰éšç€ NGRX 8 çš„æœ€æ–°å˜åŒ–è€Œæ›´æ–°ã€‚

* * *

è¿™æ˜¯ 4 ç¯‡æ–‡ç« ç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå°†æ¶µç›–:

*   NGRX çš„æ”¯æŸ±
*   å¦‚ä½•ä½¿ç”¨å‡é€Ÿå™¨å’Œå®ä½“æ¥æ„å»ºæˆ‘ä»¬çš„å•†åº—
*   ç®¡ç†å’Œæµ‹è¯•å‰¯ä½œç”¨
*   å°†æˆ‘ä»¬çš„ç”¨æˆ·ç•Œé¢è¿æ¥åˆ°é—¨é¢æœåŠ¡ï¼Œæœ‰åˆ©å¼Š

## [](#why-ngrx-or-any-state-management-solution)ä¸ºä»€ä¹ˆé€‰æ‹© NGRX æˆ–ä»»ä½•çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆ

NGRX å’Œ Angular çš„å…¶ä»–çŠ¶æ€ç®¡ç†åº“(NGXSï¼ŒAkita)å·²ç»æˆä¸ºå¤æ‚ web åº”ç”¨ç¨‹åºæ¶æ„ä¸­çš„é‡è¦éƒ¨åˆ†ã€‚

æˆ‘çš„ä¸€ä¸ªä¸å—æ¬¢è¿çš„è§‚ç‚¹æ˜¯ï¼Œæ¯ä¸ª Angular åº”ç”¨ç¨‹åºéƒ½åº”è¯¥ä½¿ç”¨æŸç§çŠ¶æ€ç®¡ç†ï¼Œæ— è®ºæ˜¯ RX é©±åŠ¨çš„æœåŠ¡ã€MobX è¿˜æ˜¯ä¸åŒçš„ Redux å®ç°ã€‚

æˆ‘å‘ç°å¤§å‹(ç”šè‡³å°å‹)é¡¹ç›®åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æœ¬åœ°çŠ¶æ€æœ‰å‡ ä¸ªç¼ºé™·ï¼Œä¾‹å¦‚:

*   åœ¨è·¯ç”±ä¹‹é—´ä¼ é€’æ•°æ®æœ‰å›°éš¾
*   ç¼“å­˜å·²æå–çš„æ•°æ®æœ‰å›°éš¾
*   é‡å¤çš„é€»è¾‘å’Œè¯·æ±‚
*   æ²¡æœ‰æƒ¯ä¾‹

è¿™ä¸ªåˆ—è¡¨å¯èƒ½ä¼šæ›´é•¿ï¼Œä½†è¿™è¶³ä»¥è®©æˆ‘ç›¸ä¿¡æŸç§çŠ¶æ€ç®¡ç†å¯¹äºä¸åœ¨çŸ­æ—¶é—´å†…é‡æ„æ–°åº”ç”¨ç¨‹åºæ˜¯å¿…ä¸å¯å°‘çš„ã€‚

## [](#ngrx-pillars)NGRX æŸ±å­

è®©æˆ‘ä»¬çœ‹çœ‹å›´ç»• *NGRX* çš„å¹³å°æ˜¯å¦‚ä½•æ„å»ºçš„:

*   `store` â€”è¿™æ˜¯ä¸€ä¸ªä¸­å¤®å­˜å‚¨åº“ï¼Œä»ä¸­æˆ‘ä»¬å¯ä»¥*é€‰æ‹©*è§’åº¦ DI ä¸­æ¯ä¸ªç»„ä»¶å’ŒæœåŠ¡çš„çŠ¶æ€
*   `effects`â€”â€”é¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯å½“ä¸€ä¸ªåŠ¨ä½œè¢«è°ƒåº¦æ—¶å‘ç”Ÿçš„å‰¯ä½œç”¨
*   ä¸€ä¸ªå¸®åŠ©å‡å°‘å¸¸è§æ ·æ¿æ–‡ä»¶çš„å®ä½“æ¡†æ¶

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°çœ‹çœ‹æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­æ¢ç´¢çš„æ‰€æœ‰æ¦‚å¿µã€‚

## [](#store)å•†åº—

å•†åº—æ˜¯æˆ‘ä»¬å­˜å‚¨æ•°æ®çš„ä¸­å¤®å­˜å‚¨åº“ã€‚

è¿™æ˜¯æˆ‘ä»¬çš„åº”ç”¨æ•°æ®åº“ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å®¢æˆ·çš„å”¯ä¸€çœŸå®æ¥æºã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæˆ‘ä»¬ç”¨æ¥é€‰æ‹©å’Œå­˜å‚¨æ•°æ®çš„åµŒå¥—å¯¹è±¡ã€‚

ç”±äºå¯ä»¥é€šè¿‡ Angular DI è®¿é—® *Store* æœåŠ¡ï¼Œå› æ­¤æˆ‘ä»¬åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç»„ä»¶å’ŒæœåŠ¡éƒ½å¯ä»¥è®¿é—®æˆ‘ä»¬å•†åº—ä¸­çš„æ•°æ®ã€‚

å…³äºçŠ¶æ€çš„ä»»ä½•ä¿¡æ¯ï¼Œé™¤éè¢«éš”ç¦»åˆ°åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå•ç‹¬éƒ¨åˆ†(ä¾‹å¦‚è¡¨å•ã€å¼¹å‡ºçª—å£ã€ç¬æ—¶çŠ¶æ€)ï¼Œå¯èƒ½åº”è¯¥å­˜å‚¨åœ¨å­˜å‚¨ä¸­ã€‚

## [](#actions)åŠ¨ä½œ

åœ¨ NGRX-speak ä¸­â€”â€”actions æ˜¯ä¿å­˜ä¼ é€’ç»™ reducers æˆ–è§¦å‘å‰¯ä½œç”¨çš„ä¿¡æ¯çš„ç±»ã€‚

åŠ¨ä½œæœ‰ä¸¤ä¸ªå‚æ•°:

*   æˆ‘ä»¬å‘½åä¸º`type`çš„å”¯ä¸€æ ‡è¯†ç¬¦(ç¡®ä¿æ‚¨å°†å…¶æ ‡è®°ä¸º`readonly`)
*   å¯é€‰çš„`payload`å±æ€§ï¼Œè¡¨ç¤ºä¼ é€’ç»™åŠ¨ä½œçš„æ•°æ®

```
export enum LoginActionTypes {  
    LoginButtonClicked = '[Login Button] LOGIN_BUTTON_CLICKED',  
    LoginRequestStarted = '[Login API] LOGIN_REQUEST_STARTED'  
}

export class LoginButtonClicked {  
   public readonly type = LoginActionTypes.LoginButtonClicked;

   constructor(public payload: LoginRequestPayload) {}  
}

export class LoginRequestStarted {  
   public readonly type = LoginActionTypes.LoginRequestStarted;

   constructor(public payload: LoginRequestPayload) {}  
}

export type UserActions = LoginButtonClicked | LoginRequestStarted; 
```

å‘½å`type`å‚æ•°çš„æƒ¯ä¾‹:

*   ä½ é€šå¸¸ä¼šçœ‹åˆ°ä½¿ç”¨æ ¼å¼`[prefix] NAME`ç¼–å†™çš„ç±»å‹
*   æ­£å¦‚ NGRX å°ç»„æ‰€å»ºè®®çš„ï¼Œè¿™ä¸ªå‰ç¼€å¯¹äºå£°æ˜è¯·æ±‚çš„æ¥æºå¾ˆæœ‰ç”¨

ğŸ’¡ä¸“ä¸šæç¤º:å†™ä¸‹è®¸å¤šå…·ä½“çš„è¡ŒåŠ¨ï¼Œå¹¶ä¸”æ€»æ˜¯å†™ä¸‹å®ƒä»¬çš„èµ·æºã€‚å¦‚æœä½ é‡å†™ä¸€äº›åŠ¨ä½œæ¥åšåŒæ ·çš„äº‹æƒ…ï¼Œè¿™å¹¶ä¸é‡è¦ã€‚

## [](#reducers)å‡é€Ÿå™¨

Reducers åªæ˜¯è´Ÿè´£ä»¥ä¸å¯å˜çš„æ–¹å¼æ›´æ–°çŠ¶æ€å¯¹è±¡çš„çº¯å‡½æ•°ã€‚

reducer æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°:å½“å‰çŠ¶æ€å¯¹è±¡å’Œä¸€ä¸ªåŠ¨ä½œç±»ï¼Œå¹¶å°†æ–°çŠ¶æ€ä½œä¸ºè¾“å‡ºè¿”å›ã€‚

æ–°çš„çŠ¶æ€**æ€»æ˜¯ä¸€ä¸ªæ–°æ„å»ºçš„å¯¹è±¡**ï¼Œå¹¶ä¸”**æˆ‘ä»¬ä»ä¸æ”¹å˜çŠ¶æ€**ã€‚

```
export function loginReducer(  
    state: UserState = {},  
    action: UserActions  
): UserState {  
    switch (action.type) {  
        case UserActionTypes.LoginSuccess:  
            return action.payload;  
        default:  
            return state;  
} 
```

è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ç¼©å‡å™¨ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„åŠ¨ä½œï¼Œå®ƒå°±è¿”å›å½“å‰çŠ¶æ€ï¼Œæˆ–è€…è¿”å›åŠ¨ä½œçš„æœ‰æ•ˆè´Ÿè½½ä½œä¸ºä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ‚¨çš„å‡é€Ÿå™¨æœ€ç»ˆä¼šæ¯”ç¤ºä¾‹å¤§å¾—å¤šã€‚

æœ‰å¾ˆå¤šåº“å¯ä»¥ç®€åŒ– reducers çš„ä½¿ç”¨ï¼Œä½†å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒä»¬å¾ˆå°‘å€¼å¾—ä½¿ç”¨ã€‚

å¯¹äºæ›´å¤æ‚çš„å‡é€Ÿå™¨ï¼Œæˆ‘å»ºè®®åˆ›å»ºå‡½æ•°ï¼Œ**ä¿æŒå‡é€Ÿå™¨å‡½æ•°ç®€å•è€Œå°å·§**ã€‚

äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•åœ°ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ¥é‡æ„ switch è¯­å¥ï¼Œå¹¶å°†åŠ¨ä½œç±»å‹ä¸å¯¹è±¡çš„é”®ç›¸åŒ¹é…ã€‚

è®©æˆ‘ä»¬é‡å†™ä¸€ä¸‹:

```
interface LoginReducerActions {   
    [key: UserActionTypes]: (  
        state: UserState,   
        action: UserActions  
    ): UserState;  
};

const loginReducerActions: LoginReducerActions = {   
    [UserActionTypes.LoginSuccess]: (  
       state: UserState,   
       action: LoginSuccess  
    ) => action.payload  
};

export function loginReducer(  
    state: UserState = {},  
    action: UserActions  
): UserState {  
    if (loginReducerActions.hasOwnProperty(action.type)) {  
       return loginReducerActions[action.type](state, action);  
    }

    return state;  
} 
```

## [](#selectors)é€‰æ‹©å™¨

é€‰æ‹©å™¨åªæ˜¯æˆ‘ä»¬å®šä¹‰çš„ä»å•†åº—å¯¹è±¡ä¸­é€‰æ‹©ä¿¡æ¯çš„å‡½æ•°ã€‚

åœ¨æˆ‘ä»¬ä»‹ç»é€‰æ‹©å™¨ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬é€šå¸¸å¦‚ä½•åœ¨æœåŠ¡ä¸­ä»å­˜å‚¨ä¸­é€‰æ‹©æ•°æ®:

```
interface DashboardState {  
   widgets: Widget[];  
}

export class DashboardRepository {  
    widgets$ = this.store.select((state: DashboardState) => {  
        return state.widgets;  
    });

    constructor(private store: Store<DashboardState>) {}  
} 
```

ä¸ºä»€ä¹ˆè¿™ç§æ–¹æ³•ä¸ç†æƒ³ï¼Ÿ

*   å®ƒæ²¡å¹²
*   å¦‚æœå•†åº—çš„ç»“æ„ä¼šæ”¹å˜(ç›¸ä¿¡æˆ‘ï¼Œå®ƒä¼š)ï¼Œæˆ‘ä»¬éœ€è¦æ”¹å˜æ‰€æœ‰åœ°æ–¹çš„é€‰æ‹©
*   æœåŠ¡æœ¬èº«çŸ¥é“å•†åº—çš„ç»“æ„
*   ä¸ç¼“å­˜

è®©æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹ç”±`@ngrx/store`æä¾›çš„åä¸º`createSelector`çš„å®ç”¨ç¨‹åºï¼Œå®ƒçš„çµæ„Ÿæ¥è‡ªäº React åº“`reselect`ã€‚

ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘å°†ä¿æŒä»£ç ç‰‡æ®µçš„ç»Ÿä¸€ï¼Œä½†æ˜¯æ‚¨åº”è¯¥å‡è®¾é€‰æ‹©å™¨æ˜¯åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­åˆ›å»ºçš„ï¼Œå¹¶ä¸”å®ƒä»¬è¢«å¯¼å‡ºã€‚

```
// selectors 
import { createSelector, createFeatureSelector } from '@ngrx/store';

const selectDashboardState = createFeatureSelector('dashboard');

export const selectAllWidgets = createSelector(  
    selectDashboardState,   
    (state: DashboardState) => state.widgets  
);

// service 
export class DashboardRepository {  
    widgets$ = this.store.select(selectAllWidgets);

    constructor(private store: Store<DashboardState>) {}  
} 
```

ğŸ’¡ä¸“ä¸šæç¤º:é€‰æ‹©å™¨éå¸¸æœ‰ç”¨ï¼Œæ€»æ˜¯ç¼–å†™ç²’åº¦é€‰æ‹©å™¨ï¼Œå¹¶å°è¯•å°†é€»è¾‘å°è£…åœ¨é€‰æ‹©å™¨ä¸­ï¼Œè€Œä¸æ˜¯åœ¨æ‚¨çš„æœåŠ¡æˆ–ç»„ä»¶ä¸­

## [](#entities)å®ä½“

å®ä½“ç”±åŒ…`@ngrx/entity`æ·»åŠ ã€‚

å¦‚æœæ‚¨æ›¾ç»ä½¿ç”¨è¿‡ Reduxï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°ï¼Œå¸¸è§ CRUD æ“ä½œçš„æ ·æ¿æ–‡ä»¶éå¸¸è€—æ—¶è€Œä¸”å¤šä½™ã€‚

NGRX å®ä½“é€šè¿‡æä¾›ä¸€ç»„ç°æˆçš„é€šç”¨æ“ä½œå’Œé€‰æ‹©å™¨æ¥å¸®åŠ©æˆ‘ä»¬ï¼Œè¿™äº›æ“ä½œå’Œé€‰æ‹©å™¨æœ‰åŠ©äºå‡å°æˆ‘ä»¬çš„ reducer çš„å¤§å°ã€‚

ç”¨è¿™ä¸ªå®ä½“æ¡†æ¶æˆ‘ä»¬çš„çŠ¶æ€æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ

```
interface EntityState<V> {    
  ids: string[] | number[];     
  entities: {   
      [id: string | id: number]: V   
  };
} 
```

æˆ‘é€šå¸¸å…ˆåœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»ä¸åŒçš„æ–‡ä»¶ä¸­å¯¼å…¥å®ƒï¼Œæ¯”å¦‚ reducer å’Œé€‰æ‹©å™¨çš„æ–‡ä»¶ã€‚

[![](img/e11b7812ff896fa00a04ca5b1fc97d66.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--KAfEVo7l--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1600/1%2Av9EpQXnp-aNUhDNb1oVMSQ.png)

export const adapter:entity adapter = createEntityAdapter()ï¼›

è®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„å‡é€Ÿå™¨ä¸­ä½¿ç”¨é€‚é…å™¨ã€‚é€‚é…å™¨å¦‚ä½•ä¸ä¹‹äº¤äº’ï¼Ÿ

*   å®ƒåˆ›å»ºä¸€ä¸ªåˆå§‹çŠ¶æ€(è§ä¸Šé¢çš„ç•Œé¢`EntityState`)
*   å®ƒç»™äº†æˆ‘ä»¬ä¸€ç³»åˆ—çš„ *CRUD* æ“ä½œæ–¹æ³•æ¥åŠ¨æ€åœ°ç¼–å†™ reducers

```
const initialState: DashboardState = adapter.getInitialState();

export const dashboardReducer(  
    state = initialState,  
    action: DashboardActions  
): DashboardState {  
   switch (action.type) {  
       case DashbordActionTypes.AddWidget:  
          const widget: Widget = action.payload;    
          return adapter.addOne(action.payload, state);  
   }

   // more ... 
   }
} 
```

ğŸ’¡ **Pro æç¤º** : [çœ‹çœ‹ NGRX å®ä½“ä¸­æ‰€æœ‰å¯ç”¨çš„æ–¹æ³•](https://medium.com/r/?url=https%3A%2F%2Fngrx.io%2Fguide%2Fentity%2Fadapter%23adapter-collection-methods)

å®ä½“é€‚é…å™¨è¿˜å…è®¸æˆ‘ä»¬å¯åŠ¨ä¸€ç»„é€‰æ‹©å™¨æ¥æŸ¥è¯¢å•†åº—ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªåœ¨æˆ‘ä»¬çš„ä»ªè¡¨æ¿çŠ¶æ€ä¸‹é€‰æ‹©æ‰€æœ‰å°éƒ¨ä»¶çš„ä¾‹å­:

```
const { selectAll } = adapter.getSelectors();

export const selectDashboardState = createFeatureSelector<DashboardState>('dashboard');

export const selectAllWidgets = createSelector(  
  selectDashboardState,  
  selectAll  
); 
```

ğŸ’¡ **Pro æç¤º** : [çœ‹çœ‹ NGRX å®ä½“ä¸­æ‰€æœ‰å¯ç”¨çš„é€‰æ‹©å™¨](https://medium.com/r/?url=https%3A%2F%2Fngrx.io%2Fguide%2Fentity%2Fadapter%23entity-selectors)

## [](#effects)æ•ˆæœ

æœ€åï¼ŒNGRX ä¸­æˆ‘æœ€å–œæ¬¢çš„ç¬¬ä¸€ä¸ªç‰¹æ€§:*æ•ˆæœ*ã€‚

é¡¾åæ€ä¹‰ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•ˆæœæ¥ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å‰¯ä½œç”¨ã€‚NGRX å°†æ•ˆæœå®ç°ä¸ºåŠ¨ä½œå‘å‡ºçš„æµï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¿”å›æ–°çš„åŠ¨ä½œã€‚

è®©æˆ‘ä»¬è€ƒè™‘ä¸‹å›¾:

[![](img/86a20b745f796da21eecd7a1cf2a26d0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jZFQF2i---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1600/1%2AzucA-8bRWyhrhxkdMBOpLA.png)

*   ä¸€ä¸ªåŠ¨ä½œä»åº”ç”¨ç¨‹åºä¸­çš„æŸä¸ªåœ°æ–¹è¢«åˆ†æ´¾(ä¾‹å¦‚:UIã€WebSocketã€å®šæ—¶å™¨ç­‰ç­‰)ã€‚)
*   æ•ˆæœæ‹¦æˆªåŠ¨ä½œï¼Œä¸ºæ­¤å®šä¹‰äº†å‰¯ä½œç”¨ã€‚å‰¯ä½œç”¨è¢«æ‰§è¡Œ
*   å‰¯ä½œç”¨ï¼Œé™¤äº†ä¾‹å¤–ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„åŠ¨ä½œ
*   è¯¥åŠ¨ä½œé€šè¿‡ä¸€ä¸ªç¼©å‡å™¨å¹¶æ›´æ–°å­˜å‚¨

æ­£å¦‚æˆ‘æåˆ°çš„ï¼Œä¸æ˜¯æ‰€æœ‰çš„å‰¯ä½œç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„åŠ¨ä½œã€‚å¦‚æœä¸éœ€è¦çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®ä¸€ä¸ªä¸è°ƒåº¦ä»»ä½•åŠ¨ä½œçš„æ•ˆæœï¼Œä½†æ˜¯é‡è¦çš„æ˜¯ä½ è¦æ˜ç™½ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç¡®å®æƒ³è¦è°ƒåº¦æ–°çš„åŠ¨ä½œã€‚

åœ¨ *NGRX* ä¸­ï¼Œæ•ˆæœæœ€å®é™…çš„ç”¨ä¾‹æ˜¯å‘å‡º *HTTP* è¯·æ±‚:

```
export class WidgetsEffects {  
    constructor(  
        private actions$: Actions,  
        private api: WidgetApiService  
    ) {}

    @Effect()  
    createWidget$: Observable<AddWidgetAction> =   
        this.actions$.pipe(  
            ofType(WidgetsActionTypes.CreateWidgetRequestStarted),  
            mergeMap((action: CreateWidgetAction) => {  
                return this.api.createWidget(action.payload);   
            }),  
            map((widget: Widget) => new AddWidgetAction(widget))  
         );

    @Effect({ dispatch: false })  
    exportWidgets$: Observable<void> =   
        this.actions$.pipe(  
            ofType(WidgetsActionTypes.ExportWidgets),  
            tap((action: ExportWidgets) => {  
                return this.api.exportWidgets();   
            }),  
         );  
} 
```

è®©æˆ‘ä»¬æŠŠä¸Šé¢çš„ç‰‡æ®µåˆ†è§£ä¸€ä¸‹ã€‚

*   æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`WidgetsEffects`çš„ç±»
*   æˆ‘ä»¬å¯¼å…¥ä¸¤ä¸ªæä¾›è€…:`Actions`å’Œ`WidgetsApiService`
*   `Actions`æ˜¯ä¸€è¿ä¸²çš„åŠ¨ä½œã€‚æˆ‘ä»¬ä½¿ç”¨æ“ä½œç¬¦`ofType`æ¥å¸®åŠ©æˆ‘ä»¬è¿‡æ»¤åŠ¨ä½œï¼Œåªè¿‡æ»¤æˆ‘ä»¬æƒ³å¬çš„åŠ¨ä½œ
*   æˆ‘ä»¬åœ¨ç±»ä¸Šåˆ›å»ºä¸€ä¸ªå±æ€§å¹¶ç”¨`Effect`æ¥ä¿®é¥°å®ƒ
*   å½“ä¸€ä¸ªåä¸º`CREATE_WIDGET_REQUEST`çš„åŠ¨ä½œè¢«è°ƒåº¦æ—¶ï¼Œè¿™ä¸ªæ•ˆæœè¢«è°ƒç”¨
*   æˆ‘ä»¬ä»åŠ¨ä½œä¸­è·å–æœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬çš„ API æœåŠ¡æ‰§è¡Œè°ƒç”¨
*   ä¸€æ—¦æˆåŠŸæ‰§è¡Œï¼Œæˆ‘ä»¬å°†å®ƒæ˜ å°„ä¸ºåŠ¨ä½œ`AddWidgetAction`,è¯¥åŠ¨ä½œå¯ä»¥è¢« reducer è·å–å¹¶æ›´æ–°æˆ‘ä»¬çš„å­˜å‚¨
*   åœ¨åä¸º`exportWidgets$`çš„ç¬¬äºŒä¸ªæ•ˆæœä¸­ï¼Œæˆ‘ä»¬æ”¶åˆ°ä¸€ä¸ªåŠ¨ä½œ`ExportWidgets`ï¼Œæˆ‘ä»¬ä½¿ç”¨`tap`æ“ä½œç¬¦æ¥æ‰§è¡Œä¸€ä¸ªå‰¯ä½œç”¨ï¼Œç„¶åâ€¦â€¦å—¯ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼å½“æˆ‘ä»¬é€šè¿‡é…ç½®`{ dispatch: false }`æ—¶ï¼Œæˆ‘ä»¬ä¸å¿…è¿”å›ä»»ä½•åŠ¨ä½œ

## [](#takeaways)å¤–å–

*   çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæ— è®ºæ˜¯åº“è¿˜æ˜¯æ‚¨è‡ªå·±çš„å®ç°ï¼Œéƒ½åº”è¯¥ä¼˜å…ˆäºæœ¬åœ°çŠ¶æ€
*   åƒå•†åº—è¿™æ ·çš„å•ä¸€äº‹å®æ¥æºå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼Œæ¯”å¦‚çŠ¶æ€æ˜¯æš‚æ—¶çš„
*   æˆ‘ä»¬ç®€è¦åœ°æ¢è®¨äº†å­˜å‚¨ã€åŠ¨ä½œã€å‡å°‘å™¨ã€å®ä½“ã€é€‰æ‹©å™¨å’Œæ•ˆæœçš„æ¦‚å¿µï¼Œä½†æ˜¯åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€äº›æ›´é«˜çº§çš„ä¾‹å­æ¥è¯¦ç»†ä»‹ç»æ¯ä¸€ä¸ªæ¦‚å¿µ

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å»åº”ç”¨ç¨‹åºçš„å•†åº—å’Œå›½å®¶çš„å®ä½“ã€‚

* * *

å¦‚æœæ‚¨éœ€è¦ä»»ä½•æ¾„æ¸…ï¼Œæˆ–è€…å¦‚æœæ‚¨è®¤ä¸ºæœ‰äº›äº‹æƒ…ä¸æ¸…æ¥šæˆ–é”™è¯¯ï¼Œè¯·ç•™ä¸‹è¯„è®ºï¼

æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼å¦‚æœä½ æœ‰ï¼Œè¯·å…³æ³¨æˆ‘çš„ [*Medium](https://medium.com/@.gc) * *æˆ–* [*Twitter](https://twitter.com/home) ï¼Œè·å–æ›´å¤šå…³äºå‰ç«¯ã€Angularã€RxJSã€Typescript ç­‰çš„[æ–‡ç« ](https://frontend.consulting/)ï¼*