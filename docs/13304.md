# ä¸ºä»€ä¹ˆæˆ‘ä¸º Web ç»„ä»¶ç¼–å†™äº†ä¸€ä¸ªå¾®åº“

> åŸæ–‡ï¼š<https://dev.to/steveblue/why-i-coded-a-micro-library-for-web-components-46ig>

æˆ‘çŸ¥é“ä¼¼ä¹æ¯ä¸ªäººéƒ½åœ¨å»ºé€ å¾®å‹çš„è¿™ä¸ªï¼Œå¾®å‹çš„é‚£ä¸ªã€‚

å¾®æœåŠ¡ã€å¾®å‰ç«¯å’Œç°åœ¨çš„å¾®åº“ï¼Ÿï¼

å·²ç»æœ‰äº†å¼€å‘ Web ç»„ä»¶çš„ä¼˜ç§€è§£å†³æ–¹æ¡ˆã€‚

*   [æ¨¡æ¿](https://stenciljs.com/docs/introduction)
*   [å‘å…‰å…ƒä»¶](https://github.com/Polymer/lit-element)
*   [æ··è¡€å„¿](https://hybrids.js.org)
*   [slim.js](http://slimjs.com/#/getting-started)
*   [SkateJS](http://skatejs.netlify.com)

ä¸€äº›ä¸»è¦çš„ JavaScript æ¡†æ¶ï¼Œå¦‚ Svelte å’Œ Angularï¼Œç”šè‡³å¯ä»¥ç¼–è¯‘æˆå®šåˆ¶å…ƒç´ ã€‚å°½ç®¡è€ƒè™‘åˆ°å°†ç°ä»£ JavaScript æ¡†æ¶ç¼–è¯‘æˆ Web ç»„ä»¶æ‰€éœ€è¦çš„å·¥å…·æ•°é‡ï¼Œè¿™å¯èƒ½æœ‰ç‚¹å¤§æå°ç”¨ã€‚

é‚£ä¹ˆæˆ‘ä¸ºä»€ä¹ˆè¦ç¼–å†™å¦ä¸€ä¸ªåº“å‘¢ï¼Ÿ

[![](img/09a61577215770e8836f437882b47332.png)](https://i.giphy.com/media/4oexCrqXVKAnu/giphy.gif)

# æŒ‘æˆ˜è‡ªæˆ‘

å»ºç«‹ä¸€ä¸ªç°ä»£çš„ï¼Œä½†æ˜¯æ²¡æœ‰ä¾èµ–æ€§çš„æ¡†æ¶ã€‚æˆ‘æƒ³è¦ä¸€ä¸ªåªä½¿ç”¨æµè§ˆå™¨ä¸­çš„ API çš„è§£å†³æ–¹æ¡ˆã€‚è¿™æ„å‘³ç€æŸäº›ç‰¹å¾éœ€è¦èšåˆå¡«å……ï¼Œä½†è¿™æ²¡å…³ç³»ã€‚åŸæ¥æµè§ˆå™¨ä¸­å­˜åœ¨å‡ ä¸ª APIï¼Œå…è®¸æ‚¨ä¸º UI æ„å»ºä¸€ä¸ªå¾®åº“ï¼Œæ”¯æŒæ•°æ®ç»‘å®šã€é«˜çº§äº‹ä»¶å¤„ç†ã€åŠ¨ç”»ç­‰ç­‰ï¼

*   å®¢æˆ·å…ƒç´ 
*   createTreeWalker
*   ä»£ç†äºº
*   å®¢æˆ·äº‹ä»¶
*   å¹¿æ’­é¢‘é“
*   ç½‘ç»œåŠ¨ç”»

# å¸¦èµ°ç—›è‹¦

å¼€å‘ Web ç»„ä»¶æ˜¯è¿™ä¸ªé¡¹ç›®çš„å¦ä¸€ä¸ªç›®æ ‡ã€‚ç¼–ç å®šåˆ¶å…ƒç´ æ¶‰åŠåˆ°è®¸å¤šæ ·æ¿æ–‡ä»¶ï¼Œå¯ä»¥å‡å°‘è¿™äº›æ–‡ä»¶ã€‚åœ¨å…è®¸`ShadowDOM`çš„å®šåˆ¶å…ƒç´ å’Œä¸å…è®¸`ShadowDOM`çš„å®šåˆ¶å…ƒç´ ä¹‹é—´åˆ‡æ¢å¯èƒ½å¾ˆå›°éš¾ã€‚è‡ªæ²»è‡ªå®šä¹‰å…ƒç´ ä¸è‡ªå®šä¹‰å†…ç½®å…ƒç´ çš„å¤„ç†æ–¹å¼ä¸åŒã€‚äº‹ä»¶å¤„ç†å’Œå…¸å‹çš„ DOM ä¸€æ ·å¥½ï¼Œéœ€è¦è°ƒç”¨`addEventListener`å’Œ`dispatchEvent`ï¼Œå³ä½¿è¿™æ ·ï¼Œä½ è¿˜æ˜¯ä¼šè¢«äº‹ä»¶é€šå¸¸æ˜¯å¦‚ä½•å†’æ³¡çš„æ‰€å›°æ‰°ã€‚è¿˜æœ‰æ›´æ–°å®šåˆ¶å…ƒç´ æ¨¡æ¿çš„é—®é¢˜ï¼Œéœ€è¦é€‰æ‹© DOM å¹¶æ›´æ–°å±æ€§å’Œå†…éƒ¨å†…å®¹ã€‚è¿™ä¸ºå·¥ç¨‹å¸ˆåšå‡ºä¸é‚£ä¹ˆé«˜æ€§èƒ½çš„é€‰æ‹©æä¾›äº†æœºä¼šã€‚å¦‚æœå›¾ä¹¦é¦†å¯ä»¥å¤„ç†æ‰€æœ‰è¿™äº›äº‹æƒ…ä¼šæ€ä¹ˆæ ·ï¼Ÿ

# å®Œå…¨æ§åˆ¶

æ˜¯æˆ‘æ‰€è¿½æ±‚çš„ã€‚å¦‚æœæˆ‘æƒ³æ”¹å˜å›¾ä¹¦é¦†çš„è¡Œä¸ºæ–¹å¼ï¼Œæˆ‘å¯ä»¥ã€‚Readymade å¯ä»¥æ„å»ºå®ƒæ¥æ”¯æŒ SVGï¼Œä½†æ˜¯å¦‚æœæˆ‘æƒ³æ”¯æŒçš„è¯ï¼Œå®ƒä¹Ÿå¯ä»¥å‘ˆç° GL å¯¹è±¡ã€‚æ‰€æœ‰éœ€è¦å‘ç”Ÿçš„æ˜¯äº¤æ¢çŠ¶æ€å¼•æ“å’Œ boomï¼ŒWebGL æ”¯æŒã€‚æˆ‘ä¸€ç›´åœ¨å°è¯•ä¸åŒçš„ç”¨æˆ·ç•Œé¢ï¼Œéœ€è¦ä¸€äº›æœ‰å»¶å±•æ€§çš„ä¸œè¥¿ã€‚

# åˆ†å¸ƒ

æ˜¯æˆ‘å·²ç»å·¥ä½œäº†å¾ˆé•¿æ—¶é—´çš„å¦ä¸€ä¸ªé¡¹ç›®çš„å…³é”®æ–¹é¢ã€‚æˆ‘æƒ³è¦ä¸€ç§æ–¹æ³•æ¥åˆ†å‘ UI ç»„ä»¶åº“ï¼Œè€Œä¸ä¾èµ–äºä»»ä½•æ¡†æ¶ã€‚è¯¥é¡¹ç›®çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªå°äº 20Kb çš„ UI åº“ã€‚ç°æˆçš„æœ¬èº«çº¦ 3Kbï¼Œæ‰€æœ‰çš„é“ƒé“›å’Œå“¨å­éƒ½æ˜¯è¿›å£çš„ã€‚å¦‚æœæ¡†æ¶æ”¯æŒå®šåˆ¶å…ƒç´ ï¼Œç”¨ç°æˆçš„ç»„ä»¶å¯ä»¥åƒç”¨ä»»ä½• JavaScript æ¡†æ¶æ„å»ºçš„é¡¹ç›®ä¸­çš„ä»»ä½•å…¶ä»– DOM å…ƒç´ ä¸€æ ·ä½¿ç”¨ã€‚

# è£…ä¿®å·¥

åœ¨ Angular ä¸­æˆ‘è®¤ä¸ºæ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œæˆ‘æƒ³çŸ¥é“è¿™äº›é«˜é˜¶å‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘æ„å»ºçš„å¾®åº“é«˜åº¦ä¾èµ–äºè¿™ä¸ªæœªæ¥çš„è§„èŒƒï¼Œä½†è¿™ä¹Ÿæ²¡å…³ç³»ã€‚ä½¿ç”¨ TypeScript ä»å¤´æ„å»ºåº“è¿˜æä¾›äº†ç±»å‹æ£€æŸ¥ã€æ™ºèƒ½æ„ŸçŸ¥çš„é¢å¤–å¥½å¤„ï¼Œå¹¶ä½¿æˆ‘èƒ½å¤Ÿä½¿ç”¨ä¼˜ç§€çš„ TypeScript ç¼–è¯‘å™¨ã€‚

[![](img/d1a61999cdcdf820db0d1173fb2a45f2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--KIzy7MSf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/yyavfza6i1tb8dxc4e46.png)

# è¿›å…¥ç°æˆ

Readymade æ˜¯ä¸€ä¸ªå¾®å‹åº“ï¼Œç”¨äºå¤„ç†å¼€å‘ Web ç»„ä»¶çš„å¸¸è§ä»»åŠ¡ã€‚API ç±»ä¼¼äº Angular æˆ– Stencilï¼Œä½†æ˜¯å†…éƒ¨æ˜¯ä¸åŒçš„ã€‚Readymade ä½¿ç”¨ä¸Šé¢åˆ—å‡ºçš„æµè§ˆå™¨ API ä¸ºæ‚¨æä¾›ä¸°å¯Œçš„å¼€å‘äººå‘˜ä½“éªŒã€‚

*   ğŸ°ä¸º CSS å’Œ HTML ShadowDOM æ¨¡æ¿å£°æ˜å…ƒæ•°æ®
*   â€œè‡ªä¸»å®šåˆ¶â€å’Œâ€œå®šåˆ¶å†…ç½®â€å…ƒç´ çš„â˜•ï¸å•ä¸€ç•Œé¢
*   ğŸ‹ã€ŠHello Worldã€‹çš„ï¸â€é‡çº¦ 1Kb
*   1ï¸âƒ£å•å‘æ•°æ®ç»‘å®š
*   ğŸ¤äº‹ä»¶å‘å°„å™¨æ¨¡å¼
*   ğŸŒ²æ‘‡æ ‘

# ä¸¾ä¸ªä¾‹å­

ä¸‹é¢è¿™ä¸ªæŒ‰é’®çš„ä¾‹å­å±•ç¤ºäº†ä¸€äº›ç°æˆçš„ä¼˜ç‚¹ã€‚

```
 import { ButtonComponent, Component, Emitter, Listen } from '@readymade/core';

@Component({
    template:`
    <span>{{buttonCopy}}</span>
    `,
    style:`
        :host {
            background: rgba(24, 24, 24, 1);
            cursor: pointer;
            color: white;
            font-weight: 400;
        }
    `,
})
class MyButtonComponent extends ButtonComponent {
    constructor() {
        super();
    }
    @State() 
    getState() {
      return {
        buttonCopy: 'Click'
      }
    } 
    @Emitter('bang')
    @Listen('click')
    public onClick(event) {
        this.emitter.broadcast('bang');
    }
    @Listen('keyup')
    public onKeyUp(event) {
        if (event.key === 'Enter') {
            this.emitter.broadcast('bang');
        }
    }
}

customElements.define('my-button', MyButtonComponent, { extends: 'button'}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `ButtonComponent`æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„ ES2015 ç±»ï¼Œå®ƒæ‰©å±•äº†`HTMLButtonElement`ï¼Œé“¾æ¥äº†ä¸€äº›æ”¯æŒ`Component`è£…é¥°å™¨ä¸­å®šä¹‰çš„`template`å’Œ`style`æ‰€éœ€çš„å‡½æ•°ï¼Œå¹¶è°ƒç”¨å…¶ä»–è£…é¥°å™¨æ·»åŠ åˆ°è¯¥ç±»åŸå‹ä¸­çš„ä»»ä½•æ–¹æ³•ã€‚è¿™é‡Œæœ‰è¶£çš„éƒ¨åˆ†æ˜¯`ButtonComponent`æ˜¯å¯ç»„åˆçš„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®šä¹‰ã€‚

```
export class ButtonComponent extends HTMLButtonElement {
  public emitter: EventDispatcher;
  public elementMeta: ElementMeta;
  constructor() {
    super();
    attachDOM(this);
    attachStyle(this);
    if (this.bindEmitters) { this.bindEmitters(); }
    if (this.bindListeners) { this.bindListeners(); }
    if (this.onInit) { this.onInit(); }
  }
  public onInit?(): void;
  public bindEmitters?(): void;
  public bindListeners?(): void; public bindState?(): void;
  public setState?(property: string, model: any): void;
  public onDestroy?(): void;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `State`å…è®¸ä½ å®šä¹‰ä¸€ä¸ªæŒ‰é’®å®ä¾‹çš„æœ¬åœ°çŠ¶æ€ï¼Œå¹¶ä¸”åœ¨çŠ¶æ€ä¸­å®šä¹‰çš„ä»»ä½•å±æ€§éƒ½å¯ä»¥ç»‘å®šåˆ°ä¸€ä¸ªæ¨¡æ¿ã€‚åœ¨å¼•æ“ç›–ä¸‹ï¼Œç°æˆäº§å“ä½¿ç”¨`document.createTreeWalker`å’Œ`Proxy`æ¥è§‚å¯Ÿå˜åŒ–ï¼Œå¹¶åˆ†åˆ«æ›´æ–°`attributes`å’Œ`textContent`ã€‚

*   `Emitter`å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥ä½¿ç”¨`BroadcastChannel API`çš„ EventEmitter æ¨¡å¼ï¼Œå› æ­¤äº‹ä»¶ä¸å†åªæ˜¯å†’æ³¡ï¼Œå®ƒä»¬ç”šè‡³å¯ä»¥è·¨æµè§ˆå™¨ä¸Šä¸‹æ–‡å‘å‡ºã€‚

*   `Listen`æ˜¯ä¸€ä¸ªä¸ºä½ è¿æ¥`addEventListener`çš„è£…é¥°è€…ï¼Œå› ä¸ºè°æƒ³ä¸€ç›´æ‰“å­—å‘¢ï¼Ÿ

# ç°æˆå“æ˜¯ v1

æ‰€ä»¥å» GitHub ä¸Šçœ‹çœ‹å§ã€‚æ–‡æ¡£é—¨æˆ·æ˜¯ç”¨ç°æˆçš„æ„å»ºçš„ï¼Œå¯ä»¥åœ¨ [Github é¡µé¢](https://readymade-ui.github.io/readymade/)ä¸Šè·å¾—ã€‚

[![](img/b0801a55b0206187f932e540383a59ce.png)](https://i.giphy.com/media/BaSHs78BU2ZYQ/giphy.gif)