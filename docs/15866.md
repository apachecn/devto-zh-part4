# å…³äºåŒæ­¥å’Œå¼‚æ­¥ä»£ç ï¼Œæ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥çŸ¥é“ä»€ä¹ˆ

> åŸæ–‡:[https://dev . to/amejiarosario/what-every-every-per-programmer-should-know-about-synchronous-asynchronous-code-1g 78](https://dev.to/amejiarosario/what-every-programmer-should-know-about-synchronous-vs-asynchronous-code-1g78)

åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæœ‰å¤šç§å¤„ç†å¹¶å‘æ€§çš„æ–¹æ³•ã€‚ä¸€äº›è¯­è¨€ä½¿ç”¨å„ç§çº¿ç¨‹ï¼Œè€Œå¦ä¸€äº›ä½¿ç”¨å¼‚æ­¥æ¨¡å‹ã€‚æˆ‘ä»¬å°†è¯¦ç»†æ¢è®¨åè€…ï¼Œå¹¶æä¾›ä¾‹å­æ¥åŒºåˆ†åŒæ­¥å’Œå¼‚æ­¥ã€‚Btwï¼Œä½ è§‰å¾—ä½ çš„ CPU å¤§éƒ¨åˆ†æ—¶é—´åœ¨åšä»€ä¹ˆï¼Ÿ

æœ‰ç”¨å—ï¼Ÿæ²¡æœ‰ã€‚å¾ˆé—²ï¼

è®¡ç®—æœºçš„å¤„ç†å™¨ç­‰å¾…ç½‘ç»œè¯·æ±‚å‘å‡ºã€‚å®ƒä¼šè®©ç¡¬ç›˜ç©ºé—²ï¼Œä»¥è¾“å‡ºè¯·æ±‚çš„æ•°æ®ï¼Œå¹¶æš‚åœä»¥å¤„ç†å¤–éƒ¨äº‹ä»¶(I/O)ã€‚

è¯·çœ‹ä¸‹å›¾ï¼Œäº†è§£è¯¥ç³»ç»Ÿäº‹ä»¶çš„å¹³å‡æ—¶é—´(ä»¥çº³ç§’ä¸ºå•ä½)

[![Latency Access Time by I/O](../Images/a40908a628f384bf1a19094757dbdc9b.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--vOJx-kG8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://adrianmejia.com/images/Latency-vs-System-Event.png)

æ­£å¦‚ä½ åœ¨ä¸Šé¢çš„å›¾è¡¨ä¸­æ‰€çœ‹åˆ°çš„ï¼Œä¸€ä¸ª CPU å¯ä»¥æ¯ä¸€çº³ç§’æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ã€‚).ç„¶è€Œï¼Œå¦‚æœä½ åœ¨çº½çº¦ï¼Œä½ å‘æ—§é‡‘å±±çš„ä¸€ä¸ªç½‘ç«™å‘å‡ºè¯·æ±‚ï¼ŒCPU å°†ä¼šâ€œæµªè´¹â€1.57 äº¿ä¸ªå‘¨æœŸç­‰å¾…å®ƒçš„å›å¤ï¼

ä½†ä¸æ˜¯ä¸€åˆ‡éƒ½æ²¡äº†ï¼å¦‚æœæ‚¨åœ¨ç¨‹åºä¸­ä½¿ç”¨éé˜»å¡(å¼‚æ­¥)ä»£ç ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨è¿™æ®µæ—¶é—´æ¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼è¿™æ­£æ˜¯ä½ åœ¨è¿™ç¯‡æ–‡ç« ä¸­å­¦åˆ°çš„ä¸œè¥¿ã€‚

**âš ï¸æ³¨**:ä½ çš„æ“ä½œç³»ç»Ÿä¸Šçš„å¤§å¤šæ•°ç¨‹åºéƒ½æ˜¯éé˜»å¡çš„ï¼Œå› æ­¤ä¸€ä¸ª CPU å¯ä»¥åœ¨ç­‰å¾…å…¶ä»– CPU å®Œæˆçš„åŒæ—¶æ‰§è¡Œè®¸å¤šä»»åŠ¡ã€‚æ­¤å¤–ï¼Œç°ä»£å¤„ç†å™¨æ‹¥æœ‰å¤šä¸ªå†…æ ¸æ¥æé«˜å¹¶è¡Œæ€§ã€‚

# node . js ä¸­çš„åŒæ­¥ä¸å¼‚æ­¥

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å¼€å‘éé˜»å¡ä»£ç ï¼Œæœ€å¤§é™åº¦åœ°æé«˜æ€§èƒ½ã€‚åŒæ­¥ä»£ç ä¹Ÿè¢«ç§°ä¸ºâ€œé˜»å¡â€ï¼Œå› ä¸ºå®ƒä¼šæš‚åœç¨‹åºï¼Œç›´åˆ°æ‰€æœ‰çš„èµ„æºéƒ½å¯ç”¨ã€‚ç„¶è€Œï¼Œå¼‚æ­¥ä»£ç ä¹Ÿè¢«ç§°ä¸ºâ€œéé˜»å¡çš„â€ï¼Œå› ä¸ºç¨‹åºç»§ç»­æ‰§è¡Œï¼Œä¸ç­‰å¾…å¤–éƒ¨èµ„æº(I/O)å¯ç”¨ã€‚

> ğŸ’¡åœ¨è®¡ç®—ä¸­ï¼Œè¾“å…¥/è¾“å‡ºæˆ–`I/O`(æˆ–`io`æˆ–`IO`)æ˜¯ç¨‹åºä¸å¤–ç•Œ(æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ã€ç½‘ç»œè¯·æ±‚ç­‰)ä¹‹é—´çš„é€šä¿¡ã€‚

æˆ‘ä»¬å°†æ¯”è¾ƒä½¿ç”¨é˜»å¡ I/O æ¨¡å‹å’Œä½¿ç”¨éé˜»å¡ I/O æ¨¡å‹è¯»å–æ–‡ä»¶çš„ä¸¤ç§ä¸åŒæ–¹å¼ã€‚

é¦–å…ˆï¼Œè€ƒè™‘ä¸‹é¢çš„é˜»å¡ä»£ç ã€‚

## [](#synchronous-code-for-reading-from-a-file-in-nodejs)è¯»å– Node.js ä¸­æ–‡ä»¶çš„åŒæ­¥ä»£ç 

```
const fs = require('fs');

console.log('start');

const data = fs.readFileSync('./file.txt', 'utf-8'); // blocks here until file is read
console.log('data: ', data.trim());

console.log('end'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªç¨‹åºçš„è¾“å‡ºæ˜¯å¤šå°‘ï¼Ÿ

æˆ‘ä»¬ä½¿ç”¨èŠ‚ç‚¹çš„`readFileSync`ã€‚

> `Sync` =åŒæ­¥=é˜»å¡ I/O æ¨¡å¼
> 
> `Async` =å¼‚æ­¥=éé˜»å¡ I/O æ¨¡å¼

è¿™æ„å‘³ç€è¯¥ç¨‹åºå°†ç­‰å¾…å¤§çº¦ 2300 ä¸‡ä¸ª CPU å‘¨æœŸï¼Œè®©ä½ çš„ç¡¬ç›˜è¿”å›`file.txt`çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯åŸå§‹æ¶ˆæ¯`Hello World!`ã€‚

è¾“å‡ºå°†æ˜¯:

```
start
data:  Hello World! ğŸ‘‹ ğŸŒ
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ€æ ·æ‰èƒ½è®©è¿™æ®µä»£ç æ— é˜»å¡ï¼Ÿ**

å¾ˆé«˜å…´ä½ é—®äº†ã€‚å¹¸è¿çš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•° Node.js å‡½æ•°éƒ½æ˜¯éé˜»å¡çš„(å¼‚æ­¥çš„)ã€‚

å®é™…ä¸Šï¼ŒRyan Dahl åˆ›å»º Node æ˜¯å› ä¸ºä»–å¯¹ Apache HTTP æœåŠ¡å™¨çš„å±€é™æ€§ä¸æ»¡æ„ã€‚Apache ä¸ºæ¯ä¸ªæ¶ˆè€—æ›´å¤šèµ„æºçš„è¿æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚å¦ä¸€æ–¹é¢ï¼ŒNode.js ç»“åˆäº† JavaScript å¼•æ“ã€äº‹ä»¶å¾ªç¯å’Œ I/O å±‚æ¥é«˜æ•ˆåœ°å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚

[![blocking vs. non-blocking API](../Images/44d22bee61491eed95870cc5b21389c2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--N3hm8ko---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://adrianmejia.com/images/blocking-vs-non-blocking-api.png)

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œå¼‚æ­¥å‡½æ•°åœ¨ç­‰å¾… IO èµ„æºå‡†å¤‡å°±ç»ªæ—¶å¯ä»¥å¤„ç†æ›´å¤šçš„æ“ä½œã€‚

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä½¿ç”¨å¼‚æ­¥ä»£ç è¯»å–æ–‡ä»¶çš„ä¾‹å­ã€‚

## [](#asynchronous-code-for-reading-from-a-file-in-nodejs)è¯»å– Node.js ä¸­æ–‡ä»¶çš„å¼‚æ­¥ä»£ç 

æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä»æ–‡ä»¶ä¸­è¯»å–è€Œä¸é˜»å¡å…¶ä½™çš„ä»£ç :

```
const fs = require('fs');

console.log('start');

fs.readFile('./file.txt', 'utf-8', (err, data) => {
  if (err) throw err;
  console.log('file.txt data: ', data.trim());
});

console.log('end'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªç¨‹åºçš„è¾“å‡ºæ˜¯å¤šå°‘ï¼Ÿ

è§ç­”æ¡ˆ

```
start
end
file.txt data:  Hello World! ğŸ‘‹ ğŸŒ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®¸å¤šäººå¯¹`start`å’Œ`end`å‡ºç°åœ¨`data`è¾“å‡ºä¹‹å‰çš„äº‹å®æ„Ÿåˆ°æƒŠè®¶ã€‚ğŸ‘€

`end`å‡ºç°åœ¨æ–‡ä»¶è¾“å‡ºä¹‹å‰ï¼Œå› ä¸ºç¨‹åºä¸ä¼šæš‚åœå¹¶ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚

è¿™å¾ˆé…·ï¼Œä½†æ˜¯è¿™æœ‰å¾ˆå¤§çš„åŒºåˆ«å—ï¼Ÿæ˜¯çš„ï¼Œè®©æˆ‘ä»¬æŠŠæ–‡ä»¶æ”¾å¤§ï¼Œç„¶åè®¡æ—¶ï¼

## [](#blocking-vs-nonblocking-io-model-benchmark)é˜»å¡ä¸éé˜»å¡ I/O æ¨¡å‹åŸºå‡†æµ‹è¯•

å¯¹äºè¿™ä¸ªåŸºå‡†ï¼Œæˆ‘ä»¬æ¥è¯»ä¸€ä¸ªå¤§æ–‡ä»¶ã€‚æˆ‘åªæ˜¯å»æˆ‘çš„ä¸‹è½½ï¼Œå¹¶é‡‡å–äº†æœ€é‡çš„ã€‚(ä½ å¯ä»¥åœ¨å®¶è¯•è¯•è¿™ä¸ªå®éªŒï¼Œè¯„è®ºä½ çš„ç»“æœ)

```
const fs = require('fs');

console.time('readFileSync');

for (let x = 0; x < 10; x++) {
  const largeFile = fs.readFileSync('/users/admejiar/Downloads/Docker.dmg');
  console.log(`File size#${x}: ${Math.round(largeFile.length / 1e6)} MB`);
}

const data = fs.readFileSync('./file.txt', 'utf-8'); // blocks here until file is read
console.log('file.txt data: ', data.trim());

console.timeEnd('readFileSync'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯`console.time`,è¿™å¯¹äºåŸºå‡†æµ‹è¯•æ¥è¯´éå¸¸å¥½ï¼Œå› ä¸ºå®ƒè®¡ç®—äº†èŠ±è´¹çš„æ¯«ç§’æ•°ã€‚è¾“å‡ºå¦‚ä¸‹æ‰€ç¤º:

```
File size#0: 523 MB
File size#1: 523 MB
File size#2: 523 MB
File size#3: 523 MB
File size#4: 523 MB
File size#5: 523 MB
File size#6: 523 MB
File size#7: 523 MB
File size#8: 523 MB
File size#9: 523 MB
file.txt data:  Hello World! ğŸ‘‹ ğŸŒ
readFileSync: 2572.060ms 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯»å–æ‰€æœ‰åä¸ªæ–‡ä»¶å’Œ`file.txt`èŠ±è´¹äº† 2.5 ç§’ã€‚

ç°åœ¨è®©æˆ‘ä»¬ç”¨æ— é˜»å¡æ¥è¯•è¯•åŒæ ·çš„æ–¹æ³•:

```
const fs = require('fs');

console.time('readFile');

for (let x = 0; x < 10; x++) {
  fs.readFile('/users/admejiar/Downloads/Docker.dmg', (err, data) => {
    if (err) throw err;
    console.log(`File size#${x}: ${Math.round(data.length / 1e6)} MB`);
  });
}

fs.readFile('./file.txt', 'utf-8', (err, data) => {
  if (err) throw err;
  console.log('file.txt data: ', data.trim());
});

console.timeEnd('readFile'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯è¾“å‡ºç»“æœ:

```
readFile: 0.731ms
file.txt data:  Hello World! ğŸ‘‹ ğŸŒ
File size#7: 523 MB
File size#9: 523 MB
File size#4: 523 MB
File size#2: 523 MB
File size#6: 523 MB
File size#5: 523 MB
File size#1: 523 MB
File size#8: 523 MB
File size#0: 523 MB
File size#3: 523 MB 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å“‡ï¼å®Œå…¨éšæœºï¼ğŸ¤¯

ä¸åˆ°ä¸€æ¯«ç§’å°±åˆ°äº†`console.timeEnd`ï¼å°çš„`file.txt`éšåå‡ºç°ï¼Œç„¶åå¤§æ–‡ä»¶ä»¥ä¸åŒçš„é¡ºåºå‡ºç°ã€‚å¦‚ä½ æ‰€è§ï¼Œéé˜»å¡ä¸ç­‰äººã€‚è°å‡†å¤‡å¥½äº†ï¼Œè°å°±å…ˆå‡ºæ¥ã€‚å°½ç®¡å®ƒä¸æ˜¯ç¡®å®šæ€§çš„ï¼Œä½†å®ƒæœ‰è®¸å¤šä¼˜ç‚¹ã€‚

å¯¹å¼‚æ­¥ä»£ç è¿›è¡ŒåŸºå‡†æµ‹è¯•å¹¶ä¸ç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»ç­‰å¾…æ‰€æœ‰æ“ä½œå®Œæˆ(è€Œ`console.timeEnd`å¹¶æ²¡æœ‰è¿™ä¹ˆåš)ã€‚å½“æˆ‘ä»¬è¦†ç›–`Promise` s æ—¶ï¼Œæˆ‘ä»¬å°†æä¾›ä¸€ä¸ªæ›´å¥½çš„åŸºå‡†ã€‚

çœ‹çœ‹è¿™å¼ ç…§ç‰‡:

[![synchronous vs. asynchronous javascript](../Images/aa0e672210673467dbcc1a333d0d8da9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--si-PUEP6--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://adrianmejia.com/images/synchronous-asynchronous-javascript.png)

å¼‚æ­¥ç¨‹åºå°†èŠ±è´¹ä¸æœ€è€—æ—¶çš„ä»»åŠ¡ä¸€æ ·é•¿çš„æ—¶é—´ã€‚å®ƒå¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œè€Œé˜»å¡æ¨¡å‹æŒ‰é¡ºåºæ‰§è¡Œã€‚

# [](#advantages-of-nonblocking-code)éé˜»å¡ç çš„ä¼˜ç‚¹

éé˜»å¡ä»£ç çš„æ€§èƒ½æ›´é«˜ã€‚é˜»å¡ä»£ç ä¼šæµªè´¹å¤§çº¦ 90%çš„ CPU å‘¨æœŸæ¥ç­‰å¾…ç½‘ç»œæˆ–ç£ç›˜è·å–æ•°æ®ã€‚ä½¿ç”¨éé˜»å¡ä»£ç æ˜¯ä¸€ç§æ›´ç›´æ¥çš„æ–¹å¼ï¼Œæ— éœ€å¤„ç†å¤šä¸ªæ‰§è¡Œçº¿ç¨‹å°±èƒ½å®ç°å¹¶å‘ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ª API æœåŠ¡å™¨ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸ä½¿ç”¨é˜»å¡ä»£ç ç›¸æ¯”ï¼Œä½¿ç”¨éé˜»å¡ä»£ç å¯ä»¥å¤šå¤„ç†å¤šå°‘è¯·æ±‚ã€‚

[![blocking vs. non-blocking API](../Images/44d22bee61491eed95870cc5b21389c2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--N3hm8ko---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://adrianmejia.com/images/blocking-vs-non-blocking-api.png)

æ­£å¦‚æ‚¨å‰é¢çœ‹åˆ°çš„ï¼Œé˜»å¡ API æœåŠ¡å™¨ä¸€æ¬¡å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚å®ƒæœåŠ¡äºè¯·æ±‚#1ï¼Œå®ƒå¯¹æ•°æ®åº“ç©ºé—²ï¼Œç„¶åå¯ä»¥è‡ªç”±åœ°æœåŠ¡äºå…¶ä»–è¯·æ±‚ã€‚ç„¶è€Œï¼Œéé˜»å¡ API åœ¨ç­‰å¾…æ•°æ®åº“è¿”å›æ—¶å¯ä»¥æ¥å—å¤šä¸ªè¯·æ±‚ã€‚

æ—¢ç„¶ä½ å·²ç»(å¸Œæœ›)ç›¸ä¿¡äº†ä¸ºä»€ä¹ˆç¼–å†™éé˜»å¡ä»£ç æ˜¯å¿…è¦çš„ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬çœ‹çœ‹å¯ä»¥ç®¡ç†å®ƒçš„ä¸åŒæ–¹æ³•ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä½¿ç”¨å›è°ƒï¼Œä½†ä¹Ÿæœ‰å…¶ä»–æ–¹æ³•æ¥å¤„ç†å®ƒã€‚

åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å¤„ç†å¼‚æ­¥ä»£ç :

*   å›æ”¶
*   æ‰¿è¯º
*   å¼‚æ­¥/ç­‰å¾…åŠŸèƒ½
*   å‘ç”µæœº

æˆ‘å°†åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­é€ä¸€ä»‹ç»ã€‚æ•¬è¯·å…³æ³¨ï¼