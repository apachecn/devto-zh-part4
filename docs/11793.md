# Ktor - a Kotlin web framework

> åŸæ–‡ï¼š<https://dev.to/lankydandev/ktor-a-kotlin-web-framework-3hoj>

Ktor æ˜¯ä¸€ä¸ªå¼‚æ­¥ web æ¡†æ¶ï¼Œç”¨ Kotlin ç¼–å†™å¹¶ä¸ºå…¶è®¾è®¡ã€‚å…è®¸ Kotlin æ›´ä»¤äººå°è±¡æ·±åˆ»çš„ç‰¹æ€§ï¼Œå¦‚åç¨‹ï¼Œä¸ä»…è¢«ä½¿ç”¨ï¼Œè€Œä¸”ä½œä¸ºä¸€ç­‰å…¬æ°‘å¾—åˆ°æ”¯æŒã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒSpring æ˜¯æˆ‘çš„é¦–é€‰é€šç”¨æ¡†æ¶ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯æˆ‘åœ¨éœ€è¦ç»„è£… REST API æ—¶ä½¿ç”¨çš„ã€‚ä½†æ˜¯ï¼Œåœ¨æœ€è¿‘å‚åŠ äº†ä¼¦æ•¦ Kotlin meetup åï¼Œæˆ‘å†³å®šå°è¯•ä¸€æ¬¡æ–°çš„ä¸œè¥¿ã€‚è¿™å°±æ˜¯æˆ‘ä¸ºä»€ä¹ˆä¼šåœ¨è¿™é‡Œï¼Œå†™ä¸€ç¯‡å…³äº Ktor çš„åšå®¢ã€‚æ‰€ä»¥ï¼Œè¿™ç¯‡æ–‡ç« å¯¹ä½ æˆ‘æ¥è¯´éƒ½æ˜¯ä¸€æ¬¡å­¦ä¹ çš„ç»å†ã€‚è¿™ç¯‡æ–‡ç« çš„å†…å®¹å°†ç¼ºä¹æœ‰ç»éªŒçš„å»ºè®®ï¼Œè€Œæ˜¯è®°å½•æˆ‘ç¬¬ä¸€æ¬¡ç© Ktor çš„æ—…ç¨‹ã€‚

è¿™é‡Œæœ‰ä¸€äº›å…³äº Ktor çš„èƒŒæ™¯ä¿¡æ¯ã€‚å®ƒå¾—åˆ°äº† Jetbrains çš„æ”¯æŒï¼Œä»–ä»¬ä¹Ÿæ˜¯ Kotlin æœ¬èº«çš„åˆ›é€ è€…ã€‚æœ‰è°æ¯”ä»äº‹è¯­è¨€å·¥ä½œçš„äººæ›´é€‚åˆåˆ¶ä½œ Kotlin web æ¡†æ¶å‘¢ï¼Ÿ

## å®ç°

### ä¾èµ–å…³ç³»

```
buildscript {
  ext.kotlin_version = '1.3.41'
  ext.ktor_version = '1.2.2'

  repositories {
    mavenCentral()
  }
  dependencies {
    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
  }
}

apply plugin: 'java'
apply plugin: 'kotlin'

// might not be needed but my build kept defaulting to Java 12
java {
  disableAutoTargetJvm()
}

// Ktor uses coroutines
kotlin {
  experimental {
    coroutines "enable"
  }
}

compileKotlin {
  kotlinOptions.jvmTarget = "1.8"
}
compileTestKotlin {
  kotlinOptions.jvmTarget = "1.8"
}

dependencies {
  // Kotlin stdlib + test dependencies

  // ktor dependencies
  compile "io.ktor:ktor-server-netty:$ktor_version"
  compile "io.ktor:ktor-jackson:$ktor_version"
  // logback for logging
  compile group: 'ch.qos.logback', name: 'logback-classic', version: '1.2.3'
  // kodein for dependency injection
  compile group: 'org.kodein.di', name: 'kodein-di-generic-jvm', version: '6.3.0'
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œå‘ç”Ÿäº†ä¸€äº›äº‹æƒ…ã€‚

*   Ktor éœ€è¦ Kotlin `1.3`çš„æœ€ä½ç‰ˆæœ¬ï¼Œä»¥ä¾¿å¯ä»¥åˆ©ç”¨åç¨‹ã€‚

*   å¼•å…¥äº†å¯¹`ktor-server-netty`å’Œ`ktor-jackson`çš„ä¾èµ–ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™æ„å‘³ç€ [Netty](https://netty.io/) å°†è¢«ç”¨äºè¿™ä¸ªèŒä½ã€‚æ ¹æ®æ‚¨é€‰æ‹©å¯¼å…¥çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„åŸºç¡€ web æœåŠ¡å™¨ã€‚ç›®å‰å‰©ä¸‹çš„é€‰é¡¹æ˜¯[çªå ¤](https://www.eclipse.org/jetty/)å’Œ[é›„çŒ«](http://tomcat.apache.org/)ã€‚

*   [Logback](https://logback.qos.ch/) ç”¨äºå¤„ç†æ—¥å¿—è®°å½•ã€‚è¿™å¹¶ä¸åŒ…å«åœ¨ Ktor ä¾èµ–é¡¹ä¸­ï¼Œå¦‚æœæ‚¨è®¡åˆ’è¿›è¡Œä»»ä½•ç±»å‹çš„æ—¥å¿—è®°å½•ï¼Œè¿™æ˜¯å¿…éœ€çš„ã€‚

*   [Kodein](https://kodein.org/Kodein-DI/) æ˜¯ä¸€ä¸ªç”¨ Kotlin ç¼–å†™çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ã€‚æˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¸ä¸¥æ ¼åœ°ä½¿ç”¨äº†å®ƒï¼Œç”±äºä»£ç ç¤ºä¾‹çš„å¤§å°ï¼Œæˆ‘å¯èƒ½ä¼šå°†å®ƒå®Œå…¨åˆ é™¤ã€‚å®ƒå­˜åœ¨çš„ä¸»è¦åŸå› æ˜¯ä¸ºæˆ‘æä¾›äº†å¦ä¸€ä¸ªä½¿ç”¨ Spring ä¹‹å¤–çš„ä¸œè¥¿çš„æœºä¼šã€‚è®°ä½è¿™ä¹Ÿæ˜¯æˆ‘å°è¯• Ktor çš„åŸå› ä¹‹ä¸€ã€‚

### å¯åŠ¨ web æœåŠ¡å™¨

éšç€æ— èŠçš„ä¸œè¥¿çš„æ–¹å¼ï¼Œæˆ‘ç°åœ¨å¯ä»¥è¿è¡Œæ‚¨é€šè¿‡å®ç°ä¸€ä¸ªç®€å•çš„ web æœåŠ¡å™¨ã€‚ä¸‹é¢çš„ä»£ç å°±æ˜¯ä½ éœ€è¦çš„å…¨éƒ¨:

```
fun main() {
  embeddedServer(Netty, port = 8080, module = Application::module).start()
}

fun Application.module() {
  // code that does stuff which is covered later
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç °ã€‚è¿™å°±æ˜¯äº†ã€‚ç”¨ Ktor å’Œ Netty è¿è¡Œçš„ç®€å• web æœåŠ¡å™¨ã€‚å¥½çš„ï¼Œæ˜¯çš„ï¼Œå®ƒå¹¶æ²¡æœ‰çœŸæ­£åšä»€ä¹ˆï¼Œä½†æ˜¯æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­å¯¹æ­¤è¿›è¡Œæ‰©å±•ã€‚ä»£ç éå¸¸ç®€å•æ˜äº†ã€‚å”¯ä¸€å€¼å¾—å¼ºè°ƒçš„æ˜¯`Application.module`å‡½æ•°ã€‚`embeddedServer`çš„`module`å‚æ•°éœ€è¦`Application`çš„æ‰©å±•åŠŸèƒ½ã€‚è¿™å°†æ˜¯è®©æœåŠ¡å™¨åšäº‹æƒ…çš„*ä¸»*å‡½æ•°ã€‚

åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ‰©å±•`Application.module`çš„å†…å®¹ï¼Œä»¥ä¾¿æ‚¨çš„ web æœåŠ¡å™¨å®é™…ä¸Šåšä¸€äº›æœ‰ä»·å€¼çš„äº‹æƒ…ã€‚

### è·¯ç”±

ç›®å‰ï¼Œæ‰€æœ‰ä¼ å…¥çš„è¯·æ±‚éƒ½å°†è¢«æ‹’ç»ï¼Œå› ä¸ºæ²¡æœ‰ç«¯ç‚¹æ¥å¤„ç†å®ƒä»¬ã€‚é€šè¿‡è®¾ç½®è·¯ç”±ï¼Œæ‚¨å¯ä»¥æŒ‡å®šè¯·æ±‚å¯ä»¥ç»è¿‡çš„æœ‰æ•ˆè·¯å¾„ï¼Œä»¥åŠå½“è¯·æ±‚åˆ°è¾¾ç›®çš„åœ°æ—¶å¤„ç†è¯·æ±‚çš„å‡½æ•°ã€‚

è¿™æ˜¯åœ¨ä¸€ä¸ª`Routing`å—(æˆ–å¤šä¸ª`Routing`å—)å†…å®Œæˆçš„ã€‚åœ¨ä¸€ä¸ªè¡—åŒºå†…ï¼Œå»ºç«‹äº†é€šå¾€ä¸åŒç«¯ç‚¹çš„è·¯çº¿:

```
routing {
  // all routes defined inside are prefixed with "/people"
  route("/people") {
    // get a person
    get("/{id}") {
      val id = UUID.fromString(call.parameters["id"]!!)
      personRepository.find(id)?.let {
        call.respond(HttpStatusCode.OK, it)
      } ?: call.respondText(status = HttpStatusCode.NotFound) { "There is no record with id: $id" }
    }
    // create a person
    post {
      val person = call.receive<Person>()
      val result = personRepository.save(person.copy(id = UUID.randomUUID()))
      call.respond(result)
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`routing`æ˜¯ä¸€ä¸ªå°å°çš„æ–¹ä¾¿å‡½æ•°ï¼Œè®©ä»£ç æµæ›´æµç•…ä¸€ç‚¹ã€‚`routing`ä¸­çš„ä¸Šä¸‹æ–‡(åˆå`this`)å±äº`Routing`ç±»å‹ã€‚å¦å¤–ï¼Œ`route`ã€`get`å’Œ`post`éƒ½æ˜¯`Routing`çš„æ‰©å±•åŠŸèƒ½ã€‚

`route`è®¾ç½®ä¸€ä¸ªåŸºæœ¬è·¯å¾„åˆ°å…¶åçš„æ‰€æœ‰ç«¯ç‚¹ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œ`/people`ã€‚`get`å’Œ`post`æœ¬èº«ä¸æŒ‡å®šè·¯å¾„ï¼Œå› ä¸ºåŸºæœ¬è·¯å¾„è¶³ä»¥æ»¡è¶³ä»–ä»¬çš„éœ€æ±‚ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªæ·»åŠ ä¸€ä¸ªè·¯å¾„ï¼Œä¾‹å¦‚:

```
routing {
  // get a person
    get("/people/{id}") {
      val id = UUID.fromString(call.parameters["id"]!!)
      personRepository.find(id)?.let {
        call.respond(HttpStatusCode.OK, it)
      } ?: call.respondText(status = HttpStatusCode.NotFound) { "There is no record with id: $id" }
    }
  // create a person
  post("/people) {
    val person = call.receive<Person>()
    val result = personRepository.save(person.copy(id = UUID.randomUUID()))
    call.respond(result)
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æ‚¨è¿›å…¥ä¸‹ä¸€èŠ‚ä¹‹å‰ï¼Œæˆ‘æƒ³å‘æ‚¨å±•ç¤ºæˆ‘å®é™…ä¸Šæ˜¯å¦‚ä½•å®ç°è·¯ç”±çš„:

```
fun Application.module() {
  val personRepository by kodein.instance<PersonRepository>()
  // route requests to handler functions
  routing { people(personRepository) }
}

// extracted to a separate extension function to tidy up the code
fun Routing.people(personRepository: PersonRepository) {
  route("/people") {
    // get a person
    get("/{id}") {
      val id = UUID.fromString(call.parameters["id"]!!)
      personRepository.find(id)?.let {
        call.respond(HttpStatusCode.OK, it)
      } ?: call.respondText(status = HttpStatusCode.NotFound) { "There is no record with id: $id" }
    }
    // create a person
    post {
      val person = call.receive<Person>()
      val result = personRepository.save(person.copy(id = UUID.randomUUID()))
      call.respond(result)
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘å°†ä»£ç æå–åˆ°ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ï¼Œä»¥å‡å°‘`Application.module`çš„å†…å®¹ã€‚å½“ä½ è¯•å›¾å†™ä¸€ä¸ªæ›´é‡è¦çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚æˆ‘å¦‚ä½•ç€æ‰‹è¿™ä»¶äº‹æ˜¯å¦ç¬¦åˆ T2 çš„æ–¹å¼ï¼Œåˆ™æ˜¯å¦ä¸€ä¸ªé—®é¢˜ã€‚é€šè¿‡å¿«é€Ÿæµè§ˆ Ktor æ–‡æ¡£ï¼Œçœ‹èµ·æ¥è¿™æ˜¯ä¸€ä¸ªä¸é”™çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘ç›¸ä¿¡æˆ‘çœ‹åˆ°äº†å¦ä¸€ç§æ–¹æ³•ï¼Œä½†æˆ‘éœ€è¦èŠ±æ›´å¤šçš„æ—¶é—´ã€‚

### è¯·æ±‚å¤„ç†ç¨‹åºçš„å†…å®¹

å½“è¯·æ±‚è¢«è·¯ç”±åˆ°è¯·æ±‚å¤„ç†ç¨‹åºæ—¶æ‰§è¡Œçš„ä»£ç æ˜¾ç„¶éå¸¸é‡è¦ã€‚å‡½æ•°ç»ˆç©¶éœ€è¦åšç‚¹ä»€ä¹ˆâ€¦

æ¯ä¸ªå¤„ç†å‡½æ•°éƒ½åœ¨åç¨‹çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚æˆ‘æ²¡æœ‰çœŸæ­£åˆ©ç”¨è¿™ä¸ªäº‹å®ï¼Œå› ä¸ºæˆ‘å±•ç¤ºçš„æ¯ä¸ªå‡½æ•°éƒ½æ˜¯å®Œå…¨åŒæ­¥çš„ã€‚å…³äºè¿™æ–¹é¢çš„æ›´å¤šä¿¡æ¯ï¼ŒKtor æ–‡æ¡£ä¸­æœ‰ä¸€ä¸ªå¼‚æ­¥ä¾‹å­ã€‚

åœ¨è¿™ç¯‡æ–‡ç« çš„å‰©ä½™éƒ¨åˆ†ï¼Œæˆ‘å°†å°½é‡ä¸è¦è¿‡å¤šåœ°æåˆ°åç¨‹ï¼Œå› ä¸ºå®ƒä»¬å¯¹äºè¿™ä¸ªç®€å•çš„ REST API å¹¶ä¸æ˜¯ç‰¹åˆ«é‡è¦ã€‚

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ›´ä»”ç»†åœ°ç ”ç©¶`get`å‡½æ•°:

```
get("/{id}") {
  val id = UUID.fromString(call.parameters["id"]!!)
  personRepository.find(id)?.let {
    call.respond(HttpStatusCode.OK, it)
  } ?: call.respondText(status = HttpStatusCode.NotFound) { "There is no record with id: $id" }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`{id}`è¡¨ç¤ºè¯·æ±‚ä¸­éœ€è¦ä¸€ä¸ªè·¯å¾„å˜é‡ï¼Œå…¶å€¼å°†å­˜å‚¨ä¸º`id`ã€‚å¯ä»¥åŒ…å«å¤šä¸ªè·¯å¾„å˜é‡ï¼Œä½†æ˜¯æœ¬ä¾‹ä¸­åªéœ€è¦ä¸€ä¸ªğŸ‘ã€‚`id`çš„å€¼æ˜¯ä»`call.parameters`ä¸­è·å–çš„ï¼Œå®ƒæ¥å—ä½ æƒ³è¦è®¿é—®çš„å˜é‡çš„åç§°ã€‚

*   `call`è¡¨ç¤ºå½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ã€‚
*   `parameters`æ˜¯è¯·æ±‚çš„å‚æ•°åˆ—è¡¨ã€‚

ä½¿ç”¨è·¯å¾„å˜é‡ä¸­çš„`id`,æ•°æ®åº“æœç´¢ç›¸åº”çš„è®°å½•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå®ƒå­˜åœ¨ï¼Œè®°å½•å°†ä¸é€‚å½“çš„`200 OK`ä¸€èµ·è¿”å›ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°†è¿”å›ä¸€ä¸ªé”™è¯¯å“åº”ã€‚`respond`å’Œ`respondText`éƒ½æ”¹å˜äº†å½“å‰`call`çš„åº•å±‚`response`ã€‚æ‚¨å¯ä»¥æ‰‹åŠ¨å®Œæˆæ­¤æ“ä½œï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨:

```
call.response.status(HttpStatusCode.OK)
call.response.pipeline.execute(call, it) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨å¯ä»¥è¿™æ ·åšï¼Œä½†æ˜¯æ²¡æœ‰å¿…è¦è¿™æ ·åšï¼Œå› ä¸ºè¿™å®é™…ä¸Šåªæ˜¯`respond`çš„å®ç°ã€‚`respondText`æœ‰ä¸€äº›é¢å¤–çš„é€»è¾‘ï¼Œä½†å§”æ‰˜ç»™`response`æ¥å®Œæˆä¸€åˆ‡ã€‚è¿™ä¸ªå‡½æ•°ä¸­å¯¹`execute`çš„æœ€åä¸€æ¬¡è°ƒç”¨ä»£è¡¨äº†å‡½æ•°çš„*è¿”å›*å€¼ã€‚

### å®‰è£…é¢å¤–åŠŸèƒ½

åœ¨ Ktor ä¸­ï¼Œé¢å¤–çš„*åŠŸèƒ½*å¯ä»¥åœ¨éœ€è¦æ—¶æ’å…¥ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ  [Jackson JSON è§£æ](https://github.com/FasterXML/jackson)æ¥å¤„ç†å¹¶ä»åº”ç”¨ç¨‹åºè¿”å› JSONã€‚ä¸‹é¢æ˜¯å®‰è£…åˆ°ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­çš„ç‰¹æ€§:

```
fun Application.module() {
  install(DefaultHeaders) { header(HttpHeaders.Server, "My ktor server") }
  // controls what level the call logging is logged to
  install(CallLogging) { level = Level.INFO }
  // setup jackson json serialisation
  install(ContentNegotiation) { jackson() }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `DefaultHeaders`å°†æœåŠ¡å™¨åç§°æ·»åŠ åˆ°æ¯ä¸ªå“åº”çš„å¤´ä¸­ã€‚

*   `CallLogging`è®°å½•å…³äºä¼ å‡ºå“åº”çš„ä¿¡æ¯ï¼Œå¹¶æŒ‡å®šè®°å½•å®ƒä»¬çš„çº§åˆ«ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œéœ€è¦åŒ…å«ä¸€ä¸ªæ—¥å¿—åº“ã€‚è¾“å‡ºå°†ç±»ä¼¼äº:

```
INFO ktor.application.log - 200 OK: GET - /people/302a1a73-173b-491c-b306-4d95387a8e36 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `ContentNegotiation`å‘Šè¯‰æœåŠ¡å™¨ä½¿ç”¨ Jackson å¤„ç†ä¼ å…¥å’Œä¼ å‡ºè¯·æ±‚ã€‚è®°ä½è¿™éœ€è¦åŒ…å«`ktor-jackson`ä½œä¸ºä¾èµ–é¡¹ã€‚å¦‚æœä½ æ„¿æ„ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ [GSON](https://ktor.io/samples/feature/gson.html) ã€‚

å…³äº Ktor åŒ…å«çš„å…¶ä»–ç‰¹æ€§çš„ä¸€é•¿ä¸²åˆ—è¡¨ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªåˆ°ä»–ä»¬çš„[æ–‡æ¡£](https://ktor.io/servers/features.html)çš„ä¾¿æ·é“¾æ¥ã€‚

å®‰è£…ç‰¹æ€§å¯ä»¥ä¸€ç›´è¿½æº¯åˆ°ä¹‹å‰å®Œæˆçš„è·¯ç”±ã€‚`routing`å§”æ‰˜åˆ°å…¶å®ç°å†…éƒ¨çš„`install`ã€‚æ‰€ä»¥ä½ å¯ä»¥å†™:

```
install(Routing) {
  route("/people") {
    get {
      // implementation
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åªè¦èƒ½è®©ä½ é«˜å…´ï¼Œæˆ‘å°±åšæŒä½¿ç”¨`routing`ã€‚å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ ç†è§£å¼•æ“ç›–ä¸‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Œå³ä½¿åªæ˜¯ä¸€ç‚¹ç‚¹ã€‚

### ç®€ç•¥æä¸º Kodein

å› ä¸ºæˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä½¿ç”¨äº† Kodeinï¼Œæ‰€ä»¥æˆ‘æƒ³ç®€å•åœ°çœ‹ä¸€ä¸‹å®ƒã€‚Kodein æ˜¯ä¸€ä¸ªç”¨ Kotlin ç¼–å†™çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œç”¨äº Kotlinã€‚ä¸‹é¢æ˜¯æˆ‘åœ¨ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„è¶…å°‘é‡ DI:

```
val kodein = Kodein {
  bind<CqlSession>() with singleton { cassandraSession() }
  bind<PersonRepository>() with singleton { PersonRepository(instance()) }
}
val personRepository by kodein.instance<PersonRepository>() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`Kodein`å—ä¸­ï¼Œåˆ›å»ºäº†åº”ç”¨ç¨‹åºç±»çš„å®ä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç±»åªéœ€è¦ä¸€ä¸ªå®ä¾‹ã€‚è°ƒç”¨`singleton`è¡¨ç¤ºè¿™ä¸€ç‚¹ã€‚`instance`æ˜¯ Kodein æä¾›çš„å ä½ç¬¦ï¼Œç”¨æ¥ä¼ é€’ç»™æ„é€ å‡½æ•°ï¼Œè€Œä¸æ˜¯å®é™…çš„å¯¹è±¡ã€‚

åœ¨`Kodein`å—ä¹‹å¤–ï¼Œæ£€ç´¢`PersonRespository`çš„ä¸€ä¸ªå®ä¾‹ã€‚

æ˜¯çš„ï¼Œæˆ‘çŸ¥é“ï¼Œåœ¨è¿™é‡Œä½¿ç”¨ Kodein æ²¡æœ‰å¤ªå¤šæ„ä¹‰ï¼Œå› ä¸ºæˆ‘å¯ä»¥ç”¨ä¸€è¡Œä»£ç æ¥ä»£æ›¿å®ƒâ€¦

```
val personRepository = PersonRepository(cassandraSession()) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç›¸åï¼Œè®©æˆ‘ä»¬æŠŠå®ƒçœ‹ä½œä¸€ä¸ªéå¸¸ç®€æ´çš„ä¾‹å­æ¥ç†è§£ğŸ‘ã€‚

## å…³é—­æ€ç»ª

ä½œä¸ºä¸€ä¸ªæåº¦åçˆ± Spring çš„äººï¼Œæˆ‘å‘ç°å’Œ Ktor ä¸€èµ·å·¥ä½œå’Œæˆ‘ä»¥å‰æ‰€ä¹ æƒ¯çš„å¾ˆä¸ä¸€æ ·ã€‚æˆ‘èŠ±äº†æ¯”å¹³æ—¶å¤šä¸€ç‚¹çš„æ—¶é—´æ¥å®Œæˆä¸€äº›æˆ‘æ»¡æ„çš„ç¤ºä¾‹ä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘è®¤ä¸ºç»“æœçœ‹èµ·æ¥ä¸é”™ï¼Œæˆ‘éœ€è¦èŠ±æ›´å¤šçš„æ—¶é—´å’Œ Ktor åœ¨ä¸€èµ·ï¼Œæ›´å¥½åœ°ç†è§£å¦‚ä½•æ›´å¥½åœ°åˆ©ç”¨å®ƒã€‚ç›®å‰ï¼Œæˆ‘ç›¸ä¿¡ Ktor è¿˜èƒ½æŒ¤å‡ºæ›´å¤šçš„åˆ©æ¶¦ã€‚è¦äº†è§£æ›´å¤šå…³äº Ktor çš„ä¿¡æ¯ï¼Œæˆ‘å¿…é¡»å†æ¬¡è®©ä½ å‚è€ƒä»–ä»¬çš„[æ–‡æ¡£](https://ktor.io/)ï¼Œé‚£é‡Œæœ‰å¤§é‡çš„ç¤ºä¾‹å’Œæ•™ç¨‹ã€‚

å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¾ˆæœ‰å¸®åŠ©ï¼Œä½ å¯ä»¥åœ¨ Twitter ä¸Šå…³æ³¨æˆ‘ï¼Œåœ°å€æ˜¯ [@LankyDanDev](https://twitter.com/LankyDanDev) æ¥äº†è§£æˆ‘çš„æ–°æ–‡ç« ã€‚