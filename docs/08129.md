# å¯¹ NestJS ä½¿ç”¨ JWT èº«ä»½éªŒè¯(Auth0)ğŸ”

> åŸæ–‡ï¼š<https://dev.to/matthias/using-jwt-authentication-auth0-with-nestjs-54oo>

æˆ‘è¯•å›¾ç”¨ [Auth0](//https:/auth0.com) æ¥ä¿æŠ¤æˆ‘çš„åŸºäº [NestJS](https://nestjs.com) çš„ APIã€‚

æˆ‘ç°åœ¨åšçš„äº‹æƒ…æ„Ÿè§‰ä¸å¤ªå¯¹ï¼ŒğŸ¥´.

æˆ‘è¯•å›¾ä½¿ç”¨æ¥è‡ª Auth0 çš„ [NestJS æ–‡æ¡£](https://docs.nestjs.com/techniques/authentication)å’Œ[ç”¨ Nest.js å¼€å‘åç«¯ APIï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“æˆ‘åœ¨åšä»€ä¹ˆã€‚](https://auth0.com/blog/full-stack-typescript-apps-part-1-developing-backend-apis-with-nestjs/)

ä½ ä»¬ä¸­æœ‰äººå·²ç»è§£å†³è¿™ä¸ªé—®é¢˜äº†å—ï¼Ÿä½ èƒ½æä¾›ä¸€äº›å¥½çš„èµ„æºæˆ–å»ºè®®å—ï¼Ÿ

ä¸‹é¢æ˜¯æˆ‘çš„ç­–ç•¥å®ç°:

```
import { passportJwtSecret } from 'jwks-rsa';
import { ExtractJwt, Strategy, VerifiedCallback } from 'passport-jwt';

import { Injectable, UnauthorizedException } from '@nestjs/common';
import { PassportStrategy } from '@nestjs/passport';

@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy) {
  constructor() {
    super({
      secretOrKeyProvider: passportJwtSecret({
        cache: true,
        rateLimit: true,
        jwksRequestsPerMinute: 5,
        jwksUri: '${DOMAIN}/.well-known/jwks.json'
      }),
      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),
      audience: 'http://localhost:3000',
      issuer: '${DOMAIN}'
    });
  }

  async validate(payload: any, done: VerifiedCallback) {
    if (!payload) {
      done(new UnauthorizedException(), false);
    }

    return done(null, payload);
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æ§åˆ¶å™¨ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ª*èº«ä»½ä¿æŠ¤* :

```
@UseGuards(AuthGuard('jwt')) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘è¿˜æƒ³ä» Auth0 æ£€ç´¢ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„å…ƒæ•°æ®ã€‚æœ‰äººçŸ¥é“æ€ä¹ˆåšå—ï¼Ÿ