# å¦‚ä½•ä½¿ç”¨ multer å’Œ sharp ä¸Šä¼ å›¾ç‰‡

> åŸæ–‡:[https://dev . to/mkilmer/how-to-upload-image-using-multer-and-sharp-45lm](https://dev.to/mkilmer/how-to-upload-image-using-multer-and-sharp-45lm)

å½“æˆ‘å¼€å§‹æˆ‘çš„å¼€å‘ä¹‹æ—…æ—¶ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›å›°éš¾ï¼Œé˜…è¯»æ–‡æ¡£å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚æ‰€ä»¥æˆ‘æœ‰äº†å†™ä¸€äº›æˆ‘å·²ç»å­¦è¿‡çš„ä¸œè¥¿çš„æƒ³æ³•ï¼Œè¿™äº›ä¸œè¥¿åœ¨å¼€å§‹æ—¶æˆ‘æœ‰å›°éš¾

* * *

**`NOTE`** :æˆ‘çŸ¥é“ä½ å·²ç»æœ‰äº†ä½¿ç”¨ [express.js](https://github.com/expressjs/express) å’ŒèŠ‚ç‚¹å¼€å‘æ„å»ºæœåŠ¡å™¨çš„ç»éªŒ

# [](#about-multer)**å…³äº multer**

[Multer](https://www.npmjs.com/package/multer) æ˜¯ä¸€ä¸ªå¤„ç†å¤šéƒ¨åˆ†/è¡¨å•æ•°æ®çš„ node.js ä¸­é—´ä»¶ï¼Œä¸»è¦ç”¨äºä¸Šä¼ æ–‡ä»¶ã€‚ **`IMPORTANT`** : Multer å°†*è€Œé*å¤„ç†ä»»ä½•éå¤šéƒ¨åˆ†`(multipart/form-data)`çš„è¡¨å•ã€‚

## å®‰è£…

`npm install multer`

# [](#about-sharp)**å…³äºé”**

[Sharp](https://www.npmjs.com/package/sharp) çš„å…¸å‹ç”¨ä¾‹æ˜¯å°†æ™®é€šæ ¼å¼çš„å¤§å›¾åƒè½¬æ¢æˆå°ºå¯¸ä¸åŒçš„æ›´å°çš„ã€**ç½‘é¡µå‹å¥½çš„** JPEGã€PNG å’Œ WebP å›¾åƒã€‚

## å®‰è£…

`npm install sharp`

# [](#project-structure)**é¡¹ç›®ç»“æ„**

â”œâ”€â”€ index.js | **ä¸»åº”ç”¨ç¨‹åºæ–‡ä»¶**
â”œâ”€â”€uploads | **å›¾ç‰‡ä¸Šä¼ æ–‡ä»¶å¤¹**
â””â”€â”€è°ƒæ•´å¤§å°| **å›¾ç‰‡è°ƒæ•´å¤§å°ä¸Šä¼ æ–‡ä»¶å¤¹**
â”œâ”€â”€ä¸Šä¼ -config.js | **multer é…ç½®**
â”œâ”€â”€ node_modules | **åº”ç”¨ç¨‹åºçš„æ¨¡å—**
â”œâ”€â”€package-lock . JSON |
â”œâ”€â”€package . JSON |**åˆ—å‡ºæ‚¨çš„é¡¹ç›®çš„åŒ…**

# [](#hands-on-code)**æ‰‹ä¸Šçš„ä»£ç **

å¯¹äºæµ‹è¯•ï¼Œå»ºè®®æ‚¨ä½¿ç”¨ä¸€äº› API æµ‹è¯•ç¨‹åºï¼Œå¦‚ Insomia æˆ– Postmanã€‚

**`IMPORTANT`** :ä¸è¦å¿˜è®°åœ¨ API æµ‹è¯•ç¨‹åºçš„è¯·æ±‚ä½“ä¸­è®¾ç½®**å¤šéƒ¨åˆ†å½¢å¼**æ¶æ„ã€‚

index . jsã€”t0ã€•

```
 const express = require('express')
const multer = require('multer')
const sharp = require('sharp')
const storage = require('./upload-config')
const upload = multer(storage)
const path = require('path')
const fs = require('fs')
const app = express()

const router = new express.Router
app.use(router)

router.get('/', (req, res) => {
    res.send('ok')
})
router.post('/upload',upload.single('image') ,async (req, res) => {
   const { filename: image } = req.file 

   await sharp(req.file.path)
    .resize(500)
    .jpeg({quality: 50})
    .toFile(
        path.resolve(req.file.destination,'resized',image)
    )
    fs.unlinkSync(req.file.path)

    return res.send('SUCCESS!')
})
app.listen(3333, () => {
    console.log('server on!')
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

â”œâ”€â”€ä¸Šä¼ -config.js

```
const multer = require('multer')
const path = require('path')

module.exports = {
    storage : new multer.diskStorage({
        destination : path.resolve(__dirname, ".","uploads"),
        filename : function(req, file, callback) {
            callback(null, file.originalname)
        }
    })
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#conclusion-mega)**ç»“è®º**ğŸ“£

æˆ‘éå¸¸æ„Ÿè°¢èƒ½å¤Ÿåˆ†äº«æˆ‘è·å¾—çš„ä¸€äº›çŸ¥è¯†ï¼Œå› ä¸ºæ•™å­¦æ˜¯å­¦ä¹ çš„æœ€å¥½æ–¹å¼ã€‚ä»»ä½•æç¤ºæˆ–é—®é¢˜ï¼Œè¯·é€šè¿‡è„¸ä¹¦è”ç³»æˆ‘: [Kilmer](https://www.facebook.com/bacon.sleep) ã€‚
**`PS: forgive me for something this is my first post`**
**å‚¨å­˜åœ¨ GitHub:[https://github.com/mkilmerr/multer-sharp-upload-image](https://github.com/mkilmerr/multer-sharp-upload-image)**