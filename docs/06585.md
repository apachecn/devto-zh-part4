# æˆ‘å¦‚ä½•ç”¨ Typescript åˆ›å»ºæˆ‘çš„ç¬¬ä¸€ä¸ª MagicMirror æ¨¡å—

> åŸæ–‡ï¼š<https://dev.to/mscharl/how-i-created-my-first-magicmirror-module-with-typescript-4dn3>

æˆ‘æœ€è¿‘åˆ›å»ºäº†æˆ‘çš„ç¬¬ä¸€ä¸ª MagicMirror æ¨¡å—ã€‚ç°åœ¨æˆ‘æƒ³â€œè°ˆè°ˆâ€æˆ‘æ˜¯å¦‚ä½•åšåˆ°çš„ã€‚

## ğŸ“¦æ„å»ºå·¥å…·

æ­£å¦‚æˆ‘çš„å¤§å¤šæ•°å°é¡¹ç›®ä¸€æ ·ï¼Œæˆ‘ä»å¤´å¼€å§‹åˆ›å»ºæˆ‘çš„æ„å»ºå·¥å…·åŒ…ã€‚æˆ‘é€šå¸¸åˆ›å»ºä¸€ä¸ª Webpack é…ç½®ï¼Œå®‰è£…æ‰€æœ‰çš„åŠ è½½ç¨‹åºå¹¶å¼€å§‹æ„å»ºã€‚è¿™ä¸€æ¬¡æˆ‘æƒ³è¯•è¯• [rollup](https://rollupjs.org) ï¼Œè¿™æ˜¯æˆ‘çš„â€œæˆ‘æƒ³åœ¨æœ‰æ—¶é—´çš„æ—¶å€™çœ‹çœ‹è¿™ä¸ªâ€æ¸…å•ä¸Šçš„å·¥å…·ä¹‹ä¸€ã€‚è®¾ç½®éå¸¸ç®€å•ï¼Œæˆ‘å–œæ¬¢ä½ å¯ä»¥ç”¨ä¸åŒçš„æ’ä»¶åˆ›å»ºå¤šä¸ªæ¡ç›®å’Œè¾“å‡ºæ¥å¤„ç†ä½ çš„ä»£ç ç”Ÿæˆã€‚è¿™å¯¹äºè¿™ä¸ªé¡¹ç›®æ¥è¯´éå¸¸ç†æƒ³ï¼Œå› ä¸ºæˆ‘æƒ³åˆ›å»ºä¸€ä¸ªæ ¸å¿ƒæ¨¡å—æ–‡ä»¶ï¼Œå®ƒçš„ç›®æ ‡æ˜¯æµè§ˆå™¨ï¼Œè€ŒåŠ©æ‰‹æ¨¡å—çš„ç›®æ ‡æ˜¯èŠ‚ç‚¹ç¯å¢ƒã€‚æœ€åï¼Œæˆ‘çš„é…ç½®çœ‹èµ·æ¥åƒè¿™æ ·ã€‚

```
import commonjs from 'rollup-plugin-commonjs';
import resolve from 'rollup-plugin-node-resolve';
import typescript from 'rollup-plugin-typescript';
import pkg from './package.json';

export default [
    /**
     * The core module file
     * Written in Typescript and bundled with all dependencies.
     */
    {
        input: './src/MMM-edgerouter-throughput.ts',
        plugins: [
            typescript(),
            resolve(),
            commonjs(),
        ],
        output: {
            file: './MMM-edgerouter-throughput.js',
            format: 'iife',
        },
    },
    /**
     * The module helper file
     * Written in Typescript and only compiled to be used within node.
     */
    {
        input: './src/node_helper.ts',
        plugins: [
            typescript(),
        ],
        external: ['node_helper', ...Object.keys(pkg.dependencies)],
        output: {
            file: './node_helper.js',
            format: 'umd',
        },
    },
] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘é€šå¸¸åˆ›å»ºä¸‰ä¸ª npm è„šæœ¬æ¥ç¼–è¯‘æˆ‘çš„ä»£ç ã€‚`watch`åœ¨å¼€å‘çš„åŒæ—¶æŒç»­ç¼–è¯‘æˆ‘çš„ä»£ç ï¼Œ`dev`ä¸ºå¼€å‘/æµ‹è¯•æ„å»ºæ‰€æœ‰ä¸œè¥¿ä¸€æ¬¡ï¼Œ`build`åˆ›å»ºä¸€ä¸ªç”Ÿäº§å°±ç»ªåŒ…ã€‚

```
{  "scripts":  {  "build":  "rollup -c",  "dev":  "rollup -c --sourcemap=inline",  "watch":  "npm run dev -- --watch"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ğŸ—ï¸å‘å±•ç¯å¢ƒ

ä¸ºäº†ç¡®ä¿ä¸€ä¸ªæµç•…è€Œç®€å•çš„å¼€å‘è¿‡ç¨‹ï¼Œæˆ‘[åœ¨æˆ‘çš„æœºå™¨ä¸Šå®‰è£…äº† MagicMirror](https://github.com/MichMich/MagicMirror#manual-installation) ï¼Œä»¥ä¾¿åœ¨â€œä»…æœåŠ¡å™¨â€æ¨¡å¼ä¸‹ä½¿ç”¨ã€‚è¿™å…è®¸æˆ‘å°†æˆ‘åˆ›å»ºçš„æ¯ä¸ªæ¨¡å—æ·»åŠ ä¸ºä¸€ä¸ªç¬¦å·é“¾æ¥ã€‚æˆ‘è¿˜åœ¨æˆ‘çš„é¡¹ç›®ç›®å½•ä¸­åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘`node_helper`æ¨¡å—æ–‡ä»¶å¤¹çš„ç¬¦å·é“¾æ¥ã€‚è¿™ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†æœ‰åŠ©äºæˆ‘çš„ IDE ç†è§£æˆ‘åœ¨åŒ…å«`node_helper`æ—¶çš„æ„æ€ã€‚

```
.
â”œâ”€â”€ MMM-edgerouter-throughput
â”‚Â Â  â””â”€â”€ â€¦
â”œâ”€â”€ MMM-oebb-station-board
â”‚Â Â  â””â”€â”€ â€¦
â”œâ”€â”€ â€¦
â”œâ”€â”€ MagicMirror
â”‚Â Â  â”œâ”€â”€ â€¦
â”‚Â Â  â””â”€â”€ modules
â”‚Â Â   Â Â  â”œâ”€â”€ MMM-edgerouter-throughput -> ../../MMM-edgerouter-throughput
â”‚Â Â   Â Â  â”œâ”€â”€ MMM-oebb-station-board -> ../../MMM-oebb-station-board
â”‚Â Â   Â Â  â”œâ”€â”€ â€¦
â”‚Â Â   Â Â  â””â”€â”€ node_modules
â””â”€â”€ node_modules -> MagicMirror/modules/node_modules 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ğŸ“˜ä½¿ç”¨ Typescript

è€å®è¯´ï¼Œè¿™ä¸æ˜¯æœ€å¥½çš„æ•´åˆã€‚MagicMirror å­˜å‚¨åº“åŒ…å«ä¸€ä¸ª`module-types.ts`æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æœ€é‡è¦çš„ç±»å‹ï¼Œæˆ‘å¯¹å…¶è¿›è¡Œäº†ä¸€ç‚¹æ‰©å±•ä»¥æ»¡è¶³æˆ‘çš„éœ€è¦ã€‚æ›´æ·±å±‚æ¬¡çš„é›†æˆï¼Œæ¯”å¦‚èƒ½å¤Ÿä¸ºå‡½æ•°ä¸­çš„`this`å¯¹è±¡è·å¾—æ­£ç¡®çš„é”®å…¥/è‡ªåŠ¨å®Œæˆï¼Œæ˜¯ä¸å¯ç”¨çš„ã€‚å¦‚æœæˆ‘å‘ç°è‡ªå·±å°†æ¥ä¼šæ›´å¤šåœ°ä½¿ç”¨å®ƒï¼Œæˆ‘å¯èƒ½ä¼šè€ƒè™‘æ”¹è¿›è¿™ä¸€ç‚¹ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒå·¥ä½œèµ·æ¥æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œæˆ‘è§‰å¾—ä»é•¿è¿œæ¥çœ‹ï¼ŒTypescript ç»™äº†æˆ‘ä¸€ä¸ªæ›´å¥å£®ã€æ›´æ— å¿§æ— è™‘çš„å¼€å‘ä½“éªŒã€‚æœ€åï¼Œåœ¨åŠ è½½åˆ° MagicMirror ä¹‹å‰ï¼Œå®ƒåªæ˜¯è¢«ç¼–è¯‘æˆçº¯ Javascriptã€‚è¿™äº›æ–‡ä»¶éœ€è¦åœ¨æ ¹æ–‡ä»¶å¤¹ä¸­ã€‚å› æ­¤ï¼Œæˆ‘å†³å®šå°† Typescript æ–‡ä»¶æ”¾åˆ°ä¸€ä¸ª`src`æ–‡ä»¶å¤¹ä¸­ï¼Œä»¥ä¾¿è¿›è¡Œæ›´æ˜æ˜¾çš„åˆ†ç¦»ã€‚

## âœ‹æœ‰ä»€ä¹ˆé—®é¢˜ã€‚

å¦‚æœä½ å¯¹æˆ‘çš„è¿‡ç¨‹æˆ–ç±»ä¼¼çš„äº‹æƒ…æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­é—®æˆ‘ï¼