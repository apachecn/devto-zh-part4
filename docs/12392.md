# å¸¦æœ‰ä¸‰ä¸ª. js çš„åŸºäºç‰©ç†çš„åœºæ™¯

> åŸæ–‡ï¼š<https://dev.to/chicio/a-physically-based-scene-with-three-js-9gf>

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨ three.js åˆ›å»ºä¸€ä¸ªæ”¯æŒç‰©ç†æ¸²æŸ“çš„åœºæ™¯ã€‚

æˆ‘å–œæ¬¢ three.jsï¼Œæˆ‘è®¤ä¸ºå®ƒæ˜¯æœ€æ¼‚äº®çš„ javascript å’Œè®¡ç®—æœºå›¾å½¢åº“ä¹‹ä¸€ã€‚ä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ three.js å—ï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹æ¥è‡ª[å®˜æ–¹ github å›è´­](https://github.com/mrdoob/three.js/)çš„æè¿°:

> JavaScript 3D åº“ã€‚è¯¥é¡¹ç›®çš„ç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªæ˜“äºä½¿ç”¨çš„ï¼Œè½»é‡çº§çš„ï¼Œä¸‰ç»´å›¾ä¹¦é¦†ã€‚åº“
> æä¾› canvasã€svgã€CSS3D å’Œ WebGL æ¸²æŸ“å™¨ã€‚

ç®€å•æ˜äº†(æˆ‘å–œæ¬¢è¿™ç§å®šä¹‰ğŸ˜Œ).Three.js æ˜¯ä¸€ä¸ªæ„å»ºåœ¨ WebGL ä¹‹ä¸Šçš„åº“ï¼Œæ—¨åœ¨
ç®€åŒ– web çš„è®¡ç®—æœºå›¾å½¢å¼€å‘ã€‚å®ƒæœ‰å¾ˆå¤šä¸åŒçš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬æ”¯æŒ
[åŸºäºç‰©ç†çš„æ¸²æŸ“](https://en.wikipedia.org/wiki/Physically_based_rendering)ã€‚
è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå›¾ä¹¦é¦†çš„æ½œåŠ›ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•ç‰©ç†åœºæ™¯ã€‚åœ¨è¿™ç¯‡æ–‡ç« çš„æœ€åï¼Œä½ å°†ä¼šåˆ›å»ºä¸€ä¸ªå¦‚ä¸‹å›¾æ‰€ç¤ºçš„åœºæ™¯:

[![threejs first scene](img/9da22ed69362d279329428c034bc74d1.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Hw7SQn7L--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.fabrizioduroni.it/asseimg/posts/threejs-scene.jpg)

æˆ‘ä»¬å°†ä½¿ç”¨çš„ç½‘æ ¼æ˜¯ä»æ–¯å¦ç¦æ‰«æåº“è·å¾—çš„ PLY æ ¼å¼ç½‘æ ¼çš„ç®€åŒ–ç‰ˆæœ¬ã€‚

è®©æˆ‘ä»¬ä»è®¾ç½®å¼€å§‹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ html é¡µé¢ï¼Œç±»ä¼¼äº three.js æ–‡æ¡£ä¸­æè¿°çš„é¡µé¢(å¦‚ä¸‹æ‰€ç¤º)ã€‚æˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„èµ„äº§(ç½‘æ ¼ï¼Œçº¹ç†ç­‰ã€‚)åœ¨æ–‡ä»¶å¤¹`/assets/models`é‡Œã€‚

```
<!DOCTYPE html>
<html>
    <head>
        <meta charset=utf-8>
        <title>My first three.js app</title>
        <style>
            body { margin: 0; }
            canvas { width: 100%; height: 100% }
        </style>
    </head>
    <body>
        <script src="js/three.js"></script>
        <script>
            // Our Javascript will go here.
        </script>
    </body>
</html> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª`Scene`ã€‚æˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª`Camera`ã€ä¸€ä¸ªç”¨äºçº¹ç†åŠ è½½çš„`TextureLoader`ã€ä¸€ä¸ªç”¨äºåŠ è½½å±‚ç½‘æ ¼çš„
å’Œä¸€ä¸ª`WebGLRenderer`ã€‚æœ€åï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª`OrbitControls`çš„å®ä¾‹ï¼Œä¸€ä¸ª three.js æ‰©å±•ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥ç¯ç»•åœºæ™¯ã€‚

```
var scene = new THREE.Scene();
var camera = createCamera();
var textureLoader = new THREE.TextureLoader();
var plyLoader = new THREE.PLYLoader();
var renderer = createRenderer();
var controls = createOrbitsControls(camera, renderer); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹äºæ‘„åƒæœºï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`PerspectiveCamera`ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒä½¿ç”¨[é€è§†æŠ•å½±](https://en.wikipedia.org/wiki/3D_projection#Perspective_projection)æ¥æ¨¡æ‹Ÿäººçœ¼è§†å›¾(è¿™æ˜¯è®¡ç®—æœºå›¾å½¢å­¦ä¸­ä½¿ç”¨çš„ä¸¤ç§ä¸»è¦ç›¸æœºç±»å‹ä¹‹ä¸€
å’Œ[æ­£äº¤æŠ•å½±](https://en.wikipedia.org/wiki/3D_projection#Orthographic_projection))ã€‚
æˆ‘ä»¬å°†æ‘„åƒæœºæ”¾åœ¨åœºæ™¯å‰é¢ï¼Œæˆ‘ä»¬å°†è§†è§ä½“çš„å‚ç›´[è§†é‡ FOV](https://en.wikipedia.org/wiki/Field_of_view_in_video_games) è®¾ç½®ä¸º 75 åº¦ï¼Œä½¿ç”¨å½“å‰
çª—å£çš„å®½åº¦å’Œé«˜åº¦çš„çºµæ¨ªæ¯”ï¼Œè§†è§ä½“çš„[è¿‘å¹³é¢å’Œè¿œå¹³é¢](https://en.wikipedia.org/wiki/Viewing_frustum)åˆ†åˆ«è®¾ç½®ä¸º 0.1 å’Œ 1000(ä»¥é¿å…ä¸¢å¼ƒæ·»åŠ åˆ°åœºæ™¯ä¸­çš„ç½‘æ ¼)ã€‚

```
function createCamera() {
    var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.z = 8;
    camera.position.y = 0;
    camera.position.x = 0;

    return camera;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª alpha å±æ€§è®¾ç½®ä¸º true çš„æ¸²æŸ“å™¨ï¼Œä»¥é˜²æˆ‘ä»¬æƒ³è¦é›†æˆåˆ°å¦ä¸€ä¸ª HTML é¡µé¢ä¸­ï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³è¦
åœ¨åœºæ™¯åŠ è½½ä¹‹å‰èƒŒæ™¯æ˜¯å¯è§çš„ã€‚æˆ‘ä»¬é€šè¿‡å°†å±æ€§`gammaInput`å’Œ`gammaOutput`è®¾ç½®ä¸ºçœŸæ¥è®¾ç½®è¾“å…¥å’Œè¾“å‡ºé¢œè‰²çš„[ä¼½é©¬æ ¡æ­£](https://en.wikipedia.org/wiki/Gamma_correction)ã€‚æˆ‘ä»¬
ä¹Ÿé€šè¿‡è®¾ç½®`shadowMap.enabled`ä¸ºçœŸæ¥å¯ç”¨é˜´å½±è´´å›¾ï¼Œè®¾ç½®å®ƒä½¿ç”¨[ç™¾åˆ†æ¯”æ¥è¿‘è¿‡æ»¤](https://fabiensanglard.net/shadowmappingPCF/)å’Œ[åŒçº¿æ€§è¿‡æ»¤](https://en.wikipedia.org/wiki/Bilinear_filtering)ã€‚æœ€åï¼Œæˆ‘ä»¬å°†æ¸²æŸ“å™¨çš„å¤§å°è®¾ç½®ä¸ºä¸æ˜¾ç¤ºåœºæ™¯çš„çª—å£å¤§å°ç›¸åŒã€‚

```
function createRenderer() {
    var renderer = new THREE.WebGLRenderer({alpha: true});
    renderer.physicallyCorrectLights = true;
    renderer.gammaInput = true;
    renderer.gammaOutput = true;
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.bias = 0.0001;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    renderer.setSize($(window).width(), $(window).height());

    return renderer;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¾ç½®`OrbitControls`å®ä¾‹æ¥ç®¡ç†å›´ç»•åœºæ™¯çš„è‡ªåŠ¨æ—‹è½¬ã€‚æ‚¨å¯ä»¥è‡ªå®šä¹‰æ­¤åŠŸèƒ½
è®©ç”¨æˆ·é€šè¿‡é”®ç›˜æˆ–è§¦æ‘¸æ§åˆ¶(åœ¨æ‰‹æœºä¸Š)æ¥ç®¡ç†ç§»åŠ¨ğŸ“±).

```
function createOrbitsControls(camera, renderer) {
    var controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableZoom = false;
    controls.autoRotate = true;
    controls.enablePan = false;
    controls.keyPanSpeed = 7.0;
    controls.enableKeys = false;
    controls.target = new THREE.Vector3(0, 0, 0);
    controls.mouseButtons = {};
    controls.dispose();

    return controls;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¸²æŸ“å™¨æ·»åŠ åˆ°é¡µé¢çš„ DOM ä¸­(æˆ‘ä»¬å°†å®ƒé™„åŠ åˆ°æ­£æ–‡ä¸­)ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡å°†èƒŒæ™¯é¢œè‰²è®¾ç½®ä¸º indaco (0x303F9F)æ¥å¼€å§‹å®šåˆ¶åœºæ™¯
(è®°ä½:åœ¨ three.js ä¸­è®¾ç½®é¢œè‰²çš„æ¨èæ–¹å¼æ˜¯é€šè¿‡åå…­è¿›åˆ¶
å€¼)ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸»å…‰æºå’ŒåŠçƒå…‰æºã€‚

```
//Add rendering dom element to page.
document.body.appendChild(renderer.domElement);

//Setup scene.
scene.background = new THREE.Color(0x303F9F);
scene.add(createLight());
scene.add(createHemisphereLight()); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä½¿ç”¨`PointLight`ç±»åˆ›å»ºä¸»å…‰æºä½œä¸ºç‚¹å…‰æºã€‚åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†å…¶é¢œè‰²è®¾ç½®ä¸ºç™½è‰²ï¼Œ
å°†å…¶å¼ºåº¦è®¾ç½®ä¸º 1(é»˜è®¤)ï¼Œ20 ä¸ºè·ç¦»ç¯å…‰çš„è·ç¦»ï¼Œå…¶ä¸­å¼ºåº¦ä¸º 0ï¼Œæœ€åè¡°å‡ä¸º 2 (
è¿™æ˜¯ç¯å…‰æ²¿ç¯å…‰è·ç¦»å˜æš—çš„é‡ï¼Œå¯¹äºç‰©ç†åŸºç¡€ç¯å…‰ï¼Œå¿…é¡»å°†[è®¾ç½®ä¸º 2)ã€‚

ç„¶åï¼Œæˆ‘ä»¬å°†å®ƒçš„åŠŸç‡è®¾ç½®ä¸ºä¸ 100 ç“¦ç¯æ³¡ç›¸åŒ(](https://threejs.org/docs/index.html#api/lights/PointLight) [1700 æµæ˜](http://www.power-sure.com/lumens.htm) )
çš„å…‰ï¼Œå¹¶å°†å®ƒæ”¾ç½®åœ¨åœºæ™¯ä¸Šæ–¹ï¼Œä»¥åˆ›å»ºæŸç§è¡—ç¯æ•ˆæœ(æ¥è‡ªä¸Šæ–¹çš„å…‰æŸ)ã€‚æˆ‘ä»¬è¿˜é€šè¿‡å°†`castShadow`è®¾ç½®ä¸º true æ¥æ¿€æ´»
æŠ•å°„ç”Ÿæˆé˜´å½±çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å¼ºåˆ¶é˜´å½±è´´å›¾å¤§å°ä¸º 512x512 åƒç´ (ä¸ºäº†
æé«˜æ€§èƒ½ï¼Œå› ä¸ºé»˜è®¤å€¼æ˜¯ 1024 ),æˆ‘ä»¬é€šè¿‡å°†`radius`å±æ€§è®¾ç½®ä¸º 1.5 æ¥ç»™é˜´å½±ä¸€ç‚¹æ¨¡ç³Šã€‚
æˆ‘ä»¬è¿˜ä¸ºç¯å…‰åˆ›å»ºäº†ä¸€ä¸ªå‡ ä½•ä½“å’Œä¸€ä¸ªæè´¨:

*   å‡ ä½•ä½“æ˜¯åŠå¾„ä¸º 0 çš„çƒä½“
*   è¯¥ææ–™æ˜¯å®Œå…¨åŸºäºç‰©ç†çš„å‘å°„ææ–™

äº‹å®ä¸Šï¼Œ`MeshStandardMaterial`æ˜¯åŸºäºç‰©ç†çš„æè´¨çš„ three.js å®ç°(æ‰€ä»¥å®ƒæ˜¯çœŸå®çš„:three.js rocks ä¸
åŸºäºç‰©ç†çš„æ¸²æŸ“ğŸ˜®).

```
function createLight() {
    var lightGeometry = new THREE.SphereGeometry(0);

    var lightMaterial = new THREE.MeshStandardMaterial({
        emissive: 0xffffee,
        emissiveIntensity: 1,
        color: 0x000000
    });

    var light = new THREE.PointLight(0xffffff, 1, 20, 2);
    light.power = 1700;
    light.castShadow = true;
    light.shadow.mapSize.width = 512;
    light.shadow.mapSize.heigth = 512;
    light.shadow.radius = 1.5;

    light.add(new THREE.Mesh(lightGeometry, lightMaterial));
    light.position.set(0, 5, 3);

    return light;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹äºåŠçƒå…‰æºï¼Œæˆ‘ä»¬ä½¿ç”¨`HemisphereLight`ç±»æ¥åˆ›å»ºå®ƒã€‚
æˆ‘ä»¬è®¾ç½®å¤©ç©ºé¢œè‰²ä¸ºæ·±è“è‰²(0x303F9F)ï¼Œåœ°é¢é¢œè‰²ä¸ºé»‘è‰²(0x000000)ï¼Œå¼ºåº¦ä¸º 1ã€‚

```
function createHemisphereLight() {
    return new THREE.HemisphereLight(0x303F9F, 0x000000, 1);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹æ·»åŠ æ˜Ÿæ˜Ÿï¼Œå±‚ç½‘æ¨¡å‹å’Œåœ°æ¿ç½‘æ¨¡å‹ã€‚æ¯ä¸ªç½‘æ ¼æ¨¡å‹åœ¨å…¶åŠ è½½æ–¹æ³•ç»“æŸæ—¶è¢«æ·»åŠ åˆ°åœºæ™¯
ä¸­ã€‚

```
//Load models.
loadStars(textureLoader, function (stars) {
    scene.add(stars);
});

loadPlyModelUsingPhysicalMaterial(
    plyLoader,
    'assets/models/lucy.ply',
    {
        color: 0x3F51B5,
        roughness: 0.5,
        metalness: 0.7,
        clearCoat: 0.5,
        clearCoatRoughness: 0.5,
        reflectivity: 0.7
    },
    new THREE.Vector3(3, -3, 0),
    new THREE.Vector3(0, -Math.PI / 3.0, 0),
    function (mesh) {

        scene.add(mesh);
    }
);

loadPlyModelUsingPhysicalMaterial(
    plyLoader,
    'assets/models/dragon.ply',
    {
        color: 0x448AFF,
        roughness: 0.1,
        metalness: 0.9,
        clearCoat: 0.0,
        clearCoatRoughness: 0.2,
        reflectivity: 1
    },
    new THREE.Vector3(-3, -3, 0),
    new THREE.Vector3(0, -Math.PI, 0),
    function (mesh) {

        scene.add(mesh);
    }
);

loadPlyModelUsingPhysicalMaterial(
    plyLoader,
    'assets/models/bunny.ply',
    {
        color: 0xCCFFFF,
        roughness: 0.9,
        metalness: 0.1,
        clearCoat: 0.0,
        clearCoatRoughness: 0.5,
        reflectivity: 0.1
    },
    new THREE.Vector3(0, -3, 1.5),
    new THREE.Vector3(0, -Math.PI, 0),
    function (mesh) {

        scene.add(mesh);
    }
);

loadFloor(textureLoader, function (mesh) {
    scene.add(mesh);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹äºæ˜Ÿæ˜Ÿï¼Œæˆ‘ä»¬ä½¿ç”¨`textureLoader`æ¥åŠ è½½ä¸€ä¸ªåœ†å½¢ png çº¹ç†ã€‚å½“çº¹ç†åŠ è½½å®Œæˆåï¼Œæˆ‘ä»¬åˆ›å»ºäº†
è®¸å¤šä½ç½®éšæœºçš„`Geometry`å¯¹è±¡ã€‚æˆ‘ä»¬ä¹Ÿä½¿ç”¨ä»åŠ è½½å™¨è·å¾—çš„çº¹ç†åˆ›å»ºæè´¨(å¹¶ä¸”
æˆ‘ä»¬åœ¨å®ƒä¸Šé¢è®¾ç½®äº†ä¸€ä¸ªé€æ˜èƒŒæ™¯)ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‰¹å®šçš„ three.js ç±»åˆ›å»ºä¸€äº›`Points`å¯¹è±¡ã€‚

```
function loadStars(textureLoader, completeLoad) {
    textureLoader.load("assets/models/textures/circle.png", function (texture) {
        var starsGeometry = new THREE.Geometry();

        for (var i = 0; i < 10000; i++) {

            var star = new THREE.Vector3();
            star.x = 2000 * Math.random() - 1000;
            star.y = 2000 * Math.random();
            star.z = 2000 * Math.random() - 1000;

            starsGeometry.vertices.push(star)
        }

        var starsMaterial = new THREE.PointsMaterial({
            color: 0x888888,
            map: texture,
            transparent: true,
        });

        var stars = new THREE.Points(starsGeometry, starsMaterial);

        completeLoad(stars);
    });
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹äºæ¿å±‚æ¨¡å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¿å±‚åŠ è½½å™¨æ¥è·å¾—ç›¸åº”çš„å‡ ä½•å›¾å½¢ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨æ”¶åˆ°çš„å‚æ•°
åˆ›å»ºä¸€ä¸ª`MeshPhysicalMaterial`ã€‚æˆ‘ä»¬è¿˜è®¾ç½®ç½‘æ ¼çš„ä½ç½®å’Œæ—‹è½¬ï¼Œå¹¶ä½¿ç”¨`updateMatrix()`æ–¹æ³•å¼ºåˆ¶æ›´æ–°å±€éƒ¨å˜æ¢
ã€‚æˆ‘ä»¬è®¾ç½®`castShadow`ä¸ºçœŸï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨é˜´å½±è´´å›¾ä¸­è€ƒè™‘è¿™ä¸ªç½‘æ ¼ã€‚
æˆ‘ä»¬æœ€åè¿˜å°†`matrixAutoUpdate`è®¾ç½®ä¸º falseï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦é‡æ–°è®¡ç®—ç½‘æ ¼
åœ¨æ¯ä¸€å¸§ä¸Šçš„ä½ç½®(æˆ‘ä»¬çš„ç½‘æ ¼æ˜¯é™æ€çš„)ã€‚

```
function loadPlyModelUsingPhysicalMaterial(plyLoader, path, parameters, position, rotation, completeLoad) {
    plyLoader.load(path, function (geometry) {
        var material = new THREE.MeshPhysicalMaterial(parameters);
        var mesh = new THREE.Mesh(geometry, material);
        mesh.position.set(position.x, position.y, position.z);
        mesh.rotation.set(rotation.x, rotation.y, rotation.z);
        mesh.castShadow = true;
        mesh.matrixAutoUpdate = false;
        mesh.updateMatrix();

        completeLoad(mesh);
    });
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹äºåœ°æ¿ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨`textureLoader`æ¥åŠ è½½å¤§ç†çŸ³è¡¨é¢çš„çº¹ç†ã€‚ç„¶åæˆ‘ä»¬å°†`wrapS`å’Œ`wrapT`
å±æ€§è®¾ç½®ä¸º`RepeatWrapping`ï¼Œè®©çº¹ç†åœ¨æ•´ä¸ªè¡¨é¢ä¸Šé‡å¤ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`MeshStandardMaterial`ï¼Œ
ï¼Œå®ƒæ˜¯`MeshPhysicalMaterial`çš„åŸºç¡€æè´¨ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯ä¸€ä¸ªåŸºäºç‰©ç†çš„æè´¨ã€‚æˆ‘ä»¬æœ€åä¹Ÿåœ¨è¿™é‡Œè®¾ç½®
ä½ç½®ï¼Œæ—‹è½¬å’Œ`matrixAutoUpdate`ä¸ºå‡ã€‚

```
function loadFloor(textureLoader, completionFunction) {
    textureLoader.load("assets/models/textures/marble.jpg", function (texture) {
        texture.wrapS = THREE.RepeatWrapping;
        texture.wrapT = THREE.RepeatWrapping;
        texture.repeat.set(100, 100);

        var floorMat = new THREE.MeshStandardMaterial({
            roughness: 0.7,
            metalness: 0.1,
            map: texture
        });

        var floorGeometry = new THREE.PlaneGeometry(1000, 1000);
        var floorMesh = new THREE.Mesh(floorGeometry, floorMat);
        floorMesh.receiveShadow = true;
        floorMesh.rotation.x = -Math.PI / 2.0;
        floorMesh.position.y = -3;
        floorMesh.matrixAutoUpdate = false;
        floorMesh.updateMatrix();

        completionFunction(floorMesh);
    });
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å‡†å¤‡æ¸²æŸ“æˆ‘ä»¬çš„åœºæ™¯ã€‚æˆ‘ä»¬åªéœ€è¦ç”¨ä¸‹é¢çš„ä»£ç åˆ›å»º[æ¸²æŸ“å¾ªç¯](https://users.iit.uni-miskolc.hu/~mileff/graphics/GraphicsChapter5.pdf):

```
var render = function () {
    requestAnimationFrame(render);
    controls.update();
    renderer.render(scene, camera);
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ•´ä¸ªåœºæ™¯ä»£ç åœ¨[è¿™ä¸ª url](https://gist.github.com/chicio/af13397f22c21a05b6ac007c83f84403.js)

è€¶ï¼ï¼ï¼ä½ æˆåŠŸäº†ï¼ï¼æ‚¨å¯ä»¥ä½¿ç”¨ three.js åˆ›å»ºä¸€ä¸ª 3D è®¡ç®—æœºå›¾å½¢ web åº”ç”¨ç¨‹åºğŸ˜Šï¼ï¼è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ”¯æŒé«˜çº§åŠŸèƒ½çš„åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åŸºäºç‰©ç†çš„æ¸²æŸ“ğŸ˜®ï¼ï¼

[![i know three js](img/db86c4eb4374e1723a34192327db0602.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--O_KM-_UN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.fabrizioduroni.it/asseimg/posts/i-know-threejs.jpg)

ä½ ç°åœ¨çŸ¥é“ three.js äº†ã€‚ä½ å·²ç»å‡†å¤‡å¥½å¾æœç½‘ç»œ 3D ä¸–ç•Œäº†ğŸ˜ã€‚å•Šï¼ï¼æˆ‘å¿˜è®°äº†:ä½ å¯ä»¥åœ¨æˆ‘çš„ç½‘ç«™çš„[ä¸»é¡µä¸Šæ‰¾åˆ°æˆ‘ä»¬åˆ›å»ºçš„åœºæ™¯çš„ç°åœºæ¼”ç¤ºã€‚](https://www.fabrizioduroni.it/)

*åŸè½½äº[https://www . fabrizioduroni . it](https://www.fabrizioduroni.it/2017/05/13/first-threejs-scene.html)2017 å¹´ 5 æœˆ 13 æ—¥ã€‚*