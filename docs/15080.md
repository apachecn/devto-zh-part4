# è®¾ç½®æ‚¨è‡ªå·±çš„å›¾åƒè½¬æ¢æœåŠ¡

> åŸæ–‡:[https://dev . to/gaijinity/setting-up-your-own-image-transform-service-368k](https://dev.to/gaijinity/setting-up-your-own-image-transform-service-368k)

# [](#setting-up-your-own-image-transform-service)è®¾ç½®æ‚¨è‡ªå·±çš„å›¾åƒè½¬æ¢æœåŠ¡

### [](#cre%C2%ADate-optimized%E2%80%8Btransformed-images-for-pen%C2%ADnies-by-lever%C2%ADag%C2%ADing-the-pow%C2%ADer-of-aws-lamb%C2%ADda-to-cre%C2%ADate-your-own-server%C2%ADless-image-handler)é€šè¿‡åˆ©ç”¨ AWS Lamb da çš„å¼ºå¤§åŠŸèƒ½åˆ›å»ºæ‚¨è‡ªå·±çš„æ— æœåŠ¡å™¨å›¾åƒå¤„ç†ç¨‹åºï¼Œä¸º pen nies åˆ›å»ºä¼˜åŒ–/è½¬æ¢çš„å›¾åƒ

å®‰å¾·é²Â·éŸ¦å°”å¥‡

[![Image transforms serverless image handler](../Images/8b2029fbb85ae1e6bcf08cf383c062a6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--LNuwV-1---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x675_crop_center-center_82_line/image-transforms-serverless-image-handler.jpg)

å›¾åƒè½¬æ¢æ˜¯ç°ä»£ web å¼€å‘çš„ä¸€ä¸ªå¿…è¦éƒ¨åˆ†ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›å°†æœ€ä½³å¤§å°çš„å›¾åƒäº¤ä»˜ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚

æ— è®ºä½ ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç½‘ç«™è¿˜æ˜¯ä¸€ä¸ª [JAM stack](https://jamstack.org/) è®¾ç½®ï¼Œå›¾åƒæ“ä½œéƒ½æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚

å³ä½¿ä½ åœ¨ä½¿ç”¨ JS çš„ [Gats ä¹‹ç±»çš„ä¸œè¥¿ï¼Œè½¬æ¢å›¾åƒçš„å·¥ä½œä»ç„¶éœ€è¦å®Œæˆï¼Œå®ƒåªæ˜¯ç§»åŠ¨åˆ°æ„å»ºæ—¶é—´ã€‚æˆ‘ä»¬åªæ˜¯åœ¨æ”¹å˜å®Œæˆçš„åœ°æ–¹ã€‚](https://www.gatsbyjs.org/)

<aside>UnforÂ­tuÂ­nateÂ­ly, image transÂ­forms are also very procesÂ­sor intensive.</aside>

è®¸å¤š CMS å’Œå…¶ä»–æœåŠ¡å™¨ç«¯çš„åˆ†å¸ƒå¼æŠ€æœ¯éƒ½å†…ç½®äº†æ˜ åƒè½¬æ¢ã€‚ç„¶è€Œï¼Œè¿™åœ¨æœ¬è´¨ä¸Šæ„å‘³ç€æ‚¨åœ¨ä¸ºæ‚¨çš„ç½‘ç«™æä¾›æœåŠ¡çš„åŒä¸€å°æœåŠ¡å™¨ä¸Šè‡ªæ‰˜ç®¡å¤„ç†é«˜å¼ºåº¦çš„å›¾åƒä¼ è¾“ã€‚

å¦‚æœæ‚¨è¿˜æ²¡æœ‰é‡åˆ°è‡ªæ‰˜ç®¡å›¾åƒè½¬æ¢çš„é—®é¢˜ï¼Œè¯·æ”¾å¿ƒï¼Œæ‚¨æœ€ç»ˆä¼šé‡åˆ°çš„ã€‚

[![Image transforming optimization problems](../Images/05018405b63f0fd9cc0472d13e2f570b.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--QPbvHdB3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x675_crop_center-center_82_line/image-transforming-optimization-problems.jpg)

è¿™ä¸æ˜¯ä¸€ä¸ªæˆåŠŸçš„ç§˜è¯€ï¼Œå°±åƒä¸º mant äººæœåŠ¡ä¸€æ ·ã€‚æˆ‘è§è¿‡ä¸€äº› web æœåŠ¡å™¨åœ¨å›¾åƒè½¬æ¢ç¼“å­˜è¢«ç ´åæ—¶å´©æºƒï¼Œå› ä¸ºé‡æ–°åˆ›å»ºè½¬æ¢åçš„å›¾åƒéœ€è¦ CPU å¤„ç†èƒ½åŠ›ã€‚

æ­¤å¤–ï¼Œå¤§å¤šæ•°å†…ç½®å›¾åƒè½¬æ¢ç³»ç»Ÿä¸åŒ…æ‹¬å›¾åƒä¼˜åŒ–é˜¶æ®µã€‚

æœ‰å…³å›¾åƒä¼˜åŒ–çš„æ–¹æ³•å’ŒåŸå› çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æˆ‘åœ¨ Craft CMS æ–‡ç« ä¸­çš„[åˆ›å»ºä¼˜åŒ–å›¾åƒï¼Œæˆ– Addy Osmani çš„ composite](https://dev.to/gaijinity/creating-optimized-images-in-craft-cms-2hc5-temp-slug-2354251)[åŸºæœ¬å›¾åƒä¼˜åŒ–](https://images.guide/)æ–‡ç« ã€‚

<aside>â€œWe should all be automatÂ­ing our image comÂ­presÂ­sion.â€â€‰â€”â€‰Addy Osmani</aside>

å› ä¸ºå›¾åƒè½¬æ¢æ˜¯å¦‚æ­¤çš„è¿›ç¨‹å¯†é›†å‹ï¼Œåƒ [Imgix](https://www.imgix.com/) å’Œ [Cloud i nary](https://cloudinary.com/) è¿™æ ·çš„æœåŠ¡å…è®¸ä½ æŠŠå·¥ä½œå¸è½½åˆ°ä»–ä»¬çš„å¯æ‰©å±•æœåŠ¡å™¨ä¸Šã€‚è¿™ä¸¤ç§æœåŠ¡éƒ½å¾ˆå¥½ï¼Œä½†å®ƒä»¬ä¹Ÿè¦èŠ±é’±ï¼Œè€Œä¸”å¾€å¾€åšçš„æ¯”æˆ‘ä»¬å®é™…éœ€è¦çš„å¤šã€‚

## [](#enter-aws-server%C2%ADless-image-handler)è¿›å…¥ AWS Server less å›¾åƒå¤„ç†å™¨

Ama zon AWS å·²ç»æä¾›äº†ä¸€ä¸ª[æ— æœåŠ¡å™¨çš„å›¾åƒå¤„ç†ç¨‹åº](https://aws.amazon.com/solutions/serverless-image-handler/)ï¼Œå®ƒå…è®¸ä½ å»ºç«‹ä¸€ä¸ª AWS Lamb å‡½æ•°æ¥åˆ›å»ºä½ è‡ªå·±çš„ç§æœ‰çš„å°å›¾åƒä¼ è¾“æœåŠ¡ï¼Œå®ƒæ˜¯ä¾¿å®œçš„ï¼Œå¿«é€Ÿçš„ï¼Œå¹¶ä¸”æ˜¯ç”±[äº‘å‰ç«¯](https://aws.amazon.com/cloudfront/)å†…å®¹äº¤ä»˜ç½‘ç»œ(CDN)æä¾›çš„ã€‚

AWS Lamb da æ˜¯æ–°ä¸€æ³¢â€œæ— æœåŠ¡å™¨â€åŠŸèƒ½çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå…è®¸ä½ åœ¨äº‘ä¸­è¿è¡Œä»£ç ï¼Œè€Œæ— éœ€ç»´æŠ¤æœåŠ¡å™¨ã€‚å®ƒå¾ˆä¾¿å®œï¼Œè€Œä¸”ä¸å« sleï¼Œè¿™åœ¨æˆ‘çš„ä¹¦é‡Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚

ä¸‹é¢æ˜¯ AWS Lamb da pric ing çš„æ ·å­:

[![Aws lambda pricing](../Images/d536da870a63652db7cc429ba89cae41.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--MBthpzhz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x399_crop_center-center_100_line/aws-lambda-pricing.png)

å¯¹äºè®¸å¤šå°å‹ç½‘ç«™ï¼Œä½ å¯èƒ½æ°¸è¿œä¸ä¼šç¦»å¼€å…è´¹å±‚ã€‚

åœ¨å¼•æ“ç›–ä¸‹ï¼Œ[AWS Server less Image](https://aws.amazon.com/solutions/serverless-image-handler/)Han dler ä½¿ç”¨çš„æ˜¯ [Sharp JS](http://sharp.pixelplumbing.com/en/stable/) ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸º mant[lib VIPs](https://github.com/libvips/libvips)Image processing lib æ„å»ºçš„ [Node JS](https://nodejs.org/en/) pack ageã€‚ä»¥ä¸‹æ˜¯å®ƒçš„å¤§è‡´å¤–è§‚:

[![Aws lambda overview chart](../Images/70fb1b2ca3650e2a3ce1c45e4b02d21a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--9FDj9sBl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x600_crop_center-center_100_line/aws-lambda-overview-chart.png)

å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„[ä»£ç ï¼Œä½†æ˜¯å¥½çš„ä¸€é¢æ˜¯ä½ ä¸éœ€è¦è¿™ä¹ˆåšã€‚](https://github.com/awslabs/serverless-image-handler)

## [](#set%C2%ADting-up-an-aws-server%C2%ADless-image-handler)è®¾ç½®æ—  AWS æœåŠ¡å™¨çš„å›¾åƒå¤„ç†ç¨‹åº

æ‰€æœ‰è¿™äº›æœ€æœ‰ä»·å€¼çš„éƒ¨åˆ†æ˜¯ï¼Œæ‚¨å¯ä»¥è®¾ç½®è‡ªå·±çš„ AWS Lamb å‡½æ•°ï¼Œè€Œä¸å¿…æ·±å…¥äº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

ä½ å°†éœ€è¦ä¸€äº› AWS çš„å°ç»éªŒï¼Œä¹Ÿè®¸å½“ä½ åƒåŠ›åœ°é€šè¿‡ AWS ç”¨æˆ·ç•Œé¢/UX æ—¶éœ€è¦ä¸€äº›èˆ’ç¼“çš„éŸ³ä¹ï¼Œä½†ä»…æ­¤è€Œå·²ï¼

<aside>This is a point & click no-code solution ğŸ‰</aside>

è¿™æ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºä½ å¯ä»¥é€šè¿‡ [AWS Cloud For ma tion](https://aws.amazon.com/cloudformation/) æ—‹è½¬ä½ çš„æœåŠ¡ï¼Œå®ƒä½¿ç”¨é¢„åˆ¶æ¨¡æ¿æ¥åˆ›å»ºä¸€ä¸ªåŒ…å«ä½ çš„è®¾ç½®çš„å †æ ˆã€‚è¿™æ„å‘³ç€åœ¨æœåŠ¡å™¨ç«¯ç‚¹å‡»è®¾ç½®æ‰€æœ‰ä¸œè¥¿æ˜¯éå¸¸é‡è¦çš„:

*   ä½ éœ€è¦æœ‰ä¸€ä¸ª Ama zon AWS è´¦æˆ·ï¼›å¦‚æœä½ æ²¡æœ‰ï¼Œå°±å»ä¹°ä¸€ä¸ª
*   è½¬åˆ°[æ— æœåŠ¡å™¨å›¾åƒå¤„ç†ç¨‹åº](https://aws.amazon.com/solutions/serverless-image-handler/)é¡µé¢ï¼Œç‚¹å‡»**åœ¨ AWS æ§åˆ¶å°ä¸­å¯åŠ¨è§£å†³æ–¹æ¡ˆ** **ï¼Œç„¶åå®Œæˆæ¨¡æ¿è®¾ç½®:

[![Launch in management console](../Images/c07df32eab782aee32ddabbbf531f1c6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--wgPRz5yr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_768x685_crop_center-center_100_line/launch-in-management-console.png)

**1ã€‚è§„æ ¼è´¢æ”¿æ¨¡æ¿**

ä½ ä¸éœ€è¦æ”¹å˜è¿™é‡Œçš„ä»»ä½•ä¸œè¥¿ï¼Œé™¤éä½ æƒ³ä½¿ç”¨ä½ è‡ªå·±å®šåˆ¶çš„æ¨¡æ¿ã€‚ç‚¹å‡»**ä¸‹ä¸€æ­¥**ç»§ç»­ã€‚

[![Step 1 specify a template](../Images/dac4497b2ec2a73d5cec96cf13f50452.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--KOs3GedZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x777_crop_center-center_100_line/step-1-specify-a-template.png)

**2ã€‚è§„æ ¼ä¿¡æ¯å †æ ˆè¯¦ç»†ä¿¡æ¯**

è¿™é‡Œå¯èƒ½æœ‰ä¸€äº›æ‚¨å¯ä»¥é€‰æ‹©æ›´æ”¹çš„å†…å®¹(ä¸è¦æ‹…å¿ƒï¼Œæ‚¨ç¨åä¹Ÿå¯ä»¥è¿”å›å¹¶æ›´æ”¹è¿™äº›å†…å®¹):

*   **CORS é€‰é¡¹**â€”â€”å¦‚æœæ‚¨æƒ³å¯ç”¨ [CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œé…ç½®
*   **å›¾åƒæ¥æº** â€”æ‚¨éœ€è¦åˆ—å‡ºæ— æœåŠ¡å™¨å›¾åƒå¤„ç†ç¨‹åºå¯ä»¥è®¿é—®çš„ [AWS S3 Buck ets](https://aws.amazon.com/s3/)
*   æ¼”ç¤ºç”¨æˆ·ç•Œé¢(Demo UI)â€”è¿™å°†å¯¼è‡´å®ƒè®¾ç½®ä¸€ä¸ªæ¼”ç¤ºç”¨æˆ·ç•Œé¢ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æµ‹è¯•æ‚¨çš„ APIã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªé€‰æ‹©ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºå½“ä½ å¼€å§‹çš„æ—¶å€™ä¼šå¾ˆæœ‰ç”¨ã€‚æ‚¨å¯ä»¥ç¨ååˆ é™¤æ¼”ç¤ºèµ„æº

ç‚¹å‡»**ä¸‹ä¸€æ­¥**ç»§ç»­ã€‚

[![Step 2 specify stack details](../Images/4a55ed384306b0e20c2d51b29c7f7aa0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--dBR3MIRD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x972_crop_center-center_100_line/step-2-specify-stack-details.png)

**3ã€‚å›¾æ ‡ URE å †æ ˆç»†èŠ‚**

ä½ ä¸éœ€è¦åœ¨è¿™é‡Œåšä»»ä½•æ”¹å˜ï¼Œé™¤éä½ æœ‰ä¸€ä¸ªæ›´å¤æ‚çš„ AWS è®¾ç½®åœ¨ä½ çš„æƒé™å’Œé‡Œå¡æ–¹é¢ã€‚ç‚¹å‡»**ä¸‹ä¸€æ­¥**ç»§ç»­ã€‚

[![Step 3 configure stack options](../Images/3d235a69088022bd5ed8c318eb0ec0dd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--SwsVxdtV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x1024_crop_center-center_100_line/step-3-configure-stack-options.png)

**4ã€‚å›é¡¾**

è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆéœ€è¦æ”¹å˜çš„ï¼Œä½ å¯ä»¥çœ‹åˆ°ä½ å°†è¦åˆ›å»ºçš„å†…å®¹çš„æ¦‚è¿°ã€‚åœ¨å‹¾é€‰äº†**æˆ‘ç¡®è®¤ AWS äº‘ç®¡ç†å¯èƒ½ä½¿ç”¨å®¢æˆ·åç§°**å¤é€‰æ¡†åï¼Œå•å‡»**ä¸‹ä¸€æ­¥**ç»§ç»­ã€‚

[![Step 4 review](../Images/8effafe143b02922ee0aa79e148d2b57.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--vMxZHeVC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x332_crop_center-center_100_line/step-4-review.png)

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜ï¼Œè¯·ä½¿ç”¨[æ— æœåŠ¡å™¨æ˜ åƒå¤„ç†ç¨‹åºéƒ¨ç½²æŒ‡å—](https://docs.aws.amazon.com/solutions/latest/serverless-image-handler/welcome.html)ä½œä¸ºä½³èƒ½æ ¡å‡†æºã€‚

## [](#using-an-aws-server%C2%ADless-image-handler)ä½¿ç”¨ AWS æ— æœåŠ¡å™¨å›¾åƒå¤„ç†å™¨

ç°åœ¨æ‚¨å·²ç»å¯åŠ¨äº†æ‚¨çš„æœåŠ¡ï¼Œå‡è®¾æ‚¨ä¹Ÿè®¾ç½®äº†æ¼”ç¤ºç”¨æˆ·ç•Œé¢ï¼Œæ‚¨å°†è®¾ç½®ä»¥ä¸‹äº‘å‰ç«¯è¯Šæ–­:

[![Cloudfront distributions](../Images/575b40fce8ddd443f989fc18843995d7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--U8zT6Hzj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x252_crop_center-center_100_line/cloudfront-distributions.png)

*   **å›¾åƒå¤„ç†ç¨‹åºåˆ†é…** â€”è¿™æ˜¯æ‚¨çš„æ— æœåŠ¡å™¨å›¾åƒå¤„ç†ç¨‹åºåˆ†é…ï¼Œæ‚¨å°†ä»æ‚¨çš„å‰ç«¯ä»£ç è®¿é—®å®ƒï¼Œä»¥è·å¾—æ‚¨çš„ä¼˜åŒ–ã€è½¬æ¢å›¾åƒ
*   **ç½‘ç«™è®¨è®ºè§£å†³æ–¹æ¡ˆ** â€”è¿™æ˜¯ç”±æ¼”ç¤ºç”¨æˆ·ç•Œé¢åˆ›å»ºçš„è®¨è®ºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒ

è™½ç„¶å¦‚æœä½ åˆ›å»ºäº†æ¼”ç¤ºç”¨æˆ·ç•Œé¢ï¼Œè¿™å°†ä¸ºä½ åˆ›å»ºä¸€ä¸ª S3 å·¥å…·ç®±ï¼Œä½†æ˜¯ä½ å®é™…çš„ç½‘ç«™/ webapp æ‰€éœ€çš„ä»»ä½• S3 å·¥å…·ç®±éƒ½ç”±ä½ è‡ªå·±æ¥åˆ›å»ºã€‚

è¯·ç¡®ä¿æ‚¨éšåå°†å®ƒä»¬æ·»åŠ åˆ°æ‚¨çš„[äº‘ç®¡ç†å †æ ˆ](https://console.aws.amazon.com/cloudformation)ã€‚å…¸å‹åœ°ï¼Œä½ çš„ S3 æ¡¶åº”è¯¥æ˜¯å®Œå…¨ç§æœ‰çš„ï¼Œå¹¶ä¸”ä½ è®¾ç½®äº†äº‘é”‹åˆ†å¸ƒä½œä¸ºé€šå‘ S3 æ¡¶çš„å¤§é—¨ã€‚

**ä¸“å®¶æç¤º:**ä½ ä¸ä¼šçœŸçš„æƒ³æä¾›åƒ S3 é’±åŒ…é‡Œçš„å›¾ç‰‡è¿™æ ·çš„å›ºå®šèµ„äº§ï¼Œå®ƒæ˜¯ç”¨æ¥å­˜å‚¨çš„ï¼Œè€Œä¸æ˜¯ç”¨æ¥ä¼ æ’­çš„ã€‚åœ¨ S3 ä¸Šä½¿ç”¨ CDN åˆ†å¸ƒå±‚ï¼Œä¾‹å¦‚ CloudFrontã€‚

**ä¸“ä¸šæç¤º:**å¦‚æœæ‚¨åœ¨ AWS ä¸­æ²¡æœ‰çœ‹åˆ°æ‚¨çŸ¥é“å·²ç»å‡çº§çš„ç‰¹å®šç±»ä¼¼æœåŠ¡ï¼Œè¯·ç¡®ä¿æ‚¨å¤„äºæ­£ç¡®çš„åŒºåŸŸã€‚

å¦‚æœæ‚¨å°† URL å¤åˆ¶åˆ°æ¼”ç¤º UI **ç½‘ç«™è§£å†³æ–¹æ¡ˆè®¨è®º**ï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªå¯ä»¥ç©è€çš„åœºåœ°:

[![Serverless image handler demo](../Images/e4ed3c671be03a39c9dd4a729ec0d15e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--o7syOKZl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x865_crop_center-center_100_line/serverless-image-handler-demo.png)

æ‰€ä»¥å…³äº API æœ‰è¶£çš„äº‹æƒ…æ˜¯ä½ éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ª JSON blob é€‰é¡¹:

```
 {
  "bucket": "images.nystudio107",
  "key": "Octagon-Titlarks-House-02.jpg",
  "edits": {
    "resize": {
      "width": 500,
      "height": 300,
      "fit": "cover"
    },
    "grayscale": true,
    "flip": true
  }
} 
```

ä»¥ä¸‹æ˜¯ JSON ä¸­é‡è¦çš„é¡¶çº§é”®:

*   è¿™æ˜¯æºå›¾åƒæ‰€åœ¨çš„ S3 å·´å…‹ et çš„ id
*   `key` â€”è¿™æ˜¯ S3 å­˜å‚¨æ¡¶ä¸­æºå›¾åƒçš„è·¯å¾„
*   `edits`â€”[Sharp JS API](http://sharp.pixelplumbing.com/en/stable/api-resize/)çš„ JSON è®¤è¯ç‰ˆæœ¬ï¼ŒåŒ…å«æ‚¨æƒ³è¦åº”ç”¨åˆ°å›¾åƒçš„æ›´æ”¹

ç„¶ååœ¨ä½ ä½¿ç”¨çš„ä»»ä½•ç¨‹åºæ˜å…°è¯­è¨€ä¸­ï¼Œä½ åªè¦æŠŠ JSON è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶å base64 ç¼–ç æˆä¸€ä¸ª URL:

```
 https://d3dvp96ru4zk60.cloudfront.net/eyJidWNrZXQiOiJpbWFnZXMubnlzdHVkaW8xMDciLCJrZXkiOiJPY3RhZ29uLVRpdGxhcmtzLUhvdXNlLTAyLmpwZyIsImVkaXRzIjp7InJlc2l6ZSI6eyJ3aWR0aCI6NTAwLCJoZWlnaHQiOjMwMCwiZml0IjoiY292ZXIifSwiZ3JheXNjYWxlIjp0cnVlLCJmbGlwIjp0cnVlfX0= 
```

åœ¨ä½ çš„æ¼”ç¤ºç”¨æˆ·ç•Œé¢ S3Â·å·´å…‹ç­‰äººåˆ›å»ºçš„`scripts.js`ä¸­æœ‰ä¸€ä¸ªå¦‚ä½•é€šè¿‡ JavaScript å®ç°è¿™ä¸€ç‚¹çš„ä¾‹å­ã€‚ç”¨å…¶ä»–è¯­è¨€åšè¿™ä»¶äº‹éƒ½å¾ˆç®€å•ã€‚

æ‰€æœ‰åœ¨ [Sharp JS](http://sharp.pixelplumbing.com/en/stable/api-resize/) API ä¸­å®ç°çš„é€‰é¡¹å¯¹ä½ éƒ½æ˜¯å¯ç”¨çš„ï¼åœ¨ Sharp JS ä¸­é€šå¸¸ä¸ä¼šè¢«é“¾æ¥çš„æ‰€æœ‰è½¬æ¢é€‰é¡¹éƒ½åœ¨ JSON for mat ä¸­çš„`edits`é”®ä¸­ã€‚

æ‚¨å¯ä»¥è°ƒæ•´å¤§å°ã€è£å‰ªã€æ—‹è½¬ã€ç€è‰²ã€é”åŒ–ä»¥åŠä¸€ç³»åˆ—å…¶ä»–å›¾åƒæ“ä½œï¼ŒåŒ…æ‹¬åœ¨`jpeg`ã€`webp`ã€`png`å’Œ`tiff`ç­‰åœ°å«ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚

å¦‚æœæ‚¨éœ€è¦ï¼Œæ‚¨å¯ä»¥å®Œå…¨æ§åˆ¶ç¡®åˆ‡çš„ç¼–ç æ–¹æ³•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å›¾åƒéƒ½é’ˆå¯¹å¤§å°è¿›è¡Œäº†ä¼˜åŒ–ã€‚

## [](#craft-cms-server%C2%ADless-image-handler)Craft CMS æœåŠ¡å™¨å°‘å›¾åƒå¤„ç†ç¨‹åº

è¿™é‡Œæè¿°çš„è§£å†³æ–¹æ¡ˆé€‚ç”¨äºæ‚¨å¯èƒ½ä½¿ç”¨çš„ä»»ä½•å‰ç«¯/åç«¯è®¾ç½®ã€‚

ç„¶è€Œï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯[Craft CMS](https://craftcms.com/),[Ima geo mize](https://nystudio107.com/plugins/imageoptimize)plug in å…è®¸ä½ å°†ç«™ç‚¹èŒƒå›´å†…ä½¿ç”¨çš„è½¬æ¢æ–¹æ³•åˆ‡æ¢åˆ°å°¤å°”æƒ³è¦çš„ï¼Œä»å†…ç½®çš„ Craft å›¾åƒè½¬æ¢åˆ° Imgix å›¾åƒè½¬æ¢ã€‚

ç‰ˆæœ¬ 1.6.0 å¢åŠ äº†ä¸€ç§å¿«é€Ÿå˜æ¢æ–¹æ³•ï¼Œå¯ç”¨äºä¸Šè¿°è®¾ç½®:

[![Image optimize plugin sharp demo](../Images/29082879f9b1d7612e22a550933e68d2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Cwc0pA1J--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x953_crop_center-center_100_line/image-optimize-plugin-sharp-demo.png)

å®ƒçš„å¥½å¤„æ˜¯ä½ å¯ä»¥è½¬æ¢åˆ°ä½¿ç”¨å·®åˆ†è½¬æ¢æ–¹æ³•ï¼Œè€Œä¸éœ€è¦æ”¹å˜æ¨¡æ¿ã€‚

## [](#wrap%C2%ADping-up)åŒ… ping èµ·æ¥ï¼

è¿™å°±æ˜¯åˆ›å»ºä½ è‡ªå·±çš„ AWS æ— æœåŠ¡å™¨æ˜ åƒåŒ…æ‰€éœ€è¦çš„ä¸€åˆ‡ï¼åœ¨ä¸ªäºº/æ¼”ç¤ºç½‘ç«™ä¸Šå°è¯•ä¸€ä¸‹ï¼Œè·å¾—å¦‚ä½•è®¾ç½®çš„ä¿¡å¿ƒï¼Œç„¶åå°±å¯ä»¥èµ°äº†ã€‚

ä¸æœåŠ¡ç›¸æ¯”ï¼Œå®ƒç¡®å®éå¸¸ä¾¿å®œ:

[![Aws lambda bill](../Images/505de123b2d3f73d4183fd2c9cdb6cda.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--RPPKP-8C--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x968_crop_center-center_100_line/aws-lambda-bill.png)

æ˜¯çš„ï¼Œä½ å°†ä¸å¾—ä¸è´¹åŠ›åœ°é€šè¿‡ä¸€ç‚¹ä¸å¥½ç©çš„ AWS UX/UIï¼Œå¹¶å­¦ä¹ ä¸€ç‚¹å…³äº AWS çš„é”™è¯¯â€¦ä½†æˆ‘è®¤ä¸ºè¿™ç»å¯¹å€¼å¾—åŠªåŠ›ã€‚

æ— è®ºæ‚¨ä½¿ç”¨çš„æ˜¯æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆã€JAM stack è§£å†³æ–¹æ¡ˆï¼Œè¿˜æ˜¯ Gats by ä¹‹ç±»çš„è§£å†³æ–¹æ¡ˆï¼Œæ‚¨éƒ½ä¼šé€‚åº”ã€‚æ— è®ºåœ¨å“ªé‡Œè¿›è¡Œå›¾åƒè½¬æ¢å·¥ä½œï¼Œä¸€ä¸ªæ— æœåŠ¡å™¨çš„å›¾åƒå¤„ç†å™¨éƒ½å°†åŠ é€Ÿè¿™ä¸€è¿‡ç¨‹ã€‚

[![Aws lambda setup worth it](../Images/cd054a4ac8bcfbf39910e29fddb71ecf.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--fQluytqP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://nystudio107-ems2qegf7x6qiqq.netdna-ssl.com/img/blog/_1200x675_crop_center-center_82_line/aws-lambda-setup-worth-it.jpg)

æ‚¨ä¸ä»…èƒ½å¤Ÿå°† CPU å¯†é›†å‹æ˜ åƒä¼˜åŒ–/è½¬æ¢å¸è½½åˆ°æ‚¨çš„ AWS Lamb å‡½æ•°ä¸­ï¼Œè€Œä¸”å¾ˆå¯èƒ½è¿˜å¯ä»¥ç¼©å‡æ‚¨çš„æœåŠ¡å™¨(å‡è®¾æ‚¨æœ‰ä¸€ä¸ªæœåŠ¡å™¨)ã€‚

æ­¤å¤–ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå­¦åˆ°ä¸€äº› AWSï¼Œè¿™å¯¹æˆ‘ä»¬çš„ä¸šåŠ¡æ¥è¯´æ˜¯ä¸€ä»¶å¥½äº‹ã€‚

ç¥ä½ è½¬å‹æˆåŠŸï¼

## [](#further-reading)è¿›ä¸€æ­¥é˜…è¯»

å¦‚æœä½ æƒ³è·å¾—æ–°æ–‡ç« çš„é€šçŸ¥ï¼Œè¯·åœ¨ Twitter ä¸Šå…³æ³¨[çº½çº¦æ—¶æŠ¥ 107](https://twitter.com/nystudio107) ã€‚

ç‰ˆæƒæ‰€æœ‰ 2020 nystudio107ã€‚ç”± nystudio107 è®¾è®¡