# ä»‹ç» Gweather -ä¸€ä¸ªå¸¦æœ‰ gif çš„å¾®å‹å¤©æ°”åº”ç”¨ç¨‹åºï¼

> åŸæ–‡ï¼š<https://dev.to/theworstdev/introducing-gweather-a-micro-weather-app-with-gifs-5704>

[![Alt Text](img/b18de76c9d236bac5a79a3ab7505eedd.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--19YHogfx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/s4ad3yoczy7wpcc1goz7.jpg)

**éƒ¨ç½²å®Œæ•´çš„åº”ç”¨ç¨‹åºï¼Œä¸ºæ‚¨æä¾›æ—¶å°šçš„å®æ—¶å¤©æ°”æ›´æ–°ã€‚**

æˆ‘æ”¶åˆ°äº†å¾ˆå¤šåé¦ˆï¼Œè¯´æˆ‘ä¹‹å‰æ„å»ºçš„åº”ç”¨ç¨‹åºç¤ºä¾‹å¯¹äºå­¦ä¹  AWS Amplify éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†å¦‚ä½•å°†æ‰€æœ‰éƒ¨åˆ†ç»„åˆåœ¨ä¸€èµ·ä»¥åˆ¶ä½œä¸€ä¸ªå®é™…çš„åº”ç”¨ç¨‹åºã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘å†³å®šå±•ç¤ºä¸€ä¸‹ Amplify çš„ä¸€ä¸ªæˆ‘æœ€å–œæ¬¢çš„ç‰¹æ€§ï¼Œå®ƒæ”¯æŒå¸¦æœ‰æ— æœåŠ¡å™¨åŠŸèƒ½çš„ GraphQL è§£æå™¨ã€‚è¿™å…è®¸ä½ ä½¿ç”¨ä»»ä½•ä¸œè¥¿ä½œä¸ºæ•°æ®æºï¼Œè¿™æ˜¯ä¸€ä¸ªå¦‚æ­¤å¼ºå¤§çš„ç‰¹æ€§ï¼

## å®ƒæœ‰ä»€ä¹ˆä½œç”¨

Gweather æ˜¯ä¸€æ¬¾å¾®å‹å¤©æ°”åº”ç”¨ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½:

*   ğŸŒä½¿ç”¨åœ°ç†å®šä½è·å–å¤©æ°”æ•°æ®
*   â›ˆå¾®å¤©æ°”æ›´æ–°
*   ğŸŒ ä¸å¤©æ°”ç›¸å…³çš„å›¾ç‰‡
*   ğŸ‘®â€è®¤è¯
*   ğŸ”¥æ— æœåŠ¡å™¨åç«¯
*   ğŸš€GraphQL
*   ğŸ’»åœ¨å‡ åˆ†é’Ÿå†…éƒ¨ç½²åç«¯

## å·¥ä½œåŸç†

åº”ç”¨ç¨‹åºçš„ä»£ç ä½äº[è¿™é‡Œ](https://github.com/kkemple/gweather)ã€‚

è¿™ä¸ªé¡¹ç›®ä½¿ç”¨ AWS AppSync æ¥æä¾›ä¸€ä¸ªæ— æœåŠ¡å™¨çš„ GraphQL apiï¼Œå®ƒç”±ä¸€ä¸ªè·å–å¤©æ°”å’Œ gif æ•°æ®çš„æ— æœåŠ¡å™¨å‡½æ•°æ”¯æŒã€‚

åœ¨é¡¹ç›®ä¸­ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°ä¸€ä¸ªåä¸º`amplify`çš„æ–‡ä»¶å¤¹ã€‚è¯¥æ–‡ä»¶å¤¹åŒ…å«åº”ç”¨ç¨‹åºçš„åç«¯ï¼Œå¯ä»¥åœ¨ä»»ä½•äººçš„å¸æˆ·ä¸­é‡æ–°éƒ¨ç½²ã€‚åœ¨`amplify`æ–‡ä»¶å¤¹ä¸­ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ª`backend`æ–‡ä»¶å¤¹ã€‚åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°ä¸‰ä¸ªä¸»è¦åŠŸèƒ½çš„é…ç½®:

*   è®¤è¯æœåŠ¡(ç”± Amazon Cognito æä¾›æ”¯æŒ)
*   GraphQL API(ä½¿ç”¨ AWS AppSync æ„å»º)
*   å‡½æ•°(ç”¨ AWS Lambda æ„å»º)

åœ¨`backend/api`æ–‡ä»¶å¤¹ä¸­ï¼Œä½ ä¼šçœ‹åˆ° GraphQL API é…ç½®ä»¥åŠåŸºæœ¬çš„ [GraphQL æ¨¡å¼](https://github.com/kkemple/gweather/blob/master/amplify/backend/api/gweatherapp/schema.graphql)ã€‚

è¿™æ˜¯åŸºæœ¬çš„ GraphQL æ¨¡å¼ã€‚æ‚¨å°†çœ‹åˆ°åŸºç¡€æ¨¡å¼å¦‚ä¸‹æ‰€ç¤º:

```
type  Query  {  weather(lat:  Float!,  lon:  Float!):  Weather  @function(name:  "getweather-${env}")  }  type  Weather  {  timezone:  String  current:  WeatherSummary!  hourly:  WeatherSummary!  weekly:  WeatherSummary!  icon:  String!  temperature:  Int!  feelsLike:  Int!  gif:  String!  }  type  WeatherSummary  {  summary:  String!  icon:  String!  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ ä»¥å‰ä»æœªä½¿ç”¨è¿‡ Amplifyï¼Œä½ å¯èƒ½ä¸çŸ¥é“`@function`æŒ‡ä»¤ã€‚è¿™æ˜¯ Amplify CLI çš„ [GraphQL è½¬æ¢](https://aws-amplify.github.io/docs/cli-toolchain/graphql)åº“çš„ä¸€éƒ¨åˆ†ã€‚

**@ function**â€”â€”ç”¨è¿™ä¸ªæŒ‡ä»¤ä¿®é¥°ä»»ä½•å­—æ®µï¼Œä½¿ç”¨æ— æœåŠ¡å™¨å‡½æ•°ä½œä¸º AppSync è§£æå™¨ã€‚

## éƒ¨ç½² App

ä¸ºäº†è¿è¡Œè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œä½ éœ€è¦ä¸º [Giphy API](https://developers.giphy.com/) å’Œ[é»‘æš—å¤©ç©º API](https://darksky.net/dev) æä¾›ä¸€ä¸ª API å¯†åŒ™ã€‚ä¸¤è€…éƒ½æœ‰ä¸€ä¸ªå…è´¹è®¡åˆ’ï¼Œè¿è¡Œè¿™ä¸ªåº”ç”¨ç¨‹åºåº”è¯¥ç»°ç»°æœ‰ä½™ã€‚

### éƒ¨ç½²åç«¯ï¼Œè¿è¡Œ app

1.  å…‹éš†å­˜å‚¨åº“å¹¶å®‰è£…ä¾èµ–é¡¹

```
~ git clone https://github.com/kkemple/qweather.git
~ cd gweather
~ npm install 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

1.  ä½¿ç”¨`amplify/backend/function/getweather/src/index.js`ä¸­çš„é»‘æš—å¤©ç©º API å’Œ Giphy API å¯†é’¥æ›´æ–°æ— æœåŠ¡å™¨åŠŸèƒ½

```
const buildDarkSkyUrl = (lat, lon) =>
  `https://api.darksky.net/forecast/[key]/${lat},${lon}`;

const buildGiphyUrl = tag =>
  encodeURI(
    `https://api.giphy.com/v1/gifs/random?api_key=[key]S&tag=${tag}&rating=G`
  ); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

1.  åˆå§‹åŒ–æ”¾å¤§é¡¹ç›®

```
~ amplify init
? Enter a name for the environment: dev (or whatever you would like to call this env)
? Choose your default editor: <YOUR_EDITOR_OF_CHOICE>
? Do you want to use an AWS profile? Y 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

1.  æ¨¡æ‹Ÿåç«¯ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºæ­£å¸¸å·¥ä½œ

```
amplify mock 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

1.  å¯åŠ¨åº”ç”¨ç¨‹åº

```
~ expo start 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

1.  æ¨é€åˆ° AWS

```
~ amplify push
? Are you sure you want to continue? Y
? Do you want to generate code for your newly created GraphQL API? N
> We already have the GraphQL code generated for this project, so generating it here is not necessary. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## å®šåˆ¶ GraphQL æ¨¡å¼

æ­¤æ¨¡å¼å¯ä»¥ç¼–è¾‘ã€‚å¦‚æœéœ€è¦é¢å¤–çš„å­—æ®µæˆ–åŸºæœ¬ç±»å‹ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥æ›´æ–°åç«¯:

æ›´æ–°æ¨¡å¼(ä½äº amplify/back end/API/gweather app/schema . graph QL)ã€‚

é‡æ–°éƒ¨ç½²åç«¯

```
amplify push 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> åº”ç”¨ç¨‹åºä¸­æœ‰ä¸€ä¸ªè®¾ç½®é¡µé¢ï¼Œä¸€ä¸ªæœ‰è¶£çš„æŒ‘æˆ˜æ˜¯å…è®¸ç”¨æˆ·å­˜å‚¨ä½ç½®ï¼Œå¹¶ä¸ºé¢„æµ‹è®¾ç½®ä¸€ä¸ªï¼

å¦‚æœæ‚¨æˆ–æ‚¨è®¤è¯†çš„ä»»ä½•äººéœ€è¦å¸®åŠ©æ¥å¯åŠ¨å’Œè¿è¡Œæ­¤åº”ç”¨ç¨‹åºï¼Œè¯·é€šè¿‡ [Twitter](https://twitter.com/kurtiskemple) è”ç³»æˆ‘ï¼Œæˆ‘å¾ˆä¹æ„æä¾›å¸®åŠ©ï¼