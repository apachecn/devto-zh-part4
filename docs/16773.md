# Rakkit:ç”¨ TypeScript å’Œ decorators åˆ›å»ºæ‚¨çš„ GraphQL å’Œ REST APIsï¼

> åŸæ–‡:[https://dev . to/Owen/rak kit-create-your-graphql-and-rest-APIs-with-typescript-and-decorator-cnj](https://dev.to/owen/rakkit-create-your-graphql-and-rest-apis-with-typescript-and-decorators-cnj)

å“‡ï¼Œåˆä¸€ä¸ªæ–°æ¡†æ¶ï¼ŒçœŸçš„...ï¼ŸğŸ˜…

# [](#so-we-can-have-a-little-history-before)æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸€ç‚¹ä»¥å‰çš„å†å²ğŸ“œ

åœ¨ç”¨çº¯ JavaScript å¼€å‘äº†è®¸å¤š API å¹¶å…±åŒç»´æŠ¤å®ƒä»¬ä¹‹åã€‚æˆ‘å†³å®šä¸ºæˆ‘æœªæ¥çš„é¡¹ç›®å›é¡¾æˆ‘çš„åšäº‹æ–¹å¼ï¼Œè¿™æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œå› ä¸ºåœ¨æˆ‘çš„å…¬å¸ï¼Œæˆ‘ä»¬å†³å®šåˆ›å»ºä¸€ä¸ªæ— å¤´ CMSï¼Œå…è®¸åœ¨é€‰æ‹©æ‰€ä½¿ç”¨çš„ API([graph QL](https://graphql.org/learn/)æˆ– REST)ä¸Šæœ‰å¾ˆå¤§çš„è‡ªç”±ï¼Œå¹¶æŒ‰ç…§ç±»ä¼¼äº [strapi.io](//strapi.io) çš„åŸåˆ™è¿è¡Œã€‚
è¿™ä¸ªé¡¹ç›®æœ‰å‡ ä¸ªé™åˆ¶:å¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åº(ä»£ç )å‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»èƒ½å¤Ÿéå¸¸ç§¯æåœ°åº”å¯¹ï¼Œèƒ½å¤Ÿä¸ºæˆ‘ä»¬çš„å®¢æˆ·è½»æ¾åœ°æ·»åŠ åŠŸèƒ½ï¼Œå°½å¯èƒ½å°‘åœ°ä¾èµ–å¤–éƒ¨æ¨¡å—ï¼Œæœ€é‡è¦çš„æ˜¯æ‹¥æœ‰ç›¸å¯¹å¹²å‡€çš„ä»£ç å¹¶ä¿æŒæœ€å¤§é™åº¦çš„å¹²ç‡¥ã€‚
å› æ­¤ï¼Œç»è¿‡ä¸€äº›ç ”ç©¶å’Œå†³ç­–åï¼Œæˆ‘ä»¬å¼€å§‹å¼€å‘ä¸€ä¸ªæ¡†æ¶ï¼Œä½œä¸º CMS çš„åŸºç¡€ï¼Œå®ƒå…è®¸æˆ‘ä»¬åˆ›å»º REST å’Œ GraphQL APIs(è¿™ä¸¤ç§ç±»å‹çš„ API å¯ä»¥å…±äº«ç›¸åŒä¸­é—´ä»¶çš„ä½¿ç”¨),ä»¥ä½¿ç”¨ websockets åˆ›å»ºåº”ç”¨ç¨‹åºï¼Œå¹¶è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚

# [](#rakkit-packages)Rakkit åŒ…ğŸ“¦

Rakkit å…è®¸ä½ åˆ›å»ºä¸€ä¸ªæœ‰å¾ˆå¤šç‰¹æ€§çš„åç«¯ï¼Œä¸‹é¢æ˜¯å®ƒä»¬çš„åˆ—è¡¨:

*   [GraphQL API](https://rakkit.dev/graphql/start/introduction.html)
*   [REST API](https://rakkit.dev/rest/router.html)
*   [è·¯ç”±(GraphQL å’Œ REST çš„ä¸­é—´ä»¶)](https://rakkit.dev/rest/middlewares.html)
*   [Websocket åº”ç”¨](https://rakkit.dev/ws/introduction.html)
*   [ä¾èµ–æ³¨å…¥](https://rakkit.dev/di/introduction.html)

# [](#nodemodules-phobia)èŠ‚ç‚¹ _ æ¨¡å—ææƒ§ç—‡ğŸ˜«

æˆ‘ä»¬éƒ½çŸ¥é“è¿™ä¸ªè‘—åçš„æ–‡ä»¶ï¼Œå®ƒå¯ä»¥ç´¯ç§¯å¾ˆå¤šä¾èµ–é¡¹...æˆ‘ä»¬ç»å¯¹å¸Œæœ›é¿å…è¿™ç§æƒ…å†µï¼Œå³ä½¿è¿™æ„å‘³ç€æˆ‘ä»¬è‡ªå·±é‡æ–°å¼€å‘ä¾èµ–é¡¹ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›æ¨¡å—æ¥ä½¿æ‰€æœ‰è¿™äº›å·¥ä½œï¼ä»¥ä¸‹æ˜¯ Rakkit é’ˆå¯¹æ¯ç§åŒ…è£…çš„é…æ–¹:

*   **graph QL API:**[graph QL](https://www.npmjs.com/package/graphql)ï¼Œ [graphql-subscription](https://www.npmjs.com/package/graphql-subscriptions)
*   **REST API:** [koa](https://koajs.com/) , [koa-router](https://www.npmjs.com/package/koa-router) , [koa-compose](https://www.npmjs.com/package/koa-compose)
*   **Websocket åº”ç”¨:** [socket.io](//socket.io)

æœ‰ä¸€äº›ä¾èµ–çš„å¥½å¤„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä»¥ koa ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¤¾åŒºä¸º koa åˆ¶ä½œçš„æ¨¡å—ï¼Œä»¥ä¾¿åœ¨ Rakkit ä¸­ä½¿ç”¨å®ƒä»¬ï¼ä½ å¯ä»¥å°† Rakkit ä¸å¦ä¸€ä¸ªä¾èµ–é¡¹å¹¶è¡Œä½¿ç”¨ï¼Œä¾‹å¦‚ [TypeORM](//typeorm.io) ï¼

# [](#where)å“ªé‡Œï¼ŸğŸ“

ç„¶åé¡¹ç›®åœ¨ GitHub [è¿™é‡Œ](https://github.com/raccoonch/rakkit)å¯è®¿é—®ï¼Œæ–‡æ¡£åœ¨[é‚£é‡Œ](https://rakkit.dev)ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å®‰è£…åœ¨ [npm](https://www.npmjs.com/package/rakkit) ä¸Šã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å¸®åŠ©æ‚¨ï¼Œåªéœ€å‘å¸ƒä¸€ä¸ª[é—®é¢˜](https://github.com/RaccoonCH/Rakkit/issues)ã€‚
(GitHub ä¸Šçš„ä¸€é¢—å°æ˜Ÿæ˜Ÿæ¿€åŠ±ç€æˆ‘ä»¬ç»§ç»­æœç€è¿™ä¸ªæ–¹å‘å‰è¿›ï¼).

# [](#okay-but-what-does-it-look-like)å¥½å§ï¼Œä½†æ˜¯é•¿ä»€ä¹ˆæ ·ï¼ŸğŸ§

æ‰€ä»¥ï¼Œå®ƒæœ€ç»ˆéœ€è¦ä¸€äº›åŸºç¡€çŸ¥è¯†æ¥ç†è§£å…¶ä½™çš„ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ æ£€æŸ¥ä¸€ä¸‹ TypeScriptï¼Œå¯èƒ½è¿˜æœ‰ decoratorsã€‚
*è¿™äº›åªæ˜¯éå¸¸ç®€å•çš„ä¾‹å­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½æ˜¾ç¤ºå‡ºæ¥äº†...*

## [](#rest-api-%F0%9F%9B%A3)ä¼‘æ¯ API ğŸ›£

REST åŒ…åœ¨å†…éƒ¨ä½¿ç”¨ koaï¼Œæˆ‘ä»¬å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸­é—´ä»¶çš„æ–¹å¼ä»¥åŠä¸€èˆ¬è¡Œä¸ºéƒ½ä¸ [koa](//koajs.com) ç›¸åŒã€‚

```
import { Router, Get, Post, IContext, NextFunction } from "rakkit";
// Middlewares that are used for REST and GraphQL
import { Auth, SayHello } from "./middlewares.ts";
import { users } from "./users.ts";

@Router("user")
@UseMiddleware(Auth)
export class UserRouter {
  @Get("/")
  getAll(context: IContext) {
    // To return a result, assign the context.body value
    // Please refer to koa documentation for more informations...
    context.body = users;
  }

  @Get("/:id")
  @UseMiddleware(SayHello)
  async getOne(context: IContext, next: NextFunction) {
    // Omit variables checks here, for clarity
    const { id } = context.params; // JS destructuring
    const foundUser = users.find((usr) => usr.id === id);
    context.body = foundUser;
    await next();
  }

  @Post("/")
  addUser(context: IContext) {
    // Use koa-bodyparser to parse the body into an object (Rakkit documentation)
    const user = context.request.body
    users.push(user);
    context.body = user;
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## web socketğŸ”

è¿™å¾ˆç®€å•ï¼Œåªæœ‰ä¸¤ä¸ªè£…ä¿®å·¥ï¼

```
import { Websocket, On, Socket } from "rakkit";

@Websocket()
export class UserWS {
  @On("connection")
  onConnection(socket: Socket) {
    // Please refer to the socket.io documentation
    socket.emit("welcome", "welcome !");
  }

  @On("message")
  onMessage(socket: Socket, message: string) {
    socket.server.emit("new:message", message);
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#graphql-api)GraphQL APIğŸ”¥

GraphQL æ˜¯ä¸€ä¸ªå·¨å¤§çš„åŒ…ï¼Œè¿™åªæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹å®ƒæ˜¯ä»€ä¹ˆæ ·å­ï¼Œæ‰€ä»¥è¯·å‚è€ƒ [Rakkit æ–‡æ¡£](https://rakkit.dev)ä»¥è·å¾—æ›´å¤šä¿¡æ¯ã€‚

```
import { ObjectType, Field } from "rakkit";

@ObjectType({ description: "Object representing an user" })
export class UserObjectType {
  @Field()
  id: string;

  @Field()
  email: string;

  @Field()
  username: string;

  @Field()
  activated: boolean;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨å¯ä»¥è¿™æ ·å®šä¹‰æ‚¨çš„æŸ¥è¯¢/å˜å¼‚/è®¢é˜…:

```
import { Resolver, Query, IContext, NextFunction } from "rakkit";
// Middlewares that are used for REST and GraphQL
import { Auth, SayHello } from "./middlewares.ts";
import { users } from "./users.ts";

@Resolver()
@UseMiddleware(Auth)
export class UserResolver {
  // Precise the type, TS cannot resolve the return type when it's an array (Please refer to Rakkit the documentation)
  @Query(returns => UserObjectType)
  users(): UserObjectType[] {
    return users;
  }

  @Query()
  @UseMiddleware(SayHello)
  async user(
    @Arg("id")
    id: string,
    context: IContext,
    next: NextFunction
  ): UserObjectType? {
    return users.find((usr) => usr.id === id);
    await next(); // Go the the middleware function
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒå°†å®ƒç¼–è¯‘æˆä¸€ä¸ª GraphQL æ¨¡å¼(ä½ å¯ä»¥åœ¨ä½ æœ€å–œæ¬¢çš„æœåŠ¡å™¨å®ç°ä¸­ä½¿ç”¨å®ƒï¼Œæ¯”å¦‚ [Apollo](https://www.apollographql.com/) æˆ–è€… [graphql-yoga](https://github.com/prisma/graphql-yoga) )ã€‚åœ¨ SDLï¼Œçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
"""Object  representing  an  user"""  type  UserObjectType  {  id:  String!  email:  String!  username:  String!  activated:  Bollean!  }  type  Query  {  users:  [UserObjectType]  user(id:  String!):  UserObjectType  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#dependency-injection)ä¾èµ–æ³¨å…¥ğŸ¤¯

å¦‚æœä½ ä»æœªå¬è¯´è¿‡è¿™ä¸ªæ¦‚å¿µï¼Œå®ƒå¯èƒ½çœ‹èµ·æ¥å¾ˆæŠ½è±¡ï¼Œå°¤å…¶æ˜¯åœ¨ [Angular](https://angular.io/guide/dependency-injection) ä¸­ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ äº‹å…ˆå»äº†è§£ä¸€ä¸‹ï¼Œä»¥ä¾¿èƒ½å¤Ÿç†è§£(æ›´å¤šä¿¡æ¯[åœ¨æ­¤](https://rakkit.dev/di/introduction.html))ã€‚

```
import { Service, Inject } from "rakkit";

@Service()
export class CronService {
  start() {
    // ...
  }
}

@Service()
export class UserService {
  @Inject()
  private cronService: CronService;

  constructor() {
    this.cronService.start();
    // ...
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#more-advanced-examples-are-available-here-and-more-will-come-in-the-near-future)æ›´å¤šé«˜çº§ç¤ºä¾‹å¯ç”¨[æ­¤å¤„](https://github.com/RaccoonCH/Rakkit/tree/master/examples)æ›´å¤šå°†åœ¨ä¸ä¹…çš„å°†æ¥æ¨å‡ºï¼ğŸ˜‰

ç§å•Šï¼æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼ğŸ‘‹