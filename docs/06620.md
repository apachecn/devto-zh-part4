# ä½¿ç”¨ React ä½œä¸º Wordpress ä¸»é¢˜

> åŸæ–‡:[https://dev . to/technola aji/using-react-as-a-WordPress-theme-4 Dao](https://dev.to/technolaaji/using-react-as-a-wordpress-theme-4dao)

ä¸ä¹…å‰ï¼Œæˆ‘æˆä¸ºäº† wpBeirut (Wordpress Beirut)çš„è”åˆç»„ç»‡è€…ï¼Œè¿™æ˜¯ä¸€ä¸ªè‡´åŠ›äºé»å·´å«©è´é²ç‰¹ Wordpress å¼€å‘è€…çš„ç¤¾åŒºã€‚

æˆ‘ä»ç¤¾åŒºä¸­æ„è¯†åˆ°çš„ä¸€ä»¶äº‹æ˜¯ï¼Œå¤§å¤šæ•°äººä¾èµ–æ’ä»¶åœ¨å‰ç«¯æ·»åŠ ä¸€äº›ä¸œè¥¿æˆ–æ·»åŠ åŠŸèƒ½ï¼Œå¦‚ç«™ç‚¹æ„å»ºå™¨æ’ä»¶(Elementor å’Œ wpBakery)

æœ‰äº›äººä¼šå»ä¹°ä¸€ä¸ªé¢„åˆ¶å¥½çš„ä¸»é¢˜å¹¶ä½¿ç”¨å®ƒï¼Œå› ä¸ºå¯¹ä»–ä»¬æ¥è¯´ï¼Œé¦–å…ˆç¼–å†™ php ä»£ç æ²¡é‚£ä¹ˆéº»çƒ¦

åœ¨å¯¹ç¤¾åŒºåšäº†ä¸€ä¸ªå°è°ƒæŸ¥åï¼Œå¤§å¤šæ•°äººéµå¾ªè¿™ç§æ¨¡å¼æœ‰å‡ ä¸ªåŸå› :

*   ä¸€ä¸ªä¸­ç­‰é¢„ç®—çš„å°å‹è‡ªç”±é¡¹ç›®ï¼Œæ‰€ä»¥åªéœ€å®‰è£…ä¸€äº›æ’ä»¶é¢„åˆ¶çš„ä¸»é¢˜
*   ä¸çŸ¥é“å¦‚ä½•å†™ php ä»£ç (ç”¨å¦ä¸€ç§è¯­è¨€å†™)æˆ–è€…æ ¹æœ¬ä¸çŸ¥é“å¦‚ä½•ç¼–ç (å®Œå…¨æ­£å¸¸ï¼Œå› ä¸º wordpress å¯ä»¥è¢«éæŠ€æœ¯äººå‘˜ä½¿ç”¨)
*   å–œæ¬¢ç”¨æœ€æ–°çš„æŠ€æœ¯(React/Angular/Vue)ç¼–å†™å‰ç«¯ï¼Œä¸å–œæ¬¢çº¯ç²¹ç”¨ php å’Œä¸€äº› jquery ç¼–å†™å‰ç«¯

å³ä½¿æ˜¯æˆ‘è‡ªå·±ï¼Œæˆ‘ä¹Ÿä¸å–œæ¬¢ç”¨ php ç¼–å†™å‰ç«¯ï¼Œä¸æ˜¯å› ä¸ºæˆ‘è®¨åŒ php æˆ–ä»»ä½•ä¸œè¥¿ï¼Œè€Œæ˜¯æˆ‘è§‰å¾—ç”¨ React æ›´èˆ’æœã€æ›´å¿«

Gutenberg(ä¸€ä¸ª wordpress æ’ä»¶ï¼Œä½¿ç”¨ React ä½¿ wordpress çš„å‰ç«¯å˜å¾—æ›´ç°ä»£ï¼Œæ›´å®¹æ˜“ä½¿ç”¨)å¯¹æˆ‘æ¥è¯´ä¸åˆ’ç®—

å³ä½¿ä½ å»äº†å¤è…¾å ¡å¹¶ä¸”åˆ›å»ºäº†å‡ ä¸ªåŒºå—ï¼Œä½ ä»ç„¶ä¼šè¢« wordpress çš„å‰ç«¯æ‰€å›°

# [](#so-it-is-time-to-use-wordpress-as-a-headless-cms)æ‰€ä»¥æ˜¯æ—¶å€™æŠŠ wordpress å½“æˆä¸€ä¸ªæ— å¤´ CMS äº†

å½“æˆ‘ä»¬è°ˆè®ºä½¿ç”¨ wordpress ä½œä¸ºä¸€ä¸ªæ— å¤´ CMS æ—¶ï¼Œç†æƒ³æƒ…å†µä¸‹æˆ‘ä»¬å¿½ç•¥äº† wordpress çš„å‰ç«¯ï¼Œåªä¾èµ–äº wordpress æ”¯æŒçš„ REST api

wordpress æœ€é…·çš„éƒ¨åˆ†æ˜¯ç¼–å†™æ‰§è¡Œ REST åŠ¨ä½œçš„å‡½æ•°éå¸¸ç®€å•

è¿™é‡Œæœ‰ä¸€ä¸ªé€šè¿‡å‘é€æ—§çš„å’Œæ–°çš„ç”µå­é‚®ä»¶åœ°å€æ¥æ”¹å˜ä¸€ä¸ªäººçš„ç”µå­é‚®ä»¶åœ°å€çš„ä¾‹å­

```
add_action('rest_api_init', function () {
  register_rest_route( 'changemyemailman/v1', 'changedatmail',array(
                'methods'  => 'POST',
                'callback' => 'changeme'
      ));
});

function changeme (WP_REST_Request $request) {
    $oldmail = $request['old_mail'];
    $user = get_user_by( 'email', $oldmail );
$userId = $user->ID;
    $args = array(
    'ID'         => $userId,
    'user_email' => $request['new_mail']
);
wp_update_user( $args );
} 
```

åªéœ€å‘é€ä¸€ä¸ª api è°ƒç”¨åˆ°/changemyemailman/v1/changedatemailï¼Œå…¶ä¸­æ­£æ–‡åŒ…å«:

```
{
   "old_email": "john@doe.com",
   "new_email": "john1@doe.com"
} 
```

(æˆ‘ä¸¾è¿™ä¸ªä¾‹å­æ˜¯ä¸ºäº†å±•ç¤ºåœ¨ wordpress ä¸Šåˆ›å»ºä¸€ä¸ªç«¯ç‚¹æ˜¯å¤šä¹ˆå®¹æ˜“ï¼Œä½†æ˜¯ä¸Šé¢çš„ä¾‹å­ç»å¯¹æ˜¯ä¸€ä¸ªå®‰å…¨å™©æ¢¦ï¼Œå› ä¸ºå¦‚æœä½ çŸ¥é“åŸå§‹çš„ç”µå­é‚®ä»¶å’Œç«¯ç‚¹ï¼Œä½ å¯ä»¥æ”¹å˜ä»»ä½•äººçš„ç”µå­é‚®ä»¶åœ°å€ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°æŠŠç®¡ç†å‘˜çš„ç”µå­é‚®ä»¶æ”¹æˆä½ çš„ï¼Œå¹¶å®Œå…¨æ§åˆ¶ç½‘ç«™)

# [](#say-hello-to-cors)å‘ CORS é—®å¥½ï¼

å½“ä½ å¼€å§‹ä½¿ç”¨ wordpress ä½œä¸ºä¸€ä¸ªæ— å¤´ CMS æ—¶ï¼Œä½ ä¼šå¼€å§‹çœ‹åˆ°è¿™ä¸ªè¡—åŒºçš„æ–°æˆå‘˜

ä»–ä»¬å«ä»– CORSï¼Œæœ‰æ—¶ä»–å¯èƒ½æ˜¯ä¸ªé¡½ç«¥ï¼Œä½†å¤§å¤šæ•°æ—¶å€™ä»–éƒ½åœ¨å°½åŠ›å¸®å¿™

ç®€è€Œè¨€ä¹‹:CORS(è·¨æ¥æºèµ„æºå…±äº«)ä¸»è¦ç”¨äºå½“æ‚¨è¯·æ±‚çš„æ•°æ®ä¸æ˜¯æ¥è‡ªåŒä¸€ä¸ªæ¥æºæ—¶

åœ¨ CORS æ ‡å‡†åŒ–ä¹‹å‰ï¼Œå‡ºäºå®‰å…¨åŸå› ï¼Œæ— æ³•åœ¨ä¸åŒçš„åŸŸä¸‹è°ƒç”¨ API ç«¯ç‚¹ã€‚è¿™æ›¾ç»(åœ¨æŸç§ç¨‹åº¦ä¸Šç°åœ¨ä»ç„¶)è¢«åŒæºæ”¿ç­–æ‰€é˜»æ­¢ã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œäº†è§£æ›´å¤šä¿¡æ¯[https://www.codecademy.com/articles/what-is-cors](https://www.codecademy.com/articles/what-is-cors)

# [](#say-again-about-cors)å†è¯´è¯´ CORSï¼ŸğŸ¤”

CORS æ˜¯ä¸€ç§æœºåˆ¶ï¼Œæ—¨åœ¨å…è®¸ä»£è¡¨æ‚¨å‘å‡ºçš„è¯·æ±‚ï¼ŒåŒæ—¶é˜»æ­¢æµæ°“ JS å‘å‡ºçš„ä¸€äº›è¯·æ±‚ï¼Œå¹¶ä¸”åœ¨æ‚¨å‘ä»¥ä¸‹å¯¹è±¡å‘å‡º HTTP è¯·æ±‚æ—¶è§¦å‘:

*   ä¸€ä¸ªä¸åŒçš„åŸŸ(ä¾‹å¦‚ï¼Œä½äº example.com çš„ç«™ç‚¹ç§°ä¸º api.com)
*   ä¸€ä¸ªä¸åŒçš„å­åŸŸ(å¦‚åœ¨ example.com çš„ç½‘ç«™ç§°ä¸º api.example.com)
*   ä¸åŒçš„æ¸¯å£(å¦‚ä½äº example.com çš„æ¸¯å£ç§°ä¸º example.com:3001)
*   ä¸åŒçš„åè®®(ä¾‹å¦‚ä½äº https://example.com[çš„ç«™ç‚¹](https://example.com)å‘¼å« http://example.com çš„

è¿™ç§æœºåˆ¶å¯ä»¥é˜²æ­¢æ”»å‡»è€…åœ¨å„ç§ç½‘ç«™ä¸Šæ¤å…¥è„šæœ¬(ä¾‹å¦‚ï¼Œåœ¨é€šè¿‡è°·æ­Œå¹¿å‘Šæ˜¾ç¤ºçš„å¹¿å‘Šä¸­)ï¼Œå¯¹[www.yourbank.com](http://www.yourbank.com)è¿›è¡Œ AJAX è°ƒç”¨ï¼Œä»¥é˜²ä½ ä½¿ç”¨*çš„*å‡­è¯ç™»å½•è¿›è¡Œäº¤æ˜“ã€‚

å¦‚æœæœåŠ¡å™¨æ²¡æœ‰ç”¨ç‰¹å®šçš„å¤´æ¥å“åº”â€œç®€å•çš„â€GET æˆ– POST è¯·æ±‚ï¼Œå®ƒä»ç„¶ä¼šå‘é€ï¼Œä»ç„¶ä¼šæ¥æ”¶æ•°æ®ï¼Œä½†æ˜¯æµè§ˆå™¨ä¸å…è®¸ JavaScript è®¿é—®å“åº”ã€‚

å¦‚æœæ‚¨çš„æµè§ˆå™¨å°è¯•å‘å‡ºâ€œéç®€å•â€è¯·æ±‚(ä¾‹å¦‚ï¼ŒåŒ…å« cookies çš„è¯·æ±‚ï¼Œæˆ–è€…å†…å®¹ç±»å‹ä¸æ˜¯ application/x-ww-form-urlencodedã€multipart/form-data æˆ– text-plain çš„è¯·æ±‚)ï¼Œå°†ä¼šä½¿ç”¨ä¸€ç§ç§°ä¸º preflight çš„æœºåˆ¶ï¼Œå¹¶ä¸”ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª OPTIONS è¯·æ±‚ã€‚

â€œéç®€å•â€è¯·æ±‚çš„ä¸€ä¸ªå¸¸è§ç¤ºä¾‹æ˜¯æ·»åŠ  cookies æˆ–è‡ªå®šä¹‰æ ‡é¢˜â€”å¦‚æœæ‚¨çš„æµè§ˆå™¨å‘é€äº†è¿™æ ·çš„è¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨æ²¡æœ‰æ­£ç¡®å“åº”ï¼Œåˆ™åªä¼šè¿›è¡Œé¢„æ£€è°ƒç”¨(æ²¡æœ‰é¢å¤–çš„æ ‡é¢˜)ï¼Œè€Œä¸ä¼šå‘é€æµè§ˆå™¨æƒ³è¦å‘å‡ºçš„å®é™… HTTP è¯·æ±‚ã€‚

# [](#the-solution-use-react-in-the-same-origin-as-wordpress)è§£å†³æ–¹æ³•:ä½¿ç”¨ä¸ Wordpress ç›¸åŒåŸç‚¹çš„ Reactï¼ğŸ‰

æ¯å½“æˆ‘å’Œä»»ä½•ä¸€ä¸ª wordpress å¼€å‘è€…è°ˆè®ºè¿™ä¸ªè¯é¢˜æ—¶ï¼Œä»–/å¥¹éƒ½ä¼šé¢ä¸´ç†è§£è¿™ä¸ªç‰¹å®šéƒ¨åˆ†çš„å›°éš¾

æ€ä¹ˆèƒ½åœ¨å’Œ wordpress ä¸€æ ·çš„åŸç‚¹ä½¿ç”¨ Reactï¼ŸğŸ¤”

ç®€å•çš„éƒ¨åˆ†æ˜¯å»æ‰é»˜è®¤çš„ wordpress å‰ç«¯ï¼Œä½¿ç”¨ Reactï¼Œå¯¹å—ï¼Ÿ

å¯¹ï¼ä½†å›°éš¾çš„æ˜¯:æˆ‘ä»¬å¦‚ä½•æ‰èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼ŸğŸ¤”

å—¯ï¼Œæœ‰äººéå¸¸å¥½ï¼Œåˆ›å»ºäº†ä¸€ä¸ª create-react-app é£æ ¼çš„ cli å·¥å…·ï¼Œå°† react ç”¨ä½œ wordpress ä¸»é¢˜

[https://www.npmjs.com/package/create-react-wptheme](https://www.npmjs.com/package/create-react-wptheme)

å®ƒåšåˆ°äº†å®ƒæ‰€è¯´çš„:ä½¿ç”¨ React ä½œä¸º wordpress çš„ä¸»é¢˜ï¼ŒåŒæ—¶ç»™ä½ â€œåˆ›å»º-ååº”-åº”ç”¨â€çš„æ„Ÿè§‰

# [](#cool-but-how-can-we-use-it)çˆ½ï¼ä½†æ˜¯æ€ä¹ˆç”¨å‘¢ï¼ŸğŸ¤”

éå¸¸ç®€å•ï¼Œè¿›å…¥ä½ çš„ä¸»é¢˜æ–‡ä»¶å¤¹(åœ¨ä½ çš„ wp-content æ–‡ä»¶å¤¹ä¸­)å¹¶åœ¨ä½ çš„ç»ˆç«¯ä¸­è¾“å…¥è¿™ä¸ªå‘½ä»¤

```
npx create-react-wptheme [name of your project] 
```

ç±»ä¼¼äº CRA å®‰è£…åŒ…ï¼Œä½†æœ‰ä¸€ä¸ªå°çš„è®¾ç½®ä½ åº”è¯¥å…ˆåš

å¦‚æœä½ è¿›å…¥ wordpress çš„ä¸»é¢˜éƒ¨åˆ†ï¼Œä½ ä¼šå‘ç°å®ƒè¢«æ ‡è®°ä¸ºæŸåå’Œä¸¢å¤±çš„ css æ–‡ä»¶

[![missing-css](../Images/8d015a9174c2d35451096175c15ef7bd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--iKRlZrNf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/dff7fjl6ttku1hepeasi.png)

åœ¨æ‚¨çš„ç»ˆç«¯ä¸­ï¼Œè¾“å…¥é¡¹ç›®(æˆ‘çš„é¡¹ç›®åä¸º react-test ),ç„¶åè¿›å…¥ react-src æ–‡ä»¶å¤¹

ç„¶åå†™:

```
yarn start 
```

æ‚¨å°†åœ¨ç»ˆç«¯ä¸Šæ”¶åˆ°è¿™æ¡æ¶ˆæ¯

[![Alt Text](../Images/a0d2a7a6eb1f404f099b6406bf509d6d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--4KWjturx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/k1mtgmndy1a5kdbag8ol.png)

æ‰€ä»¥å»ä½ çš„ä¸»é¢˜éƒ¨åˆ†ï¼Œä½ ä¼šçœ‹åˆ°ä½ çš„ååº”ä¸»é¢˜

[![Alt Text](../Images/cbbfed5e407e49f5ced8d438bf949998.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--TXWIiXhG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/x7e5it2prk9dehvwe2z5.png)

ç‚¹å‡»å®æ—¶é¢„è§ˆï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªâ€œç«‹å³é‡å¯èŠ‚ç‚¹è§‚å¯Ÿå™¨â€çš„æ¶ˆæ¯

[![Alt Text](../Images/dc4a4c631130efcc10278d32ce0f42a0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xrmypCEQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hgfr1ghqgfs2xbh1ekzd.png)

å¯åŠ¨æœåŠ¡å™¨å°±è¡Œäº†ï¼

```
yarn start 
```

[![Alt Text](../Images/694b40e867bb52613900e1008ea52619.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--baL_Oz_E--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9jij0eil2xfrhnk0cvqq.png)

tada ğŸ‰

ä½ çš„ç»ˆç«¯ä¼šæœ‰ä¸€ä¸ªå®æ—¶çš„é‡æ–°åŠ è½½å™¨ï¼Œæ‰€ä»¥ä½ åšçš„ä»»ä½•æ”¹å˜ï¼Œéƒ½ä¼šåƒåˆ›å»º-ååº”-åº”ç”¨ç¨‹åºä¸€æ ·åˆ·æ–°ç»™è§‚å¯Ÿè€…ã€‚

[![Alt Text](../Images/8fb12e9651e702e3b95a1bc4e5535c7f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zjRSWcRj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kdwzaciaid28owlyfvg9.png)

æŒ‰ä¸‹â€œæ¿€æ´»å¹¶å‘å¸ƒâ€æŒ‰é’®ï¼Œå®ƒå°†æˆä¸ºä½ çš„ wordpress ç«™ç‚¹çš„ä¸»é¢˜

[![Alt Text](../Images/59992f0af03447620d9bf8d7450feefe.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--RVQP7uM4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/3r64tzqsi7tvz354cvca.png)

éƒ½åœ¨ 8888 ç«¯å£ä¸‹ï¼æœ€é…·çš„æ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ wordpress æä¾›çš„ REST apiï¼Œè€Œä¸ä¼šè¢« CORS é˜»æ­¢ï¼

æ‰€ä»¥å¦‚æœä½ å·²ç»æœ‰äº† wordpress ç½‘ç«™ï¼Œä½†æ˜¯ä½ éœ€è¦åˆ·æ–°å‰ç«¯ï¼Œè¯•è¯•å§ï¼

æˆ–è€…å¦‚æœä½ çŸ¥é“ React å¹¶ä¸”æƒ³ä½¿ç”¨ wordpress è¿™æ ·çš„ CMSï¼Œé‚£ä¹ˆå¤©ç©ºå°±æ˜¯æé™ï¼

æœ‰è¶£çš„äº‹å®:ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ é€‰æ‹©çš„ React åº“ï¼Œå°±åƒä½ æ­£åœ¨ä½¿ç”¨ CRAï¼Œä½†å®ƒæ˜¯åœ¨ wordpress ä¸Š

æˆ‘åœ¨è¿™ç§è®¾ç½®ä¸­æ‰€åšçš„æ˜¯:åˆ›å»ºè‡ªå®šä¹‰å¸–å­ç±»å‹å¹¶åœ¨å…¶ä¸Šæ”¾ç½®è‡ªå®šä¹‰å­—æ®µï¼Œç„¶åè°ƒç”¨è¿™äº›è‡ªå®šä¹‰å¸–å­å¹¶åœ¨ React åº”ç”¨ç¨‹åºä¸­æ˜¾ç¤ºæ¥è‡ªè‡ªå®šä¹‰å­—æ®µçš„æ•°æ®ï¼

å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼è¯·åœ¨è¯„è®ºåŒºå‘Šè¯‰æˆ‘ä½ çš„æƒ³æ³•