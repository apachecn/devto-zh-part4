# ç”¨ Flutter æ¢ç´¢ GraphQL

> åŸæ–‡:[https://dev . to/æº¶è´¨å®éªŒå®¤/exploring-graph QL-with-flutter-4 MDP](https://dev.to/solutelabs/exploring-graphql-with-flutter-4mdp)

åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œè®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹ç”¨ Flutter å®ç° GraphQL çš„å„ç§æ–¹æ³•

## [](#first-of-all-whats-this-graphql)é¦–å…ˆï¼Œè¿™ä¸ª GraphQL æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šæ·±å…¥è®¨è®º GraphQL çš„æ¦‚å¿µï¼Œä½†è¿™é‡Œæœ‰ä¸€ä¸ªæ¥è‡ªå®˜æ–¹æ–‡æ¡£çš„ç®€çŸ­æè¿°

GraphQL æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§ç”¨ç°æœ‰æ•°æ®å®Œæˆè¿™äº›æŸ¥è¯¢çš„è¿è¡Œæ—¶è¯­è¨€ã€‚GraphQL ä¸º API ä¸­çš„æ•°æ®æä¾›äº†å®Œæ•´ä¸”æ˜“äºç†è§£çš„æè¿°ï¼Œä½¿å®¢æˆ·èƒ½å¤Ÿå‡†ç¡®åœ°è¦æ±‚ä»–ä»¬éœ€è¦çš„ä¸œè¥¿ï¼Œä½¿ API æ›´å®¹æ˜“éšæ—¶é—´å‘å±•ï¼Œå¹¶æ”¯æŒå¼ºå¤§çš„å¼€å‘å·¥å…·ã€‚

GraphQL æ˜¯ç”±è„¸ä¹¦çš„æŠ€æœ¯å›¢é˜Ÿå¼€å‘çš„ï¼Œç°åœ¨æ˜¯å¼€æºçš„ï¼Œè¿™æ˜¯ä¸€ç§åœ¨åº”ç”¨ç¨‹åºä¸­å®ç° API çš„ä¸åŒæ–¹å¼ã€‚*è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ç”¨ Flutter å®ç°è¿™ä¸ª*

## æˆ‘å°†å¦‚ä½•åœ¨ Flutter ä¸Šå¤„ç†è¿™ä¸ªé—®é¢˜ï¼Ÿ

è™½ç„¶æ‚¨å¯ä»¥ä½¿ç”¨æ™®é€šçš„ HTTP GET è¯·æ±‚æ¥æ‰§è¡Œå›¾å½¢æŸ¥è¯¢ï¼Œä½† Flutter æœ‰ä¸€äº›å¾ˆé…·çš„ pubs æ¥ç®¡ç†è¿™äº›ä¸œè¥¿ï¼Œå¹¶ä½¿å¼€å‘äººå‘˜çš„å·¥ä½œå˜å¾—å®¹æ˜“ã€‚

å¦‚æœä½ å¯»æ‰¾ GraphQL client for Flutterï¼Œæœ‰å¾ˆå¥½çš„é€‰æ‹©ï¼Œæ¯”å¦‚ [graphql_flutter](https://pub.dev/packages/graphql_flutter#-readme-tab-) ã€‚

graphql_flutter pub æä¾›äº†å›¾å½¢æŸ¥è¯¢çš„å°éƒ¨ä»¶çº§å®ç°ã€‚
ä¾‹å¦‚:

```
Query(
  options: QueryOptions(
    document: readRepositories, // this is a Graph Query
    variables: {
      'nRepositories': 50,
    },
    pollInterval: 10,
  ),
  builder: (QueryResult result, { VoidCallback refetch }) {
    if (result.errors != null) {
      return Text(result.errors.toString());
    }

    if (result.loading) {
      return Text('Loading');
    }

    // it can be either Map or List
    List repositories = result.data['viewer']['repositories']['nodes'];

    return ListView.builder(
      itemCount: repositories.length,
      itemBuilder: (context, index) {
        final repository = repositories[index];

        return Text(repository['name']);
    });
  },
); 
```

è¿™æ˜¯ä¸€ä¸ªéå¸¸é«˜çº§çš„å°éƒ¨ä»¶å®ç°ï¼Œå®ƒå°†ä»å°éƒ¨ä»¶æœ¬èº«ç®¡ç†ç½‘ç»œã€‚

## [](#but-how-i-will-separate-the-network-layer-in-my-app)ä½†æ˜¯ï¼Œæˆ‘å°†å¦‚ä½•åœ¨æˆ‘çš„ App ä¸­åˆ†ç¦»ç½‘ç»œå±‚ï¼ŸğŸ¤·

æ˜¯å•Šï¼ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è´¨ç–‘çš„ã€‚å› ä¸ºæˆ‘ä»¬åœ¨ä¸€ä¸ª Flutter åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨äº† BLoC æ¶æ„ï¼Œæ‰€ä»¥è¿™ç§å®ç°è‚¯å®šä¸é€‚åˆ suitsã€‚

ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åˆ†æäº†è¿™ä¸ª pub çš„å†…éƒ¨å®ç°ã€‚è¿™æ˜¯ç»“æœã€‚

## [](#implement-graphql-on-bloc-way)ä»¥é˜»å¡æ–¹å¼å®ç° GraphQL

è¿™é‡Œæœ‰ä¸€ä¸ªä¸é”™çš„é…’é¦† [graphql_client](https://pub.dev/packages/graphql) ã€‚è¿™æ˜¯è¢« [graphql_flutter](https://pub.dev/packages/graphql_flutter#-readme-tab-) ä½¿ç”¨çš„åŒä¸€å®¶é…’é¦†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿåœ¨ App ä¸­åˆ†ç¦»ä¸€ä¸ªç½‘ç»œå±‚

è®©æˆ‘ä»¬ä»¥ [Github Graph API](https://developer.github.com/v4/) ä¸ºä¾‹

è®©æˆ‘ä»¬ç›´æ¥è¿›å…¥ä»£ç 

*   æ­¥éª¤ 1:åŸºæœ¬è®¾ç½®

```
//Provide a Base URL
final HttpLink _httpLink = HttpLink(
  uri: 'https://api.github.com/graphql',
);

//Provide authentication, this will go as a Header in Request
final AuthLink _authLink = AuthLink(
  getToken: () async => 'Bearer $GITHUB_TOKEN',
);

final Link _link = _authLink.concat(_httpLink as Link);

GraphQLClient _client;

// Create a common client for further requests
GraphQLClient getGraphQLClient() {
  _client ??= GraphQLClient(
    link: _link,
    cache: InMemoryCache(storageProvider: () {
      return getTemporaryDirectory(); // Provide a cache mechanism
    }),
  );

  return _client;
} 
```

*   æ­¥éª¤ 2:å­˜å‚¨åº“å±‚

```
class GitHubRepoProvider {
// method will give us Data model
  Future<List<GithubRepo>> getCurrentUserRepos() {
    return getGraphQLClient().query(_queryOptions()).then(_toGitHubRepo);
  }

// provides Graph Query options, we can provide the optional variable here
  QueryOptions _queryOptions() {
    return QueryOptions(
      document: readRepositories,
      variables: <String, dynamic>{
        'nRepositories': 50,
      },
    );
  }

// parse JSON to Data model
  List<GithubRepo> _toGitHubRepo(QueryResult queryResult) {
    if (queryResult.hasErrors) {
      throw Exception();
    }

    final list =
        queryResult.data['viewer']['repositories']['nodes'] as List<dynamic>;

    return list
        .map((repoJson) => GithubRepo.fromJson(repoJson))
        .toList(growable: false);
  }
}

// Graph Query to get repository of current user
const String _readRepositories = r'''
  query ReadRepositories($nRepositories: Int!) {
    viewer {
      repositories(last: $nRepositories) {
        nodes {
          name
          createdAt
          forkCount
        }
      }
    }
  }
'''; 
```

å®¾æœæ¸¸æˆğŸ‘ã€‚æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªæ•°æ®æ¨¡å‹ã€‚å°†æ‚¨çš„æ•°æ®æ¨¡å‹è½¬æ¢æˆè§†å›¾æ¨¡å‹ğŸ˜‰

æ‚¨å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å®Œæ•´çš„å·¥ä½œæ¼”ç¤ºåº”ç”¨ç¨‹åºğŸ‘‡ã€‚(ä¸è¦å¿˜è®°ç¼–è¾‘`config.dart`æ–‡ä»¶æ¥æ·»åŠ æ‚¨çš„ Github API ä»¤ç‰Œ)

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png)t1ã€milnd-mevada-STLã€‘/[é¢¤æŒ¯å›¾ QL æ¼”ç¤º](https://github.com/milind-mevada-stl/Flutter-GraphQL-Demo)

### è¿™ä¸ªé¡¹ç›®æ¼”ç¤ºäº† GraphQL åœ¨ Flutter ä¸­çš„å®ç°

<article class="markdown-body entry-content container-lg" itemprop="text">

# æµ®åŠ¨å›¾å½¢ SQL æ¼”ç¤º [![Build Status](../Images/8d0674324439e4a72600f106d049221e.png)](https://travis-ci.org/milind-mevada-stl/Flutter-GraphQL-Demo)

è¿™ä¸ªåº”ç”¨ç¨‹åºå±•ç¤ºäº†ä½¿ç”¨ [GraphQL å®¢æˆ·ç«¯](https://pub.dev/packages/graphql)åœ¨ Flutter ä¸­å®ç° GraphQL çš„æ¼”ç¤ºã€‚ç‚¹å‡»è¿™é‡Œï¼ŒæŸ¥çœ‹æˆ‘ä»¬çš„åšå®¢æ–‡ç« [ã€‚](https://dev.to/solutelabs/exploring-graphql-with-flutter-4mdp)

## å…¥é—¨æŒ‡å—

å…‹éš†å¹¶ç¼–è¾‘`config.dart`æ–‡ä»¶ï¼Œæ·»åŠ æ‚¨çš„ä¸ªæ€§åŒ– Github API ä»¤ç‰Œå³å¯å¼€å§‹ã€‚

</article>

[View on GitHub](https://github.com/milind-mevada-stl/Flutter-GraphQL-Demo)

åœ¨è¯„è®ºåŒºæä¾›ä½ çš„æƒ³æ³•/å»ºè®®ï¼Œæˆ–è€…ç»™æˆ‘å‘æ¨æ–‡ğŸ‘‰

> ![Milind Mevada profile image](../Images/e11904cfc57b8b444e0265c0947bd31d.png)ç±³æ—å¾·ç¾ç“¦è¾¾[@ç±³æ—å¾·ç¾ç“¦è¾¾](https://dev.to/milindmevada)![twitter logo](../Images/65e26e35707d96169ec8af6b3cbf2003.png)æ¢ç´¢ [#GraphQL](https://twitter.com/hashtag/GraphQL) ä¸Š[#é¢¤æŒ¯](https://twitter.com/hashtag/Flutter)ã€‚ä½¿ç”¨ GraphQL å®¢æˆ·ç«¯å‘å¸ƒã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹æ¼”ç¤ºåº”ç”¨ç¨‹åº[github.com/milind-mevada-â€¦](https://t.co/Hok8XJw51w)
> 
> æ„Ÿè°¢ [@SmitSonani](https://twitter.com/SmitSonani) çš„å¿«é€Ÿä»£ç å®¡æŸ¥ã€‚
> 
> [@ FlutterDev](https://twitter.com/FlutterDev)[@ flutterhm](https://twitter.com/FlutterAHM)[@ FlutterComm](https://twitter.com/FlutterComm)[@ r _ FlutterDev](https://twitter.com/r_FlutterDev)[@ FlutterWk](https://twitter.com/FlutterWk)[@ dart _ lang](https://twitter.com/dart_lang)[@ prasadsunny 1](https://twitter.com/prasadsunny1)T43ã€‘2019 å¹´ 5 æœˆ 30 æ—¥ä¸Šåˆ 09:50[![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1134034323772887040)