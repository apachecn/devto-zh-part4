# æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ iOS åº”ç”¨çš„ SemaphoreCI å’Œæµªå­

> åŸæ–‡:[https://dev . to/amarildo/continuous-integration-and-continuous-delivery-with-semaphoreci-and-fast lane-for-IOs-apps-2eg 3](https://dev.to/amarildo/continuous-integration-and-continuous-delivery-with-semaphoreci-and-fastlane-for-ios-apps-2eg3)

å½“ä½ å¼€å‘ç§»åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œ**ä½ ä½¿ç”¨ **Xcode ç®¡ç†å™¨**æ‰‹åŠ¨ç®¡ç†åº”ç”¨ç¨‹åºå‘å¸ƒçš„è¿‡ç¨‹ï¼Œéµå¾ªä¸€äº›æ­¥éª¤ï¼Œå¦‚ç­¾åã€æµ‹è¯•ã€æ„å»ºã€å­˜æ¡£å’Œéƒ¨ç½²ä½ çš„æ„å»ºï¼Œç„¶åæ”¹å˜ç‰ˆæœ¬å¹¶ä¸€æ¬¡åˆä¸€æ¬¡åœ°å°†æ–°çš„æ„å»ºå‘é€åˆ° AppStoreã€‚**

å¦‚æœä½ æ¯å¤©éƒ½ç”Ÿæˆä½ çš„æ„å»ºï¼Œ**è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¹å‘³å’Œç´¯äººçš„**ã€‚å› æ­¤ï¼Œæˆ–æ—©æˆ–æ™šï¼Œä½ ä¼šé—®è‡ªå·±:**â€”â€”æˆ‘æ€æ ·æ‰èƒ½ä½¿æ‰€æœ‰è¿™äº›è¿‡ç¨‹è‡ªåŠ¨åŒ–ï¼Ÿ**è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå¯¹æ‚¨çš„å¼€å‘å’Œéƒ¨ç½²æµç¨‹è‡³å…³é‡è¦ï¼Œåœ¨éƒ¨ç½²æ‚¨çš„æ„å»ºæ—¶ï¼Œæœ‰ä¸€ä¸ªå¿«é€Ÿçš„åé¦ˆå¾ªç¯æ¥è¿­ä»£æ˜¯è‡³å…³é‡è¦çš„ã€‚

ä½¿ç”¨ SemaphoreCI å’Œæµªå­æ˜¯é«˜é€Ÿæ„å»ºäº§å“çš„æœ€ä½³é€‰æ‹©ã€‚æ¯å½“æ‚¨å°†ä»£ç æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“æ—¶ï¼ŒSemaphoreCI å°†è‡ªåŠ¨è¿è¡Œæ‚¨çš„å®šåˆ¶æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ç®¡é“ã€‚

å› æ­¤ï¼Œè®©æˆ‘ä»¬å¼€å§‹è¿›è¡Œä¸€äº›é…ç½®ï¼Œå¹¶å»ºç«‹æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæŒç»­é›†æˆæµç¨‹ã€‚

## [](#introducing-the-project)ä»‹ç»é¡¹ç›®

æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­éµå¾ªçš„ä½¿ç”¨æŒç»­é›†æˆç®¡é“çš„æ­¥éª¤å¦‚ä¸‹æ‰€ç¤º:

**1ã€‚** **å…‹éš† Github**
**2 çš„ SemaphoreCI Swift æ¼”ç¤ºé¡¹ç›®ã€‚** **é…ç½®ä¿¡å·ç®¡é“**
**3ã€‚** **äº†è§£æˆ‘ä»¬é¡¹ç›®ä¸­æ–‡ä»¶çš„é…ç½®**
**4ã€‚** **ç”¨æŒç»­é›†æˆæ¨åŠ¨æˆ‘ä»¬çš„ç¬¬ä¸€æ¬¡æ„å»º**

## [](#clone-semaphoreci-swift-demo-project-from-github)ä» Github å…‹éš† SemaphoreCI Swift æ¼”ç¤ºé¡¹ç›®

ä¸ºäº†ç»§ç»­æœ¬æ•™ç¨‹ï¼Œæ‚¨åº”è¯¥ä» GitHub è·å– SemaphoreCI æ¼”ç¤ºé¡¹ç›®çš„å‰¯æœ¬ï¼Œå¹¶å°†å…¶å…‹éš†åˆ°æ‚¨çš„è®¡ç®—æœºä¸Šã€‚

æˆ‘ä»¬å°†æ²¿ç€æ•™ç¨‹ä½¿ç”¨ä»¥ä¸‹å·¥å…·:
**1ã€‚é¥­æ¡¶**
**2ã€‚Xcode**
**3ã€‚æµªå­**
**4ã€‚è¯­ä¹‰**

```
git clone git@github.com:semaphoreci-demos/semaphore-demo-ios-swift-xcode.git 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨:**æˆ‘å‘ä½ æ¨èï¼Œ**åˆ†å‰é¡¹ç›®**ï¼Œä»ä½ åˆ†å‰çš„å›è´­ä¸­å…‹éš†ã€‚

## [](#configuring-semaphoreci-pipeline)é…ç½®ä¿¡å·ç®¡é“

å»ä½ çš„ SemaphoreCI ä»ªè¡¨æ¿ï¼Œç„¶å**åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®**ã€‚é€‰æ‹©ä¸€ä¸ªå­˜å‚¨åº“`semaphore-demo-ios-swift-xcode`å¹¶è¿æ¥åˆ° SemaphoreCIã€‚

[![](../Images/904b0204a6361166989307f4dc733e9e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Vx2rUrML--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://amarildolucas.s3-sa-east-1.amazonaws.com/SemaphoreCI/Captura%2Bde%2BTela%2B2019-08-12%2B%25C3%25A0s%2B09.42.26.png)

æ­¤æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªç©ºçš„è¿æ¥é¡¹ç›®ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å‘é¡¹ç›®æ¨é€ä»»ä½•ä¸œè¥¿ã€‚

[![](../Images/234f1237392107d7a3029afa54e609d8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--G9ChD-wQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://amarildolucas.s3-sa-east-1.amazonaws.com/SemaphoreCI/Captura%2Bde%2BTela%2B2019-08-12%2B%25C3%25A0s%2B11.18.34.png)

åœ¨æ‚¨çš„å…‹éš†é¡¹ç›®ä¸Šï¼Œæ‰“å¼€`.semaphore/semaphore.yml`æ–‡ä»¶ã€‚è¿™æ˜¯æ¯æ¬¡æ¨é€ä»£ç æ—¶è¿è¡Œç®¡é“çš„é…ç½®æ–‡ä»¶ã€‚æ–‡ä»¶è¯„è®ºçš„å¾ˆå¥½ï¼Œéœ€è¦æ ¹æ®è‡ªå·±çš„éœ€è¦ä¿®æ”¹ã€‚

**ã€‚semaphore/semaphore.yml**

```
# Use the latest stable version of Semaphore 2.0 YML syntax:
version: v1.0

# Name your pipeline. In case you connect multiple pipelines with promotions,
# the name will help you differentiate between, for example, a CI build phase
# and delivery phases.
name: Semaphore iOS Swift example with Fastlane

# An agent defines the environment in which your code runs.
# It is a combination of one of available machine types and operating
# system images.
# See https://docs.semaphoreci.com/article/20-machine-types
# and https://docs.semaphoreci.com/article/120-macos-mojave-image
agent:
  machine:
    type: a1-standard-4
    os_image: macos-mojave

# Blocks are the heart of a pipeline and are executed sequentially.
# Each block has a task that defines one or more jobs. Jobs define the
# commands to execute.
# See https://docs.semaphoreci.com/article/62-concepts
blocks:
  - name: Run tests
    task:
      # Set environment variables that your project requires.
      # See https://docs.semaphoreci.com/article/66-environment-variables-and-secrets
      env_vars:
        - name: LANG
          value: en_US.UTF-8
      prologue:
        commands:
          # Download source code from GitHub:
          - checkout

          # Restore dependencies from cache. This command will not fail in
          # case of a cache miss. In case of a cache hit, bundle  install will
          # complete in about a second.
          # For more info on caching, see https://docs.semaphoreci.com/article/68-caching-dependencies
          - cache restore gems-$SEMAPHORE_GIT_BRANCH-$(checksum Gemfile.lock),gems-$SEMAPHORE_GIT_BRANCH-,gems-master-
          - bundle install --path vendor/bundle
          - cache store gems-$SEMAPHORE_GIT_BRANCH-$(checksum Gemfile.lock) vendor/bundle
      jobs:
        - name: Fastlane test
          commands:
            # Select an Xcode version, for available versions
            # See https://docs.semaphoreci.com/article/120-macos-mojave-image
            - bundle exec xcversion select 10.3
            # Run tests of iOS and Mac app on a simulator or connected device
            # See https://docs.fastlane.tools/actions/scan/
            - bundle exec fastlane test

  - name: Build app
    task:
      env_vars:
        - name: LANG
          value: en_US.UTF-8
      prologue:
        commands:
          - checkout
          - cache restore gems-$SEMAPHORE_GIT_BRANCH-$(checksum Gemfile.lock),gems-$SEMAPHORE_GIT_BRANCH-,gems-master-
          - bundle install --path vendor/bundle
          - cache store gems-$SEMAPHORE_GIT_BRANCH-$(checksum Gemfile.lock) vendor/bundle
      jobs:
        - name: Fastlane build
          commands:
            - bundle exec xcversion select 10.3
            # Gym builds and packages iOS apps.
            # See https://docs.fastlane.tools/actions/build_app/
            - bundle exec fastlane release 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨è¯•å›¾åœ¨æ­¤æ—¶æ¨é€æ‚¨çš„ä»£ç ï¼Œæ‚¨çš„ç®¡é“è¿˜ä¸èƒ½å·¥ä½œï¼Œå¹¶ä¸”ä¼šå¤±è´¥ã€‚æ‚¨éœ€è¦**é…ç½®æ‚¨çš„å¯†é’¥å’Œç§˜å¯†**ä»¥å…è®¸ SemaphoreCI ä¸æ‚¨çš„é¡¹ç›®é›†æˆã€‚

è¦å°†éƒ¨ç½²å¯†é’¥æ·»åŠ åˆ°ä¿¡å·é‡é¡¹ç›®ä¸­ï¼Œæ‚¨éœ€è¦åˆ›å»ºç§˜å¯†ä»¥æ·»åŠ åˆ°ç®¡é“é…ç½®æ–‡ä»¶ä¸­ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å°†éƒ¨ç½²å¯†é’¥ä½œä¸ºä¸€ä¸ªç§˜å¯†æ–‡ä»¶å­˜å‚¨åœ¨ SemaphoreCI ç¯å¢ƒä¸­ã€‚

å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£…æˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„ sem å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™æ˜¯å®‰è£…å®ƒçš„å¥½æ—¶æœºï¼Œè¯·å‚è§ [sem å‚è€ƒèµ„æ–™](https://docs.semaphoreci.com/article/53-sem-reference)å¹¶æŒ‰ç…§è¯´æ˜è¿›è¡Œæ“ä½œã€‚

```
$ sem create secret your-fastlane-ios-certificates-repo -f id_rsa_semaphoreci:/Users/semaphore/.keys/your-fastlane-ios-certificates-repo 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨å°†åœ¨ç»ˆç«¯ä¸Šçœ‹åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼Œ`Secret â€˜fastlane-ios-certificates-repoâ€™ created.`ã€‚è¿™æ„å‘³ç€ä¸€åˆ‡éƒ½æŒ‰é¢„æœŸè¿è¡Œã€‚

è¿™æ˜¯ SemaphoreCI çš„ ssh æ–‡ä»¶ã€‚å°†å®ƒä¸Šä¼ åˆ° GitHubï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥éƒ¨ç½²æ‚¨çš„ä»£ç ï¼Œä¸ä¼šå†æœ‰é—®é¢˜äº†ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­:

```
ssh-keygen -t rsa -f id_rsa_semaphoreci
cd ~/.ssh/id_rsa_semaphoreci.pub 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**å¤åˆ¶å¹¶ç²˜è´´åˆ° Github SSH å¯†é’¥é…ç½®ä¸­ã€‚**

æ¥ä¸‹æ¥ï¼Œ**æ·»åŠ è¯ä¹¦å­˜å‚¨åº“çš„ URL å’ŒåŠ å¯†å¯†ç ä½œä¸ºç¯å¢ƒå˜é‡**ï¼Œå®ƒä»¬å°†åœ¨ SemaphoreCI ä¸­è¢«è®¿é—®ã€‚æˆ‘è¿˜å»ºè®®å°† App Store å¼€å‘è€…è´¦æˆ·çš„å‡­è¯æ·»åŠ åˆ°åŒä¸€ä¸ªç§˜å¯†ä¸­ã€‚

```
$ sem create secret fastlane-env \
  -e MATCH_GIT_URL=â€œ<your ssh git url>â€ \
  -e MATCH_PASSWORD=â€œ<password for decryption>â€ \
  -e FASTLANE_USER=â€œ<App Store developerâ€™s Apple ID>â€ \
  -e FASTLANE_PASSWORD=â€œ<App Store developerâ€™s password>â€ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿è¡Œæ­¤å‘½ä»¤åï¼Œæ‚¨å°†åœ¨ SemaphoreCI dashboard çš„é…ç½®æœºå¯†ä¸­æ‰¾åˆ°æ‚¨çš„å¯†é’¥ã€‚

[![](../Images/6d3785dde270e4be19f1e45bec5c49a2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--vWZfOYr5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://amarildolucas.s3-sa-east-1.amazonaws.com/SemaphoreCI/Captura%2Bde%2BTela%2B2019-08-12%2B%25C3%25A0s%2B10.37.36.png)

ç”¨æ‚¨çš„å¯†é’¥å’Œç§˜å¯†æ›´æ–°æ‚¨çš„`.semaphore/semaphore.yml`æ–‡ä»¶ã€‚

```
jobs:
        - name: Fastlane build
        commands:
            - chmod 0600 ~/.keys/*
            - ssh-add ~/.keys/*
            - bundle exec fastlane release
secrets:
        - name: fastlane-env
        - name: fastlane-ios-certificates-repo 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#understanding-the-fastlane-configuration)äº†è§£æµªå­çš„é…ç½®

å½“æ‚¨æ‰“å¼€æ¼”ç¤ºé¡¹ç›®æ–‡ä»¶å¤¹æ—¶ï¼Œæ‚¨ä¼šçœ‹åˆ°æ‚¨æœ‰ä¸€ä¸ª fastlane æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸€äº›æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯åœ¨æˆ‘ä»¬ç¬¬ä¸€æ¬¡å®‰è£…å¹¶è¿è¡Œ fastlane ä¹‹åæ·»åŠ çš„ã€‚è¦äº†è§£æ›´å¤šå…³äº fastlane å®‰è£…å’Œé…ç½®çš„è¿‡ç¨‹ï¼Œæ‚¨åº”è¯¥é˜…è¯»è¿™ç¯‡[ä»‹ç»æ€§æ–‡ç« ](https://docs.fastlane.tools/getting-started/ios/setup/)ã€‚

è®©æˆ‘ä»¬æŒ‰ç…§æ‚¨é€šå¸¸ä¼šé‡‡å–çš„æ­¥éª¤æ¥è¿›è¡Œã€‚

**1ã€‚å®‰è£…å¿«è½¦é“**
**2ã€‚é…ç½®å¿«è½¦é“æ–‡ä»¶**
**3ã€‚æµ‹è¯•æ˜¯å¦ä¸€åˆ‡æ­£å¸¸**

æ­£å¦‚ fastlane åœ¨ä»–ä»¬è‡ªå·±çš„ç½‘ç«™ä¸Šæè¿°çš„é‚£æ ·:

> æµªå­æ˜¯è‡ªåŠ¨åŒ– iOS åº”ç”¨æµ‹è¯•ç‰ˆéƒ¨ç½²å’Œå‘å¸ƒçš„æœ€ç®€å•æ–¹å¼ã€‚å®ƒå¤„ç†æ‰€æœ‰ç¹ççš„ä»»åŠ¡ï¼Œæ¯”å¦‚ç”Ÿæˆå±å¹•æˆªå›¾ã€å¤„ç†ä»£ç ç­¾åå’Œå‘å¸ƒåº”ç”¨ç¨‹åºã€‚

å®ƒè¿˜æ”¯æŒå…¶ä»–å¹³å°ã€‚

å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£…ï¼Œè¯·å®‰è£…æœ€æ–°çš„ Xcode å‘½ä»¤è¡Œå·¥å…·ã€‚

```
xcode-select â€”install 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®‰è£…å¿«è½¦é“ã€‚

```
# Using RubyGems
sudo gem install fastlane -NV

# Alternatively using Homebrew
brew cask install fastlane 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æµªå­å®‰è£…åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚

```
fastlane init 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æµªå­ä¼šè‡ªåŠ¨æ£€æµ‹ä½ çš„é¡¹ç›®**å¹¶è¯¢é—®ä»»ä½•ç¼ºå¤±çš„ä¿¡æ¯ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œfastlane å®‰è£…çš„è¿™äº›æ–‡ä»¶å¤¹å’Œæ–‡ä»¶å­˜åœ¨äºæˆ‘ä»¬ä» Github ä¸­çš„æ¼”ç¤ºé¡¹ç›®ä¸‹è½½çš„æ—¶å€™ã€‚æ ¹æ®æ‚¨é€‰æ‹©çš„å®‰è£…ç±»å‹ï¼Œç³»ç»Ÿä¼šä¸ºæ‚¨è®¾ç½®ä¸åŒçš„æ–‡ä»¶ã€‚

æœ€æœ‰è¶£çš„æ–‡ä»¶æ˜¯`fastlane/Fastfile`ï¼Œå®ƒåŒ…å«äº†å‘å¸ƒåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚

æˆ‘ä»¬çš„å¿«è½¦é“å½“å‰æ–‡ä»¶å¤¹ã€‚åŒæ ·ï¼Œè¿™äº›æ–‡ä»¶éƒ½æœ‰å¾ˆå¥½çš„æ³¨é‡Šï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šå¯¹å®ƒä»¬ä¸­çš„æ¯ä¸€ä¸ªåšè¿›ä¸€æ­¥çš„è§£é‡Šã€‚

[![](../Images/100fdc28adaaacfafe750ff98c495987.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--qAg5R3C6--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://amarildolucas.s3-sa-east-1.amazonaws.com/SemaphoreCI/Captura%2Bde%2BTela%2B2019-08-12%2B%25C3%25A0s%2B09.34.37.png)

**å¿«è½¦é“/åº”ç”¨æ–‡ä»¶**

```
# For more information about the Appfile, see:
#     https://docs.fastlane.tools/advanced/#appfile

app_identifier "***" # The bundle identifier of your app
apple_id "***" # Your Apple email address
team_id "***" # Developer Portal Team ID 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**fastlane/Fastfile**

```
# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:ios)

platform :ios do

  before_all do
    # installed via the semaphore plugin with `fastlane add_plugin semaphore`
    setup_semaphore
  end

  desc "Run Tests"
  lane :test do
    scan
  end

  desc "Deploy a new version to the App Store"
  lane :release do
    match(type: "appstore")
    gym(export_method: "app-store") # Build your app - more options available
    deliver(force: true)
  end
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**å¿«è½¦é“/å¥èº«æˆ¿**

```
# For more information about this configuration visit
# https://github.com/fastlane/fastlane/tree/master/gym#gymfile
#
# In general, you can use the options available
# fastlane gym --help

# Remove the # in front of the line to enable the option

scheme "HelloWorld"

sdk "iphoneos12.4"

output_directory "./" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**å¿«è½¦é“/åŒ¹é…æ–‡ä»¶**

```
git_url("https://github.com/amarildolucas/fastlane_certficates")

storage_mode("git")

type("appstore") # The default type, can be: appstore, adhoc, enterprise or development

# app_identifier(["com.amarildolucas.com"])
# username("***") # Your Apple Developer Portal username

# For all available options run `fastlane match --help`
# Remove the # in the beginning of the line to enable the other options

# The docs are available on https://docs.fastlane.tools/actions/match 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**å¿«è½¦é“/å¤–æŒ‚æ–‡ä»¶**

```
# Autogenerated by fastlane
#
# Ensure this file is checked in to source control!

gem 'fastlane-plugin-semaphore' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯æˆ‘ä»¬è®¾ç½®å’Œéƒ¨ç½²æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæŒç»­é›†æˆæ„å»ºæ‰€éœ€è¦çš„ä¸€åˆ‡ã€‚ä»£ç éå¸¸å…·ä½“ï¼Œä¸è¨€è‡ªæ˜ã€‚æ‚¨åˆšåˆšå®šä¹‰äº†ä¸¤ä¸ªä¸åŒçš„é€šé“ï¼Œä¸€ä¸ªç”¨äºæ‚¨çš„æµ‹è¯•éƒ¨ç½²ï¼Œä¸€ä¸ªç”¨äº App Store å‘å¸ƒã€‚è¦åœ¨ App Store å‘å¸ƒä½ çš„åº”ç”¨ï¼Œä½ ç°åœ¨è¦åšçš„å°±æ˜¯æ¨é€ä½ çš„ä»£ç ã€‚

**æ³¨æ„:**ç¡®ä¿åœ¨ Xcode ä¸­æ²¡æœ‰å‹¾é€‰ Xcodeâ€œè‡ªåŠ¨ç®¡ç†ç­¾åâ€ã€‚å¹¶ä¸”æ‚¨çš„ç­¾å(å‘å¸ƒ)åŒ…å«æ‰€é€‰çš„åŒ¹é… AppStore é¢„ç½®æè¿°æ–‡ä»¶ã€‚

## [](#some-considerations)ä¸€äº›æ³¨æ„äº‹é¡¹

### [](#gemfile)Gemfile

å»ºè®®æ‚¨ä½¿ç”¨ Gemfile æ¥å®šä¹‰æ‚¨å¯¹ fastlane çš„ä¾èµ–æ€§ã€‚è¿™å°†æ¸…æ¥šåœ°å®šä¹‰æ‰€ä½¿ç”¨çš„ fastlane ç‰ˆæœ¬åŠå…¶ä¾èµ–é¡¹ï¼Œå¹¶ä¸”è¿˜å°†åŠ é€Ÿ fastlane çš„ä½¿ç”¨ã€‚

æˆ‘ä»¬å½“å‰çš„ Gemfile:

```
source 'https://rubygems.org'

gem "fastlane"
gem "xcode-install"
gem "cocoapods"

plugins_path = File.join(File.dirname(__FILE__), 'fastlane', 'Pluginfile')
eval_gemfile(plugins_path) if File.exist?(plugins_path) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#setting-up-fastlane-match)è®¾ç½®æµªå­æ¯”èµ›

æ‚¨å¯ä»¥ä½¿ç”¨ fastlane match æ¥ç®¡ç†ä»£ç ç­¾åã€‚æˆ‘ä»¬åœ¨å¿«é€Ÿé€šé“è®¾ç½®ä¸­ä½¿ç”¨å®ƒã€‚

è¦è®¾ç½®åŒ¹é…ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªç§æœ‰çš„ Git å­˜å‚¨åº“ã€‚éµå¾ª[æ–‡æ¡£](https://docs.fastlane.tools/actions/match/)ï¼Œä»æˆ‘ä»¬é¡¹ç›®çš„æ ¹ç›®å½•è¿è¡Œ init å‘½ä»¤ï¼Œå¹¶éµå¾ªç»ˆç«¯ä¸­æ˜¾ç¤ºçš„æŒ‡ä»¤ã€‚

```
bundle exec fastlane match init 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„åŒ¹é…æ–‡ä»¶å­˜åœ¨äº Github ä¸­çš„å…‹éš†æ¼”ç¤ºé¡¹ç›®ä¸­ã€‚å› æ­¤ï¼Œåœ¨æ²¡æœ‰ init çš„æƒ…å†µä¸‹è¿è¡Œ`fastlane match`,ä»¥è·å¾—å®‰è£…åˆ°é¡¹ç›®ä¸­çš„æ‰€æœ‰å¿…éœ€çš„å¯†é’¥ã€è¯ä¹¦å’Œé…ç½®æ–‡ä»¶ã€‚ğŸ™Œ

**æ³¨:**

> API å¯†é’¥æˆ–éƒ¨ç½²å‡­è¯ç­‰ç§æœ‰ä¿¡æ¯ä¸åº”å†™å…¥ç®¡é“å®šä¹‰æ–‡ä»¶æˆ–æäº¤ç»™æºä»£ç æ§åˆ¶çš„å…¶ä»–åœ°æ–¹ã€‚åœ¨ Semaphore ä¸Šï¼Œæ‚¨ä½¿ç”¨ sem CLI æˆ–é€šè¿‡ web ç•Œé¢(ä¾§æ çš„é…ç½®éƒ¨åˆ†- >æœºå¯†)å°†è¿™äº›å€¼å®šä¹‰ä¸º*æœºå¯†*ã€‚ç§˜å¯†ç”±ç»„ç»‡ä¸­çš„æ‰€æœ‰é¡¹ç›®å…±äº«ã€‚ **â€”æ——è¯­é˜Ÿ**

æ„å»ºæ‚¨çš„é¡¹ç›®å¹¶è¿è¡Œ fastlane æ¥æ£€æŸ¥æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢æ‰€åšçš„ä¸€åˆ‡æ˜¯å¦å¦‚é¢„æœŸçš„é‚£æ ·å·¥ä½œã€‚

[![](../Images/0dc7299098979ef838f3c418d2cec5df.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--csBT4VRv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://amarildolucas.s3-sa-east-1.amazonaws.com/SemaphoreCI/Captura%2Bde%2BTela%2B2019-08-12%2B%25C3%25A0s%2B10.26.41.png)

å¦‚æœä½ çœ‹åˆ°æ¶ˆæ¯`[10:28:38]: fastlane.tools finished successfully ğŸ‰`ï¼Œåº†ç¥å§ğŸ‰ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æˆ‘ä»¬çš„ä»£ç æ¨é€åˆ° GitHubï¼ŒSemaphoreCI å°†ä¸ºæˆ‘ä»¬è¿è¡Œ CI/CD ç®¡é“ã€‚

```
git add -A
git commit -m "setup semaphore"
git push origin master 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°†ä»£ç æ¨é€åˆ° GitHub ä¸­çš„ master branch åï¼Œä¿¡å·é‡ç®¡é“å°†ç¬¬ä¸€æ¬¡è¿è¡Œã€‚å¦‚æœæ‚¨å•å‡» commit é“¾æ¥ï¼Œæ‚¨å¯ä»¥åœ¨ä¸€ä¸ªæ¼‚äº®çš„å¸ƒå±€ç»„ä»¶ä¸­çœ‹åˆ°æ‰€æœ‰è¿‡ç¨‹(æ­¥éª¤),è¿™äº›ç»„ä»¶å°†æ‚¨çš„ç®¡é“é…ç½®çš„æ­¥éª¤åˆ†å¼€ã€‚

[![](../Images/ac8c9ae0cfdc242883aa21cf1bde87c5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--38ZjEnLx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://amarildolucas.s3-sa-east-1.amazonaws.com/SemaphoreCI/Captura%2Bde%2BTela%2B2019-08-12%2B%25C3%25A0s%2B11.58.59.png)

ç§ï¼ç°åœ¨ï¼Œæ‚¨åªéœ€ä¸æ–­å°†ä»£ç æ¨é€åˆ°æ‚¨çš„åˆ†æ”¯ï¼ŒApp Store Connect ä¼šå¤„ç†æ„å»ºï¼Œå®ƒå°†åœ¨ TestFlight ä¸­å¯ç”¨ï¼Œæ‚¨å°†èƒ½å¤Ÿä¸ºæ‚¨çš„æ–° iOS åº”ç”¨ç‰ˆæœ¬é€‰æ‹©å®ƒã€‚

## [](#conclusion)ç»“è®º

é€šè¿‡è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚CI/CD ç®¡é“æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œæ¯”æˆ‘ä»¬é€šè¿‡æœ¬æ•™ç¨‹éµå¾ªçš„æ­¥éª¤æ›´å¤šã€‚æ‚¨å¯ä»¥å‘æ‚¨çš„ç®¡é“é…ç½®æ·»åŠ æ›´å¤šæ­¥éª¤ï¼Œå¦‚è·å–æ‚¨çš„ CHANGELOG æ–‡ä»¶ã€å°†æ¶ˆæ¯æ¨é€åˆ° Slackã€è‡ªåŠ¨å¢åŠ å†…éƒ¨ç‰ˆæœ¬å·ã€å°† dSYM ä¸Šä¼ åˆ° Crashlytics ç­‰ã€‚

åœ¨ä½ èŠ±ä¸€äº›æ—¶é—´é…ç½®ä¹‹åï¼Œæ‰€æœ‰è¿™äº›ä¸œè¥¿å°†å¸®åŠ©ä½ ä¸“æ³¨äºç¼–å†™ä»£ç ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½æ‰‹åŠ¨äº¤ä»˜ä½ çš„åº”ç”¨ã€‚å› æ­¤ï¼Œæ‚¨çš„æ„å»ºæ›´æ–°ä¸ä¼šæœ‰å‹åŠ›å’Œä¹å‘³ã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨è¿‡ç¨‹ä¸­æ·»åŠ å·¥å…·æ¥æ£€æŸ¥æ‚¨çš„ä»£ç ï¼Œä¾‹å¦‚è¿è¡Œé™æ€ä»£ç å®¡æŸ¥ã€æ—æŒºã€æµ‹è¯•æˆ–ä»»ä½•å…¶ä»–æ‚¨å¯ä»¥è‡ªåŠ¨åŒ–çš„é‡è¦æ­¥éª¤ã€‚

ç„¶è€Œï¼Œå…ˆä»ç®€å•çš„äº‹æƒ…å¼€å§‹ã€‚å¦‚æœä½ å·²ç»åšåˆ°äº†è¿™ä¸€æ­¥ï¼Œæ­å–œä½ ï¼ğŸ˜ƒæˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚

æƒ³è¦æŒç»­äº¤ä»˜æ‚¨çš„ iOS åº”ç”¨ç¨‹åºå—ï¼ŸæŸ¥çœ‹[ä½¿ç”¨ Semaphore CI/CD](https://semaphoreci.com/product/ios) æ„å»ºã€æµ‹è¯•å’Œäº¤ä»˜æ‚¨çš„ iOS åº”ç”¨ã€‚