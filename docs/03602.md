# å¦‚ä½•ä½¿ç”¨ç²’å­æ°©è¿›è¡Œç°åœºè·Ÿè¸ª

> åŸæ–‡:[https://dev . to/jaredwolff/how-to-presence-tracking-using-particle-argon-4 flf](https://dev.to/jaredwolff/how-to-presence-tracking-using-particle-argon-4flf)

[![Main post image](img/bbe9d2d112346bcdd19eb068f9125d93.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--JjK-s735--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Copy_of_Copy_of_Flow-bdfad00f-8d42-4481-87b4-16662e984a85.png)

æ›¾ç»æƒ³è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ å­˜åœ¨æˆ–ä½ç½®è·Ÿè¸ªå—ï¼Ÿå¯¹è§£å†³æ–¹æ¡ˆ(æˆ–ç¼ºä¹è§£å†³æ–¹æ¡ˆ)æ„Ÿåˆ°æ²®ä¸§ï¼Ÿ

åˆ«æ‹…å¿ƒï¼Œä½ ä¸æ˜¯å”¯ä¸€ä¸€ä¸ªï¼

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•å®ç°ä¸€ä¸ªéå¸¸åŸºæœ¬çš„è·Ÿè¸ªå’Œé€šçŸ¥åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å°†ä½¿ç”¨ç²’å­æ°©å’Œç“·ç –ä¼´ä¾£ã€‚

åˆ°æœ€åï¼Œä½ å°†èƒ½å¤Ÿåˆ¤æ–­ç“·ç –æ˜¯å¦å­˜åœ¨ã€‚å¦å¤–ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Pushover å‘æ‚¨é€‰æ‹©çš„è®¾å¤‡å‘é€æ¨é€é€šçŸ¥ã€‚

æˆ‘ä»¬èµ°å§ï¼

**æ³¨æ„**åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œè¿™ä¸ªå¸–å­æ˜¯**å†—é•¿çš„**ã€‚[ä½ å¯ä»¥ä¸‹è½½ PDF ç‰ˆæœ¬ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä¸‹è½½åè§‚çœ‹ã€‚](https://www.jaredwolff.com/files/how-to-location-tracking-using-particle-mesh-pdf/)

## [](#initial-investigation)åˆæ­¥è°ƒæŸ¥

ä¹ä¸€çœ‹ï¼Œä½¿ç”¨ç“·ç –çš„æƒ³æ³•å¹¶ä¸æ˜æ˜¾ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä½¿ç”¨ç”µè¯ä¼¼ä¹æ›´æœ‰æ„ä¹‰ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå¯è¡Œçš„é€‰æ‹©ã€‚è¿™å°†éœ€è¦æ›´å¤šçš„ç ”ç©¶å’Œè“ç‰™ iOS åº”ç”¨ç¨‹åºçš„åˆ›å»ºã€‚

æ‰€ä»¥ï¼Œä½¿ç”¨ç”µè¯çš„æƒ³æ³•å·²ç»è¿‡æ—¶äº†ã€‚

ç„¶åæˆ‘æƒ³ï¼Œâ€œä»€ä¹ˆè®¾å¤‡*ä¸€ç›´åœ¨åšå¹¿å‘Šï¼Ÿâ€*

 *è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘èµ°ä¸Šäº†åƒ Tile è¿™æ ·çš„è¿½è¸ªè€…çš„é“è·¯ã€‚

å®ƒåˆ°è¾¾åï¼Œæœ‰ä¸€äº›å¸¸è§„æµ‹è¯•ã€‚ç¬¬ä¸€ç«™ï¼Œç“·ç –åº”ç”¨ã€‚

[![Screenshot of Tile App](img/87cd810eb6252e5c400bcc36bbf771f3.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--74UiiLsb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/iphone7gold_portrait-2-2b6bcb7b-0f91-4578-a2db-034853565b09.png)

æˆ‘å¯ä»¥è¿æ¥å¹¶ä½¿ç”¨è¿™ä¸ªè®¾å¤‡ã€‚æˆ‘ç”šè‡³è®©å®ƒæ’­æ”¾äº†ä¸€é¦–æœ—æœ—ä¸Šå£çš„æ›²å­ã€‚ğŸ¶

ç„¶åï¼Œæˆ‘å¼€å§‹ä½¿ç”¨ä¸€ä¸ªè“ç‰™æ‰«æä»ªåº”ç”¨ç¨‹åºã€‚æˆ‘æ»šåŠ¨æ‰€æœ‰çš„ç»“æœï¼Œå®¾æœã€‚ç“·ç –åœ¨é‚£é‡Œï¼

[![NRFConnect Scan Results](img/5f69b3681ca92062de3faae0f3265c8f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--eAKWJhYQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/iphone7gold_portrait-466803ef-57d9-498c-8656-2c274bf7fe8d.png)

æˆ‘ç”šè‡³ç­‰äº†å‡ ä¸ªå°æ—¶ï¼Œåˆæ£€æŸ¥äº†ä¸€éã€‚æˆ‘æƒ³ç¡®å®šå®ƒè¿‡ä¸€ä¼šå„¿ä¸ä¼šç¡ç€ã€‚ç»“æœï¼Œæ€»æ˜¯å¹¿å‘Šã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œå¤§çº¦æ¯ 8 ç§’é’Ÿã€‚

æ‰€æœ‰è¿™äº›æµ‹è¯•å¾—å‡ºä¸€ä¸ªç»“è®º:å®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨äºç°åœºæ£€æµ‹ã€‚

è¯¥è¿‡ç¨‹çš„ä¸‹ä¸€æ­¥æ˜¯è¯•å›¾æ‰¾å‡ºå¦‚ä½•è®©å®ƒä¸æ°©æ°”ä¸€èµ·å·¥ä½œã€‚

## [](#advertising)å¹¿å‘Š

æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥ä¸­æ”¶é›†çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬çŸ¥é“ç£è´´å¤§çº¦æ¯ 8 ç§’é’Ÿå‘å¸ƒä¸€æ¬¡å¹¿å‘Šã€‚è¿™æ„å‘³ç€å®ƒåº”è¯¥å¾ˆå®¹æ˜“è¢«ä»»ä½•è®¾å¤‡æ‰«æï¼ŒåŒ…æ‹¬æ°©ã€æ°®æˆ–ç¡¼ã€‚

å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘å»ºè®®ä½ ä½¿ç”¨æ°©æ°”ã€‚è¿™æ˜¯å› ä¸ºè“ç‰™å’Œ Mesh å…±äº«åŒä¸€ä¸ªæ— çº¿ç”µã€‚å½“æ‰«æç“·ç –æ—¶ï¼Œè¿æ¥åˆ° Mesh çš„ Xenon ç»å¸¸ä¼šé”™è¿‡å¹¿å‘ŠåŒ…ã€‚è¿™å°†å¯¼è‡´å‡é˜´æ€§(å’Œæ²®ä¸§ï¼).

åŒæ ·çš„ï¼Œä½ è¦ç¡®ä¿ä½ çš„æ°©æ°”æ²¡æœ‰è¿æ¥åˆ°ç½‘çŠ¶ç½‘ç»œã€‚æ‚¨å¯ä»¥ä½¿ç”¨ CLI åˆ é™¤å®ƒã€‚å°†æ‚¨çš„è®¾å¤‡è¿æ¥åˆ°æ‚¨çš„è®¡ç®—æœºï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
particle mesh remove <device name/ID> 
```

ç¡®ä¿å°†**æ›¿æ¢ä¸ºæ‚¨è®¾å¤‡çš„åç§°æˆ– IDã€‚**

 **å¥½å§ï¼Œå›åˆ°æ­£é¢˜ã€‚

åœ¨è“ç‰™ä¸­ï¼Œå¹¿å‘Šå¯ä»¥æœ‰å‡ ç§ä¸åŒçš„ç”¨é€”ã€‚é€šå¸¸ï¼Œè¿™æ ‡å¿—ç€é…å¯¹é˜¶æ®µçš„å¼€å§‹ã€‚è¿™æ ·ï¼Œå…¶ä»–è®¾å¤‡çŸ¥é“å¹¿å‘Šè®¾å¤‡æ˜¯å¯ç”¨çš„ã€‚

æ­¤å¤–ï¼Œå¹¿å‘Šè®¾å¤‡å°†æŒ‡ç¤ºå®ƒæœ‰ä»€ä¹ˆæœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›çŸ¥è¯†æ¥è¿‡æ»¤æ‰ä¸åŒ¹é…çš„è®¾å¤‡ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯äº’åŠ¨ç¨‹åºè®¾å¤‡ä¸Šå¯ç”¨æœåŠ¡çš„å±å¹•æˆªå›¾:

[![Service information using Light Blue](img/71ced9614e83d526adeafaa5d459cc35.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--lOj3wjM1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Apple_iPhone_6s_Gold-c1f1d0da-7aba-410a-97b4-3cbebc933208.png)

æ‰«ææ—¶ï¼Œæˆ‘ä»¬å°†ä»”ç»†æ£€æŸ¥æˆ‘ä»¬æ­£åœ¨è¿æ¥çš„è®¾å¤‡æ˜¯å¦å…·æœ‰`0xfeed`çš„æœåŠ¡ UUIDã€‚

åœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶è“ç‰™é¢†åŸŸä¹‹å‰ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨è®°å½•å™¨è®¾ç½®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿›è¡Œè°ƒè¯•ã€‚

## [](#logging)æµ‹äº•

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è®°å½•å™¨ã€‚å®ƒå…è®¸æ‚¨ä½¿ç”¨`particle serial monitor`æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸­çš„æ—¥å¿—æ¶ˆæ¯ã€‚

æ—¥å¿—è®°å½•å™¨çš„ä¸€ä¸ªæ›´é…·çš„ç‰¹æ€§æ˜¯æ¶ˆæ¯å±‚æ¬¡ç»“æ„çš„æ¦‚å¿µã€‚è¿™å…è®¸è®¾è®¡è€…æœ‰é€‰æ‹©åœ°å±è”½ä¸å¿…è¦çš„æ¶ˆæ¯ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ç”¨äºè°ƒè¯•çš„æ¶ˆæ¯ã€‚æ‚¨å¯ä»¥åˆ é™¤å®ƒä»¬æˆ–å°†å…¶æ³¨é‡Šæ‰ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥å¢åŠ `LOG_LEVEL`ä»¥ä¾¿æœ‰æ•ˆåœ°å¿½ç•¥å®ƒä»¬ã€‚

ä»¥ä¸‹æ˜¯ç²’å­è®¾å¤‡æ“ä½œç³»ç»Ÿå‚¨å­˜åº“ä¸­`logging.h`å¯ç”¨çš„æ—¥å¿—çº§åˆ«:

```
// Log level. Ensure log_level_name() is updated for newly added levels
typedef enum LogLevel {
    LOG_LEVEL_ALL = 1, // Log all messages
    LOG_LEVEL_TRACE = 1,
    LOG_LEVEL_INFO = 30,
    LOG_LEVEL_WARN = 40,
    LOG_LEVEL_ERROR = 50,
    LOG_LEVEL_PANIC = 60,
    LOG_LEVEL_NONE = 70, // Do not log any messages
    // Compatibility levels
    DEFAULT_LEVEL = 0,
    ALL_LEVEL = LOG_LEVEL_ALL,
    TRACE_LEVEL = LOG_LEVEL_TRACE,
    LOG_LEVEL = LOG_LEVEL_TRACE, // Deprecated
    DEBUG_LEVEL = LOG_LEVEL_TRACE, // Deprecated
    INFO_LEVEL = LOG_LEVEL_INFO,
    WARN_LEVEL = LOG_LEVEL_WARN,
    ERROR_LEVEL = LOG_LEVEL_ERROR,
    PANIC_LEVEL = LOG_LEVEL_PANIC,
    NO_LOG_LEVEL = LOG_LEVEL_NONE
} LogLevel; 
```

é…·ï¼Œæ—¥å¿—çº§åˆ«ã€‚ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨å®ƒä»¬å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ä»¥ä¸‹å‡½æ•°ä¹‹ä¸€æ¥ä½¿ç”¨å®ƒä»¬:

`Log.trace`ã€`Log.info`ã€`Log.warn`ã€`Log.error`ã€‚

ä¾‹å¦‚:

```
Log.trace("This is a TRACE message."); 
```

å¦‚æœæˆ‘ä»¬å°†æ—¥å¿—çº§åˆ«è®¾ç½®ä¸º`LOG_LEVEL_INFO`ï¼Œæˆ‘ä»¬å°†åªçœ‹åˆ°æ¥è‡ª`Log.info`ã€`Log.warn`å’Œ`Log.error`çš„æ¶ˆæ¯ã€‚`LOG_LEVEL_WARN`ï¼Ÿåªæœ‰`Log.warn`å’Œ`Log.error`ä¼šå‡ºç°ã€‚(å¸Œæœ›ä½ æ˜ç™½äº†ã€‚)

ä¸ºäº†è®¾ç½®å®ƒï¼Œæˆ‘ä»¬å°†é»˜è®¤çº§åˆ«è®¾ç½®ä¸º`LOG_LEVEL_ERROR`ã€‚æˆ‘ä»¬è¿˜ä¼šå°†ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„`LOG_LEVEL`è®¾ç½®ä¸º`LOG_LEVEL_TRACE`ã€‚æœ€ç»ˆç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„

```
// For logging
SerialLogHandler logHandler(115200, LOG_LEVEL_ERROR, {
    { "app", LOG_LEVEL_TRACE }, // enable all app messages
}); 
```

è¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šæ”¶åˆ°æ¥è‡ª DeviceOS æ—¥å¿—æ¶ˆæ¯çš„åƒåœ¾é‚®ä»¶ã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä»åº”ç”¨ç¨‹åºæœ¬èº«è·å¾—æ‰€æœ‰é€‚ç”¨çš„æ¶ˆæ¯ã€‚

é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå¦‚æœä½ æƒ³æŠŠä½ çš„è®¾å¤‡è®¾ç½®æˆå•ä¸ª`LOG_LEVEL`ï¼Œä½ å¯ä»¥è¿™æ ·è®¾ç½®:

```
SerialLogHandler logHandler(LOG_LEVEL_INFO); 
```

å½“ä½ ç»§ç»­ä½¿ç”¨ Particle çš„ DeviceOS æ—¶ï¼Œä½ ä¼šå¾ˆå¿«æ„è¯†åˆ°å®ƒæœ‰å¤šæ–¹ä¾¿ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›å…¥æ­£é¢˜å§ï¼

## [](#setting-it-up)è®¾ç½®

[![Device-os Release Page](img/bb92b834067cbd43eb073a79cb7d03a8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--3Rg4QTQY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-06_at_9-a04e6802-ec22-4036-8ace-6150a532979b.50.41_PM.png)

é¦–å…ˆï¼Œæˆ‘ä»¬è¦ç¡®ä¿æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ­£ç¡®ç‰ˆæœ¬çš„è®¾å¤‡æ“ä½œç³»ç»Ÿã€‚1.3 ä»¥åçš„ä»»ä½•ç‰ˆæœ¬éƒ½ä¼šæœ‰è“ç‰™ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°[çš„è¯´æ˜ã€‚](https://www.jaredwolff.com/how-to-upgrade-particle-mesh-device-os/)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦å¼€å§‹æ‰«æç“·ç –ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”åœ¨`loop()`å‡½æ•°ä¸­è¿™æ ·åšã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª`millis()`è®¡æ—¶å™¨:

```
// Scan for devices
if( (millis() > lastSeen + TILE_RE_CHECK_MS) ){
    BLE.scan(scanResultCallback, NULL);
} 
```

ç¡®ä¿åœ¨æ–‡ä»¶çš„é¡¶éƒ¨å®šä¹‰äº†`lastSeen`ï¼Œå°±åƒè¿™æ ·:

```
system_tick_t lastSeen = 0; 
```

æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥è·Ÿè¸ªç“·ç –æœ€åä¸€æ¬¡è¢«â€œçœ‹åˆ°â€çš„æ—¶é—´ã€‚å³æ°©æœ€åä¸€æ¬¡çœ‹åˆ°æ¥è‡ªåŒºå—çš„å¹¿å‘ŠåŒ…çš„æ—¶é—´ã€‚

`TILE_RE_CHECK_MS`å¯ä»¥å®šä¹‰ä¸º

```
#define TILE_RE_CHECK_MS 7500 
```

è¿™æ ·ï¼Œæˆ‘ä»¬è‡³å°‘æ¯ 7.5 ç§’æ£€æŸ¥ä¸€æ¬¡å¹¿å‘ŠåŒ…ã€‚

ä¸ºäº†æ‰¾åˆ°å›¾å—è®¾å¤‡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`BLE.scan`ã€‚å½“æˆ‘ä»¬è°ƒç”¨å®ƒæ—¶ï¼Œå®ƒå°†å¼€å§‹æ‰«æè¿‡ç¨‹ã€‚å½“è®¾å¤‡è¢«å‘ç°æ—¶`scanResultCallback`å°†ä¼šè§¦å‘ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–‡ä»¶çš„é¡¶éƒ¨å®šä¹‰`scanResultCallback`:

```
void scanResultCallback(const BleScanResult *scanResult, void *context) {
} 
```

æ‚¨ä¼šæ³¨æ„åˆ°å®ƒåŒ…å«äº†ä¸€ä¸ª`BleScanResult`ã€‚è¿™å°†åŒ…å«åœ°å€ã€RSSI å’Œè®¾å¤‡åç§°(å¦‚æœå¯ç”¨)ä»¥åŠå¯ç”¨çš„æœåŠ¡ä¿¡æ¯ã€‚è¿™å°†åœ¨æˆ‘ä»¬å¯»æ‰¾ç£è´´è®¾å¤‡æ—¶æ´¾ä¸Šç”¨åœºï¼

è¯·è®°ä½ï¼Œ`BLE.scan`åœ¨æ‰«æå®Œæˆä¹‹å‰ä¸ä¼šè¿”å›ã€‚æ‰«æçš„é»˜è®¤è¶…æ—¶æ—¶é—´æ˜¯ 5 ç§’ã€‚æ‚¨å¯ä»¥ä½¿ç”¨`BLE.setScanTimeout()`æ¥æ›´æ”¹è¯¥å€¼ã€‚`setScanTimeout`ä»¥ 10ms ä¸ºå¢é‡å•ä½ã€‚å› æ­¤ï¼Œ500 æ¯«ç§’çš„è¶…æ—¶éœ€è¦å€¼ 50ã€‚

å¯¹äºè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œæˆ‘å»ºè®®ä½¿ç”¨ 8s(8000 æ¯«ç§’)çš„å€¼ã€‚å¯ä»¥è¿™æ ·è®¾ç½®:

```
BLE.setScanTimeout(800); 
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¾å¤‡å°†æ‰«æè¯¥åŒºå—è¿›è¡Œå¹¿å‘Šçš„æ—¶é—´ã€‚è¿™æ ·å°±ä¸å¤ªå¯èƒ½é”™è¿‡å¹¿å‘ŠåŒ…ã€‚

## [](#handling-scan-results)å¤„ç†æ‰«æç»“æœ

[![All const definitions](img/3c8ff3a47fe64d41f44492b3655c0fff.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--JnSdxbtD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-06_at_11-fa1f684f-246c-474a-8397-e7387692e39b.05.19_PM.png)

ç°åœ¨æˆ‘ä»¬æœ‰äº†`scanResultCallback`è®©æˆ‘ä»¬æ¥å®šä¹‰å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆã€‚

æˆ‘ä»¬é¦–å…ˆæƒ³è·å¾—å¹¿å‘Šæ•°æ®ä¸­çš„æœåŠ¡ä¿¡æ¯ã€‚æœ€å¥½çš„åŠæ³•æ˜¯ç”¨`scanResult->advertisingData.serviceUUID`ã€‚æˆ‘ä»¬å°†ä¼ å…¥ä¸€ä¸ª UUIDs æ•°ç»„ï¼Œå®ƒå°†è¢«å¤åˆ¶ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚

```
BleUuid uuids[4];
int uuidsAvail = scanResult->advertisingData.serviceUUID(uuids,sizeof(uuids)/sizeof(BleUuid)); 
```

è¿™å°†å¡«å……`uuids`,è¿™æ ·æ‚¨å°±å¯ä»¥è¿­ä»£å®ƒä»¬ã€‚`uuidsAvail`å°†ç­‰äºå¯ç”¨ UUIDs çš„æ•°é‡ã€‚

åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨å¯»æ‰¾ä¸€ä¸ªç‰¹å®šçš„ UUIDã€‚æˆ‘ä»¬å°†å®ƒå®šä¹‰ä¸ºæ–‡ä»¶çš„é¡¶éƒ¨:

```
#define TILE_UUID 0xfeed 
```

é€šå¸¸ UUIDs è¦é•¿å¾—å¤šã€‚åƒè¿™æ ·çš„çŸ­ UUID æ„å‘³ç€å®ƒå·²ç»è¢«ä¿ç•™æˆ–è€…æ˜¯è“ç‰™è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½å°†ä»¥æ£€æŸ¥ 32 ä½æˆ– 128 ä½ç‰ˆæœ¬çš„ç›¸åŒæ–¹å¼æ¥æ£€æŸ¥å®ƒã€‚

å‡ºäºè¯Šæ–­åŸå› ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ‰“å°å‡ºè®¾å¤‡ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒRSSI å’Œè®¾å¤‡ MAC åœ°å€å¾ˆæ–¹ä¾¿:

```
// Print out mac info
BleAddress addr = scanResult->address;
Log.trace("MAC: %02X:%02X:%02X:%02X:%02X:%02X", addr[0], addr[1], addr[2], addr[3], addr[4], addr[5]);
Log.trace("RSSI: %dBm", scanResult->rssi); 
```

æœ€åï¼Œè®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå¾ªç¯ï¼Œçœ‹çœ‹æ‰¾åˆ°çš„è®¾å¤‡æ˜¯å¦æœ‰ UUID:

```
// Loop over all available UUIDs
// For tile devices there should only be one
for(int i = 0; i < uuidsAvail; i++){

    // Print out the UUID we're looking for
    if( uuids[i].shorted() == TILE_UUID ) {
        Log.trace("UUID: %x", uuids[i].shorted());

        // Stop scanning
        BLE.stopScanning();

        return;
    }
} 
```

æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å°† UUID çš„â€œç¼©çŸ­â€ç‰ˆæœ¬ä¸`TILE_UUID`è¿›è¡Œæ¯”è¾ƒã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ•´æ•°ï¼Œæ‰€ä»¥ä¸éœ€è¦å¤æ‚çš„å†…å­˜æ¯”è¾ƒæ“ä½œã€‚å› æ­¤ï¼Œä½¿ç”¨`if( uuids[i].shorted() == TILE_UUID )`å°±å¯ä»¥äº†ã€‚

æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨`Log.trace`æ‰“å°å‡ºè¯Šæ–­ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥æ‰“å°å‡º UUID çš„`shorted()`ç‰ˆæœ¬ã€‚

### [](#test-it)æµ‹è¯•ä¸€ä¸‹ï¼

è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹æˆ‘ä»¬ç›®å‰æ‰€æ‹¥æœ‰çš„ï¼

ä¸ºä½ çš„æ°©ç¼–ç¨‹åº”ç”¨ç¨‹åºã€‚æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œ`particle serial monitor`æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½ å¯èƒ½ä¼šçœ‹åˆ°çš„ä¾‹å­:

```
0000005825 [app] TRACE: MAC: 65:C7:B3:AF:73:5C
0000005827 [app] TRACE: RSSI: -37Bm
0000005954 [app] TRACE: MAC: B3:D9:F1:F0:5D:7E
0000005955 [app] TRACE: RSSI: -62Bm
0000006069 [app] TRACE: MAC: C5:F0:74:3D:13:77
0000006071 [app] TRACE: RSSI: -62Bm
0000006217 [app] TRACE: MAC: 65:C7:B3:AF:73:5C
0000006219 [app] TRACE: RSSI: -39Bm
0000006224 [app] TRACE: MAC: B3:D9:F1:F0:5D:7E
0000006225 [app] TRACE: RSSI: -62Bm
0000006296 [app] TRACE: MAC: D7:E7:FE:0C:A5:C0
0000006298 [app] TRACE: RSSI: -60Bm
0000006299 [app] TRACE: UUID: feed 
```

æ³¨æ„æ¶ˆæ¯æ˜¯å¦‚ä½•åŒ…å«`TRACE`å’Œ`[app]`çš„ï¼Ÿè¿™æ„å‘³ç€å®ƒæ˜¯æ¥è‡ªåº”ç”¨ç¨‹åºä»£ç çš„è·Ÿè¸ªæ¶ˆæ¯ã€‚å¾—å¿ƒåº”æ‰‹å¯¹å—ï¼Ÿ

è¿™æ®µä»£ç å¾ˆå¿«å°±ä¼šå˜æˆåƒåœ¾é‚®ä»¶ï¼Œå°¤å…¶æ˜¯å¦‚æœä½ å¤„åœ¨ä¸€ä¸ªæœ‰å¾ˆå¤šå¹¿å‘Šè“ç‰™è®¾å¤‡çš„ç¯å¢ƒä¸­ã€‚å¦‚æœä½ çš„ç£è´´æ‰“å¼€å¹¶è¿è¡Œï¼Œæœ€ç»ˆä½ ä¼šçœ‹åˆ°ä¸€æ¡æ¶ˆæ¯`UUID: feed`ã€‚è¿™æ„å‘³ç€ä½ çš„æ°©æ‰¾åˆ°äº†ç“·ç –ï¼

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¿è½½æ¨¡å¼æŒ‰é’®å°†å›¾å—çš„åœ°å€â€œç¼–ç¨‹â€åˆ°å†…å­˜ä¸­ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿‡æ»¤æ‰æ‰€æœ‰æˆ‘ä»¬ä¸å…³å¿ƒçš„è®¾å¤‡ã€‚

## [](#add-device-on-button-push)æŒ‰é’®æŒ‰ä¸‹æ—¶æ·»åŠ è®¾å¤‡

[![System event handler](img/ff60428913a7179a7e4822d8ba03c123.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--g-m2P7EC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-06_at_11-c1b2b96d-3a1b-45b5-bf5f-5fa7824c80d0.06.04_PM.png)

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¼„æ¸…æ¥šå¦‚ä½•ç›‘æ§æ¨¡å¼æŒ‰é’®ã€‚æ ¹æ®æ–‡æ¡£ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨`System.on`ã€‚

```
System.on(button_click, eventHandler); 
```

ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç³»ç»Ÿäº‹ä»¶çš„åç§°ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯`button_click`ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ã€‚æˆ‘ä»¬æš‚ä¸”ç§°ä¹‹ä¸º`eventHandler`ã€‚

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»º`eventHandler`

```
void eventHandler(system_event_t event, int duration, void* )
{

} 
```

**é‡è¦:**ä¸èƒ½ä½¿ç”¨`eventHandler`é‡Œé¢çš„`Log`å‡½æ•°ã€‚æµ‹è¯•å®ƒçš„ä¸€ä¸ªç®€å•æ–¹æ³•æ˜¯åˆ‡æ¢ D7 ä¸Šçš„ LEDã€‚æˆ‘ä»¬å¼€å§‹å§ï¼

åˆå§‹åŒ–`setup()`ä¸­çš„ LED

```
// Set LED pin
pinMode(D7,OUTPUT); 
```

ç„¶åæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªåŠ åœ¨`eventHandler`é‡Œé¢

```
if( event == button_click ) {
    if( digitalRead(D7) ) {
        digitalWrite(D7,LOW);
    } else {
        digitalWrite(D7,HIGH);
    }
} 
```

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å†™å…¥ D7(æ¿è½½è“è‰² LED)ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥ä½¿ç”¨`digitalRead`æ¥è¯»å– LED çš„çŠ¶æ€ã€‚å®ƒä¼šæ ¹æ®æƒ…å†µç”¨`HIGH`æˆ–`LOW`æ¥å›åº”ã€‚

å°†å›ºä»¶åŠ è½½åˆ°è®¾å¤‡ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶è“è‰² LED äº†ï¼

åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¨¡å¼æŒ‰é’®å°†è®¾å¤‡ç½®äºâ€œå­¦ä¹ â€æ¨¡å¼ã€‚è¿™å°†å…è®¸æˆ‘ä»¬ä½¿ç”¨ç›®æ ‡ç£è´´è®¾å¤‡è¿›è¡Œä¸€é”®è®¾ç½®ã€‚

## [](#storing-address-to-eeprom)å­˜å‚¨åœ°å€åˆ° EEPROM

[![Storing to EEPROM](img/e3b01333aa0cbf5a0cc4df911eb0e25e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--cwuYBVBi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-06_at_11-8cf61301-8e85-4d65-a2aa-fd37175194f5.07.24_PM.png)

åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠå›¾å—çš„åœ°å€å­˜å‚¨åˆ° EEPROM ä¸­ã€‚è¿™æ ·ï¼Œå½“è®¾å¤‡é‡æ–°å¯åŠ¨æˆ–æ–­ç”µæ—¶ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿåœ¨ä»¥åè¯†åˆ«ç£è´´ã€‚

ç„¶è€Œè¿˜æœ‰ä¸€ä¸ªæŒ¥ä¹‹ä¸å»çš„é—®é¢˜ã€‚æˆ‘ä»¬å¦‚ä½•è®©å®ƒé¦–å…ˆä¿å­˜åœ°å€ï¼Ÿ

é€šè¿‡ç›‘æ§æŒ‰é’®æŒ‰å‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†è®¾å¤‡ç½®äºâ€œå­¦ä¹ â€æ¨¡å¼ã€‚è¯¥è®¾å¤‡å°†æ‰«æç“·ç –ï¼Œå¹¶ä¿å­˜åœ°å€ï¼Œå¦‚æœæ‰¾åˆ°ä¸€ä¸ªã€‚

é¦–å…ˆè®©æˆ‘ä»¬åœ¨`if( uuids[i].shorted() == TILE_UUID )` :
ä¸­æ·»åŠ ä¸€ä¸ªæ¡ä»¶

```
// If we're in learning mode. Save to EEPROM
if( isLearningModeOn() ) {
    searchAddress = scanResult->address;
    EEPROM.put(TILE_EEPROM_ADDRESS, searchAddress);
    setLearningModeOff();
} 
```

æˆ‘ä»¬å°†ä½¿ç”¨ D7 çš„çŠ¶æ€ä½œä¸ºçŸ¥é“æˆ‘ä»¬å¤„äºâ€œå­¦ä¹ æ¨¡å¼â€çš„ä¸€ç§æ–¹å¼ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨`digitalRead(D7)`è¯»å– D7 æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥æ›´æ¸…æ¥šåœ°è¯´æ˜è¿™ä¸€ç‚¹:

```
bool isLearningModeOn() {
    return (digitalRead(D7) == HIGH);
} 
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ`digitalWrite(D7,LOW);`å’Œ`digitalWrite(D7,HIGH);`æ¢æˆç±»ä¼¼çš„åŠŸèƒ½ã€‚è¿™æ ·æˆ‘ä»¬åšçš„äº‹æƒ…å°±æ›´ç›´æ¥äº†ã€‚

```
// Set "Learning mode" on
void setLearningModeOn() {
    digitalWrite(D7,HIGH);
}

// Set "Learning mode" off
void setLearningModeOff() {
    digitalWrite(D7,LOW);
} 
```

ç„¶åï¼Œæˆ‘ä»¬æŒ‡å®šä¸€ä¸ªå…¨å±€å˜é‡`searchAddress`ä½œä¸ºæ‰«æç»“æœã€‚æˆ‘ä»¬åœ¨æ–‡ä»¶çš„é¡¶éƒ¨è¿™æ ·è®¾ç½®`searchAddress`:

```
BleAddress searchAddress; 
```

æ¥ä¸‹æ¥æˆ‘ä»¬æƒ³ä½¿ç”¨`EEPROM.put`å°†å…¶ä¿å­˜åˆ°éæ˜“å¤±æ€§å­˜å‚¨å™¨ä¸­ã€‚`TILE_EEPROM_ADDRESS`å®šä¹‰ä¸º`0xa`ã€‚ä½ å¯ä»¥å®šä¹‰`TILE_EEPROM_ADDRESS`æ¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„å†…å­˜åœ°å€ã€‚è¿™æ˜¯æ”¾åœ¨æ–‡ä»¶é¡¶éƒ¨çš„å®Œæ•´å®šä¹‰ã€‚

```
#define TILE_EEPROM_ADDRESS 0xa 
```

æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨`setLearningModeOff()`å…³é—­ LED å’Œâ€œå­¦ä¹ æ¨¡å¼â€

æ¯æ¬¡å‘ç°ä¸€ä¸ªè®¾å¤‡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`millis()`æ¥è®¾ç½®`lastSeen`ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`lastRSSI`è¿½è¸ªæœ€åä¸€ä¸ª RSSIã€‚è¿™æ˜¯ä¸€ç§çŸ¥é“è®¾å¤‡å¤§æ¦‚æœ‰å¤šè¿‘çš„å»‰ä»·æ–¹æ³•ã€‚æˆ‘ä»¬å°†ä½¿ç”¨`scanResult->rssi`æ¥è·å–è¿™äº›ä¿¡æ¯ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º`lastRSSI`å˜é‡ã€‚

æ€»çš„æ¥è¯´ï¼Œæ‚¨çš„æ›´æ”¹åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

```
...

// Print out the UUID we're looking for
if( uuids[i].shorted() == TILE_UUID ) {
    Log.trace("UUID: %x", uuids[i].shorted());

    // If we're in learning mode. Save to EEprom
    if( isLearningModeOn() ) {
        searchAddress = scanResult->address;
        EEPROM.put(TILE_EEPROM_ADDRESS, searchAddress);
        setLearningModeOff();
    }

    // Save info
    lastSeen = millis();
    lastRSSI = scanResult->rssi;

    // Stop scanning
    BLE.stopScanning();

    return;
} 
```

åœ¨æ­¤åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥è¿‡æ»¤æ‰ä¸æˆ‘ä»¬çš„`searchAddress`ä¸åŒ¹é…çš„è®¾å¤‡ã€‚åœ¨`if( uuids[i].shorted() == TILE_UUID )`å‰å¢åŠ ä»¥ä¸‹å†…å®¹:

```
// If device address doesn't match or we're not in "learning mode"
if( !(searchAddress == scanResult->address) && !isLearningModeOn() ) {
    return;
} 
```

è¿™å°†è·³è¿‡ä¸åŒ¹é…çš„è®¾å¤‡ã€‚åªæœ‰å½“åœ°å€åŒ¹é…æˆ–è€…æˆ‘ä»¬å¤„äºâ€œå­¦ä¹ æ¨¡å¼â€æ—¶ï¼Œå®ƒæ‰ä¼šç»§ç»­ã€‚

ç°åœ¨ï¼Œä¸ºäº†è®©æˆ‘ä»¬åœ¨å¯åŠ¨æ—¶åŠ è½½`searchAddress`ï¼Œæˆ‘ä»¬å¿…é¡»ä»é—ªå­˜ä¸­åŠ è½½å®ƒã€‚å°†æ­¤è¡Œæ·»åŠ åˆ°æ‚¨çš„`setup():`

```
EEPROM.get(TILE_EEPROM_ADDRESS, searchAddress); 
```

ç„¶åï¼Œæ£€æŸ¥ä»¥ç¡®ä¿åœ°å€æœ‰æ•ˆã€‚å¦‚æœæ‰€æœ‰å­—èŠ‚éƒ½æ˜¯`0xFF` :
åˆ™æ— æ•ˆ

```
// Warning about address
if( searchAddress == BleAddress("ff:ff:ff:ff:ff:ff") ) {
    Log.warn("Place this board into learning mode");
    Log.warn("and keep your Tile near by.");
} 
```

æˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿâ€œæ•™â€æˆ‘ä»¬çš„æ°©æˆ‘ä»¬çš„ç“·ç –çš„åœ°å€ã€‚è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼

### [](#test-it)æµ‹è¯•ä¸€ä¸‹ã€‚

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ç¼–è¯‘å¹¶è¿è¡Œè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œæ³¨æ„åˆ°æ²¡æœ‰æ›´å¤šçš„æ—¥å¿—è¾“å‡ºäº†å—ï¼Ÿæˆ‘ä»¬å¿…é¡»å°†å›¾å—åœ°å€â€œæ•™æˆâ€ç»™ç²’å­è®¾å¤‡ã€‚æ‰€ä»¥ï¼ŒæŒ‰ä¸‹æ¨¡å¼é”®ã€‚è“è‰² LED åº”è¯¥ä¼šäº®èµ·ã€‚

ä¸€æ—¦æ‰¾åˆ°æ‚¨çš„å›¾å—ï¼ŒLED å°†å…³é—­ï¼Œæ‚¨å°†åœ¨å‘½ä»¤è¡Œä¸Šçœ‹åˆ°ä¸€äº›è¾“å‡ºã€‚ç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„:

```
0000006296 [app] TRACE: MAC: D7:E7:FE:0C:A5:C0
0000006298 [app] TRACE: RSSI: -60Bm
0000006299 [app] TRACE: UUID: feed 
```

è®¾å¤‡å·²è¢«æäº¤åˆ°å†…å­˜ä¸­ï¼

æ‚¨è¿˜å¯ä»¥æ£€æŸ¥å¤ä½åå®ƒæ˜¯å¦ä»è¢«ä¿å­˜ã€‚ç‚¹å‡»**å¤ä½**æŒ‰é’®ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ä¸ä¸Šè¿°ç›¸åŒçš„è¾“å‡ºã€‚å¦‚æœå®ƒå‡ºç°äº†ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¥½çš„ï¼

## [](#update-the-cloud)æ›´æ–°äº‘ç«¯

[![Publishing to the Particle cloud](img/f8563b7a5296a82f15426762f079f10a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--K8DLukoO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-06_at_11-34eb3433-edb7-4b57-b3ca-3be935bba026.07.53_PM.png)

æœ€åè®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªåä¸º`checkTileStateChanged`çš„å‡½æ•°ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒå®šæœŸæ£€æŸ¥å›¾å—çŠ¶æ€çš„å˜åŒ–ã€‚

```
bool checkTileStateChanged( TilePresenceType *presence ) {

} 
```

è¯¥åŠŸèƒ½çš„ä¸»è¦ç›®çš„æ˜¯å°†`lastSeen`å˜é‡ä¸â€œè¶…æ—¶â€æŒç»­æ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„è¶…æ—¶æŒç»­æ—¶é—´æ˜¯`TILE_NOT_HERE_MS`ï¼Œå®ƒåº”è¯¥è¢«è®¾ç½®ä¸º

```
#define TILE_NOT_HERE_MS 30000 
```

é è¿‘ä½ ç¨‹åºçš„é¡¶ç«¯ã€‚è¿˜æœ‰ä¸¤ä¸ªæ¡ä»¶éœ€è¦è€ƒè™‘ã€‚ä¸€ä¸ªæ˜¯`lastSeen`ç­‰äº 0ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºåœ¨å¯åŠ¨åå°šæœªæ‰¾åˆ°ç£è´´ã€‚

æœ€åä¸€ç§æƒ…å†µæ˜¯è®¾å¤‡å·²ç»è¢«çœ‹åˆ°å¹¶ä¸”`lastSeen`ä¸ä¸º 0ã€‚å› æ­¤ï¼Œåœ¨`checkTileStateChanged`å†…ï¼Œè®©æˆ‘ä»¬å°†æ‰€æœ‰å†…å®¹æ”¾åœ¨ä¸€èµ·ã€‚

```
// Check to see if it's here.
if( millis() > lastSeen+TILE_NOT_HERE_MS ) {

} else if ( lastSeen == 0 ) {

} else {

}

return false; 
```

ç°åœ¨æˆ‘ä»¬åªå¸Œæœ›è¿™ä¸ªå‡½æ•°åœ¨çŠ¶æ€å·²ç»æ”¹å˜çš„æƒ…å†µä¸‹è¿”å›çœŸå€¼**ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ©ç”¨åè®®ä¸­çš„`TilePresenceType`æŒ‡é’ˆã€‚**

 **ç®€å•åœ°åˆ—ä¸¾æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒè´´åœ¨ä½ æ–‡ä»¶çš„é¡¶éƒ¨ã€‚å°±æ˜¯è¿™é‡Œ:

```
typedef enum {
    PresenceUnknown,
    Here,
    NotHere
} TilePresenceType; 
```

æ‚¨è¿˜éœ€è¦ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä¼ é€’ç»™å‡½æ•°ã€‚æŠŠè¿™ä¸ªä¹Ÿæ”¾åœ¨ä½ æ–‡ä»¶çš„é¡¶éƒ¨:

```
// Default status
TilePresenceType present = PresenceUnknown; 
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªé˜¶æ®µè¿›è¡Œæ¯”è¾ƒã€‚ç¬¦åˆæ ‡å‡†å—ï¼ŸçŠ¶æ€å’Œä¸Šä¸€ä¸ªä¸ä¸€æ ·å—ï¼Ÿå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› trueã€‚

è®°ä½ï¼Œæˆ‘ä»¬å¸Œæœ›å°†`presence`è®¾ç½®ä¸ºæ–°çš„æ›´æ–°å€¼ã€‚æ‰€ä»¥æ¯ä¸ªæ¡ä»¶éƒ½åº”è¯¥æ›´æ–°å­˜åœ¨å€¼ã€‚æ¯”å¦‚:

```
*presence = NotHere; 
```

ä¸‹é¢æ˜¯å®Œå…¨æ¸…é™¤å‡½æ•°çš„æ ·å­:

```
bool checkTileStateChanged( TilePresenceType *presence ) {

    // Check to see if it's here.
    if( millis() > lastSeen+TILE_NOT_HERE_MS ) {
        if( *presence != NotHere ) {
            *presence = NotHere;
            Log.trace("not here!");
            return true;
        }
    // Case if we've just started up
    } else if ( lastSeen == 0 ) {
        if( *presence != PresenceUnknown ) {
            *presence = PresenceUnknown;
            Log.trace("unknown!");
            return true;
        }
    // Case if lastSeen is < TILE_NOT_HERE_MS
    } else {
        if( *presence != Here ) {
            *presence = Here;
            Log.trace("here!");
            return true;
        }
    }

    return false;
} 
```

æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨å®šæ—¶å™¨ä¸‹é¢çš„ä¸»å¾ªç¯ä¸­ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥å¯åŠ¨`Ble.scan()`ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å‘é€ JSON æœ‰æ•ˆè½½è·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†åŒ…æ‹¬é‡è¦ä¿¡æ¯ï¼Œå¦‚è“ç‰™åœ°å€ã€`lastSeen`æ•°æ®ã€`lastRSSI`æ•°æ®å’Œä¸€æ¡æ¶ˆæ¯ã€‚

```
// If we have a change
if( checkTileStateChanged(&present) ) {

} 
```

æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªæ•°ç»„`char`æ¥è·å–å­—ç¬¦ä¸²æ ¼å¼çš„åœ°å€ã€‚ä½ å¯ä»¥æŠŠ`toString()`å’Œ`toCharArray`é“¾åœ¨ä¸€èµ·ï¼Œå¾—åˆ°æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ã€‚

```
// Get the address string
char address[18];
searchAddress.toString().toCharArray(address,sizeof(address)); 
```

ä¸€ä¸ªç¤ºä¾‹æœ‰æ•ˆè´Ÿè½½å­—ç¬¦ä¸²å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·:

```
// Create payload
status = String::format("{\"address\":\"%s\",\"lastSeen\":%d,\"lastRSSI\":%i,\"status\":\"%s\"}",
    address, lastSeen, lastRSSI, messages[present]); 
```

`status`åªæ˜¯ä¸€ä¸ªå®šä¹‰åœ¨æ–‡ä»¶é¡¶éƒ¨çš„å­—ç¬¦ä¸²:

```
// The payload going to the cloud
String status; 
```

æ‚¨ä¼šæ³¨æ„åˆ°è¿˜æœ‰ä¸€ä¸ªåä¸º`messages`çš„å˜é‡ã€‚è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„é™æ€å¸¸é‡æ•°ç»„ã€‚å®ƒä»¬è¢«æ˜ å°„åˆ°æ¥è‡ª`TilePresenceType`çš„å€¼ã€‚ä¸‹é¢æ˜¯å®ƒçš„æ ·å­

```
const char * messages[] {
    "unknown",
    "here",
    "not here"
}; 
```

è¿™æ ·`PresenceUnknown`åŒ¹é…åˆ°`"unknown"`ï¼Œ`Here`åŒ¹é…åˆ°`"here"`ï¼Œä»¥æ­¤ç±»æ¨ã€‚è¿™æ˜¯ä¸€ç§å°†å­—ç¬¦ä¸²ä¸æšä¸¾å…³è”èµ·æ¥çš„ç®€å•è€Œå»‰ä»·çš„æ–¹æ³•ã€‚

æœ€åï¼Œæˆ‘ä»¬å°†å‘å¸ƒå’Œå¤„ç†ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿç«‹å³å‘é€æ›´æ–°ã€‚

```
// Publish the RSSI and Device Info
Particle.publish("status", status, PRIVATE, WITH_ACK);

// Process the publish event immediately
Particle.process(); 
```

æœ€ç»ˆçš„æ•´ä½“åŠŸèƒ½åº”è¯¥æ˜¯è¿™æ ·çš„:

```
// If we have a change
if( checkTileStateChanged(&present) ) {

    // Get the address string
    char address[18];
    searchAddress.toString().toCharArray(address,sizeof(address));

    // Create payload
    status = String::format("{\"address\":\"%s\",\"lastSeen\":%d,\"lastRSSI\":%i,\"status\":\"%s\"}",
        address, lastSeen, lastRSSI, messages[present]);

    // Publish the RSSI and Device Info
    Particle.publish("status", status, PRIVATE, WITH_ACK);

    // Process the publish event immediately
    Particle.process();

} 
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼

### [](#testing-it)æµ‹è¯•ä¸€ä¸‹ï¼

[![Test results in terminal window](img/9c4ba8ee29ff0d18dfa863ca471cc87f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--a9gXUCtU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-06_at_11-97c0bda9-1ba1-4c75-8bd7-4db655d35d51.27.35_PM.png)

æˆ‘ä»¬å¯ä»¥è¿›è¡Œæµ‹è¯•ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬çš„å‘å¸ƒäº‹ä»¶åœ¨æ²¡æœ‰äº‹ä»¶ç¦»å¼€ç²’å­å·¥ä½œå°çš„æƒ…å†µä¸‹å‘ç”Ÿã€‚è¿›å…¥**è§†å›¾â†’ç»ˆç«¯ï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯ã€‚**ç„¶åä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤:

```
particle subscribe --device <device_name> <event_name> 
```

ç”¨æ‚¨è®¾å¤‡çš„åç§°æˆ– ID æ›¿æ¢`<device_name>`ã€‚

å°†`<event_name>`æ›¿æ¢ä¸ºäº‹ä»¶çš„åç§°ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯`status`ã€‚

ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡å–å‡ºç”µæ± å¹¶ç­‰å¾…â€œä¸åœ¨è¿™é‡Œâ€çš„æç¤ºæ¥æµ‹è¯•è¿™ä¸€åˆ‡ã€‚æ’ä¸Šç”µæ± ï¼Œä½ åº”è¯¥ä¼šå¾—åˆ°ä¸€ä¸ªâ€œè¿™é‡Œâ€çš„æç¤ºã€‚

è¿™æ˜¯è¾“å‡ºçš„ä¸€ä¸ªä¾‹å­

```
> particle subscribe --device hamster_turkey status

è®¢é˜…æ¥è‡ªä»“é¼  _ åœŸè€³å…¶çš„æµ
çš„â€œçŠ¶æ€â€æ­£åœ¨æ”¶å¬:/v1/devices/ä»“é¼  _ åœŸè€³å…¶/events/status
{ " name ":" status "ï¼Œ" data ":" { \ " address \ ":\ " C0:A5:0C:FE:E7:D7 \ "ï¼Œ\"lastSeen\":40154002ï¼Œ\"lastRSSI\":-82ï¼Œ\"status\":\ "ä¸åœ¨è¿™é‡Œ\"}ï¼Œ" ttl":60ï¼Œ" published _ at ":" 2019-09-07t 02:201 
```

## 
 [](#configuring-webhook) 
é…ç½®ç½‘é¡µé’©å­

åœ¨æœ¬æ•™ç¨‹çš„æœ€åä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ webhook è®¾ç½®æ¨é€é€šçŸ¥ã€‚å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Pushover å’Œå®ƒä»¬çš„ä¾¿æ· API å‘æ‚¨é€‰æ‹©çš„è®¾å¤‡å‘é€æ¨é€é€šçŸ¥ã€‚

Pushover æœ‰ä¸€ä¸ªéå¸¸å®¹æ˜“ä½¿ç”¨çš„ APIã€‚ä»–ä»¬çš„åº”ç”¨ç¨‹åºæ˜¯ä¸€æŠŠç‘å£«å†›åˆ€ï¼Œé€‚ç”¨äºä½ ä¸æƒ³ç¼–å†™åº”ç”¨ç¨‹åºæ¥å‘é€æ¨é€é€šçŸ¥çš„æƒ…å†µã€‚

ä½ è¦æ³¨æ„çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä½ çš„**ç”¨æˆ·å¯†é’¥ã€‚**ç™»å½• Pushover å³å¯è·å¾—ã€‚æ³¨æ„:å¦‚æœæ‚¨è¿˜æ²¡æœ‰å¸æˆ·ï¼Œæ‚¨éœ€è¦å…ˆè®¾ç½®ä¸€ä¸ªå¸æˆ·ã€‚

å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„:

[![Pushover main screen](img/67a160fdf5e50f9dee14d28861b9a167.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--MXsHfodL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-03_at_3-e71c60fd-ef57-4e5f-a7a5-e836b36af15e.39.36_PM.png)

å¦‚æœä½ ç™»å½•åçœ‹ä¸åˆ°è¿™ä¸ªé¡µé¢ï¼Œç‚¹å‡» **Pushover æ ‡å¿—**ï¼Œåº”è¯¥ä¼šæŠŠä½ å¸¦å›æ¥ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ç‚¹å‡»å±å¹•ä¸Šæ–¹çš„**åº”ç”¨ç¨‹åº&æ’ä»¶**ã€‚

[![App/Plugins screen in Pushover](img/3b09f8e4dd50d6cc963fdad4b2365ba9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--nkieUOiQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-03_at_3-3144b865-133a-4778-b349-37ebb333ede7.39.42_PM.png)

ç„¶åä½ åº”è¯¥ç‚¹å‡»**åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºã€‚**è¿™å°†å…è®¸æˆ‘ä»¬è·å¾—ä¸€ä¸ª **API ä»¤ç‰Œ**ï¼Œè¿™å°†æ˜¯ç²’å­ç½‘ç»œé’©å­è®¾ç½®æ‰€éœ€è¦çš„ã€‚

[![Create a New Application](img/b4f749eed0ab54971e7a5f09f13d0b02.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ELiTtJW_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-05_at_11-c5628ee5-3aa9-4e82-b302-051278631a6b.49.21_AM.png)

è®¾ç½®ä¸€ä¸ªä½ è®¤ä¸ºåˆé€‚çš„åå­—ã€‚å¦‚æœæ‚¨éœ€è¦æé†’ï¼Œè¯·å¡«å†™æè¿°ã€‚**ç‚¹å‡»æ–¹æ¡†**ç„¶åç‚¹å‡»**åˆ›å»ºåº”ç”¨ã€‚**

ä½ åº”è¯¥ç¿»åˆ°ä¸‹ä¸€é¡µã€‚å¤åˆ¶å¹¶ä¿å­˜ **API ä»¤ç‰Œ/å¯†é’¥**æˆ‘ä»¬è¿˜éœ€è¦å‡ ä¸ªæ­¥éª¤ã€‚

[![Viewing Application with API key](img/aaa876f3d954de7d48606072d820afec.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--a8LQg_8i--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-03_at_3-a9e88ba1-dcb8-4b4d-8f20-a67e70e84ff5.39.50_PM.png)

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è®¾ç½® Webhookã€‚è·³è½¬åˆ°[https://console . particle . io](https://console.particle.io/)å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„é›†æˆã€‚

[![Particle console creating new Webhook](img/d4673357eff417e820af754bc2d5142c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Dql9kKDi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-03_at_3-ef788a5e-710f-4457-9b04-133d4ecf5f94.41.55_PM.png)

æˆ‘ä»¬å°†æŠŠ**äº‹ä»¶åç§°**è®¾ç½®ä¸º**çŠ¶æ€**ã€‚

**ç½‘å€**åˆ°**T3ã€‘https://api.pushover.net/1/messages.jsonT5ã€‘**

æ­¤å¤–ï¼Œå¦‚æœæ‚¨æƒ³é€šè¿‡ç‰¹å®šè®¾å¤‡è¿›è¡Œè¿‡æ»¤ï¼Œè¯·ç¡®ä¿åœ¨**è®¾å¤‡ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©è¯¥è®¾å¤‡ã€‚**

åœ¨**é«˜çº§è®¾ç½®**ä¸‹ï¼Œæˆ‘ä»¬å°†é€šè¿‡è®¾ç½®å‡ ä¸ªå­—æ®µæ¥ç»“æŸã€‚

[![Setting the token and api key in Particle Webhook](img/544d34dc50156a18764ba5c9dc19d2c0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--TzeRk7QT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Screen_Shot_2019-09-03_at_3-831e153a-bb8c-4d73-98c4-61a958c9c51a.42.01_PM.png)

åˆ›å»ºä»¥ä¸‹å­—æ®µ:**ä»¤ç‰Œã€** **ç”¨æˆ·**ã€**å¤´è¡”**å’Œ**æ¶ˆæ¯**ã€‚ç„¶åå°† token è®¾ç½®ä¸ºæˆ‘ä»¬ä¹‹å‰å¾—åˆ°çš„ **API Token** ã€‚å¯¹**ç”¨æˆ·é”®è¿›è¡ŒåŒæ ·çš„æ“ä½œã€‚**

**æ ‡é¢˜**å°†æ˜¾ç¤ºä¸ºæ‚¨æ¶ˆæ¯çš„æ ‡é¢˜ã€‚åšå¯¹ä½ æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚

æ‚¨å¯ä»¥å°†**æ¶ˆæ¯**è®¾ç½®ä¸º`The Tile is currently {{{status}}}. RSSI: {{{lastRSSI}}}`ã€‚

æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨å°èƒ¡å­æ¨¡æ¿ã€‚å®ƒä»¬å…è®¸æ‚¨ä½¿ç”¨å‘å¸ƒçš„æœ‰æ•ˆè´Ÿè½½ä¸­çš„æ•°æ®ï¼Œå¹¶æ ¹æ®æ‚¨çš„å–œå¥½é‡æ–°æ ¼å¼åŒ–å®ƒã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨å®ƒä»¬æ¥â€œå¡«è¡¥ç©ºç™½â€ç»è¿‡å¤„ç†çš„**æ¶ˆæ¯**çœ‹èµ·æ¥ä¼šåƒè¿™æ ·:

`The Tile is currently here. RSSI: -77`

é¡ºä¾¿æä¸€ä¸‹ï¼Œæˆ‘å°†åœ¨æˆ‘çš„æŒ‡å—ä¸­æ›´å¤šåœ°è®¨è®ºè¿™äº›æ¨¡æ¿ã€‚æ•¬è¯·å…³æ³¨ï¼

### [](#test-it)æµ‹è¯•ä¸€ä¸‹

ä¸€æ—¦æ‚¨çš„é›†æˆå°±ä½ï¼Œæ‚¨å°±å¯ä»¥æµ‹è¯•æˆ‘ä»¬åœ¨å‰é¢æ­¥éª¤ä¸­æ‰€åšçš„äº‹æƒ…ã€‚å–å‡ºç”µæ± ï¼Œç­‰å¾…â€œä¸åœ¨è¿™é‡Œâ€çš„æ¶ˆæ¯ã€‚æŠŠå®ƒæ”¾å›å»ï¼Œç­‰ç€â€œåˆ°äº†â€çš„æ¶ˆæ¯ã€‚

è¿™æ˜¯å®ƒåœ¨ iPhone ä¸Šçš„æ ·å­:

[![Pushover messages from Particle Cloud](img/8e6e55a5d4a4964694568f05ec59b55a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--dauMFq-Z--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-location-tracking-using-particle-meimg/Pushover-58cbd968-ffbe-4aa5-9087-de6f98708715.png)

å¦‚ä½ æ‰€è§ï¼Œæˆ‘æµ‹è¯•äº†ä¸€å †ï¼ğŸ˜¬

å¦‚æœä½ å·²ç»åšåˆ°äº†è¿™ä¸€æ­¥ï¼Œè€Œä¸”ä¸€åˆ‡æ­£å¸¸ï¼Œé‚£å°±å¤ªæ£’äº†ã€‚ä½ ç°åœ¨æœ‰ä¸€ä¸ªç“·ç –è¿½è¸ªå™¨ä¸ºä½ çš„æˆ¿å­ï¼ŒåŠå…¬å®¤æˆ–ä»»ä½•åœ°æ–¹ã€‚

## [](#the-code)ä»£ç 

å¯»æ‰¾è¿™ä¸ªä¾‹å­çš„å®Œæ•´ä»£ç ï¼Ÿæˆ‘ä¹Ÿä¼šçš„ï¼å®ƒæ‰˜ç®¡åœ¨ Github ä¸Šï¼Œåœ¨è¿™é‡Œå¯ä»¥æ‰¾åˆ°ã€‚

## [](#conclusion)ç»“è®º

å¯ä»¥æƒ³è±¡ï¼Œæœ¬æ–‡ä¸­ä½¿ç”¨çš„æŠ€å·§å’ŒæŠ€æœ¯å¯ä»¥æœ‰å¤šç§ç”¨é€”ã€‚è®©æˆ‘ä»¬æ€»ç»“ä¸€äº›è¦ç‚¹:

1.  ä½¿ç”¨ Bluetooth Central æ‰«æå¹¶è¯†åˆ«ç°æˆçš„å›¾å—è®¾å¤‡
2.  å°†åŒºå—è¯†åˆ«ä¿¡æ¯å­˜å‚¨åˆ° EEPROMã€‚è¿™æ ·å°±å¯ä»¥åœ¨å¯åŠ¨æ—¶æ£€ç´¢å®ƒã€‚
3.  ä½¿ç”¨æˆ‘ä»¬ç†Ÿæ‚‰çš„`Particle.publish`å‘äº‘æ¨é€æ›´æ–°ã€‚
4.  ä½¿ç”¨ç²’å­é›†æˆ Webhook åˆ›å»ºçŠ¶æ€å˜åŒ–çš„æ¨é€é€šçŸ¥ã€‚

ç°åœ¨ä½ å·²ç»æœ‰äº†ä¸€åˆ‡ï¼Œæ‰©å±•å®ƒï¼Œç ´è§£å®ƒï¼Œè®©å®ƒæˆä¸ºä½ çš„ã€‚å“¦ï¼Œåˆ«å¿˜äº†åˆ†äº«ï¼æˆ‘å¾ˆä¹æ„æ”¶åˆ°ä½ çš„æ¥ä¿¡ã€‚[hello@jaredwolff.com](mailto:hello@jaredwolff.com)

å–œæ¬¢è¿™ä¸ªå¸–å­ï¼Ÿ[ä¸ä¸–ç•Œåˆ†äº«ï¼](http://twitter.com/share?text=Check%20out%20this%20handy%20guide%20for%20doing%20presence%20detection%20with%20Tile%20Mate%20and%20Particle%20Mesh!&url=https://www.jaredwolff.com/how-to-location-tracking-using-particle-mesh/&hashtags=iot)

æœ‰å…´è¶£äº†è§£æ›´å¤šä¿¡æ¯å—ï¼Ÿæˆ‘æ­£åœ¨å†™ä¸€ç¯‡å…³äºå¦‚ä½•å……åˆ†åˆ©ç”¨ç²’å­å¹³å°çš„æŒ‡å—ã€‚ç‚¹å‡»æ­¤å¤„äº†è§£æ›´å¤šä¿¡æ¯ã€‚*****