# ç”¨é’©å­æ”¹å˜è¿œç¨‹æ•°æ®

> åŸæ–‡:[https://dev.to/juliang/changing-remote-data-with-hooks-565p](https://dev.to/juliang/changing-remote-data-with-hooks-565p)

åœ¨æœ¬ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨çŠ¶æ€ç®¡ç†åº“æˆ–æå‡ºä¸€ä¸ªé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯ä»æœ€ä½é™åº¦å¼€å§‹ï¼Œæ ¹æ®éœ€è¦æ„å»ºæˆ‘ä»¬çš„çŠ¶æ€ç®¡ç†ã€‚

* * *

*   åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†å¦‚ä½•ç”¨é’©å­è£…è½½å’Œæ˜¾ç¤ºæ•°æ®ã€‚
*   åœ¨ç¬¬äºŒç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ç”¨é’©å­æ”¹å˜è¿œç¨‹æ•°æ®ã€‚
*   åœ¨ç¬¬ä¸‰ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ React Context åœ¨ç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®ï¼Œè€Œä¸ä½¿ç”¨å…¨å±€å˜é‡ã€å•ä¾‹å˜é‡æˆ–æ±‚åŠ©äº MobX æˆ– Redux ç­‰çŠ¶æ€ç®¡ç†åº“ã€‚
*   åœ¨ç¬¬å››ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ [SWR](https://swr.now.sh/) åœ¨ç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®ï¼Œè¿™å¯èƒ½æ˜¯æˆ‘ä»¬ä»ä¸€å¼€å§‹å°±åº”è¯¥åšçš„ã€‚

* * *

æœ€ç»ˆä»£ç å¯ä»¥åœ¨è¿™ä¸ª [GitHub repo](https://github.com/JulianG/minimal-state-management-demo) ä¸­æ‰¾åˆ°ã€‚å®ƒæ˜¯ TypeScriptï¼Œä½†æ˜¯ç±»å‹æ³¨é‡Šå¾ˆå°‘ã€‚**å¦å¤–ï¼Œè¯·æ³¨æ„è¿™ä¸æ˜¯ç”Ÿäº§ä»£ç ã€‚**ä¸ºäº†ä¸“æ³¨äºçŠ¶æ€ç®¡ç†ï¼Œè®¸å¤šå…¶ä»–æ–¹é¢æ²¡æœ‰è¢«è€ƒè™‘(ä¾‹å¦‚[ä¾èµ–å€’ç½®](https://en.wikipedia.org/wiki/Dependency_inversion_principle)ï¼Œæµ‹è¯•æˆ–ä¼˜åŒ–)ã€‚

## [](#changing-remote-data-with-hooks)ç”¨é’©å­æ”¹å˜è¿œç¨‹æ•°æ®

æˆ‘ä»¬æœ‰ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„æ¸¸æˆåˆ—è¡¨ã€‚**ç°åœ¨æœ‰äº†ä¸€ä¸ªæ–°çš„éœ€æ±‚:**æˆ‘ä»¬æƒ³è®©ç”¨æˆ·å°†æ¯ä¸ªæ¸¸æˆæ ‡è®°ä¸ºâ€œå®Œæˆâ€ã€‚å½“ä»–ä»¬è¿™æ ·åšæ—¶ï¼Œæˆ‘ä»¬ä¼šç«‹å³å°†æ›´æ”¹å‘é€åˆ°æœåŠ¡å™¨ã€‚

[![my favourite commodore 64 games](img/c88a527b78bc6c3a1b57ce37570a4f53.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Ly-92f-8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/qbx38iq5guj2me3jnrkc.png)

ä¸ºäº†å°†`"status"`çš„å€¼ä»`"in-progress"`æ›´æ”¹ä¸º`"finished"`ï¼Œæˆ‘ä»¬å‘å‡ºä¸€ä¸ª **`PATCH`** è¯·æ±‚:

```
const setGameStatus = (id: number, status: Game['status']): Promise<Game> => {
  return fetch('http://localhost:3001/games/' + id, {
    method: "PATCH",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ status: status })
    })
    .then(response => response.json());
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨å®ƒ:

```
const promise = setGameStatus(7, "finished"); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†æ˜¯ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªä»£ç æ”¾åœ¨å“ªé‡Œå‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ä»å¦ä¸€ç«¯æ¥å¤„ç†è¿™ä¸ªé—®é¢˜:**æˆ‘ä»¬ä¼šå¦‚ä½•ä½¿ç”¨æˆ‘ä»¬çš„é’©å­å‘¢ï¼Ÿ**

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`GameComponent`æ¥æ¸²æŸ“ä¸€ä¸ªæ¸¸æˆï¼Œç”¨ onClick å¤„ç†ç¨‹åºå°†å®ƒæ ‡è®°ä¸ºå®Œæˆã€‚

* * *

***æ³¨æ„:*** *ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†å¿«é€Ÿåˆ¶ä½œä¸€ä¸ªåŒ…å«æ‰€æœ‰å†…å®¹çš„`<pre>`ï¼ŒåŒ…æ‹¬`onClick`å¤„ç†ç¨‹åºã€‚*

* * *

```
type GameComponentProps = { game: Game; markAsFinished: (id:number) => void };

const GameComponent = ({ game, markAsFinished }: GameComponentProps) => {
  return (
    <pre onClick={() => markAsFinished(game.id)}>
      Title: {game.title}
      Year: {game.year}
      Status: {game.status}
    </pre>
  );
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªæ–°ç»„ä»¶éœ€è¦ä¸€ä¸ª`game`å¯¹è±¡å’Œä¸€ä¸ª`markAsFinished`å‡½æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„è‡ªå®šä¹‰é’©å­åº”è¯¥è¿”å›ä¸€ä¸ªå‡½æ•°ä»¥åŠæ¸¸æˆåˆ—è¡¨ï¼Œé”™è¯¯å’Œæœªå†³:

```
//const { games, error, isPending } = useGames();
  const { games, error, isPending, markAsFinished } = useGames(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†å…è®¸æˆ‘ä»¬å‘ˆç°è¿™æ ·çš„æ¸¸æˆåˆ—è¡¨:

```
export const App = () => {
  const { games, error, isPending, markAsFinished } = useGames();

  return (
    <>
      {error && <pre>ERROR! {error}...</pre>}
      {isPending && <pre>LOADING...</pre>}
      <ol>
        {games.map(game => (
          <li key={game.id}>
            <GameComponent game={game} markAsFinished={markAsFinished} />
          </li>
        ))}
      </ol>
    </>
  );
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é‚£æ˜¯æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„ã€‚è®©æˆ‘ä»¬æ”¹å˜ä¸€ä¸‹æˆ‘ä»¬çš„`useGames`é’©å­å®ç°ã€‚

ä»¥ä¸‹æ˜¯ç›®å‰ä¸ºæ­¢çš„æ ·å­:

```
export const useGames = () => {
  const [games, error, isPending] = useAsyncFunction(getGames, emptyList);
  return { games, error, isPending };
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬éœ€è¦è¿”å›ä¸€ä¸ª`markAsFinished`å‡½æ•°ã€‚

```
export const useGames = () => {
  const [games, error, isPending] = useAsyncFunction(getGames, emptyList);

  const markAsFinished = (id: number) => {
    setGameStatus(id, 'finished'); // setGameStatus is already defined outside the hook
  };

  return { games, error, isPending, markAsFinished };
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€šè¿‡è¿™æ®µä»£ç ( *[å‚è§ repo](https://github.com/JulianG/minimal-state-management-demo/tree/04-patch-server-data/src)* )æˆ‘ä»¬ç°åœ¨å°†æˆ‘ä»¬çš„æ›´æ”¹å‘é€åˆ°æœåŠ¡å™¨**ï¼Œä½†æ˜¯é™¤éæˆ‘ä»¬é‡æ–°åŠ è½½é¡µé¢å¹¶å†æ¬¡è·å–æ¸¸æˆåˆ—è¡¨ï¼Œå¦åˆ™æˆ‘ä»¬çš„å®¢æˆ·ç«¯æ•°æ®ä¸ä¼šå—åˆ°å½±å“ã€‚**

### [](#updating-clientside-data)æ›´æ–°å®¢æˆ·ç«¯æ•°æ®

ç°åœ¨æœåŠ¡å™¨æœ‰äº†æ›´æ–°åçš„å€¼ï¼Œä½†æ˜¯å®¢æˆ·æœºæ²¡æœ‰:åˆ—è¡¨åœ¨æ›´æ”¹åæ²¡æœ‰æ›´æ–°ã€‚

```
const markAsFinished = (id: number) => {
  setGameStatus(id, 'finished')
    .then(game => ?????); // ğŸ¤”
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬çš„æœåŠ¡å™¨çš„`PATCH`è¯·æ±‚è¿”å›ä¸€ä¸ªå¸¦æœ‰ä¿®æ”¹åçš„æ¸¸æˆå¯¹è±¡çš„æ‰¿è¯ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ›´æ–°æˆ‘ä»¬çš„å®¢æˆ·ç«¯åˆ—è¡¨ã€‚æ— éœ€åœ¨â€œæ‰“è¡¥ä¸â€åé‡æ–°è·å–æ¸¸æˆåˆ—è¡¨ç”šè‡³æ˜¯å—å½±å“çš„æ¸¸æˆã€‚

```
const markAsFinished = (id: number) => {
  setGameStatus(id, 'finished')
    .then(updateGame); // ğŸ¤” we need to define updateGame
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬çš„`updateGame`å‡½æ•°å°†å¤åˆ¶æ¸¸æˆæ•°ç»„ï¼Œé€šè¿‡ id æ‰¾åˆ°æ¸¸æˆå¹¶ç”¨æ–°çš„æ›¿æ¢å®ƒã€‚

```
export const useGames = () => {
  const [games, error, isPending] = useAsyncFunction(getGames, emptyList);

  const updateGame = (game: Game) => {
    const index = games.findIndex(g => g.id === game.id);
    if (index >= 0) {
      const gamesCopy = games.slice();
      gamesCopy[index] = game;
      setGames(gamesCopy); // ğŸ¤” I don't see setGames declared anywhere...
    }
  }
  const markAsFinished = (id: number) => {
    setGameStatus(id, 'finished').then(updateGame);
  };

  return { games, error, isPending, markAsFinished };
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å“¦ï¼æˆ‘ä»¬æ²¡æœ‰`setGames`åŠŸèƒ½ã€‚æˆ‘ä»¬çš„`useAsyncFunction`æ²¡æœ‰æä¾›ä»å¤–éƒ¨è®¾ç½®å€¼çš„æ–¹æ³•ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸æƒ³ä¿®æ”¹å®ƒï¼Œå› ä¸ºåœ¨ç°å®ä¸–ç•Œçš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”¨ [react-async](https://www.npmjs.com/package/react-async) æ¥æ›¿æ¢å®ƒçš„åŠŸèƒ½ã€‚

æˆ‘ä»¬å¯ä»¥æ”¹å˜æˆ‘ä»¬çš„`useGames`è‡ªå®šä¹‰é’©å­æ¥ä¿æŒçŠ¶æ€ï¼Œå¹¶ä¸”æ¯å½“`fetchedGames`æ”¹å˜æ—¶(æˆ–è€…å½“æˆ‘ä»¬è°ƒç”¨`setGames`æ—¶ï¼Œå½“ç„¶)æ›´æ–°å®ƒã€‚

```
export const useGames = () => {
  const [fetchedGames, error, isPending] = useAsyncFunction(getGames, emptyList);

  const [games, setGames] = React.useState(emptyList); // ğŸ˜ now we have setGames!
  React.useEffect(() => {
    setGames(fetchedGames);
  }, [fetchedGames]);

  ... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬çš„`useGame`é’©å­æ–‡ä»¶ç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„( *[å‚è§å›è´­ä¸­çš„æ•´ä¸ªæ–‡ä»¶](https://github.com/JulianG/minimal-state-management-demo/blob/05-update-client-data/src/useGames.ts)* )

```
export const useGames = () => {
  const [fetchedGames, error, isPending] = useAsyncFunction(getGames, emptyList);

  const [games, setGames] = React.useState(emptyList);
  React.useEffect(() => {
    setGames(fetchedGames);
  }, [fetchedGames]);

  const updateGame = (game: Game) => {
    const index = games.findIndex(g => g.id === game.id);
    if (index >= 0) {
      const gamesCopy = games.slice();
      gamesCopy[index] = game;
      setGames(gamesCopy);
    }
  };
  const markAsFinished = (id: number) => {
    setGameStatus(id, 'finished').then(updateGame);
  };

  return { games, error, isPending, markAsFinished };
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#refactoring)é‡æ„

è¿™çœ‹èµ·æ¥æœ‰ç‚¹ä¹±ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶æå–åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„é’©å­:

```
const useFetchedGames = () => {
  const [fetchedGames, error, isPending] = useAsyncFunction(getGames, emptyList);

  const [games, setGames] = React.useState(emptyList);
  React.useEffect(() => {
    setGames(fetchedGames);
  }, [fetchedGames]);

  return {games, setGames, error, isPending};
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
export const useGames = () => {
  const { games, error, isPending, setGames } = useFetchedGames();
    ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

( *[å‚è§å›è´­ä¸­çš„æ•´ä¸ªæ–‡ä»¶](https://github.com/JulianG/minimal-state-management-demo/blob/05-update-client-data-refactored/src/useGames.ts)* )

### [](#handling-errors)å¤„ç†é”™è¯¯

```
âŒ 404 Not Found 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±åƒä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬å·²ç»å¿˜è®°äº†å¤„ç†é”™è¯¯ã€‚å½“`PATCH`è¯·æ±‚å¤±è´¥æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªè°ƒç”¨æœåŠ¡å™¨çš„å‡½æ•°ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ª(`getGames`)æ£€æŸ¥å“åº”çš„çŠ¶æ€ä»£ç ã€‚

```
const getGames = (): Promise<Game[]> => {
  return fetch('http://localhost:3001/games/').then(response => {
    if (response.status !== 200) {
      throw new Error(`${response.status}  ${response.statusText}`);
    }
    return response.json();
  });
};

export const setGameStatus = (id: number, status: Game['status']): Promise<Game> => {
  return fetch('http://localhost:3001/games/' + id, {
    method: 'PATCH',
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ status: status })
  }).then(response => response.json()); // ğŸ˜° no error handling
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä¸æƒ³é‡å¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æŠŠé”™è¯¯å¤„ç†æå–åˆ°ä¸€ä¸ªæ–°å‡½æ•°ä¸­ï¼Œå¹¶åœ¨ä¸¤ç§æƒ…å†µä¸‹éƒ½ä½¿ç”¨å®ƒã€‚

```
function parseResponse<T>(response: Response): Promise<T> {
  if (response.status !== 200) {
    throw new Error(`${response.status}  ${response.statusText}`);
  }
  return response.json();
}

export const getGames = (): Promise<Game[]> => {
  return fetch('http://localhost:3001/games/').then(response =>
    parseResponse(response)
  );
};

export const setGameStatus = (id: number, status: Game['status']): Promise<Game> => {
  return fetch('http://localhost:3001/games/' + id, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ status: status })
  }).then(response => parseResponse(response));
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†ä¿æŒæ•´æ´ï¼Œæˆ‘ä»¬å°†è¿™äº›å‡½æ•°ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„ **gameClientAPI.ts** æ–‡ä»¶ä¸­( *[è§ repo](https://github.com/JulianG/minimal-state-management-demo/blob/06-error-handling-1/src/gameClientAPI.ts)* )ã€‚æˆ‘ä»¬çš„`useGames`é’©å­ä»å®ƒé‚£é‡Œå¯¼å…¥å‡½æ•°ã€‚æˆ‘ä»¬æ­£åœ¨åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œå¹¶ä¿æŒæˆ‘ä»¬çš„æ–‡ä»¶ç®€çŸ­ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥æ•æ‰æ¥è‡ª`markAsFinished` :
çš„é”™è¯¯

```
const markAsFinished = (id: number) => {
  setGameStatus(id, 'finished')
    .then(updateGame)
    .catch(error =>
      alert(
        `There was a problem updating this game.\n` +
          `Please try again later.\n\n` +
          `(${error.toString()})`
      )
    );
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

( *[è§å›è´­](https://github.com/JulianG/minimal-state-management-demo/blob/06-error-handling-2/src/useGames.ts)* )

## [](#conclusion)ç»“è®º

æˆ‘ä»¬å·²ç»æˆåŠŸåœ°ä»¥è‡ªå®šä¹‰ React æŒ‚é’©çš„å½¢å¼å°†å‘½ä»¤å¼ API åŒ…è£…åœ¨æ›´å…·å£°æ˜æ€§çš„ API ä¸­ï¼Œå› æ­¤å®ƒå¯ä»¥åœ¨ React å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ã€‚å½“ä¸€ä¸ªç»„ä»¶éœ€è¦è®¿é—®æ¸¸æˆåˆ—è¡¨å¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå®ƒå¯ä»¥ç®€å•åœ°å¯¼å…¥`useGames`é’©å­ã€‚

### [](#whats-next)æ¥ä¸‹æ¥æ˜¯ä»€ä¹ˆï¼Ÿ

åªè¦æ•°æ®åªç”±ä¸€ä¸ªç»„ä»¶ä½¿ç”¨ï¼Œè¿™å°±æ²¡é—®é¢˜ã€‚æ²¡æœ‰å¿…è¦æ‹¥æœ‰ä¸€ä¸ªå…¨å±€(ish)å­˜å‚¨ï¼Œæˆ–è€…ä½¿ç”¨ Redux æˆ– MobXã€‚ä½†æ˜¯å¦‚æœä¸æ­¢ä¸€ä¸ªç»„ä»¶éœ€è¦è®¿é—®ç›¸åŒçš„æ•°æ®ï¼Œæˆ‘ä»¬åº”è¯¥å°†å®ƒâ€œæå‡â€åˆ°ä¸€ä¸ªå…¬å…±çš„ç¥–å…ˆç»„ä»¶ã€‚

åœ¨å…±åŒç¥–å…ˆä¸æ˜¯ä¸€è‡´æ€§ç»„ä»¶çš„ç›´æ¥çˆ¶ç»„ä»¶çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ React ä¸Šä¸‹æ–‡æ¥é¿å…é€‚å½“çš„é’»å–ã€‚

æˆ‘ä»¬å°†åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­çœ‹åˆ°æˆ‘ä»¬å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚

## [](#resources)èµ„æº

å»¶ä¼¸é˜…è¯»:

*   [ä½¿ç”¨çŠ¶æ€æŒ‚é’©](https://reactjs.org/docs/hooks-state.html)
*   [ä½¿ç”¨æ•ˆæœæŒ‚é’©](https://reactjs.org/docs/hooks-effect.html)
*   [é’©å­ API å¼•ç”¨](https://reactjs.org/docs/hooks-reference.html)
*   [ä½•æ—¶ä½¿ç”¨å¤‡å¿˜å½•å’Œä½¿ç”¨å›æ‹¨](https://kentcdodds.com/blog/usememo-and-usecallback/)
*   [ç”¨ React.useEffect å–æ¶ˆæ‰¿è¯º](https://juliangaramendy.dev/use-promise-subscription/)