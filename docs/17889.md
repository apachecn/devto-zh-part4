# ä»‹ç»å“ˆé»˜-é›¶å¼€é”€é’©ğŸ£

> åŸæ–‡:[https://dev . to/Luca gez/introducing-å“ˆé»˜-é›¶å¼€é”€-é’©å­-7ne](https://dev.to/lucagez/introducing-hamo-zero-overhead-hooks-7ne)

ä½ å¥½ğŸ‘‹

ä»Šå¤©æˆ‘æƒ³å‘å¤§å®¶ä»‹ç»ä¸€ä¸ªæˆ‘åˆšåˆšå®Œæˆçš„å¾®å‹å›¾ä¹¦é¦†ã€‚

å®ƒè¢«ç§°ä¸º`Hamo`(æ‹‰ä¸è¯­æ„ä¸º`hook`)ï¼Œå¯ä»¥è®©ä½ é’©ä½**å­—é¢ä¸Šçš„**ä¸€åˆ‡ï¼Œå¤–åŠ **é›¶**å¼€é”€ã€‚

# [](#the-problem)é—®é¢˜

é’©å­å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯å®ƒä»¬ç»å¸¸ç¢äº‹ã€‚æ‚¨å¯ä»¥ç”¨äº‹ä»¶å‘å°„å™¨è‡ªå·±å®ç°å®ƒä»¬ã€‚ä½†æ˜¯ï¼Œä»»ä½•å®ç°éƒ½éœ€è¦å¤§é‡çš„å·¥ä½œï¼Œå¹¶ä¸”ä¼šå¢åŠ å‡½æ•°çš„å¤æ‚æ€§ã€‚

æ›´é‡è¦çš„æ˜¯ï¼Œæ ¹æ®éœ€è¦æŒ‚é’©çš„å‡½æ•°çš„é‡è¦ç¨‹åº¦ï¼Œä¸å¯å¿½ç•¥çš„å¼€é”€å¢åŠ ä¼šå¯¼è‡´é€Ÿåº¦å˜æ…¢ã€‚

å¦‚æœä½ èƒ½ä»åº”ç”¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹æŒ‚é’©ä½ çš„å‡½æ•°ï¼Œè€Œä¸é™ä½ä¸€ç›å¸çš„æ€§èƒ½ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ

# [](#the-solution)è§£

ä½¿ç”¨`Hamo`ä½ å¯ä»¥åšå¦‚ä¸‹äº‹æƒ…ã€‚

```
const hamo = require('hamo');

const [sum, onSum] = hamo((a, b) => a + b);

onSum('after', (result, a, b) => console.log(`The sum of ${a} plus ${b} is ${result}`);

sum(1, 3);

// 3
// The sum of 1 plus 2 is 3 
```

å¾ˆæ–¹ä¾¿å§ï¼Ÿ

ä½ å®é™…ä¸Šå¯ä»¥æŒ‚æ¥å‡½æ•°`before / after / oncebefore / onceafter`è¢«æŒ‚æ¥çš„å‡½æ•°ã€‚

å¥½å§ï¼Œé‚£ä¸æ˜¯ä¸€ä¸ªæ”¹å˜ç”Ÿæ´»çš„ä¾‹å­ï¼Œè®©æˆ‘ä»¬ä»ç°å®ä¸–ç•Œä¸­ä¸¾ä¸€äº›ä¾‹å­:

## [](#node)èŠ‚ç‚¹

åœ¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬æŒ‚æ¥äº†ä¸€ä¸ªå†™å‡½æ•°ã€‚

```
const hamo = require('hamo');
const { writeFile } = require('hamo');
const { promisify } = require('promisify');

// The `true` argument will notify hamo that the passed function is async
const [write, onWrite, offWrite] = hamo(promisify(writeFile), true);

module.exports = {
     write,
     onWrite,
     offWrite,
}; 
```

ç„¶åï¼Œä»ä½ åº”ç”¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹ï¼Œä½ éƒ½å¯ä»¥**è¿æ¥**æˆ–**åˆ†ç¦»**é’©å­ï¼Œå½“æœ‰ä¸œè¥¿å†™åˆ°ç£ç›˜æ—¶ï¼Œä½ ä¼šå¾—åˆ°é€šçŸ¥ã€‚

å°±åƒå‡½æ•°çš„é€šçŸ¥ç³»ç»Ÿã€‚

```
onWrite('before', path => console.log(`Writing file to ${path}`);

// Writing file to {path} 
// ... somewhere `write` is busy writing something ...

offWrite('before');

// no more notifies ğŸŒº 
```

## [](#browser)æµè§ˆå™¨

ä¹Ÿè®¸ä½ æƒ³åœ¨ä¸€ä¸ª`React`(åŠŸèƒ½æ€§)ç»„ä»¶æ¸²æŸ“æ—¶å¾—åˆ°é€šçŸ¥ã€‚

```
const HelloComp = () => <h1>Hello!</h1>;

const [Hello, onHello] => hamo(HelloComp);

onHello('before', () => console.log('Rendering Hello...'));

onHello('after', () => console.log('Rendered Hello ğŸ‰'));

// then, when mounting..

const App = () => {
     console.log('Mounting App...');

     return <Hello />;
};

// Mounting App...
// Rendering Hello...
// Rendered Hello ğŸ‰ 
```

# [](#how-it-works)å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

## [](#zero-overhead)é›¶å¼€é”€

æ£€æµ‹é™„åŠ åˆ°å‡½æ•°çš„æŒ‚é’©ã€‚ç„¶åï¼Œç»“æœå¤„ç†ç¨‹åºçš„ä¸»ä½“åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆã€‚é‡Œé¢æ²¡æœ‰`if`è¯­å¥ï¼Œå› ä¸ºåªæœ‰å½“å‰æ´»åŠ¨é’©å­ä¸¥æ ¼éœ€è¦çš„éƒ¨åˆ†è¢«æ·»åŠ åˆ°å‡½æ•°ä½“ä¸­ã€‚

æ‰€ä»¥ï¼Œé›¶æŒ‚é’©ï¼Œé›¶å¼€é”€ã€‚

## [](#running-functions-after-return-statements)è¿”å›æŠ¥è¡¨åè¿è¡Œå‡½æ•°

æ€ä¹ˆå¯èƒ½ä»å·²ç»è¿”å›çš„å‡½æ•°ä¸­è¿è¡Œå‡½æ•°å‘¢ï¼Ÿ
è¿™æ˜¯é€šè¿‡ä»¥ä¸‹æ–¹å¼åœ¨äº‹ä»¶å¾ªç¯ä¸­è°ƒåº¦ä¸€ä¸ª`micro-task`æ¥å®ç°çš„ã€‚

```
const func = () => {
     Promise.resolve().then(() => console.log(42));
     return 'The answer is';
};

func();

// The answer is
// 42 
```

é€šè¿‡åœ¨ä¸€ä¸ªå·²ç»è§£å†³çš„æ‰¿è¯ºä¸­è¿è¡Œä»£ç ï¼Œæ‚¨å¯ä»¥ç¡®ä¿äº‹ä»¶å¾ªç¯å°†è·å¾—ä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬å®‰æ’åœ¨ç¨åæ‰§è¡Œã€‚

å—¯ï¼Œå·®ä¸å¤šå°±æ˜¯è¿™æ ·ã€‚

å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹å›è´­:
[https://github.com/lucagez/hamo](https://github.com/lucagez/hamo)

å¿«ä¹é’©ä½æ‰€æœ‰äººï¼ğŸ£