# è§’ååº”å¼æ‰“å­—ï¼

> åŸæ–‡:[https://dev.to/joaqcid/angular-reactive-forms-typed-2j58](https://dev.to/joaqcid/angular-reactive-forms-typed-2j58)

è§’åº¦ååº”å¼è¡¨å•å¾ˆæ£’ï¼Œå®ƒä»¬æä¾›äº†æ¨¡å‹å’Œè§†å›¾ä¹‹é—´çš„åŒå‘æ•°æ®ç»‘å®šï¼Œæ”¯æŒåŒæ­¥/å¼‚æ­¥éªŒè¯ã€äº‹ä»¶å¤„ç†å’ŒçŠ¶æ€ï¼›ä½†æ˜¯å®ƒä»¬æ²¡æœ‰æä¾›æ‰“å­—æ”¯æŒã€‚

å¹¸è¿çš„æ˜¯ï¼Œå°†è¿™ä¸ªç‰¹æ€§æ·»åŠ åˆ°ååº”å¼è¡¨å•éå¸¸å®¹æ˜“ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­çœ‹åˆ°å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºè‡ªå·±çš„é€šç”¨ç‰ˆæœ¬çš„`FormGroup<T>`å’Œ`AbstractControl<T>`ç±»ã€‚æˆ‘ä»¬åªéœ€è¦†ç›–æœ€ä½è¦æ±‚çš„æ–¹æ³•å’Œå±æ€§ï¼Œä½¿æˆ‘ä»¬çš„è¡¨å•ç±»å‹åŒ–ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º`forms.ts`çš„æ–‡ä»¶å’Œä¸‹é¢çš„ä»£ç ã€‚

```
import {
  FormGroup as NgFormGroup,
  AbstractControl as NgAbstractControl,
  ValidatorFn,
  AbstractControlOptions,
  AsyncValidatorFn
} from '@angular/forms';
import { Observable } from 'rxjs';

export abstract class AbstractControl<T = any> extends NgAbstractControl {

  readonly value: T;
  readonly valueChanges: Observable<T>;

  abstract setValue(value: Partial<T> | T, options?: {
    onlySelf?: boolean;
    emitEvent?: boolean;
  }): void

  abstract patchValue(value: Partial<T> | T, options?: {
    onlySelf?: boolean;
    emitEvent?: boolean;
  }): void
}

export class FormGroup<T = any> extends NgFormGroup {
  readonly value: T;
  readonly valueChanges: Observable<T>;

  constructor(controls: { [key in keyof T]?: AbstractControl; },
    validatorOrOpts?: ValidatorFn | Array<ValidatorFn> | AbstractControlOptions | null,
    asyncValidator?: AsyncValidatorFn | Array<AsyncValidatorFn> | null) {
    super(controls, validatorOrOpts, asyncValidator);
  }

  patchValue(value: Partial<T> | T, options?: {
    onlySelf?: boolean;
    emitEvent?: boolean;
  }): void {
    super.patchValue(value, options);
  }

  get(path: Array<Extract<keyof T, string>> | Extract<keyof T, string> | string): AbstractControl | never {
    return super.get(path);
  }

  controls: {
    [key in keyof T]: AbstractControl<T[key]>;
  };
} 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºè¡¨å•æ¨¡å‹ï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯ä¸€ä¸ªç®€å•çš„æ³¨å†Œã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º`sign-up-form.ts`çš„æ–‡ä»¶ã€‚

```
export type SignUpForm = {
  email: string,
  password: string,
  optInNewsletter: boolean
} 
```

æœ€åï¼Œæˆ‘ä»¬å°†åœ¨ç»„ä»¶ä¸­å®ç°æ³›å‹`FormGroup`ã€‚æˆ‘ä»¬ç”¨`SignUpForm`ç±»å‹å®ä¾‹åŒ–æ³›å‹`FormGroup`ã€‚æ³¨æ„æˆ‘ä»¬å¯¼å…¥æˆ‘ä»¬çš„`FormGroup`è€Œä¸æ˜¯ Angular çš„ã€‚

```
//...
import { FormGroup } from './forms';

export class AppComponent implements OnInit {

  form = new FormGroup<SignUpForm>({
    email: new FormControl(''),
    password: new FormControl(''),
    optInNewsletter: new FormControl('')
  })

  ngOnInit() {
    this.form.patchValue({
      email: 'joaqcid@gmail.com',
      optInNewsletter: true
    })
  }

  submit() {
    console.log("typed forms", this.form.value)
  }
} 
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬åˆ›å»º FormGroup æ—¶ï¼ŒTypescript å¦‚ä½•é€‰æ‹©æ‰€ä½¿ç”¨çš„ç±»å‹å¹¶è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œæˆ–è€…å½“æˆ‘ä»¬å¾—åˆ°`value`æ—¶ï¼Œæˆ‘ä»¬å¦‚ä½•è¿”å›å®šä¹‰çš„ç±»å‹

[![Type-check form value](../Images/e33979d4d286fa13c76a3246dbfeb4b3.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Q_GYuhDx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/v6gdlsa8v7yf5uqfnubi.png) 
*é”®å…¥-æ£€æŸ¥è¡¨æ ¼å€¼*

[![Type-check form model when instantiating FormGroup](../Images/e80d5dba86910dc072f2b77d253c88e9.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--TbM7wsvj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/h7n2xgis8ni6fjheil27.png) 
*ç±»å‹-å®ä¾‹åŒ–è¡¨å•ç»„æ—¶æ£€æŸ¥è¡¨å•æ¨¡å‹*

[![Type-check form model when patching value](../Images/6a45351cb7fe41443b7c84673b023a2b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--pSoKnHA5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/nx8247kzs9jbfnanlfps.png) 
*é”®å…¥-æ£€æŸ¥è¡¨æ ¼æ¨¡å‹æ—¶æ‰“è¡¥ä¸å€¼*

[![Type-check field value when patching value](../Images/aa71c82c87453b96f52008407ba68d7e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--WfE7Phr0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ilycydxrncp411pradyw.png) 
*æ‰“è¡¥ä¸æ—¶æ£€æŸ¥å­—æ®µå€¼*

é…·ï¼è¿™ä¸æ˜¯å¾ˆæ£’å—ï¼Ÿç±»å›ºé†‡è¡¨æ ¼ï¼ğŸ’‰ğŸ’ŠğŸ’‰ğŸ’Š

æœ€åï¼Œè®©æˆ‘ä»¬æ‰©å±•`FormControl<T>`ç±»ï¼Œä»¥é˜²æˆ‘ä»¬ä¹Ÿéœ€è¦ä½¿ç”¨å®ƒä»¬ã€‚

è®©æˆ‘ä»¬æ·»åŠ ä¸‹é¢çš„ä»£ç ã€‚

```
import {
  FormControl as NgFormControl,
  //...
} from '@angular/forms';

//...
export class FormControl<T = any> extends NgFormControl {
  readonly value: T;
  readonly valueChanges: Observable<T>;

  setValue(value: Partial<T> | T, options?: {
    onlySelf?: boolean;
    emitEvent?: boolean;
  }): void {
    super.setValue(value, options);
  }

  patchValue(value: Partial<T> | T, options?: {
    onlySelf?: boolean;
    emitEvent?: boolean;
  }): void {
    super.patchValue(value, options);
  }
} 
```

åœ¨æˆ‘ä»¬çš„ç»„ä»¶ä¸Šï¼Œè®©æˆ‘ä»¬å¯¼å…¥è‡ªå·±çš„ FormControl å®ç°å¹¶æ„å»ºä¸€ä¸ªã€‚æ³¨æ„ï¼Œæˆ‘ä½¿ç”¨äº† ng-bootstrap ä¸­çš„è‡ªå®šä¹‰ç±»å‹`NgbDate`ã€‚

```
import { ..., FormControl } from './forms';
import { NgbDate } from '@ng-bootstrap/ng-bootstrap';

export class AppComponent implements OnInit {
    //...
    formControl =  new FormControl<NgbDate>('')

    ngOnInit() {
    //...
    this.formControl.patchValue(new NgbDate(2019, 9, 11))
    }
} 
```

åŒæ ·ï¼Œé€šè¿‡ä½¿ç”¨ FormControl çš„ç±»å‹åŒ–ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¿®è¡¥ã€è®¾ç½®æˆ–è·å–å€¼æ—¶å¯¹ FormControl è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚

[![FormControl typed](../Images/3aa9cabcc1a4f817a8e61c00dc5cb0e0.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--I1_eROAY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9gt9lknh1s8c2jlft807.png) 
*è¡¨å•æ§ä»¶é”®å…¥*

## [](#conclusion)ç»“è®º

æœ‰äº†è¿™å‡ è¡Œä»£ç ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ‰©å±• Angular çš„ååº”å¼è¡¨å•ï¼Œä½¿å®ƒä»¬å¯ä»¥è¢«é”®å…¥ï¼Œè¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬é”®å…¥è¡¨å•ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦çš„è¯ï¼Œè¿˜å¯ä»¥æ·»åŠ å…¶ä»–è‡ªå®šä¹‰åŠŸèƒ½ã€‚ä¿®æ”¹è¡Œä¸ºæ—¶è¦å°å¿ƒï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå½±å“å½“å‰çš„è¡¨å•è¡Œä¸ºã€‚

æ‚¨å¯ä»¥æŸ¥çœ‹æ­¤ [StackBlitz](https://stackblitz.com/edit/angular-reactive-forms-typed) ä¸­çš„å®Œæ•´ç¤ºä¾‹ã€‚

è¿™ç¯‡æ–‡ç« æ˜¯åœ¨é˜…è¯»äº†ä¸€ä¸ªå…¬å¼€çš„ [Angular çš„ github é—®é¢˜](https://github.com/angular/angular/issues/13721)ä¸­çš„ä¸åŒæ–¹æ³•åå†™çš„ï¼Œè¿˜æœ‰ä¸€äº›åº“ï¼Œå¦‚ ngx-typed-formsï¼Œä¹Ÿæä¾›ç±»ä¼¼çš„åŠŸèƒ½ã€‚

* * *

å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œå¦‚æœä½ å–œæ¬¢ï¼Œè¯·å±•ç¤ºä¸€äº›â¤ï¸.æˆ‘ç»å¸¸å†™ Angularï¼ŒFirebase å’Œ Google äº‘å¹³å°æœåŠ¡ã€‚å¦‚æœä½ å¯¹æ›´å¤šçš„å†…å®¹æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥åœ¨ [dev.to](https://dev.to/joaqcid) ã€ [medium](https://medium.com/@joaqcid) å’Œ [twitter](https://twitter.com/joaqcid) ä¸Šå…³æ³¨æˆ‘ã€‚