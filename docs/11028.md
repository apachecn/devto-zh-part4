# RxJS é€šçŸ¥å’Œç‰©åŒ–/å»ç‰©åŒ–æ“ä½œç¬¦

> åŸæ–‡ï¼š<https://dev.to/wojciechmatuszewski/rxjs-notification-and-materialize-dematerialize-operators-231h>

> æœ¬æ–‡å‡è®¾è¯»è€…å¯¹ RxJS æœ‰åŸºæœ¬çš„äº†è§£ã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰ RxJSï¼Œæˆ‘å¼ºçƒˆæ¨è[é€šè¯»æ–‡æ¡£](https://rxjs-dev.firebaseapp.com/)ã€‚

æœ€è¿‘ï¼Œåœ¨æµè§ˆ [RxJS æ–‡æ¡£](https://rxjs-dev.firebaseapp.com/)å¯»æ‰¾å¦‚ä½•è§£å†³æˆ‘æ‰€é¢ä¸´çš„ä¸€ä¸ªé—®é¢˜çš„çµæ„Ÿæ—¶ï¼Œæˆ‘æ³¨æ„åˆ°äº†ä¸€ä¸ªæˆ‘ä»æœªä½¿ç”¨è¿‡çš„ç±»å‹(ä»¥åŠéšä¹‹è€Œæ¥çš„æ“ä½œç¬¦):`Notification`ã€‚

ä»Šå¤©ï¼Œæˆ‘æƒ³åˆ†äº«æˆ‘åœ¨æ‘†å¼„å®ƒæ—¶å­¦åˆ°çš„ä¸œè¥¿ã€‚

# é€šçŸ¥

[æ–‡ä»¶](https://rxjs-dev.firebaseapp.com/)å£°æ˜`Notification`æ˜¯:

> [...]å¯è§‚å¯Ÿå¯¹è±¡å¯ä»¥å‘å‡ºçš„åŸºäºæ¨é€çš„äº‹ä»¶æˆ–å€¼ã€‚...é™¤äº†åŒ…è£…å®é™…äº¤ä»˜çš„å€¼ï¼Œå®ƒè¿˜ç”¨å…ƒæ•°æ®å¯¹å…¶è¿›è¡Œæ³¨é‡Š

è®©æˆ‘ä»¬è¯•ç€ä¸€ç‚¹ä¸€ç‚¹åœ°åˆ†è§£å®ƒã€‚

## å¯è§‚å¯Ÿåˆ°çš„äº‹ä»¶æˆ–å€¼å¯ä»¥å‘å‡º

`Observable`èƒ½å‘å‡º*

*   ä¸å®Œå…¨çš„
*   ä¸è‰¯äº‹ä»¶
*   ä¸‹ä¸€ä¸ª

è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨`Notification` API æ¥å¤åˆ¶è¿™ç§è¡Œä¸ºã€‚

```
import { Notification, from } from "rxjs";

// Notification(Type, Value?, Error?)

const onErrorNotification = new Notification("E",{}, 'onError' );
const onCompleteNotification = new Notification("C", 'onComplete');
const onNextNotification = new Notification("N", 'onNext');

from([onNextNotification, onCompleteNotification, onErrorNotification])
  .subscribe(console.log);

/* {
 *  kind: 'E' or 'C' or 'N'
 *  value: 'onNext' or 'onComplete' or undefined
 *  error: undefined or 'onError'
 *  hasValue: true or false (onNext hasValue is always true)
 * }
 */ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘æ²¡æœ‰ä½¿ç”¨`onComplete`å’Œ`onError`å¤„ç†ç¨‹åºæ¥è®°å½•å€¼ï¼Œä¸ºä»€ä¹ˆï¼Ÿ

è¿™æ˜¯å› ä¸º`Notifications`è¢«è§†ä¸º`onNext`äº‹ä»¶ï¼Œä½†å®ƒä»¬(æœ¬ä¾‹ä¸­çš„**)ä»£è¡¨åº•å±‚äº‹ä»¶å’Œå€¼ï¼Œæ‰€ä»¥`onComplete`å’Œ`onError`å¤„ç†ç¨‹åºæ°¸è¿œä¸ä¼šè§¦å‘ã€‚**

 **## ç”¨å…ƒæ•°æ®æ ‡æ³¨(å®é™…å€¼)

`Notification`æ‰¿è½½äº†å¤§é‡çš„ä¿¡æ¯:

*   å®ƒå‘Šè¯‰ä½ äº‹ä»¶çš„ç±»å‹(ç”¨`kind`é“å…·)
*   å®ƒå‘æ‚¨å±•ç¤ºäº†å®é™…å€¼(ä½¿ç”¨`value` prop)
*   å®ƒä¼šé€šçŸ¥æ‚¨é”™è¯¯(ä½¿ç”¨`error` prop)åŠå…¶å€¼
*   å®ƒå‘Šè¯‰ä½ äº‹ä»¶æ˜¯å¦æ˜¯åŸºäº*å€¼çš„* ( `onNext`)

è¿™ä¸€åˆ‡éƒ½å¾ˆæ£’ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•å°†`Observable`äº‹ä»¶è½¬æ¢æˆ`Notification`ï¼Ÿ

è¾“å…¥:`materialize`å’Œ`dematerialize`

# `materialize`å’Œ`dematerialize`

è¿™äº›è¿ç®—ç¬¦éå¸¸æœ‰è¶£ã€‚
å®ƒä»¬å…è®¸ä½ æ§åˆ¶ä½ å½“å‰å±…ä½åœ¨äº‹ä»¶æˆ–ä»·å€¼çš„å“ªä¸ªâ€˜é¢†åŸŸâ€™(`Notification`æˆ–æ­£å¸¸ï¼Œ`Observable`)ã€‚

## `dematerialize`

è¯¥æ“ä½œç¬¦å…è®¸æ‚¨å°†`Notification`é™çº§åˆ°ç»™å®š`Notification`çš„åº•å±‚`Observable`äº‹ä»¶æˆ–å€¼ã€‚

è®©æˆ‘ä»¬é‡æ–°ç¼–å†™ç¬¬ä¸€ä¸ªä»£ç ç¤ºä¾‹ï¼Œè¿™æ ·æˆ‘ä»¬å®é™…ä¸Šå¿…é¡»è¿æ¥æ‰€æœ‰ 3 ä¸ªå¤„ç†ç¨‹åº(`onNext`ã€`onError`ã€`onComplete`)æ¥è·å–æ‰€æœ‰æ•°æ®ã€‚

```
from([ onNextNotification, onErrorNotification, onCompleteNotification ])
  // 'degrading' to an Observable-event world
  .pipe(dematerialize())
  .subscribe({
    next: console.log,
    error: console.log,
    complete: console.log
  });

/* onNext
 * onError
 */ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºä»€ä¹ˆæ²¡æœ‰æ³¨é”€`onComplete`ï¼Ÿ

> ä»»ä½•ç»™å®šçš„æµåªèƒ½å‡ºé”™ä¸€æ¬¡ã€‚è¿™æ˜¯ç”±å¯è§‚å¯Ÿå¥‘çº¦å®šä¹‰çš„ï¼Œå®ƒè¯´ä¸€ä¸ªæµå¯ä»¥å‘å‡ºé›¶ä¸ªæˆ–å¤šä¸ªå€¼ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™æ„å‘³ç€æµå·²ç»é”™è¯¯åœ°ç»“æŸäº†å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”ä¸ä¼šå‘å‡ºä»»ä½•è¿›ä¸€æ­¥çš„å€¼ã€‚

è¿™ç§æƒ…å†µæš—ç¤ºäº†è¿™æ ·ä¸€ç§ç”¨ä¾‹ï¼Œå³å°½ç®¡æœ‰é”™è¯¯ï¼Œæˆ‘ä»¬ä»æƒ³ç»§ç»­æˆ‘ä»¬çš„æ“ä½œé“¾ã€‚

## `materialize`

å°±åƒï¼Œ`dematerialize`â€œé™çº§â€äº‹ä»¶ï¼Œ`materialize`ï¼Œä½¿æ‚¨èƒ½å¤Ÿå°†ç»™å®šäº‹ä»¶â€œå‡çº§â€ä¸º`Notification`ç±»å‹ã€‚

å‡è®¾æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„ source `Observable`å¯ä»¥éšæœºæŠ›å‡ºï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶æƒ³è¦éå†æˆ‘ä»¬çš„æ“ä½œç¬¦é“¾ã€‚

```
import { dematerialize, materialize, map, delay } from "rxjs/operators";
import { Notification, timer } from "rxjs";

sourceThatThrows$
  .pipe(
    // Promoting the event to a Notification
    materialize(),
    map(notification =>
      // Was the event value based? (onNext, onComplete)
      notification.hasValue
        ? notification
        // As alternative you could also use new Notification(...)
        : Notification.createNext("was error value!")
    ),
    delay(100),
    dematerialize()
  )
  .subscribe(console.log);

/* value from source
 * was error value
 */ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½¿ç”¨ã€`materialize`å’Œ`dematerialize`æ“ä½œç¬¦ï¼Œæˆ‘ä»¬æˆåŠŸåœ°ä¿ç•™äº†æˆ‘ä»¬çš„æ“ä½œç¬¦é“¾ï¼Œå³ä½¿æºå¯ä»¥éšæœºæŠ›å‡ºã€‚

# æ€»ç»“

RxJS ç”Ÿæ€ç³»ç»Ÿéå¸¸åºå¤§ï¼Œæœ‰ 100 å¤šä¸ªè¿è¥å•†ï¼Œæœ‰å¾ˆå¤šä¸œè¥¿éœ€è¦å­¦ä¹ ã€‚æˆ‘å¸Œæœ›ï¼Œæˆ‘èƒ½å¤Ÿå¯¹è¿™ä¸¤ä¸ªé—®é¢˜æä¾›ä¸€äº›åŸºæœ¬çš„çŸ¥è¯†ã€‚

å¯ä»¥åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘ [@wm_matuszewski](https://twitter.com/wm_matuszewski)

è°¢è°¢ğŸ‘‹

# è„šæ³¨

*æˆ‘ä¸æ˜¯ä¸“å®¶ï¼Œå¯èƒ½æœ‰æ›´å¤šçš„ä¸œè¥¿å¯ä»¥è§‚å¯Ÿåˆ°ã€‚ä¸ºäº†è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å‡è®¾äº†è¿™ä¸‰ä¸ªäº‹ä»¶ã€‚

ç¼–è¾‘:

*   æ„Ÿè°¢ [Christopher Hiller](https://dev.to/boneskull) æŒ‡å‡º`Notification`ä½œä¸º`onComplete`äº‹ä»¶å°†`hasValue`è®¾ç½®ä¸º falseï¼Œå› æ­¤å®ƒä¸æ˜¯*åŸºäºå€¼çš„*äº‹ä»¶ã€‚**