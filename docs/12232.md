# ä» REST åˆ° GraphQL:åˆ›å»º API çš„ä¸åŒæ–¹å¼(ä½¿ç”¨ Apollo å’Œ NodeJS)

> åŸæ–‡ï¼š<https://dev.to/bnevilleoneill/from-rest-to-graphql-a-different-way-to-create-an-api-with-apollo-nodejs-3jd2>

[![](img/c40c8addf4767222988c8d363f86d30f.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--d8PT2J4t--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9kkj8wt73muyzc9gxopb.png)

å‡†å¤‡å¥½è·³åˆ° GraphQL API äº†å—ï¼Ÿå¦‚æœæ‚¨å·²ç»æœ‰äº†ä¸€ä¸ª MySQL æ•°æ®åº“ï¼Œé‚£ä¹ˆæ‚¨å°±æœ‰äº†ä¸€ä¸ªåˆ›å»ºå¯ä¼¸ç¼© API çš„ç»ä½³èµ·ç‚¹ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åŸºäºæ•°æ®åº“åˆ›å»ºæ¨¡å‹ï¼Œåˆ›å»ºä¸€ä¸ªä»æ•°æ®åº“è¯»å–æ•°æ®çš„ NodeJS GraphQL APIï¼Œå¹¶å­¦ä¹ å¦‚ä½•åœ¨ä¸åŒçš„è¡¨ä¹‹é—´å»ºç«‹å…³ç³»ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºç¥¨åŠ¡ç³»ç»Ÿæ„å»ºä¸€ä¸ªå°çš„ GraphQL ç«¯ç‚¹ã€‚æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ªç«¯ç‚¹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¯»å–ç¥¨æ®å¹¶è·å–å®ƒä»¬çš„ç›¸å…³æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·ã€çŠ¶æ€å’Œä¼˜å…ˆçº§ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨çš„æ„é€ å—æœ‰:

*   (ç°æœ‰çš„)MySQL æ•°æ®åº“
*   [èŠ‚ç‚¹ j](https://nodejs.org/en/)
*   [Express](https://expressjs.com/)(node . js çš„ web æ¡†æ¶)
*   [Apollo](https://www.apollographql.com/) (åˆ›å»º GraphQL ç«¯ç‚¹çš„å·¥å…·)
*   [åºåˆ—åŒ–](http://docs.sequelizejs.com/)(å¯¹è±¡å…³ç³»æ˜ å°„åŒ…)
*   [Webpack](https://webpack.js.org/) (æ‰“åŒ…åº”ç”¨ç¨‹åº)
*   (è¦å¯åŠ¨ä¸€ä¸ªæœ¬åœ° MySQL æ•°æ®åº“ï¼Œåªè¦ä½ æœ‰ä¸€ä¸ª MySQL å®ä¾‹ï¼Œè¿™æ˜¯å¯é€‰çš„)

å¦‚æœä½ ä¸çŸ¥é“æˆ‘åˆšæ‰æåˆ°çš„æ¯ä¸€éƒ¨åˆ†ï¼Œä¸è¦æ‹…å¿ƒï¼Œæˆ‘ä¼šæè¿°è¿™ä¸€è¿‡ç¨‹ä¸­çš„æ¯ä¸€æ­¥ã€‚å¦‚æœä½ æƒ³ç»§ç»­ç¼–ç ï¼Œä½ å¯ä»¥ç­¾å‡º[è¿™ä¸ªåº“](https://github.com/DirkWolthuis/graphql-express-migrating-mysql)å¹¶ç”¨è¿™ä¸ªå‘½ä»¤å…‹éš†æ•™ç¨‹å‘å¸ƒçš„å¼€å§‹:

```
git clone <https://github.com/DirkWolthuis/graphql-express-migrating-mysql> --branch start 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ç¬¬ä¸€æ­¥:æ•°æ®åº“å±‚

é¦–å…ˆï¼Œæˆ‘ä»¬å°†å‡è®¾æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªç°æœ‰çš„æ•°æ®åº“ã€‚æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ª SQL æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å°†å…¶å¯¼å…¥ MySQL æ•°æ®åº“ã€‚æˆ‘å–œæ¬¢åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œæˆ‘çš„ MySQL æ•°æ®åº“ï¼Œä½ å¯ä»¥ä½¿ç”¨`docker-compose.yaml`æ–‡ä»¶(åœ¨å­˜å‚¨åº“ä¸­)æ¥å¯åŠ¨ä¸€ä¸ª MySQL å®¹å™¨ã€‚

è¯¥æ•°æ®åº“æœ‰å››ä¸ªè¡¨:ç¥¨æ®ã€ä¼˜å…ˆçº§ã€çŠ¶æ€å’Œç”¨æˆ·ã€‚è¿™äº›è¡¨æ ¼å…·æœ‰ä»¥ä¸‹ç»“æ„:

é—¨ç¥¨

```
| Field               | Type             | Null | Key | Default           | Extra          |
+---------------------+------------------+------+-----+-------------------+----------------+
| id                  | int(11) unsigned | NO   | PRI | NULL              | auto_increment |
| subject             | varchar(256)     | NO   |     | NULL              |                |
| priority_id         | int(11)          | NO   |     | NULL              |                |
| status_id           | tinyint(4)       | NO   |     | NULL              |                |
| user_id             | int(11)          | NO   |     | NULL              |                |
| assigned_to_user_id | int(11)          | YES  |     | NULL              |                |
+---------------------+------------------+------+-----+-------------------+----------------+ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç”¨æˆ·

```
| Field | Type             | Null | Key | Default | Extra          |
+-------+------------------+------+-----+---------+----------------+
| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| name  | varchar(256)     | NO   |     | NULL    |                |
| email | varchar(256)     | NO   |     | NULL    |                |
+-------+------------------+------+-----+---------+----------------+ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¼˜å…ˆäº‹é¡¹

```
| Field | Type             | Null | Key | Default | Extra          |
+-------+------------------+------+-----+---------+----------------+
| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| slug  | varchar(64)      | NO   |     | NULL    |                |
| name  | varchar(256)     | NO   |     | NULL    |                |
+-------+------------------+------+-----+---------+----------------+ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

çŠ¶æ€

```
| Field | Type             | Null | Key | Default | Extra          |
+-------+------------------+------+-----+---------+----------------+
| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| slug  | varchar(64)      | NO   |     | NULL    |                |
| name  | varchar(256)     | NO   |     | NULL    |                |
+-------+------------------+------+-----+---------+----------------+ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½¿ç”¨ä¸Šé¢çš„å›¾è¡¨åˆ›å»ºæ‚¨è‡ªå·±çš„æ•°æ®åº“ï¼Œæˆ–è€…å°† SQL æ–‡ä»¶å¯¼å…¥åˆ°æ‚¨çš„ MySQL æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç¼–ç äº†ã€‚æ‚¨å¯ä»¥åœ¨ç›®å½•`tutorial_assets`ä¸­çš„å­˜å‚¨åº“å†…æ‰¾åˆ° SQL æ–‡ä»¶ã€‚

## æ­¥éª¤ 2:å¼•å¯¼åº”ç”¨ç¨‹åº

åœ¨æœ¬æ•™ç¨‹çš„èµ„æºåº“ä¸­ï¼Œæˆ‘å·²ç»è®¾ç½®äº† [Webpack](https://webpack.js.org/) æ¥ç¼–è¯‘`dist`ç›®å½•ä¸­çš„`app.js`æ–‡ä»¶ã€‚å®ƒæä¾›ä¸€ä¸ªåŸºæœ¬çš„ Express Hello World åº”ç”¨ç¨‹åºã€‚å…‹éš†é¡¹ç›®åï¼Œæ‚¨éœ€è¦è¿è¡Œ`npm install`æ¥å®‰è£…ä¾èµ–é¡¹ã€‚

å®‰è£…å®Œæ¯•ï¼Ÿå¯ä»¥è¿è¡Œ`npm run start`æ¥å¯åŠ¨ appã€‚å®ƒå°†æœåŠ¡äº`http://localhost:5000`ä¸Šçš„ä¸€ä¸ªç«¯ç‚¹ã€‚

è®©æˆ‘ä»¬å¼€å§‹æ„å»ºæˆ‘ä»¬çš„ GraphQL API å§ï¼

[![LogRocket Free Trial Banner](img/4aa67f42a82d61c79b61acb13eae9479.png)](https://logrocket.com/signup/)

## ç¬¬ä¸‰æ­¥:åˆ›å»ºæ•°æ®åº“æ¨¡å‹

å‡ ä¹æ¯ä¸ªæ¡†æ¶éƒ½ä½¿ç”¨æ¨¡å‹ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚ä¸ºäº†ä¸æˆ‘ä»¬çš„ MySQL æ•°æ®åº“äº¤äº’ï¼Œæˆ‘ä»¬ä½¿ç”¨ [Sequelize](http://docs.sequelizejs.com/) ä½œä¸º ORM(å¯¹è±¡å…³ç³»æ˜ å°„)åŒ…ã€‚è®©æˆ‘ä»¬ä»æ·»åŠ åŒ…å¼€å§‹(mysql2 åŒ…æ˜¯è¿æ¥ mysql æ•°æ®åº“æ‰€å¿…éœ€çš„)ã€‚

```
npm install sequelize mysql2 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬å¯ä»¥åšä¸¤ä»¶äº‹ä¹‹ä¸€ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“æ¨¡å‹ï¼Œæˆ–è€…ç”¨ä¸€ä¸ªé¢å¤–çš„åŒ…è‡ªåŠ¨ç”Ÿæˆã€‚å¯¹äºæœ¬æ•™ç¨‹ï¼Œæ‰‹åŠ¨åˆ›å»ºæ¨¡å‹ä¸æˆé—®é¢˜ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“ä¸­åªæœ‰å››ä¸ªå°è¡¨ã€‚ä½†æ˜¯å½“æ‚¨æ­£åœ¨è¿ç§»ä¸€ä¸ªæ›´å¤§çš„æ•°æ®åº“æ—¶ï¼Œæ‚¨å¯èƒ½æƒ³è¦æ›´åŠ è‡ªåŠ¨åŒ–çš„ä¸œè¥¿ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªåŸºäºç°æœ‰æ•°æ®åº“ç”Ÿæˆåºåˆ—æ•°æ®åº“æ–‡ä»¶çš„åŒ…ã€‚è¯¥è½¯ä»¶åŒ…è¢«å‘½åä¸º [Sequelize-Auto](https://github.com/sequelize/sequelize-auto) ï¼Œå¯ä»¥åœ¨å…¨çƒèŒƒå›´å†…å®‰è£… NPMã€‚

```
npm install -g sequelize-auto mysql 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†ä»¥æ›´åŠ è‡ªåŠ¨åŒ–çš„æ–¹å¼è¿ç§»æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`sequelize-auto`å‘½ä»¤ã€‚æˆ‘ä»¬éœ€è¦åœ¨å‘½ä»¤ä¸­æ’å…¥ MySQL æ•°æ®åº“å‡­è¯æ¥ç”Ÿæˆæ¨¡å‹ã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨æ­¥éª¤ 1 ä¸­æä¾›çš„ MySQL dumpï¼Œæˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ‚¨éœ€è¦ä½¿ç”¨çš„ config JSON æ–‡ä»¶ã€‚

sequelize-auto-settings.json ä½äº tutorial_assets ç›®å½•ä¸­ã€‚å¦‚æœæ‚¨åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨è‡ªå·±çš„æ•°æ®åº“ï¼Œè¯·æŸ¥çœ‹ Sequelize API æ–‡æ¡£ä¸­çš„[è®¾ç½®é¡µé¢](https://sequelize.readthedocs.io/en/latest/api/sequelize/)ä»¥äº†è§£æ‚¨éœ€è¦çš„è®¾ç½®ã€‚

```
sequelize-auto -h <host> -d <database> -u <user> -x [password] -p [port] --dialect [dialect] -c [/path/to/config] -o [/path/to/models] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥åœ¨æˆ‘çš„æƒ…å†µä¸‹:

```
sequelize-auto -h localhost -d graphql-mysql-tutorial -u graphql -x 123456 -p 8006 --dialect mysql -c /Users/wolthuis/Documents/websites/tutorials/graphql-migrating-mysql/tutorial\_assets/sequelize-auto-settings.json -o /Users/wolthuis/Documents/websites/tutorials/graphql-migrating-mysql/app/models 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬èµ°å§ï¼app/models ç›®å½•ä¸­å‡ºç°äº†å››ä¸ªæ–‡ä»¶ã€‚åœ¨æˆ‘ä»¬çš„æ–‡ä»¶ä¸­ï¼Œè®©æˆ‘ä»¬ä»å¯¼å…¥åºåˆ—å¹¶è®¾ç½®ä¸€äº›å˜é‡å¼€å§‹ã€‚

## ç¬¬å››æ­¥:å®ç°æ•°æ®åº“æ¨¡å‹

æˆ‘ä»¬ç°åœ¨éœ€è¦å®ç°æ•°æ®åº“æ¨¡å‹ã€‚åœ¨åº”ç”¨ç¨‹åºçš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª database.js æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥å¹¶å¯¼å‡ºæ•°æ®åº“æ¨¡å‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒä»¬ã€‚

```
const Sequelize = require('sequelize')

var db = {}

const sequelize = new Sequelize(
    'DATABASE_NAME',
    'DATABASE_USER',
    'DATABASE_PASSWORD',
    {
        host: 'DATABASE_HOST',
        port: 'DATABASE_PORT',
        dialect: 'mysql',
        define: {
            freezeTableName: true,
        },
        pool: {
            max: 5,
            min: 0,
            acquire: 30000,
            idle: 10000,
        },
        // <http://docs.sequelizejs.com/manual/tutorial/querying.html#operators>
        operatorsAliases: false,
    },
)

let models = []

// Initialize models
models.forEach(model => {
    const seqModel = model(sequelize, Sequelize)
    db[seqModel.name] = seqModel
})

// Apply associations
Object.keys(db).forEach(key => {
    if ('associate' in db[key]) {
        db[key].associate(db)
    }
})

db.sequelize = sequelize
db.Sequelize = Sequelize

module.exports = db 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½äº†ï¼Œæˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹ï¼Œå¡«å†™æˆ‘ä»¬çš„ MySQL æ•°æ®åº“å‡­è¯ï¼Œå¹¶å¯¼å…¥æ–°åˆ›å»ºçš„æ¨¡å‹ã€‚é€šå¸¸ï¼Œæ‚¨ä¼šä½¿ç”¨ç¯å¢ƒå˜é‡æ¥å®‰å…¨åœ°ä¼ é€’æ•æ„Ÿæ•°æ®ï¼Œä½†æ˜¯å‡ºäºæ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘å°†åœ¨ database.js æ–‡ä»¶ä¸­ç¡¬ç¼–ç ä¸€äº›å€¼ã€‚

æ‰€ä»¥å¯¼å…¥ä¸­å¸¦æœ‰å‡­è¯çš„ database.js æ–‡ä»¶çœ‹èµ·æ¥åƒè¿™æ ·:

```
const Sequelize = require('sequelize')

var db = {}

const sequelize = new Sequelize('graphql-mysql-tutorial', 'graphql', '123456', {
    host: 'localhost',
    port: '8006',
    dialect: 'mysql',
    define: {
        freezeTableName: true,
    },
    pool: {
        max: 5,
        min: 0,
        acquire: 30000,
        idle: 10000,
    },
    // <http://docs.sequelizejs.com/manual/tutorial/querying.html#operators>
    operatorsAliases: false,
})

let models = [
    require('./models/priorities.js'),
    require('./models/status.js'),
    require('./models/tickets.js'),
    require('./models/users.js'),
]

// Initialize models
models.forEach(model => {
    const seqModel = model(sequelize, Sequelize)
    db[seqModel.name] = seqModel
})

// Apply associations
Object.keys(db).forEach(key => {
    if ('associate' in db[key]) {
        db[key].associate(db)
    }
})

db.sequelize = sequelize
db.Sequelize = Sequelize

module.exports = db 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¤ªå¥½äº†ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹å¯¼å…¥`db`å˜é‡ï¼Œå¹¶è®¿é—®æˆ‘ä»¬æ‰€æœ‰çš„æ¨¡å‹ã€‚åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬è‚¯å®šä¼šä½¿ç”¨è¯¥å˜é‡æ¥è®¿é—®æˆ‘ä»¬çš„æ•°æ®ã€‚

## ç¬¬äº”æ­¥:è®¾ç½®é˜¿æ³¢ç½—æœåŠ¡å™¨

é˜¿æ³¢ç½— T2 æ˜¯å»ºç«‹åœ¨ GraphQL è§„èŒƒä¹‹ä¸Šçš„ä¸€å±‚ï¼Œä»–ä»¬æä¾›äº†ä¼˜ç§€çš„å¼€å‘å·¥å…·ã€‚ä»–ä»¬è¿˜æä¾›äº†å°† Apollo server é›†æˆåˆ°(ç°æœ‰çš„)Express åº”ç”¨ç¨‹åºä¸­çš„åŒ…ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªåŒ…ï¼Œæ ¹æ®æˆ‘çš„ç»éªŒï¼Œåˆ›å»º GraphQL API çš„æœ€ä½³æ–¹å¼æ˜¯æœ‰æ—¶ä¾é ä¸€ä¸ª`normal` rest APIã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ›å»ºè®¤è¯ç«¯ç‚¹æ—¶ï¼Œæˆ‘æ›´å–œæ¬¢å°† GraphQL å’Œè®¤è¯è·¯ç”±å®Œå…¨åˆ†å¼€ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸¤ä¸ªåŒ…:

```
npm install apollo-server-express graphql 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®‰è£…åï¼Œæˆ‘ä»¬éœ€è¦åœ¨ app.js ä¸­åšä¸€äº›è®¾ç½®æ¥è€¦åˆ Apollo å’Œ Expressã€‚æˆ‘ä»¬ä»å¯¼å…¥ ApolloServer å¼€å§‹:

```
const { ApolloServer } = require('apollo-server-express') 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ Apollo æœåŠ¡å™¨å®ä¾‹:

```
const server = new ApolloServer({
        modules: []
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬å°† Apollo æœåŠ¡å™¨ä½œä¸ºä¸­é—´ä»¶åº”ç”¨åˆ°ç°æœ‰çš„ Express åº”ç”¨ç¨‹åºä¸­:

```
server.applyMiddleware({ app }) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬è¿˜ä¸èƒ½å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæ²¡æœ‰ä»»ä½•æ¨¡å—é˜¿æ³¢ç½—æœåŠ¡å™¨å°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚å› æ­¤ï¼Œåœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„æ•°æ®åº“å®ä½“å®ç°åˆ° GraphQL ç«¯ç‚¹ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨ GraphQL æŸ¥è¯¢æ¥è®¿é—®å®ƒä»¬ã€‚

## æ­¥éª¤ 6:åˆ›å»ºæˆ‘ä»¬çš„ GraphQL ç±»å‹å’Œè§£æå™¨

åœ¨ GraphQL ä¸­ï¼Œéœ€è¦ç±»å‹å’Œè§£æå™¨ã€‚ç±»å‹æè¿°äº†å¯ä»¥é€šè¿‡ GraphQL ç«¯ç‚¹è·å–æˆ–å†™å…¥çš„æ•°æ®ã€‚è§£æå™¨æ˜¯è§£æç”¨æˆ·è¯·æ±‚çš„é€»è¾‘ã€‚

åœ¨ GraphQL ç›®å½•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º tickets.js çš„æ–°æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†åŒ…å«ä¸€ä¸ªæ¥è‡ª`apollo-server-express`åŒ…çš„å˜é‡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥åˆ›å»º GraphQL ç±»å‹å®šä¹‰ï¼ŒåŒ…å«æˆ‘ä»¬çš„`db`å˜é‡å’Œä¸¤ä¸ªç”¨äºæˆ‘ä»¬çš„ç±»å‹ GraphQL å®šä¹‰å’Œ GraphQL è§£æå™¨çš„ç©ºå¯¹è±¡ã€‚

```
import { gql } from 'apollo-server-express'
import * as db from '../database'

export const typeDefs = gql`

`
export const resolvers = {
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## åˆ›å»º GraphQL ç±»å‹

æ‰€ä»¥é¦–å…ˆæˆ‘ä»¬å¡«å…… typeDefs å˜é‡ã€‚æ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨æ¥è‡ª`apollo-server-express`åŒ…çš„`gql`å˜é‡ã€‚`gql`å˜é‡è®©æˆ‘ä»¬ç¼–å†™åŒ…å¯è¯»çš„ç±»å‹å®šä¹‰ã€‚

åœ¨`typeDefs`å˜é‡ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹ï¼Œæ‰©å±•æŸ¥è¯¢ç±»å‹å¹¶åˆ›å»ºä¸€ä¸ªåä¸º`Ticket`çš„æ–°ç±»å‹ã€‚æˆ‘ä»¬éœ€è¦æ‰©å±•æŸ¥è¯¢ç±»å‹çš„åŸå› æ˜¯å› ä¸º GraphQL æ€»æ˜¯ä½¿ç”¨åä¸º`Query`çš„é¡¶çº§ç±»å‹ã€‚åœ¨è¯¥ç±»å‹ä¸­åµŒå¥—äº†å…¶ä»–ç±»å‹ï¼Œè¿™å°±æ˜¯ GraphQL å¦‚ä½•çŸ¥é“åœ¨æ‚¨çš„ GraphQL API ä¸­å¯ç”¨çš„ç±»å‹ã€‚

å¥½äº†ï¼Œè®©æˆ‘ä»¬æ‰©å±•æŸ¥è¯¢ç±»å‹:

```
export const typeDefs = gql`
    extend type Query {
        tickets: [Ticket]
        ticket(id: ID!): Ticket
    }
    type Ticket {

    }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åšäº†ä¸€äº›äº‹æƒ…ã€‚æˆ‘ä»¬è®© GraphQL çŸ¥é“æˆ‘ä»¬æƒ³ç”¨ä¸¤ä¸ªæ–°çš„å®ä½“æ¥æ‰©å±•æŸ¥è¯¢:ticket å’Œ ticketsã€‚

`Tickets`è¿”å›ä¸€ä¸ª`tickets` :
çš„æ•°ç»„

```
tickets: [Ticket] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`Ticket`è¿”å›å•ç±»å‹çš„`Ticket`ã€‚ç¥¨è¯ç±»å‹å°†æ¥æ”¶ä¸€ä¸ªåä¸º id çš„å‚æ•°ï¼Œç±»å‹ä¸º IDï¼Œä¸èƒ½ä¸º null(æ¢å¥è¯è¯´ï¼Œè¯¥å‚æ•°æ˜¯å¿…éœ€çš„)ã€‚GraphQL ç±»å‹ä¸­çš„æ„Ÿå¹å·è±¡å¾ç€ä¸€ä¸ªå€¼ä¸èƒ½ä¸ºç©º:

```
ticket(id: ID!): Ticket 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬çš„`Ticket`ç±»å‹æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¡«å……è¿™ä¸ªç±»å‹:

```
export const typeDefs = gql`
    extend type Query {
        tickets: [Ticket]
        ticket(id: ID!): Ticket
    }
    type Ticket {
        id: ID!
        subject: String
        priority_id: Int
        status_id: Int
        user_id: Int
        assigned_to_user_id: Int
    }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†ç¥¨è¯ç±»å‹ç”±å“ªäº›ç±»å‹ç»„æˆã€‚å®ƒä¸æˆ‘ä»¬çš„æ•°æ®åº“æ¨¡å‹ 100%åŒ¹é…ã€‚è¿™å¯¹äºç°åœ¨æ¥è¯´æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å°†æ¥å½“æˆ‘ä»¬è¦åœ¨æˆ‘ä»¬çš„ç±»å‹/æ¨¡å‹ä¹‹é—´æ·»åŠ å…³ç³»æ—¶ï¼Œè¿™ç§æƒ…å†µå°†ä¼šæ”¹å˜ã€‚

## åˆ›å»º GraphQL è§£æå™¨

æ‰€ä»¥æˆ‘ä»¬ä¸ºç¥¨å®ä½“åˆ›å»ºäº†æˆ‘ä»¬çš„ç±»å‹ã€‚ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºè§£æå™¨ã€‚è§£æå™¨éœ€è¦æˆ–å¤šæˆ–å°‘åœ°åæ˜ æˆ‘ä»¬çš„ç±»å‹ã€‚åœ¨è§£æå™¨å¯¹è±¡å†…éƒ¨ï¼Œæˆ‘ä»¬ä¹Ÿä»é¡¶çº§æŸ¥è¯¢å¯¹è±¡å¼€å§‹ã€‚

```
export const resolvers = {
    Query: {},
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æŸ¥è¯¢ä¸­ï¼Œæˆ‘ä»¬åæ˜ äº†æˆ‘ä»¬çš„æŸ¥è¯¢ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªé”®:ticket å’Œ ticketsã€‚æˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„`db`(æ•°æ®åº“)å˜é‡æ¥è§£ææ¥è‡ªæ•°æ®åº“çš„æ•°æ®ã€‚

```
export const resolvers = {
    Query: {
        tickets: async () => db.tickets.findAll(),
        ticket: async (obj, args, context, info) =>
            db.tickets.findByPk(args.id),
    },
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è§£æå™¨æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒä»¬æ¥è§£æåˆ é™¤è¯·æ±‚ã€‚`obj`æ˜¯æ ¹å¯¹è±¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªæ ¹å¯¹è±¡æ¥å»ºç«‹å…³ç³»ã€‚`args`æ˜¯æˆ‘ä»¬åœ¨ç±»å‹ä¸­å®šä¹‰çš„å‡½æ•°å‚æ•°ã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬çš„`tickets`çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æˆ‘ä»¬éœ€è¦å¾—åˆ°çš„ç¥¨çš„ IDã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº objï¼Œargsï¼Œcontextï¼Œinfo çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ [Apollo Docs](https://www.apollographql.com/docs/graphql-tools/resolvers/) ã€‚

## å°†ç¥¨åŠ¡æ¨¡å—æ·»åŠ åˆ°æˆ‘ä»¬çš„é˜¿æ³¢ç½—æœåŠ¡å™¨

æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å®ƒå¯¼å…¥åˆ° app.js ä¸­çš„åº”ç”¨ç¨‹åºä¸­

```
const server = new ApolloServer({
    modules: [require('./GraphQL/tickets')],
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨å¯¹ä¼˜å…ˆçº§ã€ç”¨æˆ·å’ŒçŠ¶æ€è¿›è¡ŒåŒæ ·çš„æ“ä½œï¼Œå¹¶å¯¼å…¥è¿™äº›æ¨¡å—:

```
const server = new ApolloServer({
    modules: [
        require('./GraphQL/tickets'),
        require('./GraphQL/status'),
        require('./GraphQL/users'),
        require('./GraphQL/priorities'),
    ],
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å†æ¬¡å¯åŠ¨ app åï¼Œè¿›å…¥ [localhost:5000/graphql](http://localhost:5000/graphql) å°±è¿›å…¥äº† Apollo GraphQL æŸ¥è¯¢æ„å»ºå™¨ç¯å¢ƒã€‚åœ¨è¿™ä¸ªç¯å¢ƒä¸­ï¼Œæ‚¨å¯ä»¥æµ‹è¯•æ‚¨çš„ API å¹¶åˆ›å»ºæŸ¥è¯¢ï¼Œç¨åæ‚¨å°†åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›æŸ¥è¯¢ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å³ä¾§çš„ docs æŒ‰é’®æ¥æµè§ˆæ‚¨çš„ APIã€‚å› ä¸º GraphQL æ˜¯ç±»å‹åŒ–çš„ï¼Œæ‰€ä»¥æ‚¨è‡ªåŠ¨æ‹¥æœ‰ API æ–‡æ¡£ã€‚ç›¸å½“é…·ï¼

[![](img/625e5458822257fecea4f8049850f80d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--QyStGaZx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i1.wp.com/blog.logrocket.com/wp-content/uploads/2019/07/scherma.png%3Fresize%3D730%252C463%26ssl%3D1)

## ç¬¬ä¸ƒæ­¥:åˆ›å»ºæ•°æ®é—´çš„å…³ç³»

æ‰€ä»¥è¿™å¾ˆé…·ï¼Œä½†æ˜¯å¦‚æœèƒ½åœ¨å¾—åˆ°ç¥¨çš„æ—¶å€™è‡ªåŠ¨å¾—åˆ°ç”¨æˆ·åå°±æ›´å¥½äº†ã€‚åœ¨æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬åªèƒ½è·å¾—ä¸ç¥¨ç›¸å…³è”çš„ç”¨æˆ· idã€‚åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºç¥¨è¯å’Œç”¨æˆ·ä¹‹é—´çš„å…³ç³»ã€‚

## åœ¨ç¥¨æ®ç±»å‹ä¸Šæ·»åŠ ç”¨æˆ·ç±»å‹

å› æ­¤ï¼Œé¦–å…ˆè®©æˆ‘ä»¬ç¼–è¾‘ç¥¨è¯ç±»å‹ã€‚æˆ‘ä»¬éœ€è¦è®© GraphQL çŸ¥é“æˆ‘ä»¬æƒ³è¦è¯·æ±‚ä¸€ä¸ªç±»å‹ä¸º user:
çš„ç”¨æˆ·

```
export const typeDefs = gql`
    extend type Query {
        tickets: [Ticket]
        ticket(id: ID!): Ticket
    }
    type Ticket {
        id: ID!
        subject: String
        priority_id: Int
        status_id: Int
        user_id: Int
        user: User
        assigned_to_user_id: Int
    }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ä¸ºç”¨æˆ·æ·»åŠ é¢å¤–çš„è§£æå™¨

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªåµŒå¥—çš„è§£æå™¨æ¥è§£æç¥¨æ®ä¸­çš„ç”¨æˆ·ã€‚åœ¨ resolver å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ é”®`Ticket`ã€‚å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªç±»å‹ä¸­è¯·æ±‚å¦ä¸€ä¸ªç±»å‹æ—¶ï¼ŒGraphQL å°±æ˜¯è¿™æ ·çŸ¥é“å¦‚ä½•è§£æåµŒå¥—æŸ¥è¯¢çš„ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè§£æå™¨æ˜¯ç¥¨æ®ç±»å‹ä¸­çš„ç”¨æˆ·ç±»å‹:

```
export const resolvers = {
    Query: {
        tickets: async () => db.tickets.findAll(),
        ticket: async (obj, args, context, info) =>
            db.tickets.findByPk(args.id),
    },
    Ticket: {
        user: async (obj, args, context, info) => db.users.findByPk(obj.user_id),
    },
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨`obj`æ¥è®¿é—®ç¥¨è¯æ•°æ®ã€‚åœ¨ç¥¨è¯æ•°æ®ä¸­è®¾ç½®äº†`user_id`,å› æ­¤æˆ‘ä»¬å¯ä»¥ä»æ•°æ®åº“ä¸­è·å¾—æ­£ç¡®çš„ç”¨æˆ·ã€‚

æ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„ä»£ç æ˜¯å¦æœ‰æ•ˆã€‚æˆ‘åˆ›å»ºäº†è¿™ä¸ªæŸ¥è¯¢ï¼Œçœ‹çœ‹èƒ½å¦è·å¾—åµŒå¥—çš„ç”¨æˆ·æ•°æ®ã€‚è¯·æ³¨æ„ï¼Œæ‚¨è¿˜éœ€è¦æŒ‡å®šæ‚¨æƒ³è¦çš„ç”¨æˆ·ç±»å‹å­—æ®µï¼Œåœ¨æˆ‘çš„ä¾‹å­ä¸­æ˜¯ idã€name å’Œ email å­—æ®µã€‚

```
{
  ticket(id: 3){
    id
    subject
    user{
      id
      name
      email
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¤ªå¥½äº†ï¼ŒæˆåŠŸäº†ï¼è¿™æ˜¯é˜¿æ³¢ç½—çš„å›æŠ¥:

[![](img/082e2da6345661137bcc3f47fd8a2cbf.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--e9R94vrV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i2.wp.com/blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample.png%3Fresize%3D730%252C463%26ssl%3D1)

ç°åœ¨ä»¥åŒæ ·çš„æ–¹å¼æ·»åŠ å…¶ä»–å…³ç³»:ä¼˜å…ˆçº§ã€çŠ¶æ€å’Œ assigned_to_userã€‚æ·»åŠ å®Œå¦ä¸€ä¸ªåµŒå¥—è§£æå™¨åï¼Œæ‚¨çš„ tickets.js æ–‡ä»¶å°†çœ‹èµ·æ¥åƒè¿™æ ·:

```
import { gql } from 'apollo-server-express'
import * as db from '../database'
export const typeDefs = gql`
    extend type Query {
        tickets: [Ticket]
        ticket(id: ID!): Ticket
    }
    type Ticket {
        id: ID!
        subject: String
        priority_id: Int
        priority: Priority
        status_id: Int
        status: Status
        user_id: Int
        user: User
        assigned_to_user_id: Int
        assigned_to_user: User
    }
`
export const resolvers = {
    Query: {
        tickets: async () => db.tickets.findAll(),
        ticket: async (obj, args, context, info) =>
            db.tickets.findByPk(args.id),
    },
    Ticket: {
        user: async (obj, args, context, info) =>
            db.users.findByPk(obj.user_id),
        priority: async (obj, args, context, info) =>
            db.priorities.findByPk(obj.priority_id),
        status: async (obj, args, context, info) =>
            db.status.findByPk(obj.status_id),
        assigned_to_user: async (obj, args, context, info) =>
            db.users.findByPk(obj.assigned_to_user_id),
    },
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è½¬åˆ°`localhost:5000/graphql`å¹¶æ„å»ºä¸€ä¸ªæŸ¥è¯¢ï¼Œè·å–æ‰€æœ‰ç¥¨æ®åŠå…¶çŠ¶æ€ã€ä¼˜å…ˆçº§å’Œç”¨æˆ·ã€‚ç”¨è¿™ä¸ªæŸ¥è¯¢:

```
{
  tickets{
    subject
    status{
      slug
    }
    priority{
      slug
    }
    user{
      name
    }
    assigned_to_user{
      name
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘å¾—åˆ°äº†ä»¥ä¸‹é—¨ç¥¨åŠå…¶å±æ€§:

```
{
  "data": {
    "tickets": [
      {
        "subject": "My computer is on fireğŸ”¥ğŸ”¥",
        "status": {
          "slug": "open"
        },
        "priority": {
          "slug": "high"
        },
        "user": {
          "name": "Dirk Wolthuis"
        },
        "assigned_to_user": null
      },
      {
        "subject": "MS Word is not starting, can someone help?",
        "status": {
          "slug": "doing"
        },
        "priority": {
          "slug": "low"
        },
        "user": {
          "name": "Chris Vogt"
        },
        "assigned_to_user": {
          "name": "Dirk Wolthuis"
        }
      },
      {
        "subject": "There is a bug in the ğŸ›’ of the webshop, steps to reproduce are included",
        "status": {
          "slug": "doing"
        },
        "priority": {
          "slug": "high"
        },
        "user": {
          "name": "Andrew Clark"
        },
        "assigned_to_user": {
          "name": "Dirk Wolthuis"
        }
      },
      {
        "subject": "404 error: website not found - website down?ğŸ’€",
        "status": {
          "slug": "closed"
        },
        "priority": {
          "slug": "high"
        },
        "user": {
          "name": "Andrew Clark"
        },
        "assigned_to_user": {
          "name": "Dirk Wolthuis"
        }
      }
    ]
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## ç»“è®º

æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå¯ç”¨çš„ GraphQL APIï¼Œæ‚¨å¯ä»¥æŒ‰ç…§è‡ªå·±æƒ³è¦çš„æ–¹å¼å®šåˆ¶å®ƒã€‚æ‚¨å¯ä»¥åœ¨å®ä½“ä¹‹é—´æ·»åŠ å¤šå±‚å…³ç³»ã€‚åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“è¡¨åï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºåˆ›å»ºæ‰€éœ€çš„åºåˆ—æ¨¡å‹ã€‚å‡ºäºæœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåªè¯»æ•°æ®åº“ã€‚åªæ˜¯æƒ³çœ‹çœ‹ä»£ç ï¼Ÿä½ å¯ä»¥åœ¨è¿™ä¸ªåº“ä¸­æ‰¾åˆ°å®ƒã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºå¦‚ä½•æ“ä½œæ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œä½ å¯ä»¥æŸ¥çœ‹[è®¾è®¡çªå˜](https://www.apollographql.com/docs/apollo-server/essentials/schema/#designing-mutations)æˆ–è€…é˜…è¯»[è¿™ç¯‡å…³äºçªå˜çš„æ–‡ç« ](https://www.howtographql.com/graphql-js/3-a-simple-mutation/)ã€‚æœåŠ¡å™¨çš„è®¾ç½®ç•¥æœ‰ä¸åŒï¼Œä½†é€»è¾‘æ˜¯ç›¸åŒçš„ã€‚

* * *

## Plug: [LogRocket](https://logrocket.com/signup/) ï¼Œä¸€æ¬¾é€‚ç”¨äºç½‘ç»œåº”ç”¨çš„ DVR

[![LogRocket Dashboard Free Trial Banner](img/0abf868fe5ccbed99d71cb8d9e81ed98.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--6FG5kvEL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i2.wp.com/blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png%3Fresize%3D1200%252C677%26ssl%3D1)

[log rocket](https://logrocket.com/signup/)æ˜¯ä¸€ä¸ªå‰ç«¯æ—¥å¿—å·¥å…·ï¼Œè®©ä½ é‡æ”¾é—®é¢˜ï¼Œå°±åƒå®ƒä»¬å‘ç”Ÿåœ¨ä½ è‡ªå·±çš„æµè§ˆå™¨ä¸­ä¸€æ ·ã€‚LogRocket ä¸éœ€è¦çŒœæµ‹é”™è¯¯å‘ç”Ÿçš„åŸå› ï¼Œä¹Ÿä¸éœ€è¦å‘ç”¨æˆ·è¯¢é—®æˆªå›¾å’Œæ—¥å¿—è½¬å‚¨ï¼Œè€Œæ˜¯è®©æ‚¨é‡æ”¾ä¼šè¯ä»¥å¿«é€Ÿäº†è§£å“ªé‡Œå‡ºé”™äº†ã€‚å®ƒå¯ä»¥ä¸ä»»ä½•åº”ç”¨ç¨‹åºå®Œç¾é…åˆï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ¡†æ¶ï¼Œå¹¶ä¸”æœ‰æ’ä»¶å¯ä»¥è®°å½•æ¥è‡ª Reduxã€Vuex å’Œ@ngrx/store çš„é¢å¤–ä¸Šä¸‹æ–‡ã€‚

é™¤äº†è®°å½• Redux åŠ¨ä½œå’ŒçŠ¶æ€ï¼ŒLogRocket è¿˜è®°å½•æ§åˆ¶å°æ—¥å¿—ã€JavaScript é”™è¯¯ã€stacktracesã€å¸¦æœ‰å¤´+ä½“çš„ç½‘ç»œè¯·æ±‚/å“åº”ã€æµè§ˆå™¨å…ƒæ•°æ®ã€è‡ªå®šä¹‰æ—¥å¿—ã€‚å®ƒè¿˜ä½¿ç”¨ DOM æ¥è®°å½•é¡µé¢ä¸Šçš„ HTML å’Œ CSSï¼Œç”šè‡³ä¸ºæœ€å¤æ‚çš„å•é¡µé¢åº”ç”¨ç¨‹åºé‡æ–°åˆ›å»ºåƒç´ çº§å®Œç¾è§†é¢‘ã€‚

[å…è´¹è¯•ç”¨](https://logrocket.com/signup/)ã€‚

* * *

å¸–å­[ä» REST åˆ° GraphQL:åˆ›å»º API çš„ä¸åŒæ–¹å¼(ç”¨é˜¿æ³¢ç½—& NodeJS)](https://blog.logrocket.com/from-rest-to-graphql/) é¦–å…ˆå‡ºç°åœ¨ [LogRocket åšå®¢](https://blog.logrocket.com)ä¸Šã€‚