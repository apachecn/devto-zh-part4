# ç”¨è°·æ­Œè¡ŒåŠ¨è·Ÿè¸ªæˆ‘çš„å’–å•¡

> åŸæ–‡ï¼š<https://dev.to/hurricaneinteractive/keeping-track-of-my-coffees-with-google-actions-3362>

æœ€è¿‘ï¼Œæˆ‘å¼€å§‹åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œä½¿ç”¨è°·æ­Œè¡ŒåŠ¨æ¥è·Ÿè¸ªä¸åŒçš„ç”Ÿæ´»çŠ¶æ€ã€‚è¿™å°†æ˜¯æˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨ Google Actions SDKï¼Œè¿™æ—¢ä»¤äººå…´å¥‹åˆä»¤äººä¼¤è„‘ç­‹ï¼

> ä»£ç å¯ä»¥åœ¨ [Github](https://github.com/myweekinjs/gactions-life-stats) ä¸Šæ‰¾åˆ°

## ç›®æ ‡

ç›®æ ‡å¾ˆç®€å•ï¼Œåˆ›å»ºä¸€ä¸ªå°çš„è¡ŒåŠ¨é›†ï¼Œå¢åŠ æˆ‘æ¯å¤©ç”Ÿæ´»çš„ç®€å•ç»Ÿè®¡ã€‚æ¯”å¦‚è¯´ï¼›å˜¿è°·æ­Œï¼Œç»™**å’–å•¡**åŠ  **1** ã€‚

## æ–¹æ³•#1

[Google ä¸Šçš„åŠ¨ä½œ](https://developers.google.com/actions/)æä¾›äº†ä¸¤ç§ä¸ Google Assistant äº’åŠ¨çš„æ–¹å¼ã€‚è¿™äº›æ˜¯ï¼›å¯¹è¯æµå’ŒåŠ¨ä½œ SDKã€‚æˆ‘çš„ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨ Actions SDKï¼Œå› ä¸ºå®ƒæœ€æœ‰æ„ä¹‰ã€‚å®šä¹‰ä½ çš„è¡ŒåŠ¨ï¼›*åœ¨å’–å•¡ä¸­åŠ å…¥{ number }*ã€‚æ‰¾å›å·ç ï¼Œç„¶åæŠŠå·ç åŠ åˆ°æˆ‘çš„æ€»æ•°ä¸Šã€‚

```
// Excerpt
app.intent('COFFEE', (conv, number) => {
  // +number to total
  conv.reply('Coffees added')
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶è€Œï¼Œåœ¨è°ˆåˆ°è¿™ä¸€ç‚¹ä¹‹åï¼Œæˆ‘åœ¨è¿™é‡Œè¯»åˆ°[dialog flow æ–¹æ³•æ›´é€‚åˆäºåœ¨ä¸ Google Assistant çš„äº¤äº’è¿‡ç¨‹ä¸­å®šä¹‰å‚æ•°æ¥æ•è·ä¿¡æ¯ã€‚**æ¥è¿‘ 2 å·æˆ‘æ¥äº†ï¼**](https://developers.google.com/actions/reference/nodejsv2/overview#access_parameters_and_contexts)

## æ–¹æ³•äºŒ

æ–¹æ³•äºŒæ¶‰åŠä½¿ç”¨ DialogFlow æ¥è®¾ç½®*æ„å›¾*å¹¶ç¼–å†™ Firebase äº‘å‡½æ•°æ¥å®ç°è¿™äº›*æ„å›¾*ï¼Œéå¸¸ç±»ä¼¼äºåŠ¨ä½œ SDKã€‚åœ¨ç”¨ä¸€äº›è®­ç»ƒçŸ­è¯­è®¾å®šäº†æˆ‘çš„*æ„å›¾*ä¹‹åï¼›

1.  å‘å’–å•¡ä¸­æ·»åŠ  **1**
2.  æˆ‘ä»Šå¤©å–äº† 5 æ¯å’–å•¡
3.  ç­‰ç­‰

*æ„å›¾*äº†è§£åˆ°æˆ‘æƒ³å–å‡ºæ¯ä¸ªçŸ­è¯­ä¸­çš„æ•°å­—ï¼Œå¹¶ä¿å­˜åˆ°ä¸€ä¸ª`coffees`å˜é‡ä¸­ï¼Œæˆ‘å¯ä»¥åœ¨æˆ‘çš„äº‘å‡½æ•°ä¸­ä½¿ç”¨å®ƒã€‚

```
app.intent('Add Coffee', (conv, { coffees }) => {
  conv.close(`You want to add ${coffees} to your total`)
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨å°†æˆ‘çš„äº‘åŠŸèƒ½é‡æ–°éƒ¨ç½²åˆ°æˆ‘çš„ Firebase é¡¹ç›®åï¼Œæˆ‘èƒ½å¤Ÿä¸æˆ‘å¯çˆ±çš„è°·æ­ŒåŠ©æ‰‹è¿›è¡Œä»¥ä¸‹å¯¹è¯ã€‚

*   **æˆ‘:**èŠèŠ AJ çš„ç”Ÿæ´»æ–¹å¼
*   **è°·æ­Œ**:ä½ å¥½ï¼æˆ‘æ€ä¹ˆå¸®ä½ ï¼Ÿ
*   æˆ‘:åœ¨å’–å•¡ä¸­åŠ å…¥ 2
*   è°·æ­Œ:ä½ æƒ³åœ¨ä½ çš„æ€»æ•°ä¸ŠåŠ  2

### è¿›æ­¥ï¼ï¼

ä¸‹ä¸€æ­¥æ˜¯è·å–è¯·æ±‚ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ° Firebase å®æ—¶æ•°æ®åº“ä¸­ï¼Œä»¥ä¾›ä»¥åä½¿ç”¨ã€‚è¿™æ¯”æˆ‘æƒ³è±¡çš„è¦å®¹æ˜“ã€‚ç¬¬ä¸€æ­¥æ˜¯æˆæƒæˆ‘çš„åº”ç”¨ç¨‹åºï¼Œè¿™æ˜¯é€šè¿‡`firebase-admin`åŒ…å’Œé€šè¿‡ Firebase æ§åˆ¶å°ç•Œé¢ç”Ÿæˆ SDK å¯†é’¥æ¥å®Œæˆçš„ã€‚åœ¨è¿™ä¹‹åï¼Œæˆ‘å¯ä»¥è½»æ¾åœ°ç¼–å†™ä¸€ä¸ªæ™®é€šçš„ push å‡½æ•°æ¥å°†æ•°å­—æ·»åŠ åˆ°æ•°æ®åº“ä¸­ã€‚

```
// Authorise code
app.intent('Add Coffee', ({ coffees }) => {
  admin.database().ref('/coffee').push({
    coffee: coffees
  })
  .then(/** Success */)
  .catch(/** Fail */)
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦æˆåŠŸäº†ï¼Œæˆ‘å¯¹`push`å¯¹è±¡åšäº†ä¸€ä¸ªå°å°çš„ä¿®æ”¹ï¼Œä¸ºæ•°æ®åº“ä¸­çš„å€¼æ·»åŠ äº†æ›´å¤šçš„â€œå…ƒæ•°æ®â€,å½“æˆ‘æœ€ç»ˆå°†è¿™äº›ç»Ÿè®¡æ•°æ®æ·»åŠ åˆ°ç½‘ç«™ä¸Šè®©æ¯ä¸ªäººéƒ½èƒ½çœ‹åˆ°æ—¶ã€‚ç¬¬ä¸€ä¸ªå˜åŒ–æ˜¯å°†æ•°å­—å­˜å‚¨ä¸ºä¸€ä¸ª`int`è€Œä¸æ˜¯ä¸€ä¸ª`string`ï¼Œæˆ‘è¿˜å‘è¯¥å¯¹è±¡æ·»åŠ äº†ä¸€ä¸ªæ—¶é—´æˆ³å€¼ï¼Œæˆ‘æƒ³ç”¨å®ƒæ¥æŒ‰å¤©å¯¹æˆ‘çš„å’–å•¡æ¶ˆè€—é‡è¿›è¡Œæ’åºã€‚

```
admin.database().ref('/coffee').push({
  coffee: parseInt(coffees),
  timestamp: admin.database.ServerValue.TIMESTAMP
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ç»ˆäºè®©æˆ‘çš„è°·æ­Œè¡ŒåŠ¨å‘æŒ¥ä½œç”¨äº†ï¼ä¸‹ä¸€æ­¥æ˜¯åœ¨ç½‘ç«™ä¸Šæ˜¾ç¤ºä¿¡æ¯ã€‚

> è¦æŸ¥çœ‹é¢„è§ˆï¼Œè¯·è®¿é—® myweekinjs ç½‘ç«™ä¸Šçš„[ç»Ÿè®¡é¡µé¢](https://www.myweekinjs.com/stats/)ã€‚

## æ˜¾ç¤ºæ¥è‡ªç«åœº

ä¸ºæ­¤ï¼Œæˆ‘éœ€è¦å»ºç«‹ä¸¤ä¸ªæ–‡ä»¶ã€‚

1.  Firebase ç±» [firebase.js](https://github.com/myweekinjs/public-website/blob/master/src/firebase/index.js)
2.  ç›–èŒ¨æ¯”é™æ€é¡µé¢ã€‚ [stats.js](https://github.com/myweekinjs/public-website/blob/master/src/pages/stats.js)

### Firebase.js

åœ¨äº†ä¸èµ·çš„ç›–èŒ¨æ¯”ç¤¾åŒºçš„å¸®åŠ©ä¸‹ï¼Œæˆ‘è®¾æ³•å»ºç«‹äº†æˆ‘çš„ Firebase ç±»ï¼Œå¯ä»¥åœ¨æ•´ä¸ªç½‘ç«™ä¸Šä½¿ç”¨ã€‚æˆ‘ä¸å¾—ä¸åšä¸€ä¸ªå°çš„ä¿®æ”¹ï¼Œå› ä¸ºæˆ‘å¾—åˆ°äº†ä¸€ä¸ªè®¨åŒçš„*é‡å¤åº”ç”¨*é”™è¯¯ã€‚æˆ‘æœ€ååªéœ€è¦æ£€æŸ¥ firebase åº”ç”¨ç¨‹åºæ˜¯å¦å·²ç»åˆå§‹åŒ–ã€‚ç›¸å½“å®¹æ˜“è§£å†³(è°·æ­Œæœç´¢å)ã€‚

```
if (!firebase.apps.length) {
  firebase.initializeApp({...})
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è‡³æ­¤ï¼Œæˆ‘èƒ½å¤Ÿå¯¼å…¥æˆ‘çš„`Firebase`ç±»å¹¶ä»å®æ—¶æ•°æ®åº“ä¸­æå–æ•°æ®ã€‚ä¸‡å²ï¼

### Stats.js

ç»Ÿè®¡é¡µé¢åªæœ‰ä¸€ä¸ªç›®æ ‡ï¼›æ˜¾ç¤ºæˆ‘å–çš„å’–å•¡æ€»æ•°ã€‚React ä¸–ç•Œç›®å‰æœ€çƒ­é—¨çš„æ˜¯ä»€ä¹ˆï¼Ÿé’©å­ï¼è¿™æ­£æ˜¯æˆ‘ç”¨æ¥åˆ›å»ºè¿™ä¸ªç½‘é¡µã€‚

æˆ‘éœ€è¦ä¸€äº›ä¸œè¥¿æ¥è®©å®ƒå·¥ä½œã€‚ä¸€äº›`state`å’Œä¸€ç§æ¥å—ä¼ å…¥çš„æ•°æ®åº“æ›´æ”¹å¹¶æ›´æ–°`state`çš„æ–¹æ³•ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ React æä¾›çš„`useState`å’Œ`useEffect`æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ª**éå¸¸**ç®€åŒ–ç‰ˆçš„ç»Ÿè®¡é¡µé¢ç»„ä»¶ã€‚

```
// ...imports

const StatsPage = () => {
  const [coffee, setCoffee] = useState(0)

  useEffect(() => {
    database.on('value', (data) => setCoffee(data))
  })

  return (
    <p>{ coffee.total }</p>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`useEffect`æ–¹æ³•å°†ç›‘å¬å®æ—¶æ•°æ®åº“çš„å˜åŒ–ï¼Œä¸€æ—¦æ£€æµ‹åˆ°å˜åŒ–ï¼Œå®ƒå°†æ›´æ–° coffee `state`,ç»„ä»¶å°†é‡æ–°å‘ˆç°ä»¥åæ˜ æ–°çš„æ€»æ•°ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ•°æ®ä¸ä¼šç»å¸¸æ”¹å˜ä»¥ä¿è¯æŒç»­çš„æ£€æŸ¥ï¼Œä½†æ˜¯å¦‚æœä½ å†³å®šå»ºç«‹ä¸€ä¸ªç±»ä¼¼çš„é¡¹ç›®ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•å¹¶è§‚å¯Ÿç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿã€‚

## æˆ‘å­¦åˆ°äº†ä»€ä¹ˆ

1.  Firebase äº‘å‡½æ•°æ¯”æˆ‘æƒ³è±¡çš„è¦ç®€å•å¾—å¤šï¼Œè€Œä¸”éå¸¸å¼ºå¤§ï¼è‚¯å®šä¼šè¿›ä¸€æ­¥æ¢ç´¢è¿™ä¸€ç‚¹ã€‚
2.  React Hooks å¯¹äºä» Firebase å®æ—¶æ•°æ®åº“è·å–æ•°æ®éå¸¸æœ‰ç”¨ã€‚
3.  åˆ›å»ºè¡ŒåŠ¨å’Œå¯¹è¯æµã€‚
4.  æˆ‘å¯èƒ½å–äº†å¤ªå¤šæ¯å’–å•¡ã€‚

## ä¸€äº›æœ‰ç”¨çš„èµ„æº

1.  [åˆ›å»ºåŠ¨ä½œ](https://developers.google.com/actions/dialogflow/project-agent)
2.  [ä½¿ç”¨æ•ˆæœæŒ‚é’©](https://reactjs.org/docs/hooks-effect.html)
3.  [ç®¡ç†è½¯ä»¶å¼€å‘å¥—ä»¶](https://firebase.google.com/docs/database/admin/start)

## åŒ…è£…å®Œæ¯•

åœ¨è¿™ä¹‹åï¼Œæˆ‘å¯¹ç»Ÿè®¡é¡µé¢åšäº†ä¸€äº›é¢å¤–çš„æ ·å¼æ›´æ”¹ï¼Œä½¿å®ƒçœ‹èµ·æ¥æ›´å¥½ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½¿ç”¨ Google Actions æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„äº†è§£ã€‚æˆ‘éå¸¸å–œæ¬¢ä½¿ç”¨è¿™é¡¹æŠ€æœ¯ï¼Œè®©æ‰€æœ‰çš„ä¸œè¥¿éƒ½å¯ä»¥äº’ç›¸äº¤æµ(æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªåŒå…³è¯­)ã€‚å¦‚æœæ‚¨å¯¹ä»£ç æˆ–è¿‡ç¨‹æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·é€šè¿‡ [Twitter](https://twitter.com/hurricane_int) è”ç³»æˆ‘ï¼Œæˆ‘å¾ˆä¹æ„ç»§ç»­è®¨è®ºè¿™ä¸ªé—®é¢˜å¹¶æ”¹è¿›æˆ‘çš„ä»£ç ã€‚

å¦‚æœä½ æœ‰å…´è¶£çœ‹ä¸€æ­¥ä¸€æ­¥çš„æ•™ç¨‹ï¼Œæ•™ä½ å¦‚ä½•å®ç°åŒæ ·çš„äº‹æƒ…ï¼Œè®©æˆ‘çŸ¥é“ï¼Œæˆ‘ä¼šçœ‹çœ‹æˆ‘èƒ½åšä»€ä¹ˆï¼

* * *

è°¢è°¢ä½ çœ‹æˆ‘çš„æ–‡ç« ï¼Œå®ƒçœŸçš„æ„ä¹‰é‡å¤§ï¼â¤ï¸ï¼Œè¯·æä¾›ä»»ä½•åé¦ˆæˆ–æ„è§ï¼Œæˆ‘æ€»æ˜¯æœŸå¾…æ”¹è¿›å’Œæœ‰æ„ä¹‰çš„è®¨è®ºã€‚è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘çš„ [#myweekinjs](http://myweekinjs.com) æŒ‘æˆ˜çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœä½ æœ‰å…´è¶£äº†è§£æ›´å¤šï¼Œæˆ‘è¿˜æœ‰å…¶ä»–æœ‰è¶£çš„æ–‡ç« ã€‚

### ğŸ‘‹ä¸‹æ¬¡è§ï¼