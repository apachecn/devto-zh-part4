# ç”¨ faker.js çœŸå®åœ°æ¨¡æ‹Ÿæ‚¨çš„ GraphQL æœåŠ¡å™¨

> åŸæ–‡:[https://dev . to/yvonickfrin/mock-your-graphql-server-realized-with-faker-js-25oo](https://dev.to/yvonnickfrin/mock-your-graphql-server-realistically-with-faker-js-25oo)

æœ‰æ—¶ï¼Œæ‚¨çš„ GraphQL æœåŠ¡å™¨éœ€è¦ä½¿ç”¨ä¸€ä¸ªå°šæœªå®ç°æˆ–æš‚æ—¶ä¸å¯ç”¨çš„ APIã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¨¡ä»¿ä¼¼ä¹æ˜¯æ­£ç¡®çš„äº‹æƒ…ï¼Œä½†å¾ˆéš¾ä¿æŒè‰¯å¥½çš„æ¨¡ä»¿æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆåœ¨åº”ç”¨ç¨‹åºä¸­åˆ°å¤„éƒ½æ˜¯â€œLorem ipsumâ€ã€‚

## [](#fakerjs)faker.js

faker.js æ˜¯ä¸€ä¸ªå¯ä»¥è®©ä½ åœ¨èŠ‚ç‚¹æˆ–æµè§ˆå™¨ä¸­ç”Ÿæˆè™šå‡æ•°æ®çš„åº“ã€‚å®ƒé‡‡ç”¨äº†è®¸å¤šæ–¹æ³•æ¥ä¸ºå¸¸è§ç”¨ä¾‹ç”Ÿæˆæ•°æ®ï¼Œä¾‹å¦‚:

*   åç§°
*   åœ°å€
*   ç”µè¯
*   å½¢è±¡
*   å…¬å¸
*   ...

å³ä½¿å¯¹äº...Lorem ipsumï¼

## [](#other-tools)å…¶ä»–å·¥å…·

æˆ‘ä»¬å°†ä½¿ç”¨ [Koa](https://koajs.com/#introduction) æ¥åˆ›å»ºæœåŠ¡å™¨ã€‚å®ƒæ˜¯â€œExpress èƒŒåçš„å›¢é˜Ÿè®¾è®¡çš„ä¸€ä¸ªæ–°çš„ web æ¡†æ¶â€ã€‚å®é™…ä¸Šï¼Œå®ƒæœ‰ä¸€ä¸ªä¸åŒçš„ä¸­é—´ä»¶å®ç°ï¼Œå¹¶ä¸”æ¯” express è£…è½½çš„ä¸œè¥¿å°‘ã€‚å¦‚æœä½ æƒ³è¦æ›´å¤šçš„ä¿¡æ¯ï¼ŒKoa çš„çŸ¥è¯†åº“ä¸­æœ‰ä¸€ä¸ª[çš„æ¯”è¾ƒ](https://github.com/koajs/koa/blob/master/docs/koa-vs-express.md)ã€‚

å¯¹äº GraphQL å®ç°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [Apollo æœåŠ¡å™¨](https://www.apollographql.com/docs/apollo-server/)ã€‚è¿™ä¼¼ä¹æ˜¯ GraphQL æœ€å—æ¬¢è¿çš„æœåŠ¡å™¨å®ç°ï¼Œå®ƒä¸ Koa éå¸¸å¥‘åˆï¼Œå› ä¸ºæœ‰ä¸€ä¸ª [apollo-server-koa](https://github.com/apollographql/apollo-server/tree/master/packages/apollo-server-koa) åŒ…å­˜åœ¨ï¼Œå¹¶ä¸”å·²ç»ç”± apollo æœåŠ¡å™¨å›¢é˜Ÿå®ç°ã€‚

æœ€åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¼—æ‰€å‘¨çŸ¥çš„ [cross-env](https://github.com/kentcdodds/cross-env) åŒ…æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè€Œä¸ç®¡æ‚¨ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆå¹³å°ã€‚

## [](#setting-up-the-server)è®¾ç½®æœåŠ¡å™¨

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå…·æœ‰ä»¥ä¸‹ç»“æ„çš„æ–‡ä»¶å¤¹:

```
.
â”œâ”€â”€ package.json
â””â”€â”€ src
  Â Â â””â”€â”€ index.js 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹äºè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`yarn`ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨`npm`ã€‚ç”¨`init`å‘½ä»¤åˆå§‹åŒ– package . JSON:

```
yarn init 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®‰è£…ä»¥ä¸‹ä¾èµ–é¡¹:

```
yarn add apollo-server-koa cross-env faker graphql koa 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ·»åŠ ä¸€ä¸ªæ‰§è¡Œæˆ‘ä»¬çš„`src/index.js`æ–‡ä»¶çš„`start`è„šæœ¬:

```
{  "scripts":  {  "start":  "node src/index.js"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`src/index.js`æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–äº†ä¸€ä¸ªæ–°çš„ Koa åº”ç”¨ç¨‹åº:

```
const Koa = require('koa');

const app = new Koa();

app.listen({port: 4000}, () =>
  console.log(`ğŸš€ Server ready at http://localhost:4000`),
); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿è¡Œæ‚¨çš„`start`è„šæœ¬ã€‚æ‚¨åº”è¯¥åœ¨æ§åˆ¶å°è¾“å‡ºä¸­çœ‹åˆ°ä¸Šé¢ç¤ºä¾‹ä¸­çš„`console.log`æ¶ˆæ¯ã€‚

## [](#create-the-graphql-endpoint)åˆ›å»º GraphQL ç«¯ç‚¹

æ˜¯æ—¶å€™å®ç°æˆ‘ä»¬çš„ GraphQL ç«¯ç‚¹äº†ã€‚å‡è®¾æˆ‘ä»¬å¤„åœ¨ä¸€ä¸ª API è¿˜æ²¡æœ‰å®ç°çš„æƒ…å†µä¸‹ã€‚è¿™ä¸ª API åº”è¯¥å…¬å¼€ä¸€ä¸ªåŒ…å«åå­—å’Œå§“æ°çš„äººå‘˜åˆ—è¡¨ã€‚æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªæ¨¡å¼ï¼Œå¹¶é€šè¿‡`apollo-server-koa`åœ¨`/graphql`ç«¯ç‚¹ä¸Šè®¿é—®å®ƒã€‚

ä»`apollo-server-koa` :
å¯¼å…¥`ApolloServer`å’Œ`gql`

```
const {ApolloServer, gql} = require('apollo-server-koa'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæŸ¥è¯¢ï¼Œè¯¥æŸ¥è¯¢è¿”å›ä¸€ä¸ªäººå‘˜åˆ—è¡¨å’Œäººå‘˜ç±»å‹æœ¬èº«:

```
const typeDefs = gql`
  type Person {
    lastname: String
    firstname: String
  }

  type Query {
    persons: [Person]
  }
`; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç”±äº API è¿˜ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æŠ›å‡ºä¸€ä¸ªé”™è¯¯é€šçŸ¥ç”¨æˆ·ä»–ä¸èƒ½ä½¿ç”¨è¿™ä¸ªæŸ¥è¯¢:

```
const resolvers = {
  Query: {
    persons: () => {
      throw Error('Not yet implemented');
    },
  },
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç”¨æˆ‘ä»¬çš„ç±»å‹å®šä¹‰å’ŒæŸ¥è¯¢è§£æå™¨å®ä¾‹åŒ–äº†ä¸€ä¸ª Apollo æœåŠ¡å™¨:

```
const server = new ApolloServer({
  typeDefs,
  resolvers,
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œå°†ä¹‹å‰åˆ›å»ºçš„ GraphQL ä¸­é—´ä»¶åº”ç”¨åˆ° Koa åº”ç”¨ç¨‹åº:

```
server.applyMiddleware({app}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨ç°åœ¨ä½¿ç”¨å‘½ä»¤`yarn start`å¯åŠ¨æœåŠ¡å™¨ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ url `http://localhost:4000/graphql`ã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ° [GraphQL IDE](https://github.com/prisma/graphql-playground) çš„æ¼‚äº®ç•Œé¢ã€‚

[![GraphQL IDE](../Images/9cc64ca9725b2ff07906f00811034da5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--sqbW6EgK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/frinyvonnick/graphql-faker-mocks/master/assets/GraphQLIDE.png)

å¦‚æœæ‚¨é”®å…¥ä¸€ä¸ªæŸ¥è¯¢æ¥æ£€ç´¢äººå‘˜åˆ—è¡¨åŠå…¶æ•°æ®:

```
{
  persons {
    firstname,
    lastname
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†å¯¼è‡´å‡ºç°ä»¥ä¸‹é”™è¯¯:

```
{
  "errors": [
        {
            "message": "Not yet implemented",
        }
    ]
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#mock-it-with-fakerjs)ç”¨ faker.js å˜²å¼„å®ƒ

è¿™ä¸ªé”™è¯¯ä¸æ˜¯é¢„æœŸçš„ç»“æœã€‚å½“æˆ‘ä»¬çš„æœåŠ¡å™¨è¢«å˜²ç¬‘æ—¶ï¼Œæˆ‘ä»¬éœ€è¦éšæœºçš„çœŸå®æ•°æ®ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç”¨å¦ä¸€ä¸ªç”Ÿæˆå‡æ•°æ®çš„è§£æå™¨æ¥è¦†ç›–æŠ›å‡ºé”™è¯¯çš„é»˜è®¤è§£æå™¨ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†æŠŠ`NODE_ENV`ç¯å¢ƒå˜é‡è®¾ç½®ä¸º`mock`,ä»¥ç¡®å®š Apollo æœåŠ¡å™¨åº”è¯¥éµå¾ªçš„è¡Œä¸ºã€‚æˆ‘ä»¬å°†é€šè¿‡åœ¨æˆ‘ä»¬çš„`package.json`ä¸­æ·»åŠ ä¸€ä¸ª`mock`è„šæœ¬æ¥å®ç°ï¼Œè¯¥è„šæœ¬ä½¿ç”¨`cross-env`è®¾ç½®`NODE_ENV`å˜é‡ï¼Œå¹¶è°ƒç”¨`start`è„šæœ¬:

```
{  "scripts":  {  "start":  "node src/index.js",  "mock":  "cross-env-shell NODE_ENV=mock yarn start"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Apollo server çš„é€‰é¡¹ä¸­æœ‰ä¸€ä¸ª`mocks`å±æ€§ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¸ƒå°”å€¼æˆ–ä¸€ä¸ªå¸¦æœ‰æ¨¡æ‹Ÿè§£æå™¨çš„å¯¹è±¡ã€‚é¦–å…ˆï¼Œå¦‚æœ`NODE_ENV`ç­‰äº`mock` :
ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒè®¾ç½®ä¸º`true`

```
const server = new ApolloServer({
  typeDefs,
  resolvers,
  mocks: process.env.NODE_ENV === 'mock' ? true : false,
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™ä¸€æ­¥ï¼Œå¦‚æœæ‚¨åœ¨ GraphQL IDE ä¸­é‡æ–°æ‰§è¡Œæ‚¨çš„æŸ¥è¯¢ï¼Œæ‚¨å°†å¾—åˆ°ç¬¬ä¸€ä¸ªç»“æœ:

```
{  "data":  {  "persons":  [  {  "firstname":  "Hello World",  "lastname":  "Hello World"  },  {  "firstname":  "Hello World",  "lastname":  "Hello World"  }  ]  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å¾ˆå¥½ï¼Œä½†æ˜¯ä¸å¤ªç°å®ã€‚è¦æ·»åŠ  fakerï¼Œæˆ‘ä»¬éœ€è¦å®ç°è‡ªå·±çš„æ¨¡æ‹Ÿè§£æå™¨ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ Apollo æœåŠ¡å™¨ã€‚åœ¨æ¨¡æ‹Ÿè§£æå™¨ä¸­ï¼ŒæŸ¥è¯¢å±æ€§å¿…é¡»æ˜¯è¿”å›å¸¦æœ‰è§£æå™¨å®šä¹‰çš„å¯¹è±¡çš„å‡½æ•°ã€‚åœ¨æˆ‘ä»¬çš„æŸ¥è¯¢è§£æå™¨ä¸­ï¼Œæˆ‘ä»¬è¿”å›ä¸¤ä¸ªäººçš„æ•°ç»„ã€‚

æ–¹æ³•è¢«ç»„ç»‡åœ¨åç§°ç©ºé—´ä¸­ã€‚æˆ‘ä»¬å°†ä½¿ç”¨åŒ…å«å¦‚ä¸‹æ–¹æ³•çš„`name`åç§°ç©ºé—´:

*   è¥¿æ–¹äººåçš„ç¬¬ä¸€ä¸ªå­—
*   å§“
*   jobTitle
*   æ ‡é¢˜
*   ...

ä½ çŒœå¯¹äº†ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`firstName`å’Œ`lastName`æ–¹æ³•ä¸ºæˆ‘ä»¬ä¸¤ä¸ªäººç”Ÿæˆéšæœºæ•°æ®:

```
const mockResolvers = {
  Query: () => ({
    persons: () => [
      {
        firstname: name.firstName(),
        lastname: name.lastName(),
      },
      {
        firstname: name.firstName(),
        lastname: name.lastName(),
      },
    ],
  }),
};

// ...

const server = new ApolloServer({
  typeDefs,
  resolvers,
  mocks: process.env.NODE_ENV === 'mock' ? mockResolvers : false,
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ GraphQL IDE ä¸­æ‰§è¡Œæ‚¨çš„æŸ¥è¯¢ï¼Œç°åœ¨æ‚¨å·²ç»æœ‰äº†å¦‚ä¸‹å¥½çš„æ•°æ®:

```
{  "data":  {  "persons":  [  {  "firstname":  "MÃ©lissa",  "lastname":  "Mathieu"  },  {  "firstname":  "Camille",  "lastname":  "Richard"  }  ]  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#bonus)å¥–é‡‘

è¿™é‡Œæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘ç”¨å®ƒæ¥ä¸ºæˆ‘æ¨¡æ‹Ÿçš„è§£æå™¨ç”Ÿæˆéšæœºå¤§å°çš„æ•°ç»„:

```
const randomArray = (min, max, callback) => {
  const size = random.number({min, max});
  return Array.from({length: size}, callback);
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä½¿ç”¨è¿™ä¸ªæ–¹æ³•é‡æ„å‰é¢çš„è§£æå™¨:

```
const mockResolvers = {
  Query: () => ({
    persons: () =>
      randomArray(2, 6, () => ({
        firstname: name.firstName(),
        lastname: name.lastName(),
      })),
  }),
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ç”¨æœ¬æ–‡ä¸­ä»‹ç»çš„æ‰€æœ‰æºä»£ç åˆ›å»ºäº†ä¸€ä¸ª[å­˜å‚¨åº“](https://github.com/frinyvonnick/graphql-faker-mocks)ã€‚æ„Ÿè°¢åé¦ˆğŸ™æœ‰ä»»ä½•é—®é¢˜è¯·å‘å¾®åšç»™æˆ‘[@ yvonickfrin](https://twitter.com/YvonnickFrin)ï¼