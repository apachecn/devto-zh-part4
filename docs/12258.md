# WebGL æœˆä»½ã€‚ç¬¬ 21 å¤©ã€‚æ¸²æŸ“ minecraft åœ°å½¢

> åŸæ–‡:[https://dev . to/lesnitsky/web GL-month-day-21-rendering-a-minecraft-terrain-24 b5](https://dev.to/lesnitsky/webgl-month-day-21-rendering-a-minecraft-terrain-24b5)

è¿™æ˜¯ä¸€ç³»åˆ—ä¸ WebGL ç›¸å…³çš„åšæ–‡ã€‚æ¯å¤©éƒ½ä¼šæœ‰æ–°å¸–å­

[![GitHub stars](../Images/980dd16c836e2ac32fcd1bd1d14cb6d6.png)](https://github.com/lesnitsky/webgl-month)
[![Twitter Follow](../Images/c49d0e722a1b89fc3e3188b60a1f86c9.png)T6ã€‘](https://twitter.com/lesnitsky_a)

[åŠ å…¥é‚®ä»¶åˆ—è¡¨](http://eepurl.com/gwiSeH),è®©æ–°é‚®ä»¶ç›´æ¥è¿›å…¥ä½ çš„æ”¶ä»¶ç®±

[æ­¤å¤„æä¾›æºä»£ç ](https://github.com/lesnitsky/webgl-month)

å»ºé€ äº

[![Git Tutor Logo](../Images/4a5fcbd1126401b65ca7fbe362404aa0.png)T2ã€‘](https://github.com/lesnitsky/git-tutor)

* * *

å˜¿ğŸ‘‹

æ¬¢è¿æ¥åˆ° WebGL æœˆã€‚

æ˜¨å¤©æˆ‘ä»¬æ¸²æŸ“äº†ä¸€ä¸ªå•ç‹¬çš„ minecraft æ³¥åœŸç«‹æ–¹ä½“ï¼Œä»Šå¤©è®©æˆ‘ä»¬æ¥æ¸²æŸ“ä¸€ä¸ªåœ°å½¢å§ï¼

æˆ‘ä»¬éœ€è¦å°†æ¯ä¸ªå—çš„ä½ç½®å­˜å‚¨åœ¨å•ç‹¬çš„å˜æ¢çŸ©é˜µä¸­

ğŸ“„src/3d-textured.js

```
 gl.viewport(0, 0, canvas.width, canvas.height);

+ const matrices = [];
+ 
  function frame() {
      mat4.rotateY(cube.modelMatrix, cube.modelMatrix, Math.PI / 180); 
```

ç°åœ¨è®©æˆ‘ä»¬åœ¨ x å’Œ z è½´ä¸Šä»-50 åˆ° 50 åˆ›å»º 10k å—è¿­ä»£

ğŸ“„src/3d-textured.js

```
 const matrices = [];

+ for (let i = -50; i < 50; i++) {
+     for (let j = -50; j < 50; j++) {
+         const matrix = mat4.create();
+     }
+ }
+ 
  function frame() {
      mat4.rotateY(cube.modelMatrix, cube.modelMatrix, Math.PI / 180); 
```

æ¯ä¸ªå—çš„å¤§å°ä¸º 2(é¡¶ç‚¹åæ ‡ä¸º[-1..1] range)æ‰€ä»¥ä½ç½®åº”è¯¥èƒ½è¢« 2 æ•´é™¤

ğŸ“„src/3d-textured.js

```
 for (let i = -50; i < 50; i++) {
      for (let j = -50; j < 50; j++) {
          const matrix = mat4.create();
+ 
+         const position = [i * 2, (Math.floor(Math.random() * 2) - 1) * 2, j * 2];
      }
  } 
```

ç°åœ¨æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå˜æ¢çŸ©é˜µã€‚è®©æˆ‘ä»¬ç”¨`ma4.fromTranslation`

ğŸ“„src/3d-textured.js

```
 const matrix = mat4.create();

          const position = [i * 2, (Math.floor(Math.random() * 2) - 1) * 2, j * 2];
+         mat4.fromTranslation(matrix, position);
      }
  } 
```

è®©æˆ‘ä»¬ä¹Ÿå›´ç»• Y è½´æ—‹è½¬æ¯ä¸ªå—ï¼Œä½¿åœ°å½¢çœ‹èµ·æ¥æ›´éšæœº

ğŸ“„src/3d-textured.js

```
 gl.viewport(0, 0, canvas.width, canvas.height);

  const matrices = [];
+ const rotationMatrix = mat4.create(); 
  for (let i = -50; i < 50; i++) {
      for (let j = -50; j < 50; j++) {

          const position = [i * 2, (Math.floor(Math.random() * 2) - 1) * 2, j * 2];
          mat4.fromTranslation(matrix, position);
+ 
+         mat4.fromRotation(rotationMatrix, Math.PI * Math.round(Math.random() * 4), [0, 1, 0]);
+         mat4.multiply(matrix, matrix, rotationMatrix);
      }
  } 
```

æœ€åå°†æ¯ä¸ªå—çŸ©é˜µæ¨é€åˆ°çŸ©é˜µé›†åˆä¸­

ğŸ“„src/3d-textured.js

```
 mat4.fromRotation(rotationMatrix, Math.PI * Math.round(Math.random() * 4), [0, 1, 0]);
          mat4.multiply(matrix, matrix, rotationMatrix);
+ 
+         matrices.push(matrix);
      }
  } 
```

ç”±äºæˆ‘ä»¬çš„å—æ˜¯é™æ€çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯ä¸€å¸§æ—‹è½¬å˜æ¢

ğŸ“„src/3d-textured.js

```
 }

  function frame() {
-     mat4.rotateY(cube.modelMatrix, cube.modelMatrix, Math.PI / 180);
- 
      gl.uniformMatrix4fv(programInfo.uniformLocations.modelMatrix, false, cube.modelMatrix);
      gl.uniformMatrix4fv(programInfo.uniformLocations.normalMatrix, false, cube.normalMatrix); 
```

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦è¿­ä»£çŸ©é˜µé›†åˆï¼Œå¹¶ä¸ºæ¯ä¸ªç«‹æ–¹ä½“å‘å‡ºä¸€ä¸ª draw è°ƒç”¨ï¼Œå°†å…¶è½¬æ¢çŸ©é˜µä¼ é€’ç»™ uniform

ğŸ“„src/3d-textured.js

```
 }

  function frame() {
-     gl.uniformMatrix4fv(programInfo.uniformLocations.modelMatrix, false, cube.modelMatrix);
-     gl.uniformMatrix4fv(programInfo.uniformLocations.normalMatrix, false, cube.normalMatrix); +     matrices.forEach((matrix) => {
+         gl.uniformMatrix4fv(programInfo.uniformLocations.modelMatrix, false, matrix);
+         gl.uniformMatrix4fv(programInfo.uniformLocations.normalMatrix, false, cube.normalMatrix); 
-     gl.drawArrays(gl.TRIANGLES, 0, vertexBuffer.data.length / 3);
+         gl.drawArrays(gl.TRIANGLES, 0, vertexBuffer.data.length / 3);
+     }); 
      requestAnimationFrame(frame);
  } 
```

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ—‹è½¬æ‘„åƒæœºçš„åŠ¨ç”»ã€‚æ‘„åƒæœºæœ‰ä¸€ä¸ªä½ç½®å’Œä¸€ä¸ªæŒ‡å‘çš„ç‚¹ã€‚å› æ­¤ï¼Œè¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å›´ç»•ç›¸æœºçš„ä½ç½®æ—‹è½¬ç„¦ç‚¹ã€‚è®©æˆ‘ä»¬é¦–å…ˆæ‘†è„±é™æ€è§†å›¾çŸ©é˜µ

ğŸ“„src/3d-textured.js

```
 const viewMatrix = mat4.create();
  const projectionMatrix = mat4.create();

- mat4.lookAt(viewMatrix, [0, 4, -7], [0, 0, 0], [0, 1, 0]);
- 
  mat4.perspective(projectionMatrix, (Math.PI / 360) * 90, canvas.width / canvas.height, 0.01, 100);

  gl.uniformMatrix4fv(programInfo.uniformLocations.viewMatrix, false, viewMatrix); 
```

å®šä¹‰ç›¸æœºä½ç½®ã€ç›¸æœºç„¦ç‚¹å‘é‡å’Œç„¦ç‚¹å˜æ¢çŸ©é˜µ

ğŸ“„src/3d-textured.js

```
- import { mat4 } from 'gl-matrix'; + import { mat4, vec3 } from 'gl-matrix'; 
  import vShaderSource from './shaders/3d-textured.v.glsl';
  import fShaderSource from './shaders/3d-textured.f.glsl';
      }
  }

+ const cameraPosition = [0, 10, 0];
+ const cameraFocusPoint = vec3.fromValues(30, 0, 0);
+ const cameraFocusPointMatrix = mat4.create();
+ 
+ mat4.fromTranslation(cameraFocusPointMatrix, cameraFocusPoint);
+ 
  function frame() {
      matrices.forEach((matrix) => {
          gl.uniformMatrix4fv(programInfo.uniformLocations.modelMatrix, false, matrix); 
```

æˆ‘ä»¬çš„ç›¸æœºä½äº 0.0.0ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†ç›¸æœºç„¦ç‚¹å¹³ç§»åˆ° 0.0.0ï¼Œæ—‹è½¬å®ƒï¼Œç„¶åå¹³ç§»å›åŸå§‹ä½ç½®

ğŸ“„src/3d-textured.js

```
 mat4.fromTranslation(cameraFocusPointMatrix, cameraFocusPoint);

  function frame() {
+     mat4.translate(cameraFocusPointMatrix, cameraFocusPointMatrix, [-30, 0, 0]);
+     mat4.rotateY(cameraFocusPointMatrix, cameraFocusPointMatrix, Math.PI / 360);
+     mat4.translate(cameraFocusPointMatrix, cameraFocusPointMatrix, [30, 0, 0]);
+ 
      matrices.forEach((matrix) => {
          gl.uniformMatrix4fv(programInfo.uniformLocations.modelMatrix, false, matrix);
          gl.uniformMatrix4fv(programInfo.uniformLocations.normalMatrix, false, cube.normalMatrix); 
```

æœ€åä¸€æ­¥â€“ç»Ÿä¸€æ›´æ–°è§†å›¾çŸ©é˜µ

ğŸ“„src/3d-textured.js

```
 mat4.rotateY(cameraFocusPointMatrix, cameraFocusPointMatrix, Math.PI / 360);
      mat4.translate(cameraFocusPointMatrix, cameraFocusPointMatrix, [30, 0, 0]);

+     mat4.getTranslation(cameraFocusPoint, cameraFocusPointMatrix);
+ 
+     mat4.lookAt(viewMatrix, cameraPosition, cameraFocusPoint, [0, 1, 0]);
+     gl.uniformMatrix4fv(programInfo.uniformLocations.viewMatrix, false, viewMatrix);
+ 
      matrices.forEach((matrix) => {
          gl.uniformMatrix4fv(programInfo.uniformLocations.modelMatrix, false, matrix);
-         gl.uniformMatrix4fv(programInfo.uniformLocations.normalMatrix, false, cube.normalMatrix); 
          gl.drawArrays(gl.TRIANGLES, 0, vertexBuffer.data.length / 3);
      }); 
```

å°±æ˜¯è¿™æ ·ï¼

ä¸è¿‡è¿™ç§æ–¹æ³•çš„æ€§èƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ºæ¯ä¸ªå¯¹è±¡å‘å‡º 2 ä¸ª gl è°ƒç”¨ï¼Œæ‰€ä»¥æ¯å¸§æœ‰ 20k ä¸ª gl è°ƒç”¨ã€‚GL ç”µè¯å¾ˆè´µï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å‡å°‘è¿™ä¸ªæ•°å­—ã€‚æ˜å¤©æˆ‘ä»¬å°†å­¦ä¹ ä¸€é¡¹ä¼Ÿå¤§çš„æŠ€æœ¯ï¼

* * *

[![GitHub stars](../Images/980dd16c836e2ac32fcd1bd1d14cb6d6.png)](https://github.com/lesnitsky/webgl-month)
[![Twitter Follow](../Images/c49d0e722a1b89fc3e3188b60a1f86c9.png)T6ã€‘](https://twitter.com/lesnitsky_a)

[åŠ å…¥é‚®ä»¶åˆ—è¡¨](http://eepurl.com/gwiSeH),è®©æ–°é‚®ä»¶ç›´æ¥è¿›å…¥ä½ çš„æ”¶ä»¶ç®±

[æ­¤å¤„æä¾›æºä»£ç ](https://github.com/lesnitsky/webgl-month)

å»ºé€ äº

[![Git Tutor Logo](../Images/4a5fcbd1126401b65ca7fbe362404aa0.png)T2ã€‘](https://github.com/lesnitsky/git-tutor)