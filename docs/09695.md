# è°çœ‹ç€å®ˆæœ›è€…ï¼Ÿçªå˜æµ‹è¯•æ­£åœ¨è¿›è¡Œ

> åŸæ–‡ï¼š<https://dev.to/noriste/who-watches-the-watchmen-mutation-testing-in-action-3889>

*æµ‹è¯•æœ‰æ•ˆæ€§æµ‹é‡ã€‚* *å† å†›çš„è£èª‰å½’äº[çº¦å°¼Â·æˆˆå¾·å ¡](http://goldbergyoni.com)ã€‚æˆ‘å–œæ¬¢å®ƒï¼Œå› ä¸ºå®ƒçš„è°éŸ³å’Œ[ä»¤äººæƒŠå¹çš„æ¼«ç”»å°è¯´](https://it.wikipedia.org/wiki/Watchmen)æµ®ç°åœ¨æˆ‘çš„è„‘æµ·é‡Œã€‚* 

æ‰€ä»¥ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ–°å‡½æ•°ï¼Œå®ƒéœ€è¦å¤§é‡çš„å•å…ƒæµ‹è¯•(æ¯”å¦‚æˆ‘çš„[æ¯”ç‰¹å¸åœ°å€æ­£åˆ™è¡¨è¾¾å¼éªŒè¯](https://github.com/NoriSte/bitcoin-address-soft-regex-validation))ã€‚å‘Šè¯‰æˆ‘:ä½ å¦‚ä½•åˆ¤æ–­ä½ çš„æµ‹è¯•çš„æœ‰æ•ˆæ€§ï¼Ÿä½ ç¡®å®šä½ åœ¨ç”¨æ‰€æœ‰å¿…è¦çš„æé™æƒ…å†µæµ‹è¯•æ¯ä¸€ä¸ªç‰¹æ€§å—ï¼Ÿæ˜¯ä»€ä¹ˆè®©ä½ å¦‚æ­¤è‡ªä¿¡ï¼Ÿ

æˆ‘çŸ¥é“ç­”æ¡ˆ:[ä»£ç è¦†ç›–](https://www.wikiwand.com/en/Code_coverage)å’Œç»éªŒã€‚

ä¸¤ä¸ªè€ƒè™‘å› ç´ :

*   ä»£ç è¦†ç›–ç‡å¹¶ä¸èƒ½è¡¡é‡æµ‹è¯•çš„æœ‰æ•ˆæ€§ã€‚ä»£ç è¦†ç›–å¯ä»¥å¸®åŠ©ä½ æ‰¾åˆ°æœªæµ‹è¯•çš„æ¡ˆä¾‹ï¼Œå®ƒåœ¨è¿™æ–¹é¢åšå¾—å¾ˆå¥½ã€‚ä½†æ˜¯å®ƒä¸èƒ½å‘Šè¯‰ä½ ä»»ä½•å…³äºä½ çš„ä»£ç çš„è´¨é‡çš„ä¿¡æ¯ã€‚æ‚¨å¯ä»¥åœ¨æºä»£ç ä¸­ç•™ä¸‹å¤§é‡çš„ bugï¼Œä»£ç è¦†ç›–ç‡åªèƒ½å¸®åŠ©æ‚¨é€šè¿‡æ‰€æœ‰è¿™äº› bugï¼Œè€Œä¸èƒ½è§£å†³å®ƒä»¬ã€‚ä½ å¯ä»¥äº‰è¾©è¯´é”™è¯¯å¿…é¡»é€šè¿‡æµ‹è¯•æ¥å‘ç°ï¼Œä½†æ˜¯...
*   æµ‹è¯•éœ€è¦ç»éªŒï¼Œå½“ä½ å¼€å§‹åšæµ‹è¯•æ—¶ï¼Œä½ ä¸ä¼šå†™å‡ºæœ€å¥½çš„æµ‹è¯•ã€‚ä½ è·å¾—çš„ç»éªŒè¶Šå¤šï¼Œä½ è„‘æµ·ä¸­å°±ä¼šå‡ºç°è¶Šå¤šçš„ç–‘é—®ï¼Œé—®è‡ªå·±â€œæˆ‘ç¡®å®šè¿™äº›æµ‹è¯•çœŸçš„åœ¨æµ‹è¯•æˆ‘çš„åŠŸèƒ½å—ï¼Ÿâ€

åˆ«æ‹…å¿ƒï¼Œè¿™æ˜¯ä¸€æ¡å·²ç»èµ°è¿‡çš„è·¯ã€‚ä½ è·å¾—çš„ç»éªŒè¶Šå¤šï¼Œä½ å°±è¶ŠçŸ¥é“ä½ çš„ä»£ç å¹¶ä¸å®Œç¾ï¼Œè¿™å°±æ˜¯ä½ å¼€å§‹æµ‹è¯•çš„åŸå› ...ä½ æµ‹è¯•çš„è¶Šå¤šï¼Œä½ å°±è¶Šæƒ³ç¡®å®šä½ çš„æµ‹è¯•æ˜¯æœ‰æ•ˆçš„ã€‚

å¼•ç”¨æˆ‘ä¸€ä¸ªåŒäº‹çš„è¯(å—¨[ç±³å°”ç§‘](https://www.linkedin.com/in/fcracker79/)ğŸ‘‹):

> æœ‰æ—¶æˆ‘å¼•å…¥çªå˜æ¥å¯¹æˆ‘çš„æµ‹è¯•æœ‰ä¿¡å¿ƒ

## çªå˜æ£€æµ‹

æ£€æŸ¥æ‚¨çš„æµ‹è¯•æ˜¯å¦æœ‰æ•ˆéå¸¸ç®€å•:åœ¨æ‚¨çš„ä»£ç ä¸­æ”¾ç½®ä¸€äº› bug å¹¶å¯åŠ¨æµ‹è¯•ã€‚å¦‚æœæµ‹è¯•æ²¡æœ‰å¤±è´¥ï¼Œå®ƒä»¬å¯¹æ•è· bug æ˜¯æ— ç”¨çš„ã€‚è¿™æ˜¯å˜å¼‚æµ‹è¯•ï¼ä½ æ”¹å˜äº†æºä»£ç (è¿™ä¸ªæ–°çš„å’Œè¢«çªƒå¬çš„æºä»£ç è¢«ç§°ä¸ºâ€œä¸€ä¸ªçªå˜ä½“â€)ï¼Œå¹¶ä¸”ä½ å¯åŠ¨äº†é’ˆå¯¹å®ƒçš„æµ‹è¯•å¥—ä»¶ã€‚

äº‹å®ä¸Šï¼Œ[çªå˜æµ‹è¯•](https://en.wikipedia.org/wiki/Mutation_testing)çš„ä¸»è¦ç›®æ ‡æ˜¯:

*   è¯†åˆ«å¼±æµ‹è¯•çš„ä»£ç ç‰‡æ®µ(çªå˜ä½“ä¸ä¼šè¢«æ€æ­»çš„ä»£ç ç‰‡æ®µ)
*   è¯†åˆ«å¼±æµ‹è¯•(é‚£äº›ä»ä¸æ€æ­»çªå˜ä½“çš„æµ‹è¯•)

ã€ [![The Mutation Testing process](img/07ca4f68f873a9a0bc4daee75e6473ac.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ANYnZLZ7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/oflwmo2vixplu2834v4p.png) *çªå˜æ£€æµ‹*

å¦‚æœä½ è®¤ä¸ºæˆ‘ä»¬åœ¨è°ˆè®ºä¸€äº›æµ‹è¯•æ€ªèƒ...å‰è¿›ğŸ˜Š

## ä¸¾ä¸ªä¾‹å­

æˆ‘é€‰æ‹©ç”¨æˆ‘çš„ä¸€ä¸ªæ—§åŒ…æ¥ç©çªå˜æµ‹è¯•: [Typescript æ˜¯ Type](https://github.com/NoriSte/typescript-is-type) ã€‚æ•´ä¸ªåŒ…ç›¸å½“å°ï¼Œä¸‹é¢æ˜¯æºä»£ç 

```
module.exports = {
  /**
   * Perform a runtime check about an instance type. It returns true if all the specified keys are
   * different from undefined
   * @param {*} instance The instance to be checked
   * @param {string|string[]} keys The keys that must be defined while checking the instance type
   */
  is(instance, keys) {
    if (instance === undefined || instance === null) {
      return false;
    }
    if(!Array.isArray(keys)) {
      keys = [keys];
    }

    for(let i = 0, n = keys.length; i < n; i++) {
      if(instance[keys[0]] === undefined) {
        return false;
      }
    }
    return true;
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ çœ‹åˆ°é‚£åªå·¨å¤§çš„è™«å­äº†å—ï¼Ÿ

æˆ‘å®‰è£…äº† Strykerï¼Œå®ƒç®¡ç†æˆ‘çš„æºä»£ç çš„æ‰€æœ‰å˜æ›´è¿‡ç¨‹ï¼Œå¹¶è‡ªåŠ¨å¯åŠ¨æµ‹è¯•å¥—ä»¶ã€‚

è¯·æ³¨æ„:Stryker çš„å®‰è£…éå¸¸ç®€å•ï¼Œç„¶åä½ åªéœ€è¦é€šè¿‡ [Stryker é…ç½®](https://github.com/stryker-mutator/stryker/tree/master/packages/core#mutate-string)æ·»åŠ ä½ æƒ³è®©å®ƒå˜å¼‚çš„æ–‡ä»¶ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒåªæ˜¯`mutate: ["index.js"]`ã€‚

æœ‰ä¸€æ¬¡ç”¨`npx styker run`å‘å°„äº† Styker æˆ‘å‘ç°äº†ä¸€ä¸ªæƒŠå–œï¼Œä¸€ä¸ªå˜å¼‚äººå±…ç„¶æ´»äº†ä¸‹æ¥

[![A survived mutant](img/3955e18a80319b02060a9bdc3771fd6c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--IFlekenf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ztoorjeyoyt42h3npx8v.png)

å²èµ›å…‹å‘Šè¯‰æˆ‘ï¼Œä»æµ‹è¯•çš„è§’åº¦æ¥çœ‹ï¼Œå¦‚æœå®ƒç”¨`i <= n`çªå˜äº†`i < n`ï¼Œæ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚æµ‹è¯•æ²¡æœ‰æ€æ­»è¿™ç§çªå˜ä½“(æµ‹è¯•é€šè¿‡äº†`i < n`æˆ–`i <= n`çªå˜)ã€‚æ€ä¹ˆå¯èƒ½å‘¢ï¼Ÿå¾ªç¯æ¡ä»¶æ€ä¹ˆå¯èƒ½ä¸å½±å“æµ‹è¯•å‘¢ï¼ŸğŸ¤”å› ä¸ºä¸€åªå·¨å¤§çš„è™«å­ï¼çœ‹ä¸€çœ‹`instance[keys[0]]`ï¼å®ƒæ²¡æœ‰ä½¿ç”¨`i`å˜é‡ï¼ï¼ï¼

å¥½äº†ï¼Œå€’æ¥£çš„äº‹æƒ…å‘ç”Ÿäº†ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹:

*   ä»£ç è¦†ç›–ç‡å¹¶æ²¡æœ‰å¸®åŠ©æ‰¾åˆ° bugï¼Œå› ä¸ºæ­£å¦‚æˆ‘åœ¨æ–‡ç« å¼€å§‹æ—¶æ‰€è¯´çš„ï¼Œå®ƒä¸èƒ½æ£€æŸ¥ä»£ç çš„è´¨é‡ï¼Œå®ƒåªæ˜¯æ£€æŸ¥æµ‹è¯•æ˜¯å¦é€šè¿‡äº†æ‰€æœ‰çš„ä»£ç è¡Œ
*   æ¯•ç«Ÿï¼Œæˆ‘çš„æµ‹è¯•ä¸æ˜¯å¾ˆå¥½ã€‚åœ¨æºä»£ç å’Œæµ‹è¯•ä¸­éƒ½å¯èƒ½å‡ºç°é”™è¯¯

## æˆ‘æ˜¯æ€ä¹ˆä¿®å¥½çš„

å˜å¼‚æµ‹è¯•çš„ä¸»é¢˜ä¸æ˜¯æºä»£ç ï¼Œè€Œæ˜¯æµ‹è¯•æœ¬èº«ã€‚å¦‚æœæˆ‘çš„æµ‹è¯•å…è®¸ä¸€ä¸ªåƒå‘ç°çš„é‚£æ ·çš„å·¨å¤§é”™è¯¯ï¼Œæˆ‘éœ€è¦æ”¹è¿›å®ƒä»¬ã€‚

æˆ‘æ·»åŠ äº†æ›´å¤šçš„æµ‹è¯•å’ŒæœŸæœ›æ¥çœŸæ­£æµ‹è¯•ç¼ºå¤±çš„ç‰¹æ€§(æ£€æŸ¥æ‰€æœ‰çš„é”®ï¼Œè€Œä¸ä»…ä»…æ˜¯ç¬¬ä¸€ä¸ªé”®)ã€‚ä¸æ”¹å˜æºä»£ç ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€äº›å¤±è´¥çš„æµ‹è¯•ï¼Œæ­£å¦‚æ‰€æ–™ï¼ç„¶åï¼Œæˆ‘ä¿®å¤äº†é”™è¯¯ï¼Œæµ‹è¯•é€šè¿‡äº†ï¼Œå®Œç¾ï¼æˆ‘å†æ¬¡è¿è¡Œ Strykerï¼Œç°åœ¨ä¸€åˆ‡æ­£å¸¸

[![No more survived mutants](img/da70d18ea46cf0a26585cdfb26fd656a.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Jats95hF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/khpcevv6v1g7cp86ipm4.png)

çªå˜æµ‹è¯•å¯¿å‘½é•¿ğŸ˜Š

## ç»“è®º

ä½ æµ‹è¯•çš„è¶Šå¤šï¼Œä½ å°±è¶Šéœ€è¦çŸ¥é“ä½ çš„æµ‹è¯•æ˜¯å¦æœ‰æ•ˆã€‚Stryker è¿˜ä¸å®Œç¾(ä¾‹å¦‚:ä½ ç°åœ¨ä¸èƒ½å¿½ç•¥ä¸€äº›è¡Œï¼Œæ¯”å¦‚ä¸€äº›ä¸åŒçš„`console.log`)ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªæ•æ‰ bugã€æé«˜ä½ çš„æµ‹è¯•ä¿¡å¿ƒã€è®©ä½ çš„ä»£ç å¾—åˆ°æ›´å¥½æµ‹è¯•çš„å¥½å·¥å…·ã€‚

æˆ‘æ˜¯åœ¨å…³æ³¨ [Yoni Goldberg](http://goldbergyoni.com) å’Œè§‚çœ‹ä»–çš„[Advanced node . js Testing:beyond unit&integration tests(2019)](https://youtu.be/-2zP494wdUY)è§†é¢‘æ—¶å‘ç°è¿™ä¸ªçªå˜æµ‹è¯•è¯é¢˜çš„ï¼Œçœ‹çœ‹ä»–çš„å†…å®¹ğŸ˜‰