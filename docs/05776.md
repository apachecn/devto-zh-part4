# å¦‚ä½•ç”¨ Autoit å’Œé‡è§’å™¨è‡ªåŠ¨æµ‹è¯•æ–‡ä»¶ä¸Šä¼ 

> åŸæ–‡:[https://dev . to/valeria/how-to-automate-file-upload-testing-with-autoit-and-progradator-d94](https://dev.to/valeria/how-to-automate-file-upload-testing-with-autoit-and-protractor-d94)

# [](#introduction)ç®€ä»‹

åœ¨å¤§å¤šæ•° web åº”ç”¨ç¨‹åºä¸­ï¼Œæ–‡ä»¶ä¸Šä¼ ä¸ä»…ä»…æ˜¯åŸºäº web çš„åŠŸèƒ½ï¼Œè¿˜éœ€è¦ç³»ç»Ÿçª—å£æ´»åŠ¨ï¼Œå¦‚
æ‰“å¼€ç³»ç»Ÿå¯¹è¯æ¡†â€œOpen â€,æ‚¨å¯ä»¥åœ¨å…¶ä¸­é€‰æ‹©è¦ä¸Šä¼ åˆ°ç½‘ç«™çš„æ–‡ä»¶ã€‚æµ‹è¯•è‡ªåŠ¨åŒ–æ¡†æ¶å’Œå·¥å…·ä¸å¤„ç†è¿™ç§åŸºäºçª—å£çš„æ´»åŠ¨ã€‚

åœ¨æˆ‘çš„ web åº”ç”¨ç¨‹åºè‡ªåŠ¨åŒ–æµ‹è¯•ä¸­ï¼Œå¯ä»¥å¤„ç† Windows ç³»ç»Ÿå¯¹è¯æ¡†å—ï¼Ÿ
æ˜¯çš„ã€‚ä½¿ç”¨ç¼–è¯‘çš„ Autoit è„šæœ¬æ˜¯å¯èƒ½çš„ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•è‡ªåŠ¨åŒ–ä¸ Windows ä¸Šä¼ å¯¹è¯æ¡†çš„äº¤äº’ï¼Œå¹¶å°†äº†è§£:

*   ä»€ä¹ˆæ˜¯ Autoit
*   å¦‚ä½•ä½¿ç”¨ Autoit
*   å¦‚ä½•ç¼–å†™å’Œç¼–è¯‘ Autoit è„šæœ¬
*   å¦‚ä½•åœ¨ E2E æµ‹è¯•ä¸­ä½¿ç”¨å·²ç¼–è¯‘çš„ Autoit è„šæœ¬

## [](#1-what-is-autoit)1ã€‚ä»€ä¹ˆæ˜¯ Autoit

Autoit æ˜¯ä¸€ä¸ªå…è´¹çš„å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è‡ªåŠ¨ä¸ Windows æ¡Œé¢åº”ç”¨ç¨‹åºï¼Œå¯¹è¯æ¡†å’Œè¿›ç¨‹ï¼Œå¦‚è¿è¡Œï¼Œå…³é—­ï¼Œåˆ é™¤åº”ç”¨ç¨‹åºã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒAutoit å¯ç”¨äºè‡ªåŠ¨åŒ– Windows GUIã€‚

è‡ªåŠ¨åŒ– Windows GUI Autoit v3 è„šæœ¬è¯­è¨€ä½¿ç”¨ã€‚Autoit v3 æ˜¯ä¸€ç§ç±»ä¼¼ BASIC çš„è„šæœ¬è¯­è¨€ã€‚å› æ­¤ï¼Œè¯·å‡†å¤‡å¥½åœ¨æœ¬æ•™ç¨‹ä¸­å­¦ä¹ ç±»ä¼¼ BASIC çš„è¯­æ³•ã€‚

æœ‰å…³ Autoit å’Œ Autoit v3 çš„æ›´å¤šä¿¡æ¯ï¼Œæ‚¨å¯ä»¥åœ¨ [Autoit å®˜æ–¹ç½‘ç«™](https://www.autoitscript.com/site/)ä¸Šæ‰¾åˆ°ã€‚

## [](#2-how-to-use-autoit)2ã€‚å¦‚ä½•ä½¿ç”¨ Autoit

é¦–å…ˆï¼Œè®©æˆ‘ä»¬è½¬åˆ° [AutoIt ä¸‹è½½](https://www.autoitscript.com/site/autoit/downloads/)å¹¶ä¸‹è½½ AutoIt å®Œæ•´å®‰è£…ã€‚

[![Autoit full installation](../Images/d03c2e0ce444525154ddc85b4f2c41ec.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s---lPrEiri--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/7vrn5ss7x3f0jax1mhjs.PNG)

é€šè¿‡æ‰€æœ‰å®‰è£…æ­¥éª¤ï¼Œæ‰“å¼€ Autoit3 æ–‡ä»¶å¤¹ï¼Œå¹¶è¿è¡Œ Au3Info.exeã€‚è¿™ä¸ªåº”ç”¨ç¨‹åºç”¨äºè·å–ç¼–ç¨‹ä¸­å°†è¦ä½¿ç”¨çš„çª—å£çš„ä¿¡æ¯ã€‚

[![Window info app](../Images/0b35bb05e214410318d250187a30e940.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Vt8SSC7X--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/tf4owqssgb9trvihxebp.PNG)

ç¼–ç¨‹ä¸å¯¹è¯æ¡†äº¤äº’æ‰€éœ€çš„ç³»ç»Ÿå¯¹è¯æ¡†çš„åŸºæœ¬ä¿¡æ¯æ˜¯**ç±»**ã€**æ ‡é¢˜**å’Œ**å®ä¾‹**ã€‚

[![Winfow info](../Images/a7f6b85bbc80e281bf3c167bc228e9e8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ddmg_uQY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ymdikzrckgiffianlzte.PNG)

è¦è·å¾—å…³äºå…ƒç´ æˆ–çª—å£çš„ä¿¡æ¯ï¼Œè¯·æŒ‰ä½ Finder å·¥å…·å¹¶å°†é¼ æ ‡ç§»åŠ¨åˆ°å…ƒç´ æˆ–çª—å£ä¸Šã€‚

[![Finder tool](../Images/630025469c2a45f8518659c71f995326.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xN9DCY9E--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/w6wnrry6h31hgwu83lgf.png)

å—¯ï¼Œå¦‚ä½•ä½¿ç”¨ Autoit å·¥å…·æ˜¯éå¸¸æ¸…æ¥šçš„ã€‚è®©æˆ‘ä»¬è¿›å…¥ç¼–ç¨‹éƒ¨åˆ†ã€‚

## [](#3-autoit-scripting)3ã€‚è‡ªåŠ¨è„šæœ¬

è¿™ç¯‡æ–‡ç« æ˜¯å…³äºæ–‡ä»¶ä¸Šä¼ çš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚
æ‰€ä»¥ï¼Œç›®æ ‡æ˜¯è‡ªåŠ¨åŒ–ä¸â€œæ‰“å¼€â€Windows ç³»ç»Ÿå¯¹è¯æ¡†çš„äº¤äº’ã€‚æˆ‘ä»¬åˆ†å‡ æ­¥æ¥åšå§ã€‚

**ç¬¬ä¸€æ­¥**

ç¬¬ä¸€æ­¥æ˜¯æ‰“å¼€è®°äº‹æœ¬æˆ–æ‚¨å–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨ã€‚å¼€å§‹ç¼–å†™è„šæœ¬ï¼Œå¯¼å…¥å¿…è¦çš„ä¾èµ–é¡¹ã€‚

```

;Constants to be userd in an AutoIt v3 script.
#include <AutoItConstants.au3&gt

```

**ç¬¬äºŒæ­¥**

å®šä¹‰å˜é‡`$hWnd` -ä½ å°†ä¸ä¹‹äº¤äº’çš„çª—å£çš„å¥æŸ„ã€‚

```
#include <AutoItConstants.au3>
Local $hWnd

```

**ç¬¬ä¸‰æ­¥**

æˆ‘ä»¬éœ€è¦ç­‰å¾…ç³»ç»Ÿå¯¹è¯æ¡†ã€‚
ä½¿ç”¨`WinWait(WINDOW_CLASS, TITLE, TIMEOUT)`åŠŸèƒ½ã€‚ä½¿ç”¨**Au3Info.exe**å¾—åˆ°`WINDOW_CLASS`å’Œ`TITLE`(åœ¨ Autoit å®‰è£…æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°)ã€‚

[![Get Window class](../Images/abd746f2a639f6ba85d5dac4447a5eff.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--KdV-GGmH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/fbdac8k4gxum5l0w1g8x.jpg)

```
#include <AutoItConstants.au3>
Local $hWnd

;Wait 15sec for file dialog (Class #32770) with title 'Open'
$hWnd = WinWait("[CLASS:#32770]","Open",15)

```

**ç¬¬å››æ­¥**

æˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶æ¥å°†æ–‡ä»¶è·¯å¾„æ”¾åˆ°ç³»ç»Ÿçª—å£çš„æ–‡ä»¶è·¯å¾„å­—æ®µä¸­ã€‚æˆ‘ä»¬æ¥è·å–æ–‡ä»¶è·¯å¾„å­—æ®µçš„`CLASS`å’Œ`INSTANCE`ã€‚

[![File path field](../Images/f033f5b3299321ed0c171486725e034d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--1NaF9TuQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mh5plojdxazaznkhuw20.jpg)

å°†ç„¦ç‚¹è®¾ç½®åˆ°è¯¥å­—æ®µå¹¶æ”¾ç½®ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ã€‚

```
#include <AutoItConstants.au3>
Local $hWnd

;Wait 15sec for file dialog (Class #32770) with title 'Open'
$hWnd = WinWait("[CLASS:#32770]","Open",15)

;Second parameter can be empty string, because of you use class and instance to define the element
;More information about Autoit functions see here 
https://www.autoitscript.com/autoit3/docs/functions/

ControlFocus($hWnd, "", "[CLASS:Edit; INSTANCE:1]")
ControlSetText($hWnd, "", "[CLASS:Edit; INSTANCE:1]", $CmdLine[1])

```

`$CmdLine[1]` -è¯¥å‚æ•°å°†ä½œä¸ºæˆ‘ä»¬è¦ä¸Šä¼ åˆ°ç½‘ç«™çš„æ–‡ä»¶çš„è·¯å¾„ä¼ é€’ç»™å‡½æ•°ã€‚
æ‚¨å¯ä»¥é€šè¿‡ç»å¯¹æ–‡ä»¶è·¯å¾„(ä¾‹å¦‚" c:\ upload _ me . txt ")ï¼›

**ç¬¬äº”æ­¥**

ç‚¹å‡»æŒ‰**æ‰“å¼€**æŒ‰é’®ã€‚
å…ˆæ‹¿åˆ°**çš„`CLASS`å’Œ`INSTANCE`æ‰“å¼€**æŒ‰é’®ã€‚

[![Open button](../Images/7bd437123bccaf813104ec41bf2b86e1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--uvLh7Ecd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5487yag3nteqr7mbkslx.jpg)

å½“æˆ‘ä»¬çŸ¥é“**çš„`CLASS`å’Œ`INSTANCE`æ‰“å¼€**æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å°±å‡†å¤‡ç‚¹å‡»å®ƒã€‚

æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å•å‡»å…ƒç´ ã€‚

*æ–¹å¼ 1ã€‚*

å°±ç”¨`ControlClick()`çš„æ–¹æ³•ã€‚

```
ControlClick($hWnd, "", "[CLASS:Button; INSTANCE:1])

```

æˆ‘çš„ç»éªŒè¡¨æ˜`ControlClick()`å·¥ä½œä¸ç¨³å®šã€‚æœ‰æ—¶ä¸€ä¸ªæŒ‰é’®ç”±äºæœªçŸ¥çš„åŸå› æ²¡æœ‰è¢«ç‚¹å‡»ã€‚

æˆ‘å·²ç»é€šè¿‡ä½¿ç”¨é¼ æ ‡ç§»åŠ¨å’Œé¼ æ ‡ç‚¹å‡»ç­‰é¼ æ ‡åŠ¨ä½œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚è®©æˆ‘ä»¬ç¼–ç¨‹å§ã€‚

*æ–¹å¼äºŒã€‚*

æè¿°ç”¨äºå­˜å‚¨**æ‰“å¼€**æŒ‰é’®ä½ç½®çš„ *x* ã€ *y* åæ ‡å’Œå¤§å°ä¸º 2 çš„æ•°ç»„çš„å˜é‡ã€‚

```
Local $pos[2]
Local $x
Local $y

```

å¾—åˆ°**æ‰“å¼€**æŒ‰é’®çš„ä½ç½®ã€‚

```
;ControlGetPosition returs x and y coordinates of high left corner of the button.
$pos = ControlGetPos($hWnd, "", "[CLASS:Button; INSTANCE:1]")

```

è®¾ç½®åæ ‡åœ¨é¼ æ ‡åŠŸèƒ½ä¸­çš„ä½¿ç”¨æ–¹å¼ï¼Œç»å¯¹åæ ‡æˆ–ç›¸å¯¹äºå½“å‰æ´»åŠ¨çª—å£çš„åæ ‡

```
;2 = relative coords to the client area of the active window
AutoItSetOption("MouseCoordMode", 2)

```

å®šä¹‰`$x`å’Œ`$y`å˜é‡ã€‚ä¸ºäº†é˜²æ­¢ä¸€äº›éšæœºæ•…éšœï¼Œå°†é¼ æ ‡ä»å·¦ä¸Šè§’ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæŒ‰é’®ç©ºé—´ï¼Œåœ¨`$x`å’Œ`$y`ä¸Šå¢åŠ  10pxã€‚éšæ„æ‘†å¼„åæ ‡å€¼ï¼

```
$x=$pos[0] + 10
$y=$pos[1] + 10

```

æœ€åæ‰§è¡Œé¼ æ ‡å·¦é”®ç‚¹å‡»åŠ¨ä½œã€‚

```
MouseClick($MOUSE_CLICK_LEFT, $x, $y, 1);

```

ä¸é”™ï¼æ‚¨å·²ç»å®Œæˆäº†è„šæœ¬ç¼–å†™ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æ•´ä¸ªå‰§æœ¬ã€‚

```
#include 

Local $hWnd
Local $pos[2]
Local $x
Local $y

$hWnd = WinWait("[CLASS:#32770]","Open",15)

ControlFocus($hWnd, "", "[CLASS:Edit; INSTANCE:1]")
ControlSetText($hWnd, "", "[CLASS:Edit; INSTANCE:1]", $CmdLine[1])

AutoItSetOption("MouseCoordMode", 2)
$pos = ControlGetPos($hWnd, "", "[CLASS:Button; INSTANCE:1]")
$x=$pos[0]+10
$y=$pos[1]+10

MouseClick($MOUSE_CLICK_LEFT, $x, $y, 1);

```

ç”¨ **.au3** æ‰©å±•åä¿å­˜è„šæœ¬ã€‚

# [](#3-compile-autoit-script)3ã€‚ç¼–è¯‘ Autoit è„šæœ¬

è¦åœ¨è‡ªåŠ¨åŒ– E2E æµ‹è¯•ä¸­ä½¿ç”¨è„šæœ¬ï¼Œæ‚¨éœ€è¦å°†è„šæœ¬ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶:

1.  è¿è¡Œ**Autoit2Exe.exe**appã€‚
2.  å¯¼å…¥ä¿å­˜çš„è„šæœ¬ï¼Œç‚¹å‡»æŒ‰**è½¬æ¢**æŒ‰é’®ã€‚

[![Convert to exe](../Images/57c60bc2be40087889f0d26a7de7d565.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--sIlo4JAc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9sradm0m0u9npbw5an4z.PNG)

å¾ˆå¥½ï¼Œç°åœ¨ä½ æœ‰äº†å¯ä»¥åœ¨ E2E æµ‹è¯•ä¸­ä½¿ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

# [](#4-test-compiled-autoit-script)4ã€‚æµ‹è¯•ç¼–è¯‘çš„ Autoit è„šæœ¬

åœ¨ E2E æµ‹è¯•ä¸­ä½¿ç”¨ç¼–è¯‘è¿‡çš„è„šæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥ç¡®ä¿å®ƒèƒ½æ­£å¸¸å·¥ä½œã€‚

è¦æµ‹è¯•å®ƒï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ­¥éª¤:

*1ã€‚è§¦å‘ä¸Šä¼ æ–‡ä»¶å¯¹è¯æ¡†ã€‚*

*2ã€‚ä½¿ç”¨æ–‡ä»¶è·¯å¾„å‚æ•°è¿è¡Œç¼–è¯‘åçš„è„šæœ¬ã€‚*

[![File uploading](../Images/1d346f35c042a3f7684d1ae0da89fcee.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--1oXQ3UVD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/i92ki3r4k9monr54cy7m.gif)

å¦‚æœä½ æ²¡æœ‰åœ¨è„šæœ¬ç¼–å†™è¿‡ç¨‹ä¸­å‡ºé”™ï¼Œæ–‡ä»¶åº”è¯¥è¢«ä¸Šä¼ ã€‚

# [](#5-use-the-script-in-e2e-tests)5ã€‚åœ¨ E2E æµ‹è¯•ä¸­ä½¿ç”¨è¯¥è„šæœ¬ã€‚

ä½ å¯ä»¥éå¸¸å®¹æ˜“åœ°åœ¨ E2E æµ‹è¯•ä¸­ä½¿ç”¨ç¼–è¯‘å¥½çš„è„šæœ¬ã€‚

ä¸‹é¢ä½ å¯ä»¥çœ‹åˆ°é‡è§’å™¨æµ‹è¯•çš„ä¾‹å­ã€‚

*é¡µé¢å¯¹è±¡ç¤ºä¾‹*

```
import { by, element, $ } from 'protractor';
import * as cp from 'child_process';

export class FileUploadingPage {
  uploadButton = $('.mat-raised-button');
  addFilesButton = element(by.xpath('//button[contains(@class, "add-files-btn")]'));

  uploadFile(filePath) {
    console.log('File path: ', filePath);
    //UploadFile.exe - compiled Autoit script
    cp.execSync('uploadFile.exe' + '  ' + filePath);
    return Promise.resolve();
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*E2E æµ‹è¯•ç¤ºä¾‹*T2ã€‘

```
import { FileUploadingPage } from './file-uploading-page';
import { browser, ExpectedConditions, element, by } from 'protractor';
import { win32 } from 'path';

const path = win32;
const EC = ExpectedConditions;
const TIMEOUT = 30000;

let fileUploadingPage: FileUploadingPage;
fileUploadingPage = new FileUploadingPage();

describe('File uploading, () => {
  before((done) =>
    browser.get(browser.baseUrl)
      .then(() => done())
      .catch(done)
  );

  it('Upload file', (done) => {
    browser.wait(EC.visibilityOf(fileUploadingPage.uploadButton), TIMEOUT)
      .then(() => fileUploadingPage.uploadButton.click())
      .then(() => browser.wait(EC.visibilityOf(fileUploadingPage.addFilesButton), TIMEOUT))
      .then(() => fileUploadingPage.addFilesButton.click())
      .then(() => {
        const filePath = path.resolve(__dirname + '/test_file.txt');
        return fileUploadingPage.uploadFile(filePath);
      })
      .then(() => done())
      .catch(done);
  });
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#conclusion)ç»“è®º

ä»æœ¬æ–‡ä¸­ï¼Œæ‚¨äº†è§£åˆ°:

1.  ä»€ä¹ˆæ˜¯ Autoit ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒã€‚
2.  å¦‚ä½•è‡ªåŠ¨åŒ–ä¸ Windows ç³»ç»Ÿå¯¹è¯æ¡†çš„äº¤äº’ï¼Ÿ
3.  å¦‚ä½•åœ¨ E2E æµ‹è¯•ä¸­ä½¿ç”¨ç¼–è¯‘å¥½çš„ Autoit è„šæœ¬ï¼Ÿ

æ„Ÿè°¢å¹¶äº«å—è‡ªåŠ¨åŒ–ï¼ğŸŒˆğŸŒˆğŸŒˆä¸è¦å¿˜è®°è½»ç‚¹ğŸ’—