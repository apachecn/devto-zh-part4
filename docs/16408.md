# è¿æ¥ Laravel Debugbar é¡¶ç‚¹ä»¥è°ƒè¯• Rest API Routes

> åŸæ–‡:[https://dev . to/uatthaphon/laravel-debug bar-rest-API-routes-HCA](https://dev.to/uatthaphon/laravel-debugbar-rest-api-routes-hca)

# [t1ã¡é—®é¢˜](#%E0%B8%9B%E0%B8%B1%E0%B8%8D%E0%B8%AB%E0%B8%B2)

æœ¬æ–‡ä»å®é™…ç»éªŒå‡ºå‘ï¼Œæˆ‘æ‰€åšçš„é¡¹ç›®åœ¨å“åº”é€Ÿåº¦æ–¹é¢å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå› ä¸ºæœ‰äº›ç«¯ç‚¹éœ€è¦è¶…è¿‡ 10s çš„å“åº”æ—¶é—´ã€‚

æˆ‘æƒ³ï¼Œå¦‚æœæˆ‘ä»¬ä¸ç»§ç»­åšè¿™ä¸ªé¡¹ç›®ï¼Œå‡è®¾ä¸‹ä¸€ä¸ªæ¥æŠ“è¿™ä¸ªé¡¹ç›®çš„äººä¸ä»…æœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œè€Œä¸”ä»–è¿˜ä¼šæµªè´¹å¾ˆå¤šæ—¶é—´å’Œä½ åœ¨ä¸€èµ·ã€‚

æ‰€ä»¥æˆ‘å®‰è£…äº† Debugbar è½¯ä»¶åŒ…ä»¥é˜²å®ƒè¢«è°ƒè¯•ï¼Œä½†åšæŒè®¤ä¸º debugbar æ— æ³•åœ¨ route API ä¸­æ˜¾ç¤ºç»“æœã€‚

## [](#framework-amp-packages)æ¡†æ¶&åŒ…âš™ï¸

*   [Laravel 5.4](https://github.com/laravel/laravel/tree/5.4)
*   [ä¸å¯è°ƒè¯•çš„ 2.4](https://github.com/barryvdh/laravel-debugbar/tree/2.4)
*   [é‡ç‹— Api](https://github.com/dingo/api)

```
# install laravel 5.4
composer create-project --prefer-dist laravel/laravel yourProjectName "5.4.*"
# install debugbar 2.4 that compatible with laravel 5.4
composer require barryvdh/laravel-debugbar:~2.4
# install dingo/api
composer require dingo/api 
```

æˆ‘ä¸æ˜¯åœ¨æ¯ä¸€æ­¥éƒ½æ˜¾ç¤º install æ–¹æ³•ï¼Œæœ‹å‹å¯ä»¥ä»æä¾›çš„è¿ç»“ä¸­è¯»å– install å’Œ config æ–¹æ³•ã€‚

## [t1ã¡æ€æ ·åšË™å’¦Â§](#%E0%B8%A7%E0%B8%B4%E0%B8%98%E0%B8%B5%E0%B8%97%E0%B8%B3)

ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªé¡¹ç›®ä½¿ç”¨çš„æ˜¯ laravel v5ã€‚4ï¼Œdebugbar v2 . 4ï¼Œdebugbar v2ã€‚4 å’Œ dingo api v1 å½“æˆ‘ä»¬ä»æµè§ˆå™¨æˆ– postman æ‰§è¡Œ api route è®¿é—®æ—¶ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯**ã€debugbar æ˜¾ç¤ºã€‘ã€‚**

ä»åˆ›å»ºä¸­é—´ä»¶å¼€å§‹

```
<?php

namespace App\Http\Middleware;

use Closure;
use Dingo\Api\Http\Response;

class ProfileDingoHttpResponse
{
    /**
     * Handle an incoming request.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure  $next
     * @return mixed
     */
    public function handle($request, Closure $next)
    {
        $response = $next($request);

        if ($response instanceof Response &&
            app()->bound('debugbar') &&
            app('debugbar')->isEnabled()
        ) {
            $queries_data = $this->sqlFilter(app('debugbar')->getData());
            $response->setContent(json_decode($response->morph()->getContent(), true) + [
                '_debugbar' => [
                    'total_queries' => count($queries_data),
                    'queries' => $queries_data,
                    'time' => app('debugbar')->getData()['time'],
                    'memory' => app('debugbar')->getData()['memory'],
                ],
            ]);
        }

        return $response;
    }

    /**
     * Get only sql and each duration
     *
     * @param $debugbar_data
     * @return array
     */
    protected function sqlFilter($debugbar_data)
    {
        $result = array_get($debugbar_data, 'queries.statements');

        return array_map(function ($item) {
            return [
                'sql' => array_get($item, 'sql'),
                'duration' => array_get($item, 'duration_str'),
            ];
        }, $result);
    }
} 
```

ç„¶ååœ¨`Kernel.php`æ–‡ä»¶ä¸­æ·»åŠ æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ä¸­é—´ä»¶ t0â¾¹å®ƒä½äº`yourProjectName/app/Http/Kernel.php`ä¸­ã€‚

```
<?php

namespace App\Http;

use Illuminate\Foundation\Http\Kernel as HttpKernel;

class Kernel extends HttpKernel
{
    ...

    protected $routeMiddleware = [
        ...
        'profile-dingo-http' => \App\Http\Middleware\ProfileDingoHttpResponse::class,
    ];
} 
```

åœ¨æˆ‘ä»¬åœ¨`$routeMiddleware`ä¸­æ·»åŠ `'profile-dingo-http' => \App\Http\Middleware\ProfileDingoHttpResponse::class,`ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ·»åŠ ä¸­é—´ä»¶äº†ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Dingo apiï¼Œå®ƒå°†çœ‹åˆ°æ–¹æ³•ã€‚

```
<?php
$api = app('Dingo\Api\Routing\Router');

$api->version('v1', ['middleware' => 'profile-dingo-http'], function ($api) {
    ...
}); 
```

á¶¨éº’éºŸï¹å®Œäº†ï¼Œå…ˆç”Ÿã€‚

## [t1ã¡ç»“æœã¡åˆæ ¼](#%E0%B8%9C%E0%B8%A5%E0%B8%A5%E0%B8%B1%E0%B8%9E%E0%B8%98%E0%B9%8C)

åœ¨ä» url ä¸­è°ƒç”¨ api åï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªç»“æœï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨ä¸­é—´ä»¶`ProfileDingoHttpResponse`ä¸­åˆ›å»ºçš„ debugbar ä¸­çš„æ•°æ®ï¼Œæœ€åè¢«æŒ‚èµ·ã€‚

[![](../Images/8f563aa338704a1a65a96553bfe82e24.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--PjzvQABD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/fm5emewm63fbta3c25is.jpg)

è¿™æ˜¯åœ¨æˆ‘ä»¬æ·»åŠ ä¸­é—´ä»¶æ—¶å¾—åˆ°çš„é¢å¤–çš„æŒ‚èµ·ç»“æœï¼Œå…ˆç”Ÿï¼Œå¦‚æœä¸æ˜æ˜¾çš„è¯ï¼Œå¯ä»¥ä»ä¸‹é¢æŸ¥çœ‹ç¤ºä¾‹ï¼Œå…ˆç”Ÿã€‚

```
"_debugbar":  {  "total_queries":  1,  "queries":  [  {  "sql":  "select `id`, `name`, `description` from `product` where `id` = '2' limit 1",  "duration":  "14.01ms"  }  ],  "time":  {  "start":  1561688591.7021,  "end":  1561688591.8966,  "duration":  0.19451189041138,  "duration_str":  "194.51ms",  "measures":  [  {  "label":  "Booting",  "start":  1561688591.7021,  "relative_start":  0,  "end":  1561688591.786,  "relative_end":  1561688591.786,  "duration":  0.083874940872192,  "duration_str":  "83.87ms",  "params":  [],  "collector":  null  },  {  "label":  "Application",  "start":  1561688591.7738,  "relative_start":  0.071721792221069,  "end":  1561688591.8966,  "relative_end":  0.0000050067901611328,  "duration":  0.12279510498047,  "duration_str":  "122.8ms",  "params":  [],  "collector":  null  }  ]  },  "memory":  {  "peak_usage":  19660800,  "peak_usage_str":  "18.75MB"  }  } 
```

æ­£å› ä¸ºå¦‚æ­¤ï¼Œå®ƒå¾—åˆ°äº†è¿™æ ·çš„ç»“æœï¼Œè€Œç°åœ¨ï¼Œæ— è®ºæ˜¯å¯¹æ—§çš„è¿˜æ˜¯æ–°çš„ï¼Œdebug éƒ½ä¼šå˜å¾—æ›´å®¹æ˜“ï¼Œè¿™å¯ä»¥è®©æˆ‘ä»¬æ‰¾åˆ°äº‹æƒ…çš„åŸå› ã€‚

#### [](#source-amp-so-much-thanks)æ¥æº&éå¸¸æ„Ÿè°¢â¤ï¸ğŸ‰ğŸ¥°

[REST API å‰–æ#252](https://github.com/barryvdh/laravel-debugbar/issues/252)