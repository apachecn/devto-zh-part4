# ä½¿ç”¨è¿‡æ»¤å™¨åˆ é™¤ docker å›¾åƒèŒƒå›´

> åŸæ–‡:[https://dev . to/tiemen/deleting-ranges-of-docker-images-using-filters-ljm](https://dev.to/tiemen/deleting-ranges-of-docker-images-using-filters-ljm)

# [](#purging-ranges-of-stale-docker-images-using-filters)ä½¿ç”¨è¿‡æ»¤å™¨æ¸…é™¤é™ˆæ—§çš„ Docker å›¾åƒèŒƒå›´

å¦‚æœ`docker images`çš„è¾“å‡ºè·¨è¶Šå¤ªå¤šè¡Œï¼Œä½ æƒ³æ•´ç†ä¸€ä¸‹ï¼Œä½†æ˜¯ä½ è§‰å¾— [`docker system prune`](https://docs.docker.com/engine/reference/commandline/system_prune/) å°±åƒç”¨ C4 å¼€é‡‘æªé±¼ç½å¤´ï¼Œè¯´ä¸å®šæ‹¿`docker images`çš„`-f`æ——å…œä¸€åœˆï¼

`docker images -f`åˆ©ç”¨[æ»¤é•œé€‰é¡¹](https://docs.docker.com/engine/reference/commandliimg/#filtering)ï¼Œå®ƒå¯ä»¥è®©ä½ æŒ‡å®šä¸€äº›é¢å¤–çš„æœç´¢é€‰é¡¹æ¥å‡†ç¡®é€‰æ‹©ä½ æ„Ÿå…´è¶£çš„å›¾åƒï¼

# [](#filter-options)è¿‡æ»¤é€‰é¡¹

ç›®å‰ï¼ŒDocker æ”¯æŒä¸€ç³»åˆ—è¿‡æ»¤å™¨é€‰é¡¹ï¼Œä½†åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åªå…³æ³¨`before`å’Œ`since`è¿‡æ»¤å™¨â€”â€”è¦å…¨é¢äº†è§£å¯ç”¨çš„è¿‡æ»¤å™¨é€‰é¡¹ï¼Œè¯·è®¿é—® [Docker å…³äºè¿‡æ»¤çš„æ–‡æ¡£](https://docs.docker.com/engine/reference/commandliimg/#filtering)

**-f è‡ª= {å›¾åƒ id}**
è¿‡æ»¤å™¨é€‰é¡¹è‡ªå–ä¸€ä¸ªå›¾åƒ id å¹¶é€‰æ‹©æ‰€æœ‰æ¯”ç»™å®šå›¾åƒæ›´æ–°çš„å›¾åƒã€‚

**-f before={image id}**
å¾ˆåƒè‡ªï¼Œè¿™ä¸ªæ ‡ç­¾é€‰æ‹©æ‰€æœ‰æ¯”ç»™å®šå›¾åƒ id æ—§çš„å›¾åƒã€‚

è¦é€‰æ‹©ä¸€ç³»åˆ— Docker å›¾åƒï¼Œåªéœ€å°†å®ƒä»¬ç²˜åœ¨ä¸€èµ·å³å¯ï¼

# [](#example)ä¸¾ä¾‹

è¯´å¤Ÿäº†ï¼›ç»™æˆ‘çœ‹çœ‹é’±ï¼æ‰€ä»¥â€”â€”æƒ³è±¡ä¸€ä¸‹`docker images`çš„è¾“å‡ºå¦‚ä¸‹:

```
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hippo-fe            latest              ec8ec381807d        55 minutes ago      455MB
hippo-backend_api   latest              88a08f954c9f        4 days ago          47.4MB
<none>              <none>              66ee4e399b4a        4 days ago          423MB
<none>              <none>              098006369e17        4 days ago          449MB
<none>              <none>              7010975558a2        4 days ago          449MB
<none>              <none>              75ecd4cee8ef        4 days ago          47.4MB
<none>              <none>              d3942b2482a2        4 days ago          449MB
<none>              <none>              88676747d621        4 days ago          449MB
<none>              <none>              eb522755627b        4 days ago          445MB
<none>              <none>              d62380cf625f        5 days ago          86.3MB
<none>              <none>              21bce955c85b        5 days ago          474MB
spacevim/spacevim   latest              a6b4bb27c4e9        2 weeks ago         1.36GB
<none>              <none>              abf507ccc201        2 weeks ago         106MB
<none>              <none>              79a409b99ca5        2 weeks ago         530MB
<none>              <none>              5fd5b5859b37        3 weeks ago         106MB
<none>              <none>              d93260d7abc3        3 weeks ago         530MB
node                10.16.3-alpine      b95baba1cfdb        3 weeks ago         76.4MB
<none>              <none>              2c62a47471d1        4 weeks ago         106MB
<none>              <none>              3de57027cc18        4 weeks ago         523MB
elixir              1.9.1-alpine        33a0cf122cf7        5 weeks ago         87.6MB
<none>              <none>              e5196ef97445        6 weeks ago         104MB
elixir              1.8.1-alpine        447a8dff23a8        5 months ago        91.1MB
alpine              3.9                 5cb3aa00f899        6 months ago        5.53MB 
```

è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„åˆ—è¡¨ï¼å‡è®¾æˆ‘ä»¬ä¸å†å¯¹å›¾åƒ id ä¸º`88a08f954c9f`æ ‡è®°ä¸º`hippo-backend_api`çš„å›¾åƒä¸‹æ–¹çš„å›¾åƒå’Œå›¾åƒ id ä¸º`a6b4bb27c4e9`çš„å›¾åƒä¸Šæ–¹çš„å›¾åƒæ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬å°†å¦‚ä½•ä½¿ç”¨ä¸Šè¿°è¿‡æ»¤å™¨å‘¢ï¼Ÿ

```
$ docker images -f before=88a08f954c9f 
```

ä¼šç»™æˆ‘ä»¬æ‰€æœ‰åœ¨ä¹‹å‰*åˆ›å»ºçš„å›¾åƒ *hippo-backend_api* ä¸€ä¸ªã€‚ä¸‹ä¸€æ­¥å°†æ˜¯é€‰æ‹©æ‰€æœ‰çš„ Docker å›¾åƒï¼Œç›´åˆ°å†å²ä¸­ç»™å®šçš„å›¾åƒ:* 

```
$ docker images -f before=88a08f954c9f -f since=a6b4bb27c4e9 
```

ç»™å‡ºç»™å®šèŒƒå›´å†…çš„æ‰€æœ‰å›¾åƒ:

```
<none>              <none>              66ee4e399b4a        4 days ago          423MB
<none>              <none>              098006369e17        4 days ago          449MB
<none>              <none>              7010975558a2        4 days ago          449MB
<none>              <none>              75ecd4cee8ef        4 days ago          47.4MB
<none>              <none>              d3942b2482a2        4 days ago          449MB
<none>              <none>              88676747d621        4 days ago          449MB
<none>              <none>              eb522755627b        4 days ago          445MB
<none>              <none>              d62380cf625f        5 days ago          86.3MB
<none>              <none>              21bce955c85b        5 days ago          474MB 
```

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬ç°åœ¨åªç»™å‡ºäº†é€‰å®šèŒƒå›´å†…çš„å›¾åƒï¼

sooâ€”â€”æˆ‘ä»¬ç°åœ¨è¦åšçš„å°±æ˜¯åœ¨`-q`æ ‡å¿—ä¸Šåšæ ‡è®°ï¼Œä»¥è·å¾—ä¸€ä¸ªå›¾åƒ ID åˆ—è¡¨ï¼Œå¹¶é€šè¿‡ç®¡é“å°†å…¶å‘é€åˆ°`xargs`,ä»¥ä¾¿åœ¨`docker rmi -f`å‘½ä»¤ä¸­ä½¿ç”¨å®ƒä»¬ä½œä¸ºå‚æ•°...

```
$ docker images -f before=a6b4bb27c4e9 -f since=88a08f954c9f -q | xargs docker rmi -f 
```

...ç§å•Šã€‚å¦‚æœæˆ‘ä»¬å†æ¬¡è¿è¡Œ docker images å‘½ä»¤ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ç»™å®šçš„èŒƒå›´å·²ç»è¢«åˆ é™¤:

```
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hippo-fe            latest              ec8ec381807d        2 hours ago         455MB
hippo-backend_api   latest              88a08f954c9f        4 days ago          47.4MB
spacevim/spacevim   latest              a6b4bb27c4e9        2 weeks ago         1.36GB
<none>              <none>              abf507ccc201        2 weeks ago         106MB
<none>              <none>              79a409b99ca5        2 weeks ago         530MB
<none>              <none>              5fd5b5859b37        3 weeks ago         106MB
<none>              <none>              d93260d7abc3        3 weeks ago         530MB
node                10.16.3-alpine      b95baba1cfdb        3 weeks ago         76.4MB
<none>              <none>              2c62a47471d1        4 weeks ago         106MB
<none>              <none>              3de57027cc18        4 weeks ago         523MB
elixir              1.9.1-alpine        33a0cf122cf7        5 weeks ago         87.6MB
<none>              <none>              e5196ef97445        6 weeks ago         104MB
elixir              1.8.1-alpine        447a8dff23a8        5 months ago        91.1MB
alpine              3.9                 5cb3aa00f899        6 months ago        5.53MB 
```

ğŸ™Œ