# å‰ç«¯å¯è§‚å¯Ÿæ€§ã€‚ç”¨ window.onerror ç›‘æ§æµè§ˆå™¨é”™è¯¯çš„å®ç”¨æŒ‡å—ğŸ’‚â€

> åŸæ–‡ï¼š<https://dev.to/omrilotan/front-end-observability-a-practical-guide-to-browser-error-monitoring-2gcm>

å‰ç«¯åº”ç”¨ç¨‹åºä»£ç æ¯”å…¶ä»–ä»»ä½•ä»£ç éƒ½è¦è¿è¡Œåœ¨æˆ‘ä»¬å‡ ä¹æ— æ³•æ§åˆ¶çš„ç¯å¢ƒä¸­ã€‚

æ¯ä¸ªæµè§ˆå™¨éƒ½æœ‰å…¶ç‹¬ç‰¹çš„å±æ€§ã€åŠŸèƒ½æ”¯æŒã€è¿æ¥çº§åˆ«ç­‰ã€‚åœ¨ç°ä»£åº”ç”¨ç¨‹åºä¸­ï¼Œç”¨æˆ·é…ç½®ä¸€åŠçš„åŠŸèƒ½ï¼ŒA/B æµ‹è¯•æ”¹å˜å…¶ä½™çš„åŠŸèƒ½ï¼Œç”¨æˆ·å®‰è£…çš„æµè§ˆå™¨æ‰©å±•å½±å“æ•°æ®ä¼ è¾“å’Œä»£ç æ‰§è¡Œã€‚æ‰€æœ‰è¿™äº›ä¸ºæµè§ˆå™¨åº”ç”¨ç¨‹åºä»£ç çš„æ‰§è¡Œåˆ›é€ äº†ä¸€ä¸ª**é«˜åº¦ä¸ç¨³å®šçš„ç¯å¢ƒ**ã€‚

ç”±äºæ‰§è¡Œè¿œç¦»æˆ‘ä»¬çš„åŸºç¡€è®¾æ–½ï¼Œå¹¶ä¸”è¿è¡Œæ—¶ç¯å¢ƒç‰¹åˆ«å˜ˆæ‚ï¼Œæˆ‘ä»¬å€¾å‘äºå¿½ç•¥æ¥è‡ªæµè§ˆå™¨çš„é”™è¯¯è§¦å‘ï¼Œå¹¶ä»æˆ‘ä»¬çš„æµè§ˆå™¨åº”ç”¨ç¨‹åºé™·å…¥ä¸€ç§å¹¸ç¦çš„å¯‚é™ã€‚

åœ¨ [Fiverr](https://medium.com/fiverr-engineering) æˆ‘ä»¬å·²ç»æ•é”åœ°æ„è¯†åˆ°æµè§ˆå™¨åº”ç”¨ç¨‹åºé”™è¯¯çš„ä¸°å¯Œæ€§ï¼Œå¹¶é€æ¸æ”¹è¿›æ”¶é›†å’Œå¤„ç†é”™è¯¯æ—¥å¿—æµç¨‹çš„æµç¨‹å’Œè´¨é‡ï¼Œç›´åˆ°æˆ‘ä»¬ä¸¥æ ¼ç›‘æ§æˆ‘ä»¬çš„æµè§ˆå™¨åº”ç”¨ç¨‹åºã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘å­¦åˆ°äº†å¯èƒ½å¯¹ä»–äººæœ‰ç›Šçš„ç»éªŒã€‚æˆ‘çŸ¥é“ä½ åœ¨æƒ³ä»€ä¹ˆ:â€œä½ ä¸ºä»€ä¹ˆä¸ç”¨å“¨å…µï¼Ÿâ€æˆ‘ä»¬å·²ç»ä¸è¿™ä¹ˆåšäº†ã€‚

## ğŸ‰å¥½æ¶ˆæ¯ï¼Œå„ä½ï¼

æˆ‘ä»¬çš„ web åº”ç”¨ç¨‹åºé€šå¸¸è¿è¡Œ Javascript å¹¶å…±äº«ä¸€ä¸ªåä¸º`window`çš„å…¨å±€èŒƒå›´ã€‚å½“è¿è¡Œæ—¶é”™è¯¯æ²¡æœ‰è¢«æ‚¨çš„åŠŸèƒ½æµæ•è·å’Œå¤„ç†æ—¶ï¼Œå®ƒä¼šè§¦å‘ä¸€ä¸ª`window.onerror`äº‹ä»¶(ä»¥åŠçª—å£çš„`'error'`äº‹ä»¶ç›‘å¬å™¨)ã€‚è¿™ä¸ªç•Œé¢å¯èƒ½ä¼šæä¾›ä¸€ä¸ªå¾ˆå¥½çš„æœºä¼šï¼Œè®©ä½ çš„è®¿å®¢äº†è§£ä»–ä»¬åœ¨åŠªåŠ›å·¥ä½œæ—¶é‡åˆ°çš„éšœç¢ã€‚

æˆ‘ä»¬ä¸èƒ½æµªè´¹çª—å£é”™è¯¯è°ƒç”¨çš„å¤©èµ‹ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬å…è´¹è·å¾—è¿™ä¸ªå…¨éƒ¨æ•è·äº‹ä»¶ç›‘å¬å™¨åªæ˜¯ç¬¬ä¸€æ­¥â€”â€”ç°åœ¨æˆ‘ä»¬å¿…é¡»å¯¹å®ƒåšäº›ä»€ä¹ˆã€‚

æˆ‘æ‰“ç®—å±•ç¤ºè®°å½•é”™è¯¯ã€ä¿æŠ¤åŸºç¡€è®¾æ–½ã€å‡å°‘è¯¯æŠ¥å¹¶æœ€ç»ˆåˆ›å»ºæ­£ç¡®è­¦æŠ¥æ‰€éœ€çš„ç®€å•è®¾è®¡ã€‚æˆ‘çš„è®¾è®¡ä¸“é—¨æ•æ‰**æœªæ•æ‰åˆ°çš„**é”™è¯¯ï¼›åœ¨ try/catch å—æˆ– promise catch å­å¥ä¹‹å¤–å¼•å‘çš„æ„å¤–é”™è¯¯ï¼Œç„¶åé€šè¿‡å¯é€‰çš„ä¸­ä»‹å±‚è½¬å‘åˆ°æ—¥å¿—èšåˆæœåŠ¡ã€‚

> ğŸ’â€â™‚ï¸é˜…è¯»è¿™ç¯‡æ–‡ç« æ²¡æœ‰ç‰¹åˆ«çš„é¡ºåºã€‚éšæ„è·³åˆ°ä½ æ¯”å…¶ä»–äººæ›´æ„Ÿå…´è¶£çš„è¯é¢˜ã€‚æ­¤å¤–ï¼Œæœ¬æ–‡ä¸­çš„å®ç°æ—¨åœ¨å¯å‘ï¼Œæ‚¨å¯ä»¥è‡ªè¡Œå†³å®šæ˜¯å¦åº”ç”¨ã€‚

#### æˆ‘ä»¬ç³»ç»Ÿçš„å…³é”®äººç‰©

1.  **æµè§ˆå™¨**-web åº”ç”¨ç¨‹åºæ˜¯è®¿é—®è€…å®¢æˆ·ç«¯çš„è¿è¡Œæ—¶ã€‚åœ¨å®ƒçš„å…¨å±€èŒƒå›´å†…ï¼Œæˆ‘ä»¬å°†ç¼–å†™é”™è¯¯å¤„ç†ç¨‹åºï¼Œå®ƒæ•æ‰é”™è¯¯å¹¶å°†å…¶ä½œä¸ºæ—¥å¿—è®°å½•è½¬å‘ï¼Œæœ€å¥½æ˜¯åœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸçš„æ—©æœŸï¼Œé è¿‘æ–‡æ¡£é¡¶éƒ¨çš„æŸä¸ªåœ°æ–¹ã€‚
2.  **Mediator** ( *å¯é€‰*)â€”â€”è¿™ä¸€å±‚å…è®¸æˆ‘ä»¬åœ¨å°†æ—¥å¿—è½¬å‘åˆ°æˆ‘ä»¬çš„æ—¥å¿—èšåˆå™¨ä¹‹å‰åº”ç”¨é€»è¾‘ï¼Œä¾‹å¦‚:è®¿é—®è€…éªŒè¯(ä¼šè¯ä»¤ç‰Œ)ã€è¿‡æ»¤å·²çŸ¥é—®é¢˜ã€ä¿®æ”¹æ—¥å¿—çº§åˆ«ã€ä¸°å¯Œæ—¥å¿—è®°å½•ä»¥åŠåœ¨ç«¯ç³»ç»Ÿä¸­æ”¶é›†ç»Ÿè®¡æ•°æ®ã€‚å®ƒå¯ä»¥å®ç°ä¸ºä¸€ä¸ªè¿æ¥åˆ° API ç½‘å…³çš„æ— æœåŠ¡å™¨åŠŸèƒ½æˆ–è€…ä¸€ä¸ªå¯æŒç»­çš„ HTTP API æœåŠ¡â€”â€”ä¸€åˆ‡éƒ½å¯ä»¥ã€‚
3.  **æ—¥å¿—èšåˆå™¨** -è¿™ä¸€å±‚å¯ä»¥æ˜¯ä¸€ä¸ªè‡ªæ‰˜ç®¡æ•°æ®åº“ï¼Œå¦‚ ElasticSearchï¼Œä¸Šé¢æœ‰ä¸€äº›ç³»ç»Ÿï¼Œå¯ä»¥ç®¡ç†æµå’Œè­¦æŠ¥ï¼Œå¦‚ Graylogï¼Œæˆ–æ‰˜ç®¡æ—¥å¿—è§£å†³æ–¹æ¡ˆã€‚è¿™ä¸€å±‚å°†æ˜¯å¼€å‘äººå‘˜å¼€å§‹è°ƒæŸ¥çš„ç¬¬ä¸€ä¸ªåœ°æ–¹ã€‚

| è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ç³»ç»Ÿ |
| --- |
| ![](img/6fc10a9be8ba5b967f26bd3fe6cc8b89.png) |

## ğŸ–¥æµè§ˆå™¨

### ç¡®ä¿ä½ å·²ç»è®¾ç½®äº† CORS æ ‡é¢˜

åœ¨æˆ‘ä»¬å¼€å§‹æ•æ‰å’Œå‘é€é”™è¯¯ä¹‹å‰ï¼Œè¿™ä¸ªå…ˆå†³æ¡ä»¶é€šå¸¸æ˜¯éå¸¸å¿…è¦çš„ã€‚

é™¤äº†æ‚¨çš„ web åº”ç”¨ç¨‹åº(å¯èƒ½æ˜¯æ‚¨çš„ CDN)ä¹‹å¤–ï¼Œæ‰˜ç®¡åœ¨å…¶ä»–åŸŸä¸Šçš„è„šæœ¬æ–‡ä»¶ä¸ä¼šæ˜¾ç¤ºé”™è¯¯å‘ç”Ÿçš„ä½ç½®ã€é”™è¯¯æ˜¯ä»€ä¹ˆæˆ–å…¶å †æ ˆè·Ÿè¸ªã€‚ç›¸åï¼Œæ‚¨å°†çœ‹åˆ°é”™è¯¯æ¶ˆæ¯:`Script error.`ã€‚

æ˜¾ç„¶ï¼Œè¿™æ— åŠ©äºæé«˜å¯è§åº¦ã€‚å‘è„šæœ¬æ ‡ç­¾æ·»åŠ `crossorigin`å±æ€§å°† CORS ç­–ç•¥è®¾ç½®ä¸ºâ€œåŒæºâ€ã€‚å€¼`anonymous`æ„å‘³ç€å°†ä¸ä¼šæœ‰ç”¨æˆ·å‡­è¯çš„äº¤æ¢ï¼Œé™¤éå®ƒåœ¨åŒä¸€ä¸ªæºä¸­ã€‚

```
<script src="..." crossorigin="anonymous"></script> 
```

Enter fullscreen mode Exit fullscreen mode

é•¿è¯çŸ­è¯´â€”â€”ä½ ç°åœ¨å¯ä»¥äº†è§£é”™è¯¯çš„å…¨éƒ¨ç»†èŠ‚ã€‚

> è¿™é‡Œæœ‰ä¸€ä¸ªå°å°çš„è­¦å‘Šâ€”â€”å°å¿ƒæµè§ˆå™¨ç¼“å­˜ã€‚å¦‚æœåªå°†å±æ€§æ·»åŠ åˆ°æµè§ˆå™¨ç¼“å­˜çš„ç°æœ‰è„šæœ¬æ ‡ç­¾ä¸­ï¼Œç”¨æˆ·å¯èƒ½ä¼šå¾—åˆ° CORS é”™è¯¯**ï¼Œå› ä¸ºå“åº”å·²ç»è¢«ç¼“å­˜ï¼Œæ²¡æœ‰ CORS å¤´**ã€‚è§£å†³è¿™ç§æƒ…å†µçš„æ–¹æ³•æ˜¯æ·»åŠ ä¸€ä¸ªæŸ¥è¯¢å‚æ•°ã€‚
> 
> ```
> <script src="...?cors=1" crossorigin="anonymous"></script> 
> ```

### ä¸è¦æ¬ºè´Ÿä½ çš„æˆ¿å®¢

æˆ‘ä»¬å°†ä½¿ç”¨`window.onerror`å±æ€§æ¥æ•æ‰æœªå¤„ç†çš„é”™è¯¯ã€‚æ‚¨åº”è¯¥çŸ¥é“æœ‰äººå¯èƒ½å·²ç»åœ¨æ‚¨çš„è¿è¡Œæ—¶ä¸­æ³¨å†Œäº†ä¸€ä¸ª onerror å¤„ç†ç¨‹åºã€‚

è€ƒè™‘å…±äº«å…¨å±€è¿è¡Œæ—¶çš„å…¶ä»–å ç”¨è€…ã€‚ä¾›åº”å•†èƒ½å¤Ÿç›‘æ§å’Œè§£å†³ä»–ä»¬è‡ªå·±çš„é”™è¯¯ç¬¦åˆæ¯ä¸ªäººçš„æœ€ä½³åˆ©ç›Šã€‚

å½“è¦†ç›–ç°æœ‰çš„ç›‘å¬å™¨æ—¶ï¼Œç¡®ä¿è‡ªå·±è§¦å‘å®ƒä»¬ã€‚ä½ å¯ä»¥åœ¨ä½ çš„é€»è¾‘ä¹‹å‰æˆ–ä¹‹åæ‹œè®¿ä»–ä»¬ã€‚

```
const { onerror } = window; // Existing onerror handlers

// Trust others adhere to onerror handling rules
window.onerror = (...args) => {
    let handled; // is someone else taking care this error?
    try {
        handled = onerror && onerror.apply(window, args);
    } catch (error) {

        // Catch others' onerror errors
        myOnErrorHandler(error.message, '', 0, 0, error);
    } finally {
        handled || myOnErrorHandler(...args);
    }
    return false;
}

// Or simply be first and catch everything
window.onerror = (...args) => {
    myOnErrorHandler(...args);
    onerror && onerror.apply(window, args);
    return false;
} 
```

Enter fullscreen mode Exit fullscreen mode

è¿˜ä¸è¿˜çœŸã€‚å®ƒå°†é˜»æ­¢é»˜è®¤äº‹ä»¶å¤„ç†ç¨‹åºçš„è§¦å‘ã€‚

### åˆ›é€ é™åˆ¶

ä¸€æ—¦è®¾ç½®å®Œæ¯•ï¼Œé”™è¯¯å¯èƒ½ä¼šå¼€å§‹å……æ–¥ä½ çš„ç³»ç»Ÿã€‚è€ƒè™‘å“ªäº›æ¡ä»¶æ„æˆäº†ä½ **ä¸å…³å¿ƒçš„é”™è¯¯**ï¼Œå¹¶å°½æ—©è¿‡æ»¤å®ƒä»¬ã€‚è¿™å°†æœ‰åŠ©äºä½ çš„å›¢é˜Ÿå…³æ³¨çœŸæ­£çš„é—®é¢˜ã€‚

ä¾‹å¦‚ï¼Œä¸€ä¸ªç ´æŸçš„é¡µé¢å¯èƒ½ä¼šæŠ›å‡ºå¤§é‡é”™è¯¯ï¼Œè¿™äº›é”™è¯¯éƒ½æºäºä¸€æ¬¡ç ´æŸã€‚å¾—åˆ°æ‰€æœ‰çš„é”™è¯¯å¯¹æˆ‘ä»¬æ²¡æœ‰å¤ªå¤§çš„å¥½å¤„â€”â€”æˆ‘å°†åŒä¸€é¡µé¢ä¸Šçš„é”™è¯¯æ•°é‡é™åˆ¶ä¸º 10 ä¸ªã€‚

```
const errorsHistory = [];
function abortErrorReport(message, file, line, column, error) {

    // Close the log behind a rollout mechanism to protect your infrastructure
    if (!errorLoggingEnabled) return true;

    // Limit the amount of errors from one page
    if (errorsHistory.length > 10) return true;

    // Send the same error twice from the same page can create false multiplications
    if (errorsHistory.includes(message)) return true;
    errorsHistory.push(message);

    // A page may be considered stale if it's been open for over, lets say, an hour
    if (window.performance.now() > 36e5) return true;

    // Add more rules that suit your consideration

    return false;
}

function myOnErrorHandler(...args) {
    if(abortErrorReport(...args)) {
        return;
    }

    ...
    sendError(record);
} 
```

Enter fullscreen mode Exit fullscreen mode

### å…³äºé”™è¯¯çš„è¯¦ç»†ä¿¡æ¯

window.onerror çš„æ¥å£å…¬å¼€äº†æœ‰åŠ©äºç†è§£é”™è¯¯æ˜¯ä»€ä¹ˆä»¥åŠé”™è¯¯æºè‡ªä½•å¤„çš„è¯¦ç»†ä¿¡æ¯ã€‚å¯¹äº HTTP è¯·æ±‚è´Ÿè½½ï¼Œé”™è¯¯å¯¹è±¡ä¸èƒ½åºåˆ—åŒ–ä¸º JSONï¼Œä½†æ˜¯æ‚¨åº”è¯¥æå–å®ƒçš„å †æ ˆã€‚

```
/**
 * This is the signature of the browser's built in onerror handler
 * @param  {string} message Error message
 * @param  {string} file    Source file where the script threw an error
 * @param  {number} line    Line number
 * @param  {number} column  Column number
 * @param  {Error}  error   Error object
 * @return {Boolean}        Should the default event handler fire?
 */
function myOnErrorHandler(message, file, line, column, error) {
    const record = {
        message,
        file,
        line,
        column,
        stack: error.stack,
        name: error.name,
    };

    ...
    sendError(record);
}; 
```

Enter fullscreen mode Exit fullscreen mode

### è®¸è®¸å¤šå¤šçš„ç»†èŠ‚

è¶Šå¤šè¶Šå¼€å¿ƒã€‚æ‚¨çš„å¼€å‘äººå‘˜å°†ä¸å¾—ä¸è°ƒæŸ¥é”™è¯¯æ—¥å¿—ï¼Œä»–ä»¬å¸Œæœ›è·å¾—æœ‰åŠ©äºé‡ç°é—®é¢˜çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¨æµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ï¼Œå¹¶å‡è®¾é—®é¢˜å‡ºç°çš„ç¯å¢ƒã€‚

æˆ‘ä»¬å¯ä»¥ä»æµè§ˆå™¨ API
ä¸­è·å¾—å¾ˆå¤šä¸°å¯Œçš„ä¸œè¥¿

```
record.metadata = {

    url: document.location.href,
    referrer: document.referrer,
    cookie: navigator.cookieEnabled ? document.cookie : 'disabled',
    language: navigator.language,
    connection: navigator.connection.effectiveType,
    hasFocus: document.hasFocus(),
    readyState: document.readyState,
    secondsIn: Math.round(performance.now() / 1000), // page age in seconds
    heap: Math.round(performance.memory.usedJSHeapSize / 1048576), // MB of heap used
    heapPercent: Math.round(performance.memory.usedJSHeapSize / performance.memory.jsHeapSizeLimit * 100), // Percent of heap used
};

...
sendError(record); 
```

Enter fullscreen mode Exit fullscreen mode

çœŸçš„ï¼Œå¤©ç©ºæ˜¯è¿™é‡Œçš„æé™ã€‚ä½†æ˜¯ä½ ç‹¬ç‰¹çš„ä¸šåŠ¡å¯èƒ½ä¼šæœ‰æ›´å¤šçš„äº®ç‚¹:

### æ·»åŠ ä¸€äº›ç‹¬ç‰¹çš„ç»†èŠ‚

ä¸è¦ç›¸ä¿¡æˆ‘â€”â€”çœ‹çœ‹ GitHub çš„ç½‘é¡µæºä»£ç ã€‚å…ƒå…ƒç´ å°†ä¿¡æ¯ä»æœåŠ¡å™¨ä¼ é€åˆ°å®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº:

*   è¯·æ±‚ ID(æ£€æŸ¥æ—¥å¿—ç›¸å…³æ€§çš„é€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦)ã€‚
*   ç”¨æˆ·åå’Œç”¨æˆ· ID
*   å¸¦æœ‰è¯·æ±‚æ—¥æœŸçš„æ—¶é—´æˆ³
*   å¯ç”¨åŠŸèƒ½çš„åˆ—è¡¨
*   åˆ†æä¿¡æ¯

```
<meta name="correlation-id" content="123e4567-e89b-12d3-a456-426655440000">
<meta name="user-logged-in" content="true"> 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘å–œæ¬¢è¿™ç§æ–¹æ³•ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨ä¸Šå‘ˆç°çš„å…¨å±€ä½œç”¨åŸŸå˜é‡æˆ–æ‚¨èƒ½æƒ³åˆ°çš„ä»»ä½•å…¶ä»–æ–¹å¼æ¥ä¼ é€’ä¿¡æ¯ã€‚

é‡è¦çš„æ˜¯å°†è¿™äº›ç»†èŠ‚é™„åŠ åˆ°é”™è¯¯æ—¥å¿—ä¸­ã€‚è¿™å°†è¯æ˜éå¸¸æœ‰åŠ©äºè°ƒæŸ¥é‡å¤å‡ºç°çš„é”™è¯¯çš„å…±åŒç‚¹æˆ–æ¨¡å¼ã€‚

åœ¨æ‚¨å®ç°æ—¥å¿—å…³è”æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œå…³è” ID åœ¨ä¸æœåŠ¡å™¨æ—¥å¿—å…³è”æ—¶å°†è¢«è¯æ˜ç‰¹åˆ«æœ‰ç”¨ã€‚

### è‡ªå®šä¹‰è¯¯å·®å­—æ®µ

æƒ³æƒ³ä½ çš„é”™è¯¯ç°åœ¨å·²ç»è¢«å®Œç¾åœ°æ”¶é›†å’Œä¸°å¯Œäº†ã€‚æ‚¨çš„å¼€å‘äººå‘˜ç°åœ¨æ›´å–œæ¬¢ç®€å•åœ°æŠ›å‡ºé”™è¯¯ï¼Œè€Œä¸æ˜¯ä¸»åŠ¨å°†å®ƒä»¬å‘é€ç»™è®°å½•å™¨ã€‚å…è®¸æ‚¨çš„å¼€å‘äººå‘˜å‘æŠ›å‡ºçš„é”™è¯¯æ·»åŠ è¯¦ç»†ä¿¡æ¯ã€‚

```
async function userRefreshInbox({ username }) {
    try {
        const response = await getNewInboxItems();
        // Do the thing you are supposed to do
    } catch (error) {
        error.code = 'SOME_ELABORATE_FLOW';
        error.details = {
            username,
            flow: 'User refresh inbox',
        };
        setTimeout(() => { throw error; }); // Delayed so there should be no runtime breakage

        // Explain nicely to your user that an error has occurred
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

ç„¶åä½ åœ¨å®šåˆ¶å­—æ®µä¸Šæ”¶é›†ï¼Œå°±åƒä½ æ”¶é›†å †æ ˆè·Ÿè¸ª

```
const { code, details } = error;

Object.assign(record, { code, details });
...
sendError(record); 
```

Enter fullscreen mode Exit fullscreen mode

### å£°æ˜æ—¥å¿—æµ/å­ç³»ç»Ÿ

æˆ‘çš„å¼€å‘äººå‘˜å¯ä»¥åœ¨é¡µé¢ä¸Šæ·»åŠ ä¸€ä¸ª meta æ ‡ç­¾ï¼Œè¿™æ ·æˆ‘çš„ä¸­ä»‹å°±çŸ¥é“å°†æ—¥å¿—è½¬ç§»åˆ°å“ªé‡Œã€‚è¿™å°†å…è®¸å›¢é˜Ÿå¯¹ä»–ä»¬çš„é”™è¯¯æ‰¿æ‹…å…¨éƒ¨è´£ä»»ã€‚

```
<meta name="log-subsystem" content="user-page"> 
```

Enter fullscreen mode Exit fullscreen mode

## è°ƒè§£å‘˜

ä¸­ä»‹æ˜¯ä¸€ä¸ªå¯é€‰å±‚ï¼Œä½†æ˜¯æˆ‘çš„ä¸­ä»‹æœåŠ¡å·²ç»è¯æ˜éå¸¸æœ‰ç”¨â€”â€”æˆ‘ç”¨å®ƒæ¥ä¸°å¯Œæ—¥å¿—è®°å½•ï¼Œå†³å®šè®°å½•çš„ä¸¥é‡æ€§ï¼Œç”¨ç‰¹æ®Šçš„é”™è¯¯ä»£ç æè¿°æŸäº›é”™è¯¯ï¼Œå¹¶å°†è®°å½•å¼•ç”¨åˆ°ç›¸å…³çš„æµã€‚

ä¸­ä»‹å¯ä»¥æ˜¯ç®€å•çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤æ‚çš„ï¼Œå¹¶ä¸”å¯ä»¥ä½œä¸ºä¸€ä¸ªè½¬ç§»æµé‡çš„ lambda å‡½æ•°è¿è¡Œâ€”â€”æˆ–è€…æ˜¯ä¸€ä¸ªå¯æŒç»­çš„æœåŠ¡ã€‚å®¢æˆ·ç«¯ä¸åº”è¯¥ç­‰å¾…æ¥è‡ªè¯¥æœåŠ¡çš„å“åº”ï¼Œä¹Ÿä¸åº”è¯¥åƒæ•°æ®æ£€ç´¢ç³»ç»Ÿä¸€æ ·å·¥ä½œâ€”â€”è€Œæ˜¯ç®€å•åœ°å°†æ¶ˆæ¯ä¸­ç»§åˆ°æ­£ç¡®çš„ç«¯ç‚¹ã€‚

ä¼˜é€‰åœ°ï¼Œå®ƒå¯ä»¥æ·»åŠ éªŒè¯å±‚ï¼Œå¹¶ä½œä¸ºç¼“å†²å™¨æ¥ä¿æŠ¤æ—¥å¿—ç³»ç»Ÿå…å—é”™è¯¯å’Œæº¢å‡ºæƒ…å†µçš„å½±å“ã€‚

### æ›´åŠ å……å®

æˆ‘çš„æœåŠ¡å™¨å¯ä»¥æ·»åŠ ä¸€äº›å®¢æˆ·ç«¯ä¸ä¸€å®šçŸ¥é“çš„ç»†èŠ‚ï¼Œæˆ–è€…ç®€å•åœ°çœå»æµè§ˆå™¨çš„è®¡ç®—ã€‚

1.  è¯†åˆ«å·²çŸ¥çš„çˆ¬è™«
2.  æ·»åŠ  IPã€å›½å®¶ã€ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ã€‚

```
const { headers } = request;

const request_metadata = {
    user_agent: headers['user-agent'],
    ip: headers['true-client-ip'], // provided by DNS service
    country: headers['cf-ipcountry'], // Cloudflare provides GeoIP for free!
    is_known_crawler: isbot(headers['user-agent']),
    referrer: headers.referer,
}; 
```

Enter fullscreen mode Exit fullscreen mode

### è½¬ç§»â€œå·²çŸ¥â€é—®é¢˜

å¤§å¤šæ•°éšå«éšåˆ°çš„å¼€å‘äººå‘˜éƒ½æ‚£æœ‰ä¸€ç§æˆ‘ç°åœ¨æ­£åœ¨åˆ›é€ çš„å«åšâ€œ*æ—¥å¿—ç–²åŠ³*â€çš„ç–¾ç—…ã€‚æˆ‘ä¼šæŠ“ä½ä»»ä½•â€œå‡å°‘å™ªéŸ³â€çš„æœºä¼šâ€”â€”è½¬ç§»æˆ‘ä¸ä¸€å®šæœŸæœ›æˆ‘çš„å¼€å‘äººå‘˜åƒå¤„ç†æ™®é€šåº”ç”¨ç¨‹åºé”™è¯¯é‚£æ ·å®šæœŸå’Œç´§æ€¥è§£å†³çš„é—®é¢˜ã€‚è¿™äº›æ—¥å¿—æœ‰è‡ªå·±çš„é˜ˆå€¼ã€‚æˆ‘è¿˜å°†æ—¥å¿—çº§åˆ«ä»â€œé”™è¯¯â€é™ä½åˆ°â€œè­¦å‘Šâ€ã€‚ä»¥ä¸‹æ˜¯å…¶ä¸­çš„ä¸€äº›:

*   CORS errors ( `Script error.` )
*   æ¥è‡ª(å·²è¯†åˆ«çš„)æœºå™¨äººçš„é”™è¯¯
*   æµè§ˆå™¨æ‰©å±•å¼•å‘çš„é”™è¯¯(æºæ–‡ä»¶åœ¨åè®®`moz-extension://`ã€`chrome-extension://`ä¸­)
*   ç¼ºå°‘å…¨å±€ä¾èµ–é¡¹(`React is not defined`)
*   åœ¨å…¶å †æ ˆè·Ÿè¸ªä¸­åªæœ‰å¤–éƒ¨æºçš„è„šæœ¬(ä¹Ÿå°†åœ¨ä¸‹ä¸€éƒ¨åˆ†è®¨è®º)
*   ç”±äºæŸç§åŸå› ç¼ºå°‘åŸºæœ¬èšåˆå¡«å……(`Uncaught ReferenceError: Set is not defined`)
*   ç½‘ç»œé—®é¢˜å¯¼è‡´çš„è¯­æ³•é”™è¯¯(`SyntaxError: Unexpected end of input`)
*   æ‚¨æƒ³è¦çš„ä»»ä½•å…¶ä»–é”™è¯¯(æ¯”å¦‚ Safari ä¸­ç§æœ‰ä¼šè¯ä¸Šçš„ localStorage è®¿é—®)

è¿™å¹¶ä¸æ˜¯è¯´æˆ‘ä»¬ä¸åœ¨è¿™äº›æ—¥å¿—ä¸Šè®¾ç½®è­¦æŠ¥â€”â€”å®ƒä»¬åªæ˜¯åœ¨æ•æ„Ÿåº¦å’Œç´§æ€¥ç¨‹åº¦ä¸Šæœ‰æ‰€ä¸åŒã€‚

ä»æ‚¨çš„æ—¥å¿—ä¸­æ‰¾å‡ºå“ªäº›é”™è¯¯æ˜¯æ‚¨è®¤ä¸ºå¯ä»¥æ¥å—çš„ï¼Œå¹¶è®©å¼€å‘äººå‘˜å¯ä»¥å¾ˆå®¹æ˜“åœ°æå‡ºç¼–è¾‘å’Œæ·»åŠ çš„å»ºè®®ã€‚ä¸¥æ ¼è®°å½•è¿™ä¸€è¿‡ç¨‹ã€‚

æ‰€æœ‰æ—¥å¿—éƒ½ç”±ä¸­ä»‹æ ¹æ®è¿™äº›æ¡ä»¶è¿›è¡Œæµ‹è¯•(ä»æœ€å¸¸è§åˆ°æœ€ä¸å¸¸è§)ï¼Œå¹¶æ ¹æ®é¢„å…ˆå£°æ˜çš„é”™è¯¯ä»£ç (`SCRIPT_ERROR`ã€`MISSING_DEPENDENCY`ã€`MISSING_POLYFILL`ç­‰)é‡å®šå‘åˆ°å„è‡ªçš„æµ(å¦‚ç¬¬ä¸‰æ–¹æä¾›å•†)æˆ–å¦ä¸€ä¸ªå¸¦æœ‰è­¦æŠ¥çš„æ‰¹é‡æµã€‚).è¿™ç§åšæ³•è¯æ˜æ˜¯æœ‰æ•ˆçš„ã€‚

### ä¸ºæä¾›å•†åˆ›å»ºå•ç‹¬çš„æµ

å½“å¼•å‘é”™è¯¯çš„æ–‡ä»¶æ˜¯ç”±ç¬¬ä¸‰æ–¹ä¾›åº”å•†æä¾›æ—¶ï¼Œæˆ‘é€‰æ‹©å°†æ—¥å¿—è½¬ç§»åˆ°ä¸“é—¨çš„æµ:

```
const providers = [
    ['googletagmanager.com', 'googletagmanager'],
    ['linkedin.com', 'linkedin'],
    ['d2c7xlmseob604.cloudfront.net', 'smartling'],
    ['d2fltix0v2e0sb.cloudfront.net', 'dev.to'],
];

/**
 * Get the name of the script provider where applicable
 * @param  {string} url
 * @return {string|undefined}
 */
function thirdPartyProvider(url) {
    const { hostname } = new URL(url);

    return (
        providers.find(
            ([domain]) => hostname.endsWith(domain)
        ) || []
    )[1];
} 
```

Enter fullscreen mode Exit fullscreen mode

æ‰€æœ‰æœªè¯†åˆ«çš„ç¬¬ä¸‰æ–¹é”™è¯¯éƒ½å¯ä»¥è·å¾—è‡ªå·±çš„ç»„æµï¼Œä½†è¿™ç§åšæ³•ä½¿æˆ‘ä»¬èƒ½å¤Ÿå®æ–½å®½å®¹æ”¿ç­–ï¼Œå¹¶åœ¨ç¬¬ä¸‰æ–¹è„šæœ¬å¼•å…¥å…³é”®é—®é¢˜æ—¶å³æ—¶ç¦ç”¨å®ƒä»¬ã€‚

## ğŸ—„æ—¥å¿—èšåˆå™¨

æˆ‘ä»¬å°†è¿™äº›ä¿¡æ¯å‘é€åˆ°æˆ‘ä»¬çš„æ—¥å¿—ç³»ç»Ÿï¼Œå¸Œæœ›æˆ‘ä»¬èƒ½å¤Ÿç†è§£æ‰€æœ‰è¿™äº›ä¿¡æ¯ã€‚ç°åœ¨æ˜¯æ—¶å€™ç ”ç©¶ä¸€ä¸‹ï¼Œåˆ†æ¸…è½»é‡ç¼“æ€¥äº†ã€‚

å¦‚æœä¸€å¼€å§‹æ•°é‡å’Œç§ç±»ä»¤äººç”Ÿç•ï¼Œä¹Ÿä¸è¦æ°”é¦ã€‚æˆ‘ä»¬è®¾ç½®äº†åˆ†æµæœºåˆ¶ï¼Œé™ä½å™ªéŸ³ã€‚ä¸è¦çŠ¹è±«ï¼Œæ·»åŠ æ›´å¤šçš„è§„åˆ™ï¼Œä»ä¸»æµä¸­æ’é™¤é¡¹ç›®ï¼Œä½¿å…¶æ›´åŠ å¹³æ˜“è¿‘äººã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä»è¿™ä¸ªæµä¸­å¾—åˆ°ä¸€ä¸ªä¸»åŠ¨çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶æŠŠå®ƒé™ä¸‹æ¥â€”â€”ç”šè‡³é€šè¿‡æ’é™¤åéªŒæ€§è¾ƒä½çš„æ¶ˆæ¯ã€‚

### åˆ›å»ºé¢„è­¦

æœ€ç»ˆï¼Œä½ å·²ç»è®©ä½ çš„ç³»ç»Ÿè¿è¡Œäº†ä¸€æ®µæ—¶é—´ï¼Œä½ åº”è¯¥åœæ­¢æŸ¥çœ‹æ—¥å¿—ï¼Œå¼€å§‹å¼•å…¥æ›´å¤šçš„~ bugs ~ç‰¹æ€§ã€‚ç°åœ¨æ˜¯æ—¶å€™ä¸ºé”™è¯¯æ—¥å¿—æ•°é‡è®¾ç½®ä¸€ä¸ªä¸Šé™äº†ã€‚å½“ç°çŠ¶å—åˆ°æŒ‘æˆ˜æ—¶ï¼Œç³»ç»Ÿä¼šæé†’ä½ ã€‚è­¦æŠ¥æ˜¯éå¸¸é‡è¦çš„ï¼Œå½“å®ƒä»¬æ¶åŒ–æ—¶ï¼Œå®ƒä»¬å°†æˆ‘ä»¬å¸¦å›ç³»ç»Ÿï¼Œæˆ–è€…å½“ä½ çŠ¯äº†ä¸€ä¸ªå¯æ€•çš„é”™è¯¯æ—¶(åœ¨å®¢æˆ·æ”¯æŒå¼€å§‹æ‰“ç”µè¯ç»™ä½ ä¹‹å‰)æé†’ä½ ï¼Œæ›´é‡è¦çš„æ˜¯-å½“ä¸€åˆ‡æ­£å¸¸æ—¶ï¼Œè®©æˆ‘ä»¬è¿œç¦»ã€‚

[![](img/2f03f56a6a68e2859faa8954135d3683.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--DO4vantn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/f1rumnym0byi5d5k02ao.png)

### å¯¹æ•°å‡å°‘/å¯¹æ•°èšé›†

æˆ‘ä»¬å°†å°½å¯èƒ½å¤šçš„ç»†èŠ‚å‘é€åˆ°æ—¥å¿—ä¸­ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªç³»ç»Ÿèƒ½å¤Ÿåœ¨è­¦æŠ¥è§¦å‘æ—¶å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°æ¨¡å¼ã€‚åœ¨æ‚¨é€‰æ‹©çš„æ—¥å¿—æä¾›ç¨‹åºä¸­å¯»æ‰¾è¿™ä¸ªç‰¹æ€§ã€‚

### å¯¹é¢„è­¦çš„æè¿°è¦è¯¦ç»†

è­¦æŠ¥å¯èƒ½ä¼šä»¤äººç”Ÿç•ã€‚æˆ‘å‘ç°å¼€å‘äººå‘˜å€¾å‘äºå¿½ç•¥é‚£äº›çœ‹èµ·æ¥å¾ˆéš¾å¤„ç†æˆ–è€…éš¾ä»¥ç†è§£çš„è­¦å‘Šã€‚

æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­è®¨è®ºçš„é”™è¯¯çš„æœ¬è´¨æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›å®ƒä»¬å‡ºç°çš„(æœªå¤„ç†)â€”â€”è¿™ä½¿å¾—å®ƒä»¬æˆä¸ºå¼€å‘äººå‘˜å¿½ç•¥çš„ä¸»è¦å€™é€‰å¯¹è±¡ã€‚

è¿™ä¸æ˜¯é’ˆå¯¹æµè§ˆå™¨é”™è¯¯çš„å”¯ä¸€åšæ³•â€”â€”æˆ‘ä»¬å‘ç°æŒ‡å¯¼éšå«éšåˆ°çš„å¼€å‘äººå‘˜é‡‡å–æœ€åˆçš„å‡ ä¸ªæ­¥éª¤æ˜¯éå¸¸æœ‰ç›Šçš„ã€‚å¹¶åœ¨è­¦æŠ¥å†…å®¹æˆ–è­¦æŠ¥é¢‘é“ä¸­å‘å¸ƒä¸€äº›ä¿¡æ¯ç»´åŸºæˆ–æœ‰ç”¨ä»ªè¡¨æ¿çš„é“¾æ¥ã€‚

å¯¹äºæˆ‘ä»¬â€œå·²çŸ¥â€é—®é¢˜çš„è­¦å‘Š(è§ä¸Šæ–‡),æˆ‘ç”šè‡³æ·»åŠ äº†ä¸€ä¸ªæ®µè½æ¥è§£é‡Šè¿™ä¸ªé”™è¯¯æ„å‘³ç€ä»€ä¹ˆ

> **`Script error.`æ°´å¹³é«˜äºå…¶é¢„å®šä¹‰çš„é˜ˆå€¼:æ¯åˆ†é’Ÿ 100 ä»¥ä¸Šï¼ŒæŒç»­ 5 åˆ†é’Ÿã€‚**
> 
> æ­¤é”™è¯¯æ˜¯ç”±æ¥è‡ªä¸åŒæ¥æº(ä¸åŒçš„åŸŸã€ç«¯å£æˆ–åè®®)çš„ Javascript æ–‡ä»¶å¼•èµ·çš„ã€‚å¦‚æœæ²¡æœ‰é€‚å½“çš„è·¨åŸç‚¹å¤´ï¼Œæˆ‘ä»¬å¾—åˆ°çš„åªæ˜¯è¡Œå’Œåˆ—è®¾ç½®ä¸º 0 çš„`Script error.`ï¼Œæ²¡æœ‰æºæ–‡ä»¶å’Œé”™è¯¯å¯¹è±¡ã€‚
> 
> æœ‰å…³å¤„ç†æ­¤ç±»é”™è¯¯çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ä»ªè¡¨æ¿ä¸­çš„â€œå·²çŸ¥é”™è¯¯â€éƒ¨åˆ†ã€‚

### å¸®åŠ©ä½ çš„æ•°æ®åº“è¯†åˆ«é‡è¦æ¨¡å¼ã€‚

æˆ‘ä»¬å·²ç»ä¸ºæ¯ä¸ªæ—¥å¿—è®°å½•æ·»åŠ äº†å¾ˆå¤šç»†èŠ‚ã€‚å¦‚æœæ‚¨æƒ³ä¿æŒæ•°æ®åº“çš„å¯ç»´æŠ¤æ€§ï¼Œæ‚¨åº”è¯¥é€‰æ‹©è¦ç´¢å¼•æ—¥å¿—ä¸­çš„å“ªäº›å­—æ®µï¼Œæˆ–è€…è‡³å°‘è¦ç´¢å¼•å“ªäº›å­—æ®µ**è€Œä¸æ˜¯**ã€‚æˆ‘å»ºè®®å¯¹ç”¨äºåŒºåˆ†é”™è¯¯çš„å­—æ®µè¿›è¡Œç´¢å¼•:æ¶ˆæ¯ã€æ–‡ä»¶ã€url å’Œé”™è¯¯ä»£ç (å¦‚æœæ‚¨å·²ç»æ·»åŠ äº†ä¸€ä¸ªï¼Œè¯·å‚è§â€œå·²çŸ¥é—®é¢˜â€)ã€‚ç´¢å¼•å­—æ®µå¯ä»¥åŒºåˆ†æ‚¨å¯èƒ½å¿½ç•¥æµ‹è¯•çš„è®¿é—®è€…ç¾¤ä½“:ç”¨æˆ·ä»£ç†(æˆ–è§£æçš„æ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨åç§°å’Œç‰ˆæœ¬)ã€åœ°ç†ä½ç½®ã€æœ¬åœ°åŒ–ã€‚ä¸è¦ç´¢å¼•éå¸¸ç‹¬ç‰¹æˆ–å¤æ‚çš„å­—æ®µï¼Œå¦‚é¢åŒ…å±‘æˆ–å¤±è´¥çš„è¯·æ±‚ä½“ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸å•ç‹¬ç”¨äºå°è¯•å’Œå¤åˆ¶æµã€‚è®°ä½â€”â€”è®°å½•æ€»æ˜¯ä»¥å­—ç¬¦ä¸²çš„å½¢å¼ä¿æŒå¯æœç´¢æ€§ã€‚

## ğŸ’‚è°åœ¨çœ‹ã€Šå®ˆæœ›è€…ã€‹çš„â€ï¼Ÿ

æˆ‘ä»¬å·²ç»è®©æµè§ˆå™¨é”™è¯¯å˜å¾—å¯è§å’Œå¯æ“ä½œã€‚æœ€åï¼Œæˆ‘ä»¬è®©æ•´ä¸ªæ“ä½œåƒæ—¶é’Ÿä¸€æ ·è¿è¡Œã€‚æˆ‘ä»¬å·²ç»èƒ½å¤Ÿè§£å†³åå¤å‡ºç°çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„å„ç§è­¦æŠ¥ä¿æŒå®‰é™ã€‚

ä½†æ˜¯å½“æœªå¤„ç†çš„ onerror å¤„ç†ç¨‹åºå‡ºé”™æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸€æ¡æ²¡æœ‰é™„å¸¦æ¡ä»¶ã€‚è¿™æ˜¯æœ€åä¸€å±€ã€‚

### è­¦æƒ•

åœ¨ä»£ç åº“çš„è¿™ä¸ªç‰¹å®šåˆ†åŒºä¸­ï¼Œç¡®ä¿æ‚¨æœ‰è‰¯å¥½çš„ä»£ç æµ‹è¯•è¦†ç›–ç‡ã€‚è€ƒè™‘ä¸“é—¨ä½¿ç”¨å†å²éå¤šå¡«å……ç‰¹å¾(ä½¿ç”¨`[].indexOf(x) !== -1`ç­‰ä»£æ›¿`[].includes(x)`)ã€‚

### åœ¨é”™è¯¯å¤„ç†ç¨‹åºä¸­æ•æ‰é”™è¯¯

å°†æ•´ä¸ªæµ“ç¼©è¿‡ç¨‹åŒ…è£…åœ¨ä¸€ä¸ª try/catch å—ä¸­ï¼Œå¹¶åœ¨å‘é€ä¹‹å‰ç”¨æ–°æ•è·çš„é”™è¯¯æ›¿æ¢ï¼Œä»¥é˜²å‡ºé”™ã€‚ä¾‹å¦‚ï¼ŒLinux ä¸Šçš„ Firefox ç”šè‡³ä¸å…è®¸ CORS é”™è¯¯è¯»å–å †æ ˆ:`Exception sending window error: Permission denied to access property \"stack\"`ï¼›

### ç›‘æ§é”™è¯¯æ—¥å¿—æµ

åƒä»»ä½•çˆ¶æ¯ä¸€æ ·ï¼Œæˆ‘å¯ä»¥å‘Šè¯‰ä½ ï¼Œå¦‚æœå®‰é™äº†ä¸€æ®µæ—¶é—´ï¼Œä¸€å®šæ˜¯å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚ç›‘æ§æ‚¨çš„æµï¼Œç¡®ä¿**æ²¡æœ‰é”™è¯¯**ã€‚æˆ‘æœ€å–œæ¬¢çš„è­¦æŠ¥æ˜¯æˆ‘ä¸ºä½è¾¹ç•Œæµè®¾ç½®çš„è­¦æŠ¥ã€‚æˆ‘çš„æ‡ˆæ€ æ‰“ç”µè¯ç»™æˆ‘è¯´:

> ğŸš¨[ALERT] **æ¥è‡ªæµè§ˆå™¨çš„é”™è¯¯æ—¥å¿—ä¸è¶³**
> 
> è¿™éå¸¸å¯ç–‘ï¼Œè¿‡å» 15 åˆ†é’Ÿå‡ ä¹æ²¡æœ‰ä»»ä½•æ—¥å¿—ã€‚æ‚¨åº”è¯¥éªŒè¯ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ:
> 
> *   ğŸ–¥æµè§ˆå™¨åº”è¯¥å‘ä¸­ä»‹æœåŠ¡å‘é€æ—¥å¿—æ¶ˆæ¯
> *   â˜ï¸è°ƒè§£æœåŠ¡å·²å¯åŠ¨å¹¶è¿è¡Œ
> *   ğŸ—„è®°å½•ç³»ç»Ÿæ­£åœ¨æ¥æ”¶å’Œæ˜¾ç¤ºæ—¥å¿—
> 
> â„¹ï¸è¿›ä¸€æ­¥çš„ä¿¡æ¯å¯ä»¥åœ¨ç»´åŸºä¸­çš„æ¡ç›®â€œ*å‰ç«¯æ—¥å¿—å’Œé”™è¯¯(æµè§ˆå™¨)*ä¸‹æ‰¾åˆ°

## ğŸ¤¸â€â€è¯¾å¤–æ´»åŠ¨

æ€»æ˜¯æœ‰æ›´å¤šçš„æ–¹æ³•æ¥æé«˜çŸ¥ååº¦ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ‚¨å¯ä»¥æ·»åŠ åˆ°ç³»ç»Ÿä¸­çš„åŠŸèƒ½ï¼Œä»¥ä¸°å¯Œæ—¥å¿—è®°å½•æˆ–å‡å°‘ç³»ç»Ÿå™ªéŸ³ã€‚

### é¢åŒ…å±‘

å¾ˆå¯èƒ½ä½ çš„å¼€å‘å›¢é˜Ÿä»ç„¶ä¼šé‡åˆ°å¾ˆå¤šä»–ä»¬æ— æ³•é‡ç°çš„é”™è¯¯ã€‚ç”¨æˆ·äº¤äº’çš„ç—•è¿¹å¯ä»¥æä¾›ä¸€ä¸ªå¯å‘æ€§çš„çª—å£ï¼Œè®©æˆ‘ä»¬äº†è§£å¯¼è‡´é”™è¯¯çš„æƒ…å†µã€‚æˆ‘å»ºè®®åœ¨ä¸€ä¸ªå…¨å±€æ•°ç»„ä¸­æ”¶é›†äº¤äº’ï¼Œå¹¶åœ¨æ¯ä¸ªé”™è¯¯æ—¶å‘é€å®ƒã€‚

æ‚¨å¯ä»¥ä¸ºå¼€å‘äººå‘˜å…¬å¼€ä¸€ä¸ªæ¥å£ï¼Œä»ä»–ä»¬çš„ä»£ç ä¸­æ‰‹åŠ¨æ·»åŠ é¢åŒ…å±‘(è¿™å¯èƒ½æ°¸è¿œä¸ä¼šå‘ç”Ÿ),æˆ–è€…é€‰æ‹©æ”¶é›†ä¸€ç»„å…¨å±€é¢„å®šä¹‰çš„ç”¨æˆ·äº¤äº’ï¼Œä¾‹å¦‚æ‰€æœ‰çš„ç‚¹å‡»ã€è§¦æ‘¸äº‹ä»¶å’Œè¡¨å•æäº¤ã€‚

```
/**
 * Add a breadcrumb to "interactionTrail" array
 * @param  {Event} event
 */
function collectBreadcrumb({ type, target }) {
    const { tagName, attributes = [] } = target;
    const breadcrumb = {
        type,

        // Turn the event target into a descriptive object
        target: Object.assign(
                { tagName },
                ...[...attributes].map(
                    ({name, value}) => ({[name]: value})
                ),
            )
        )
    };

    // For form submission - collect form information
    /form/i.test(tagName) && Object.assign(
        breadcrumb,
        {
            fields: [...target].filter(

                // Don't want sensitive information in our logs
                ({name}) => name && /password/i.test(name)
            ).map(

                // Turn fields into key-value objects
                ({name, value}) => ({[name]: value})
            )
        }
    );

    // I'm using unshift so that the most recent interaction is at the top
    (window.interactionTrail = window.interactionTrail || []).unshift(breadcrumb);
}

['click', 'submit'].forEach(
    type => window.addEventListener(type, collectBreadcrumb)
); 
```

Enter fullscreen mode Exit fullscreen mode

### é¿å…æ¥è‡ªæ—§çš„ç¼“å­˜é¡µé¢çš„é”™è¯¯

å¥½å§ï¼Œè¿™ä¸ªæœ‰ç‚¹æ£˜æ‰‹ï¼Œä½†æˆ‘è®¤ä¸ºè¿™æ˜¯å®Œå…¨å€¼å¾—çš„ã€‚é€šè¿‡åº”ç”¨è¿™ä¸ªæµï¼Œæˆ‘èƒ½å¤Ÿæ ‡è®°æ—§çš„ç¼“å­˜ç½‘é¡µä¸­çš„é”™è¯¯ã€‚

1.  é¡µé¢çš„æœåŠ¡å™¨ç«¯å‘ˆç°åœ¨æœåŠ¡å™¨ä¸Šæ·»åŠ äº† UTC æ—¶é—´æˆ³çš„å…ƒæ•°æ®ã€‚
2.  æµè§ˆå™¨ä¼šå°†å…¶æå–å‡ºæ¥ï¼Œå¹¶ä¸é”™è¯¯æ—¥å¿—ä¸€èµ·å‘é€ã€‚
3.  ä¸­ä»‹æœåŠ¡è®¡ç®—è‡ªä»è¿™ä¸ªé¡µé¢è¢«**åˆ›å»º**ä»¥æ¥ç»è¿‡äº†å¤šå°‘**ä¸ªå°æ—¶**ï¼Œå¹¶åœ¨è®°å½•ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µã€‚
4.  æ¯”å¦‚è¯´ï¼Œè­¦æŠ¥ç³»ç»Ÿä¼šå¯¹è¶…è¿‡ 24 å°æ—¶çš„é¡µé¢è®¾ç½®ä¸€ä¸ªé˜ˆå€¼ã€‚

### é¡µé¢å¿«ç…§

å°† HTML çš„å¿«ç…§å­˜å‚¨åœ¨ä¸€ä¸ªä¸´æ—¶æ¡¶ä¸­(ä½ TTL)ï¼Œä»¥ä¾¿åœ¨é”™è¯¯è°ƒæŸ¥æ—¶å…è®¸æ‰“å°å±å¹•ã€‚

### Sourcemap é›†æˆ

ä½¿ç”¨å¯¹åº”äºåŒ…æ–‡ä»¶çš„ sourcemap æ–‡ä»¶æ˜ å°„é”™è¯¯ä½ç½®ã€‚å¯é€‰â€”â€”å‘é€å°è£…çš„ 10 è¡Œä»£ç ã€‚

* * *

### æå»ºè®®

æˆ‘æ•¢è‚¯å®šï¼Œè¿™ä¸ªæ¸…å•è¿˜å¯ä»¥ç»§ç»­ä¸‹å»ã€‚æˆ‘å¾ˆæƒ³å¬å¬ä½ å¯¹æ”¹å–„è¿™ä¸€æµç¨‹çš„ä¸€äº›æƒ³æ³•ã€‚è¯·ä¸è¦è¯´â€œç”¨å“¨å…µâ€ã€‚

* * *

<figure>

ğŸ™Œæ„Ÿè°¢ [Yossi Eynav](https://github.com/yossi-eynav) æœ€åˆæ¨åŠ¨å¼€å§‹ç›‘æ§ [Fiverr](https://www.fiverr.com) ä¸Šçš„æµè§ˆå™¨é”™è¯¯ã€‚

<figcaption>Cover image by [PaweÅ‚ CzerwiÅ„ski on Unsplash](https://unsplash.com/photos/OfwiURcZwYw)</figcaption>

</figure>