# ç”¨ JavaScript æ„å»ºä¸€ä¸ªé€€å‡ºå¼¹å‡ºçª—å£

> åŸæ–‡:[https://dev . to/de ammer/building-an-exit-popup-with-JavaScript-120 c](https://dev.to/deammer/building-an-exit-popup-with-javascript-120c)

æˆ‘æœ€è¿‘æ„å»ºäº†ä¸€ä¸ªç³»ç»Ÿï¼Œå½“ç”¨æˆ·è¦é€€å‡ºä¸€ä¸ªç«™ç‚¹æ—¶ï¼Œå®ƒä¼šå‘ç”¨æˆ·æ˜¾ç¤ºä¸€ä¸ªå¼¹å‡ºçª—å£ã€‚æˆ‘æƒ³æˆ‘ä¼šåˆ†äº«æˆ‘çš„æ–¹æ³•å’Œæˆ‘åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å­¦åˆ°çš„ä¸€äº›æŠ€å·§ã€‚æˆ‘å°†åšæŒä½¿ç”¨æ™®é€šçš„ JavaScript æ¥å°½å¯èƒ½åœ°è®©å®ƒå˜å¾—å¹³æ˜“è¿‘äººã€‚

> å…è´£å£°æ˜:é€€å‡ºå¼¹å‡ºçª—å£ä¼šæƒ¹æ¼ç”¨æˆ·ï¼Œæ‰€ä»¥æˆ‘å»ºè®®é€‚åº¦ä½¿ç”¨å®ƒä»¬ï¼

# [](#markup-and-styling)æ ‡è®°å’Œæ ·å¼

è®©æˆ‘ä»¬ä¸ºå¼¹å‡ºçª—å£å†™ä¸€äº›æ ‡è®°:

```
<div id="popup" class="popup__wrapper">
  <div class="popup__container">
    <h1 class="popup__title">Thank you for visiting!</h1>
    <p>Have a wonderful day ğŸ’</p>
  </div>
</div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`popup__wrapper`æ˜¯è¦†ç›–é¡µé¢çš„é€æ˜è¦†ç›–å›¾ã€‚`popup__container`å°†åŒ…è£…æˆ‘ä»¬æƒ³è¦æ˜¾ç¤ºçš„å†…å®¹ã€‚

ä¸‹é¢æ˜¯æˆ‘ç”¨çš„ CSS:

```
* {
  box-sizing: border-box;
}

#popup {
  display: none;
}

.popup__wrapper {
  background: rgba(0, 0, 0, .75);
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  z-index: 10;
}

.popup__container {
  background: #fff;
  font-family: Helvetica, Arial, sans-serif;
  font-size: 18px;
  margin: 100px auto;
  max-width: 100%;
  padding: 20px;
  width: 500px;
}

.popup__title {
  font-size: 26px;
  margin-bottom: 15px;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯`#popup`é€‰æ‹©å™¨ä¸Šçš„`display: none`:å®ƒéšè—å†…å®¹ï¼Œç›´åˆ°æˆ‘ä»¬æƒ³è¦æ˜¾ç¤ºå®ƒã€‚

## [](#adding-functionality)æ·»åŠ åŠŸèƒ½

ç°åœ¨è®©æˆ‘ä»¬å†™å‡ è¡Œ JavaScript æ¥æ˜¾ç¤ºé¼ æ ‡ç¦»å¼€çª—å£æ—¶çš„å¼¹å‡ºçª—å£:

```
function onMouseOut(event) {
  // Remove this event listener
  document.removeEventListener("mouseout", onMouseOut);

  // Show the popup
  document.getElementById("popup").style.display = "block";
}

document.addEventListener("mouseout", onMouseOut); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ä½ çš„é¼ æ ‡ç¦»å¼€çª—å£æ—¶ï¼Œå¼¹å‡ºçª—å£åº”è¯¥ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼

è¿™é‡Œæœ‰ä¸€ä¸ª CodePen ä¾›å‚è€ƒ:

[https://codepen.io/deammer/embed/GaVqRM?height=600&default-tab=result&embed-version=2](https://codepen.io/deammer/embed/GaVqRM?height=600&default-tab=result&embed-version=2)

# [](#refining-the-system)æç‚¼ç³»ç»Ÿ

å½“ç”¨æˆ·æƒ³ç¦»å¼€ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œä»–ä»¬é€šå¸¸ä¼šå°†é¼ æ ‡ç§»åŠ¨åˆ°æµè§ˆå™¨é¡¶éƒ¨çš„åœ°å€æ æˆ–åé€€æŒ‰é’®ã€‚ä¸ºäº†è®©å¼¹å‡ºçª—å£ä¸é‚£ä¹ˆæ€¥åˆ‡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹:

```
function onMouseOut(event) {
  // If the mouse is near the top of the window, show the popup
  if (event.clientY < 50) {
    // Remove this event listener
    document.removeEventListener("mouseout", onMouseOut);

    // Show the popup
    document.getElementById("popup").style.display = "block";
  }
}

document.addEventListener("mouseout", onMouseOut); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#fixing-a-firefox-bug)ä¿®å¤ç«ç‹æ¼æ´

æˆ‘æ³¨æ„åˆ°å½“ç‚¹å‡»æˆ–æ‚¬åœåœ¨ Firefox ä¸­çš„`<select>`å…ƒç´ ä¸Šæ—¶ï¼Œå¼¹å‡ºçª—å£å°±ä¼šå‡ºç°ã€‚

ä½ å¯ä»¥é€šè¿‡åœ¨ DOM ä¸­æ·»åŠ ä¸€ä¸ªä¸‹æ‹‰èœå•å¹¶ç‚¹å‡»å®ƒæ¥æµ‹è¯•è¿™ä¸€ç‚¹

```
<div id="popup" class="popup__wrapper">
  <div class="popup__container">
    <h1 class="popup__title">Thank you for visiting!</h1>
    <p>Have a wonderful day ğŸ’</p>
  </div>
</div>

<select>
  <option>Oh</option>
  <option>No</option>
</select> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å¾ˆè®¨åŒï¼

ç»è¿‡å‡ ä¸ªå°æ—¶çš„è¿­ä»£ï¼Œæˆ‘å¾—å‡ºäº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ:

```
function onMouseOut(event) {
  // If the mouse is near the top of the window, show the popup
  // Also, do NOT trigger when hovering or clicking on selects
  if (
    event.clientY < 50 &&
    event.relatedTarget == null &&
    event.target.nodeName.toLowerCase() !== 'select') {
    // Remove this event listener
    document.removeEventListener("mouseout", onMouseOut);

    // Show the popup
    document.getElementById("popup").style.display = "block";
  }
}

document.addEventListener("mouseout", onMouseOut); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Firefox ä¸­çš„å¼¹å‡ºçª—å£ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼è¿™æ˜¯å¦ä¸€ä¸ªæ”¹è¿›çš„ä»£ç ç¬”:

[https://codepen.io/deammer/embed/EzqyEg?height=600&default-tab=result&embed-version=2](https://codepen.io/deammer/embed/EzqyEg?height=600&default-tab=result&embed-version=2)

* * *

æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« æ˜¯æœ‰ç›Šçš„ï¼è¯·åœ¨ä¸‹é¢çš„è¯„è®ºé‡Œå‘Šè¯‰æˆ‘ä½ çš„æƒ³æ³•ï¼Œç¥ä½ ç¼–ç æ„‰å¿«ï¼