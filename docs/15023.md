# (å¾®å°)è½¬åˆ° WebAssembly

> åŸæ–‡:[https://dev.to/sendilkumarn/tiny-go-to-webassembly-5168](https://dev.to/sendilkumarn/tiny-go-to-webassembly-5168)

åœ°é¼ ä¸ä»…çœ‹èµ·æ¥å¯çˆ±ï¼Œè€Œä¸”å®ƒä»¬å¾ˆå¼ºå¤§ã€‚

[![](../Images/8373d42f25b2fc76408bebffd1a6320f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--_i4QVzEO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1eaxlpr98hv1bedjgyhg.gif)

I â¤ï¸ [é™æ€ç±»å‹è¯­è¨€](https://en.wikipedia.org/wiki/Type_system)å’Œ [Golang](https://golang.org/) ä¹Ÿæ˜¯é™æ€ç±»å‹çš„ã€‚

> Golang åœ¨è¯­æ³•ä¸Šç±»ä¼¼äº Cï¼Œä½†æ˜¯å…·æœ‰å†…å­˜å®‰å…¨ã€åƒåœ¾æ”¶é›†å’Œ CSP é£æ ¼çš„å¹¶å‘æ€§ã€‚â€”â€”[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Go_(programming_language))

æˆ‘ä»¬å¯ä»¥æŠŠ Go ç¼–è¯‘æˆ [WebAssembly](https://webassembly.org/) ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”¨ Golang ç¼–å†™é¢‘é“ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œå®ƒä»¬ã€‚

Golang çš„ WebAssembly ä»å¤„äºæ—©æœŸé˜¶æ®µã€‚ğŸ¦„

Golang å†™èµ·æ¥å¾ˆç®€å•ã€‚å› æ­¤ï¼Œå¾ˆå®¹æ˜“å°†ç°æœ‰åº”ç”¨ç¨‹åºç›´æ¥ç¼–è¯‘åˆ° WebAssembly æ¨¡å—ä¸­ï¼Œåªè¦å®ƒä»¬æ²¡æœ‰ä»»ä½•æ–‡ä»¶è·¯å¾„æˆ–ç³»ç»Ÿçº§åŠŸèƒ½ï¼Œè€Œè¿™äº›åŠŸèƒ½åœ¨ WebAssembly è¿è¡Œæ—¶æ˜¯ä¸å¯ç”¨çš„ã€‚

# [](#hello-world)ä½ å¥½ä¸–ç•Œ

åˆ›å»ºä¸€ä¸ªåä¸º`go-wasm`çš„æ–‡ä»¶å¤¹ï¼Œå­æ–‡ä»¶å¤¹ä¸º`out`å’Œ`go`ï¼›

```
 go-wasm/
 |__ out/
 |__ go/ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`go`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`main.go`çš„æ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹å†…å®¹:

```
package main

func main() {
    println("Hello World!!!")
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç”¨`go run go/main.go`è¿è¡Œ go æ–‡ä»¶ã€‚è¿™ä¼šæ‰“å°å‡º`Hello World`ã€‚æ²¡é‚£ä¹ˆå®¹æ˜“ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†å®ƒç¼–è¯‘æˆ WebAssembly æ¨¡å—å¹¶ä½œä¸º WebAssembly è¿è¡Œã€‚

```
GOOS=js GOARCH=wasm go build -o out/main.wasm go/main.go 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†åœ¨`out`æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆ`main.wasm`ã€‚ä¸ Rust ä¸åŒï¼ŒGolang ä¸ç”Ÿæˆä»»ä½•ç»‘å®šæ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ TinyGo å®˜æ–¹ä»“åº“[ä¸­çš„ç»‘å®šæ–‡ä»¶ã€‚](https://github.com/tinygo-org/tinygo/blob/master/targets/wasm_exec.js)

ä¸‹è½½æ–‡ä»¶å¹¶å°†å…¶ç§»åŠ¨åˆ°`out`ç›®å½•ä¸­ã€‚

åœ¨`out`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`index.html`æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹:

```
<!doctype html>
<html>
        <head>
                <meta charset="utf-8">
                <title>Go wasm</title>
        </head>

        <body>
                <script src="wasm_exec.js"></script>
                <script>
                        const go = new Go();
                        WebAssembly.instantiateStreaming(fetch('main.wasm'),go.importObject).then( res=> {
                                go.run(res.instance)    
                        })
                </script>

        </body>
</html> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`index.html`åŠ è½½`wasm_exec.js`æ–‡ä»¶ã€‚æ³¨æ„ï¼Œè¿™ä¸ªæ–‡ä»¶é€‚ç”¨äº Browser å’Œ NodeJS ç¯å¢ƒã€‚å®ƒå¯¼å‡ºä¸€ä¸ª`Go`å¯¹è±¡ã€‚

ç„¶åæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæœ¬åœ°è„šæœ¬ã€‚åœ¨è„šæœ¬ä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

*   ä»`wasm_exec.js`å®ä¾‹åŒ–`Go`ã€‚
*   ä½¿ç”¨[å®ä¾‹åŒ–æµ](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiateStreaming)è·å– WebAssembly æ¨¡å—

ä»æ–‡ä»¶å¤¹è¿è¡Œæœ¬åœ°æœåŠ¡å™¨æŸ¥çœ‹`Hello World`ã€‚

ä½†æ˜¯ç­‰ç­‰ï¼Œæˆ‘ä»¬åœ¨å†™ Golangã€‚Golang ä½¿å¾—ç”¨ Golang ç¼–å†™ä¸€ä¸ªç®€å•çš„ web æœåŠ¡å™¨å˜å¾—ç›¸å½“å®¹æ˜“ã€‚è®©æˆ‘ä»¬å†™ä¸€ä¸ªã€‚

åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º`webServer.go`çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ã€‚

```
package main

import (
        "log"
        "net/http"
        "strings"
)

const dir = "./out"

func main() {
        fs := http.FileServer(http.Dir(dir))
        log.Print("Serving " + dir + " on http://localhost:8080")
        http.ListenAndServe(":8080", http.HandlerFunc(func(resp http.ResponseWriter, req *http.Request) {
                resp.Header().Add("Cache-Control", "no-cache")
                if strings.HasSuffix(req.URL.Path, ".wasm") {
                        resp.Header().Set("content-type", "application/wasm")
                }
                fs.ServeHTTP(resp, req)
        }))
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æœåŠ¡äº`out`æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ã€‚ç°åœ¨ä½¿ç”¨`go run webServer.go`è¿è¡ŒæœåŠ¡å™¨ã€‚ğŸ‰é‚£ä¸æ˜¯å¾ˆå®¹æ˜“å—ï¼Ÿ

å‰å¾€`http://localhost:8080`å¹¶æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹ä»¤äººæ•¬ç•çš„`Hello World`ã€‚

ç›®å½•ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºã€‚

```
â”œâ”€â”€ go
â”‚Â Â  â””â”€â”€ main.go
â””â”€â”€ out
    â”œâ”€â”€ index.html
    â”œâ”€â”€ wasm_exec.js
    â””â”€â”€ main.wasm 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®°å½•ç”Ÿæˆçš„ WebAssembly æ¨¡å—çš„æ–‡ä»¶å¤§å°éå¸¸é‡è¦ã€‚ä»…ä»…æ˜¯ã€ŠHello Worldã€‹å°±æœ‰ 1.3 å…†å­—èŠ‚ã€‚è¿™æ˜¯å·¨å¤§çš„æƒåˆ©ã€‚

```
-rw-r--r--  1 sendilkumar  staff   482B Jul  5 23:20 index.html
-rwxr-xr-x  1 sendilkumar  staff   1.3M Jul  5 23:19 main.wasm
-rw-r--r--  1 sendilkumar  staff    13K Jul  5 23:18 wasm_exec.js 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

WebAssembly å¯èƒ½æä¾›çš„ä»»ä½•æ€§èƒ½ï¼Œå¦‚æœæ¨¡å—å¾ˆå¤§ï¼Œå°±ä¸éœ€è¦å®ƒã€‚

åˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬æœ‰ä¸€ç‚¹ç‚¹ã€‚

# [](#tiny-go)æå°çš„å›´æ£‹

[![](../Images/8e34603e522205662be1ffd5ee84701c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--E8_855rx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/2fz3lq3kohgoltymt7zq.png)

TinyGo æ˜¯ä¸€ä¸ªå°† Golang å¼•å…¥å¾®æ§åˆ¶å™¨å’Œç°ä»£ç½‘ç»œæµè§ˆå™¨çš„é¡¹ç›®ã€‚ä»–ä»¬æœ‰ä¸€ä¸ªå…¨æ–°çš„åŸºäº LLVM ç¼–è¯‘çš„ç¼–è¯‘å™¨ã€‚ä½¿ç”¨ TinyGoï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆéå¸¸å°çš„åº“ï¼Œè¿™äº›åº“è¢«ä¼˜åŒ–ä¸ºåœ¨èŠ¯ç‰‡ä¸­æ‰§è¡Œã€‚

ç‚¹å‡»æŸ¥çœ‹å¦‚ä½•å®‰è£… TinyGo [ã€‚](https://tinygo.org/getting-started/)

å®‰è£…åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ TinyGo ç¼–è¯‘ä»»ä½• Golang ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°† Golang ç¼–è¯‘æˆ WebAssembly æ¨¡å—ã€‚

```
tinygo build -o out/main.wasm -target wasm ./go/main.go 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è½¬åˆ°æµè§ˆå™¨ï¼Œåˆ·æ–°é¡µé¢ï¼Œçœ‹çœ‹`Hello World`è¿˜åœ¨æ‰“å°ã€‚

æœ€é‡è¦çš„æ˜¯ç”Ÿæˆçš„ WebAssembly æ¨¡å—åªæœ‰ 3.8KğŸ‰ ğŸ‰ ğŸ‰

```
-rw-r--r--  1 sendilkumar  staff   482B Jul  5 23:20 index.html
-rwxr-xr-x  1 sendilkumar  staff   3.8K Jul  5 23:29 main.wasm
-rw-r--r--  1 sendilkumar  staff    13K Jul  5 23:18 wasm_exec.js 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› ä¸ºæˆ‘ä»¬ä¸‹é¢æœ‰ LLVMï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`-opt`æ ‡å¿—è¿›ä¸€æ­¥è°ƒæ•´å®ƒã€‚æœ€å¤§å°ºå¯¸ä¼˜åŒ–æ˜¯é€šè¿‡-opt=z æ ‡å¿—è·å¾—çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹`TinyGo`ä½¿ç”¨è¿™ä¸ªæ ‡å¿—ã€‚å› ä¸ºé‚£äº›å¾®å‹è®¾å¤‡çš„å†…å­˜æœ‰é™ã€‚

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ç»§ç»­å…³æ³¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ TinyGo å’Œ WebAssembly é‡æ–°åˆ›å»ºç»å…¸ Dev çš„ç¦»çº¿é¡µé¢ã€‚

[![](../Images/2a1d7d48b2ebfd44c03c733c79322d74.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--mLl3vy45--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/18dmdedoviqs1vrrjqoo.png)

æˆ‘å¸Œæœ›è¿™èƒ½ç»™ä½ ä¸€ä¸ªåŠ¨åŠ›ï¼Œå¼€å§‹ä½ çš„ WebAssembly ä¹‹æ—…ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜/å»ºè®®/è§‰å¾—æˆ‘é”™è¿‡äº†ä»€ä¹ˆï¼Œè¯·éšæ—¶æ·»åŠ è¯„è®ºã€‚

ä½ å¯ä»¥åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘ã€‚

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç•™ä¸‹èµæˆ–è¯„è®ºã€‚â¤ï¸