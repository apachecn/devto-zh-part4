# å¦‚ä½•ç”¨ Jest æµ‹è¯• JavaScript

> åŸæ–‡ï¼š<https://dev.to/thomaslombart/how-to-test-javascript-with-jest-3bkg>

æµ‹è¯•æ˜¯æ¯ä¸ªå¼€å‘äººå‘˜éƒ½åº”è¯¥å…·å¤‡çš„é‡è¦æŠ€èƒ½ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä¸€äº›å¼€å‘è€…è¿˜æ˜¯ä¸æ„¿æ„æµ‹è¯•ã€‚æˆ‘ä»¬éƒ½æ›¾é‡åˆ°è¿‡è¿™æ ·çš„äººï¼Œä»–ä»¬è®¤ä¸ºæµ‹è¯•æ˜¯æ— ç”¨çš„ï¼Œæˆ–è€…è®¤ä¸ºç¼–å†™æµ‹è¯•éœ€è¦å¤ªå¤šçš„åŠªåŠ›ã€‚è™½ç„¶åœ¨å¼€å§‹ç¼–å†™æµ‹è¯•æ—¶å¯èƒ½ä¼šæœ‰è¿™ç§æ„Ÿè§‰ï¼Œä½†æ˜¯ä¸€æ—¦ä½ å­¦ä¼šäº†æ­£ç¡®åœ°æµ‹è¯•ä½ çš„åº”ç”¨ç¨‹åºï¼Œä½ å°±å†ä¹Ÿä¸ä¼šå›å¤´äº†ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå†™å¾—å¥½çš„è¯ï¼Œ**æµ‹è¯•å¯ä»¥è®©ä½ è‡ªä¿¡åœ°å‘å¸ƒå¥å£®çš„åº”ç”¨ã€‚**

## æµ‹è¯•å¿…ä¸å¯å°‘

è®©æˆ‘ä»¬å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå…¨æ–°çš„åº”ç”¨ç¨‹åºã€‚ä½ å·²ç»å†™äº†å‡ å‘¨æˆ–å‡ ä¸ªæœˆçš„ä»£ç ï¼Œæ‰€ä»¥ä½ æŒæ¡äº†ä½ çš„ä»£ç ã€‚ä½ çŸ¥é“å®ƒçš„æ¯ä¸€éƒ¨åˆ†ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦åœ¨ä½ å·²ç»çŸ¥é“çš„ä¸œè¥¿ä¸Šå†™æµ‹è¯•å‘¢ï¼Ÿ

å—¯ï¼Œä½ çš„ä»£ç è¶Šå¤šï¼Œå°±è¶Šéš¾ç»´æŠ¤ã€‚å½“ä½ æ·»åŠ æ–°ç‰¹æ€§æ—¶ï¼Œæ€»ä¼šæœ‰ä¸€ä¸ªæ—¶é—´ç‚¹**ç ´å**ä½ çš„ä»£ç ã€‚ç„¶åï¼Œæ‚¨å¿…é¡»å¼€å§‹è°ƒè¯•ï¼Œä¿®æ”¹æ‚¨ç°æœ‰çš„ä»£ç ï¼Œå¹¶å¸Œæœ›æ‚¨çš„ä¿®å¤ä¸ä¼šç ´åä»»ä½•å…¶ä»–åŠŸèƒ½ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œä½ ä¼šæƒ³:*â€œæˆ‘è®¨åŒè¿™ä¸ªåº”ç”¨ç¨‹åºï¼æˆ‘ç”šè‡³ä¸èƒ½åœ¨ä¸æŸåä»»ä½•ä¸œè¥¿çš„æƒ…å†µä¸‹å‘å¸ƒä¸€ä¸ªå¾®å°çš„åŠŸèƒ½ï¼â€*ã€‚

æˆ‘ä»¬å†ä¸¾ä¸€ä¸ªä¾‹å­ã€‚æ‚¨åœ¨æ²¡æœ‰æµ‹è¯•çš„æƒ…å†µä¸‹å°±è¿›å…¥äº†ç°æœ‰çš„ä»£ç åº“ã€‚åŒæ ·çš„äº‹æƒ…åœ¨è¿™é‡Œ:ç¥ä½ å¥½è¿æ·»åŠ æ–°åŠŸèƒ½è€Œä¸å€’é€€ï¼

ä½†æ˜¯å¦‚æœä½ å’Œå…¶ä»–å¼€å‘è€…ä¸€èµ·å·¥ä½œå‘¢ï¼Ÿå¦‚æœé™¤äº†åªä¿®å¤ app æ²¡æœ‰å…¶ä»–é€‰æ‹©æ€ä¹ˆåŠï¼Ÿä½ å°†è¿›å…¥**é‡å¯**é˜¶æ®µ:åœ¨è¿™ä¸ªæ—¶åˆ»ï¼Œä½ å†³å®šé‡æ–°æ„å»ºä½ ç°æœ‰çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå› ä¸ºä½ ä¸å†ç¡®å®šå‘ç”Ÿäº†ä»€ä¹ˆã€‚

è¿™ä¸¤ä¸ªä¾‹å­çš„è§£å†³æ–¹æ¡ˆæ˜¯**ç¼–å†™æµ‹è¯•ã€‚ç°åœ¨çœ‹èµ·æ¥è¿™å¯èƒ½æ˜¯æµªè´¹æ—¶é—´ï¼Œä½†å®é™…ä¸Šä»¥åä¼šèŠ‚çœæ—¶é—´ã€‚ä¸‹é¢æ˜¯ç¼–å†™æµ‹è¯•å¸¦æ¥çš„ä¸€äº›ä¸»è¦å¥½å¤„:**

*   ä½ å¯ä»¥åœ¨ä¸ç ´åä»»ä½•ä¸œè¥¿çš„æƒ…å†µä¸‹**é‡æ„**ä½ çš„ä»£ç ï¼Œå› ä¸ºæµ‹è¯•ä¼šå‘Šè¯‰ä½ æ˜¯å¦å‘ç”Ÿäº†é”™è¯¯ã€‚
*   æ‚¨å¯ä»¥**è‡ªä¿¡åœ°å‘å¸ƒæ–°åŠŸèƒ½**,è€Œä¸ä¼šå‡ºç°ä»»ä½•å€’é€€ã€‚
*   æ‚¨çš„ä»£ç å˜å¾—æ›´åŠ **æ–‡æ¡£åŒ–**,å› ä¸ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æµ‹è¯•åšäº†ä»€ä¹ˆã€‚ä½ èŠ±**æ›´å°‘çš„æ—¶é—´æµ‹è¯•ä½ çš„åº”ç”¨**ï¼ŒèŠ±æ›´å¤šçš„æ—¶é—´åœ¨**åšé‡è¦çš„äº‹æƒ…ä¸Šã€‚**

æ‰€ä»¥ï¼Œæ˜¯çš„ï¼Œç¼–å†™æµ‹è¯•éœ€è¦æ—¶é—´ã€‚æ˜¯çš„ï¼Œåˆšå¼€å§‹å¾ˆéš¾ã€‚æ˜¯çš„ï¼Œæ„å»ºåº”ç”¨ç¨‹åºå¬èµ·æ¥æ›´æœ‰è¶£ã€‚ä½†æ˜¯æˆ‘è¦å†è¯´ä¸€é:ç¼–å†™æµ‹è¯•æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå¹¶ä¸”åœ¨æ­£ç¡®å®ç°æ—¶å¯ä»¥èŠ‚çœæ—¶é—´ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å‘ç°ä¸€ä¸ªä¸º JavaScript åº”ç”¨ç¼–å†™æµ‹è¯•çš„å¼ºå¤§å·¥å…·: [Jest](https://jestjs.io/) ã€‚

## å‘ç°ç¬‘è¯

ç®€è€Œè¨€ä¹‹ï¼ŒJest æ˜¯ä¸€ä¸ªç”±è„¸ä¹¦å¼€å‘çš„ä¸€ä½“åŒ– JavaScript æµ‹è¯•å·¥å…·ã€‚ä¸ºä»€ä¹ˆæ˜¯ä¸€ä½“æœºï¼Ÿå› ä¸ºåªæœ‰å¼€ç©ç¬‘ï¼Œä½ æ‰èƒ½åšæ‰€æœ‰è¿™äº›äº‹æƒ…:

*   å®‰å…¨å¿«é€Ÿåœ°è¿è¡Œæ‚¨çš„æµ‹è¯•
*   åœ¨ä½ çš„ä»£ç ä¸Šåšæ–­è¨€
*   æ¨¡æ‹Ÿå‡½æ•°å’Œæ¨¡å—
*   æ·»åŠ ä»£ç è¦†ç›–ç‡
*   å¿«ç…§æµ‹è¯•
*   è¿˜æœ‰æ›´å¤šï¼

è™½ç„¶ä½ å¯ä»¥ä½¿ç”¨å…¶ä»–æµ‹è¯•å·¥å…·ï¼Œæ¯”å¦‚[æ‘©å¡](https://mochajs.org/)ã€[æŸ´](https://www.chaijs.com/)æˆ–[å…´å†œ](https://sinonjs.org/)ï¼Œä½†æˆ‘æ›´å–œæ¬¢ä½¿ç”¨ Jestï¼Œå› ä¸ºå®ƒç®€å•æ˜“ç”¨ã€‚

### å®‰è£…

æ·»åŠ  Jestï¼Œæ²¡æœ‰ä»€ä¹ˆæ¯”åœ¨ä½ çš„é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªåŒ…æ›´ç®€å•çš„äº†:

```
npm install --save-dev jest 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åä½ å¯ä»¥åœ¨ä½ çš„`package.json`æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª`test`è„šæœ¬:

```
{  "scripts":  {  "test":  "jest"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é»˜è®¤æƒ…å†µä¸‹è¿è¡Œ`jest`ä¼šæ‰¾åˆ°å¹¶è¿è¡Œä½äº`__tests__`æ–‡ä»¶å¤¹ä¸­æˆ–è€…ä»¥`.spec.js`æˆ–`.test.js`ç»“å°¾çš„æ–‡ä»¶ã€‚

### æµ‹è¯•æ–‡ä»¶çš„ç»“æ„

Jest æä¾›äº†æ„å»ºæµ‹è¯•çš„å‡½æ•°:

*   `describe`:ç”¨äº**å¯¹ä½ çš„æµ‹è¯•è¿›è¡Œåˆ†ç»„ï¼Œå¹¶æè¿°ä½ çš„åŠŸèƒ½/æ¨¡å—/ç±»çš„è¡Œä¸ºã€‚**å®ƒéœ€è¦ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªæ˜¯æè¿°æ‚¨çš„ç»„çš„å­—ç¬¦ä¸²ã€‚ç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå…¶ä¸­æœ‰ä½ çš„æµ‹è¯•ç”¨ä¾‹æˆ–è€…é’©å­å‡½æ•°(æ›´å¤šå†…å®¹åœ¨ä¸‹é¢)ğŸ˜‰).
*   `it`æˆ–è€…`test`:æ˜¯ä½ çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ çš„å•å…ƒæµ‹è¯•ã€‚å¿…é¡»æ˜¯**æè¿°æ€§çš„**ã€‚å‚æ•°å’Œ`describe`å®Œå…¨ä¸€æ ·ã€‚
*   `beforeAll (afterAll)`:åœ¨æ‰€æœ‰æµ‹è¯•ä¹‹å‰(ä¹‹å)è¿è¡Œ**çš„é’©å­å‡½æ•°ã€‚**å®ƒéœ€è¦ä¸€ä¸ªå‚æ•°:æ‚¨å°†åœ¨æ‰€æœ‰æµ‹è¯•ä¹‹å‰(ä¹‹å)è¿è¡Œçš„å‡½æ•°ã€‚
*   `beforeEach (afterEach)`:æ¯æ¬¡æµ‹è¯•å‰(å)è¿è¡Œ**çš„é’©å­å‡½æ•°ã€‚**å®ƒéœ€è¦ä¸€ä¸ªå‚æ•°:æ¯æ¬¡æµ‹è¯•ä¹‹å‰(ä¹‹å)è¿è¡Œçš„å‡½æ•°ã€‚

**æ³¨æ„äº‹é¡¹**:

*   `beforeAll`ã€`beforeEach`å’Œå…¶ä»–é’©å­å‡½æ•°ä¹‹æ‰€ä»¥è¿™ä¹ˆå«ï¼Œæ˜¯å› ä¸ºå®ƒä»¬å…è®¸ä½ **è°ƒç”¨ä½ è‡ªå·±çš„ä»£ç **å¹¶ä¿®æ”¹ä½ çš„æµ‹è¯•çš„**è¡Œä¸º**ã€‚
*   é€šè¿‡ä½¿ç”¨`describe`ä¸Šçš„`.skip`å’Œ`it` : `it.skip(...)`æˆ–`describe.skip(...)`ï¼Œå¯ä»¥è·³è¿‡(å¿½ç•¥)æµ‹è¯•ã€‚
*   æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨`describe`ä¸Šçš„`.only`å’Œ`it` : `it.only(...)`æˆ–`describe.only(...)`æ¥é€‰æ‹©æ‚¨æƒ³è¦è¿è¡Œçš„æµ‹è¯•ã€‚å¦‚æœæ‚¨æœ‰å¾ˆå¤šæµ‹è¯•ï¼Œå¹¶ä¸”å¸Œæœ›åªå…³æ³¨ä¸€ä¸ªæµ‹è¯•ï¼Œé‚£ä¹ˆè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚

### ç¬¬ä¸€æ¬¡æµ‹è¯•

```
describe("My first test suite", () => {
  it("adds two numbers", () => {
    expect(add(2, 2)).toBe(4);
  });

  it("substracts two numbers", () => {
    expect(substract(2, 2)).toBe(0);
  });
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## èµ›è€…

å½“ä½ å†™ä¸€ä¸ªæµ‹è¯•æ—¶ï¼Œä½ é€šå¸¸éœ€è¦åœ¨ä½ çš„ä»£ç ä¸Šåšæ–­è¨€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·åœ¨ç™»å½•å±å¹•ä¸Šç»™å‡ºäº†é”™è¯¯çš„å¯†ç ï¼Œæ‚¨ä¼šæœŸæœ›å±å¹•ä¸Šå‡ºç°é”™è¯¯ã€‚æ›´ä¸€èˆ¬åœ°è¯´ï¼Œè¦åšå‡ºæ–­è¨€ï¼Œä½ éœ€è¦ä¸€ä¸ª**è¾“å…¥**å’Œä¸€ä¸ª**é¢„æœŸè¾“å‡º**ã€‚Jest é€šè¿‡æä¾›**åŒ¹é…å™¨**æ¥æµ‹è¯•æˆ‘ä»¬çš„å€¼
ï¼Œè®©æˆ‘ä»¬è½»æ¾åšåˆ°è¿™ä¸€ç‚¹

```
expect(input).matcher(output); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»¥ä¸‹æ˜¯æœ€å¸¸è§çš„ä¸€ç§:

*   `toBe`:æ¯”è¾ƒ[åŸè¯­](https://developer.mozilla.org/en-US/docs/Glossary/Primitive)å€¼(å¸ƒå°”å€¼ã€æ•°å­—ã€å­—ç¬¦ä¸²)æˆ–å¯¹è±¡å’Œæ•°ç»„çš„å¼•ç”¨(åˆå**å¼•ç”¨ç›¸ç­‰**

```
expect(1 + 1).toBe(2);

const firstName = "Thomas";
const lastName = "Lombart";
expect(`${firstName}  ${lastName}`).toBe("Thomas Lombart");

const testsAreEssential = true;
expect(testsAreEssential).toBe(true); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `toEqual`:é€’å½’æ¯”è¾ƒæ•°ç»„æˆ–å¯¹è±¡çš„æ‰€æœ‰å±æ€§(åˆå**æ·±åº¦ç›¸ç­‰**)ã€‚

```
const fruits = ["banana", "kiwi", "strawberry"];
const sameFruits = ["banana", "kiwi", "strawberry"];
expect(fruits).toEqual(sameFruits);
// Oops error! They don't have the same reference
expect(fruits).toBe(sameFruits);

const event = {
  title: "My super event",
  description: "Join me in this event!",
};

expect({ ...event, city: "London" }).toEqual({
  title: "My super event",
  description: "Join me in this event!",
  city: "London",
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `toBeTruthy` ( `toBeFalsy`):å‘ŠçŸ¥è¯¥å€¼æ˜¯å¦ä¸º`true` ( `false`)ã€‚

```
expect(null).toBeFalsy();
expect(undefined).toBeFalsy();
expect(false).toBeFalsy();

expect("Hello world").toBeTruthy();
expect({ foo: "bar" }).toBeTruthy(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `not`:å¿…é¡»æ”¾åœ¨åŒ¹é…å™¨å‰é¢ï¼Œè¿”å›åŒ¹é…å™¨ç»“æœçš„åæ–¹ã€‚

```
expect(null).not.toBeTruthy();
// same as expect(null).toBeFalsy()

expect([1]).not.toEqual([2]); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `toContain`:æ£€æŸ¥æ•°ç»„æ˜¯å¦åŒ…å«å‚æ•°ä¸­çš„å…ƒç´ 

```
expect(["Apple", "Banana", "Strawberry"]).toContain("Apple"); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `toThrow`:æ£€æŸ¥å‡½æ•°æ˜¯å¦æŠ›å‡ºé”™è¯¯

```
function connect() {
  throw new ConnectionError();
}

expect(connect).toThrow(ConnectionError); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»–ä»¬ä¸æ˜¯å”¯ä¸€çš„åŒ¹é…è€…ï¼Œè¿œéå¦‚æ­¤ã€‚ä½ è¿˜å¯ä»¥åœ¨[Jest docs](https://jestjs.io/docs/en/expect#methods)`toMatch``toBeGreaterThan``toBeUndefined``toHaveProperty`ç­‰ç­‰ä¸­å‘ç°ï¼

## [t1 æ˜¯ CLI](#jest-cli)

æˆ‘ä»¬è®¨è®ºäº†æµ‹è¯•æ–‡ä»¶çš„ç»“æ„å’Œ Jest æä¾›çš„åŒ¹é…å™¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒçš„ CLI æ¥è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•ã€‚

### è¿è¡Œæµ‹è¯•

è®©æˆ‘ä»¬å›å¿†ä¸€ä¸‹æˆ‘ä»¬åœ¨ Discover Jest çš„è¯¾ç¨‹ä¸­çœ‹åˆ°çš„å†…å®¹:ä»…è¿è¡Œ`jest`ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`jest`ä¼šåœ¨æ ¹ç›®å½•ä¸‹æŸ¥æ‰¾å¹¶è¿è¡Œæ‰€æœ‰ä½äº`__tests__`æ–‡ä»¶å¤¹æˆ–ä»¥`.spec.js`æˆ–`.test.js`ç»“å°¾çš„æ–‡ä»¶ã€‚

æ‚¨ä¹Ÿå¯ä»¥æŒ‡å®šæƒ³è¦è¿è¡Œçš„æµ‹è¯•æ–‡ä»¶çš„æ–‡ä»¶åæˆ–æ¨¡å¼:

```
jest Event # run all test files containing Event
jest src/EventDetail.test.js # run a specific file 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è®©æˆ‘ä»¬å‡è®¾æ‚¨æƒ³è¦è¿è¡Œä¸€ä¸ªç‰¹å®šçš„æµ‹è¯•ï¼ŒJest å…è®¸æ‚¨ä½¿ç”¨`-t`é€‰é¡¹æ¥è¿™æ ·åšã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ä¸¤ä¸ªæµ‹è¯•å¥—ä»¶:

```
describe("calculator", () => {
  it("adds two numbers", () => {
    expect(2 + 2).toBe(4)
  })

  it("substracts two numbers", () => {
    expect(2 - 2).toBe(0)
  })

  it("computes something", () => {
    expect(2 * 2).toBe(4)
  })
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
describe("example", () => {
  it("does something", () => {
    expect(foo()).toEqual("bar")
  })

  it("does another thing", () => {
    const firstName = "John"
    const lastName = "Doe"
    expect(`${firstName}  ${lastName}`).toBe("John Doe")
  })
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
jest -t numbers 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Jest å°†è¿è¡Œ`calculator.test.js`çš„å‰ä¸¤ä¸ªæµ‹è¯•ï¼Œä½†å°†è·³è¿‡å…¶ä½™çš„æµ‹è¯•ã€‚

### è§‚çœ‹æ¨¡å¼

æˆ‘è®¤ä¸ºï¼Œè¿˜æœ‰ä¸€ä¸ªæœ€ç®€å•çš„ç¬‘è¯ã€‚è¿™ç§æ¨¡å¼ç›‘è§†æ–‡ä»¶çš„å˜åŒ–ï¼Œå¹¶é‡æ–°è¿è¡Œä¸å®ƒä»¬ç›¸å…³çš„æµ‹è¯•ã€‚è¦è¿è¡Œå®ƒï¼Œä½ åªéœ€è¦ä½¿ç”¨`--watch`é€‰é¡¹:

```
jest --watch 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨æ„**:å¤šäºäº† Gitï¼ŒJest çŸ¥é“å“ªäº›æ–‡ä»¶è¢«ä¿®æ”¹äº†ã€‚æ‰€ä»¥æ‚¨å¿…é¡»åœ¨é¡¹ç›®ä¸­å¯ç”¨ git æ¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ã€‚

### è¦†ç›–èŒƒå›´

è®©æˆ‘ä»¬çœ‹çœ‹æœ€åä¸€ä¸ªé€‰é¡¹æ¥å±•ç¤º Jest æœ‰å¤šå¼ºå¤§:æ”¶é›†æµ‹è¯•è¦†ç›–ç‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæµ‹è¯•å¥—ä»¶è¿è¡Œæ—¶è¦†ç›–çš„ä»£ç é‡çš„**åº¦é‡ã€‚è¿™ä¸ªæ ‡å‡†å¯¹äºç¡®ä¿ä½ çš„ä»£ç è¢«ä½ çš„æµ‹è¯•æ°å½“åœ°è¦†ç›–æ˜¯æœ‰ç”¨çš„ã€‚ä¸ºäº†åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤:** 

```
jest --coverage 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨**:å¤„å¤„äº‰å– 100%çš„è¦†ç›–ç‡æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå°¤å…¶æ˜¯ UI æµ‹è¯•(å› ä¸ºäº‹æƒ…è¿›å±•å¾ˆå¿«)ã€‚å¯¹æœ€é‡è¦çš„äº‹æƒ…è¾¾åˆ° 100%çš„è¦†ç›–ç‡ï¼Œæ¯”å¦‚ä¸æ”¯ä»˜ç›¸å…³çš„æ¨¡å—æˆ–ç»„ä»¶ã€‚

å¦‚æœæˆ‘ç»™ä½  Jest CLI æä¾›çš„æ¯ä¸€ä¸ªå¯èƒ½çš„é€‰é¡¹ï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸¦ä½ èµ°å¾ˆé•¿æ—¶é—´ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œçœ‹çœ‹ä»–ä»¬çš„[æ–‡æ¡£](https://jestjs.io/docs/en/cli)ã€‚

## æ¨¡ä»¿

mock æ˜¯ä¸€ä¸ªæ¨¡æ‹ŸçœŸå®å¯¹è±¡è¡Œä¸ºçš„å‡æ¨¡å—ã€‚æ¢å¥è¯è¯´ï¼Œæ¨¡ä»¿å…è®¸æˆ‘ä»¬ä¼ªé€ ä»£ç æ¥éš”ç¦»æˆ‘ä»¬æ­£åœ¨æµ‹è¯•çš„ä¸œè¥¿ã€‚

ä½†æ˜¯ä¸ºä»€ä¹ˆä½ åœ¨æµ‹è¯•ä¸­éœ€è¦æ¨¡æ‹Ÿå‘¢ï¼Ÿå› ä¸ºåœ¨ç°å®ä¸–ç•Œçš„åº”ç”¨ä¸­ï¼Œä½ **ä¾èµ–**å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹ APIã€åº“ã€å…¶ä»–ç»„ä»¶ç­‰ç­‰ã€‚ç„¶è€Œï¼Œä½ é€šå¸¸ä¸æƒ³æµ‹è¯•ä½ çš„ä»£ç ä¾èµ–äºä»€ä¹ˆï¼Œå¯¹å—ï¼Ÿæ‚¨å¯ä»¥æ”¾å¿ƒåœ°å‡è®¾æ‚¨çš„ä»£ç ä½¿ç”¨çš„åŠŸèƒ½è¿è¡Œè‰¯å¥½ã€‚è®©æˆ‘ä»¬ä¸¾ä¸¤ä¸ªä¾‹å­æ¥è¯´æ˜æ¨¡æ‹Ÿçš„é‡è¦æ€§:

1.  æ‚¨æƒ³è¦æµ‹è¯•ä¸€ä¸ª`TodoList`ç»„ä»¶ï¼Œå®ƒä»æœåŠ¡å™¨è·å–æ‚¨çš„å¾…åŠäº‹é¡¹å¹¶æ˜¾ç¤ºå®ƒä»¬ã€‚é—®é¢˜:æ‚¨éœ€è¦è¿è¡ŒæœåŠ¡å™¨æ¥è·å–å®ƒä»¬ã€‚å¦‚æœä½ è¿™æ ·åšï¼Œä½ çš„æµ‹è¯•å°†ä¼šå˜å¾—æ—¢æ…¢åˆå¤æ‚ã€‚
2.  ä½ æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œå½“ç‚¹å‡»å®ƒæ—¶ï¼Œä»åä¸ªå›¾åƒä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå›¾åƒã€‚é—®é¢˜:ä½ äº‹å…ˆä¸çŸ¥é“è¦é€‰æ‹©å“ªä¸ªå›¾åƒã€‚ä½ èƒ½åšçš„æœ€å¥½çš„äº‹æƒ…å°±æ˜¯ç¡®ä¿æ‰€é€‰æ‹©çš„å›¾åƒæ˜¯åä¸ªå›¾åƒä¸­çš„ä¸€ä¸ªã€‚å› æ­¤ï¼Œä½ éœ€è¦ä½ çš„æµ‹è¯•æ˜¯ç¡®å®šæ€§çš„ã€‚ä½ éœ€è¦æå‰çŸ¥é“ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ä½ çŒœå¯¹äº†ï¼Œæ¨¡ä»¿å¯ä»¥åšåˆ°ã€‚

### æ¨¡æ‹ŸåŠŸèƒ½

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡½æ•°è½»æ¾åˆ›å»ºæ¨¡æ‹Ÿ:

```
jest.fn(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

çœ‹èµ·æ¥ä¸æ˜¯è¿™æ ·ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½çœŸçš„å¾ˆå¼ºå¤§ã€‚å®ƒæ‹¥æœ‰ä¸€ä¸ª`mock`å±æ€§ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿè·Ÿè¸ªå‡½æ•°è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡ï¼Œå“ªäº›å‚æ•°ï¼Œè¿”å›å€¼ç­‰ç­‰ã€‚

```
const foo = jest.fn();
foo();
foo("bar");
console.log("foo", foo); // foo Æ’ (){return e.apply(this,arguments)}
console.log("foo mock property", foo.mock); // Object {calls: Array[2], instances: Array[2], invocationCallOrder: Array[2], results: Array[2]}
console.log("foo calls", foo.mock.calls); // [Array[0], Array[1]] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å› ä¸º`foo`è¢«è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œ`calls`æœ‰ä¸¤ä¸ªé¡¹ç›®ä»£è¡¨åœ¨ä¸¤ä¸ªå‡½æ•°è°ƒç”¨ä¸­ä¼ é€’çš„å‚æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ–­è¨€ä¼ é€’ç»™å‡½æ•°çš„æ˜¯ä»€ä¹ˆ:

```
const foo = jest.fn();
foo("bar");

expect(foo.mock.calls[0][0]).toBe("bar"); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç¼–å†™è¿™æ ·çš„æ–­è¨€æœ‰ç‚¹ä¹å‘³ã€‚å¯¹æˆ‘ä»¬æ¥è¯´å¹¸è¿çš„æ˜¯ï¼ŒJest æä¾›äº†æœ‰ç”¨çš„åŒ¹é…å™¨ï¼Œå¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿæ–­è¨€ï¼Œå¦‚`toHaveBeenCalled`ã€`toHaveBeenCalledWith`ã€`toHaveBeenCalledTimes`å’Œ[ã€](https://jestjs.io/docs/en/expect#tohavebeencalled) :

```
const hello = jest.fn();
hello("world");
expect(hello).toHaveBeenCalledWith("world");

const foo = jest.fn();
foo("bar");
foo("hello");
expect(foo).toHaveBeenCalledTimes(2);
expect(foo).toHaveBeenNthCalledWith(1, "bar");
expect(foo).toHaveBeenNthCalledWith(2, "hello");
// OR
expect(foo).toHaveBeenLastCalledWith("hello"); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªçœŸå®ä¸–ç•Œçš„ä¾‹å­:å¤šæ­¥è¡¨å•ã€‚åœ¨æ¯ä¸€æ­¥ï¼Œä½ éƒ½æœ‰è¡¨å•è¾“å…¥å’Œä¸¤ä¸ªæŒ‰é’®:*ä¸Šä¸€ä¸ª*å’Œ*ä¸‹ä¸€ä¸ª*ã€‚ç‚¹å‡»ä¸Šä¸€æ­¥æˆ–ä¸‹ä¸€æ­¥ä¼šè§¦å‘ä¸€ä¸ª`saveStepData(nextOrPreviousFn)`å‡½æ•°ï¼Œå®ƒä¼šä¿å­˜æ‚¨çš„æ•°æ®å¹¶æ‰§è¡Œ`nextOrPreviousFn`å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šå°†æ‚¨é‡å®šå‘åˆ°ä¸Šä¸€æ­¥æˆ–ä¸‹ä¸€æ­¥ã€‚

å‡è®¾æ‚¨æƒ³è¦æµ‹è¯•`saveStepData`å‡½æ•°ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œä½ ä¸éœ€è¦å…³å¿ƒ`nextOrPreviousFn`åŠå…¶å®ç°ã€‚ä½ åªæ˜¯æƒ³çŸ¥é“å®ƒåœ¨ä¿å­˜åæ˜¯å¦è¢«æ­£ç¡®è°ƒç”¨ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿå‡½æ•°æ¥å®ç°è¿™ä¸€ç‚¹ã€‚è¿™ä¸ªæœ‰ç”¨çš„æŠ€å·§å«åš [**ä¾èµ–æ³¨å…¥**](https://en.wikipedia.org/wiki/Dependency_injection) :

```
function saveStepData(nextOrPreviousFn) {
  // Saving data...
  nextOrPreviousFn();
}

const nextOrPreviousMock = jest.fn();
saveStepData(nextOrPreviousMock);
expect(nextOrPreviousMock).toHaveBeenCalled(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•åˆ›å»º mocks ä»¥åŠå®ƒä»¬æ˜¯å¦è¢«è°ƒç”¨ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦æ”¹å˜å‡½æ•°çš„å®ç°æˆ–è€…ä¿®æ”¹è¿”å›å€¼æ¥ä½¿æˆ‘ä»¬çš„æµ‹è¯•å…·æœ‰ç¡®å®šæ€§å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‡½æ•°åšåˆ°è¿™ä¸€ç‚¹:

```
jest.fn().mockImplementation(implementation);
// Or with the shorthand
jest.fn(implementation); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é©¬ä¸Šæ¥è¯•è¯•å§:

```
const foo = jest.fn().mockImplementation(() => "bar");
const bar = foo();

expect(foo.mock.results[0].value).toBe("bar");
// or
expect(foo).toHaveReturnedWith("bar");
// or
expect(bar).toBe("bar"); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿ`foo`å‡½æ•°çš„è¿”å›å€¼ã€‚å› æ­¤ï¼Œå˜é‡`bar`ä¿å­˜äº†`"bar"`å­—ç¬¦ä¸²ã€‚

**æ³¨æ„**:ä¹Ÿå¯ä»¥ä½¿ç”¨`mockResolvedValue`æˆ–`mockRejectedValue`æ¨¡æ‹Ÿå¼‚æ­¥å‡½æ•°ï¼Œåˆ†åˆ«è§£å†³æˆ–æ‹’ç»[æ‰¿è¯º](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)ã€‚

### æ¨¡æ‹Ÿæ¨¡å—

å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡ä»¿å‡½æ•°ã€‚ä½†æ˜¯ä½ å¯èƒ½ä¼šæƒ³ï¼Œæ¨¡å—å‘¢ï¼Ÿå®ƒä»¬ä¹Ÿå¾ˆé‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬å‡ ä¹åœ¨æ¯ä¸ªç»„ä»¶ä¸­éƒ½å¯¼å…¥äº†å®ƒä»¬ï¼åˆ«æ‹…å¿ƒï¼ŒJest ä¼šè®©ä½ å…¨èº«è¦†ç›–`jest.mock`ã€‚

ä½¿ç”¨å®ƒéå¸¸ç®€å•ã€‚åªè¦ç»™å®ƒä½ æƒ³è¦å˜²è®½çš„æ¨¡å—çš„è·¯å¾„ï¼Œç„¶åä¸€åˆ‡éƒ½*è‡ªåŠ¨*å˜²è®½äº†ã€‚

ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬ä»¥æœ€æµè¡Œçš„ HTTP å®¢æˆ·ç«¯ä¹‹ä¸€ [axios](https://github.com/axios/axios) ä¸ºä¾‹ã€‚äº‹å®ä¸Šï¼Œæ‚¨ä¸å¸Œæœ›åœ¨æµ‹è¯•ä¸­æ‰§è¡Œå®é™…çš„ç½‘ç»œè¯·æ±‚ï¼Œå› ä¸ºå®ƒä»¬ä¼šå˜å¾—éå¸¸æ…¢ã€‚é‚£å°±æ¥å˜²è®½ä¸€ä¸‹`axios`å§:

```
import axiosMock from "axios";

jest.mock("axios");
console.log(axiosMock); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨æ„**:å‡ºäºå¯è¯»æ€§çš„è€ƒè™‘ï¼Œæˆ‘å°†æ¨¡å—å‘½åä¸º`axiosMock`ï¼Œè€Œä¸æ˜¯`axios`ã€‚æˆ‘æƒ³æ¾„æ¸…ä¸€ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿï¼Œè€Œä¸æ˜¯çœŸæ­£çš„æ¨¡å—ã€‚å¯è¯»æ€§è¶Šå¼ºè¶Šå¥½ï¼

éšç€`jest.mock`çš„å‡ºç°ï¼Œ`get`ã€`post`ç­‰ä¸åŒçš„`axios`åŠŸèƒ½ç°åœ¨éƒ½è¢«æ¨¡æ‹Ÿäº†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶`axios`å‘é€ç»™æˆ‘ä»¬çš„å†…å®¹:

```
import axiosMock from "axios";

async function getUsers() {
  try {
    // this would typically be axios instead of axiosMock in your app
    const response = await axiosMock.get("/users");
    return response.data.users;
  } catch (e) {
    throw new Error("Oops. Something wrong happened");
  }
}

jest.mock("axios");

const fakeUsers = ["John", "Emma", "Tom"];
axiosMock.get.mockResolvedValue({ data: { users: fakeUsers } });

test("gets the users", async () => {
  const users = await getUsers();
  expect(users).toEqual(fakeUsers);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Jest çš„å¦ä¸€å¤§ç‰¹ç‚¹æ˜¯å…±äº«å˜²ç¬‘ã€‚äº‹å®ä¸Šï¼Œå¦‚æœæ‚¨è¦é‡ç”¨ä¸Šé¢çš„ axios æ¨¡æ‹Ÿå®ç°ï¼Œæ‚¨å¯ä»¥åœ¨`node_modules`æ–‡ä»¶å¤¹æ—è¾¹åˆ›å»ºä¸€ä¸ª`__mocks__`æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª`axios.js`æ–‡ä»¶:

```
module.exports = {
  get: () => {
    return Promise.resolve({ data: { users: ["John", "Emma", "Tom"] } });
  },
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶ååœ¨æµ‹è¯•:

```
import axiosMock from "axios"

// Note that we still have to call jest.mock!
jest.mock("axios")

async function getUsers() {
  try {
    const response = await axios.get("/users")
    return response.data.users
  } catch (e) {
    throw new Error("Oops. Something wrong happened")
  }
}

test("gets the users", async () => {
  const users = await getUsers()
  expect(users.toEqual(["John", "Emma", "Tom"]))
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## é…ç½®ç¬‘è¯

å¹¶ä¸æ˜¯å› ä¸º Jest å¼€ç®±å°±ä¸èƒ½é…ç½®ï¼Œè¿œéå¦‚æ­¤ï¼Jest æœ‰å¾ˆå¤š[é…ç½®é€‰é¡¹ã€‚æ‚¨å¯ä»¥ç”¨ä¸‰ç§ä¸åŒçš„æ–¹å¼é…ç½® Jest:](https://jestjs.io/docs/en/configuration)

1.  é€šè¿‡`package.json`ä¸­çš„`jest`é”®(å¦‚æœä½ [è¯»è¿‡æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« ](https://thomaslombart.com/setup-eslint-prettier-react/)ï¼Œåˆ™ä¸`eslintConfig`æˆ–`prettier`é”®ç›¸åŒ)
2.  é€šè¿‡`jest.config.js`
3.  ä½¿ç”¨`jest --config`é€šè¿‡ä»»ä½•`json`æˆ–`js`æ–‡ä»¶ã€‚

å¤§å¤šæ•°æ—¶å€™ï¼Œä½ ä¼šç”¨åˆ°ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä¸º React åº”ç”¨ç¨‹åºé…ç½® Jestï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨ [Create React åº”ç”¨ç¨‹åº](https://github.com/facebook/create-react-app) (CRA)

äº‹å®ä¸Šï¼Œå¦‚æœæ‚¨ä¸ä½¿ç”¨ CRAï¼Œæ‚¨å°†ä¸å¾—ä¸ç¼–å†™è‡ªå·±çš„é…ç½®ã€‚å› ä¸ºå®ƒåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¸å»ºç«‹ä¸€ä¸ª React åº”ç”¨ç¨‹åºæœ‰å…³( [Babel](https://babeljs.io/) ã€ [Webpack](https://webpack.js.org/) ç­‰)ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œå°±ä¸åšä»‹ç»äº†ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç›´æ¥æ¥è‡ª Jest docs çš„[é“¾æ¥](https://jestjs.io/docs/en/tutorial-react#setup-without-create-react-app)ï¼Œè§£é‡Šäº†æ²¡æœ‰ CRA çš„è®¾ç½®ã€‚

å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ CRAï¼Œä½ ä»€ä¹ˆä¹Ÿä¸ç”¨åšï¼ŒJest å·²ç»è®¾ç½®å¥½äº†(å°½ç®¡æœ‰å¯èƒ½è¦†ç›–ç‰¹å®šé”®çš„é…ç½®)ã€‚

ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯å› ä¸º CRA ä¸ºä½ è®¾ç½®äº†ä¸€ä¸ªç©ç¬‘ï¼Œä½ å°±ä¸åº”è¯¥çŸ¥é“å¦‚ä½•è®¾ç½®å®ƒã€‚å› æ­¤ï¼Œæ‚¨ä¼šå‘ç°ä¸‹é¢çš„ Jest é…ç½®é”®æ˜¯æ‚¨å°†æ¥å¯èƒ½ä¼šç”¨åˆ°æˆ–çœ‹åˆ°çš„ã€‚ä½ è¿˜ä¼šçœ‹åˆ° CRA æ˜¯å¦‚ä½•ä½¿ç”¨å®ƒä»¬çš„ã€‚

### åŒ¹é…æµ‹è¯•æ–‡ä»¶

å€ŸåŠ©äº`testMatch`é”®ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ªå…¨å±€æ¨¡å¼æ¥å‘Šè¯‰ Jest è¿è¡Œå“ªäº›æµ‹è¯•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCRA ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹:

```
{  "testMatch":  [  "<rootDir>/src/**/__tests__/**/*.{js,jsx,ts,tsx}",  "<rootDir>/src/**/*.{spec,test}.{js,jsx,ts,tsx}"  ]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ç§æ¨¡å¼æ„å‘³ç€ Jest å°†å¯¹ä½äº`src`çš„`.js`ã€`jsx`ã€`ts`å’Œ`tsx`æ–‡ä»¶è¿è¡Œæµ‹è¯•ï¼Œè¿™äº›æ–‡ä»¶è¦ä¹ˆåœ¨`__tests__`æ–‡ä»¶å¤¹ä¸­ï¼Œè¦ä¹ˆæ‰©å±•åä»¥`spec`æˆ–`test`ä¸ºå‰ç¼€ã€‚

ä¾‹å¦‚ï¼Œè¿™äº›æµ‹è¯•æ–‡ä»¶å°†åŒ¹é…:

*   âœ… `src/example.spec.js`
*   âœ… `src/__tests__/Login.jsx`
*   âœ… `src/__tests__/calculator.ts`
*   âœ… `src/another-example.test.js`

ä½†æ˜¯è¿™äº›ä¸åŒ¹é…:

*   âŒ `src/Register.jsx`
*   âŒ `src/__tests__/style.css`

### æ¯æ¬¡æµ‹è¯•å‰è®¾ç½®

Jest æœ‰ä¸€ä¸ªåä¸º`setupFilesAfterEnv`çš„é”®ï¼Œå®ƒå°±æ˜¯æ¯æ¬¡æµ‹è¯•è¿è¡Œä¹‹å‰è¦è¿è¡Œçš„æ–‡ä»¶åˆ—è¡¨ã€‚è¿™å°±æ˜¯ä½ æƒ³è¦é…ç½®ä½ çš„æµ‹è¯•æ¡†æ¶çš„åœ°æ–¹(æ¯”å¦‚[ååº”æµ‹è¯•åº“](https://testing-library.com/docs/react-testing-library/setup#skipping-auto-cleanup)æˆ–è€…[é…¶](https://airbnb.io/enzyme/docs/installation/react-16.html)æˆ–è€…åˆ›å»º[å…¨å±€æ¨¡æ‹Ÿ](https://create-react-app.dev/docs/running-tests#src-setuptestsjs-1))ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒCRA å°†è¿™ä¸ªæ–‡ä»¶å‘½åä¸º`src/setupTests.js`ã€‚

### é…ç½®æµ‹è¯•è¦†ç›–

æ­£å¦‚ Jest CLI è¯¾ç¨‹ä¸­æ‰€è¯´ï¼Œä½¿ç”¨`--coverage`é€‰é¡¹ï¼Œæ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°çœ‹åˆ°æ‚¨çš„ä»£ç è¦†ç›–ç‡ã€‚ä¹Ÿå¯ä»¥é…ç½®å®ƒã€‚

å‡è®¾æ‚¨å¸Œæœ›(æˆ–ä¸å¸Œæœ›)è¦†ç›–ç‰¹å®šçš„æ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨`collectCoverageFrom`é”®ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒCRA æƒ³è¦è¦†ç›–ä½äº`src`æ–‡ä»¶å¤¹ä¸­çš„ JavaScript æˆ– TypeScript æ–‡ä»¶çš„ä»£ç ï¼Œè€Œä¸æƒ³è¦†ç›–`.d.ts`(æ‰“å­—)æ–‡ä»¶:

```
{  "collectCoverageFrom":  ["src/**/*.{js,jsx,ts,tsx}",  "!src/**/*.d.ts"]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨æ„¿æ„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`coverageThreshold`é”®æŒ‡å®šè¦†ç›–èŒƒå›´é˜ˆå€¼ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœåˆ†æ”¯ã€è¡Œã€å‡½æ•°å’Œè¯­å¥è¦†ç›–ç‡å°äº 75%ï¼Œè¿è¡Œ`jest --coverage`å°†ä¼šå¤±è´¥:

```
{  "coverageThreshold":  {  "global":  {  "branches":  75,  "functions":  75,  "lines":  75,  "statements":  75  }  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### å˜æ¢

å¦‚æœæ‚¨ä½¿ç”¨ JavaScript æˆ– TypeScript çš„æœ€æ–°åŠŸèƒ½ï¼ŒJest å¯èƒ½æ— æ³•æ­£å¸¸è¿è¡Œæ‚¨çš„æ–‡ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦åœ¨å®ƒä»¬å®é™…è¿è¡Œä¹‹å‰å¯¹å®ƒä»¬è¿›è¡Œè½¬æ¢ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`transform`é”®ï¼Œå®ƒå°†æ­£åˆ™è¡¨è¾¾å¼æ˜ å°„åˆ° transformers è·¯å¾„ã€‚ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼ŒCRA å¯¹ JS/TS æ–‡ä»¶ä½¿ç”¨äº†[babel-jest](https://github.com/facebook/jest/tree/master/packages/babel-jest):

```
{  "transform":  {  "^.+\\.(js|jsx|ts|tsx)$":  "babel-jest"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­£å¦‚å¼€å§‹æ‰€è¯´ï¼ŒJest æœ‰æ›´å¤šçš„é…ç½®é€‰é¡¹ã€‚å¥½å¥‡çœ‹çœ‹[ä»–ä»¬çš„æ–‡æ¡£](https://jestjs.io/docs/en/configuration#options)ï¼