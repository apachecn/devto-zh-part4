# è§£é‡Šäº†æœåŠ¡å·¥ä½œè€…å’Œç¼“å­˜ç­–ç•¥

> åŸæ–‡:[https://dev . to/PaCO _ ita/service-workers-and-caching-strategies-explained-step-3-m4f](https://dev.to/paco_ita/service-workers-and-caching-strategies-explained-step-3-m4f)

è¿™ä¸€é›†å°†æ¶µç›– PWAs çš„å…¶ä»–é‡è¦ä¸»é¢˜:**æœåŠ¡äººå‘˜** (SW)å’Œ**ç¼“å­˜ç­–ç•¥**ï¼Œæˆ‘ä»¬å¯ä»¥å®æ–½è¿™äº›ç­–ç•¥æ¥è¿›ä¸€æ­¥å‘æŒ¥ PWAs çš„å…¨éƒ¨æ½œåŠ›ã€‚

[![excited](../Images/827f15ccdc47f9b07910f9a9b8db8dbf.png)T2ã€‘](https://i.giphy.com/media/yoJC2GnSClbPOkV0eA/giphy.gif)

æ¿€åŠ¨å—ï¼Ÿå¼€å§‹å§ï¼

## [](#what-is-a-service-worker)ä»€ä¹ˆæ˜¯æœåŠ¡äººå‘˜ï¼Ÿ

SW ç±»ä¼¼äº web workerï¼Œéƒ½æ˜¯ç®€å•çš„ javascript æ–‡ä»¶ã€‚web worker æ²¡æœ‰ç‰¹å®šçš„ä»»åŠ¡ï¼Œå®ƒé€šå¸¸ç”¨äºå¸è½½ä¸»çº¿ç¨‹(ä¸» web åº”ç”¨ç¨‹åºæ­£åœ¨å…¶ä¸Šè¿è¡Œ)ã€‚

å¦ä¸€æ–¹é¢ï¼ŒæœåŠ¡å·¥ä½œè€…æœ‰ä¸€ä¸ªç‰¹å®šçš„ä»»åŠ¡ï¼Œå®ƒå……å½“æˆ‘ä»¬çš„ web åº”ç”¨ç¨‹åºå’Œç½‘ç»œä¹‹é—´çš„ä»£ç†ã€‚å®ƒå¯ä»¥æ‹¦æˆª http è¯·æ±‚ï¼Œå¹¶æ ¹æ®æˆ‘ä»¬å®ç°çš„ç¼“å­˜ç­–ç•¥(ç¨åå°†è¯¦ç»†ä»‹ç»)ï¼Œä»ç½‘ç»œæˆ–æœ¬åœ°ç¼“å­˜æä¾›å“åº”ã€‚

è®©æˆ‘ä»¬åˆ—å‡ºä¸€äº›è½¯ä»¶ç‰¹å¾:

### [](#secure)å®‰å…¨

æœåŠ¡äººå‘˜å°†**ä»…åœ¨ HTTPs è¿æ¥**ä¸Šè¿è¡Œã€‚

è¿™æ˜¯ä¸€ä¸ªå®‰å…¨çš„å†³å®šï¼Œå› ä¸ºå¦åˆ™æˆ‘ä»¬å¾ˆå®¹æ˜“å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæš´éœ²ç»™`man-in-the-middle`æ”»å‡»ã€‚è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæœ‰äººå¯ä»¥ç”¨ä¸€ä¸ªè¢«æ“çºµçš„ SW æ¥ä»£æ›¿æˆ‘ä»¬çš„ SWï¼Œä¼šå‘ç”Ÿä»€ä¹ˆ...å¾ˆå¯æ€•ï¼Œä¸æ˜¯å—ï¼Ÿ

[![scared](../Images/106820190c24b86feda71bfbd22f2ee9.png)T2ã€‘](https://i.giphy.com/media/bEVKYB487Lqxy/giphy.gif)

å¦ä¸€æ–¹é¢ï¼Œlocalhost è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œå…è®¸åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚
å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Angularï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨`ng serve`å‘½ä»¤åœ¨æœ¬åœ°æ„å»ºå’ŒæœåŠ¡æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå› ä¸ºå®ƒä¸æ”¯æŒæœåŠ¡äººå‘˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨è‡ªå·±é€‰æ‹©çš„ HTTP æœåŠ¡å™¨ï¼Œä¾‹å¦‚ [http-server](https://www.npmjs.com/package/http-server) åŒ…æˆ– [Web æœåŠ¡å™¨](https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb?hl=en) Chrome æ‰©å±•ã€‚

### [](#no-direct-dom-interaction)æ²¡æœ‰ç›´æ¥ DOM äº¤äº’

æœåŠ¡äººå‘˜ä¸èƒ½ç›´æ¥è®¿é—® DOMã€‚ç„¶è€Œï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡`postMessage`æ¥å£ä¸å®ƒä»¬èŒƒå›´å†…çš„é¡µé¢è¿›è¡Œé€šä¿¡ã€‚ç„¶åï¼Œè¿™äº›é¡µé¢å¯ä»¥æ“çºµ DOMï¼Œä»è€Œå…è®¸é—´æ¥è®¿é—®ã€‚

### [](#non-blocking)æ— é˜»å¡

SW è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸Šï¼Œç‹¬ç«‹äºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨çš„çº¿ç¨‹ã€‚ç”±æ­¤å®šä¹‰â€œæ— é˜»å¡â€ã€‚çš„ç¡®ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›é«˜è´Ÿè½½æ“ä½œæˆ–å´©æºƒä»¥ä»»ä½•æ–¹å¼å½±å“æˆ‘ä»¬ web åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚

åœ¨åå°è¿è¡Œçš„èƒ½åŠ›ä¹Ÿæ˜¯æˆ‘ä»¬å¯ä»¥å‘ç”¨æˆ·æ˜¾ç¤ºæ¨é€é€šçŸ¥çš„åŸå› ï¼Œå³ä½¿ä»–ä»¬æ²¡æœ‰ä¸»åŠ¨è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ã€‚

## [](#life-cycle)ç”Ÿå‘½å‘¨æœŸ

```
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/serviceWorker.js')
      .then(function(registration) { 
         // The registration was successful 
      })
      .catch(function(err) {
         // The registration failed
      });
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­£å¦‚æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æµè§ˆå™¨éƒ½æ”¯æŒè½¯ä»¶ã€‚å› æ­¤ï¼Œå½“ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹¶åŠ è½½é¡µé¢æ—¶ï¼Œåœ¨å°è¯•æ³¨å†Œè½¯ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ£€æŸ¥æœåŠ¡å·¥ä½œè€… API æ˜¯å¦å¯ç”¨ã€‚

[![sw-lifecycle](../Images/98961f00a284c43c57f837314c093d6a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--aWxZgF59--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8yii6mhho9qjm9vuiwza.png)

ä¸Šé¢çš„æ¨¡å¼æè¿°äº†æœåŠ¡äººå‘˜çš„ä¸åŒç”Ÿå‘½å‘¨æœŸæ­¥éª¤ã€‚
åœ¨æ³¨å†Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°é”™è¯¯æˆ–æ— æ³•è·å–è½¯ä»¶æ–‡ä»¶ï¼Œæ•´ä¸ªæ“ä½œå°†è¢«å–æ¶ˆã€‚
å½“ç”¨æˆ·å†æ¬¡åŠ è½½é¡µé¢æ—¶ï¼Œ`register`æ–¹æ³•å°†è¢«é‡æ–°è§¦å‘ã€‚æµè§ˆå™¨èƒ½å¤Ÿè¯†åˆ«è½¯ä»¶æ˜¯å¦å·²ç»å®‰è£…ï¼Œå¹¶ç›¸åº”åœ°è°ƒç”¨æ–¹æ³•ã€‚

ä¸€æ—¦æ³¨å†Œï¼Œä¸€ä¸ªè½¯ä»¶ä¸ä¼šä¸€ç›´ä¿æŒæ¿€æ´»çŠ¶æ€ã€‚å½“äº‹ä»¶éœ€è¦è¢«è§¦å‘æ—¶ï¼Œæµè§ˆå™¨å¯ä»¥ä¸å¯é¢„æµ‹åœ°ç»ˆæ­¢å®ƒå¹¶é‡æ–°æ¿€æ´»å®ƒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŒä¹…åŒ–æœåŠ¡å·¥ä½œè€…å†…éƒ¨ä½¿ç”¨çš„çŠ¶æ€(æˆ‘è¿™é‡Œä¸æ˜¯æŒ‡ç¼“å­˜èµ„äº§æˆ– API è¯·æ±‚)ï¼Œæˆ‘ä»¬åº”è¯¥æ›´å¥½åœ°ä½¿ç”¨ IndexeDB æˆ–ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆã€‚

åœ¨`install`æ­¥éª¤ä¸­ï¼Œé€šå¸¸æ‰§è¡Œå®Œç¾æ“ä½œã€‚ä»–ä»¬çš„ç›®æ ‡æ˜¯ç¡®ä¿ä¸‹è½½ç›®æ ‡èµ„äº§ï¼Œå¹¶ä½¿å…¶åœ¨è½¯ä»¶çš„ç¼“å­˜ä¸­å¯ç”¨ã€‚è¿™äº›èµ„äº§é€šå¸¸æ˜¯é™æ€æ–‡ä»¶(å¦‚ jsã€css ),ä»£è¡¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒå¤–å£³ï¼Œæœ€å°çš„æ–‡ä»¶å’Œæ ·å¼ï¼Œå³ä½¿åœ¨ç¦»çº¿æ—¶ä¹Ÿåº”è¯¥ç«‹å³å¯¹ç”¨æˆ·å¯ç”¨ã€‚

âš ï¸ï¼Œæˆ‘ä»¬å¿…é¡»æ„è¯†åˆ°ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µä¸è¦éšè—å¤ªå¤šçš„èµ„äº§ã€‚äº‹å®ä¸Šï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯æˆ–è½¯ä»¶æ— æ³•ç¼“å­˜æ‰€æœ‰æŒ‡å®šçš„èµ„æºï¼Œé‚£ä¹ˆæ•´ä¸ªå®‰è£…é˜¶æ®µå°†è¢«ä¸­æ­¢ï¼Œè½¯ä»¶å°†ä¸ä¼šåœ¨å®¢æˆ·ç«¯è¢«æ¿€æ´»ã€‚ä¸€æ—¦ç”¨æˆ·æ–°è®¿é—®æˆ–é‡æ–°åŠ è½½ç½‘é¡µï¼Œå®‰è£…æ­¥éª¤å°†è¢«å†æ¬¡è§¦å‘ã€‚

è¯¥æ­¥éª¤ä»…åœ¨è½¯ä»¶ç”Ÿå‘½å‘¨æœŸå¼€å§‹æ—¶æˆ–æœåŠ¡å™¨ä¸Šæœ‰æ–°ç‰ˆæœ¬æ—¶å‘ç”Ÿã€‚

```
var urlsToCache = [
  '/',
  '/styles/styles.css',
  '/script/home.js'
];

self.addEventListener('install', function(event) {
  event.waitUntil(
    caches.open('my-cache')
      .then(function(cache) {
        return cache.addAll(urlsToCache);
      })
  );
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®‰è£…ç»“æŸåï¼Œè½¯ä»¶è¢«æ¿€æ´»ã€‚ç„¶è€Œï¼Œè½¯ä»¶ä¸ä¼šç«‹å³æ§åˆ¶æˆ‘ä»¬æ³¨å†Œçš„é¡µé¢ã€‚è¿™æ˜¯ä¸ºäº†ä¸é¡µé¢å†…å®¹ä¿æŒä¸€è‡´ã€‚æ ¹æ®æˆ‘ä»¬çš„å®ç°ï¼Œä¸€æ—¦æˆ‘ä»¬ç¬¬äºŒæ¬¡è®¿é—®/é‡æ–°åŠ è½½é¡µé¢ï¼Œæˆ‘ä»¬çš„æœåŠ¡äººå‘˜å°†å®Œå…¨æ§åˆ¶å®ƒï¼Œå¹¶æœ€ç»ˆè·å–æ–°çš„èµ„äº§ã€‚

åœ¨`activate`æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ¸…é™¤æ—§çš„ç¼“å­˜ã€‚æˆ‘ä»¬ä¸èƒ½åœ¨å®‰è£…æ­¥éª¤ä¸­è¿™æ ·åšï¼Œå¦åˆ™ä»ç„¶ä½¿ç”¨æ—§ç¼“å­˜çš„ç°æœ‰æœåŠ¡å·¥ä½œäººå‘˜å°†ä¼šå‡ºç°ä¸å¯é¢„æµ‹çš„è¡Œä¸ºï¼Œå¹¶å¯èƒ½å¯¼è‡´é”™è¯¯ã€‚

ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ˜¾ç¤ºäº†æˆ‘ä»¬å¦‚ä½•åˆ é™¤æ‰€æœ‰æœªåˆ—å…¥ç™½åå•çš„ç¼“å­˜ã€‚

```
self.addEventListener('activate', event => {

var validCaches = ['home-cache-v2', 'articles-cache-v2'];

  event.waitUntil(
    caches.keys().then(keys => 
    Promise.all(keys.map(key => {
        if (validCaches.indexOf(key) === -1) {
          return caches.delete(key);
        }
      })
    )).then(() => {
      // We successfully deleted all the obsolete caches
    })
  );
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­¤æ—¶ï¼Œå¦‚æœæ‚¨æ‰“å¼€ DevToolsï¼Œè®¿é—®`Application`é€‰é¡¹å¡å¹¶å•å‡»`service worker`éƒ¨åˆ†ï¼Œæ‚¨ä¼šå‘ç°åœ¨æˆ‘ä»¬çš„æµè§ˆå™¨ä¸­æ³¨å†Œäº†å¼€å‘è½¯ä»¶(dev.io ):

[![sw-tab](../Images/620e33736948b6d1d2e3e5e7969a2217.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--EIeYDQJU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vw3ehjbqw6vx118jq81p.png)

### [](#updating-a-service-worker)æ›´æ–°æœåŠ¡äººå‘˜

å¦‚æœä¸€ä¸ªæ–°çš„æœåŠ¡å·¥ä½œè€…ç‰ˆæœ¬å¯ç”¨(ä¸€ä¸ªç®€å•çš„å­—èŠ‚å·®å¼‚ä½¿å®ƒæˆä¸ºä¸€ä¸ªæ–°ç‰ˆæœ¬)ï¼Œå®ƒå°†åœ¨ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„ web åº”ç”¨ç¨‹åºæ—¶è¢«ä¸‹è½½å’Œå®‰è£…ã€‚ç„¶è€Œï¼Œæ–°çš„æœåŠ¡äººå‘˜ä¸ä¼šç«‹å³æ›¿æ¢æ—§çš„æœåŠ¡äººå‘˜ï¼Œè€Œæ˜¯ä¿æŒåœ¨å®‰è£…æ­¥éª¤ä¸­ï¼Œ*ç­‰å¾…*è¢«æ¿€æ´»ã€‚

æµè§ˆå™¨ç¡®ä¿å®¢æˆ·ç«¯ä¸Šåªæœ‰ä¸€ä¸ªæ´»åŠ¨çš„æœåŠ¡å·¥ä½œå™¨ç‰ˆæœ¬ã€‚åªæœ‰å½“è¿è¡Œ PWA çš„æ‰€æœ‰é€‰é¡¹å¡éƒ½å…³é—­ï¼Œæˆ–è€…ç”¨æˆ·å¯¼èˆªåˆ°ä¸åŒçš„ URLï¼Œç„¶åè¿”å›åˆ°æˆ‘ä»¬çš„ PWA æ—¶ï¼Œæ–°çš„æœåŠ¡äººå‘˜æ‰æœ€ç»ˆè¢«æ¿€æ´»ã€‚çŸ¥é“è¿™ä¸€ç‚¹å¾ˆå¥½ï¼Œå› ä¸ºç®€å•åœ°åˆ·æ–°é¡µé¢æ˜¯ä¸å¤Ÿçš„ï¼Œè€Œä¸”ç»å¸¸ä¼šå¸¦æ¥æ··ä¹±ã€‚

### [](#unregister-a-service-worker)æ³¨é”€æœåŠ¡äººå‘˜

è¦åˆ é™¤è½¯ä»¶ï¼Œæ‚¨å¯ä»¥ç‚¹å‡»æµè§ˆå™¨å¼€å‘å·¥å…·ä¸­çš„`Unregister`é“¾æ¥ã€‚

*   **Chrome:** ç‚¹å‡» F12 >åº”ç”¨æ ‡ç­¾>æœåŠ¡äººå‘˜éƒ¨åˆ†

[![sw-tab](../Images/620e33736948b6d1d2e3e5e7969a2217.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--EIeYDQJU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vw3ehjbqw6vx118jq81p.png)

*   **ç«ç‹:**åœ°å€æ ä¸­çš„æ•°å­—`about:debugging#workers`:

[![firefox](../Images/e0b4d01bbd8497e44dd079e224aac390.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--qYi7nfEc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kgmj7r8x9sztooauvvl0.png)

æˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡ç¼–ç¨‹:

```
navigator.serviceWorker.getRegistration()
   .then(function(registration) {
       if(registration){
          registration.unregister()
          .then(
               function(success) {
                 // if success = true, unregister was successful
                });
          }
    }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨æ„:**æ³¨é”€è½¯ä»¶ä¸ä¼šé‡Šæ”¾å…¶ç¼“å­˜ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨å¼€å‘å·¥å…·(Chrome)çš„åº”ç”¨ç¨‹åºé¢æ¿ä¸­å•å‡»â€œæ¸…é™¤å­˜å‚¨â€æŒ‰é’®:

[![clear-cache](../Images/30e5e6b8bf854587aa7fadc86da23bf4.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--0vVKmYUL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/2seeb7ec29dutocgrx8q.png)

é€šè¿‡ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`caches.delete()` :

```
if ('caches' in window) {
    caches.keys()
      .then(function(keyList) {
          return Promise.all(keyList.map(function(key) {
              return caches.delete(key);
          }));
      })
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`caches.keys()`æ–¹æ³•è¿”å›`CacheStorage`çš„é”®ï¼Œè¿™ä¸ªæ¥å£ä»£è¡¨æœåŠ¡å·¥ä½œè€…å¯ä»¥è®¿é—®çš„`Cache`å¯¹è±¡çš„å­˜å‚¨ã€‚

## [](#caching-strategies)ç¼“å­˜ç­–ç•¥

æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸åŒçš„ç¼“å­˜ç­–ç•¥æ¥æé«˜é¡¹ç›®çš„æ€§èƒ½ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä¸€ä¸ªæ•°æ®è¯·æ±‚è¢«ç¼“å­˜ï¼Œæˆ‘ä»¬å®Œå…¨ä¸éœ€è¦è®¿é—®ç½‘ç»œå°±å¯ä»¥äº¤ä»˜å®ƒã€‚è¿™å¸¦æ¥äº†ä»¥ä¸‹ä¼˜åŠ¿:ä¸€æ–¹é¢ï¼Œå“åº”å¿«å¾—å¤šï¼Œå¦ä¸€æ–¹é¢ï¼Œå³ä½¿å®¢æˆ·ç«¯ç¦»çº¿ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æä¾›æ•°æ®ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨æœ¬åœ°è·å¾—äº†æ•°æ®ã€‚

ä¸è¿‡ï¼Œåœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£æˆ‘ä»¬éœ€è¦æŒ‡å¯¼è½¯ä»¶å¦‚ä½•ç¼“å­˜æ•°æ®è¯·æ±‚ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šè¿™æ ·åšã€‚

### [](#general-caching-strategies)é€šç”¨ç¼“å­˜ç­–ç•¥

ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ç¼“å­˜ç­–ç•¥ï¼Œä¸ç»‘å®šä»»ä½•æ¡†æ¶ã€‚

#### [](#cache-only)ä»…ç¼“å­˜

[![cache-only](../Images/ed0a278c2824c755318e3dab1606dba8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--yIlYPONk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/nchwiq59u3h0go7qfamm.png)

æ¥æº:è°·æ­Œç½‘ç»œåŸºç¡€æŒ‡å—

```
self.addEventListener('fetch', function(event) {

  event.respondWith(caches.match(event.request));
  // If the requested data isn't in the cache, the response
  // will look like a connection error
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯èƒ½æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªã€‚è½¯ä»¶æœŸæœ›åœ¨è¿™é‡Œæ‰¾åˆ°æ‰€è¯·æ±‚çš„èµ„äº§ã€‚è¿™ç§ç­–ç•¥å¯ä»¥ç”¨äºæ„æˆæˆ‘ä»¬çš„â€œåº”ç”¨ç¨‹åºå¤–å£³â€çš„é™æ€èµ„æºã€‚é€šå¸¸åœ¨è½¯ä»¶å®‰è£…æ—¶è·å–ï¼Œä»¥ä¾¿åœ¨æ­¤é˜¶æ®µååœ¨ç¼“å­˜ä¸­å¯ç”¨ã€‚

#### [](#network-only)ä»…ç½‘ç»œ

[![network-only](../Images/114dd71f7ab52e95c20461d12bb94fd5.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--R9RdwYJe--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5j375yeuto7kc8vz60s4.png)T3ã€‘

```
self.addEventListener('fetch', function(event) {
   // We can put some custom logic here, otherwise
   // the request will follow the default browser behaviour
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªç­–ç•¥ä¸å‰ä¸€ä¸ªæ­£å¥½ç›¸å:æˆ‘ä»¬æ€»æ˜¯è®¿é—®ç½‘ç»œï¼Œç”šè‡³ä¸æŸ¥è¯¢ç¼“å­˜ã€‚è¿™æœ€é€‚åˆäºæ—¥å¿—æˆ–ä»»ä½•æˆ‘ä»¬ä¸éœ€è¦çš„ä¸œè¥¿ï¼Œè®©å®ƒå¯ä»¥è„±æœºä½¿ç”¨ã€‚

#### [](#stale-while-revalidate)é‡æ–°éªŒè¯æ—¶å¤±æ•ˆ

[![stale-revalidate](../Images/bf815f50725f80fd6221a575c0f4e9e4.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--EYWf7DAm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8ia2qwmw9jo3lyb86r80.png)T3ã€‘

```
self.addEventListener('fetch', function(event) {

    event.respondWith(async function() {
        const cache = await caches.open('cache-v1');
        const cachedResponse = await cache.match(event.request);
        const fetchPromise = fetch(event.request);

        event.waitUntil(async function () {
            const networkResponse = await fetchPromise;
            // Update the cache with a newer version
            await cache.put(request, networkResponse.clone());
        }());

        // The response contains cached data, if available
        return cachedResponse || networkResponse;
    }());
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ä»…ç¼“å­˜ç­–ç•¥ç±»ä¼¼ï¼Œç›®æ ‡æ˜¯é€šè¿‡ä»ç¼“å­˜ä¸­ä¼ é€æ•°æ®æ¥ç¡®ä¿å¿«é€Ÿå“åº”ã€‚ç„¶è€Œï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è¢«å¤„ç†æ—¶ï¼Œä¸€ä¸ªå•ç‹¬çš„è¯·æ±‚è¢«è§¦å‘åˆ°æœåŠ¡å™¨ä»¥è·å–ä¸€ä¸ªæ›´æ–°çš„ç‰ˆæœ¬ï¼Œå¦‚æœå¯ç”¨çš„è¯ï¼Œå¹¶å°†å…¶å­˜å‚¨åˆ°ç¼“å­˜ä¸­ã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬åœ¨ä¸€æ–¹é¢ä¿è¯å¿«é€Ÿæ•°æ®äº¤ä»˜çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨å¦ä¸€æ–¹é¢æ›´æ–°ç¼“å­˜çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªè¯·æ±‚å°†æ¥æ”¶åˆ°æ›´çœŸå®çš„ç‰ˆæœ¬ã€‚

### [](#angular-caching-strategies)è§’åº¦ç¼“å­˜ç­–ç•¥

Angular åªæä¾›ä¸¤ç§ç¼“å­˜ç­–ç•¥:

**æ€§èƒ½**(é»˜è®¤)
[![Performance-diagram](../Images/744687828619cf1284def7a94ef37ad1.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--IZWH5Wt_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/aghjzas3ipm724uccuqs.png) 
è¿™é‡Œçš„ç›®æ ‡æ˜¯ä¼˜åŒ–å“åº”æ—¶é—´ã€‚å¦‚æœç¼“å­˜ä¸­æœ‰å¯ç”¨çš„èµ„æºï¼Œåˆ™ä¼ é€’è¯¥ç‰ˆæœ¬ã€‚å¦åˆ™ï¼Œæ‰§è¡Œç½‘ç»œè¯·æ±‚ä»¥è·å–å¹¶ç¼“å­˜å®ƒã€‚
è¿™ç§ç­–ç•¥é€‚ç”¨äºä¸ç»å¸¸æ”¹å˜çš„èµ„æºï¼Œå¦‚ç”¨æˆ·ç®€æ¡£å›¾åƒã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸ºç”¨æˆ·æä¾›æœ€å¿«çš„å“åº”ï¼Œè€Œä¸ç”¨æ‹…å¿ƒäº¤ä»˜å¯èƒ½è¿‡æ—¶çš„æ•°æ®ã€‚

**æ–°é²œåº¦**
[![Freshness-diagram](../Images/e3d66d3dec023550297e3fd847f60e27.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--jZvEvbW_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5aafkz9yt35dwisuaekz.png) 
å½“éœ€è¦ä»ç½‘ç»œä¼ é€’æœ€æ–°æ•°æ®æ—¶ã€‚æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œåœ¨æ­¤ä¹‹åï¼Œè¯·æ±‚ä¼šé€€å›åˆ°ç¼“å­˜ä¸­ï¼Œå¹¶å°è¯•ä»ç¼“å­˜ä¸­ä¼ é€’æ‰€éœ€çš„æ•°æ®ã€‚è¿™ç§ç­–ç•¥çš„ä¸€ä¸ªå…¸å‹åº”ç”¨æ˜¯å½“æˆ‘ä»¬éœ€è¦äº¤ä»˜ç»å¸¸å˜åŒ–çš„æœ€æ–°ä¿¡æ¯æ—¶ã€‚æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ä¸€ä¸ªå¤„ç†è‚¡ç¥¨ä»·æ ¼æˆ–åšå®¢æ–‡ç« çš„åº”ç”¨ç¨‹åºã€‚

å¯¹äºè§’åº¦ç­–ç•¥ï¼Œæˆ‘ä¸ä¼šè¯´å¾—å¤ªè¯¦ç»†ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­çœ‹åˆ°å®ƒä»¬çš„æ›´å¤šç»†èŠ‚ï¼Œæˆ‘ä»¬ä¹Ÿå°†ç¼–å†™ä¸€äº›ä»£ç æ¥å®ç°å®ƒä»¬ã€‚
T2ã€‘

## [](#how-to-get-rid-of-zombie-service-workers)å¦‚ä½•æ‘†è„±â€œåƒµå°¸â€æœåŠ¡äººå‘˜ï¼Ÿ

å¦‚æœæˆ‘ä»¬ä¸å†ä¸æœåŠ¡äººå‘˜åˆä½œï¼Œå¹¶å¸Œæœ›æ‘†è„±å®¢æˆ·ä¸­æ‰€æœ‰æ—§çš„ã€å·²å®‰è£…çš„æœåŠ¡äººå‘˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•:

1 -åˆ é™¤æˆ‘ä»¬åœ¨æ–°åº”ç”¨ä¸­æ³¨å†Œè½¯ä»¶çš„ä»£ç (å› æ­¤ä¸ä¼šæ³¨å†Œæ–°è½¯ä»¶)

2 -ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢(æ—§çš„)è½¯ä»¶æ–‡ä»¶å†…å®¹:

```
caches.keys()
    .then(keys =>
        Promise.all(keys.map(async key => await caches.delete(key)))
    .then(async () => await registration.unregister())
    .catch((err) => console.error('Something went wrong: ', err)); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†äº§ç”Ÿä¸¤ä¸ªå½±å“:

1-å½“æ–°å®¢æˆ·åŠ è½½æˆ‘ä»¬çš„ PWA æ—¶ï¼Œä¸ä¼šå®‰è£…æ–°è½¯ä»¶

2 -å·²å®‰è£…è½¯ä»¶çš„å®¢æˆ·ç«¯å°†åœ¨å†æ¬¡åŠ è½½åº”ç”¨ç¨‹åºåä¸‹è½½æ–°è½¯ä»¶ã€‚å¦åˆ™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ£€æŸ¥(è‡ªä¸Šæ¬¡æ£€æŸ¥èµ·æœ€å¤š 24 å°æ—¶å)æ˜¯å¦æœ‰æ–°çš„è½¯ä»¶ç‰ˆæœ¬ï¼Œå¹¶ç”¨æ–°çš„è½¯ä»¶ä»£ç æ›¿æ¢æ—§çš„è½¯ä»¶ä»£ç ã€‚

åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ–°ä»£ç å°†åˆ é™¤ç¼“å­˜å¹¶å¸è½½å½“å‰è½¯ä»¶ã€‚

## [](#how-much-data-can-we-store)æˆ‘ä»¬å¯ä»¥å­˜å‚¨å¤šå°‘æ•°æ®ï¼Ÿ

åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå¯ç”¨çš„æ•°é‡éƒ½ä¸ç›¸åŒï¼Œä½†æ ¹æ®è®¾å¤‡å’Œå­˜å‚¨æ¡ä»¶çš„ä¸åŒï¼Œæ¯ä¸ªæµè§ˆå™¨çš„å¯ç”¨æ•°é‡ä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚

[![cache-quota](../Images/2225733ad1c85b45c9c4c92d7003e84e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--HXTjk2fC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kj5a5b9pdfkp708vrj26.png)

Chrome å’Œ Opera åŸºäºæ¯ä¸ªæº(æˆ‘ä»¬çš„ç«™ç‚¹åŸŸ)çš„å¯ç”¨å­˜å‚¨ã€‚è¦éªŒè¯å‰©ä½™ç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [`Quota Management API`](https://developer.mozilla.org/en-US/docs/Web/API/StorageQuota) :

```
navigator.storageQuota.queryInfo("temporary")
  .then(function(info) {
     console.log(info.quota);
     // It gives us the quota in bytes

     console.log(info.usage);
     // It gives us the used data in bytes
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“è¾¾åˆ°ç‰¹å®šé˜ˆå€¼æ—¶ï¼Œä¸€äº›æµè§ˆå™¨å¼€å§‹æç¤ºç”¨æˆ·æ˜¯å¦åŒæ„ç»§ç»­å­˜å‚¨æ›´å¤šæ•°æ®ã€‚

*   å­˜å‚¨ 50MB æ•°æ®åçš„ Firefox
*   Safari mobile æœ€å¤šåªèƒ½ä½¿ç”¨ 50MB
*   Safari desktop æ²¡æœ‰å‚¨å­˜ç©ºé—´é™åˆ¶(ğŸ˜³)ï¼Œä½†åœ¨å­˜å‚¨ 5MB åå¼€å§‹è¯·æ±‚ç¡®è®¤ã€‚

è¿™äº›æœ€åˆçš„èŒä½ä¾§é‡äºå…¬å…±è‰¾æ»‹ç—…çš„ç†è®ºåŸºç¡€ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« å°†å‘æˆ‘ä»¬å±•ç¤ºåˆ›å»º pwa å·¥å…·ã€‚
æ­¤å¤–ï¼Œæˆ‘ä»¬å°†ä¸ Angular åˆ›å»ºä¸€ä¸ªæ¼”ç¤ºï¼Œæˆ‘ä¼šä¸€æ­¥ä¸€æ­¥åœ°æŒ‡å¯¼ä½ ï¼Œä½¿ä¹‹æˆä¸ºä¸€ä¸ªå®Œæ•´çš„æ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åºã€‚ç„¶åä½ å¯ä»¥æŠŠå®ƒä½œä¸ºä½ ä¸‹ä¸€ä¸ªé¡¹ç›®çš„èµ·ç‚¹ï¼

ä½ å¯ä»¥å…³æ³¨æˆ‘:

[![follow-me-twitter](../Images/ff8782766b4760eb9020cec54eb02af8.png)](https://twitter.com/paco_ita)