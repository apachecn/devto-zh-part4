# Xamarin å½¢æˆå¯è®¿é—®çš„æ ‡é¢˜

> åŸæ–‡:[https://dev . to/stuartblang/xa marin-forms-accessible-headings-2192](https://dev.to/stuartblang/xamarin-forms-accessible-headings-2192)

å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç§»åŠ¨åº”ç”¨ç¨‹åºï¼Œåœ¨ iOS ä¸Šå¯ç”¨ VoiceOver å¹¶ä»ä¾èµ–è¿™äº›å·¥å…·è®¿é—®ä½ çš„åº”ç”¨ç¨‹åºçš„äººçš„è§’åº¦è€ƒè™‘å¯ç”¨æ€§æ˜¯å€¼å¾—çš„ã€‚

å¼€ç®±å³ç”¨ï¼ŒXamarin Forms é™„å¸¦äº†ä¸€äº›å¾ˆå¥½çš„è¾…åŠ©åŠŸèƒ½ï¼Œå¯ä»¥æ§åˆ¶ VoiceOver çš„ä½“éªŒï¼Œç‰¹åˆ«æ˜¯[è‡ªåŠ¨åŒ–å±æ€§](https://docs.microsoft.com/en-us/xamarin/xamarin-forms/app-fundamentals/accessibility/automation-properties)å…è®¸æ‚¨ç”¨å…ƒæ•°æ®æ³¨é‡Šæ‚¨çš„ XAML å…ƒç´ ï¼Œä¾‹å¦‚å½“ VoiceOver é€‰æ‹©æ—¶è¦è¯»å‡ºä»€ä¹ˆæ–‡æœ¬ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸ä¼šæŠŠé‡ç‚¹æ”¾åœ¨è¿™äº›åŠŸèƒ½ä¸Šï¼Œè€Œæ˜¯çœ‹ä¸€ä¸‹æ ‡é¢˜ã€‚

### [](#headings)æ ‡é¢˜

è€ƒè™‘ä¸‹é¢çš„å±å¹•:

[![](../Images/52d480b2b6988f66bcdab7051dd732b1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--wHamBRwg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://stu.dev/content/images/2019/08/image-5.png)

ä»è§†è§‰ä¸Šçœ‹ï¼Œè¿™äº›æ ‡é¢˜å‘ç”¨æˆ·ä¼ è¾¾äº†å±å¹•çš„ç»“æ„ã€‚ä½†æ˜¯ï¼Œç°åœ¨è®©æˆ‘ä»¬å°è¯•åªä½¿ç”¨ VoiceOver æ¥å¯¼èˆªé¡µé¢ã€‚åœ¨æ­¤åŠ¨ç”»ä¸­ï¼Œå½“æˆ‘ä»¬å‘å·¦/å‘å³æ»‘åŠ¨æ—¶ï¼Œä¼šé€‰æ‹©ä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å¤§å£°æœ—è¯»å…¶æè¿°ã€‚

[![](../Images/41eadef5e40c8c11fc528c12db986451.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ny0-2p3O--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://stu.dev/content/images/2019/09/before.gif)

è™½ç„¶æ‰€æœ‰çš„å†…å®¹éƒ½å¯ä»¥è®¿é—®ï¼Œä½†å¦‚æœ VoiceOver æ˜¯æ‚¨å”¯ä¸€çš„ç”¨æˆ·ç•Œé¢ï¼Œæ ‡é¢˜å°±ä¼šæ·¡å‡ºå¸¸è§„å†…å®¹ã€‚

[![](../Images/1ffff5d774f6e4d3a87b54d32e553a0a.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--x91U9XW2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://stu.dev/content/images/2019/08/image-9.png) 

<figcaption>è½¬å­æ§åˆ¶</figcaption>

è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨è½¬å­å¯¼èˆªæ§åˆ¶æ¥é€‰æ‹©`Headings`(ç”¨åŒæŒ‡æ‰­è½¬æ‰‹åŠ¿)ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šä¸‹æ»‘åŠ¨æ‰‹åŠ¿åœ¨æ ‡é¢˜é—´è·³è½¬æ¥æµè§ˆå±å¹•ï¼Œä½†ç›®å‰ VoiceOver åªæ˜¯è¯´:â€œæ²¡æœ‰æ‰¾åˆ°æ ‡é¢˜â€ï¼Œè¿™ä¸æ˜¯å¾ˆæœ‰å¸®åŠ©ã€‚

åœ¨ iOS ä¸Šï¼Œå…ƒç´ å¯ä»¥è¢«èµ‹äºˆä¸€ä¸ª`header` [å¯è®¿é—®æ€§ç‰¹å¾](https://developer.apple.com/documentation/uikit/accessibility/uiaccessibility/accessibility_traits)ã€‚ä½¿ç”¨æ­¤åŠŸèƒ½ï¼ŒVoiceOver ä¼šå°†è¿™äº›å…ƒç´ è§†ä¸ºæ ‡é¢˜ï¼Œå‘ä¸Š/å‘ä¸‹æ»‘åŠ¨æ‰‹åŠ¿ç°åœ¨å°†èµ·ä½œç”¨ï¼Œå¹¶å°†æ‰€é€‰å†…å®¹è·³è½¬åˆ°ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªæ ‡é¢˜ã€‚

[![](../Images/65b672eccd4cc26b21c5ae65099b0b5e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jHFXOKfw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://stu.dev/content/images/2019/09/after.gif)

ç°åœ¨è¿™ä¸ªåŠŸèƒ½æ›´å¥½äº†ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨æ ‡é¢˜ä¹‹é—´å¿«é€Ÿè·³è½¬ï¼Œå¹¶ä¸”ä»ç„¶å¯ä»¥å¯¼èˆªåˆ°å®ƒä»¬å‘¨å›´çš„é¡¹ç›®ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥å»ºé€ å®ƒã€‚

### [](#how-do-we-do-it)æˆ‘ä»¬æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ

äº‹å®è¯æ˜ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¤ªå¤šçš„ä»£ç æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªé™„åŠ å±æ€§ï¼Œè¯¥å±æ€§å°†è‡ªåŠ¨ä¸ºå®ƒæ‰€æ·»åŠ åˆ°çš„å…ƒç´ æ·»åŠ æ•ˆæœã€‚

æˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰æˆ‘ä»¬çš„é™„åŠ å±æ€§ï¼Œå¹¶åˆ›å»ºä»…åœ¨ iOS ä¸Šå®ç°çš„æ•ˆæœ:

```
using System;
using System.Linq;
using Xamarin.Forms;

namespace XamAppWithHeaders
{
    public static class Accessibility
    {
        [Flags]
        public enum AccessibilityTrait
        {
            None,
            Header
        }

        public static readonly BindableProperty AccessibilityTraitsProperty =
            BindableProperty.CreateAttached("AccessibilityTraits", typeof(AccessibilityTrait), typeof(Accessibility), AccessibilityTrait.None, propertyChanged: OnAccessibilityTraitsChanged);

        public static AccessibilityTrait GetAccessibilityTraits(BindableObject view)
        {
            return (AccessibilityTrait)view.GetValue(AccessibilityTraitsProperty);
        }

        public static void SetAccessibilityTraits(BindableObject view, AccessibilityTrait value)
        {
            view.SetValue(AccessibilityTraitsProperty, value);
        }

        static void OnAccessibilityTraitsChanged(BindableObject bindable, object oldValue, object newValue)
        {
            if (!(bindable is View view))
            {
                return;
            }

            var newTraits = (AccessibilityTrait)newValue;
            var hasTraits = newTraits != AccessibilityTrait.None;

            if (hasTraits)
            {
                if (!view.Effects.OfType<AccessibilityTraitEffect>().Any())
                {
                    view.Effects.Add(new AccessibilityTraitEffect());
                }
            }
            else
            {
                var accessibilityTrait = view.Effects.OfType<AccessibilityTraitEffect>().FirstOrDefault();
                if (accessibilityTrait != null)
                {
                    view.Effects.Remove(accessibilityTrait);
                }
            }
        }

        public class AccessibilityTraitEffect : RoutingEffect
        {
            public AccessibilityTraitEffect() : base("XamAppWithHeaders.AccessibilityTraitEffect")
            {
            }
        }
    }
} 
```

ç¡®ä¿åœ¨`RoutingEffect`åŸºæœ¬è°ƒç”¨ä¸­æ›´æ”¹`XamAppWithHeaders`ä»¥åŒ¹é…æ‚¨è‡ªå·±çš„åç§°ç©ºé—´ã€‚

ç°åœ¨ï¼Œåœ¨æˆ‘ä»¬çš„ iOS é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†å®ç°æ•ˆæœï¼Œå¹¶å®é™…è®¾ç½®å¯è®¿é—®æ€§ç‰¹å¾:

```
using UIKit;
using Xamarin.Forms;
using Xamarin.Forms.Platform.iOS;
using static XamAppWithHeaders.Accessibility;

[assembly: ResolutionGroupName("XamAppWithHeaders")]
[assembly: ExportEffect(typeof(XamAppWithHeaders.iOS.AccessibilityTraitEffect), "AccessibilityTraitEffect")]

namespace XamAppWithHeaders.iOS
{
    public class AccessibilityTraitEffect : PlatformEffect
    {
        protected override void OnAttached()
        {
            AddAccessibilityTraits();
        }

        protected override void OnDetached()
        {
        }

        protected override void OnElementPropertyChanged(System.ComponentModel.PropertyChangedEventArgs args)
        {
            if (args.PropertyName == AccessibilityTraitsProperty.PropertyName)
            {
                AddAccessibilityTraits();
            }
            else
            {
                base.OnElementPropertyChanged(args);
            }
        }

        void AddAccessibilityTraits()
        {
            var traits = Control.AccessibilityTraits;

            var newTraits = GetAccessibilityTraits(Element);

            if ((newTraits & AccessibilityTrait.Header) > 0) traits |= UIAccessibilityTrait.Header;

            Control.AccessibilityTraits = traits;
        }
    }
} 
```

...å°±è¿™æ ·ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å°†åç§°ç©ºé—´å¼•å…¥æˆ‘ä»¬çš„ xaml è§†å›¾ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ä»»ä½•æˆ‘ä»¬æƒ³è¦æŒ‡ç¤ºä¸ºæ ‡é¢˜çš„å…ƒç´ ä¸­ã€‚

```
<Label local:Accessibility.AccessibilityTraits="Header" Text="First Header" Style="{StaticResource headerStyle}" /> 
```

ç„¶è€Œï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå…±äº«çš„æ ‡é¢˜æ ·å¼ï¼Œè¿™æ˜¯ç°å®ä¸–ç•Œåº”ç”¨ç¨‹åºçš„å¸¸è§æƒ…å†µï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯`headerStyle`ã€‚åŸæ¥ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªå…±äº«çš„æ ·å¼æ¥æ·»åŠ é™„åŠ çš„å±æ€§ï¼Œçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
<Style x:Key="headerStyle" TargetType="Label">
    <Setter Property="FontAttributes" Value="Bold" />
    <Setter Property="FontSize" Value="22" />
    <Setter Property="local:Accessibility.AccessibilityTraits" Value="Header" />
</Style> 
```

### [](#closing-thoughts)å…³é—­æ€ç»ª

åªéœ€åœ¨æ ‡é¢˜æ ·å¼ä¸­æ·»åŠ  2 ä¸ªä»£ç æ–‡ä»¶å’Œ 1 è¡Œä»£ç ï¼Œå°±èƒ½è®©ä¾èµ– VoiceOver çš„ç”¨æˆ·æ›´å®¹æ˜“ä½¿ç”¨æ‚¨çš„åº”ç”¨ç¨‹åºã€‚è¯•ä¸€è¯•ğŸ˜€

åœ¨è¿™é‡Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå·¥ä½œæ ·æœ¬[ã€‚](https://github.com/slang25/xamarin-forms-accessiblity-traits-demo)