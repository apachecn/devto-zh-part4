# ç”¨ React-Async è·å– API æ•°æ®

> åŸæ–‡:[https://dev . to/aviatorifeanyi/fetching-API-data-with-react-async-32cl](https://dev.to/aviatorifeanyi/fetching-api-data-with-react-async-32cl)

ä½œä¸ºå¼€å‘äººå‘˜ï¼Œå½“æå‡º api è¯·æ±‚æ—¶ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ react æ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯é¢ä¸´ä½¿ç”¨ javascript fetch API æˆ– axios åº“çš„é€‰æ‹©ã€‚æ ¹æ®å¼€å‘äººå‘˜çš„éœ€æ±‚å’Œä½¿ç”¨æƒ…å†µï¼Œä»ä¸Šé¢é€‰æ‹©ä¸€ä¸ªæ€»æ˜¯å¾ˆæœ‰æ•ˆçš„ã€‚ç„¶è€Œï¼Œæˆ‘å¾ˆå¥½å¥‡å¯»æ‰¾å…¶ä»–çš„åšäº‹æ–¹å¼ï¼Œè¿™æ—¶å€™æˆ‘å‘ç°äº†ä¸€ä¸ªåŒ…:react-asyncã€‚

è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘è¯•å›¾ç†è§£å¹¶è‡ªå­¦è¿™ä¸ªåŒ…çš„ç”¨æ³•

## [](#introducing-reactasync)ä»‹ç» React-Async

ç”¨äºå£°æ˜æ€§æ‰¿è¯ºè§£æå’Œæ•°æ®è·å–çš„ React ç»„ä»¶å’Œé’©å­[æ–‡æ¡£](https://www.npmjs.com/package/react-async)

ä½¿ç”¨è¯¥è½¯ä»¶åŒ…çš„å¥½å¤„ä¹‹ä¸€æ˜¯:

*   å®ƒè¿˜å¯ä»¥ä¸ promisesã€async/await å’Œ Fetch API ä¸€èµ·å·¥ä½œ

è¿™ç¯‡æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†å°†æ˜¯ä»£ç ã€‚ä¸‹å®šå†³å¿ƒğŸ˜ğŸ˜

æˆ‘ä»¬å°†ä½¿ç”¨ react cli

é¦–å…ˆå®‰è£… react CLI:create-react-app(CRA)

```
npx install create-react-app async-react

cd async-react

npm start 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„ï¼Œæˆ‘ä½¿ç”¨ npx æ¥å®‰è£… CRA å’Œå¼•å¯¼æˆ‘çš„é¡¹ç›®ã€‚è¿™èŠ‚çœäº†æˆ‘é¦–å…ˆåœ¨æˆ‘çš„ç³»ç»Ÿä¸­å…¨å±€å®‰è£… CRAï¼Œç„¶åå¯åŠ¨é¡¹ç›®çš„æ—¶é—´

è€Œæ˜¯ä¸ºäº†ä½ çš„éœ€è¦

```
npm install -g create-react-app
create-react-app async-react

cd async-react
npm start 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å‰å®³ï¼ï¼ï¼æˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒå·²ç»å¼€å§‹

åœ¨æ‚¨å–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨ä¸­æ‰“å¼€æˆ‘ä»¬çš„é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œç„¶åè¿›å…¥ src æ–‡ä»¶å¤¹

è¿™æ˜¯æˆ‘ä»¬åšå¤§éƒ¨åˆ†å·¥ä½œçš„åœ°æ–¹

å°† App.js é‡å‘½åä¸º Posts.jsã€‚æˆ‘ä»¬å°†å‘ˆç°ä¸€ä¸ªå¸–å­åˆ—è¡¨

æ‰“å¼€ Posts.js æ–‡ä»¶ï¼Œè¾“å…¥ä»£ç 

```
//import react and react-async

import './App.css'
import React from "react"
import Async from "react-async"

const loadPosts = () =>
 fetch('https://jsonplaceholder.typicode.com/posts')
    .then(res => (res.ok ? res : Promise.reject(res)))
    .then(res => res.json())

const Posts = () => (
  <Async promiseFn={loadPosts}>
    {({ data, error, isLoading }) => {
      if (isLoading) return <div>Fetching data... Please Wait</div> 
      if (error) return <div>Something went wrong: ${error.message}</div> 
      if (data){
          const responseData = data.map((post)=>{
            return(
              <div>
               <p> {post.title} </p>
               <hr />
               <h1> {post.body} </h1>
              </div>
            )
          })
        return(
          <div>
           {responseData}
          </div>
        )
       }
      return null
    }}
  </Async> 
)

export default Posts 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨é¡¶éƒ¨ï¼Œæˆ‘ä»¬å¯¼å…¥äº† react å’Œ react-async

ä½†æ˜¯æˆ‘ä»¬ä»ç„¶æ²¡æœ‰ react-async åŒ…
è®©æˆ‘ä»¬å®‰è£…å®ƒ

`npm install --save react-async`

ä½¿ç”¨ react-async æœ‰ä¸‰ç§æ–¹æ³•

*   ä½œä¸ºä¸€ä¸ªé’©å­
*   ä½œä¸ºä¸€ä¸ªç»„ä»¶
*   ä½œä¸ºä¸€ä¸ªå·¥å‚

æˆ‘ä»¬ä½¿ç”¨**ä½œä¸ºç»„ä»¶**çš„åŠŸèƒ½

### [](#code-illustration)ä»£ç è¯´æ˜

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª loadPosts å‡½æ•°ï¼Œå®ƒä½¿ç”¨ fetch api
å‘å‡ºä¸€ä¸ª api è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚è¿”å›ä¸€ä¸ªæ‰¿è¯ºï¼Œè¿™ä¸ªæ‰¿è¯ºè¢«è§£å†³æˆ–æ‹’ç»ã€‚

å¦‚æœè¿™ä¸ªé—®é¢˜å¾—åˆ°è§£å†³ï¼Œå®ƒä¼šä¸ºæˆ‘ä»¬çš„ç»„ä»¶æä¾›ä¸€äº›æ”¯æŒï¼ŒåŒ…æ‹¬-

*   æ•°æ®:api è¯·æ±‚æˆåŠŸï¼Œæˆ‘ä»¬å·²ç»å°†æ•°æ®æ³¨å…¥åˆ°ç»„ä»¶ä¸­

*   é”™è¯¯:ä¸æˆåŠŸçš„ api è¯·æ±‚ã€‚è¿™åŒ…å«äº†å‡ºé”™çš„ç»†èŠ‚

*   isLoading:æ¥è‡ªæˆ‘ä»¬çš„ api çš„æ•°æ®å“åº”è¿˜æ²¡æœ‰åˆ°è¾¾ï¼Œæ‰€ä»¥æˆ‘ä»¬ç­‰å¾…ç›´åˆ°å®ƒè¢«è§£å†³

åœ¨ Posts ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨æä¾›ç»™æˆ‘ä»¬çš„é“å…·å¹¶è¿”å›æ•°æ®

æ³¨æ„è¿™ä¸€è¡Œ

```
 <Async promiseFn={loadPosts}> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°±æ˜¯å¥‡è¿¹å‘ç”Ÿçš„åœ°æ–¹

æˆ‘ä»¬ä¼ å…¥ loadPosts å‡½æ•°ï¼Œè¯¥å‡½æ•°å°† api è¯·æ±‚ä½œä¸ºä¸€ä¸ªé“å…·ä¼ é€’ç»™å¼‚æ­¥ç»„ä»¶ï¼Œå½“å®ƒè¢«è§£ææ—¶ï¼Œæˆ‘ä»¬å°†è·å¾—æ•°æ®ã€é”™è¯¯å’Œ isLoading é“å…·ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ Posts ç»„ä»¶ä¸­ä½¿ç”¨å®ƒä»¬

å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä» react-async å¯¼å…¥äº† Async

### [](#update)æ›´æ–°

æ‰“å¼€ index.js æ–‡ä»¶å¹¶è¿›è¡Œé€‚å½“çš„ä¿®æ”¹

```
//remove 
import App from './App'

//Add
import Posts from './Posts'

ReactDOM.render(<Posts />, document.getElementById('root') ) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ‰äº†è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåº”è¯¥å¯ä»¥å·¥ä½œäº†