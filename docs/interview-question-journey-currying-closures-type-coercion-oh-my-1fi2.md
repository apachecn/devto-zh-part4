# é¢è¯•é—®é¢˜ä¹‹æ—…â€”â€”é˜¿è°€å¥‰æ‰¿ï¼Œé—­åŒ…ï¼Œç±»å‹å¼ºåˆ¶ï¼Œå¤©å•ŠğŸ˜±

> åŸæ–‡ï¼š<https://dev.to/karataev/interview-question-journey-currying-closures-type-coercion-oh-my-1fi2>

è¿™ç¯‡æ–‡ç« åŸºäºçœŸå®çš„æ•…äº‹ï¼Œä¸ºäº†å¯è¯»æ€§åšäº†ä¸€äº›å°çš„æ”¹åŠ¨ã€‚

å‡è®¾ä½ æ­£åœ¨é¢è¯•å‰ç«¯å¼€å‘äººå‘˜çš„èŒä½ã€‚é¢è¯•å®˜è®©ä½ å†™ä¸€ä¸ªå‡½æ•°æŠŠä¸¤ä¸ªæ•°ç›¸åŠ ã€‚
è¿™å¾ˆå®¹æ˜“ï¼Œä½ æƒ³å‡ºäº†

```
function add(a, b) {
  return a + b;
} 
```

æ¥ä¸‹æ¥ï¼Œè¦æ±‚æ‚¨å°†å‡½æ•°ä¿®æ”¹ä¸º`add(1)(2)`è¯­æ³•ã€‚
å—¯ï¼Œ

```
function add(a) {
  return function(b) {
    return a + b;
  }
} 
```

å¤šåŠ æ‹¬å·ï¼`add(1)(2)(3)`åº”è¯¥è¿”å› 6ã€‚
æ²¡é—®é¢˜:

```
function add(a) {
  return function(b) {
    return function(c) {
      return a + b + c;
    }
  }
} 
```

åˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡é¡ºåˆ©ã€‚ä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯æŒ‰ç…§è¦æ±‚ç¼–å†™`add`å‡½æ•°:

```
+add(1)(2) // should return 3
+add(1)(2)(3) // should return 6 
```

å¾ˆæ˜æ˜¾ï¼Œå‰é¢çš„è§£å†³æ–¹æ¡ˆåº”è¯¥é‡å†™ä»¥æ¥å—ä»»æ„æ•°é‡çš„æ‹¬å·ã€‚æˆ‘ä»¬è¿˜æ³¨æ„åˆ°äº†`add`å‡½æ•°å‰çš„åŠ å·ï¼Œå®ƒè®©æˆ‘ä»¬æƒ³åˆ°äº†ç±»å‹å¼ºåˆ¶ã€‚
å¦‚æœæˆ‘ä»¬æ€»æ˜¯ä»`add`è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶åœ¨å¿…è¦æ—¶å°†å®ƒå¼ºåˆ¶è½¬æ¢æˆä¸€ä¸ªåŸå§‹æ•°å­—ï¼Œä¼šæ€ä¹ˆæ ·ï¼ŸJavaScript è°ƒç”¨ [valueOf](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/valueOf) æ–¹æ³•å°†å‡½æ•°è½¬æ¢æˆä¸€ä¸ªåŸå§‹æ•°å­—ã€‚

```
function add(a) {
  return add;
}

add.valueOf = function() {
  return 42;
}

console.log(+add(1)(2)); // 42
console.log(+add(1)(2)(3)); // 42 
```

æˆ‘ä»¬ä»å‡½æ•°`add`è¿”å›å‡½æ•°`add`,å¹¶è¦†ç›–å®ƒçš„`valueOf`æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨è¢«å¼ºåˆ¶è½¬æ¢ä¸ºåŸè¯­æ—¶è¿”å›ä¸€ä¸ªå¸¸æ•°ã€‚
æˆ‘ä»¬è¿˜æ²¡æœ‰å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œä½†å·²ç»è¿ˆå‡ºäº†ä¸€å¤§æ­¥ã€‚æˆ‘ä»¬æ²¡æœ‰å¾—åˆ°è¿è¡Œæ—¶é”™è¯¯ï¼Œå¹¶èƒ½å¤Ÿè¿”å›ä¸€ä¸ªæ•°å­—ï¼ä¸‹ä¸€æ­¥æ˜¯æ­£ç¡®åœ°å¯¹è¿™äº›æ•°å­—æ±‚å’Œã€‚æˆ‘ä»¬åº”è¯¥ç§¯ç´¯è°ƒç”¨`add`å‡½æ•°çš„å‚æ•°ã€‚è®©æˆ‘ä»¬ä»æœ€ç®€å•çš„æ–¹æ³•å¼€å§‹ã€‚

```
let counter = 0;
function add(a) {
  counter += a;
  return add;
}
add.valueOf = function() {
  return counter;
};

console.log('Should be 3', +add(1)(2)); // 3
console.log('Should be 6', +add(1)(2)(3)); // 9 
```

ç¬¬ä¸€ä¸ªç»“æœæ˜¯æ­£ç¡®çš„ï¼Œä½†ç¬¬äºŒä¸ªæ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºè®¡æ•°å™¨åœ¨ç¬¬ä¸€æ¬¡å¼ºåˆ¶åæ²¡æœ‰è¢«é‡ç½®ã€‚è®©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```
let counter = 0;
function add(a) {
  counter += a;
  return add;
}
add.valueOf = function() {
  let temp = counter;
  counter = 0;
  return temp;
};

console.clear();
console.log('Should be 3', +add(1)(2)); // 3
console.log('Should be 6', +add(1)(2)(3)); // 6 
```

å¤ªå¥½äº†ï¼ç°åœ¨ä¸€åˆ‡éƒ½æŒ‰é¢„æœŸè¿è¡Œäº†ï¼ä½†æ˜¯ä»£ç ä¸æ˜¯å¾ˆå¥½ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ã€‚è®©æˆ‘ä»¬é‡æ„ğŸ› 

```
function add(a) {
  let counter = a;
  function inner(b) {
    counter += b;
    return inner;
  }
  inner.valueOf = () => counter;
  return inner;
}

console.log('Should be 3', +add(1)(2)); // 3
console.log('Should be 6', +add(1)(2)(3)); // 6 
```

å‰å®³ï¼âœ¨:ç»“æœæ˜¯æ­£ç¡®çš„ï¼Œä»£ç ä¹Ÿä¸é”™ã€‚æˆ‘ä»¬åœ¨`add`ä¸­åˆ›å»ºäº†å‡½æ•°`inner`å¹¶è¿”å›å®ƒã€‚`counter`å˜é‡æ˜¯å°é—­çš„ï¼Œä¸éœ€è¦åƒå‰é¢çš„ä¾‹å­é‚£æ ·é‡ç½®å®ƒã€‚
ç°åœ¨å¯ä»¥è¿™æ ·å†™è¡¨è¾¾å¼äº†:

```
let result = add(1)(2) + add(1)(2)(3) + add(1)(2)(3)(4) + add(1)(2)(3)(4)(5);
console.log(result); // 34 
```

å¹¶å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚

ä½ å¦‚ä½•çœ‹å¾…é¢è¯•ä¸­çš„è¿™ç±»ä»»åŠ¡ï¼Ÿä½ åœ¨é¢è¯•ä¸­è¢«é—®äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿè¯·åœ¨è¯„è®ºä¸­åˆ†äº«ï¼