# é€šè¿‡ D3 å’Œ React çš„ç¯®çƒç»Ÿè®¡

> åŸæ–‡ï¼š<https://dev.to/benjaminadk/basketball-stats-through-d3-react-4m10>

[![](img/6baa6d20f79bd59ca9e134b64fb8e039.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--2gQFG5BL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/cof58zsskyfyif4ub93k.png)

åˆ¶ä½œä¸€ä¸ª*ç”œç”œåœˆå›¾*æ¥å¯è§†åŒ– 2018-19 èµ›å­£**æ´›æ‰æœºæ¹–äºº**ç¯®çƒé˜Ÿçš„æ€»å¾—åˆ†ã€‚

# æ•°æ®

æˆ‘ä»¬åˆ›å»ºæ•°æ®å¯è§†åŒ–é¦–å…ˆéœ€è¦çš„ä¸æ˜¯å·§åˆï¼Œæ˜¯æ•°æ®ã€‚è¿™ç¯‡å†™å¾—å¾ˆå¥½çš„æ–‡ç« è§£é‡Šäº†ç½‘ç»œæŠ“å–çš„ä¸€äº›æ³•å¾‹å’Œé“å¾·åˆ†æ­§ã€‚[è¿™ä¸ªå­˜å‚¨åº“](https://github.com/awesomedata/awesome-public-datasets)æä¾›å…è´¹å…¬å…±æ•°æ®çš„é“¾æ¥ã€‚ **Dev.to** æœ¬èº«å°±æœ‰å¾ˆå¤šå…³äºæ•°æ®ã€web æŠ“å–å™¨å’Œå¯è§†åŒ–çš„æ–‡ç« ã€‚æˆ‘çš„æ„è§æ˜¯ï¼Œå¯¹äºç®€å•çš„æ•°æ®å¯è§†åŒ–é¡¹ç›®ï¼Œè€å¼çš„ Chrome Devtools æœ¬èº«å°±è¶³ä»¥æ”¶é›†å’Œæ•´ç†æ•°æ®ã€‚çœ‹çœ‹è¿™ä¸ªè¿‡äºç®€åŒ–çš„ä¾‹å­ã€‚

| åå­— | å¹´é¾„ |
| --- | --- |
| å‹’å¸ƒæœ—Â·è©¹å§†æ–¯ | Thirty-four |
| é”¡å®‰Â·å¨å»‰æ£® | Eighteen |
| è¿ˆå…‹å°”Â·ä¹”ä¸¹ | fifty-six |

æ ¹æ®ä¸Šè¡¨ï¼Œä»¥ä¸‹æ˜¯å¤„ç†æ•°æ®çš„æ­¥éª¤:

1.  æ‰“å¼€ **Chrome Devtools**
2.  éš”ç¦»æ‰€æœ‰è¡¨æ ¼è¡Œ
3.  å°†ç»“æœä»ä¸€ä¸ª*èŠ‚ç‚¹åˆ—è¡¨*è½¬æ¢æˆä¸€ä¸ª*æ•°ç»„*å¹¶åˆ é™¤æ ‡é¢˜è¡Œ
4.  ä»æ¯ä¸ªè¡¨æ ¼æ•°æ®å•å…ƒæ ¼æå–æ–‡æœ¬ï¼Œå¹¶å°†ç»“æœæ˜ å°„åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡æ•°ç»„
5.  é”®å…¥`c`(å˜é‡å)å¹¶æŒ‰ä¸‹`Enter`ï¼Œæ‚¨çš„æ–°æ•°ç»„å°†æ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸­
6.  å³é”®å•å‡»é˜µåˆ—å¹¶é€‰æ‹©`Store as Global Variable`ã€‚æ‚¨å°†çœ‹åˆ°`temp1`å‡ºç°åœ¨æ§åˆ¶å°ä¸­ã€‚
7.  ä½¿ç”¨å†…ç½®çš„`copy`å‡½æ•°å°†ä¸´æ—¶å˜é‡å¤åˆ¶åˆ°å‰ªè´´æ¿- `copy(temp1)`
8.  å°†ä½ çš„æ•°æ®ç²˜è´´åˆ°ä¸€ä¸ª **JavaScript** æˆ– **JSON** æ–‡ä»¶ä¸­ã€‚
9.  ğŸ¤¯

```
var a = document.querySelectorAll('tr') // 2
var b = Array.from(a).slice(1) // 3
var c = b.map(el => {
  // 4
  var name = el.children[0].innerText
  var age = el.children[1].innerText
  return { name, age }
})

c // 5
// right click array
copy(temp1) // 7 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„ï¼Œæ¯ä¸ªåœºæ™¯éƒ½æ˜¯ä¸åŒçš„ï¼Œè¿™ä¸ªç¤ºä¾‹è¢«ç®€åŒ–ä»¥å¸®åŠ©è§£é‡Šè¿™ä¸ªè¿‡ç¨‹ã€‚æ­¤å¤–ï¼Œä¸Šè¿°æ‰€æœ‰é€»è¾‘éƒ½å¯ä»¥æ”¾åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œä»¥ç®€åŒ–æµç¨‹ã€‚è®°ä½ï¼Œæ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­é€šè¿‡ä½¿ç”¨`Shift+Enter`åˆ›å»ºæ–°è¡Œæ¥åˆ›å»ºå¤šè¡ŒåŠŸèƒ½ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬æœ‰äº†ç›¸å½“äºç”¨ **JavaScript** 101 æ‰‹åŠ¨æŠ“å–ç½‘é¡µçš„åŠŸèƒ½ã€‚åœ¨å»ä¸åº”è¯¥å»çš„åœ°æ–¹è·å–æ•°æ®ä¹‹å‰ï¼Œä¸€å®šè¦é˜…è¯»ç½‘ç«™çš„*æœåŠ¡æ¡æ¬¾*ã€‚

[![](img/7ab05decb728bb1af4e3e8e1e6967046.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--B1G9vcrB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vtojf81pxsrfj6q30wtj.png)

# åˆ›å»ºä¸€ä¸ªåœ†ç¯å›¾

è®© **D3** å’Œ**ååº”**ä¸€èµ·å·¥ä½œå…¶å®å¹¶æ²¡æœ‰é‚£ä¹ˆå¤æ‚ã€‚é€šå¸¸ï¼Œæ‰€éœ€è¦çš„åªæ˜¯ DOM çš„å…¥å£ç‚¹å’Œä¸€äº›åœ¨é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–å¯è§†åŒ–çš„é€»è¾‘ã€‚ä¸ºäº†å¼€å§‹æˆ‘ä»¬çš„ç¤ºä¾‹é¡¹ç›®ï¼Œæˆ‘ä»¬å¸Œæœ›å®‰è£…`create-react-app`ã€‚ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚æˆ‘å–œæ¬¢åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ¸…ç©º`src`ç›®å½•ï¼Œåªç•™ä¸‹`App.js`å’Œ`index.js`ã€‚ä¸è¦å¿˜è®°åˆ é™¤ä»»ä½•æ—§çš„`import`å£°æ˜ã€‚åœ¨æˆ‘ä»¬å†™ä»»ä½•ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ•æ‰ä¸€äº›ä¾èµ–å…³ç³»ã€‚

1-ä¸‹è½½ **D3** å’Œ**é£æ ¼ç»„ä»¶**ã€‚

```
npm i d3 styled-components 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

2-åœ¨`src`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶`whatever-you-want.js`ï¼Œç”šè‡³æ˜¯`data.js`ã€‚ç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ•°æ®å¯åœ¨æœ¬è¦ç‚¹ä¸­[è·å¾—ã€‚](https://gist.github.com/benjaminadk/45f2349ab415a334be4374b5fffd4884)

3-åˆ›å»ºä¸€äº›åŸºæœ¬çš„æ ·æ¿æ–‡ä»¶ï¼Œå¯ä»¥ç”¨è¿™ç§é…ç½®ç”¨äºå„ç§é¡¹ç›®-ä¹Ÿå°±æ˜¯ **D3** + **React** + **é£æ ¼çš„ç»„ä»¶**ã€‚æˆ‘é¼“åŠ±ä½ è°ƒæ•´ä½ è®¤ä¸ºåˆé€‚çš„ä»»ä½•ä¸œè¥¿ï¼Œå°±åƒå¤§å¤šæ•°å¼€å‘è€…ä¸€æ ·ï¼Œæˆ‘æœ‰æˆ‘è‡ªå·±çš„å¿«å…‹å’Œæ¨¡å¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘è¢«`#000000`é»‘è‰²å›°æ‰°ï¼Œæ‰€ä»¥æˆ‘ç”¨`#333333`ï¼Œæˆ‘å–œæ¬¢å­—ä½“`Raleway`ï¼Œç­‰ç­‰ã€‚å¦‚æœä½ ä»¥å‰æ²¡æœ‰ä½¿ç”¨è¿‡*é’©å­*ï¼Œå¸¦æœ‰ç©º`[]`ä¾èµ–æ•°ç»„çš„`useEffect`é’©å­ç±»ä¼¼äº **React** ç±»ç»„ä»¶ä¸­çš„`componentDidMount`ã€‚ç¼–å·çš„æ³¨é‡Šå¯¹åº”äºæ¥ä¸‹æ¥çš„æ­¥éª¤ï¼Œæ˜¯æ’å…¥è¿™äº›æ­¥éª¤çš„ä»£ç çš„åœ°æ–¹ã€‚

```
import React, { useRef, useEffect, useState } from 'react'
import * as d3 from 'd3'
import styled, { createGlobalStyle } from 'styled-components'
import data from './data'

const width = 1000
const height = 600
const black = '#333333'
const title = 'My Data Visualization'

// 4

// 7

export const GlobalStyle = createGlobalStyle`
@import url('https://fonts.googleapis.com/css?family=Raleway:400,600&display=swap');

body {
  font-family: 'Raleway', Arial, Helvetica, sans-serif;
  color: ${black};
  padding: 0;
  margin: 0;
}
`

export const Container = styled.div`
  display: grid;
  grid-template-rows: 30px 1fr;
  align-items: center;
  .title {
    font-size: 25px;
    font-weight: 600;
    padding-left: 20px;
  }
`

export const Visualization = styled.div`
  justify-self: center;
  width: ${width}px;
  height: ${height}px;
// 6
`

export default () => {
  const visualization = useRef(null)

  useEffect(() => {
    var svg = d3
      .select(visualization.current)
      .append('svg')
      .attr('width', width)
      .attr('height', height)
// 5

// 8
  }, [])

  return (
    <>
      <GlobalStyle/>
      <Container>
        <div className='title'>{title}</div>
        <Visualization ref={visualization} />
        {/*10*/}
      </Container>
    <>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

4-æˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„*åœ†ç¯å›¾*å»ºç«‹ä¸€ä¸ªé…è‰²æ–¹æ¡ˆå’Œä¸€äº›å°ºå¯¸ã€‚

æˆ‘ä»¬ç³•ç‚¹çš„åŠå¾„ã€‚

```
const radius = Math.min(width, height) / 2 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åªæœ‰ä½¿ç”¨æ¹–äººçš„é¢œè‰²ä¸»é¢˜æ‰æœ‰æ„ä¹‰ã€‚

```
var lakersColors = d3
  .scaleLinear()
  .domain([0, 1, 2, 3])
  .range(['#7E1DAF', '#C08BDA', '#FEEBBD', '#FDBB21']) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**D3** `pie`å‡½æ•°å°†æˆ‘ä»¬çš„æ•°æ®æ˜ å°„åˆ°é¥¼å›¾åˆ‡ç‰‡ä¸­ã€‚è¿™æ˜¯é€šè¿‡åœ¨å¹•åæ·»åŠ å­—æ®µå¦‚`startAngle`å’Œ`endAngle`æ¥å®ç°çš„ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå¯é€‰çš„`sort`å‡½æ•°æ¥æ‰“ä¹±åˆ‡ç‰‡çš„é¡ºåºã€‚ç©ç©è¿™ä¸ªï¼Œé€šè¿‡å®ƒ`null`æˆ–è€…ç”šè‡³ä¸é€šè¿‡å®ƒæ¥å¾—åˆ°ä¸åŒçš„å®‰æ’ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨`value`å‡½æ•°å‘Šè¯‰ **D3** ä½¿ç”¨`points`å±æ€§æ¥åˆ†å‰²é¦…é¥¼ã€‚å°†`pie`å˜é‡è®°å½•åˆ°æ§åˆ¶å°ï¼Œä»¥å¸®åŠ©æ¦‚å¿µåŒ– **D3** pie å‡½æ•°å¯¹æˆ‘ä»¬çš„æ•°æ®åšäº†ä»€ä¹ˆã€‚

```
var pie = d3
  .pie()
  .sort((a, b) => {
    return a.name.length - b.name.length
  })
  .value(d => d.points)(data) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬éœ€è¦ä½¿ç”¨`arc`å‡½æ•°åˆ›å»ºåœ†å½¢å¸ƒå±€ã€‚å˜é‡`arc`ç”¨äºæˆ‘ä»¬çš„*ç”œç”œåœˆå›¾*ï¼Œ`outerArc`ç¨åå°†ç”¨ä½œæ ‡ç­¾çš„å‘å¯¼ã€‚`getMidAngle`ä¹Ÿæ˜¯ç¨åè¦ä½¿ç”¨çš„å¸®åŠ©åŠŸèƒ½ã€‚

```
var arc = d3
  .arc()
  .outerRadius(radius * 0.7)
  .innerRadius(radius * 0.4)

var outerArc = d3
  .arc()
  .outerRadius(radius * 0.9)
  .innerRadius(radius * 0.9)

function getMidAngle(d) {
  return d.startAngle + (d.endAngle - d.startAngle) / 2
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ‰äº†ä¸€ä¸ªåˆé€‚çš„ç»“æ„ï¼Œä½ å‡ ä¹å¯ä»¥åœ¨å±å¹•ä¸Šçœ‹åˆ°ä¸€äº›ä¸œè¥¿ã€‚

å°†ä»¥ä¸‹é“¾æ¥åˆ°æˆ‘ä»¬æœ€åˆçš„`svg`å˜é‡å£°æ˜ã€‚

```
 .append('g')
   .attr('transform', `translate(${width / 2}, ${height / 2})`) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå½“æˆ‘ä»¬å°†`pie`åé¦ˆç»™ **D3** æ—¶ï¼Œç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†ã€‚

```
svg
  .selectAll('slices')
  .data(pie)
  .enter()
  .append('path')
  .attr('d', arc)
  .attr('fill', (d, i) => lakersColors(i % 4))
  .attr('stroke', black)
  .attr('stroke-width', 1) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä»æ¯ä¸ªåˆ‡ç‰‡ä¸­ç”»å‡ºæœ€ç»ˆæŒ‡å‘æ ‡ç­¾çš„çº¿ã€‚åä¸º`centroid`çš„å‡½æ•°è¿”å›ä¸€ä¸ªå¸¦æœ‰`[x,y]`åæ ‡çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„æŒ‡å‘`arc`å†…`pie`åˆ‡ç‰‡(åœ¨æœ¬ä¾‹ä¸­ä¸º`d`)çš„ä¸­å¿ƒç‚¹ã€‚æœ€åï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ªç”±ä¸‰ä¸ªåæ ‡æ•°ç»„ç»„æˆçš„æ•°ç»„ï¼Œå®ƒä»¬å¯¹åº”äºç°åœ¨å‡ºç°åœ¨å±å¹•ä¸Šçš„æ¯æ¡çº¿çš„åŸç‚¹ã€å¼¯æ›²ç‚¹å’Œç»ˆç‚¹ã€‚`midAngle`æœ‰åŠ©äºç¡®å®šçº¿å°¾æŒ‡å‘å“ªä¸ªæ–¹å‘ã€‚

```
svg
  .selectAll('lines')
  .data(pie)
  .enter()
  .append('polyline')
  .attr('stroke', black)
  .attr('stroke-width', 1)
  .style('fill', 'none')
  .attr('points', d => {
    var posA = arc.centroid(d)
    var posB = outerArc.centroid(d)
    var posC = outerArc.centroid(d)
    var midAngle = getMidAngle(d)
    posC[0] = radius * 0.95 * (midAngle < Math.PI ? 1 : -1)
    return [posA, posB, posC]
  }) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬çš„ç”Ÿäº§çº¿å·²ç»å‡†å¤‡å¥½è´´æ ‡ç­¾äº†ã€‚é€šè¿‡æ ¹æ®æ ‡ç­¾å‡ºç°åœ¨å›¾è¡¨çš„å“ªä¸€ä¾§æ¥ç¿»è½¬`name`å’Œ`points`çš„é¡ºåºï¼Œå¢åŠ ä¸€äº›å¯¹ç§°æ€§ï¼Œæ ‡ç­¾çœ‹èµ·æ¥æ›´å¥½ã€‚æ³¨æ„ï¼Œ`pie`å‡½æ•°å°†æˆ‘ä»¬åŸæ¥çš„`data`ç§»åˆ°äº†åä¸º`data`çš„é”®ä¸­ã€‚`pie`å¯¹è±¡çš„é¡¶å±‚é”®åŒ…å«åœ¨`getMidAngle`åŠŸèƒ½ä¸­ä½¿ç”¨çš„è§’åº¦æµ‹é‡å€¼ã€‚

```
svg
  .selectAll('labels')
  .data(pie)
  .enter()
  .append('text')
  .text(d => {
    var midAngle = getMidAngle(d)
    return midAngle < Math.PI
      ? `${d.data.name} - ${d.data.points}`
      : `${d.data.points} - ${d.data.name}`
  })
  .attr('class', 'label')
  .attr('transform', d => {
    var pos = outerArc.centroid(d)
    var midAngle = getMidAngle(d)
    pos[0] = radius * 0.99 * (midAngle < Math.PI ? 1 : -1)
    return `translate(${pos})`
  })
  .style('text-anchor', d => {
    var midAngle = getMidAngle(d)
    return midAngle < Math.PI ? 'start' : 'end'
  }) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

6-ä¸ºäº†ç”¨æŸç§é£æ ¼æ¶¦è‰²æˆ‘ä»¬çš„æ ‡ç­¾ï¼Œæˆ‘ä»¬åªéœ€è¦ç»™`Visualization`é£æ ¼çš„ç»„ä»¶æ·»åŠ å‡ è¡Œä»£ç ã€‚ä½¿ç”¨ **D3** åœ¨ **React** `useEffect`é’©å­ä¸­æ·»åŠ äº†ä¸€ä¸ª`class`å±æ€§ï¼Œç„¶åä½¿ç”¨**æ ·å¼çš„ç»„ä»¶**å®šä¹‰äº†é‚£ä¸ªç±»ï¼Œçœ‹èµ·æ¥åƒæ˜¯é€‰ä¸­äº†é›†æˆåº“çš„å¤é€‰æ¡†ã€‚

```
.label {
  font-size: 12px;
  font-weight: 600;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

7-æˆ‘ä»¬çœ‹èµ·æ¥å¾ˆå¥½ï¼Œä½†ä¸ºä»€ä¹ˆä¸æ·»åŠ æ›´å¤šçš„å‘³é“ï¼Œç»™ç”¨æˆ·ä¸€ä¸ªäº’åŠ¨çš„æ„Ÿè§‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **D3** ä¸­çš„`sum`å‡½æ•°å¿«é€Ÿè·å–æ€»å¾—åˆ†ã€‚

```
var total = d3.sum(data, d => d.points) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

8-`showTotal`å‡½æ•°å°†ç®€å•åœ°æ·»åŠ ä¸€ä¸ª`text`èŠ‚ç‚¹æ¥æ˜¾ç¤ºæˆ‘ä»¬çš„æ€»æ•°ã€‚`middle`çš„`text-anchor`æ ·å¼å±æ€§åº”è¯¥ä½¿æ–‡æœ¬åœ¨æˆ‘ä»¬çš„*åœ†ç¯*å­”å†…å±…ä¸­ã€‚`hideTotal`åŠŸèƒ½é©¬ä¸Šå°±è¦å‘æŒ¥ä½œç”¨äº†ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬è°ƒç”¨äº†`showTotal`å‡½æ•°æ¥ç¡®ä¿é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ–‡æœ¬ã€‚

```
function showTotal() {
  svg
    .append('text')
    .text(`Total: ${total}`)
    .attr('class', 'total')
    .style('text-anchor', 'middle')
}

function hideTotal() {
  svg.selectAll('.total').remove()
}

showTotal() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬åº”è¯¥åœ¨æ­¥éª¤ 6 ä¸­çš„`label`ç±»æ—è¾¹ä¸º`total`æ·»åŠ å¦ä¸€ä¸ªç±»ã€‚

```
.total {
  font-size: 20px;
  font-weight: 600;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œç¼–å·çš„è¯„è®ºç³»ç»Ÿæœ‰ç‚¹ç²—ç³™ï¼Œä½†æ˜¯å¦‚æœä½ å·²ç»åšåˆ°äº†è¿™ä¸€æ­¥ï¼Œä½ å°±è¶³å¤Ÿèªæ˜å»è·Ÿéšå®ƒã€‚æ¥ä¸‹æ¥çš„è¿™äº›åŠŸèƒ½å¯ä»¥æ”¾åœ¨`hideTotal`ä¸‹é¢ã€‚è¿™äº›æ˜¯æˆ‘ä»¬å°†åº”ç”¨äºæ¯ä¸ªåˆ‡ç‰‡çš„ä¾¦å¬å™¨ã€‚

```
function onMouseOver(d, i) {
  hideTotal()
  setPlayer(d.data)
  d3.select(this)
    .attr('fill', d3.rgb(lakersColors(i % 4)).brighter(0.5))
    .attr('stroke-width', 2)
    .attr('transform', 'scale(1.1)')
}

function onMouseOut(d, i) {
  setPlayer(null)
  showTotal()
  d3.select(this)
    .attr('fill', lakersColors(i % 4))
    .attr('stroke-width', 1)
    .attr('transform', 'scale(1)')
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ä¸€ä¸ªåˆ‡ç‰‡è¢«æ‚¬åœæ—¶ï¼Œç¬”ç”»å’Œå¡«å……å°†è¢«å¼ºè°ƒï¼Œè½»å¾®çš„æ”¾å¤§å°†å¢åŠ ä¸€ä¸ªé…·çš„æ•ˆæœã€‚æ€»ç‚¹æ•°æ–‡æœ¬ä¹Ÿå°†è¢«åˆ‡æ¢ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†ä¸€ä¸ªåŒ…å«æ›´å¤šä¿¡æ¯çš„å·¥å…·æç¤ºæ”¾åœ¨æ´é‡Œã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª`state`ï¼Œå¦‚æœæ²¡æœ‰å®ƒï¼Œä¸€ä¸ª**ååº”**åº”ç”¨ä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚

```
const [player, setPlayer] = useState(null) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ•é”çš„è§‚å¯Ÿè€…å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†å¯¹`this`çš„å¼•ç”¨ï¼Œå¹¶æƒ³çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆã€‚ä¸‹é¢çš„ä¾¦å¬å™¨éœ€è¦è¢«æ·»åŠ åˆ°`slices` **D3** é“¾çš„æœ«å°¾ã€‚

```
 .attr('class', 'slice')
   .on('mouseover', onMouseOver)
   .on('mouseout', onMouseOut) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› ä¸ºæˆ‘ä»¬åœ¨`slice`ç±»ä¸Šä½¿ç”¨äº†ä¸€ä¸ª`transform`ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬é€šè¿‡`Visualization`é£æ ¼çš„ç»„ä»¶ä¸­çš„å¦å¤–å‡ è¡Œæ¥æ§åˆ¶å®ƒã€‚

```
.slice {
  transition: transform 0.5s ease-in;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

10-æˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ›å»ºå·¥å…·æç¤ºæ¥æ˜¾ç¤º`player`çŠ¶æ€ï¼Œå®ƒéšç€å•ä¸ªåˆ‡ç‰‡çš„é¼ æ ‡ç§»åŠ¨è€Œæ”¹å˜ã€‚

```
{
  player ? (
    <Tooltip>
      <div>
        <span className='label'>Name: </span>
        <span>{player.name}</span>
        <br />
        <span className='label'>Points: </span>
        <span>{player.points}</span>
        <br />
        <span className='label'>Percent: </span>
        <span>{Math.round((player.points / total) * 1000) / 10}%</span>
      </div>
    </Tooltip>
  ) : null
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±æ–°ä¿¡æ¯è€Œè¨€ï¼Œç”¨æˆ·åªèƒ½è·å¾—å½“å‰ç©å®¶å¾—åˆ†å çƒé˜Ÿå¾—åˆ†çš„ç™¾åˆ†æ¯”ã€‚ç„¶è€Œï¼Œç”±äºä¸­å¿ƒä½ç½®ä¸è¿åŠ¨ç›¸ç»“åˆï¼Œäº§ç”Ÿäº†è‰¯å¥½çš„æ•ˆæœå’Œè‰¯å¥½çš„äº’åŠ¨æ„Ÿã€‚å¦‚æœæœ‰æ›´å¤šçš„ä¿¡æ¯æ˜¾ç¤ºæˆ–è€…æˆ‘æ›´èªæ˜ï¼Œç±»ä¼¼çš„æ¨¡å¼å¯ä»¥æ›´æœ‰æ•ˆåœ°ä½¿ç”¨ã€‚ä¼¼ä¹æœ€ä¸éœ€è¦çš„æ˜¯`Tooltip`ç»„ä»¶ï¼Œå®ƒä¸å…¶ä»–æ ·å¼çš„ç»„ä»¶ä¸€èµ·å‡ºç°ã€‚

```
export const Tooltip = styled.div`
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: ${radius * 0.7}px;
  height: ${radius * 0.7}px;
  display: grid;
  align-items: center;
  justify-items: center;
  border-radius: 50%;
  margin-top: 10px;
  font-size: 12px;
  background: #ffffff;
  .label {
    font-weight: 600;
  }
` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å”‰ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ä»£ç åº”è¯¥çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ã€‚

```
import React, { useRef, useEffect, useState } from 'react'
import * as d3 from 'd3'
import data from './data'
import styled, { createGlobalStyle } from 'styled-components'

/**
 * Constants
 */
const width = 1000
const height = 600
const radius = Math.min(width, height) / 2
const black = '#333333'
const title = 'Los Angeles Lakers Scoring 2018-19'

/**
 * D3 Helpers
 */

// total points
var total = d3.sum(data, d => d.points)

// lakers colors
var lakersColors = d3
  .scaleLinear()
  .domain([0, 1, 2, 3])
  .range(['#7E1DAF', '#C08BDA', '#FEEBBD', '#FDBB21'])

// pie transformation
var pie = d3
  .pie()
  .sort((a, b) => {
    return a.name.length - b.name.length
  })
  .value(d => d.points)(data)

// inner arc used for pie chart
var arc = d3
  .arc()
  .outerRadius(radius * 0.7)
  .innerRadius(radius * 0.4)

// outer arc used for labels
var outerArc = d3
  .arc()
  .outerRadius(radius * 0.9)
  .innerRadius(radius * 0.9)

// midAngle helper function
function getMidAngle(d) {
  return d.startAngle + (d.endAngle - d.startAngle) / 2
}
/**
 * Global Style Sheet
 */
export const GlobalStyle = createGlobalStyle`
@import url('https://fonts.googleapis.com/css?family=Raleway:400,600&display=swap');

body {
  font-family: 'Raleway', Arial, Helvetica, sans-serif;
  color: ${black};
  padding: 0;
  margin: 0;
}
`

/**
 * Styled Components
 */
export const Container = styled.div`
  display: grid;
  grid-template-rows: 30px 1fr;
  align-items: center;
  user-select: none;
  .title {
    font-size: 25px;
    font-weight: 600;
    padding-left: 20px;
  }
`

export const Visualization = styled.div`
  justify-self: center;
  width: ${width}px;
  height: ${height}px;
  .slice {
    transition: transform 0.5s ease-in;
  }
  .label {
    font-size: 12px;
    font-weight: 600;
  }
  .total {
    font-size: 20px;
    font-weight: 600;
  }
`

export const Tooltip = styled.div`
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: ${radius * 0.7}px;
  height: ${radius * 0.7}px;
  display: grid;
  align-items: center;
  justify-items: center;
  border-radius: 50%;
  margin-top: 10px;
  font-size: 12px;
  background: #ffffff;
  .label {
    font-weight: 600;
  }
`

export default () => {
  const [player, setPlayer] = useState(null)

  const visualization = useRef(null)

  useEffect(() => {
    var svg = d3
      .select(visualization.current)
      .append('svg')
      .attr('width', width)
      .attr('height', height)
      .append('g')
      .attr('transform', `translate(${width / 2}, ${height / 2})`)

    svg
      .selectAll('slices')
      .data(pie)
      .enter()
      .append('path')
      .attr('d', arc)
      .attr('fill', (d, i) => lakersColors(i % 4))
      .attr('stroke', black)
      .attr('stroke-width', 1)
      .attr('class', 'slice')
      .on('mouseover', onMouseOver)
      .on('mouseout', onMouseOut)

    svg
      .selectAll('lines')
      .data(pie)
      .enter()
      .append('polyline')
      .attr('stroke', black)
      .attr('stroke-width', 1)
      .style('fill', 'none')
      .attr('points', d => {
        var posA = arc.centroid(d)
        var posB = outerArc.centroid(d)
        var posC = outerArc.centroid(d)
        var midAngle = getMidAngle(d)
        posC[0] = radius * 0.95 * (midAngle < Math.PI ? 1 : -1)
        return [posA, posB, posC]
      })

    svg
      .selectAll('labels')
      .data(pie)
      .enter()
      .append('text')
      .text(d => {
        var midAngle = getMidAngle(d)
        return midAngle < Math.PI
          ? `${d.data.name} - ${d.data.points}`
          : `${d.data.points} - ${d.data.name}`
      })
      .attr('class', 'label')
      .attr('transform', d => {
        var pos = outerArc.centroid(d)
        var midAngle = getMidAngle(d)
        pos[0] = radius * 0.99 * (midAngle < Math.PI ? 1 : -1)
        return `translate(${pos})`
      })
      .style('text-anchor', d => {
        var midAngle = getMidAngle(d)
        return midAngle < Math.PI ? 'start' : 'end'
      })

    function showTotal() {
      svg
        .append('text')
        .text(`Total: ${total}`)
        .attr('class', 'total')
        .style('text-anchor', 'middle')
    }

    function hideTotal() {
      svg.selectAll('.total').remove()
    }

    function onMouseOver(d, i) {
      hideTotal()
      setPlayer(d.data)
      d3.select(this)
        .attr('fill', d3.rgb(lakersColors(i % 4)).brighter(0.5))
        .attr('stroke-width', 2)
        .attr('transform', 'scale(1.1)')
    }

    function onMouseOut(d, i) {
      setPlayer(null)
      showTotal()
      d3.select(this)
        .attr('fill', lakersColors(i % 4))
        .attr('stroke-width', 1)
        .attr('transform', 'scale(1)')
    }

    showTotal()
  }, [])

  return (
    <>
      <GlobalStyle />
      <Container>
        <div className='title'>{title}</div>
        <Visualization ref={visualization} />
        {player ? (
          <Tooltip>
            <div>
              <span className='label'>Name: </span>
              <span>{player.name}</span>
              <br />
              <span className='label'>Points: </span>
              <span>{player.points}</span>
              <br />
              <span className='label'>Percent: </span>
              <span>{Math.round((player.points / total) * 1000) / 10}%</span>
            </div>
          </Tooltip>
        ) : null}
      </Container>
    </>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[**NBA çƒå‘˜è–ªèµ„&è¡¨ç° 2018-19(æ³¡æ³¡å›¾)**](https://benjaminadk.github.io/d3-nba-salaries/)

[**çµæ„Ÿä¸¾ä¾‹ç”œç”œåœˆå›¾**](https://www.d3-graph-gallery.com/graph/donut_label.html)