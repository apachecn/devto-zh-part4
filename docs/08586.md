# äº‘ç«¯æ— ç­¾åä¸Šä¼ å’Œäººè„¸æ£€æµ‹

> åŸæ–‡:[https://dev . to/codingcatdev/cloud inary-unsigned-upload-and-face-detection-IGE](https://dev.to/codingcatdev/cloudinary-unsigned-upload-and-face-detection-ige)

# [](#face-smash-demo-project)é¢éƒ¨ç²‰ç¢æ¼”ç¤ºé¡¹ç›®

æˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ªå«åš Face Smash çš„ Ionic å·¥ä½œå®¤å’Œ Cloudinary æ¼”ç¤ºï¼Œå®ƒå…è®¸ä½ ä¸Šä¼ ä¸€å¼ ç…§ç‰‡ï¼Œç„¶åè¢«ä¸€ä¸ªæ°´çƒå‡»ä¸­ã€‚

ä½¿ç”¨ [Cloudinary ä¸Šä¼  API](https://cloudinary.com/documentation/image_upload_api_reference) ç”¨æˆ·å¯ä»¥ä¸Šä¼ ä¸€å¼ ç…§ç‰‡ï¼Œç„¶åä½¿ç”¨ [Cloudinary çš„äººè„¸æ£€æµ‹](https://cloudinary.com/blog/face_detection_based_cropping)å®ƒä¼šæ˜¾ç¤ºæ‰€æœ‰ä¸Šä¼ æ–‡ä»¶çš„åˆ—è¡¨å’Œä»–ä»¬çš„è„¸(ä½ çš„åº”è¯¥åœ¨é¡¶éƒ¨)ï¼Œå½“ä½ ç‚¹å‡»è¿™ä¸ªå®ƒä¼šç”¨æ°´çƒæ‰“ç¢ä½ çš„è„¸ã€‚

## [](#what-is-ionic-studio)ä»€ä¹ˆæ˜¯ç¦»å­å·¥ä½œå®¤

ä¸€ä¸ªå¼ºå¤§çš„ IDEï¼Œä¸ºä½¿ç”¨ Ionic æ„å»ºçš„å›¢é˜Ÿæä¾›æµç•…çš„å¼€å‘ä½“éªŒã€‚ä»å•ä¸€å·¥å…·å¼€å§‹ï¼Œä»¥æœ€å¿«ã€æœ€ç®€å•çš„æ–¹å¼åˆ›å»ºå±¡è·æ®Šè£çš„è·¨å¹³å°åº”ç”¨ç¨‹åºã€‚

Ionic Studio çš„åŸå› ç”± Ionic çš„é¦–å¸­æ‰§è¡Œå®˜ Max Lynch åœ¨åšå®¢æ–‡ç« [ä¸­å®Œç¾åœ°é™ˆè¿°:Ionic Studio:ä¸€ç§å¼ºå¤§çš„æ„å»ºåº”ç”¨çš„æ–°æ–¹å¼](https://ionicframework.com/blog/announcing-ionic-studio-a-powerful-new-way-to-build-apps/)

ä»Šå¤©å°±æ¥çœ‹çœ‹ [Ionic Studio](https://ionicframework.com/studio) å§ï¼

## [](#what-is-cloudinary)ä»€ä¹ˆæ˜¯ Cloudinary

åœ¨ [JAMStack](https://jamstack.org/) é¢†åŸŸï¼Œ [Cloudinary](https://cloudinary.com) æ˜¯æä¾›å…¨é¢çš„åŸºäºäº‘çš„å›¾åƒå’Œè§†é¢‘ç®¡ç†å¹³å°çš„å¸‚åœºé¢†å¯¼è€…ã€‚ä»å°å‹åˆ›ä¸šå…¬å¸åˆ°å¤§å‹ä¼ä¸šï¼Œå…¨çƒæœ‰æˆåƒä¸Šä¸‡çš„ç”¨æˆ·æ­£åœ¨ä½¿ç”¨ Cloudinaryã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™æ˜¯å½“ä»Šåœ¨ç½‘ç»œä¸Šæ‰˜ç®¡åª’ä½“çš„æœ€ä½³è§£å†³æ–¹æ¡ˆï¼

## [](#cloudinary-api-upload)Cloudinary API ä¸Šä¼ 

### [](#image-upload-api)å›¾ç‰‡ä¸Šä¼  API

ä½¿ç”¨[å›¾åƒä¸Šä¼  API](https://cloudinary.com/documentation/image_upload_api_reference) ï¼Œæœ‰å‡ ç§ä¸åŒçš„ SDK å¯ç”¨äºå°†å›¾åƒä¸Šä¼ åˆ° Cloudinaryã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†åªå¯¹æœªç­¾åçš„ä¸Šä¼ ä½¿ç”¨ç«¯ç‚¹ç±»å‹ã€‚æˆ‘åˆšå¥½æœ‰ä¸€å¼ è‡ªå·±æˆ´ç€æ¢¦å¯ä»¥æ±‚çš„çˆ±å¥¥å°¼äºšå¸½å­çš„ç…§ç‰‡

[![Ionic hat](../Images/2e170da63dce02d431a75a8361de1c59.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--uZxBVJxN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_400/v1565636611/AlexPics/alex_ionic_hat_inside.jpg)

åœ¨è¿™ä¸ªåšå®¢ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`file`å‚æ•°
æ¥å¼•ç”¨è¿™å¼ å›¾ç‰‡

```
file=https://res.cloudinary.com/ajonp/image/upload/v1565636611/AlexPics/alex_ionic_hat_inside.jpg 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Cloudinary å°†è‡ªåŠ¨å¤åˆ¶è¯¥æ–‡ä»¶ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ° Cloudinaries æœåŠ¡å™¨ä¸Šçš„æ–°ä½ç½®(è¯·æ³¨æ„ï¼Œè™½ç„¶æˆ‘ä½¿ç”¨çš„æ˜¯ cloudinary å›¾åƒ urlï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½• URL)ã€‚

åœ¨ AJonP çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†è®©ç”¨æˆ·æ‹æ‘„ä¸€å¼ ç…§ç‰‡ï¼Œä¹Ÿå°†ä½¿ç”¨`file`å‚æ•°å¼•ç”¨è¯¥ç…§ç‰‡ï¼Œä½†æ˜¯å®ƒå°†å‘ç«¯ç‚¹å‘é€ Base64 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚

è¯·æŸ¥çœ‹[æ—¥æœŸä¸Šä¼ é€‰é¡¹](https://cloudinary.com/documentation/upload_images#data_upload_options)äº†è§£æ‰€æœ‰å¯ç”¨ä¿¡æ¯ã€‚

### [](#unsigned-uploads)æœªç­¾åä¸Šä¼ 

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»ä½¿ç”¨`upload_preset`å‚æ•°ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æœªç­¾åçš„ä¸Šä¼ ã€‚Unsigned upload æ˜¯ä¸€ä¸ªç›´æ¥ä»æµè§ˆå™¨æˆ–ç§»åŠ¨åº”ç”¨ç¨‹åºæ‰§è¡Œä¸Šä¼ çš„é€‰é¡¹ï¼Œä¸éœ€è¦è®¤è¯ç­¾åï¼Œä¹Ÿä¸éœ€è¦é€šè¿‡æ‚¨çš„æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œå‡ºäºå®‰å…¨åŸå› ï¼Œåœ¨æ‰§è¡Œæœªç­¾åçš„ä¸Šè½½è°ƒç”¨æ—¶ï¼Œå¹¶éæ‰€æœ‰ä¸Šè½½å‚æ•°éƒ½å¯ä»¥ç›´æ¥æŒ‡å®šã€‚

æ­£æ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä¸å¾—ä¸åœ¨æˆ‘çš„[æ§åˆ¶å°](https://cloudinary.com/console/settings/upload)ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¼ é¢„ç½®ã€‚ã€T2![Upload Preset](../Images/2be17b5e4dfb9e28bd5b16296000aa6b.png)

è¯¥é¢„è®¾å°†æ‰€æœ‰æ–°ä¸Šä¼ çš„ç…§ç‰‡æ”¾å…¥æ–‡ä»¶å¤¹ ajonp-ionic-cloud inary-face smash æ–‡ä»¶å¤¹ä¸­ã€‚[![preset folder](../Images/89c030943472c40f9ac0cfb30e5c86d9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--YU-mB_pX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1565638259/ajonp-ajonp-com/blog/Screen_Shot_2019-08-12_at_3.30.49_PM.png)

ç°åœ¨å½“æˆ‘ä»¬éœ€è¦ä¸Šä¼ å’Œè§¦å‘è¿™ä¸ªé¢„ç½®æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬çš„å‚æ•°è®¾ç½®ä¸º`upload_preset`

```
upload_preset=kuqm4xkg 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#endpoint-upload)ç«¯ç‚¹ä¸Šä¼ 

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†æ‰€æœ‰è¿™äº›å·¥ä½œçš„æµç¨‹ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ç«¯ç‚¹æ¥å®Œæˆå®é™…çš„ä¸Šä¼ ã€‚

<video controls="controls"><source src="https://res.cloudinary.com/ajonp/video/upload/v1565651945/ajonp-ajonp-com/blog/cloudinary_api_endpoing_upload.webm" type="video/webm"> <source src="https://res.cloudinary.com/ajonp/video/upload/v1565651945/ajonp-ajonp-com/blog/cloudinary_api_endpoing_upload.mp4" type="video/mp4"></video> 

```
https://api.cloudinary.com/v1_1/ajonp/image/upload?file=https://res.cloudinary.com/ajonp/image/upload/v1565636611/AlexPics/alex_ionic_hat_inside.jpg&upload_preset=kuqm4xkg 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦ä¸Šä¼ å®Œæ¯•ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€äº›è¿”å›çš„ json è´Ÿè½½ã€‚

```
{
  "public_id": "ajonp-ionic-cloudinary-facesmash/raumizdelqrlows7pvzy",
  "version": 1565650174,
  "signature": "59905774f17ea06629ff90b73dfc9bed6c7fbdfd",
  "width": 2448,
  "height": 3264,
  "format": "jpg",
  "resource_type": "image",
  "created_at": "2019-08-12T22:49:34Z",
  "tags": [
    "facesmash",
    "face",
    "head",
    "chin",
    "selfie",
    "forehead",
    "photography",
    "fun"
  ],
  "pages": 1,
  "bytes": 1882858,
  "type": "upload",
  "etag": "4ae8ba0edfb90689101fdfbb8b97548d",
  "placeholder": false,
  "url": "http://res.cloudinary.com/ajonp/image/upload/v1565650174/ajonp-ionic-cloudinary-facesmash/raumizdelqrlows7pvzy.jpg",
  "secure_url": "https://res.cloudinary.com/ajonp/image/upload/v1565650174/ajonp-ionic-cloudinary-facesmash/raumizdelqrlows7pvzy.jpg",
  "access_mode": "public",
  "moderation": [
    {
      "response": { "moderation_labels": [] },
      "status": "approved",
      "kind": "aws_rek",
      "updated_at": "2019-08-12T22:49:36Z"
    }
  ],
  "info": {
    "categorization": {
      "google_tagging": {
        "status": "complete",
        "data": [
          { "tag": "Face", "confidence": 0.9635 },
          { "tag": "Head", "confidence": 0.9097 },
          { "tag": "Chin", "confidence": 0.8504 },
          { "tag": "Selfie", "confidence": 0.8183 },
          { "tag": "Forehead", "confidence": 0.7823 },
          { "tag": "Photography", "confidence": 0.738 },
          { "tag": "Fun", "confidence": 0.7039 },
          { "tag": "Headgear", "confidence": 0.6748 },
          { "tag": "Cap", "confidence": 0.6577 },
          { "tag": "T-shirt", "confidence": 0.5763 },
          { "tag": "Smile", "confidence": 0.5404 }
        ]
      }
    }
  },
  "faces": [[132, 906, 808, 1077]],
  "coordinates": { "faces": [[132, 906, 808, 1077]] },
  "original_filename": "alex_ionic_hat_inside"
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œçš„å…³é”®ä¸€è¡Œæ˜¯ï¼Œå®ƒå®é™…ä¸Šåœ¨åæ ‡`"coordinates": { "faces": [[132, 906, 808, 1077]] },`ä¸­æ‹¾å–äº†ä¸€å¼ è„¸ã€‚ä»ç„¶æ²¡æœ‰ğŸ’¯%è¿˜å¾ˆå®Œç¾ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªè¡Œä¸é€šçš„ä¾‹å­ã€‚

[![Alex Ionic Hat Outside](../Images/5f91ac39949bfa327f48d71a7d540bd4.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--nIn9SWQH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_200/v1565636611/AlexPics/alex_ionic_hat.jpg)T3ã€‘

```
"coordinates":{"faces":[]} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘å¸Œæœ›ä¸ [Cloudinary å›¢é˜Ÿ](https://cloudinary.com/team)åˆä½œï¼Œçœ‹çœ‹æˆ‘æ˜¯å¦èƒ½ä»¥ä»»ä½•æ–¹å¼å¸®åŠ©æé«˜æ£€æµ‹ç‡ã€‚

## [](#how-to-use-cloudinary-face-detection)å¦‚ä½•ä½¿ç”¨äº‘çŠ¶äººè„¸æ£€æµ‹

æ–‡æ¡£ä¸­æœ‰å¤§é‡çš„ä¿¡æ¯æ¶µç›–äº†äº‘äººè„¸æ£€æµ‹ã€‚

å¾ˆç®€å•ï¼Œè¾“å…¥`g_face`å‚æ•°å°†ä¼šç»™å›¾åƒä¸­æœ€å¤§çš„è„¸éƒ¨ä½ç½®å¢åŠ â€œé‡åŠ›â€,ç„¶åä½ å¯ä»¥å¼€å§‹åšä½ è®¤ä¸ºåˆé€‚çš„å›¾åƒæ“ä½œã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºä¸­ï¼Œæˆ‘æ‰“ç®—å°†æ‰€æœ‰çš„å›¾ç‰‡æ·»åŠ ä¸ºç¼©ç•¥å›¾ã€‚

è¿™æ˜¯æˆ‘ä»¬çš„æ ·æœ¬å›¾ç‰‡ç¼©ç•¥å›¾

```
http://res.cloudinary.com/ajonp/image/upload/w_1000,h_1000,c_crop,g_face,r_max/w_200/v1565650174/ajonp-ionic-cloudinary-facesmash/raumizdelqrlows7pvzy.jpg 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[![Cropped Sample Thumbnail](../Images/35fc3bc411be629d59e98bb7c7395af9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--RsxnMnKs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/http://res.cloudinary.com/ajonp/image/upload/w_1000%2Ch_1000%2Cc_crop%2Cg_face%2Cr_max/w_200/v1565650174/ajonp-ionic-cloudinary-facesmash/raumizdelqrlows7pvzy.jpg)

## [](#understandable-sidenote)å¯ä»¥ç†è§£çš„æ—æ³¨

æˆ‘ä¸ç¦æƒ³èµ·äº†ç¤¾äº¤ç½‘ç»œçš„ [Facemashï¼Œæˆ‘ä¸æƒ³è®©ä»–ä»¬æ··æ·†ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰è¶£çš„é¡¹ç›®ï¼Œæˆ‘ä»¬ä¸ä¼šç»™ä»»ä½•äººè¯„åˆ†ğŸ¤¢ï¼ï¼æˆ‘å¸Œæœ›äºšé©¬é€Šçš„äººå·¥æ™ºèƒ½å®¡æ ¸èƒ½æŠ“ä½å¤§éƒ¨åˆ†ä¸å¥½çš„ä¸œè¥¿ã€‚å¦‚æœå±€é¢å¤±æ§ï¼Œæˆ‘ä¼šæŠŠå®ƒæ¨å€’ã€‚](https://youtu.be/VSKoVsHs_Ko)

æ‰€ä»¥æˆ‘åªæ˜¯å¸Œæœ›æ¯ä¸ªäººéƒ½ä¿æŒå†·é™ï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºä¸ä¼šè´¬ä½ä»»ä½•äººï¼æˆ‘ä»æ¥ä¸æƒ³è´¬ä½ä»»ä½•äººï¼Œä¹Ÿä¸æƒ³åƒæ‰å…‹é‚£æ ·å†™ä¸€ä¸ª [facemash é“æ­‰](https://www.thecrimson.com/article/2003/11/19/facemash-creator-survives-ad-board-the/)ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨ä½ å¯ä»¥è‡ªå·±ä¸Šä¼ çš„ç…§ç‰‡ã€‚