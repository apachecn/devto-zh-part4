# å®ç”¨ RxJS å’Œè§’åº¦

> åŸæ–‡:[https://dev.to/gc_psk/practical-rxjs-and-angular-5heg](https://dev.to/gc_psk/practical-rxjs-and-angular-5heg)

ä¸ RxJS **ä¸€èµ·å·¥ä½œæœ‰ç‚¹åƒæ‹¥æœ‰è¶…èƒ½åŠ›**:ä½ çš„èƒ½åŠ›å…è®¸ä½ åšéå‡¡çš„äº‹æƒ…ï¼Œä½†å®ƒä»¬å¾ˆå®¹æ˜“è¢«æ»¥ç”¨ï¼Œå½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶â€”â€”å®ƒä¼šéå¸¸å±é™©ï¼

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³è°ˆè°ˆæˆ‘åœ¨ä½¿ç”¨ Angular å’Œ RxJS æ—¶å‘ç°æœ‰ç”¨çš„å®é™…åœºæ™¯ï¼Œæµè§ˆä¸€ä¸‹æ‚¨å¯èƒ½ä½¿ç”¨çš„æœ‰ç”¨æ¨¡å¼ä»¥åŠéœ€è¦æ³¨æ„çš„äº‹é¡¹ã€‚

ä»åªæ¶‰åŠæ˜¾ç¤ºåˆ—è¡¨çš„åŸºæœ¬æƒ…å†µå¼€å§‹ï¼Œæˆ‘ä»¬å°†è¿›å…¥æ›´å¤æ‚çš„æƒ…å†µï¼Œä¾‹å¦‚åœæ­¢æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚ã€å»¶è¿Ÿç”¨æˆ·çš„è¾“å…¥ä»¥åŠç”¨*ä¸»é¢˜*å­˜å‚¨æ•°æ®ã€‚

## RxJS çš„åŸºç¡€çŸ¥è¯†

### [](#getting-and-displaying-data-with-http%C2%A0client)é€šè¿‡ HTTP å®¢æˆ·ç«¯è·å–å¹¶æ˜¾ç¤ºæ•°æ®

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Angular çš„ HTTP å®¢æˆ·ç«¯ä» Github çš„ API è·å–å­˜å‚¨åº“ï¼Œå¹¶å°†å…¶æ˜¾ç¤ºä¸ºä¸€ä¸ªåˆ—è¡¨ã€‚è¿™æ˜¯ç»„ä»¶çš„å¤–è§‚:

[![](img/afc2ff0b225da4cdc64de57a07f599bd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jByeX5vF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1600/1%2AV_yVBwZ0AluJFmDf2kxzxQ.png)

å‘Šè¯‰è¿‡ä½ è¿™å¾ˆç®€å•ï¼

è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä½¿ç”¨ CLI åˆ›å»ºçš„åŠŸèƒ½æ€§è§’åº¦å·¥ä½œç©ºé—´ï¼Œå¹¶ä¸”æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º *GithubRepositoriesComponent çš„æ–°è·¯å¾„ã€‚*è¿™æ˜¯å®ƒæœ€åˆçš„æ ·å­:

```
@Component({
    selector: 'app-github-repositories',
    templateUrl: './github-repositories.component.html',
    styleUrls: ['./github-repositories.component.scss'],
    changeDetection: ChangeDetectionStrategy.OnPush
})
export class GithubRepositoriesComponent {} 
```

> ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†å¯¹ç»„ä»¶ä¸­çš„æ‰€æœ‰é€»è¾‘è¿›è¡Œç¼–ç ã€‚è™½ç„¶æˆ‘ä¸å»ºè®®è¿™æ ·åšï¼

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åšä»¥ä¸‹äº‹æƒ…:

*   æˆ‘ä»¬é€šè¿‡ä¾èµ–æ³¨å…¥å¯¼å…¥ *HttpClient*
*   æˆ‘ä»¬å£°æ˜äº†ä¸¤ä¸ªæ–¹æ³•: *onTextChangeï¼Œ*å®ƒåªæ˜¯è¾“å…¥å…ƒç´ çš„å¤„ç†ç¨‹åºï¼Œä»¥åŠ *fetchRepositoriesï¼Œ*å®ƒè´Ÿè´£æ‰§è¡Œå¯¹ API çš„è¯·æ±‚
*   æˆ‘ä»¬å°† HTTP å®¢æˆ·ç«¯è¿”å›çš„å¯è§‚å¯Ÿå€¼åˆ†é…ç»™ *searchResult$*

```
import { ChangeDetectionStrategy, Component } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { RepositorySearchResponse } from '../../shared/models/repository-search-response.interface';

const GITHUB_URL = 'https://api.github.com/search/repositories';

@Component({
    selector: 'app-github-repositories',
    templateUrl: './github-repositories.component.html',
    styleUrls: ['./github-repositories.component.scss'],
    changeDetection: ChangeDetectionStrategy.OnPush
})
export class GithubRepositoriesComponent {
    searchResult$: Observable<RepositorySearchResponse>;

    constructor(private http: HttpClient) {
    }

    onTextChange(query: string) {
        this.searchResult$ = this.fetchRepositories(query);
    }

    private fetchRepositories(query: string): Observable<RepositorySearchResponse> {
        const params = { q: query };
        return this.http.get<RepositorySearchResponse>(GITHUB_URL, { params });
    }
} 
```

ç„¶åï¼Œç”±äº _async ç®¡é“ï¼Œæˆ‘ä»¬åœ¨ç»„ä»¶ä¸­è€Œä¸æ˜¯åœ¨æ¨¡æ¿ä¸­è®¢é˜…äº† *searchResult$ *ã€‚æ˜¯â€”æˆ‘ä»¬è®©å¼‚æ­¥ç®¡é“è®¢é˜…å®ƒï¼Œè€Œä¸æ˜¯åœ¨ç»„ä»¶å†…è®¢é˜…å¹¶å°†ç»“æœå€¼èµ‹ç»™æœ¬åœ°å±æ€§ã€‚** 

```
<h1>Github Repositories Search</h1>

<label class="mt-2">
    <span>Repository name:</span>

    <input type="text"
           class="ml-2"
           [ngModel]="''"
           (ngModelChange)="onTextChange($event)"
    />
</label>

<div *ngIf="(searchResult$ | async) as searchResult">
    <h2>Repositories</h2>

    <ng-container [ngSwitch]="searchResult.items.length">
        <ng-container *ngSwitchCase="0">
            No results found
        </ng-container>

        <ng-container *ngSwitchDefault>
            <div *ngFor="let result of searchResult.items">
                {{ result.name }}
            </div>
        </ng-container>
    </ng-container>
</div> 
```

ä½†æ˜¯ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºæœ¬è€Œä¸”ç›¸å½“ç”Ÿç–çš„æœç´¢è¡¨å•ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€äº› RxJS é­”æ³•æ¥æ”¹è¿›å®ƒã€‚

> æ¨¡æ¿ä½¿ç”¨äº†ä¸€äº›æœ‰ç”¨çš„å¼•å¯¼ç±»æ¥è®¾è®¡æ ·å¼

### [](#skipping-requests)è·³è¿‡è¯·æ±‚

æˆ‘ä»¬æƒ³æˆä¸ºä¼˜ç§€çš„ç¨‹åºå‘˜ï¼Œå› æ­¤æˆ‘ä»¬å°½é‡ä¸æ¶ˆè€—æˆ‘ä»¬æœåŠ¡ä¸­çš„å®è´µèµ„æºã€‚RxJS é€šè¿‡å…¶å¼ºå¤§çš„æ“ä½œå™¨å¸®åŠ©äº†æˆ‘ä»¬ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬æœ€åˆçš„è§£å†³æ–¹æ¡ˆå­˜åœ¨ä¸€äº›é—®é¢˜:

*   å¦‚æœæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªç©ºæ ¼ï¼Œè¯·æ±‚ä¼šè¢«å†æ¬¡å‘å‡º
*   ä¸€æ—¦æ¨¡å‹å‘ç”Ÿå˜åŒ–ï¼Œè¯·æ±‚å°±ä¼šè¿è¡Œ
*   å¦‚æœç”¨æˆ·åœ¨è¯·æ±‚å®Œæˆå‰è¾“å…¥äº†æŸäº›å†…å®¹ï¼Œè¯·æ±‚ä¼šç»§ç»­è¿è¡Œ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›æ–°çš„æ“ä½œç¬¦æ¥é¿å…è¿™äº›é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿéœ€è¦ç¨å¾®é‡æ„ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ã€‚

è¿™æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„:

*   æˆ‘ä»¬æ²¡æœ‰åœ¨æ¯æ¬¡æ¨¡å‹æ”¹å˜æ—¶é‡æ–°åˆ†é…æˆ‘ä»¬çš„å¯è§‚å¯Ÿå€¼ï¼Œè€Œæ˜¯åœ¨ç»„ä»¶å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æµã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ª*ä¸»é¢˜*ï¼Œè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢æµ
*   æˆ‘ä»¬ä¿®å‰ªå¹¶è§„èŒƒåŒ–æˆ‘ä»¬çš„æŸ¥è¯¢æµï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥**è¿‡æ»¤**ç©ºæŸ¥è¯¢
*   æˆ‘ä»¬æ·»åŠ æ“ä½œç¬¦*å»æŠ–æ—¶é—´(500)* ï¼Œä»¥ä¾¿æ¯ 500 æ¯«ç§’å¯¹æŸ¥è¯¢è¿›è¡Œ**å»æŠ–**
*   æˆ‘ä»¬æ·»åŠ äº† *distinctUntilChangedï¼Œ*ï¼Œå¦‚æœè¿ç»­è¾“å…¥æŸ¥è¯¢ï¼Œ**å°†è·³è¿‡**ä¸ªè¯·æ±‚
*   æˆ‘ä»¬ç”¨ *switchMap* å°†æŸ¥è¯¢æµæ˜ å°„ä¸ºä¸€ä¸ªè¯·æ±‚æµ

è€ƒè™‘å¯¹æˆ‘ä»¬çš„åˆå§‹è§£å†³æ–¹æ¡ˆè¿›è¡Œä»¥ä¸‹æ›´æ”¹:

*ä¸ºä»€ä¹ˆé€‰æ‹© switchMapï¼Ÿ* switchMap ä¸ä»…å°†æŸ¥è¯¢æ˜ å°„åˆ° HTTP è¯·æ±‚ï¼Œè¿˜ä¼šå–æ¶ˆä»»ä½•æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚ã€‚è¯·å‚è§ä»¥ä¸‹å†…å®¹:

[![](img/b39a9e9a86b26e086d82d60807d2849c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--WDDu6UW1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/1600/1%2AQOncAKIrICia9bNZPCh10A.gif)

æˆ‘è¾“å…¥äº†ä¸€ä¸ªå¯èƒ½è¦èŠ±å¾ˆå¤šæ—¶é—´çš„æœç´¢è¯ï¼Œæ‰€ä»¥åœ¨æœç´¢è¯·æ±‚è¿è¡Œæ—¶ï¼Œæˆ‘æœ‰è¶³å¤Ÿçš„æ—¶é—´é‡æ–°è¾“å…¥ä¸€ä¸ªè¯ã€‚

æ­£å¦‚æ‚¨åœ¨ network é€‰é¡¹å¡ä¸­çœ‹åˆ°çš„ï¼Œå‰ä¸‰ä¸ªè¯·æ±‚è¢«å–æ¶ˆäº†ï¼

è€¶ï¼ğŸ‰

* * *

æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯ä»¥åšçš„ä¸‹ä¸€ä»¶äº‹æ˜¯ï¼Œå½“æˆ‘ä»¬å°†é¼ æ ‡æ‚¬åœåœ¨å­˜å‚¨åº“åç§°ä¸Šæ—¶ï¼Œæ˜¾ç¤ºæ‰€æœ‰è€…çš„ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºå§“åã€å¤´åƒã€ç®€å†å’Œæ‰€æœ‰è€…æ‰€å±çš„ç»„ç»‡ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦æå‡ºä¸€ä¸ªé¢å¤–çš„è¯·æ±‚ã€‚

æˆ‘ä»¬éœ€è¦åšä»€ä¹ˆï¼Ÿ

*   å½“ç”¨æˆ·æ‚¬åœå¹¶ç¦»å¼€å­˜å‚¨åº“é¡¹ç›®æ—¶åˆ›å»ºä¸€ä¸ªå¤„ç†ç¨‹åº
*   å½“é¼ æ ‡æ‚¬åœåœ¨å­˜å‚¨åº“ä¸Šæ—¶è·å–ç»„ç»‡ï¼Œå½“é¼ æ ‡ç¦»å¼€æ—¶é‡ç½®
*   å› ä¸ºåœ¨æˆ‘ä»¬çš„åˆ—è¡¨ä¸­ä¿ç•™å±äºç»„ç»‡çš„å­˜å‚¨åº“æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæˆ‘ä»¬å°†å€ŸåŠ©ä¸€ä¸ªå¼ºå¤§çš„è‡ªå®šä¹‰æ“ä½œç¬¦æ¥è¿‡æ»¤å®ƒï¼
*   ä¸ºäº†ç®€åŒ–ï¼Œç¨å¾®é‡æ„ä¸€ä¸‹æˆ‘ä»¬çš„åˆå§‹ä»£ç 

### [](#custom-operators)è‡ªå®šä¹‰è¿ç®—ç¬¦

åˆ›å»ºè‡ªå®šä¹‰æ“ä½œç¬¦æ˜¯ä¸€é¡¹éå¸¸æœ‰ç”¨çš„æŠ€æœ¯ï¼Œå¯¹äºé‡ç”¨æˆ‘ä»¬åœ¨ç±»ä¼¼æƒ…å†µä¸‹æœ€ç»ˆä¼šç”¨åˆ°çš„ä¸€äº›é€»è¾‘ï¼Œæˆ–è€…é€šè¿‡å°†é€šç”¨æ“ä½œç¬¦ä¸æˆ‘ä»¬çš„é¢†åŸŸä¸šåŠ¡é€»è¾‘æ··åˆåœ¨ä¸€èµ·ï¼Œä½¿å…¶æ›´å…·å£°æ˜æ€§ï¼Œä»è€Œæé«˜å¯è¯»æ€§ï¼Œè¿™ç§æŠ€æœ¯éå¸¸æœ‰ç”¨ã€‚

ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æƒ³è¦æ·»åŠ ä¸€ä¸ªæ“ä½œç¬¦æ¥è¿‡æ»¤ä¸€ä¸ªå¯è§‚å¯Ÿåˆ°çš„å­˜å‚¨åº“ï¼Œå…¶ä¸­åªæœ‰å­˜å‚¨åº“å±äºä¸€ä¸ªç”¨æˆ·ï¼Œè€Œä¸å±äºä¸€ä¸ªç»„ç»‡ã€‚

ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„:

```
import { map } from 'rxjs/operators';

import { OwnerType } from '../enums/owner-type.enum';
import { Repository } from '../models/repository.interface';

export const filterByOwnerType = (type: OwnerType) => {
    const filterFn = (repository: Repository) => repository.owner.type === type;

    return map((repositories: Repository[]) => {
        return repositories.filter(filterFn);
    });
}; 
```

è¿™æ®µä»£ç ç®€å•åœ°å¯¹å­˜å‚¨åº“æ•°ç»„åº”ç”¨äº†ä¸€ä¸ªè¿‡æ»¤å‡½æ•°ï¼Œå¹¶å°†å…¶æ˜ å°„ä¸ºä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡ã€‚

### [](#complete-example)å®Œæ•´çš„ä¾‹å­

ä»£ç çš„å…¶ä½™éƒ¨åˆ†åº”è¯¥ç›¸å½“ç®€å•:

*   æˆ‘ä»¬ç”¨*å­˜å‚¨åº“$* æ›¿æ¢äº†*æœç´¢ç»“æœ$*
*   æˆ‘ä»¬æ·»åŠ äº†å¯è§‚å¯Ÿçš„*ç»„ç»‡$* å’Œ*é€‰æ‹©çš„å­˜å‚¨$* ä¸»é¢˜
*   å¤„ç†ç¨‹åº *onRepositoryMouseEvent* è´Ÿè´£æ›´æ–°*é€‰æ‹©çš„å­˜å‚¨åº“$*
*   è‡ªå®šä¹‰æ“ä½œç¬¦ *filterByUOwnerType* è¢«æ·»åŠ åˆ°*å­˜å‚¨åº“$* æµä¸­
*   åœ¨æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ç»„ç»‡åˆ—è¡¨å’Œæ‰€æœ‰è€…éƒ¨åˆ†ï¼Œå½“å­˜å‚¨åº“è¢«æ‚¬åœæ—¶ä¼šå‡ºç°

```
import { ChangeDetectionStrategy, Component, OnInit } from '@angular/core';
import { HttpClient } from '@angular/common/http';

// Rx
import { Observable, of, Subject } from 'rxjs';

import {
    debounceTime,
    distinctUntilChanged,
    filter,
    map,
    switchMap,
} from 'rxjs/operators';

import { filterByOwnerType } from '../../shared/operators/filter-by-owner-type';

// interfaces
import { RepositorySearchResponse } from '../../shared/models/repository-search-response.interface';
import { Organization } from '../../shared/models/organization.interface';
import { Repository } from '../../shared/models/repository.interface';
import { OwnerType } from '../../shared/enums/owner-type.enum';

const GITHUB_URL = 'https://api.github.com/search/repositories';

@Component({
    selector: 'app-github-repositories',
    templateUrl: './github-repositories.component.html',
    styleUrls: ['./github-repositories.component.scss'],
    changeDetection: ChangeDetectionStrategy.OnPush
})
export class GithubRepositoriesComponent implements OnInit {
    queries$ = new Subject<string>();
    selectedRepository$ = new Subject<Repository | undefined>();
    repositories$: Observable<Repository[]>;
    organizations$: Observable<Organization[]>;

    constructor(private http: HttpClient) {
    }

    ngOnInit() {
        this.repositories$ = this.queries$.pipe(
            map((query: string) => query ? query.trim() : ''),
            filter(Boolean),
            debounceTime(500),
            distinctUntilChanged(),
            switchMap((query: string) => this.fetchRepositories(query)),
            filterByOwnerType(OwnerType.User)
        );

        this.organizations$ = this.selectedRepository$.pipe(
            map((repository) => repository && repository.owner.organizations_url),
            switchMap((url: string | false) => {
                return url ? this.fetchUserOrganizations(url) : of(undefined);
            }),
        );
    }

    onTextChange(query: string) {
        this.queries$.next(query);
    }

    onRepositoryMouseEvent(repository: Repository | undefined) {
        this.selectedRepository$.next(repository);
    }

    private fetchRepositories(query: string): Observable<Repository[]> {
        const params = { q: query };

        return this.http
            .get<RepositorySearchResponse>(GITHUB_URL, { params })
            .pipe(
                map((response: RepositorySearchResponse) => response.items)
            );
    }

    private fetchUserOrganizations(url: string): Observable<Organization[]> {
        return this.http.get<Organization[]>(url);
    }
} 
```

```
<h1>Github Repositories Search</h1>

<label class="mt-2">
    <span>Repository name:</span>

    <input type="text"
           class="ml-2"
           [ngModel]="''"
           (ngModelChange)="onTextChange($event)"
    />
</label>

<div class="row">
    <div class="col-md-6" *ngIf="(repositories$ | async) as repositories">
        <h2>Repositories</h2>

        <ng-container [ngSwitch]="repositories.length">
            <ng-container *ngSwitchCase="0">
                No results found
            </ng-container>

            <div class="d-flex justify-content-between row" *ngSwitchDefault>
                <div class="col-md-6">
                    <!-- REPOS LIST -->
                    <div
                        *ngFor="let repository of repositories"
                        (mouseover)="onRepositoryMouseEvent(repository)"
                        (mouseleave)="onRepositoryMouseEvent(undefined)"
                    >
                        {{ repository.name }}
                    </div>
                </div>

                <div>
                    <!-- OWNER -->
                    <div *ngIf="(selectedRepository$ | async) as selectedRepository">
                        <h4>{{ selectedRepository.owner.login }}</h4>

                        <img [attr.src]="selectedRepository.owner.avatar_url"
                             width="200"
                             height="auto"
                             alt="avatar"
                        />
                    </div>

                    <!-- ORGANIZATIONS -->
                    <div *ngIf="(organizations$ | async) as organizations" class="mt-2">
                        <h6>Organizations</h6>

                        <div *ngFor="let org of organizations" class="d-inline-flex mr-2">
                            <img [attr.src]="org.avatar_url"
                                 width="50"
                                 height="50"
                                 alt="org avatar"
                            />
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>
</div> 
```

è¿™æ˜¯å®ƒçœ‹èµ·æ¥çš„æ ·å­:

[![](img/55c6fe6335b4412099180a8dfce54eb6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--u-lFK0ns--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/1600/1%2AukvZnxzqT3yTKitCVjvVJQ.gif)

å“¦ï¼Œå¯¹äº†ï¼Œé‚£æ˜¯æˆ‘ï¼ğŸ™„

## [](#state-management)çŠ¶æ€ç®¡ç†

ä¸ï¼Œè¿™ä¸æ˜¯å…³äº *NGRX* ï¼Œæˆ–è€… *Redux* çš„å¦ä¸€ç§è§£é‡Šã€‚

æˆ‘æƒ³å‘ä½ ä»¬å±•ç¤ºä¸€äº›é—®é¢˜ï¼Œå½“æˆ‘ä»¬ä»æˆ‘ä»¬çš„è§‚å¯Ÿå¯¹è±¡å’Œä¸»é¢˜ä¸­è·å–å½“å‰çŠ¶æ€æ—¶ã€‚

æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æƒ³è¦æ£€ç´¢æœ€æ–°æ”¶åˆ°çš„ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦é€šè¿‡æ¨¡æ¿ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œè¿™æ˜¯ç›¸å½“å®¹æ˜“çš„ã€‚

è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œå…è®¸ç”¨æˆ·å¯¼å‡ºå½“å‰çš„å­˜å‚¨åº“åˆ—è¡¨(å½“ç„¶ï¼Œæˆ‘ä»¬ä¸ä¼šå®ç°è¯¥åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬å°†åªè®°å½•åˆ—è¡¨)ã€‚

å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿ

è®©æˆ‘ä»¬åˆ›å»ºå¯¼å‡ºå‡½æ•°:

```
exportRepos() {  
    this.repositories$.subscribe(repos => {  
        console.log(repos);  
        // export function here }); 
    });
} 
```

çœ‹çœ‹å®ƒçš„è¡¨ç°å¦‚ä½•:

[![](img/caebdede2fa39229d74a5901fec9e4a7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--iVBKO_V7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/2400/1%2A0QLd2zSp8Dg6iXRUhYEtQw.gif)

æ­£å¦‚æ‚¨å¯èƒ½å·²ç»çœ‹åˆ°çš„ï¼Œæ—¥å¿—ç›´åˆ°å¯è§‚å¯Ÿå¯¹è±¡å‘å‡ºä¸€ä¸ªæ–°å€¼æ‰å‡ºç°ï¼åŸå› æ˜¯å¯è§‚å¯Ÿå¯¹è±¡åœ¨å‘å‡ºå€¼åè¢«è®¢é˜…**ã€‚**

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†å¦ä¸€ä¸ªå«åš *shareReplay çš„æ“ä½œç¬¦ã€‚*

è¿™ä¸ªæ“ä½œå‘˜å°†ä¿å­˜ä¸€ä¸ªæˆ‘ä»¬ä»¥åå¯ä»¥è®¢é˜…çš„æ’æ”¾è®°å¿†ã€‚åœ¨åº•å±‚ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ª *ReplaySubject* æ¥ä¿æŒçŠ¶æ€ã€‚å› ä¸ºæˆ‘ä»¬åªå¸Œæœ›å®ƒä¿å­˜æœ€æ–°çš„å‘å°„ï¼Œè¿™æ˜¯æˆ‘ä»¬å½“å‰çš„çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¼ é€’ä¸€ä¸ªåä¸º *bufferSize* çš„å‚æ•°ï¼Œæˆ‘ä»¬å°†å®ƒè®¾ç½®ä¸º *1ï¼Œ*ï¼Œç”¨ç®€å•çš„è‹±è¯­æ¥è¯´å°±æ˜¯â€œè¯·åœ¨ä½ çš„å†…å­˜ä¸­ä¿å­˜æœ€æ–°çš„ 1 æ¬¡å‘å°„â€ã€‚

è¿™æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„ç»“æœ:

[![](img/960ee95c1af76448b337aad858fc1cd6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--MiOkHMgL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1600/1%2AEkvWjPMk8eNWXJPbTXrFWw.png)

è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†å¦‚ä½•å·¥ä½œï¼

[![](img/c973c61733ad4a3205ebc57bd92368e3.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--RbqZ_kqG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/2400/1%2A-otqLWTJJ5g1L3iipnE03Q.gif)

ç­‰ç­‰ï¼Œä»€ä¹ˆï¼Ÿä½ æ³¨æ„åˆ°äº†å—ï¼Œå½“æˆ‘è¾“å…¥â€œreactâ€ä½œä¸ºæœç´¢è¯æ—¶ï¼Œä¸ç”¨æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œå­˜å‚¨åº“åˆè¢«è®°å½•äº†ã€‚è¿™å¬èµ·æ¥ç¡®å®åƒæ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œå¦‚æœæˆ‘å¯ä»¥è¡¥å……çš„è¯ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„é”™è¯¯ã€‚

å¾ˆç®€å•â€”â€”æˆ‘ä»¬å¿˜äº†æ›´æ”¹å¯¼å‡ºå‡½æ•°ï¼Œè¯¥å‡½æ•°åº”è¯¥è®¢é˜…å¯è§‚å¯Ÿå¯¹è±¡ï¼Œä½†æ˜¯é©¬ä¸Šå…³é—­è®¢é˜…ï¼æˆ‘ä»¬æ‰‹åŠ¨é€€è®¢å—ï¼Ÿä¹Ÿè®¸ä¸éœ€è¦ã€‚è®©æˆ‘ä»¬ä½¿ç”¨æ“ä½œç¬¦ *takeï¼Œ*ï¼Œä¸€æ—¦å®ƒå‘å‡ºçš„æ¬¡æ•°ç­‰äºæˆ‘ä»¬ä½œä¸ºå‚æ•°ç»™å®ƒçš„æ¬¡æ•°ï¼Œå®ƒå°±ä¼šå–æ¶ˆè®¢é˜…ã€‚

è®©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ï¼æˆ‘ä»¬ç”¨è¿ç®—ç¬¦ *take(1):* æ¥è¡¨ç¤ºæˆ‘ä»¬çš„å¯è§‚æµ‹å€¼

[![](img/74751b335a5ae64d368714aa95599237.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--CujsT0qR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1600/1%2AeSCkhW5u6RH0vjhh1OKNxw.png)

#### [](#why-is-this-important)è¿™ä¸ªä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ

*   è¿™æ˜¯é€»è¾‘é”™è¯¯çš„å¸¸è§åŸå› ã€‚æ–¹æ³•åœ¨ä¸åº”è¯¥è¢«è°ƒç”¨çš„æ—¶å€™è¢«è°ƒç”¨
*   è¿™æ˜¯å†…å­˜æ³„æ¼çš„ä¸€ä¸ªå¸¸è§åŸå› ï¼Œå› ä¸ºè®¢é˜…æ²¡æœ‰è¢«æ¸…ç†ï¼
*   å¯è§‚æµ‹è¾å°„è¶Šé¢‘ç¹ï¼Œé—®é¢˜å°±è¶Šå¤§ã€‚å°è¯•ç»å¯¹çƒ­è¡·äºæ­¤ä¸å¯è§‚çš„å®æ—¶æ¥æºå‘å°„ï¼
*   åœ¨ NGRX ä¸­ä½¿ç”¨ *store.select()* å¾ˆå¸¸è§ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æ—¶è¦å°å¿ƒ

## [](#final-words)æœ€åçš„è¯

æ­£å¦‚æ‚¨å¯èƒ½å·²ç»çœ‹åˆ°çš„â€”â€”æˆ‘ä»¬ç”¨å‡ è¡Œ RxJS ä»£ç å°±å®Œæˆäº†åŸæœ¬éœ€è¦æ•°ç™¾è¡Œä»£ç æ‰èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¦‚æœç†è§£å¾—å¥½ï¼Œä½¿ç”¨å¾—æ­£ç¡®ï¼Œå®ƒçœŸçš„å¯ä»¥è®©ä½ çš„ä»£ç å˜å¾—ç¾è§‚æ˜“è¯»ã€‚

æ­£å¦‚æ‚¨å¯èƒ½å·²ç»çœ‹åˆ°çš„ï¼Œä½¿ç”¨å®ƒä¹Ÿä¸éœ€è¦å¤ªå¤šçš„æ—¶é—´å°±å¯ä»¥çŠ¯é”™è¯¯ã€‚å¯¹æŸç§è¡Œä¸ºçš„å°å°è¯¯è§£å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºé”™è¯¯å’Œå†…å­˜æ³„æ¼ã€‚å¦‚æœä½ çš„å›¢é˜Ÿå¼€å§‹ä½¿ç”¨å®ƒï¼Œè¿™æ˜¯éœ€è¦è€ƒè™‘çš„äº‹æƒ…â€”â€”ä½†æ˜¯è¯·æ”¾å¿ƒâ€”â€”è¿™æ˜¯å€¼å¾—çš„ã€‚

* * *

å¦‚æœæ‚¨éœ€è¦ä»»ä½•æ¾„æ¸…ï¼Œæˆ–è€…å¦‚æœæ‚¨è®¤ä¸ºæœ‰äº›äº‹æƒ…ä¸æ¸…æ¥šæˆ–é”™è¯¯ï¼Œè¯·ç•™ä¸‹è¯„è®ºï¼

æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼å¦‚æœä½ æœ‰ï¼Œè¯·åœ¨ [Medium](https://medium.com/@.gc) ã€ [Twitter](https://twitter.com/gc_psk) æˆ– [my website](https://frontend.consulting/articles) ä¸Šå…³æ³¨æˆ‘ï¼Œè·å–æ›´å¤šå…³äºè½¯ä»¶å¼€å‘ã€å‰ç«¯ã€RxJSã€Typescript ç­‰æ–¹é¢çš„æ–‡ç« ï¼