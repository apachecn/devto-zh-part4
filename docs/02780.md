# å°† MEAN åº”ç”¨ç¨‹åºè¿ç§»åˆ° Serverless & Azure Functions ä½“ç³»ç»“æ„

> [https://dev . to/azure/migrating-uma-app-means-to-architecture-server less-azure-1 DP 7](https://dev.to/azure/migrando-uma-aplicacao-mean-para-arquitetura-serverless-azure-functions-1dp7)åŠŸèƒ½

æœ¬æ–‡æ˜¯[# server esssetember](https://dev.to/azure/serverless-september-content-collection-2fhb)å†…å®¹é›†çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å°†åœ¨æ­¤æ‰¾åˆ° 2019 å¹´ 9 æœˆæœŸé—´å‘è¡¨çš„æ‰€æœ‰æ–‡ç« ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Azure Functions è½»æ¾ã€å¿«é€Ÿã€åŠ¨æ€åœ°å°† MEAN åº”ç”¨ç¨‹åºè¿ç§»åˆ°æ— æœåŠ¡å™¨ä½“ç³»ç»“æ„ï¼

é¡¹ç›®æ„æ€æ˜¯å·²ç»å‡†å¤‡å¥½äº†ï¼Œæ‚¨å¯ä»¥åˆ¶ä½œ git å…‹éš†æˆ–ä¸‹è½½

å¦‚æœä½ ä»¬æƒ³çœ‹æœ‰å…³ä¸Šè¿°ä¸»é¢˜çš„æ¼”è®²ï¼Œåªéœ€çœ‹çœ‹ 2019 å¹´åœ¨å·´è¥¿ Js ä¸Šå‘è¡¨çš„æ¼”è®²ä¸‹é¢çš„è§†é¢‘ï¼Œæˆ‘åœ¨æ¼”è®²ä¸­æ­£å¥½è°ˆåˆ° Azul functions+node . js+server less architecture(éå¸¸æ„Ÿè°¢å·´è¥¿ js é‚€è¯·å¹¶æä¾›è§†é¢‘):

YouTube: [https://www.youtube.com/embed/S14Y-kXxvEs](https://www.youtube.com/embed/S14Y-kXxvEs)

æˆ‘ä»¬å¼€å§‹å§ï¼Ÿï¼

## äº†è§£é¡¹ç›®ç»“æ„æ„æ€

åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ä¸¤ä¸ªæ–‡ä»¶å¤¹:API å’Œ **front** ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º:

[![Screen-Shot-09-11-19-at-12-04-PM.png](img/f6d6f5329b0ff17f6217ccd0b89684e9.png)](https://postimg.cc/RJKKF34d)

å¦‚æœæ‚¨è¿è¡Œæ­¤åº”ç”¨ç¨‹åºï¼Œæ‚¨å°†çœ‹åˆ°æˆ‘ä»¬åœ¨ MongoDb ä¸Šç»§ç»­ä½¿ç”¨æ­¤åº”ç”¨ç¨‹åºï¼Œå¹¶ä½¿ç”¨åç«¯ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Node.js

æŒä¹…æ•°æ®åŒ…æ‹¬:

**åˆ†ç±»:Funcionario**

*   **idFuncionario:** (ç¼–å·- guid gerado pelo MongoDb)
*   å…¬åŠ¡å‘˜å§“å:å­—ç¬¦ä¸²
*   **è´§ç‰©:**å­—ç¬¦ä¸²
*   å·ç è¯†åˆ«å…ƒ:å·ç 

å¦‚æœè¦åœ¨æœ¬åœ°è¿è¡Œæ­¤é¡¹ç›®ï¼Œåªéœ€éµå¾ªé¡¹ç›®å­˜å‚¨åº“ README.md ä¸­çš„æ­¥éª¤å³å¯ã€‚

å¥½å§ï¼Œæ—¢ç„¶ä½ ä»¬å·²ç»æŒæ¡äº† MEAN é¡¹ç›®ï¼Œæˆ‘ä»¬æ˜¯å¦è¦å¼€å§‹è¿ç§»åˆ° Azure Functionsï¼Ÿï¼

ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹è“è‰²å‡½æ•°æ˜¯ä»€ä¹ˆï¼

## O que Ã© Azure å‡½æ•°ï¼Ÿï¼âš¡ï¸

**[ã€azure functionsã€‘](https://azure.microsoft.com/services/functions/?WT.mc_id=servsept_devto-blog-gllemos)**æ˜¯ä¸€é¡¹æ— æœåŠ¡å™¨è®¡ç®—æœåŠ¡ï¼Œä½¿æ‚¨æ— éœ€è°ƒé…æˆ–ç®¡ç†åŸºç¡€æ¶æ„ï¼Œå³å¯æ ¹æ®éœ€è¦è½»æ¾æ‰§è¡Œå°‘é‡ä»£ç ç‰‡æ®µæˆ–äº‘åŠŸèƒ½ã€‚

è“è‰²åŠŸèƒ½æ”¯æŒå¤šç§è¯­è¨€ï¼ŒåŒ…æ‹¬:

*   **c#**
*   **[JavaScript](https://docs.microsoft.com/azure/azure-functions/functions-reference-node?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[F#](https://docs.microsoft.com/azure/azure-functions/functions-reference-fsharp?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[Java](https://docs.microsoft.com/azure/azure-functions/functions-reference-java?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[PowerShell](https://docs.microsoft.com/azure/azure-functions/functions-reference-powershell?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[Python](https://docs.microsoft.com/azure/azure-functions/functions-reference-python?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[æ‰“å­—ç¨¿](https://docs.microsoft.com/azure/azure-functions/functions-reference-node?WT.mc_id=servsept_devto-blog-gllemos#typescript)**

ä»¥ä¸‹è¯­è¨€å·²å—æ”¯æŒï¼Œä½†åœ¨æ‚¨çš„ preview ç‰ˆæœ¬ä¸­:

*   **ç—›å‡»**
*   **PHP**

å¦‚æœæ‚¨æƒ³è¿›ä¸€æ­¥äº†è§£æ”¯æ´è“è‰²åŠŸèƒ½çš„è¯­è¨€ï¼Œåªè¦å­˜å–æ­¤å¤„çš„è¿ç»“ã€‚

ä½†æ˜¯ï¼Œå¯¹äºè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†é‡ç‚¹è®¨è®º JavaScriptï¼ğŸ˜‰

## æ¨¡æ¿é‡è¦æ—  Azure åŠŸèƒ½

åœ¨å¼€å§‹è¿ç§»ä¹‹å‰ï¼Œå¿…é¡»æŒ‡å‡ºçš„æ˜¯ï¼Œâ€œ[ã€è“è‰²åŠŸèƒ½ã€‘](https://azure.microsoft.com/services/functions/?WT.mc_id=servsept_devto-blog-gllemos) â€å·²ç»å‡†å¤‡å¥½äº†è®¸å¤šæ¨¡æ¿ï¼Œç°åœ¨æ‰å¼€å§‹ä½¿ç”¨ã€‚å…¶ä¸­åŒ…æ‹¬:

*   **[HTTPTrigger](https://docs.microsoft.com/azure/azure-functions/functions-create-first-azure-function?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[TimerTrigger](https://docs.microsoft.com/azure/azure-functions/functions-create-scheduled-function?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[CosmosDBTrigger](https://docs.microsoft.com/azure/azure-functions/functions-bindings-cosmosdb-v2?WT.mc_id=servsept_devto-blog-gllemos)**

*   **[é˜Ÿåˆ—è§¦å‘å™¨](https://docs.microsoft.com/azure/azure-functions/functions-bindings-storage-queue?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[EventGridTrigger](https://docs.microsoft.com/azure/event-grid/resize-images-on-storage-blob-upload-event?tabs=dotnet&WT.mc_id=servsept_devto-blog-gllemos)**
*   **[äº‹ä»¶è§¦å‘](https://docs.microsoft.com/azure/azure-functions/functions-bindings-event-hubs?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[ServiceBusQueueTrigger](https://docs.microsoft.com/azure/azure-functions/functions-bindings-service-bus?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[ServiceBusTopicTrigger](https://docs.microsoft.com/azure/azure-functions/functions-bindings-service-bus?WT.mc_id=servsept_devto-blog-gllemos)T3ã€‘**

æˆ‘ä¸ä¼šé€ä¸€è¯¦è¿°ï¼Œå¦åˆ™è¿™ç¯‡æ–‡ç« ä¼šå˜å¾—å¾ˆå¤§ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³è¿›ä¸€æ­¥äº†è§£æ¯ä¸ªæ¨¡æ¿åŠå…¶åœ¨ç‰¹å®šåº”ç”¨ä¸­çš„æœ€ä½³ç”¨é€”ï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯»æ–‡æ¡£ã€‚

å¯¹äºæ­¤å¸–å­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¨¡æ¿:**[ã€HTTP triggerã€‘](https://docs.microsoft.com/azure/azure-functions/functions-create-first-azure-function?WT.mc_id=servsept_devto-blog-gllemos)**)ï¼Œå› ä¸ºæ­¤æ¨¡æ¿å°†è§¦å‘ä½¿ç”¨ http è¯·æ±‚æ‰§è¡Œæ‚¨çš„ä»£ç ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬è¿›è¡Œè¿ç§»æ‰€éœ€è¦çš„ï¼

å¦‚æœæ‚¨æ˜¯æŸé«˜æ ¡æŸæ•™è‚²æœºæ„æˆ–å¤§å­¦çš„å­¦ç”Ÿï¼Œå¯ä»¥åœ¨[å­¦ç”Ÿè“è‰²](https://azure.microsoft.com/pt-br/free/students/?WT.mc_id=servsept_devto-blog-gllemos) å¼€ç«‹è´¦æˆ·ã€‚æ­¤å¸æˆ·å°†ä¸ºæ‚¨æä¾› 100.00 ç¾å…ƒçš„ä¿¡ç”¨ï¼Œè®©æ‚¨æ— éœ€ä¿¡ç”¨å¡å³å¯å…è´¹ä½¿ç”¨æœåŠ¡ã€‚è¦æ¿€æ´»æ­¤å¸æˆ·ï¼Œåªéœ€è®¿é—®æ—è¾¹çš„é“¾æ¥:ã€‚æœ‰äº†è¿™ä¸ªè´¦å·ï¼Œä½ å°±å¯ä»¥åˆ©ç”¨**æ¯æœˆ 1ï¼Œ000ï¼Œ000 ä»½å…è´¹ç”³è¯·æ¥å¤„ç†è“è‰²åŠŸèƒ½äº‹ä»¶ï¼**

[![Screen-Shot-09-11-19-at-12-42-PM.png](img/1cea6e7ca048487dcb8a75c1f74f5a39.png)](https://postimg.cc/5HCTSV5r)

å¥½å§ï¼Œåœ¨è¿™ä»½è“è‰²åŠŸèƒ½æ¦‚è¿°ä¹‹åï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥å¼€å§‹è¿ç§»äº†ï¼èµ°å§ï¼

## Instalando o pacote Azure åŠŸèƒ½æ ¸å¿ƒå·¥å…·

**[ã€è“è‰²åŠŸèƒ½æ ¸å¿ƒå·¥å…·ã€‘](https://docs.microsoft.com/azure/azure-functions/functions-run-local?WT.mc_id=servsept_devto-blog-gllemos)** å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºåœ¨æœ¬æœºä¸Šå¼€å‘å’Œæµ‹è¯•åŠŸèƒ½ã€‚

ä»¥ä¸‹æ˜¯ç»§ç»­æœ¬æ•™ç¨‹æ‰€éœ€çš„ç¨‹åºå’Œè½¯ä»¶åŒ…:

*   **[Visual Studio ä»£ç ](https://code.visualstudio.com/?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[node . js-LTS](https://nodejs.org/en/)T3ã€‘**
*   **[Azure åŠŸèƒ½æ ¸å¿ƒå·¥å…·](https://www.npmjs.com/package/azure-functions-core-tools)**
*   **[è’™å“¥ç½—ç›˜](https://www.mongodb.com/products/compass)**

åœ¨è®¡ç®—æœºä¸Šå®‰è£… Node.js åï¼Œåªéœ€é”®å…¥ä»¥ä¸‹å‘½ä»¤:

*   **çª—æˆ·**

```
npm install -g azure-functions-core-tools 
```

Enter fullscreen mode Exit fullscreen mode

*   **è‹¹æœç”µè„‘**

```
brew tap azure/functions
brew install azure-functions-core-tools 
```

Enter fullscreen mode Exit fullscreen mode

*   **Linux(Ubuntu/Debian)com APT**

```
curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
sudo mv microsoft.gpg /etc/apt/trusted.gpg.d/microsoft.gpg 
```

Enter fullscreen mode Exit fullscreen mode

æœ‰å…³å¦‚ä½•æ­£ç¡®å®‰è£…è“è‰²åŠŸèƒ½æ ¸å¿ƒå·¥å…·çš„æ›´å¤šä¿¡æ¯ï¼Œåªéœ€è®¿é—®æ­¤å¤„çš„é“¾æ¥

æˆ‘å¦‚ä½•çŸ¥é“æˆ‘çš„è“è‰²åŠŸèƒ½æ ¸å¿ƒå·¥å…·æ˜¯å¦æ­£ç¡®å®‰è£…åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Ÿï¼åªéœ€åœ¨ç»ˆç«¯ä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤:

```
> func 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚æœåœ¨ä¸‹é¢çš„ gif ä¸­å‡ºç°è¿™ç§æƒ…å†µï¼Œåˆ™è¯´æ˜è½¯ä»¶åŒ…å·²æˆåŠŸå®‰è£…ï¼

[![gif-serverless-07.gif](img/e830fa0a29e050f1f59c309f63e59731.png)](https://gifyu.com/image/hYvM)

å¤ªå¥½äº†ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›é€ æˆ‘ä»¬çš„åŠŸèƒ½ã€‚ä¸ºæ­¤ï¼Œè¯·åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šåˆ›å»ºæœ¬åœ°æ–‡ä»¶å¤¹ï¼Œç„¶åæˆ‘ä»¬å¼€å§‹ï¼

## åˆ›å»ºè“è‰²å‡½æ•°çš„æ–°åº”ç”¨

æ—¢ç„¶å·²ç»å®‰è£…äº†è½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºã€‚ä¸ºæ­¤ï¼Œåªéœ€æŒ‰ç…§ä¸‹é¢çš„ gif æ­¥éª¤æ“ä½œ:

[![gif-serverless-08.gif](img/df4f2824ed7f9058d4e5712a6a725f8a.png)](https://gifyu.com/image/hYqP)

è¯·æ³¨æ„ï¼Œæ‰“å¼€ Visual Studio ä»£ç æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å•å‡»å³ä¸‹è§’çš„â€œ`YES`â€æŒ‰é’®ä»¥å¯ç”¨é¡¹ç›®ä¸­çš„æŸäº›é‡è¦æ–‡ä»¶ã€‚

## å»ºç«‹ä¸è’™æˆˆå¸ƒçš„è¿æ¥

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯¹æˆ‘ä»¬æ–°åˆ›å»ºçš„é¡¹ç›®è¿›è¡Œä¸€äº›å¿…è¦çš„æ›´æ”¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­æœ¬åœ°å®‰è£…â€˜t0â€™[ã€monodbã€‘](https://www.npmjs.com/package/mongodb)ã€‚é”®å…¥ä»¥ä¸‹å‘½ä»¤:

```
> npm install mongodb 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨é¡¹ç›®ä¸­å®‰è£… mongodb æ—¶ï¼Œè¯·æ³¨æ„æ–‡ä»¶â€œ`package.json`â€å·²æ›´æ”¹ã€‚æœ€åï¼Œæ–‡ä»¶åº”å¦‚ä¸‹æ‰€ç¤º:

*   **æ¡£æ¡ˆ:package.json**

```
{  "name":  "crud-serverless-mongodb",  "version":  "1.0.0",  "description":  "Projeto azure functions com persistencia com o mongoDb",  "scripts":  {  "test":  "echo \"No tests yet...\""  },  "author":  "",  "dependencies":  {  "mongodb":  "^3.3.2"  }  } 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º:â€œT0â€çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºæ–‡ä»¶:â€œT1â€ã€‚é¡¹ç›®ç»“æ„ç°åœ¨å°†å¦‚ä¸‹æ‰€ç¤º:

[![Screen-Shot-09-11-19-at-02-05-PM.png](img/6ac457e3b56bc274a6dd475f0174267b.png)](https://postimg.cc/CRVryLtH)

æˆ‘ä»¬ç°åœ¨æ›´æ”¹æ–‡ä»¶`mongo.js`ã€‚ä¸ºæ­¤ï¼Œè¯·åŒ…æ‹¬ä»¥ä¸‹ä»£ç å—:

*   **æ¡£æ¡ˆ:shared/mongo.js**

```
/**
 * Arquivo: mongo.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel por tratar a conexÃ£o da Base de Dados localmente
 * Author: Glaucia Lemos
 */

const { MongoClient } = require("mongodb");

const config = {
  url: "mongodb://localhost:27017/crud-serverless-mongodb",
  dbName: "crud-serverless-mongodb"
};

async function createConnection() {
  const connection = await MongoClient.connect(config.url, {
    useNewUrlParser: true
  });
  const db = connection.db(config.dbName);
  return {
    connection,
    db
  };
}

module.exports = createConnection; 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬åœ¨è¿™é‡Œå»ºç«‹äº†ä¸è’™æˆˆå¸ƒçš„æœ¬åœ°è”ç³»ï¼å’Œæˆ‘ä»¬åœ¨ Node.js çš„åç«¯æ‰€åšçš„éå¸¸ç›¸ä¼¼ï¼Œä¸æ˜¯å—ï¼Ÿï¼

å¹¶ä¸”æˆ‘ä»¬è¿˜å°†æ›´æ”¹æ–‡ä»¶`local.settings.json`ã€‚æ­¤æ–‡ä»¶è´Ÿè´£â€œä¿å­˜â€æˆ‘ä»¬ä¸æƒ³åœ¨æäº¤æ—¶æš´éœ²çš„æ‰€æœ‰å¯†é’¥ã€‚è¯·æ³¨æ„ï¼Œæ­¤æ–‡ä»¶ä½äºâ€œ`.gitignore`â€æ–‡ä»¶åˆ—è¡¨ä¸­ã€‚

æ‰“å¼€æ–‡ä»¶â€œ`local.settings.json`â€å¹¶è¿›è¡Œä»¥ä¸‹æ›´æ”¹:

*   **æ¡£æ¡ˆ:local.settings.json**

```
{  "IsEncrypted":  false,  "Values":  {  "FUNCTIONS_WORKER_RUNTIME":  "node",  "AzureWebJobsStorage":  "{AzureWebJobsStorage}"  },  "Host":  {  "LocalHttpPort":  7071,  "CORS":  "*"  }  } 
```

Enter fullscreen mode Exit fullscreen mode

è¯·æ³¨æ„ä¸Šé¢çš„ä»£ç å—ï¼Œæˆ‘ä»¬å·²ç»å¯ç”¨äº†â€œ`CORS`â€ã€‚å› ä¸ºæ²¡æœ‰ä»–ï¼Œæˆ‘ä»¬æ— æ³•åœ¨å‰çº¿æ‰§è¡Œ CRUD è¡ŒåŠ¨ï¼å¦‚æœæ‚¨æƒ³è¿›ä¸€æ­¥äº†è§£é¢œè‰²ï¼Œæˆ‘æ¨èé˜…è¯»ã€‚

ç¬¬ä¸€éƒ¨åˆ†å·²ç»å‡†å¤‡å¥½äº†ï¼ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨è“è‰²å‡½æ•°ä¸­åˆ›å»ºæˆ‘ä»¬çš„ CRUDï¼

## åˆ›å»ºâ€˜create officialâ€™åŠŸèƒ½

è¦åˆ›å»ºæ–°å‡½æ•°ï¼Œåªéœ€é”®å…¥ä»¥ä¸‹å‘½ä»¤:

```
func new 
```

Enter fullscreen mode Exit fullscreen mode

é”®å…¥æ­¤å‘½ä»¤å°†æä¾› Azure Functions æä¾›çš„å„ç§æ¨¡æ¿é€‰é¡¹ã€‚å°±æˆ‘ä»¬è€Œè¨€ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å°†é€‰æ‹©æ¨¡æ¿:`HttpTrigger`ã€‚æŒ‰ç…§ä¸‹é¢çš„ gif æ­¥éª¤æ“ä½œ:

[![gif-serverless-09.gif](img/f7b5857da806260b9d7ff5d05ece5650.png)](https://gifyu.com/image/hYI8)

è¯·æ³¨æ„ï¼Œå·²åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹â€œ`CreateFuncionario`â€å’Œä¸¤ä¸ªæ–‡ä»¶:

*   **function.json** :è¿™é‡Œæˆ‘ä»¬å°†å®šä¹‰æˆ‘ä»¬ç»ˆç‚¹çš„è·¯çº¿å’Œæ–¹æ³•ã€‚

*   **index.json** :åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å‘å±•ç«¯ç‚¹å›ºæœ‰çš„é€»è¾‘ã€‚

æˆ‘ä»¬å¼€å§‹ä¿®æ”¹è¿™äº›æ–‡ä»¶ã€‚ä»`function.json`å¼€å§‹

*   **arquivo:CreateFuncionario/function . JSON**

```
{  "bindings":  [{  "authLevel":  "anonymous",  "type":  "httpTrigger",  "direction":  "in",  "name":  "req",  "methods":  ["post"],  "route":  "funcionarios"  },  {  "type":  "http",  "direction":  "out",  "name":  "res"  }  ]  } 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨æˆ‘ä»¬æ¥ä¿®æ”¹æ–‡ä»¶`index.js`:

*   **æ¡£æ¡ˆ:create official/index . js**

```
/**
 * Arquivo: CreateFuncionario/index.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel por criar um novo 'FuncionÃ¡rio'
 * Author: Glaucia Lemos
 */

const createMongoClient = require('../shared/mongo')

module.exports = async function (context, req) {
  const funcionario = req.body || {}

  if (funcionario) {
    context.res = {
      status: 400,
      body: 'Os dados do(a) FuncionÃ¡rio(a) Ã© obrigatÃ³rio!'
    }
  }

  const { db, connection } = await createMongoClient()

  const Funcionarios = db.collection('funcionarios')

  try {
    const funcionarios = await Funcionarios.insert(funcionario)
    connection.close()

    context.res = {
      status: 201,
      body: funcionarios.ops[0]
    }
  } catch (error) {
    context.res = {
      status: 500,
      body: 'Error ao criar um novo FuncionÃ¡rio(a)'
    }
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

è¿™é‡Œæˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯åœ¨å®šä¹‰`Criar um novo FuncionÃ¡rio`çš„è·¯çº¿ï¼Œå‘å±•`Criar um novo FuncionÃ¡rio`çš„é€»è¾‘ã€‚

æˆ‘ä»¬è¦è¿è¡Œè¿™ä¸ªç«¯ç‚¹å—ï¼Ÿï¼è¦è¿è¡Œï¼Œåªéœ€é”®å…¥ä»¥ä¸‹å‘½ä»¤:

```
> func host start 
```

Enter fullscreen mode Exit fullscreen mode

ä»–ä¼šåˆ—å‡ºæˆ‘ä»¬åˆ›å»ºçš„ç«¯ç‚¹ï¼è¯·çœ‹ gif:

[![gif-serverless-11.gif](img/b2a631e7c161d4e89fa73ed405083539.png)](https://gifyu.com/image/hYI5)

ä»–ä¸ºæˆ‘ä»¬åˆ—å‡ºäº†ä»¥ä¸‹ç«¯ç‚¹:`[POST] http://localhost:7071/api/funcionario`

ç«¯å£`7071`æ˜¯è“è‰²åŠŸèƒ½çš„é»˜è®¤ç«¯å£ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼

å¥½å§ï¼Œç°åœ¨æˆ‘ä»¬èµ°è¿™æ¡è·¯çº¿ï¼Œåœ¨å‰ç«¯åŠ ï¼ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹`Front`é¡¹ç›®ä½œä¸€äº›ä¿®æ”¹ã€‚è½¬åˆ°ä½äº:`front -> src -> app -> funcionario.service.ts`çš„æ–‡ä»¶å¤¹`front`ï¼Œç„¶åæ›´æ”¹ä»¥ä¸‹æ–‡ä»¶`funcionario.service.ts`

*   **arquivo:funcionario . service . ts**

```
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';

@Injectable({
  providedIn: 'root'
})
export class FuncionarioService {

  // ==> Uri da api (Back-End)
  uri = 'http://localhost:7071/api';

  constructor(private http: HttpClient) { }

(...) 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬åªéœ€è¦æ›´æ”¹è§’éƒ¨æœåŠ¡ä¸­å®šä¹‰çš„`uri`ã€‚

æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¤„å†³å­”æ³¢æ¡‘å’Œå‰çº¿ã€‚åœ¨ gif ä¸­ï¼Œè¯·æ³¨æ„æ–°å‘˜å·¥å°†å¦‚ä½•ç»§ç»­å·¥ä½œï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸å†éœ€è¦è¯¥é¡¹ç›®çš„â€œ`api`â€æ–‡ä»¶å¤¹ï¼

**(ç‚¹å‡»ä¸‹å›¾è§‚çœ‹ gif)**

[![gif-serverless-122d9fa9f9e2c32e04.md.gif](img/dc23cd5f25ab707d3ef909bb6c357667.png)](https://gifyu.com/image/hYuM)

ä½ åšæŒå¾—å¾ˆå¥½ï¼ğŸ˜

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ—å‡ºæ¥ï¼

## åˆ›å»ºâ€˜get officersâ€™åŠŸèƒ½

ä¸ä¸Šé¢æ‰€åšçš„å‡è®¾ç›¸åŒï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¸¦æœ‰å‘½ä»¤çš„æ–°å‡½æ•°:`func new`ï¼Œå‘½åå‡½æ•°`GetFuncionarios`ï¼Œå¹¶ä¿®æ”¹æ–‡ä»¶:`function.json`å’Œ`index.js`

**(ç‚¹å‡»ä¸‹å›¾è§‚çœ‹ gif)**

[![gif-serverless-1390be8d86cc5d4218.md.gif](img/8d443815dfeb968d50c00d3642686a5e.png)](https://gifyu.com/image/hYuz)

*   **get officers/function . JSON**

```
{  "bindings":  [{  "authLevel":  "anonymous",  "type":  "httpTrigger",  "direction":  "in",  "name":  "req",  "methods":  ["get"],  "route":  "funcionarios"  },  {  "type":  "http",  "direction":  "out",  "name":  "res"  }  ]  } 
```

Enter fullscreen mode Exit fullscreen mode

*   **GetFuncionarios/index.js**

```
/**
 * Arquivo: GetFuncionarios/index.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel por listar todos os 'FuncionÃ¡rios'
 * Author: Glaucia Lemos
 */

const createMongoClient = require('../shared/mongo')

module.exports = async context => {
  const { db, connection } = await createMongoClient()

  const Funcionarios = db.collection('funcionarios')
  const res = await Funcionarios.find({})
  const body = await res.toArray()

  connection.close()

  context.res = {
    status: 200,
    body
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

è®©æˆ‘ä»¬å†è¯•ä¸€æ¬¡ï¼å†çœ‹çœ‹ä¸‹é¢çš„ gifï¼

[![gif-serverless-14.gif](img/2abb577d869169a61f1236add0ba4930.png)](https://gifyu.com/image/hYdI)

å†ä¸€æ¬¡è¿ä½œå¾—å¾ˆé¡ºåˆ©ã€‚ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ç”¨è“è‰²å‡½æ•°åˆ›å»ºä¸€ä¸ª CRUD æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œä¸æ˜¯å—ï¼Ÿyou ' ve ever noticed that it ' s easy to create a crud with blue functionsï¼Œisn ' t youï¼Ÿï¼ç°åœ¨åªéœ€æŒ‰ç…§ç›¸åŒçš„æ­¥éª¤åˆ›å»ºä¸‹ä¸€ä¸ªè§’è‰²ï¼

## Criando a fun ao ' GetFuncionarioById '

ç°åœ¨è¿™é‡Œçš„æ¯ä¸ªäººéƒ½å¾ˆæ¸…æ¥šï¼Œç”¨è“è‰²å‡½æ•°åˆ›å»º CRUD æ˜¯å¤šä¹ˆå®¹æ˜“ï¼Œæˆ‘å°†å¼€å§‹åŠ å¿«åˆ›å»ºè¿‡ç¨‹ï¼Œåªéœ€åœ¨â€˜t0â€™å’Œâ€˜t1â€™æ–‡ä»¶ä¸­æŠ¥å‘Šæ›´æ”¹å†…å®¹å³å¯

*   **get å®˜å‘˜ ById/index.js**

```
{  "bindings":  [{  "authLevel":  "anonymous",  "type":  "httpTrigger",  "direction":  "in",  "name":  "req",  "methods":  ["get"],  "route":  "funcionarios/{id}"  },  {  "type":  "http",  "direction":  "out",  "name":  "res"  }  ]  } 
```

Enter fullscreen mode Exit fullscreen mode

*   **GetFuncionarioById/function . JSON**

```
// @ts-nocheck
/**
 * Arquivo: GetFuncionarioById/index.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel por listar FuncionÃ¡rio pelo Id
 * Author: Glaucia Lemos
 */

const { ObjectID } = require('mongodb')
const createMongoClient = require('../shared/mongo')

module.exports = async function (context, req) {
  const { id } = req.params

  if (!id) {
    context.res = {
      status: 400,
      body: 'Por favor, passe o nÃºmero correto do Id do FuncionÃ¡rio!'
    }

    return
  }

  const { db, connection } = await createMongoClient()

  const Funcionarios = db.collection('funcionarios')

  try {
    const body = await Funcionarios.findOne({ _id: ObjectID(id) })

    connection.close()
    context.res = {
      status: 200,
      body
    }
  } catch (error) {
    context.res = {
      status: 500,
      body: 'Erro ao listar o FuncionÃ¡rio pelo Id.'
    }
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬ç°åœ¨ä¸æµ‹è¯•ã€‚æˆ‘ä»¬å°†å¼€å‘æœ€åä¸¤ä¸ªåŠŸèƒ½:`Delete`å’Œ`Delete`ã€‚

## åˆ›å»ºè§’è‰²:'æ›´æ–°å®˜å‘˜'

å†æ¬¡ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°å¹¶æ›´æ”¹æ–‡ä»¶`function.json`å’Œ`index.js`:

*   **UpdateFuncionario/index . js**

```
{  "bindings":  [{  "authLevel":  "anonymous",  "type":  "httpTrigger",  "direction":  "in",  "name":  "req",  "methods":  ["put"],  "route":  "funcionarios/{id}"  },  {  "type":  "http",  "direction":  "out",  "name":  "res"  }  ]  } 
```

Enter fullscreen mode Exit fullscreen mode

*   **UpdateFuncionario/index . js**

```
// @ts-nocheck
/**
 * Arquivo: UpdateFuncionario/index.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel por atualizar 'FuncionÃ¡rio' por Id
 * Author: Glaucia Lemos
 */

const { ObjectID } = require('mongodb')
const createMongoClient = require('../shared/mongo')

module.exports = async function (context, req) {
  const { id } = req.params
  const funcionario = req.body || {}

  if (!id || !funcionario) {
    context.res = {
      status: 400,
      body: 'Os campos sÃ£o obrigatÃ³rios'
    }

    return
  }

  const { db, connection } = await createMongoClient()
  const Funcionarios = db.collection('funcionarios')

  try {
    const funcionarios = await Funcionarios.findOneAndUpdate(
      { _id: ObjectID(id) },
      { set: funcionario }
    )

    connection.close()

    context.res = {
      status: 200,
      body: funcionarios
    }
  } catch (error) {
    context.res = {
      status: 500,
      body: 'Erro ao atualizar o FuncionÃ¡rio'
    }
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

ç§€å‡ºæ¥ï¼ç°åœ¨è®©æˆ‘ä»¬å‘å±•æˆ‘ä»¬æœ€åçš„åŠŸèƒ½:`Delete`ï¼

## åˆ›å»ºè§’è‰²:ã€åˆ é™¤å·¥ä½œäººå‘˜ã€‘

å†æ¬¡ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œé€‰æ‹©é€‰é¡¹:`DeleteFuncionario`ï¼Œå‘½åå‡½æ•°`DeleteFuncionario`ï¼Œç„¶åæ›´æ”¹æ–‡ä»¶`function.json`å’Œ`index.js`:

*   **åˆ é™¤å…¬åŠ¡å‘˜/èŒèƒ½ã€‚json**

```
{  "bindings":  [{  "authLevel":  "anonymous",  "type":  "httpTrigger",  "direction":  "in",  "name":  "req",  "methods":  ["delete"],  "route":  "funcionarios/{id}"  },  {  "type":  "http",  "direction":  "out",  "name":  "res"  }  ]  } 
```

Enter fullscreen mode Exit fullscreen mode

*   **DeleteFuncionario/index . js**

```
// @ts-nocheck
/**
 * Arquivo: DeleteFuncionario/index.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel excluir um 'FuncionÃ¡rio' pelo Id
 * Author: Glaucia Lemos
 */

const { ObjectID } = require('mongodb')
const createMongoClient = require('../shared/mongo')

module.exports = async function (context, req) {
  const { id } = req.params

  if (!id) {
    context.res = {
      status: 400,
      body: 'Os campos sÃ£o obrigatÃ³rios!'
    }

    return
  }

  const { db, connection } = await createMongoClient()

  const Funcionarios = db.collection('funcionarios')

  try {
    await Funcionarios.findOneAndDelete({ _id: ObjectID(id) })
    connection.close()
    context.res = {
      status: 204,
      body: 'FuncionÃ¡rio excluÃ­do com sucesso!'
    }
  } catch (error) {
    context.res = {
      status: 500,
      body: 'Erro ao excluir FuncionÃ¡rio' + id
    }
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬çš„ç”Ÿæ–™å‡†å¤‡å¥½äº†ï¼æˆ‘ä»¬è¦æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹å—ï¼Ÿï¼çœ‹çœ‹ä¸‹é¢çš„ gifï¼

**(ç‚¹å‡»ä¸‹å›¾è§‚çœ‹ gif)**

[![gif-serverless-156824eb58eaca624e.md.gif](img/4d5d4f154837af0bffdf110f5a4b5577.png)](https://gifyu.com/image/hYnX)

æ›´æ¼‚äº®çš„ä¸œè¥¿ï¼Œä¸æ˜¯å—ï¼Ÿï¼å†ä¸€æ¬¡è¯·æ³¨æ„ï¼Œæœ‰å¤§é‡æ–‡ä»¶çš„é‚£ä¸ª`api`æ–‡ä»¶å¤¹å°†ä¸å†éœ€è¦ï¼æˆ‘ä»¬å‡ ä¹å¯ä»¥åˆ é™¤æ•´ä¸ªæ–‡ä»¶å¤¹ï¼ï¼ï¼

æ‰€æœ‰å¼€å‘çš„æºä»£ç éƒ½åœ¨è¿™é‡Œ:

**[å‰ç«¯å·¥ç¨‹](https://github.com/glaucia86/workshop-mean-serverless)**

ğŸ‘‰ **[Projeto Api -æ— æœåŠ¡å™¨](https://github.com/glaucia86/crud-serverless-mongodb)**

## ç»“è¯­

ä»Šå¤©ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•å°† MEAN åº”ç”¨ç¨‹åºè¿ç§»åˆ° Azure Functionsï¼Œä½†åœ¨æœ¬åœ°ä¿ç•™è¿™äº›æ•°æ®å¹¶åœ¨æœ¬åœ°æ‰§è¡Œè¿™äº›åŠŸèƒ½ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨äº‘ä¸­æ‰˜ç®¡è¯¥åº”ç”¨ç¨‹åºå‘¢ï¼Ÿæˆ‘ä»¬çš„åç«¯ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘æ‚¨ä»‹ç»å¦‚ä½•å°† mongodb è¿ç§»åˆ° cosmosdbï¼Œä»¥åŠå¦‚ä½•åœ¨ Visual Studio ä»£ç æœ¬èº«ä¸­ä½¿ç”¨ Azure Tools æ‰©å±•æ¥éƒ¨ç½²è¿™äº›åŠŸèƒ½ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³ Azure Functions çš„æ›´å¤šä¿¡æ¯ï¼Œæˆ‘å»ºè®®æ‚¨å­¦ä¹ ä»¥ä¸‹å®Œå…¨å…è´¹çš„ Serverless & Azure Functions è¯¾ç¨‹ä»¥åŠå…¶ä»–ä¸€äº›é‡è¦åŠŸèƒ½:

**[å…è´¹è¯¾ç¨‹-è“è‰²åŠŸèƒ½](https://docs.microsoft.com/pt-br/learn/paths/create-serverless-applications/?WT.mc_id=servsept_devto-blog-gllemos)**

âœ…**t1ã€‘azure para devs JavaScript&node . jsT3ã€‘**

**[è“çš®ä¹¦åŠŸèƒ½](https://docs.microsoft.com/pt-br/azure/azure-functions/?WT.mc_id=servsept_devto-blog-gllemos)**

**[åœ¨ Visual Studio ä»£ç ](https://docs.microsoft.com/pt-br/azure/azure-functions/functions-create-first-function-vs-code?WT.mc_id=servsept_devto-blog-gllemos)** ä¸­åˆ›å»ºå…¶ç¬¬ä¸€ä¸ªåŠŸèƒ½

âœ… **[æ‰©å±•ä¸ä»£ç â€”â€”azure å‡½æ•°](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions&WT.mc_id=servsept_devto-blog-gllemos)**

âœ… **[ç”µå­ä¹¦ GrÃ¡tis - Azure æ— æœåŠ¡å™¨è®¡ç®—é£Ÿè°±](https://azure.microsoft.com/pt-br/resources/azure-serverless-computing-cookbook/?WT.mc_id=servsept_devto-blog-gllemos)**

è€Œä¸”ä¸ºäº†è·Ÿä¸Šæœ€æ–°çš„æ›´æ–°ï¼Œä¸è¦å¿˜äº†åœ¨ Twitter ä¸Šè·Ÿè¸ªæˆ‘ï¼ğŸ˜ƒ

[![Twitter](img/9a13c0534f6448ca23e17b3afbfb6a4c.png)](https://twitter.com/glaucia_lemos86)

ä¸‹æ¬¡è§ï¼â¤ï¸ â¤ï¸ â¤ï¸