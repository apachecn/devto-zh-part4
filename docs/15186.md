# è¶…çº§ç®€å•çš„ååº”æŒ‚æ¥/å¸è½½åŠ¨ç”»

> åŸæ–‡ï¼š<https://dev.to/michalczaplinski/super-easy-react-mount-unmount-animations-with-hooks-4foj>

**åŸå¸–**:[https://czaplinski . io/blog/super-easy-animation-with-react-hooks/](https://czaplinski.io/blog/super-easy-animation-with-react-hooks/)(æœ‰æ›´å¥½çš„æ ¼å¼å’Œè¯­æ³•é«˜äº®)

web ä¸ŠåŠ¨ç”»çš„ä¸€ä¸ªä¸»è¦ç”¨ä¾‹æ˜¯ç®€å•åœ°åœ¨é¡µé¢ä¸Šæ·»åŠ å’Œåˆ é™¤å…ƒç´ ã€‚ç„¶è€Œï¼Œåœ¨ react ä¸­è¿™æ ·åšå¯èƒ½å¾ˆéº»çƒ¦ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½ç›´æ¥æ“ä½œ DOM å…ƒç´ ï¼ç”±äºæˆ‘ä»¬è®© react è´Ÿè´£æ¸²æŸ“ï¼Œæˆ‘ä»¬è¢«è¿«ä»¥ react çš„æ–¹å¼åˆ¶ä½œåŠ¨ç”»ã€‚é¢å¯¹è¿™ä¸€å‘ç°ï¼Œä¸€äº›å¼€å‘äººå‘˜å¼€å§‹æ€€å¿µä»¥å‰çš„ jQuery æ—¶ä»£ï¼Œåœ¨é‚£é‡Œä½ å¯ä»¥åš:

```
$("#my-element").fadeIn("slow"); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ æƒ³çŸ¥é“å›°éš¾åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œè®©æˆ‘ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜

```
/* styles.css */

@keyframes fadeIn {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
// index.js

const App = ({ show = true }) => (
  show 
  ? <div style={{ animation: `fadeIn 1s` }}>HELLO</div>   : null
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°±æ˜¯æˆ‘ä»¬ç”¨`fadeIn`åˆ¶ä½œç»„ä»¶çš„*å®‰è£…*çš„åŠ¨ç”»æ‰€éœ€çš„å…¨éƒ¨å†…å®¹ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ³•åˆ¶ä½œ*å¸è½½*çš„åŠ¨ç”»ï¼Œå› ä¸ºä¸€æ—¦`show`å±æ€§å˜ä¸º falseï¼Œæˆ‘ä»¬å°±ä» DOM ä¸­åˆ é™¤äº†`<div/>`ï¼ç»„ä»¶ä¸è§äº†ï¼Œæ ¹æœ¬æ²¡æœ‰åŠæ³•è®©å®ƒåŠ¨èµ·æ¥ã€‚æˆ‘ä»¬èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼ŸğŸ¤”

åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ react to:

1.  å½“`show`å±æ€§æ”¹å˜æ—¶ï¼Œä¸è¦ç«‹å³å¸è½½ï¼Œè€Œæ˜¯â€œè®¡åˆ’â€å¸è½½ã€‚
2.  å¼€å§‹å¸è½½åŠ¨ç”»ã€‚
3.  åŠ¨ç”»ä¸€ç»“æŸï¼Œå°±å¸è½½ç»„ä»¶ã€‚

æˆ‘æƒ³å‘æ‚¨å±•ç¤ºä½¿ç”¨çº¯ CSS å’Œé’©å­æ¥å®ç°è¿™ä¸€ç‚¹çš„æœ€ç®€å•çš„æ–¹æ³•ã€‚å½“ç„¶ï¼Œå¯¹äºæ›´é«˜çº§çš„ç”¨ä¾‹ï¼Œæœ‰åƒ [react-spring](https://www.react-spring.io/) è¿™æ ·ä¼˜ç§€çš„åº“ã€‚

å¯¹äºä¸è€çƒ¦çš„äººï¼Œè¿™é‡Œæœ‰ä»£ç ï¼Œåˆ†ä¸º 3 ä¸ªæ–‡ä»¶:

```
// index.js

import React, { useState } from "react";
import ReactDOM from "react-dom";

import "./styles.css";
import Fade from "./Fade";

const App = () => {
  const [show, setShow] = useState(false);

  return (
    <div>
      <button onClick={() => setShow(show => !show)}>
        {show ? "hide" : "show"}
      </button>
      <Fade show={show}>
        <div> HELLO </div>
      </Fade>
    </div>
  );
};

const rootElement = document.getElementById("root");
ReactDOM.render(<App />, rootElement); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
// Fade.js

import React, { useEffect, useState } from "react";

const Fade = ({ show, children }) => {
  const [shouldRender, setRender] = useState(show);

  useEffect(() => {
    if (show) setRender(true);
  }, [show]);

  const onAnimationEnd = () => {
    if (!show) setRender(false);
  };

  return (
    shouldRender && (
      <div
        style={{ animation: `${show ? "fadeIn" : "fadeOut"} 1s` }}
        onAnimationEnd={onAnimationEnd}
      >
        {children}
      </div>
    )
  );
};

export default Fade; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
/* styles.css */

@keyframes fadeIn {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}

@keyframes fadeOut {
  0% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªæ–‡ä»¶å¼€å§‹ï¼Œåˆ†æä¸€ä¸‹è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚æœ‰è¶£çš„æ˜¯:

```
// index.js

const App = () => {
  const [show, setShow] = useState(false);

  return (
    <div>
      <button onClick={() => setShow(show => !show)}>
        {show ? "hide" : "show"}
      </button>
      <Fade show={show}>
        <div> HELLO </div>
      </Fade>
    </div>
  );
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç®€å•åœ°ä¼ é€’ä¸€ä¸ª`show`å±æ€§æ¥æ§åˆ¶æ˜¯å¦æ˜¾ç¤º`<Fade />`ç»„ä»¶çš„å­ç»„ä»¶ã€‚è¯¥ç»„ä»¶ä¸­çš„å…¶ä½™ä»£ç åªæ˜¯ä½¿ç”¨ [useState](https://reactjs.org/docs/hooks-state.html) é’©å­æ¥ç®¡ç†éšè—/æ˜¾ç¤ºã€‚

`<Fade/>`ç»„ä»¶æ”¶åˆ° 2 ä¸ªé“å…·:`show`å’Œ`children`ã€‚æˆ‘ä»¬ä½¿ç”¨`show`å±æ€§çš„å€¼æ¥åˆå§‹åŒ–`<Fade />`ç»„ä»¶çš„`shouldRender`çŠ¶æ€:

```
// Fade.js

const Fade = ({ show, children }) => {
  const [shouldRender, setRender] = useState(show);
  // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æä¾›äº†ä¸€ç§å°†*åŠ¨ç”»*ä¸*å®‰è£…/å¸è½½*åˆ†å¼€çš„æ–¹æ³•ã€‚

`show`é“å…·æ§åˆ¶æˆ‘ä»¬æ˜¯åº”ç”¨`fadeIn`è¿˜æ˜¯`fadeOut`åŠ¨ç”»ï¼Œ`shouldRender`çŠ¶æ€æ§åˆ¶æŒ‚è½½/å¸è½½:

```
// ...
return (
    shouldRender && (
      <div
        style={{ animation: `${show ? "fadeIn" : "fadeOut"} 1s` }}
        onAnimationEnd={onAnimationEnd}
      >
        {children}
      </div>
    )
  );
// ... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨å¯ä»¥å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¹‹å‰çš„ä¸»è¦é—®é¢˜æ˜¯ react ä¼šåœ¨æˆ‘ä»¬å°è¯•åº”ç”¨åŠ¨ç”»çš„åŒæ—¶å¸è½½ç»„ä»¶ï¼Œè¿™ä¼šå¯¼è‡´ç»„ä»¶ç«‹å³æ¶ˆå¤±ã€‚ä½†æ˜¯ç°åœ¨æˆ‘ä»¬æŠŠé‚£ä¸¤æ­¥åˆ†å¼€äº†ï¼

æˆ‘ä»¬åªéœ€è¦ä¸€ç§æ–¹æ³•æ¥å‘Šè¯‰ååº”*åºåˆ—*`fadeOut`åŠ¨ç”»å’Œå¸è½½ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ï¼ğŸ’ª

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨[on animation å’Œ](https://reactjs.org/docs/events.html#animation-events)äº‹ä»¶ã€‚å½“åŠ¨ç”»ç»“æŸè¿è¡Œ*å’Œ*æ—¶ï¼Œç»„ä»¶åº”è¯¥è¢«éšè—(`show === false`)ï¼Œç„¶åå°†`shouldRender`è®¾ç½®ä¸ºå‡ï¼

```
const onAnimationEnd = () => {
    if (!show) setRender(false);
  }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ•´ä¸ªä¾‹å­ä¹Ÿåœ¨ [Codesandbox](https://codesandbox.io/s/react-easy-animation-b658i) ä¸Šï¼Œä½ å¯ä»¥åœ¨é‚£é‡Œç©å®ƒï¼

### å˜¿ï¼ğŸ‘‹åœ¨ä½ èµ°ä¹‹å‰ï¼ğŸƒâ€â™‚ï¸

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥åœ¨ [twitter](https://twitter.com/C_Z_A_P_L_A) ä¸Šå…³æ³¨æˆ‘ï¼Œäº†è§£æ›´å¤šç¼–ç¨‹å†…å®¹ï¼Œæˆ–è€…ç»™æˆ‘å‘ä¸€å°[ç”µå­é‚®ä»¶](//mailto:mmczaplinski@gmail.com)ğŸ™‚

æˆ‘ç»å¯¹å–œæ¬¢è¯„è®ºå’Œåé¦ˆï¼ï¼ï¼âœŒï¸