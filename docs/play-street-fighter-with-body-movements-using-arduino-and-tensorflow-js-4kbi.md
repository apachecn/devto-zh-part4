# ä½¿ç”¨ Arduino å’Œ Tensorflow.js é€šè¿‡èº«ä½“åŠ¨ä½œç©è¡—å¤´éœ¸ç‹

> åŸæ–‡ï¼š<https://dev.to/devdevcharlie/play-street-fighter-with-body-movements-using-arduino-and-tensorflow-js-4kbi>

åœ¨è¿‡å»çš„ä¸€å¹´é‡Œï¼Œæˆ‘ä¸€ç›´åœ¨å­¦ä¹ æ›´å¤šå…³äºæœºå™¨å­¦ä¹ çš„çŸ¥è¯†ã€‚æˆ‘å·²ç»åšäº†ä¸€äº›æµè§ˆå™¨å®éªŒï¼Œä½†æœ€è¿‘ï¼Œæˆ‘èŠ±äº†ä¸€äº›æ—¶é—´å°†æœºå™¨å­¦ä¹ ä¸æˆ‘çš„å¦ä¸€ä¸ªçˆ±å¥½ç¡¬ä»¶ç»“åˆèµ·æ¥ï¼

ä¸‹é¢çš„æ•™ç¨‹æ˜¯å…³äºæˆ‘å¦‚ä½•ä½¿ç”¨ Arduino å’Œ [Tensorflow.js](https://www.tensorflow.org/js) åˆ¶ä½œæ‰‹åŠ¿è¯†åˆ«ç³»ç»Ÿçš„åŸå‹ã€‚

è¿™åªæ˜¯ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œè¿˜å¤„äºå®éªŒé˜¶æ®µã€‚

æ¥ä¸‹æ¥çš„å†…å®¹æ¶µç›–äº†æˆ‘æ„å»ºå®ƒçš„ä¸»è¦æ­¥éª¤ï¼Œä»¥åŠä¸€äº›ä»£ç ç¤ºä¾‹ã€‚å¦‚æœä½ æƒ³çœ‹å®Œæ•´çš„ä»£ç ï¼Œä½ å¯ä»¥æŸ¥çœ‹ Github repoï¼Œä½†æ˜¯ä½ è¦çŸ¥é“ï¼Œåœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘ä¼šå¯¹å®ƒè¿›è¡Œç›¸å½“å¤šçš„ä¿®æ”¹ã€‚

æˆ‘è®¤ä¸ºæœ€é‡è¦çš„æ˜¯è¦ç†è§£è¦é‡‡å–çš„æ­¥éª¤ï¼Œè€Œä¸æ˜¯æ‰€æœ‰éœ€è¦çš„ä»£ç ã€‚

* * *

# æ¼”ç¤º

è¿™ä¸ªåŸå‹æ˜¯å…³äºè®­ç»ƒä¸€ä¸ªæœºå™¨å­¦ä¹ æ¨¡å‹æ¥è¯†åˆ«èº«ä½“è¿åŠ¨ï¼Œå¦‚â€œå‡ºæ‹³â€æˆ–â€œhadokenâ€ï¼Œä»¥ä¸è¡—å¤´éœ¸ç‹çš„ç½‘é¡µæ¸¸æˆè¿›è¡Œäº’åŠ¨ã€‚

æœ€ç»ˆç»“æœå¦‚ä¸‹æ‰€ç¤º:

[![Playing street fighter with body movements](img/8daef4ab3bc7da89a1c55a2ace1d4bd9.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--mzP6sMVu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/uhcqh7h1cvuujewtd1qd.gif)

*è¿™ä¸ªé¡¹ç›®çš„çµæ„Ÿæ¥è‡ª[ä¸€ä¸ªç±»ä¼¼çš„](https://blog.mgechev.com/2018/10/20/transfer-learning-tensorflow-js-data-augmentation-mobile-net/)ç”±[æ˜ç§‘Â·æ ¼åˆ‡å¤«](https://twitter.com/mgechev)ä½¿ç”¨ç½‘ç»œæ‘„åƒå¤´*

* * *

# æ‰€éœ€ææ–™

ä¸ºäº†å»ºé€ å®ƒï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›ç¡¬ä»¶ã€‚æˆ‘åœ¨åŸå‹ä¸­ä½¿ç”¨çš„å·¥å…·åŒ…æ‹¬:

*   Arduino MKR1000 (å…¶ä»–å‹å·ä¹Ÿå¯ä»¥)
*   [åŠ é€Ÿåº¦è®¡/é™€èºä»ª(MPU6050)](https://www.sparkfun.com/products/11028)
*   çº½æ‰£
*   è·³çº¿
*   ç”µæ± 

æˆ‘è¿˜ä½¿ç”¨äº†ä¸€ä¸ªè¯•éªŒæ¿æ¥æŠŠæ‰€æœ‰çš„ä¸œè¥¿æ”¾åœ¨ä¸€èµ·ï¼Œä½†å¦‚æœä½ å†³å®šç„Šæ¥å®ƒï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ªåŸå‹æ¿æ¥ä»£æ›¿ã€‚

åœ¨æŠ€æœ¯å †æ ˆæ–¹é¢ï¼Œæˆ‘ä½¿ç”¨äº†:

*   æ™®é€š Javascript
*   Tensorflow.js
*   èŠ‚ç‚¹. js
*   å¼ºå°¼äº”å·
*   Web å¥—æ¥å­—

* * *

# ç¬¬ä¸€æ­¥:æ”¶é›†æ•°æ®

å¦‚æœä»é›¶å¼€å§‹ï¼Œæˆ‘ä»¬åªæœ‰æˆ‘ä»¬çš„æƒ³æ³•:ç”¨èº«ä½“åŠ¨ä½œç©è¡—éœ¸ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•å®ç°è¿™ä¸€ç‚¹...

ä¸ºäº†èƒ½å¤Ÿå»ºç«‹ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œæˆ‘ä»¬éœ€è¦æ•°æ®ã€‚è¿™äº›æ•°æ®å°†æ¥è‡ªæˆ‘ä»¬æ‰‹ä¸­çš„ä¸€äº›ç¡¬ä»¶ã€‚

ä¸ºäº†è·å¾—æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä»ç»„è£…ç»„ä»¶å¼€å§‹ã€‚

å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„:

[![Arduino sketch](img/fa830edc89900c74a795f9b56dd069dd.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--eynvU2cF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/e3eq8rpx2kydb8z8qyl5.png)

æˆ‘ä½¿ç”¨çš„å¾®æ§åˆ¶å™¨æ˜¯ Arduino MKR1000ã€‚æˆ‘é€‰æ‹©è¿™ä¸ªå‹å·æ˜¯å› ä¸ºæˆ‘å®¶é‡Œå·²ç»æœ‰äº†å®ƒï¼Œå®ƒå†…ç½®äº† wifiï¼Œè¿™æ„å‘³ç€æˆ‘ä¸å¿…ç»‘åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šè®°å½•æ‰‹åŠ¿ã€‚ä½ ä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ Arduino Unoï¼Œä½†ä½ å¿…é¡»ä¸€ç›´æ‹´åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šï¼Œè¿™å¯¹äºè¿™ä¸ªç‰¹å®šçš„åŸå‹æ¥è¯´å¹¶ä¸ç†æƒ³ï¼Œä½†å®ƒä»ç„¶æ˜¯æœ‰ç”¨çš„ã€‚

ç¬¬äºŒä¸ªä¸»è¦éƒ¨åˆ†æ˜¯åŠ é€Ÿåº¦è®¡/é™€èºä»ªã€‚æˆ‘ä½¿ç”¨äº†ä¸€ä¸ª MPU6050ï¼Œå®ƒå¯ä»¥è®©ä½ è·å¾— xï¼Œy å’Œ z è½´ä¸Šçš„åŠ é€Ÿåº¦æ•°æ®ï¼Œä»¥åŠ xï¼Œy å’Œ z è½´ä¸Šçš„æ—‹è½¬æ•°æ®ï¼Œæ€»å…±ç»™ä½  6 ä¸ªç‚¹çš„æ•°æ®ã€‚

æœ€åï¼Œæˆ‘è¿˜ä½¿ç”¨äº†ä¸€ä¸ªæŒ‰é’®ï¼Œå› ä¸ºæˆ‘æƒ³åªåœ¨æ‰§è¡ŒæŸä¸ªæ‰‹åŠ¿æ—¶è®°å½•æ•°æ®ã€‚è¿™æ ·ï¼Œæˆ‘å°±å¯ä»¥åªåœ¨æŒ‰ä¸‹æŒ‰é’®å’Œæ‰§è¡Œâ€œæ‰“å­”â€æ—¶è®°å½•æ•°æ®ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»ç»„è£…å¥½äº†ç¡¬ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä»£ç æ¥è·å–è¿™äº›æ•°æ®ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä½¿ç”¨ Johnny-Five æ¡†æ¶åœ¨æˆ‘çš„è®¡ç®—æœºå’Œ Arduino ä¹‹é—´ç”¨ JavaScript è¿›è¡Œé€šä¿¡ã€‚

ä»£ç çœ‹èµ·æ¥åƒè¿™æ ·:

```
const EtherPortClient = require("etherport-client").EtherPortClient;
const five = require('johnny-five');
const fs = require('fs');

const board = new five.Board({
    port: new EtherPortClient({
      host: "192.168.1.113", //Your Arduino IP goes here
      port: 3030
    }),
    timeout: 1e5,
    repl: false
});

board.on("ready", function() {
    const button = new five.Button("A0");

    let stream = fs.createWriteStream(`data/sample_punch_0.txt`, {flags: 'a'});

    const imu = new five.IMU({
        pins: [11,12], // connect SDA to 11 and SCL to 12
        controller: "MPU6050"
    });

    imu.on("data", function() {
        let data = `${this.accelerometer.x}  ${this.accelerometer.y}  ${this.accelerometer.z}  ${this.gyro.x}  ${this.gyro.y}  ${this.gyro.z}`;

        button.on("hold", () => stream.write(`${data} \r\n`));
    });

    button.on("release", () => stream.end());
}); 
```

åœ¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æˆ‘ä»¬éœ€è¦çš„ Node.js æ¨¡å—ï¼Œæˆ‘ä»¬ç”¨ Arduino çš„ IP åœ°å€ä»¥åŠå®ƒå°†è¦é€šä¿¡çš„ç«¯å£æ¥è®¾ç½®æˆ‘ä»¬çš„æ¿ã€‚ç„¶åï¼Œå½“ç”µè·¯æ¿å‡†å¤‡å°±ç»ªæ—¶ï¼Œæˆ‘ä»¬è®¾ç½®æŒ‰é’® MPU6050 ä¼ æ„Ÿå™¨ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæµï¼Œä»¥ä¾¿å°†æ‰€æœ‰æ•°æ®å†™å…¥ä¸€ä¸ªæ–‡ä»¶ã€‚å½“æˆ‘ä»¬ä»ä¼ æ„Ÿå™¨è·å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å°†æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œå½“æˆ‘ä»¬æŒ‰ä½æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å°†æ•°æ®å†™å…¥ä¸Šé¢å£°æ˜çš„æ–‡ä»¶ä¸­ã€‚æœ€åï¼Œå½“æˆ‘ä»¬é‡Šæ”¾æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å…³é—­äº†æˆ‘ä»¬çš„æµï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¸å†å‘è¿™ä¸ªç‰¹å®šçš„æ–‡ä»¶å†™å…¥æ•°æ®ã€‚

æ­¤ä»£ç ç¤ºä¾‹æ¶µç›–äº†å¦‚ä½•å°†æ•°æ®å†™å…¥å•ä¸ªæ‰‹åŠ¿ç¤ºä¾‹çš„æ–‡ä»¶ï¼Œä½†æ˜¯ï¼Œå¯¹äºæ¯ä¸ªæ‰‹åŠ¿ï¼Œæˆ‘ä»¬éœ€è¦è®°å½•å¤šä¸ªç¤ºä¾‹ï¼Œå› æ­¤æ‚¨å¿…é¡»ä¿®æ”¹æ­¤æ–‡ä»¶ä»¥è®°å½•æ‰“å­”ç¤ºä¾‹ 2ã€æ‰“å­”ç¤ºä¾‹ 3ã€æ‰“å­”ç¤ºä¾‹ 4 ç­‰...

åœ¨è®°å½•æ‰‹åŠ¿æ•°æ®çš„è¿™ä¸€æ­¥ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è¿›å…¥ç¬¬äºŒæ­¥æ‰èƒ½ä½¿ç”¨å®ƒï¼Œè¿™ä¸€æ­¥æ˜¯æ•°æ®å¤„ç†ã€‚

* * *

# ç¬¬äºŒæ­¥:æ•°æ®å¤„ç†

ç›®å‰ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„æ˜¯ä¸€ä¸ªè£…æ»¡ä¼ æ„Ÿå™¨æ•°æ®æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œåº”è¯¥æ˜¯è¿™æ ·çš„:

```
0.40205128205128204 0.019145299145299145 -4.384273504273504 0.06110144116383567 -0.27059209658270084 0.3578798696738946
-0.13401709401709402 -0.5743589743589743 -3.561025641025641 0.008728777309119381 -0.3578798696738946 0.6546582981839536
-1.3210256410256411 -0.47863247863247865 -3.1398290598290597 -0.22694821003710391 -0.026186331927358142 0.8117762897481025
-1.7230769230769232 -0.1723076923076923 -2.9675213675213676 -0.6895734074204312 0.183304323491507 0.20949065541886513
-1.3593162393162392 -0.4211965811965812 -3.024957264957265 -0.9252503947666544 0.21821943272798452 -0.28804965120093956
-1.4167521367521367 -0.5360683760683761 -2.7377777777777776 -0.9601655040031319 0.3229647604374171 -0.1396604369459101
-2.201709401709402 -0.22974358974358974 -2.3165811965811964 -1.0125381678578482 0.45389642007420783 0.1309316596367907
-3.1015384615384614 0.09572649572649572 -1.7996581196581196 -1.1958424913493553 0.6721158528021923 0.06110144116383567 
-3.2164102564102564 0.6892307692307692 -1.435897435897436 -1.483892142550295 1.0125381678578482 -0.08728777309119382 
-3.407863247863248 1.6464957264957265 -1.1678632478632478 -1.7195691298965181 1.187113714040236 -0.24440576465534267 
-3.963076923076923 1.991111111111111 -0.7466666666666667 -1.8766871214606669 1.1347410501855195 -0.21821943272798452 
-5.322393162393162 4.1928205128205125 1.1678632478632478 -2.2869396549892778 1.9290597853153832 0.39279497891037213 
-5.264957264957265 6.337094017094017 1.9336752136752138 -2.609904415426695 2.3043972096075165 -0.07855899578207443 
-4.843760683760684 7.275213675213675 2.508034188034188 -2.8455814027729183 2.356769873462233 -0.8554201762936994 
-4.5948717948717945 7.102905982905983 3.063247863247863 -2.976513062409709 2.496430310408143 -1.1521986048037582
-2.1442735042735044 9.649230769230769 3.6184615384615384 -3.4478670371021556 3.1685461632103356 -0.6546582981839536 
```

ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ä»è¿™äº›æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶è½¬æ¢å®ƒï¼Œä»¥ä¾¿å®ƒå¯ä»¥è¢« Tensorflow.js ä½¿ç”¨ã€‚

## 1ã€‚ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®

æˆ‘ä¸æ‰“ç®—é€šè¿‡ä»£ç æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘è®¤ä¸ºè®¸å¤šå…¶ä»–åšå®¢å¸–å­ä¹‹å‰å·²ç»æ¶µç›–äº†å®ƒï¼Œæˆ‘ç›¸ä¿¡å¦‚æœä½ éœ€è¦è¿™æ ·åšï¼Œä½ å¯ä»¥æ‰¾åˆ°å®ƒã€‚

ä¸»è¦ç›®æ ‡æ˜¯éå†æˆ‘ä»¬çš„æ•°æ®æ–‡ä»¶å¤¹ä¸­çš„æ¯ä¸ªæ•°æ®æ–‡ä»¶ï¼Œé€è¡Œè¯»å–å¹¶å°†æˆ‘ä»¬çš„æ•°æ®ä»ä¸Šé¢çš„æ ¼å¼è½¬æ¢ä¸ºä¸€ä¸ªå¯¹è±¡æ•°ç»„ã€‚

æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„æ•°æ®çœ‹èµ·æ¥åƒè¿™æ ·:

```
{ features:
   [ -0.11487179487179487, 9.63008547008547, -4.345982905982906, -0.22694821003710391, 0.04364388654559691, 0.5586417477836404, -0.07658119658119658, 9.074871794871795, -4.7671794871794875,0.11347410501855196, 0.08728777309119382, 0.8990640628392963,
-0.7658119658119658, 9.744957264957264, -4.288547008547009, 0.052372663854716284, -0.1309316596367907, 0.7768611805116249, -1.3784615384615384, 9.610940170940172, -3.790769230769231, -0.017457554618238762, -0.2618633192735814, 0.34915109236477526,
-2.4697435897435898, 9.725811965811966, -3.6567521367521367, -0.10474532770943257, -0.17457554618238763, -0.034915109236477525, -3.58017094017094, 9.898119658119658,
-3.9056410256410254, -0.07855899578207443, -0.06983021847295505, -0.296778428510059,     -4.7097435897435895, 9.993846153846153, -3.9247863247863246, -0.07855899578207443,
-0.04364388654559691, -0.5411841931654017, -6.04991452991453, 10.08957264957265,
-3.9439316239316238, -0.06110144116383567, 0.034915109236477525,-0.6459295208748342, 
... 260 more items ],
  label: 1 } 
```

æˆ‘ä»¬åœ¨è¿™é‡Œåšçš„æ˜¯ä»åä¸º`sample_punch_0.txt`çš„æ–‡ä»¶ä¸­çš„è¡Œåˆ°æˆ‘ä»¬å¯ä»¥å¼€å§‹å¤„ç†çš„ä¸œè¥¿ã€‚
ç‰¹å¾é˜µåˆ—ä»£è¡¨å•ä¸ªæ‰‹åŠ¿æ ·æœ¬çš„æ•°æ®ï¼Œæ ‡ç­¾ä»£è¡¨æ‰‹åŠ¿çš„åç§°ã€‚

æˆ‘ä»¬ä¸å¸Œæœ›ä¸å­—ç¬¦ä¸²ä¸€èµ·å·¥ä½œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è®­ç»ƒ 3 ç§ä¸åŒçš„æ‰‹åŠ¿ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªæ‰‹åŠ¿æ•°ç»„['hadoken 'ï¼Œ' punch 'ï¼Œ' upercut ']ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ ‡ç­¾ 1 å°†æ˜ å°„åˆ°â€œæ‰“å­”â€ã€‚

æˆ‘ä»¬éœ€è¦å¯¹æ‰€æœ‰çš„æ•°æ®æ–‡ä»¶éƒ½è¿™æ ·åšï¼Œæ‰€ä»¥æœ€åï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªæ‰‹åŠ¿å¯¹è±¡çš„å¤§æ•°ç»„ï¼Œå°±åƒè¿™æ ·:

```
[
{ features:
   [ -0.11487179487179487, 9.63008547008547, -4.345982905982906, -0.22694821003710391, 0.04364388654559691, 0.5586417477836404, -0.07658119658119658, 9.074871794871795, -4.7671794871794875,0.11347410501855196, 0.08728777309119382, 0.8990640628392963,
... 530 more items ],
  label: 1 },
{ features:
   [ -0.11487179487179487, 9.63008547008547, -4.345982905982906, -0.22694821003710391, 0.04364388654559691, 0.5586417477836404, -0.07658119658119658, 9.074871794871795, -4.7671794871794875,0.11347410501855196, 0.08728777309119382, 0.8990640628392963,
... 530 more items ],
  label: 0 },
{ features:
   [ -0.11487179487179487, 9.63008547008547, -4.345982905982906, -0.22694821003710391, 0.04364388654559691, 0.5586417477836404, -0.07658119658119658, 9.074871794871795, -4.7671794871794875,0.11347410501855196, 0.08728777309119382, 0.8990640628392963,
... 530 more items ],
  label: 2 },
{ features:
   [ -0.11487179487179487, 9.63008547008547, -4.345982905982906, -0.22694821003710391, 0.04364388654559691, 0.5586417477836404, -0.07658119658119658, 9.074871794871795, -4.7671794871794875,0.11347410501855196, 0.08728777309119382, 0.8990640628392963,
... 530 more items ],
  label: 2 },
...
] 
```

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å°†æ‰€æœ‰æ–‡ä»¶è½¬æ¢ä¸ºæ ‡ç­¾å’Œç‰¹å¾å¯¹è±¡ã€‚

ä½†æ˜¯ï¼Œè¿™è¿˜ä¸èƒ½ç”¨äº Tensorflowã€‚æˆ‘ä»¬éœ€è¦ä¸æ–­åœ°å°†æˆ‘ä»¬çš„æ•°æ®è½¬æ¢æˆæ¡†æ¶å¯ä»¥ä½¿ç”¨çš„ä¸œè¥¿ã€‚

## 2ã€‚æ ¼å¼åŒ–æ•°æ®

åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å°†å¼€å§‹æŠŠæˆ‘ä»¬çš„å¯¹è±¡è½¬æ¢æˆä¸¤ä¸ªæ•°ç»„ã€‚ä¸€ä¸ªç”¨äºæ ‡ç­¾ï¼Œä¸€ä¸ªç”¨äºç‰¹å¾ã€‚

æˆ‘ä»¬çš„ç›®æ ‡å¤§æ¦‚æ˜¯:

```
// labels
[ [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
  [ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 ],
  [ 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2 ] ]

// features
[ 
  [ 
    [ 5.686153846153847, ... 400 more items ], [ 9.285470085470086,... 200 more items ], ... 
  ],
  [ 
    [ 5.686153846153847, ... 400 more items ], [ 9.285470085470086,... 200 more items ], ... 
  ],
  [ 
    [ 5.686153846153847, ... 400 more items ], [ 9.285470085470086,... 200 more items ], ...
  ],
] 
```

ä½¿ç”¨ä¸Šé¢çš„æ ¼å¼ï¼Œæˆ‘ä»¬å°†æ ‡æ³¨å’Œè¦ç´ åˆ†å¼€ï¼Œä½†å®ƒä»¬ä»ç„¶ç›¸äº’æ˜ å°„ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œæ ‡ç­¾æ•°ç»„çš„ç¬¬ä¸€å±‚ä»£è¡¨æ‰€æœ‰æ ‡ç­¾ä¸º 0 çš„æ‰‹åŠ¿(ä¾‹å¦‚â€œhadokenâ€)ï¼Œè€Œç‰¹å¾æ•°ç»„çš„ç¬¬ä¸€å±‚ä»£è¡¨æˆ‘ä»¬çš„ hadoken æ‰‹åŠ¿çš„æ‰€æœ‰æ•°æ®ã€‚

åŒæ ·ï¼Œæˆ‘æ²¡æœ‰å±•ç¤ºå¦‚ä½•å®ç°çš„ä»£ç ï¼Œå› ä¸ºåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒä¸ Tensorflow.js æ²¡æœ‰ä»»ä½•ç‰¹å®šçš„å…³ç³»ã€‚æˆ‘ä»¬æ‰€åšçš„å°±æ˜¯ä½¿ç”¨ JavaScript æ•°ç»„æ–¹æ³•å°†æ•°æ®ä»æ–‡ä»¶ä¸­çš„è¡Œè½¬æ¢ä¸ºå¯¹è±¡ï¼Œå†è½¬æ¢ä¸ºå¤šç»´æ•°ç»„ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬çœŸçš„å¾ˆæ¥è¿‘ Tensorflow å¯ä»¥ä½¿ç”¨çš„ä¸œè¥¿äº†ï¼Œé™¤äº†æ¡†æ¶ä½¿ç”¨ä¸€ç§å«åš **Tensors** çš„ç‰¹æ®Šæ•°æ®ç»“æ„ã€‚

## 3ã€‚è½¬æ¢ä¸ºå¼ é‡

è¿™æ˜¯æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ç‰¹å®š Tensorflow.js ä»£ç çš„åœ°æ–¹ã€‚ä½¿ç”¨å†…ç½®æ–¹æ³•ï¼Œæˆ‘ä»¬å°†æŠŠæ•°ç»„è½¬æ¢æˆå¼ é‡ã€‚

ä¸ºæ­¤ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä»£ç ç¤ºä¾‹:

```
function convertToTensors(featuresData, labelData) {
  // we start by shuffling our data so our model doesn't get used to the way we feed it data.
  const [shuffledFeatures, shuffledLabels] = shuffleData(featuresData, labelData);

  // numSamplesPerGesture is the number of times we trained a single gesture (e.g. we trained the "punch" gesture 20 times)
  // totalNumDataPerFile is the number of data points we take into consideration per gesture. If we only consider the first 50 lines of a data file, 50 * 6 points of data = 300; 
  const featuresTensor = tf.tensor2d(shuffledFeatures, [numSamplesPerGesture, totalNumDataPerFile]); 

  // 1D tensor for labels & convert them from the set [0, 1, 2] into one-hot encoding (.e.g., 0 --> [1, 0, 0]). 
  // e.g: punch at index 0 â‡’ [1,0,0], hadoken at index 1 â‡’ [0,1,0], 
  const labelsTensor = tf.oneHot(tf.tensor1d(shuffledLabels).toInt(), numClasses);
} 
```

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ ‡ç­¾å¼ é‡å’Œä¸€ä¸ªç‰¹å¾å¼ é‡ã€‚æˆ‘ä»¬å‡ ä¹å‡†å¤‡å¥½è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹äº†ï¼ä½†æ˜¯é¦–å…ˆï¼Œæœ€åä¸€æ­¥æ˜¯åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¹‹é—´æ‹†åˆ†æ•°æ®ã€‚

## 4ã€‚å‰§çƒˆçš„

è€ƒè™‘åˆ°ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å°†æ ‡ç­¾å’Œç‰¹å¾å¼ é‡åˆ†æˆä¸€ä¸ªè®­ç»ƒå’Œæµ‹è¯•é›†ã€‚

æˆ‘ä»¬è¿™æ ·åšçš„åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬æƒ³è¦ä½¿ç”¨æˆ‘ä»¬çš„é›†åˆçš„å¤§çº¦ 80%æ¥è®­ç»ƒæ¨¡å‹ï¼Œè€Œå‰©ä½™çš„ 20%æ¥éªŒè¯æˆ‘ä»¬çš„æ¨¡å‹çš„é¢„æµ‹ã€‚

```
const numTestExamples = Math.round(numSamplesPerGesture * 0.2); // 20% 
const numTrainExamples = numSamplesPerGesture - numTestExamples; // 80%

// Split between training set and test set.
const trainingFeatures = featuresTensor.slice([0, 0], [numTrainExamples, totalNumDataPerFile]);

const testingFeatures = featuresTensor.slice([numTrainExamples, 0], [numTestExamples, totalNumDataPerFile]);

const trainingLabels = labelsTensor.slice([0, 0], [numTrainExamples, numClasses]);

const testingLabels = labelsTensor.slice([numTrainExamples, 0], [numTestExamples, numClasses]);

return [trainingFeatures, trainingLabels, testingFeatures, testingLabels]; 
```

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†æ ‡ç­¾å’Œç‰¹å¾çš„è®­ç»ƒå’Œæµ‹è¯•å¼ é‡ï¼Œæˆ‘ä»¬å‡†å¤‡åˆ›å»ºæˆ‘ä»¬çš„æ¨¡å‹ã€‚

* * *

# è®­ç»ƒæ¨¡å‹

åˆ›å»ºæ¨¡å‹æ˜¯ä¸€ä¸ªæ¯”å‰é¢çš„æ­¥éª¤æ›´å…·å®éªŒæ€§çš„æ­¥éª¤ã€‚ä½ çš„æ¨¡å‹å¯ä»¥ç”¨è®¸å¤šä¸åŒçš„æ–¹æ³•å»ºç«‹ï¼Œä½ å¯ä»¥ç”¨å‚æ•°ã€ç¥ç»ç½‘ç»œçš„å±‚æ•°ã€ä½ æƒ³è¦ç»å†çš„æ—¶æœŸ(æ­¥éª¤)æ•°ç­‰ç­‰æ¥ç©æ¸¸æˆ...

åˆ›å»ºæ­£ç¡®çš„æ¨¡å‹æ²¡æœ‰å›ºå®šçš„æ–¹æ³•ã€‚å½“æ‚¨æ›´æ”¹å‚æ•°æ—¶ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ¨¡å‹çš„å‡†ç¡®æ€§å’Œé¢„æµ‹çš„å˜åŒ–ï¼Œå¹¶ä¸”ä¸€æ—¦è¾¾åˆ°æ‚¨æ»¡æ„çš„å‡†ç¡®æ€§æ°´å¹³ï¼Œæ‚¨å¯ä»¥å†³å®šåœæ­¢è°ƒæ•´ã€‚

æˆ‘å½“å‰çš„æ¨¡å‹æ˜¯è¿™æ ·åˆ›å»ºçš„:

```
const createModel = async (trainingFeatures, trainingLabels, testFeatures, testLabels) => {
   const params = { learningRate: 0.1, epochs: 40 };
   const model = tf.sequential();
   model.add(tf.layers.dense({ units: 10, activation: 'sigmoid', inputShape: [trainingFeatures.shape[1]] }));
   model.add(tf.layers.dense({ units: 3, activation: 'softmax' }));

   const optimizer = tf.train.adam(params.learningRate);

   model.compile({
       optimizer: optimizer,
       loss: 'categoricalCrossentropy',
       metrics: ['accuracy'],
   });

   await model.fit(trainingFeatures, trainingLabels, {
       epochs: params.epochs,
       validationData: [testFeatures, testLabels],
   });

   await model.save(â€™file://modelâ€™);
} 
```

æ­¤ä»£ç ç¤ºä¾‹çš„æœ€åä¸€è¡Œå°†æ¨¡å‹ä¿å­˜ä¸ºåº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥å°†å®ƒç”¨äºæœ€åä¸€æ­¥ï¼Œé¢„æµ‹æ–°çš„æ•°æ®æ ·æœ¬ï¼

* * *

# åˆ©ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹

ç°åœ¨ï¼Œæˆ‘ä»¬çš„è®­ç»ƒè¿‡ç¨‹å·²ç»å®Œæˆï¼Œæˆ‘ä»¬çš„æ¨¡å‹å·²ç»å‡†å¤‡å¥½ç”¨äºåœ¨â€œhadokenâ€ã€â€œpunchâ€å’Œâ€œuppercutâ€ä¹‹é—´å¯¹æ–°æ ·æœ¬è¿›è¡Œåˆ†ç±»ã€‚

```
const tf = require('@tensorflow/tfjs-node');
let liveData = [];
let model;
const gestureClasses = ['hadoken', 'punch', 'uppercut'];

const init = async () => {
   model = await tf.loadLayersModel('file://model/model.json');
}

// similar step to the recording process
imu.on("data", function() {
   button.on("hold", () => {
       let data = {xAcc: this.accelerometer.x, yAcc: this.accelerometer.y, zAcc: this.accelerometer.z,
                  xGyro: this.gyro.x, yGyro: this.gyro.y, zGyro: this.gyro.z};

       if (liveData.length < numValuesExpected){
           liveData.push(data.xAcc, data.yAcc, data.zAcc, data.xGyro, data.yGyro, data.zGyro)
       }
   });

   button.on("release", function(){
     predict(model, liveData);
     liveData = [];
   });
});

const predict = (model, newSampleData) => {
   tf.tidy(() => {
       // the live data we get is just an array of numbers. We also need to transform it to a tensor so the model can use it.
       const input = tf.tensor2d([newSampleData], [1, 300]);
       const prediction = model.predict(input);
       // the prediction will come back as an index, the same as our labels in our data set.
       const gesturePredicted = gestureClasses[prediction.argMax(-1).dataSync()[0]];

    console.log(gesturePredicted) // either punch, hadoken or uppercut;
    });
} 
```

ä½¿ç”¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨æŒ‰ä½æŒ‰é’®å¹¶æ‰§è¡Œæˆ‘ä»¬è®­ç»ƒçš„å¤šä¸ªæ‰‹åŠ¿ä¹‹ä¸€æ—¶è·å¾—å®æ—¶æ•°æ®ã€‚ä¸€æ—¦æˆ‘ä»¬é‡Šæ”¾æŒ‰é’®ï¼Œæˆ‘ä»¬å°±ç”¨è¿™ä¸ªæ¨¡å‹ä»æœªè§è¿‡çš„æ–°æ ·æœ¬è¿è¡Œæˆ‘ä»¬çš„`predict`å‡½æ•°ã€‚æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªç´¢å¼•ï¼Œå¯ä»¥åœ¨æˆ‘ä»¬çš„`gestureClasses`æ•°ç»„ä¸­ä½¿ç”¨å®ƒæ¥å¾—åˆ°é¢„æµ‹çš„æ‰‹åŠ¿ã€‚

æˆ‘ä»¬å®Œäº‹äº†ã€‚ğŸ‰

* * *

# åŠ è´º

æ­£å¦‚æˆ‘åœ¨æœ¬æ•™ç¨‹å¼€å§‹æ—¶æ‰€è¯´çš„ï¼Œæœ€é‡è¦çš„æ˜¯ç†è§£å¦‚æœä½ æƒ³æ„å»ºç±»ä¼¼çš„ä¸œè¥¿ï¼Œä½ éœ€è¦ç»å†çš„æ­¥éª¤ã€‚å¦‚æœä½ ä¸å®Œå…¨ç†è§£ä»£ç ï¼Œå®Œå…¨æ²¡å…³ç³»ï¼

éœ€è¦çŸ¥é“çš„ä¸€ä»¶å¾ˆé…·çš„äº‹æƒ…æ˜¯ï¼Œé¦–å…ˆï¼Œä½ éœ€è¦ä¸€ç§è·å–æ•°æ®çš„æ–¹æ³•ï¼Œä½†è¿™å¹¶ä¸ä¸€å®šæ¶‰åŠ Arduinoã€‚æˆ‘ç”¨ä¸€ä¸ª Daydream æ§åˆ¶å™¨åˆ›å»ºäº†è¿™ä¸ªé¡¹ç›®çš„ä¸€ä¸ªç‰ˆæœ¬...ä¸€éƒ¨æ‰‹æœºï¼

å¤§å¤šæ•°ç°ä»£æ‰‹æœºéƒ½æœ‰å†…ç½®çš„åŠ é€Ÿåº¦è®¡å’Œé™€èºä»ªï¼Œå¯ä»¥ç”¨æ¥æ”¶é›†è¿™ç±»å®éªŒçš„æ•°æ®ã€‚ä»£ç éœ€è¦åšä¸€äº›æ”¹åŠ¨ï¼Œå› ä¸ºä½ éœ€è¦ä½¿ç”¨**é€šç”¨ä¼ æ„Ÿå™¨ API** ï¼Œçœ‹èµ·æ¥åƒæ˜¯:

```
let gyroscope = new Gyroscope({frequency: 60});

gyroscope.addEventListener('reading', e => {
   // gyroscope.x;
   // gyroscope.y;
   // gyroscope.z;
});
gyroscope.start();

let accelerometer = new Accelerometer({frequency: 60});

accelerometer.addEventListener('reading', e => {
   // accelerometer.x;
   // accelerometer.y;
   // accelerometer.z;
});
accelerometer.start(); 
```

å¦‚æœä½ æƒ³å°è¯•ä¸€ä¸‹ï¼Œ[è¿™é‡Œæœ‰ä¸€ä¸ªæ¼”ç¤º](https://bit.ly/sf-ml)ï¼Œä½ å¯ä»¥åœ¨[è¿™ä¸ªå›è´­](https://github.com/charliegerard/gestures-ml-js)ä¸­æ‰¾åˆ°ä»£ç ã€‚

* * *

éšç€æˆ‘ä¸€ç‚¹ä¸€ç‚¹åœ°æ”¹è¿›ä»£ç å¹¶æœ€ç»ˆæ„å»ºå…¶ä»–å®éªŒï¼Œæˆ‘å¯èƒ½ä¼šå†å†™ä¸€ç¯‡æ–‡ç« :)

æ„Ÿè°¢é˜…è¯»ï¼ğŸ’š