# ä½¿ç”¨ useContext & useReducer æ»šåŠ¨æ‚¨è‡ªå·±çš„ Redux

> åŸæ–‡:[https://dev . to/gsto/roll-your-own-redux-with-use context-usereducer-17fl](https://dev.to/gsto/roll-your-own-redux-with-usecontext-usereducer-17fl)

"å¤§å¤šæ•°é¡¹ç›®ä¸å¤Ÿå¤æ‚ï¼Œä¸éœ€è¦ Redux . "

æˆ‘ç»å¸¸ä» React ç¤¾åŒºå¬åˆ°è¿™æ ·çš„é‡å¤ã€‚æˆ‘ä¸æ˜¯æ¥äº‰è®ºå®ƒæœ‰å¤šæœ‰æ•ˆçš„ã€‚æˆ‘æ‰€çŸ¥é“çš„æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨ç¡®å®å¸Œæœ›åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€ï¼Œå¹¶ä¸”æ‚¨å¯èƒ½ä¸å¸Œæœ›å°† Redux å¼•å…¥æ‚¨çš„æ¶æ„ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•åˆ›å»ºè‡ªå·±çš„å°å‹çŠ¶æ€ç®¡ç†ç³»ç»Ÿã€‚æˆ‘ç§°ä»–ä»¬ä¸º reducklingsã€‚ğŸ¦†

## [](#our-use-case-flash-messaging)æˆ‘ä»¬çš„ä½¿ç”¨æ¡ˆä¾‹:å³æ—¶æ¶ˆæ¯

é»˜è®¤æƒ…å†µä¸‹ï¼ŒRuby on Rails åŒ…å« flash æ¶ˆæ¯ã€‚åœ¨æ‚¨çš„æ§åˆ¶å™¨ä¸­ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°å°†æ¶ˆæ¯æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æƒ³è¦ç±»ä¼¼çš„ä¸œè¥¿:

*   åœ¨å±å¹•é¡¶éƒ¨æ˜¾ç¤ºä¸€æ¡æˆ–å¤šæ¡æ¶ˆæ¯ã€‚
*   èƒ½å¤Ÿå¿½ç•¥ä¸€æ¡æ¶ˆæ¯ã€‚
*   æœ‰èƒ½åŠ›æ¸…é™¤æ‰€æœ‰çš„ä¿¡æ¯ã€‚
*   ä»»ä½•ç»„ä»¶éƒ½åº”è¯¥èƒ½å¤Ÿå‘é€æ¶ˆæ¯ã€‚

## [](#1-build-our-reducer)1:æ‰“é€ æˆ‘ä»¬çš„å‡é€Ÿå™¨

å› æ­¤ï¼Œå¯¹äºæˆ‘ä»¬çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œçœ‹èµ·æ¥æˆ‘ä»¬æœ‰ä¸€ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹å…¶æ‰§è¡Œå‡ ä¸ªæ“ä½œã€‚è¿™æ˜¯åˆ›å»ºå‡é€Ÿå™¨çš„å®Œç¾ç”¨ä¾‹ã€‚çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
const messageReducer = (state, action) => {
  switch (action.type) {
    case 'ADD':
      return [
        ...state,
        action.payload,
      ]
    case 'CLEAR':
      return []
    case 'DISMISS':
      return state.filter((message, index) => index !== action.payload)
    default:
      return state
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#2-create-a-context)2:åˆ›å»ºä¸Šä¸‹æ–‡

ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ useReducer åˆ›å»ºä¸€ä¸ªçŠ¶æ€æ•°ç»„å’Œè°ƒåº¦å‡½æ•°ã€‚ä½†é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå­˜æ”¾å®ƒä»¬çš„åœ°æ–¹ã€‚è¿™å°±æ˜¯å¥‡è¿¹å‘ç”Ÿçš„åœ°æ–¹ã€‚æˆ‘ä»¬å°†åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­å­˜å‚¨çŠ¶æ€å’Œè°ƒåº¦ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ä»ä»»ä½•åœ°æ–¹è®¿é—®å®ƒä»¬ã€‚è®©æˆ‘ä»¬é€šè¿‡åˆ›é€ æˆ‘ä»¬çš„è¯­å¢ƒè€Œå­˜åœ¨:

```
const MessageContext = React.createContext({
  state: [],
  dispatch: null,
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#3-providing-the-reducer)3:æä¾›å‡é€Ÿå™¨

åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„é¡¶å±‚ï¼Œæˆ–è€…æ‚¨æƒ³è¦è®¿é—® duck çš„æœ€é«˜å±‚ï¼Œæ‚¨ä¼šæƒ³è¦å°†åˆ›å»º reducer çš„ç»“æœä¼ é€’åˆ°ä¸Šä¸‹æ–‡ä¸­ã€‚

```
import React, { useReducer } from 'react'
import { messageReducer, MessageContext } from './message_duckling
const App = () => {
  const [state, dispatch] = useReducer(messageReducer, [])
  return ( 
    <MessageContext.Provider value={{state, dispatch}}>
      {/* Your App Here */}
    </MessageContext>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#4-accessing-the-messages-with-usecontext)4:ä½¿ç”¨ UseContext è®¿é—®æ¶ˆæ¯

è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç”¨ä¾‹ï¼Œè¯»å–ç»„ä»¶ä¸­çš„æ¶ˆæ¯ã€‚

```
import React, { useContext } from 'react'
import { MessageContext } from './message_context'
const MessageContainer = () => {
  const { state, dispatch } = useContext(MessageContext)
  return (
    <div className="messages-container">
      {state.map((message, index) => (
        <div className={`message ${message.type}`}>
          <span>{message.text}</span>
        </div>
      ))}
    </div>
  )
}
export default MessageContainer 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#5-dispatch-actions)5:è°ƒåº¦åŠ¨ä½œ

ä¸ redux ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ dispatch å‡½æ•°æ¥æ›´æ–°æ¶ˆæ¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ›å»ºæ¶ˆæ¯çš„è¡¨å•ç»„ä»¶:

```
import React, { useState, useContext } from 'react'
import { MessageContext } from './message_context'
const MessageForm = () => {
  const [text, setText] = useState('')
  const { dispatch } = useContext(MessageContext)
  const createMessage = (e) => {
    e.preventDefault()
    const newMessage = { type: 'warning', text }
    dispatch({
      type: 'ADD',
      payload: newMessage
    })
  }
  return (
    <form onSubmit={createMessage}>
      <input type={text} onChange={e => setText(e.target.value)} />
      <input type="submit" value="post message" />
    </form>
  )
}
export default MessageForm 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#bonus-points-hocs-and-custom-hooks)å¥–åŠ±ç§¯åˆ†:hoc å’Œå®šåˆ¶æŒ‚é’©

ä¸ºäº†ä½¿æ‚¨çš„ä»£ç æ›´åŠ æ¸…æ™°ï¼Œæ‚¨å¯ä»¥å°† useReducer åŒ…è£…æˆå®ƒè‡ªå·±çš„è‡ªå®šä¹‰é’©å­ã€‚ä¸ºäº†ä½¿ä»£ç æ›´å…·å¯æ‰©å±•æ€§ï¼Œæ‚¨è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªé€‰é¡¹ï¼Œå…è®¸ç”¨æˆ·å®šä¹‰è‡ªå·±çš„åˆå§‹çŠ¶æ€:

```
const useMessageReducer = (initial_state = []) {
  return useReducer(messageReducer, initialState)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦ä¸€ä¸ªæœ‰ç”¨çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå°†ä½ çš„å°é¸­ä¼ é€’ç»™ä»»ä½•å‡½æ•°ã€‚è¿™æ ·ä½ å°±å¯ä»¥æ‹¥æœ‰ç±»ä¼¼ Redux çš„ connect å‡½æ•°çš„åŠŸèƒ½:

```
const withMessageStore = (WrappedComponent) => (props) => {
  const { state, dispatch } = useContext(MessageContext)
  return (<WrappedComponent
    {...props}
    messageStore={state}
    messageDispatch={dispatch}
  />) } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#review-features-of-a-duckling)å¤ä¹ :ä¸€åªå°é¸­å­çš„ç‰¹å¾

å°é¸­åŒ…æ‹¬ä»€ä¹ˆï¼Ÿ

*   ä¸€ä¸ª**ä¸Šä¸‹æ–‡**ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹å¼•ç”¨å®ƒã€‚
*   è¯¥ä¸Šä¸‹æ–‡å¸¦æœ‰ä¸€ä¸ªå…¨å±€**çŠ¶æ€**å’Œä¸€ä¸ª**åˆ†æ´¾**åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª**ç¼©å‡å™¨ç¼–è¾‘è¯¥çŠ¶æ€ã€‚**å¯é€‰åœ°ï¼Œå®ƒå¯ä»¥åŒ…æ‹¬ä¸€ä¸ª**å®šåˆ¶é’©å­**å’Œ**é«˜é˜¶ç»„ä»¶**ä»¥ä½¿å…¶æ›´å®¹æ˜“å®ç°ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ Redux ä¸­åŒ…å«çš„ä¸€äº›æˆ‘ä»¬è¿™é‡Œæ²¡æœ‰çš„ç‰¹æ€§ã€‚

## [](#what-a-duckling-isnt)å°é¸­ä¸æ˜¯ä»€ä¹ˆ

*   ä¸€åªå°é¸­å­ä¸æä¾›**åŠ¨ä½œ**ã€**ç±»å‹**æˆ–**åŠ¨ä½œåˆ›å»ºè€…**ã€‚
*   ä¸€åªå°é¸­å­ä¸å…³å¿ƒçŠ¶æ€å’Œè°ƒåº¦æ˜ å°„ã€‚æ¯ä¸ªç»„ä»¶éƒ½è·å¾—æ•´ä¸ªçŠ¶æ€å’Œæ•´ä¸ªè°ƒåº¦ã€‚è¿™é‡Œæ²¡æœ‰ **mapStateToProps** æˆ–**mapdispatctoprops**ã€‚
*   å› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰é€‰æ‹©ç¬¦ã€‚å°½ç®¡ä½ æœ‰å¯èƒ½å»ºé€ å®ƒä»¬ã€‚
*   å®ƒæ²¡æœ‰**ä¸­é—´ä»¶çš„æ¦‚å¿µã€‚**

å¦‚æœæ‚¨è®¤ä¸ºæ‚¨è¯•å›¾è§£å†³çš„é—®é¢˜éœ€è¦æ›´å¤šè¿™ç§åŠŸèƒ½ï¼Œé‚£ä¹ˆæ‚¨çŸ¥é“æ‚¨æœ‰æ›´å¼ºçš„ä½¿ç”¨ Redux çš„ç”¨ä¾‹ï¼ä¸è¦æ¥å—è¿™ä¸ªå»ºè®®ï¼Œåœ¨ä¸éœ€è¦çš„æ—¶å€™é‡æ–°å‘æ˜è½®å­ã€‚ç›¸åï¼Œå½“ä½ éœ€è¦æ›´å°çš„è½®å­è¿›è¡Œæ›´çŸ­ã€æ›´ç®€å•çš„æ—…è¡Œæ—¶ï¼Œå°±ä½¿ç”¨å®ƒã€‚

* * *

## [](#credits)å­¦åˆ†:

*   ä¹”èˆ’äºšÂ·å¯Œå‹’åœ¨ [Unsplash](https://unsplash.com/s/photos/duckling) ä¸Šæ‹æ‘„çš„å¯çˆ±çš„å°é¸­å­ç…§ç‰‡ã€‚
*   [ç”¨ä½¿ç”¨ä¸Šä¸‹æ–‡æ»šåŠ¨è‡ªå·±çš„ Redux&useReducer](https://glennstovall.com/ducklings-roll-your-own-redux-with-usecontext-usereducer/)é¦–æ¬¡å‡ºç°åœ¨[æ ¼ä¼¦Â·æ–¯æ‰˜ç“¦å°”â€”â€”å·¥ç¨‹å¸ˆ](https://glennstovall.com)ã€‚

* * *