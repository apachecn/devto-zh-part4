# å°†ä»»ä½• Jekyll ç«™ç‚¹å˜æˆ PWA

> åŸæ–‡:[https://dev . to/the white wulfy/make-any-Jekyll-site-into-a-pwa-1de 2](https://dev.to/thewhitewulfy/make-any-jekyll-site-into-a-pwa-1de2)

æ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åº(PWA)ä½¿ç”¨ç°ä»£ç½‘ç»œåŠŸèƒ½æ¥æä¾›ç±»ä¼¼åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ä½“éªŒã€‚ä»»ä½•ç½‘ç«™éƒ½å¯ä»¥åšæˆ PWAã€‚

## [](#the-basics)åŸºç¡€çŸ¥è¯†

å°†ä¸€ä¸ªåŸºæœ¬çš„ç½‘ç«™è½¬å˜æˆ PWA å¾ˆå®¹æ˜“ï¼Œä¹Ÿæœ‰å¾ˆå¤šå¥½å¤„ï¼Œä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç®€å•åœ°äº†è§£ä¸€ä¸‹å®ƒä»¬ã€‚

å…¶æ ¸å¿ƒçš„æ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åºåªæ˜¯ä¸€ç§ä¼˜åŒ–æ‚¨çš„ç½‘ç«™ï¼Œä»¥æ›´å¥½ï¼Œæ›´å¿«åœ°äº¤ä»˜ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬åº”è¯¥å­¦ä¼šåˆ©ç”¨è¿™äº›æ–°çš„å¯èƒ½æ€§ï¼Œä¸ç®¡æˆ‘ä»¬çš„å†…å®¹æ˜¯ä»€ä¹ˆã€‚

æˆ‘è‡ªå·±çš„ç½‘ç«™åªæ˜¯ä¸€å †é™æ€ HTMLï¼Œæˆ‘çš„åšå®¢åŸºäº Jekyllï¼Œå®ƒä»¬ä»ç„¶æ˜¯å®Œå…¨æœ‰æ•ˆçš„æ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åºã€‚å¦‚æœä½ åœ¨ç½‘ä¸Šè¿è¡Œä»»ä½•ä¸œè¥¿ï¼Œä½ è‚¯å®šèƒ½ä»ä¸­å—ç›Šã€‚

ç¾å¦™ä¹‹å¤„åœ¨äºï¼Œpwa æä¾›äº†ä¸¤ä¸ªä¸–ç•Œçš„æœ€ä½³é€‰æ‹©â€”â€”æ¥è‡ª web çš„æ·±åº¦é“¾æ¥å’Œ URLã€ç¦»çº¿è®¿é—®ã€æ¨é€é€šçŸ¥å’Œæ¥è‡ªæœ¬æœºåº”ç”¨çš„æ›´å¤šè®¾å¤‡ç‰¹å®šåŠŸèƒ½â€”â€”åŒæ—¶ä»ç„¶ä¿æŒå®Œå…¨çš„å¹³å°ç‹¬ç«‹æ€§ã€‚åªæœ‰ç½‘ç»œã€‚å¦‚æœè€ä¸€ç‚¹çš„æµè§ˆå™¨ä¸æ”¯æŒï¼Œå°±ä¸ä¼šåï¼›åªæ˜¯å›è½åˆ°é»˜è®¤:æ­£è§„ç½‘ç«™ã€‚æ˜¯çš„ï¼Œæœ‰ä¸€äº›æœåŠ¡å¯ä»¥å°†ä½ çš„ PWA åˆ¶ä½œæˆåº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥å‘å¸ƒåˆ°åº”ç”¨ç¨‹åºå•†åº—ã€‚

æœ‰ä¸€äº›é‡è¦çš„ä¼˜åŠ¿:

*   æ›´å¿«ã€æ›´å®‰å…¨çš„ç”¨æˆ·ä½“éªŒ
*   æ›´å¥½çš„è°·æ­Œæ’å
*   æ›´å¥½çš„å¯ç”¨æ€§
*   æ›´å¥½çš„æ€§èƒ½
*   åŠå…¬å®¤è®¿é—®
*   åƒæœ¬åœ°åº”ç”¨ç¨‹åºä¸€æ ·çš„ä¸»å±å¹•å¿«æ·æ–¹å¼

å³ä½¿ä½ ä¸å¸Œæœ›ä½ çš„ç”¨æˆ·â€œå®‰è£…â€ä½ çš„ PWA(ä¾‹å¦‚ï¼Œåœ¨ä»–ä»¬çš„ä¸»å±å¹•ä¸Šæ”¾ç½®ä¸€ä¸ªå¿«æ·æ–¹å¼)ï¼Œè¿›è¡Œåˆ‡æ¢ä»ç„¶æœ‰å¾ˆå¤šå¥½å¤„ã€‚äº‹å®ä¸Šï¼Œåˆ¶ä½œ PWA çš„æ‰€æœ‰å¿…è¦æ­¥éª¤éƒ½ä¼šç§¯æåœ°æ”¹å–„ä½ çš„ç½‘ç«™ï¼Œå…¶ä¸­è®¸å¤šæ­¥éª¤è¢«è®¤ä¸ºæ˜¯æœ€ä½³å®è·µã€‚

## [](#how-do-i-do-it-in-jekyll)æˆ‘åœ¨ Jekyll æ€ä¹ˆåšï¼Ÿ

æˆ‘ä»¬å°†ä»æ¸…å•å¼€å§‹ï¼Œç„¶åè½¬åˆ° JavaScript éƒ¨åˆ†ã€‚Jekyll ä½¿ç”¨äº†ä¸€ä¸ªåŸºäº partials çš„æ„å»ºç³»ç»Ÿï¼Œæˆ‘ä»¬å°†åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚

æœ¬ç³»åˆ—çš„ç¬¬äºŒéƒ¨åˆ†å°†ä»‹ç»å¦‚ä½•è®©ä»»ä½•é™æ€ç½‘ç«™æˆä¸º PWAï¼Œç¬¬ä¸‰éƒ¨åˆ†å°†è®¨è®ºå¦‚ä½•åœ¨ PWA ä¸­ä½¿ç”¨ç‰¹å®šäºè®¾å¤‡çš„åŠŸèƒ½ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†éƒ¨åˆ†åˆ©ç”¨ [PWA-Builder](https://www.pwabuilder.com) æ¥åšè®¸å¤šäº‹æƒ…ã€‚

## [](#the-manifest)è½½è´§å•

æ¸…å•åªæ˜¯ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œå®ƒæè¿°äº† PWA çš„æ‰€æœ‰å…ƒæ•°æ®ã€‚æ¯”å¦‚ä½ çš„åº”ç”¨ç¨‹åºçš„åç§°ã€è¯­è¨€å’Œå›¾æ ‡éƒ½åœ¨é‡Œé¢ã€‚è¿™äº›ä¿¡æ¯å°†å‘Šè¯‰æµè§ˆå™¨å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¿å­˜ä¸ºå¿«æ·æ–¹å¼æ—¶æ˜¾ç¤ºå®ƒã€‚

```
{  "lang":  "en",  "dir":  "ltr\rtl",  "name":  "This is my jekyll PWA",  "short_name":  "myPWA",  "icons":  [  {  "src":  "\/assets\/images\/touch\/android-chrome-192x192.png",  "sizes":  "192x192",  "type":  "image\/png"  }  ],  "theme_color":  "#1a1a1a",  "background_color":  "#1a1a1a",  "start_url":  "/",  "display":  "standalone",  "orientation":  "natural"  } 
```

è¿™é€šå¸¸è¢«ç§°ä¸º`manifest.json`æˆ–`site.webmanifest`ï¼Œä»æ‚¨ç«™ç‚¹çš„`<head>`é“¾æ¥åˆ°

```
<link rel="manifest" href="manifest.json"> 
```

å…³äºæ¸…å•æ–‡ä»¶ä¸­å¯ä»¥æœ‰å“ªäº›å­—æ®µï¼Œè¯·å‚è§ [MDN](https://developer.mozilla.org/en-US/docs/Web/Manifest) ã€‚

å¯¹äº jekyllï¼Œæˆ‘ä»¬å°†å¯¹`manifest.json`åšä¸€äº›æ›´æ”¹ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç›´æ¥ä»`_config.yml`è¿›è¡Œæ›´æ”¹ï¼Œå¹¶é˜²æ­¢ Jekyll ä½¿ç”¨é»˜è®¤å¸ƒå±€æ¥å‘ˆç°å®ƒ(è¿™å¯èƒ½ä¼šå°† json æ’å…¥åˆ°æŸäº›ä¸»é¢˜çš„ html ä¸­)ã€‚

`<head>`éƒ¨åˆ†å°†å‡ºç°åœ¨æ„æˆæ¯é¡µæ ‡é¢˜çš„`partial`ä¸­ã€‚é€šå¸¸å®ƒä¼šä½äº`_partials`ã€‚

```
 ---  layout:  none  ---  {  "lang":  "{{ site.language }}",  "dir":  "{{ site.lang_direction }}",  "name":  {{  site.name  |  smartify  |  jsonify  }},  "short_name":  {{  site.short_name  |  smartify  |  jsonify  }},  "icons":  [  {  "src":  "\/assets\/images\/touch\/android-chrome-192x192.png",  "sizes":  "192x192",  "type":  "image\/png"  }  ],  "theme_color":  "{{ site.color }}",  "background_color":  "{{ site.color }}",  "start_url":  "{{ site.url }}",  "display":  "standalone",  "orientation":  "natural"  } 
```

åœ¨`_config.yml`ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å·²ç»æœ‰äº†ä¸‹é¢è¿™äº›å­—æ®µï¼Œå¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶åœ¨é‚£é‡Œæ·»åŠ ã€‚ğŸ˜…

```
 name: "mysite"
short_name: "ms"
url: "https://mysite.com"
language: "en"
lang_direction: "ltr"
color: "#abc123" 
```

ä½ çš„è´§å•å·²ç»å‡†å¤‡å¥½äº†ã€‚ç°åœ¨æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€éƒ¨åˆ†ã€‚

## [](#register-the-service-worker)ç™»è®°æœåŠ¡äººå‘˜

ç°åœ¨æˆ‘ä»¬éœ€è¦å°†æ³¨å†ŒæœåŠ¡äººå‘˜çš„ JavaScript æ·»åŠ åˆ°æ„æˆæ¯ä¸ªé¡µé¢çš„`<head>`çš„`partial`ä¸­ã€‚å’Œä»¥å‰ä¸€æ ·ï¼Œå®ƒé€šå¸¸ä½äº`_partials`ã€‚

æˆ‘ä»¬éœ€è¦åœ¨`<script>`æ ‡ç­¾ä¸­æ·»åŠ ä¸‹é¢è¿™æ®µ JavaScript ä»£ç ã€‚

```
 if ("serviceWorker" in navigator) {
  if (navigator.serviceWorker.controller) {
    console.log("An active service worker found, no need to register");
  } else {
    // Register the service worker
    navigator.serviceWorker
      .register("{{ site.baseurl }}/serviceworker.js", {
        scope: "./"
      })
      .then(function (reg) {
        console.log("Service worker has been registered for scope: " + reg.scope);
      });
  }
} 
```

## [](#service-worker)æœåŠ¡äººå‘˜

ç°åœ¨æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€æ­¥ã€‚æˆ‘ä»¬éœ€è¦åœ¨ä½ çš„ç«™ç‚¹çš„æ ¹ç›®å½•ä¸‹åˆ›å»º`serviceworker.js`ã€‚

å®ƒå°†å…·æœ‰ä»¥ä¸‹ JavaScript:

```
 const CACHE = "pwabuilder-offline";

const offlineFallbackPage = "index.html";

// Install stage sets up the index page (home page) in the cache and opens a new cache
self.addEventListener("install", function (event) {
  console.log("Install Event processing");

  event.waitUntil(
    caches.open(CACHE).then(function (cache) {
      console.log("Cached offline page during install");

      if (offlineFallbackPage === "ToDo-replace-this-name.html") {
        return cache.add(new Response("Update the value of the offlineFallbackPage constant in the serviceworker."));
      }

      return cache.add(offlineFallbackPage);
    })
  );
});

// If any fetch fails, it will look for the request in the cache and serve it from there first
self.addEventListener("fetch", function (event) {
  if (event.request.method !== "GET") return;

  event.respondWith(
    fetch(event.request)
      .then(function (response) {
        console.log("Add page to offline cache: " + response.url);

        // If request was success, add or update it in the cache
        event.waitUntil(updateCache(event.request, response.clone()));

        return response;
      })
      .catch(function (error) {        
        console.log("Network request Failed. Serving content from cache: " + error);
        return fromCache(event.request);
      })
  );
});

function fromCache(request) {
  // Check to see if you have it in the cache
  // Return response
  // If not in the cache, then return error page
  return caches.open(CACHE).then(function (cache) {
    return cache.match(request).then(function (matching) {
      if (!matching || matching.status === 404) {
        return Promise.reject("no-match");
      }

      return matching;
    });
  });
}

function updateCache(request, response) {
  return caches.open(CACHE).then(function (cache) {
    return cache.put(request, response);
  });
} 
```

ç°åœ¨æ‚¨å·²ç»å®Œæˆäº† JavaScript éƒ¨åˆ†ã€‚

## [](#looking-forward)å‘å‰çœ‹

æŠŠè¿™äº›æ”¹å˜æ”¾åˆ°ä½ çš„ Jekyll ç½‘ç«™ä¸Šï¼Œç§ï¼å®ƒç°åœ¨æ˜¯ä¸€ä¸ª PWAã€‚ğŸ˜

ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘æ•…æ„å¿½ç•¥äº†å°†å›¾æ ‡æ˜ å°„åˆ°é…ç½®çš„éƒ¨åˆ†ï¼Œå¦‚æœä½ éœ€è¦å¸®åŠ©ï¼Œè¯·åœ¨ä¸‹é¢ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä¼šå‘Šè¯‰ä½ æ€ä¹ˆåšã€‚

æ­¤å¤–ï¼ŒHTTPS æ˜¯å¿…ä¸å¯å°‘çš„ç½‘ç«™æ˜¯ä¸€ä¸ª PWAã€‚å¾ˆå¯èƒ½ä½ å·²ç»å¬è¯´è¿‡å®ƒï¼Œä¹Ÿè®¸æ­£åœ¨ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥æˆ‘æ²¡æœ‰å¼ºè°ƒå®ƒã€‚

[å¯é€‰]æ‚¨å¯ä»¥é€šè¿‡ Lighthouse Audit æ£€æŸ¥ PWA çš„çŠ¶æ€ã€‚ğŸ˜„

## [](#make-your-app)åˆ¶ä½œä½ çš„ app

æ˜¯å•Šï¼

å¦‚æœä½ å·²ç»èµ°äº†è¿™ä¹ˆè¿œï¼Œä¸ºä»€ä¹ˆä¸èµ°å¾—æ›´è¿œå‘¢ï¼Ÿ

å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥é€šè¿‡ [PWA-Builder](https://www.pwabuilder.com) å°†ä½ çš„åº”ç”¨ä¸Šä¼ åˆ°å¾®è½¯å•†åº—ã€Play å•†åº—å’Œåº”ç”¨å•†åº—ã€‚

é¦–å…ˆï¼Œä½ å¿…é¡»è¾“å…¥ä½ çš„ç½‘ç«™çš„ç½‘å€ï¼Œç„¶åç‚¹å‡»å›è½¦ã€‚å®ƒä¼šç»™ä½ çš„ PWA æ‰“æ»¡åˆ†ã€‚å¦‚æœä½ éµå¾ªè¿™ä¸ªæŒ‡å—ï¼Œä½ ä¼šå¾—åˆ° 95 åˆ†ã€‚è¿˜ä¸é”™ã€‚ğŸ˜…

ä½ ä¼šåœ¨å³ä¸Šè§’çœ‹åˆ°ä¸€ä¸ªäº®ç´«è‰²çš„æŒ‰é’®ï¼Œä¼šå‡ºç°ä¸€ä¸ªé¡µé¢ï¼Œä¸Šé¢æœ‰ä¸‹è½½åº”ç”¨ç¨‹åºå¹¶ç»§ç»­ä¸‹ä¸€æ­¥æ“ä½œçš„è¯´æ˜ã€‚å¦‚æœä½ éœ€è¦å¸®åŠ©ï¼Œä½ å¯ä»¥åœ¨ä¸‹é¢ç•™è¨€ã€‚ğŸ˜€

##### [](#until-next-time)ä¸‹æ¬¡è§ï¼

å¹²æ¯ï¼ğŸ»