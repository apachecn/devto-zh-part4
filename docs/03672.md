# åˆ›å»ºä¸å¸¦ Node.js çš„ JS web æœåŠ¡å™¨

> åŸæ–‡:[https://dev . to/rum kin/how-to-create-js-web server-without-node-js-1 hic](https://dev.to/rumkin/how-to-create-js-webserver-without-node-js-1hic)

ç°åœ¨æœ‰å¾ˆå¤šä¸º Node.js åˆ›å»ºçš„ web æœåŠ¡å™¨ï¼Œå¾ˆéš¾è¯´å“ªä¸€ä¸ªæ›´å¥½ã€‚å·¥ç¨‹å¸ˆä»¬æ­£åœ¨åŠªåŠ›ä¸ºä»–ä»¬çš„äº§å“æ·»åŠ ä¸€äº›æ–°çš„ä¸œè¥¿ï¼Œå¹¶ä½¿ç”¨æœ€æ–°çš„ JS å’Œ v8 åŠŸèƒ½æ¥å¸¦æ¥æ›´å¿«ã€æ›´æ–¹ä¾¿å’Œæ›´æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä¹Ÿåœ¨ç ”ç©¶ä¸€ä¸ªã€‚æ˜¯[æ¤ç‰©](https://rumkin/plant)ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®²è¿° Plant åœ¨æ²¡æœ‰ Node.js çš„æƒ…å†µä¸‹å·¥ä½œçš„èƒ½åŠ›ã€‚

Plant æ˜¯ä¸€ä¸ª WebAPI æ”¶è´¹çš„ web æœåŠ¡å™¨ï¼Œè¿™æ„å‘³ç€å®ƒä½¿ç”¨ä¸æµè§ˆå™¨ç›¸åŒçš„æ¥å£ã€‚æ­¤å¤–ï¼Œå®ƒä¸ä¼ è¾“æ— å…³ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä¸œè¥¿æ¥ä¼ é€’è¯·æ±‚:TCPã€WebSocketã€WebRTC ç­‰ã€‚å°†æ‰€æœ‰è¿™äº›ç»“åˆèµ·æ¥ï¼Œå®ƒå¯ä»¥ä»¥åŒæ ·çš„æ–¹å¼åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¸Šå·¥ä½œã€‚è¿™ç§èƒ½åŠ›ç»™äº†æˆ‘ä»¬ä»€ä¹ˆï¼Ÿ

*   æˆ‘ä»¬å¯ä»¥åªä½¿ç”¨ä»£ç ç¼–è¾‘å™¨å’Œ web æµè§ˆå™¨æ¥å¼€å‘ web æœåŠ¡å™¨ï¼Œä½¿ç”¨ DevTool çš„è°ƒè¯•å™¨è€Œä¸æ˜¯ console.log æ¥è¿›è¡Œæ•…éšœæ’é™¤ï¼Œç„¶ååªéœ€å°†å…¶ç§»åŠ¨åˆ° Node.jsã€‚
*   æˆ‘ä»¬ç”šè‡³ä¸éœ€è¦å®‰è£…ä»»ä½•ä¸œè¥¿ã€‚
*   å®ƒä½¿å¾—æµ‹è¯•æ›´åŠ å¯é ï¼Œç¼–å†™ã€è¿è¡Œå’Œç†è§£æ›´åŠ ç®€å•ã€‚
*   æ˜“å­¦:ä»£ç è¢«éš”ç¦»åˆ°æµè§ˆå™¨ä¸­ï¼Œä¸å—ç¯å¢ƒå½±å“ã€‚
*   çœŸæ­£çš„è·¨å¹³å°:å®ƒåœ¨ä»»ä½•åœ°æ–¹éƒ½ä»¥ç›¸åŒçš„æ–¹å¼å·¥ä½œã€‚

> TLï¼›åšå£«è¿™é‡Œæ˜¯ç®€å•æ¼”ç¤ºå’Œå¤æ‚æ¼”ç¤ºçš„[ã€‚](https://rumkin.github.io/plant-browser-demo/simple-example.html)

[æ¼”ç¤ºå›è´­](https://github.com/rumkin/plant-browser-demo) [å·¥å‚å›è´­](https://github.com/rumkin/plant)

è®©æˆ‘ä»¬å¼€å§‹å§ã€‚ä½ æ‰€éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTML æ–‡ä»¶å’Œä¸€ä¸ªç©ºç™½é¡µé¢ã€‚

```
<!DOCTYPE html>
<html>
  <head></head>
  <body></body>
</html> 
```

## [](#import)å¯¼å…¥

è¦åœ¨æ‚¨çš„ç½‘é¡µä¸­ä½¿ç”¨ Plantï¼Œåªéœ€ä» unpkg.com:

```
<script src="https://unpkg.com/@plant/plant@2.4.0/dist/plant.js"></script> 
```

æ”¾å…¥`<head>`ã€‚ç„¶åä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåˆ›å»ºæ–°çš„`<script>`åˆ°`<body>`å…ƒç´ ä¸­ã€‚

## [](#create-server)åˆ›å»ºæœåŠ¡å™¨

æœåŠ¡å™¨åˆ›å»ºç±»ä¼¼äº Expressâ€™æˆ– Koaâ€™sï¼Œä½†ç•¥æœ‰ä¸åŒã€‚

```
// Instantiate server
const plant = new Plant()

// Add handler
plant.use('/index.html', ({req, res}) => {
  res.html('<!DOCTYPE html><html><body>Hello</body></html>')
}) 
```

å°±æ˜¯è¿™æ ·ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªéå¸¸ç®€å•çš„è¯·æ±‚å¤„ç†ç¨‹åºæ¥å¤„ç†â€œ/index.htmlâ€é¡µé¢ã€‚æ³¨æ„ï¼Œè·¯çº¿éå¸¸ä¸¥æ ¼ã€‚å®ƒå¯ä»¥å¤„ç†`/index.html`ï¼Œä½†ä¸èƒ½å¤„ç†`/`ã€‚

## [](#making-request)å‘å‡ºè¯·æ±‚

æµè§ˆå™¨æ— æ³•ç›‘å¬è¯·æ±‚ï¼Œæˆ‘ä»¬å°†åœ¨è‡ªå·±èº«ä¸Šè¿›è¡Œæ¨¡æ‹Ÿã€‚è¿™æ®µä»£ç å¯ä»¥ç”¨æ¥å¤„ç† WebSocket æˆ–ä»»ä½•å…¶ä»–ä¼ è¾“æ–¹å¼æäº¤çš„è¯·æ±‚ï¼Œå› æ­¤å®ƒå¯ä»¥è¢«ä»»ä½•ä¸œè¥¿ä½¿ç”¨ã€‚

è¿™æ˜¯æˆ‘ä»¬æœ€åçš„ä»£ç ï¼Œç¨åä¼šè§£é‡Š:

```
const handle = plant.getHandler()

const context = createContext('GET', 'https://localhost:8000/index.html')

handle(context)
.then(({res}) => {
  res.status // -> 200
  res.body // -> '<!DOCTYPE html>...
}) 
```

## [](#creating-context)åˆ›å»ºä¸Šä¸‹æ–‡

å·¥å‚ä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªç®€å•çš„å¯¹è±¡å®ä¾‹ã€‚å®ƒè¦æ±‚å¥—æ¥å­—ã€è¯·æ±‚å’Œå“åº”å®ä¾‹åˆ†åˆ«ä½œä¸º`socket`ã€`req`å’Œ`res`å±æ€§è¢«ä¼ é€’ã€‚

```
function createContext(method, url, {headers = {}, body} = {}) {
  const req = new Plant.Request({
    url: new URL(url),
    method,
    body,
    headers,
  })

  const res = new Plant.Response({
    url: new URL(url),
  })

  const socket = new Plant.Socket({
    peer: new Plant.Peer({
      uri: new Plant.URI({
        protocol: 'browser',
        host: navigator.appName,
      })
    })
  })

  return {req, res, socket}
} 
```

å¥—æ¥å­—éœ€è¦ä¸€ä¸ªä»£è¡¨è¿æ¥çš„å¦ä¸€æ–¹çš„å¯¹ç­‰å®ä¾‹ã€‚å¯¹ç­‰æ–¹åº”å§‹ç»ˆæä¾›ä¸€ä¸ªåœ°å€ï¼Œå¦‚ URIã€‚URI åœ¨è¿™é‡Œä½¿ç”¨ï¼Œè€Œä¸æ˜¯æ ‡å‡†çš„ç½‘å€ï¼Œå› ä¸ºç½‘å€æ— æ³•ä¸è‡ªå®šä¹‰æ–¹æ¡ˆã€‚æ‰€æœ‰è¿™äº›éƒ½éœ€è¦ï¼Œæˆ‘ä»¬å»ºè®®å¯¹ç­‰ä½“ä¹Ÿå¯ä»¥æ¥æ”¶è¿æ¥ï¼Œå› ä¸ºå·¥å‚å¯ä»¥ä½¿ç”¨æ”¯æŒè¿™ç§èƒ½åŠ›çš„ä¼ è¾“ã€‚

## [](#post-requests)å‘å¸ƒè¯·æ±‚

ä¸ºäº†æ¨¡æ‹Ÿ POST è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º [ReadableStream](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream) å®ä¾‹ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™è¯·æ±‚æ„é€ å‡½æ•°ã€‚

```
const body = streamFrom('Hello')

new Request({
  method: 'GET',
  url: 'https://localhost:8000',
  body,
})

function streamFrom(value) {
  return new ReadableStream({
    start(controller) {
      // Encode UTF8 into Uint8Array and push it into the stream
      const encoder = new TextEncoder()
      controller.enqueue(encoder.encode(value))
      controller.close()
    },
  })
} 
```

å‡½æ•°`createStream`åˆ›å»º ReadableStream å®ä¾‹ï¼Œå¹¶å°†æ•´ä¸ªä¼ é€’çš„å€¼ä½œä¸ºä¸€ä¸ªå—å†™å…¥å…¶ä¸­ã€‚

## [](#conclusion)ç»“è®º

ç°åœ¨ï¼Œæ‚¨å¯ä»¥å°†æ‰€æœ‰è¿™äº›æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶åœ¨è‡ªå·±çš„æµè§ˆå™¨ä¸­æ¨¡æ‹Ÿè¯·æ±‚ï¼Œè€Œæ— éœ€ä½¿ç”¨ Node.jsã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ç¼–å†™å¹¶è°ƒè¯• APIï¼Œç„¶åé€šè¿‡æœ€å°çš„æ›´æ”¹å°†å…¶ç§»åŠ¨åˆ° Node.jsã€‚åŒæ ·çš„ä»£ç ä¹Ÿå¯ä»¥ç”¨äºæµ‹è¯•ã€‚

å¦‚æœä½ é‡åˆ°ä¸€äº›å›°éš¾æˆ–è€…æƒ³è‡ªå·±æ£€æŸ¥ï¼Œä½¿ç”¨[ç®€å•çš„ä¾‹å­](https://rumkin.github.io/plant-browser-demo/simple-example.html)æˆ–è€…æ›´å¤æ‚çš„æ¼”ç¤ºã€‚

## [](#repositories)å‚¨å­˜åº“

## ![GitHub logo](img/a73f630113876d78cff79f59c2125b24.png) [æ‹‰å§†é‡‘](https://github.com/rumkin) / [æ¤ç‰©](https://github.com/rumkin/plant)

### ğŸŒ³JS web æœåŠ¡å™¨è´Ÿè´£ WebAPI å’Œ neat HTTP2 æ”¯æŒ

<article class="markdown-body entry-content container-lg" itemprop="text">

[![Plant logo](img/2e5e7f4282570ca21dc8bab7ade8f930.png)T2ã€‘](https://raw.githubusercontent.com/rumkin/plant/master/readme.md/packages/plant/dev/cover.png)

# æ¤ç‰©

[![npm](img/ff992d6c107167ab0429bbd5be722f55.png)](https://npmjs.com/package/@plant/plant)[![npm](img/0a3b0607468631aa8a8ffacafb37edf7.png)](https://npmjs.com/package/@plant/plant)[![](img/20364314c46b2c0fc05799dd9bd28775.png)](https://camo.githubusercontent.com/b3bab99d1b46b24e68dc583efbc7d244a8f9a3e9/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f73697a652d384b69422d626c75652e7376673f7374796c653d666c61742d737175617265)

[NPM](https://npmjs.com/package/@plant/plant) [æ¥æº](https://raw.githubusercontent.com/rumkin/plant/master/readme.md/packages/plant) [è‡ªè¿°](https://raw.githubusercontent.com/rumkin/plant/master/readme.md/packages/plant/readme.md)

Plant æ˜¯åŸºäº WebAPI æ ‡å‡†çš„ HTTP2 web æœåŠ¡å™¨ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„å’ŒåŠŸèƒ½è®¾è®¡ã€‚æ­¤å¤–ï¼Œå®ƒæ˜¯çº¯ç²¹çš„ï¼Œè€¦åˆåº¦è¾ƒä½ã€‚

å·¥å‚æ”¯æŒ HTTP 1 å’Œ HTTP 2 åè®®ã€‚ä½†å®ƒä¸ä¼ è¾“æ— å…³ï¼Œå¯ä»¥é€šè¿‡ WebSocketsã€WebRTC æˆ– PostMessage åœ¨æµè§ˆå™¨ä¸­æ­£å¸¸å·¥ä½œã€‚

## ç‰¹å¾

*   <g-emoji class="g-emoji" alias="cloud" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/2601.png">â˜ï¸</g-emoji> è½»é‡çº§:åªæœ‰ **8** KiB è¢«ç¼©å°å’Œå‹ç¼©ã€‚
*   âœ¨ æ— æœåŠ¡å™¨å°±ç»ª:ç”šè‡³å¯ä»¥åœ¨æµè§ˆå™¨ä¸­å·¥ä½œã€‚
*   <g-emoji class="g-emoji" alias="shield" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f6e1.png">é¢å‘ğŸ›¡</g-emoji> å®‰å…¨:é»˜è®¤ä½¿ç”¨æœ€ä¸¥æ ¼çš„[å†…å®¹å®‰å…¨ç­–ç•¥](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP) (CSP)ã€‚
*   <g-emoji class="g-emoji" alias="triangular_ruler" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f4d0.png">ğŸ“</g-emoji>åŸºäºæ ‡å‡†:ä½¿ç”¨ WebAPI æ¥å£ã€‚
*   <g-emoji class="g-emoji" alias="passenger_ship" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f6f3.png">ğŸ›³</g-emoji> ä¼ è¾“ä¸å¯çŸ¥:æ²¡æœ‰ HTTP æˆ–å¹³å°è€¦åˆï¼Œèˆ¹èˆ¶è¯·æ±‚é€šè¿‡**ä¸€åˆ‡**ã€‚

* * *

## ç›®å½•

*   [å®‰è£…](https://raw.githubusercontent.com/rumkin/plant/master/readme.md/#install)
*   [ä¾‹é¢˜](https://raw.githubusercontent.com/rumkin/plant/master/readme.md/#exmaples)
*   [å¥—é¤](https://raw.githubusercontent.com/rumkin/plant/master/readme.md/#packages)
*   [å†…éƒ¨åŒ…è£…](https://raw.githubusercontent.com/rumkin/plant/master/readme.md/#internal-packages)

## å®‰è£…

```
# Install plant web server
npm i @plant/plant
# Install node HTTP2 transport
npm i @plant/http2
```

## ä¾‹å­

### ä½ å¥½ä¸–ç•Œ

ç”¨ HTTP2 ä½œä¸ºä¼ è¾“çš„ Hello worldã€‚

> <g-emoji class="g-emoji" alias="warning" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/26a0.png">âš ï¸</g-emoji> æ³¨æ„ï¼Œé»˜è®¤ CSP æŠ¥å¤´å€¼ä¸º`default-src localhost; form-action localhost`è¿™å°†â€¦

</article>

[View on GitHub](https://github.com/rumkin/plant)

## ![GitHub logo](img/a73f630113876d78cff79f59c2125b24.png) [æ‹‰å§†é‡‘](https://github.com/rumkin) / [å·¥å‚-æµè§ˆå™¨-æ¼”ç¤º](https://github.com/rumkin/plant-browser-demo)

### æ— èŠ‚ç‚¹ web æœåŠ¡å™¨æ¼”ç¤º

<article class="markdown-body entry-content container-lg" itemprop="text">

# å·¥å‚æµè§ˆå™¨æ¼”ç¤º

è¿™æ˜¯ä¸€ä¸ªå•æ–‡ä»¶æ¼”ç¤º web åº”ç”¨ç¨‹åºã€‚å…¶ç›®çš„æ˜¯å±•ç¤ºå¦‚ä½•åœ¨æ²¡æœ‰ Node.js çš„æƒ…å†µä¸‹ï¼Œä»…ä½¿ç”¨æµè§ˆå™¨å’Œä»£ç ç¼–è¾‘å™¨æ¥å¼€å‘å…·æœ‰æµ‹è¯•è¦†ç›–çš„å…¨åŠŸèƒ½ web æœåŠ¡å™¨ã€‚

## ä½¿ç”¨

1.  å°†ç¬¬[é¡µ](https://raw.githubusercontent.com/rumkin/plant-browser-demo/master/readme.md/doc/index.html)ä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚
2.  åœ¨ä»£ç ç¼–è¾‘å™¨ä¸­æ‰“å¼€å®ƒã€‚
3.  æ›´æ–°`#Server`å’Œ`#Spec`è„šæœ¬ä»£ç ã€‚
4.  åˆ·æ–°é¡µé¢ã€‚DevTools æ§åˆ¶å°åº”è¯¥åŒ…å«æµ‹è¯•çš„å®Œæ•´è¾“å‡ºã€‚

## å±å›½

*   [æ¤ç‰©](https://github.com/rumkin/plant)ã€‚
*   [æµ‹è¯•å¼€å§‹](https://github.com/rumkin/testup)ã€‚
*   TinyAssert ã€‚

## ç»“æ„æ¦‚è¿°

è¯¥ç¤ºä¾‹çš„ä»£ç åˆ†ä¸ºå‡ ä¸ªè„šæœ¬ã€‚æ¯ä¸ªè„šæœ¬åŒ…å«ä¸ç‰¹å®šä»»åŠ¡ç›¸å…³çš„ä»£ç ã€‚

```
<script id="Server"></script>
<script id="Spec"></script>
<script id="TestupHelpers"></script>
<script id="PlantHelpers"></script>
<script id="Main"></script>
```

å…¶ä¸­:

*   `#Server`ã€‚æ‚¨çš„ http API ä»£ç ã€‚
*   `#Spec`ã€‚ä½ çš„æµ‹è¯•â€¦

</article>

[View on GitHub](https://github.com/rumkin/plant-browser-demo)