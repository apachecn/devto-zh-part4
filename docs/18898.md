# ç”¨ React åˆ›å»º Chrome æ‰©å±•

> åŸæ–‡ï¼š<https://dev.to/hurricaneinteractive/creating-a-chrome-extension-with-react-2bnm>

æœ€è¿‘ï¼Œæˆ‘ç€æ‰‹åˆ›å»ºä¸€ä¸ª chrome æ‰©å±•ï¼Œå¹¶åˆ©ç”¨ JavaScript å’Œ React å°†ä¸€ä¸ªç»„ä»¶æ³¨å…¥ä¸€ä¸ªç½‘ç«™ã€‚ç»“æœæ˜¯çªå˜è§‚å¯Ÿè€…å’Œ JavaScript çš„å®Œç¾ç»“åˆï¼

> ä»£ç å¯ä»¥åœ¨ [Github](https://github.com/myweekinjs/chrome-extension-w-react) ä¸Šæ‰¾åˆ°

## è®©æˆ‘ä»¬å‡†å¤‡å¥½ï¼

é¦–å…ˆï¼Œæˆ‘ä» chrome å¼€å‘è€…ç½‘ç«™ä¸‹è½½äº†ä¸€ä¸ª Chrome æ‰©å±•çš„å¯åŠ¨å™¨ã€‚å¦‚æœä½ æƒ³å­¦ä¹ æ‰©å±•å¼€å‘çš„åŸºç¡€ï¼Œæˆ‘ç»å¯¹æ¨èçœ‹ç½‘ç«™ã€‚æˆ‘ç«‹å³åˆ é™¤äº†`options.js`ã€`options.html`å’Œ`popup.js`æ–‡ä»¶ã€‚åœ¨`manifest.json`æ–‡ä»¶ä¸­ï¼Œæˆ‘ç§»é™¤äº†`permissions`æ•°ç»„ä¸­çš„`options_page`é”®å’Œ`storage`å€¼ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨æƒ³è¦å°†`https://www.myweekinjs.com/`æ·»åŠ åˆ°`permissions`æ•°ç»„ä¸­ã€‚

æˆ‘å°†å¤šæ¬¡å¼•ç”¨ *myweekinjs* ,è¿™å¯èƒ½æ˜¯ä½ å¸Œæœ›æ³¨å…¥ React ç»„ä»¶çš„ä»»ä½•ç½‘ç«™ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ç”¨ä¸€ä¸ªç®€å•çš„`console.log`åˆ›å»ºäº†ä¸€ä¸ª`app.js`æ¥æµ‹è¯•è„šæœ¬æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶å°†`background.js`æ›´æ–°ä¸ºï¼›

```
chrome.runtime.onInstalled.addListener(function() {
  chrome.declarativeContent.onPageChanged.removeRules(undefined, function() {
    chrome.declarativeContent.onPageChanged.addRules([{
      conditions: [new chrome.declarativeContent.PageStateMatcher({
        pageUrl: {
          hostEquals: 'www.myweekinjs.com',
          schemes: ['https', 'http'],
          pathContains: 'inject-me'
        },
        css: ['div']
      })],
      actions: [
        new chrome.declarativeContent.RequestContentScript({
          js: ['app.js']
        })
      ]
    }]);
  });
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½å§ï¼å¤ªå¤šäº†ï¼`background.js`è„šæœ¬å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

1.  å€¾å¬é¡µé¢/æ ‡ç­¾çš„å˜åŒ–
2.  æ£€æŸ¥å½“å‰é¡µé¢æ˜¯å¦ä¸º(http | https)://[www.myweekinjs.com/inject-me](http://www.myweekinjs.com/inject-me)
3.  å¦‚æœæ˜¯ï¼Œå®ƒå°†åŠ è½½æˆ‘ä»¬çš„`app.js`æ–‡ä»¶

æŒ‰ç…§è¿™äº›[æ­¥éª¤](https://developer.chrome.com/extensions/getstarted#manifest)åŠ è½½æ‚¨çš„æ‰©å±•ä»¥è¿›è¡Œæµ‹è¯•ã€‚

## æ¥æ‹¿è„šæœ¬å§ï¼

ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºæˆ‘ä»¬çš„`webpack.config.js`æ–‡ä»¶æ¥ç¼–è¯‘æˆ‘ä»¬çš„ React å’Œ Javascriptã€‚æ­¤æ—¶ï¼Œæˆ‘å»ºè®®ç”¨å½“å‰æ–‡ä»¶(å‡å»`app.js`)åˆ›å»ºä¸€ä¸ª *dist* æ–‡ä»¶å¤¹ï¼Œå¹¶è§£å‹è¯¥æ–‡ä»¶å¤¹ä½œä¸ºæˆ‘ä»¬çš„æ‰©å±•ã€‚è¿™æ ·ä½ å°±å¯ä»¥ç¼–è¯‘åˆ°è¿™ä¸ª *dist* æ–‡ä»¶å¤¹ä¸­ï¼Œè€Œä¸ä¼šå°†ä½ çš„ *node_modules* åŒ…å«åˆ°æ‰©å±•ä¸­ã€‚

> æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªäº†ä¸èµ·çš„èµ„æºæ¥ç”Ÿæˆæˆ‘ä»¬çš„ webpack å’Œã€‚babelrc æ–‡ä»¶ [createapp.dev](https://createapp.dev/)

1.  æ‰“å¼€èµ„æº^
2.  æ£€æŸ¥ååº”ï¼Œå·´è´å°”ã€‚å–æ¶ˆé€‰ä¸­ React çƒ­åŠ è½½ç¨‹åº
3.  è¿è¡Œ`npm init -y`å¹¶å®‰è£…èµ„æºæ¦‚è¿°çš„åŒ…
4.  å°†`webpack.config.js`å’Œ`.babelrc`æ–‡ä»¶å¤åˆ¶åˆ°æ‚¨çš„é¡¹ç›®ä¸­
5.  ä»`package.json`ä¸­å¤åˆ¶`scripts`

æˆ‘ä»¬éœ€è¦åšä¸€äº›å°çš„è°ƒæ•´ã€‚å¯¹äº`webpack.config.js`æ”¹å˜è¾“å…¥å’Œè¾“å‡ºè®¾ç½®ï¼›

```
var config = {
  entry: './app.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'app.js'
  },
  ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°†`build-dev`è„šæœ¬æ›´æ”¹ä¸ºï¼›

```
"dev": "webpack -d --mode development --watch" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨å¯èƒ½å¯¹`.babelrc`æœ‰ä¸€äº›è¯­æ³•é—®é¢˜ï¼Œä½†æ˜¯å®ƒä»¬åº”è¯¥å¾ˆå®¹æ˜“ä¿®å¤ï¼Œä¸»è¦æ˜¯å…³äºä½¿ç”¨åŒå¼•å·çš„é—®é¢˜ã€‚

è¿è¡Œ`build-prod`è„šæœ¬å°†ç¼–è¯‘`app.js`æ–‡ä»¶ã€‚åœ¨ä¸€æ¬¡æ‹†åŒ…å’Œé‡è£…ä¹‹åï¼Œä½ ä¼šçœ‹åˆ°å’Œä»¥å‰ä¸€æ ·çš„`console.log`ã€‚è¿™æ˜¯ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ï¼Œä½†ç°åœ¨äº‹æƒ…å˜å¾—æœ‰è¶£äº†ï¼

## æ¥æ‹¿ appy å§ï¼

æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåšä¸€äº›äº‹æƒ…ï¼›

1.  ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½
2.  è§‚å¯Ÿç›®æ ‡å®¹å™¨ä¸Šçš„çªå˜
3.  æ’å…¥æˆ‘ä»¬çš„ååº”æ ¹
4.  æ¸²æŸ“ååº”ç»„ä»¶

æˆ‘ä»¬ä»ä¸‹é¢çš„ç»“æ„å¼€å§‹ã€‚å®ƒå‘`load`ä¸Šçš„çª—å£æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œå¹¶åŒ…å«äº†æˆ‘ä»¬çš„ä¸»å›è°ƒå‡½æ•°ï¼Œæˆ‘ç§°ä¹‹ä¸º *app* ã€‚

```
window.addEventListener('load', function() {})

const app = () => {} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### æ­¥éª¤ 1 å®Œæˆï¼å‘å‰ï¼

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ª[å˜å¼‚è§‚å¯Ÿå™¨](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver)ï¼Œè¿™ç»™äº†æˆ‘ä»¬è§‚å¯Ÿ DOM æ ‘å˜åŒ–çš„è¶…èƒ½åŠ›ã€‚å®ƒæ˜¯éå¸¸ç”œèœœçš„ã€‚å¯¹äºæˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„[æµ‹è¯•é¡µé¢](http://myweekinjs.com/inject-me)ä¸Šè§‚å¯Ÿ`target-test` div(æµ‹è¯•é¡µé¢åœ¨æˆ‘çš„ä¸ªäººåšå®¢ä¸Š)ã€‚ä»¥ä¸‹ä»£ç è¢«æ·»åŠ åˆ° *load* å›è°ƒä¸­ã€‚

```
// Specifies the element we want to watch
const watch = document.getElementById('target-test')

// Creates a new Mutation Observer
const observer = new MutationObserver((mutationList, observer) => {

})

// Starts observing the child list of the element
observer.observe(watch, {
  childList: true
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çš„å…ƒç´ ï¼Œæˆ‘ä»¬å¸Œæœ›å¾ªç¯éå†çªå˜å¹¶è°ƒç”¨æˆ‘ä»¬çš„ app æ–¹æ³•ã€‚

```
const observer = new MutationObserver((mutationList, observer) => {
  // Loops through the mutations
  for (const mutation of mutationList) {
    // Checks if it is a change to the child elements
    if (mutation.type === 'childList') {
      // Attempts to find the p tag
      const target = watch.querySelector('p')
      if (target) {
        // Calls our app method
        app(observer, target)
      }
    }
  }
})

// Update the callback to accept those arguements
const app = (observer, target) => {} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¿«åˆ°äº†ï¼ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³ä¸º React ç»„ä»¶åˆ›å»ºä¸€ä¸ªæ ¹ï¼Œå¹¶å°†å…¶æ’å…¥ç›®æ ‡å…ƒç´ ä¹‹å‰ã€‚

```
const app = (observer, target) => {
  // Disconnects from the observer to stop any additional watching
  observer.disconnect()

  // Checks if the element doesn't exist
  if (!document.getElementById('react-root-test')) {
    // Create and inserts the element before the target
    const parent = target.parentNode
    const root = document.createElement('div')
    root.setAttribute('id', 'react-root-test')

    parent.insertBefore(root, target)
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## è®©æˆ‘ä»¬å¼€å§‹è¡ŒåŠ¨å§ï¼

ç°åœ¨æˆ‘ä»¬æœ‰äº† React æ ¹ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥åˆ›å»ºå’Œå‘ˆç°æˆ‘ä»¬çš„ç»„ä»¶äº†ã€‚æˆ‘å°†åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„ React ç»„ä»¶ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä»»ä½•æ‚¨é€‰æ‹©çš„ç»„ä»¶ï¼Œè¿™å–å†³äºæ‚¨ï¼ä¸€æ—¦æ‚¨æ·»åŠ äº†æ‚¨çš„ç»„ä»¶ï¼Œè§£å‹ç¼©æ‚¨çš„æ‰©å±•å¹¶é‡æ–°åŠ è½½æµ‹è¯•é¡µé¢ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ç»„ä»¶å‡ºç°äº†ï¼

```
import React from 'react'
import ReactDOM from 'react-dom'

const TestComponent = () => (
  <h1>I am dynamically added!</h1> )

const app = () => {
  //...
  parent.insertBefore(root, target)

  ReactDOM.render(<TestComponent />, document.getElementById('react-root-test'))
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## è½°ï¼

æˆ‘ä»¬åšåˆ°äº†ï¼è¿™ä»…ä»…æ˜¯ä½ ä½¿ç”¨ chrome æ‰©å±•å’Œ React æ‰€èƒ½åšçš„çš®æ¯›ã€‚ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯ï¼Œæ‚¨å°†èƒ½å¤Ÿå‘ç½‘ç«™æ·»åŠ åŠŸèƒ½ã€‚ç±»ä¼¼äº Grammarly æˆ– LastPass è¿™æ ·çš„æ‰©å±•ã€‚å¯èƒ½æ€§å‡ ä¹æ˜¯æ— ç©·æ— å°½çš„ï¼

## åŒ…è£…å®Œæ¯•

æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªéå¸¸é…·çš„é¡¹ç›®ã€‚æˆ‘ç»å¯¹æ²¡æœ‰æƒ³åˆ° chrome æ‰©å±•ä¼šæœ‰è¿™æ ·çš„äº‹æƒ…ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨çªå˜è§‚å¯Ÿå™¨å¯èƒ½æœ‰äº›è¿‡å¤´äº†ã€‚ç„¶è€Œï¼Œå½“ä½ é‡åˆ°ä¸€ä¸ªåŠ¨æ€å‘ˆç°å†…å®¹çš„ç½‘ç«™æ—¶ï¼Œèƒ½å¤Ÿç­‰åˆ°ä½ éœ€è¦çš„å†…å®¹å‡†å¤‡å¥½äº†ï¼Œè¿™æ˜¯è¶…çº§é…·çš„ï¼å¦‚æœæ‚¨å¯¹ä»£ç æˆ–è¿‡ç¨‹æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·é€šè¿‡ [Twitter](https://twitter.com/hurricane_int) è”ç³»æˆ‘ï¼Œæˆ‘å¾ˆä¹æ„ç»§ç»­è®¨è®ºè¿™ä¸ªé—®é¢˜å¹¶æ”¹è¿›æˆ‘çš„ä»£ç ã€‚

* * *

è°¢è°¢ä½ çœ‹æˆ‘çš„æ–‡ç« ï¼Œå®ƒçœŸçš„æ„ä¹‰é‡å¤§ï¼â¤ï¸ï¼Œè¯·æä¾›ä»»ä½•åé¦ˆæˆ–æ„è§ï¼Œæˆ‘æ€»æ˜¯æœŸå¾…æ”¹è¿›å’Œæœ‰æ„ä¹‰çš„è®¨è®ºã€‚è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘çš„ [#myweekinjs](http://myweekinjs.com) æŒ‘æˆ˜çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœä½ æœ‰å…´è¶£äº†è§£æ›´å¤šï¼Œæˆ‘è¿˜æœ‰å…¶ä»–æœ‰è¶£çš„æ–‡ç« ã€‚

### ğŸ‘‹ä¸‹æ¬¡è§ï¼