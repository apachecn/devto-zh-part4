# åˆ©ç”¨è§’å½¢ç®¡åˆ›é€ å½¢ä½“çš„æ€è€ƒ

> åŸæ–‡ï¼š<https://dev.to/ahkohd/thoughts-on-creating-forms-using-angular-pipes-3a7h>

åœ¨æˆ‘æœ€åä¸€ä¸ªè§’åº¦é¡¹ç›®ä¸­ã€‚æˆ‘ä¸ç¦æ³¨æ„åˆ°ï¼Œå½“å¤§é‡ HTML è¾“å…¥æ ‡ç­¾è·¨è¶Šæˆ‘æ­£åœ¨å¤„ç†çš„ç»„ä»¶æ¨¡æ¿ä»£ç æ—¶ï¼Œæˆ‘æ„Ÿåˆ°å¤šä¹ˆä¸å®‰ã€‚â€œåº”è¯¥æœ‰ä¸€ä¸ªæ›´ç®€æ´çš„æ–¹æ³•æ¥æŠ½è±¡è¿™äº›è¾“å…¥æ ‡ç­¾â€ï¼Œæˆ‘å–ƒå–ƒåœ°è¯´ã€‚

ä¹‹åï¼Œæˆ‘å†³å®šèµ·è‰ä¸€äº›æˆ‘è®¤ä¸ºæŠ½è±¡åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„è¯­æ³•ã€‚å•Šå“ˆï¼è¿™é¡¹å·¥ä½œçš„æœ€ä½³å·¥å…·æ˜¯ä»€ä¹ˆï¼Ÿ**ç®¡é“**ï¼Œç¥åœ£çš„çƒŸé›¾æ˜¯çš„ï¼ç®¡é“ã€‚

è§’å½¢ç®¡é“æä¾›äº†ä¸€ä¸ªéå¸¸åœ†æ»‘çš„æŠ½è±¡ï¼Œä¸€ä¸ªé€‚åˆæŠ½è±¡æ¢ç´¢çš„å·¥å…·ã€‚æ‰€ä»¥æˆ‘æƒ³åˆ°äº†ä¸‹é¢çš„ç®¡é“è¯­æ³•ã€‚

> å¿«é€Ÿå£°æ˜:æˆ‘åªæ˜¯æƒ³å°è¯•ä¸€ä¸‹ã€‚

[![A draft of pipe syntax to be used for pipe forms.](img/86f44668893825a6340d44f52b378e9b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--n7eG1YN7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AX4_9NZTOIYM6tQbnQ1wlSQ.png)

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæœ‰æ•ˆçš„ç®¡é“è¯­æ³•ï¼Œå®ƒåŒ…å«äº†åˆ›å»ºè¾“å…¥æ ‡è®°æ‰€éœ€çš„è¶³å¤Ÿçš„å‚æ•°ã€‚æ˜¯æ—¶å€™ç¼–å†™ä¸€ä¸ªç®¡é“ï¼Œå°†æˆ‘ä»¬çš„è¯­æ³•è½¬æ¢æˆä¸€ä¸ª**ä¼ª** HTML æ ‡ç­¾äº†ã€‚ç®¡é“å°†è¿”å›ä¸€ä¸ªç»“æœï¼Œè¯¥ç»“æœåŒ…å«ä¸€ä¸ªç”¨åŒæ–¹æ‹¬å·æ‹¬èµ·æ¥çš„è¾“å…¥æ ‡è®°è¯­æ³•ã€‚

[![Example of what pipe-form pipe will return with the provided input.](img/059918c9ca31f7ca9a1c2ad99ffc85d0.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--JI5TOjme--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2Ap6nGiqzmSt807GVrNLl8OQ.png)

ä¸‹é¢æ˜¯ä»£ç ç®¡é“ä»£ç çš„æ ·å­ã€‚

 **```
import {
  Pipe,
  PipeTransform
} from '@angular/core';

@Pipe({
  name: 'PipeForm'
})
export class FormPipe implements PipeTransform {
  // transforms the pipe input and returns a string following this format `[[<input/>]]`
  transform(elem: string, type: string, options ? : object): string {
    // declare output container..
    let out: string;
    // switch between the type if element we want to create
    switch (elem) {
      case 'input':
        // case input tag, 
        out = `[[<input type="${type}"`;
        // loop through the options parameter and format it into the out variable like HTML attributes.
        Object.entries(options).forEach((value: string[]) => {
          out += ` ${value[0]}="${value[1]}"`;
        });
        break;
    }
    // append the final, ending string.
    out += '/>]]';
    // we done here ;-)
    return out;
  }

} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ˜¯å•Šï¼è¿™å¯ä»¥å·¥ä½œï¼Œä½†åªæ˜¯è¿”å›ä¸€ä¸ªä¼ªå­—ç¬¦ä¸²ï¼Œå¯¹å—ï¼Ÿæœ€åï¼Œæˆ‘æ„è¯†åˆ°æˆ‘éœ€è¦æŸç§**å®¹å™¨**ï¼Œæˆ‘å¯ä»¥ç”¨å®ƒæ¥è§£æç®¡é“è¿”å›çš„ç»“æœï¼Œåˆ›å»ºå®é™…çš„è¾“å…¥å…ƒç´ ï¼Œç„¶åä½¿ç”¨**å‘ˆç°å™¨ 2** å°†å®ƒä»¬æ³¨å…¥åˆ° **DOM** ä¸­ã€‚æ‰€ä»¥æˆ‘éœ€è¦æ›´æ–°æˆ‘æœ€åˆçš„è¯­æ³•ã€‚è¦ä½¿ç”¨ç®¡é“è¡¨å•ï¼Œæ‚¨å¿…é¡»å°†å…¶åŒ…è£…åœ¨ **ngx-pipeform** ç»„ä»¶ä¸­ï¼Œè¯¥ç»„ä»¶å°†å……å½“ç®¡é“è¡¨å•çš„å‘ˆç°å™¨ã€‚æ‰€ä»¥æ›´æ–°åçš„è¯­æ³•çœ‹èµ·æ¥åƒè¿™æ ·ğŸ‘‡

[![The updated syntax for pipe-form, here ngx-pipeform wraps the pipeform-input pipe.](img/59b01316fc0f3fe37152ad7f09eb3a59.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--46gcGZG1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AbRF1VnCBbWrprVc4CuIctw.png)

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»„ä»¶ï¼Œä½œä¸ºç®¡é“è¡¨å•çš„åŒ…è£…å™¨ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå…³äºå®ƒå¦‚ä½•å·¥ä½œçš„ç®€ä»‹ã€‚

1.  å®ƒè·å–ç”± **pipeform pipe** è¿”å›çš„ç»“æœï¼Œç„¶åè§£æå®ƒã€‚
2.  åˆ›å»ºè¾“å…¥æ ‡ç­¾å…ƒç´ ï¼Œç„¶åå°†å®ƒä»¬æ³¨å…¥åˆ° **DOM** ä¸­ã€‚

ä¸‹é¢æ˜¯ä»£ç çš„æ ·å­ã€‚**pipe form . component . ts**

```
import {
  Component,
  ViewContainerRef,
  AfterViewInit,
  Renderer2
} from '@angular/core';

@Component({
  selector: 'ngx-pipeform',
  template: `<ng-content></ng-content>`,
})
export class PipeformComponent implements AfterViewInit {

  constructor(private viewRef: ViewContainerRef, private rd: Renderer2) {}

  ngAfterViewInit(): void {
    // after view init, lets get things done..
    // filter node type of text..
    // if text matches pipeform syntax, replace it with the input tag
    // the create the element and inject it into the dom with Renderer2.
    // lets travel through the DOM..
    this.recurseDomChildren(this.viewRef.element.nativeElement);
  }

  recurseDomChildren(start) {
    let nodes;
    if (start.childNodes) {
      nodes = start.childNodes;
      this.loopNodeChildren(nodes);
    }
  }

  loopNodeChildren(nodes) {
    let node;
    for (let i = 0; i < nodes.length; i++) {
      node = nodes[i];
      // try to parse each node..
      this.pipeFormParse(node);
      if (node.childNodes) {
        this.recurseDomChildren(node);
      }
    }
  }

  pipeFormParse(node) {
    // if the content of this node is a text node
    if (node.nodeType === 3) {
      // get its text content
      const textContent = node.textContent;
      // match the occurence of the pipe-form syntax, if found return an array of the result.
      const pipeForms = textContent.match(/\[\[(.*?)]]/gi);
      if (pipeForms) {
        // strip the double square brackets from all of the results.
        const readyElements = pipeForms.map(item => item.split('[[')[1].split(']]')[0]);
        // create a div container with Renderer2
        let elem = this.rd.createElement('div');
        // insert the prepaired input tag into the div.
        elem.innerHTML = readyElements.join('  ');
        // replace this current node with the new div node we just created.
        node.parentElement.replaceChild(elem, node);
      }
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹²æ¯ï¼å®ƒå·¥ä½œäº†ğŸ˜‚ğŸ»ï¼Œä½†ä»æœ‰è®¸å¤šæ”¹è¿›ã€é—®é¢˜å’Œè¯„è®ºéœ€è¦æˆ‘ä»¬ä»”ç»†æ£€æŸ¥ã€‚æˆ‘å°†è®©ä½ æ¥å†³å®šã€‚

### stack blitz ä¸Šæ‰˜ç®¡çš„ä¾‹å­

[https://stackblitz.com/edit/angular-pipe-form?](https://stackblitz.com/edit/angular-pipe-form?)
stack blitz ä¸Šçš„ç°åœºæ¼”ç¤º-[https://angular-pipe-form.stackblitz.io/](https://angular-pipe-form.stackblitz.io/)éšæ„æŸ¥çœ‹æºä»£ç [https://stackblitz.com/edit/angular-pipe-form](https://stackblitz.com/edit/angular-pipe-form)

### æˆ‘çš„é—®é¢˜

1.  è¿™æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å€¼å¾—åŠªåŠ›å—ï¼Ÿ
2.  å®ƒçš„æˆæœ¬æ˜¯å¤šå°‘ï¼Œæˆ‘æŒ‡çš„æ˜¯ç”Ÿäº§ç¯å¢ƒä¸­çš„æ€§èƒ½ï¼Ÿ
3.  è¯­æ³•çœ‹èµ·æ¥æ›´å¥½è¿˜æ˜¯æ›´å¹²å‡€ï¼Ÿ

### æ”¹è¿›

1.  è®¾è®¡ç®¡é“æ¨¡æ¿ã€‚
2.  è®©å®ƒä¸è§’æ¨¡å‹ä¸€èµ·å·¥ä½œï¼Œæˆ‘è¿˜æ²¡æœ‰å°è¯•è¿‡ã€‚
3.  è¯·è¿›è¡Œè¡¨å•éªŒè¯ï¼
4.  ä¹Ÿè®¸æ˜¯å¯¹ DOM éå†é€»è¾‘çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¼˜åŒ–ã€‚

### æœ€ç»ˆè£å†³

éå¸¸å¥½ğŸ˜‰æˆ‘åœ¨è¿™é‡Œçš„ç›®çš„åªæ˜¯æƒ³çœ‹çœ‹æˆ‘ä»¬æ˜¯å¦å¯ä»¥ä½¿ç”¨ç®¡é“æ¥åˆ›å»ºè¡¨å•ã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥ï¼ä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ³•å—ï¼Ÿè¿™ä¸æ˜¯è„±ç¦»äº†ç®¡é“çš„æ„ä¹‰å—ï¼Ÿæœ‹å‹ï¼Œæˆ‘ä¸çŸ¥é“ï¼Œåªæ˜¯åœ¨å°è¯•æ–°çš„åšäº‹æ–¹æ³•ã€‚åœ¨ä¸‹é¢çš„è¯„è®ºä¸­ç”¨æ–‡å­—è¡¨è¾¾ä½ çš„æƒ³æ³•ã€‚

ä¸‹æ¬¡è§ï¼å†è§ã€‚ğŸ’œ**