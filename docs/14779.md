# ä½¿ç”¨ Angular å’Œå…¶ä»–å…è´¹å·¥å…·åˆ›å»ºæ¸è¿›å¼ Web åº”ç”¨ç¨‹åºï¼

> åŸæ–‡ï¼š<https://dev.to/paco_ita/create-progressive-web-apps-with-angular-workbox-pwa-builder-step-4-27d>

è°è¯´åˆ›å»º PWAs å¾ˆéš¾ï¼Ÿ

åœ¨æœ¬æ¬¡ä¼šè®®ä¸­ï¼Œæˆ‘ä»¬å°†å‘ç°ä¸€äº›å®ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥è½»æ¾æ„å»ºæˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªæ¸è¿›å¼ Web åº”ç”¨ç¨‹åºã€‚

å¼€å§‹ä¹‹å‰ï¼Œå…ˆå¿«é€Ÿå›é¡¾ä¸€ä¸‹æˆ‘ä»¬ç›®å‰æ‰€å­¦çš„å†…å®¹:

*   [ç®€ä»‹](https://dev.to/paco_ita/a-gentle-introduction-to-progressive-web-apps-step-1-24da):å‘æˆ‘ä»¬ä»‹ç»äº†èƒŒæ™¯çŸ¥è¯†ï¼Œå¹¶æ¦‚è¿°äº†æ¸è¿›å¼ç½‘ç»œåº”ç”¨çš„ä¼˜åŠ¿ã€‚

*   [å®‰è£… PWA](https://dev.to/paco_ita/install-a-pwa-on-the-user-s-device-step-2-27pa) :æè¿°äº†ä»€ä¹ˆæ˜¯`web app manifest`ä»¥åŠæˆ‘ä»¬å¦‚ä½•é…ç½®å®ƒã€‚

*   [ç¼“å­˜ç­–ç•¥](https://dev.to/paco_ita/service-workers-and-caching-strategies-explained-step-3-m4f) : faced `service workers` (SW)ä»¥åŠæˆ‘ä»¬å¦‚ä½•é…ç½®ç¼“å­˜ç­–ç•¥ä»¥å……åˆ†å‘æŒ¥å…¶æ½œåŠ›ã€‚

æœ¬æ–‡ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥éšæ„è·³åˆ°ç‰¹å®šçš„éƒ¨åˆ†æˆ–ç»§ç»­é˜…è¯»:

*   [PWA ç”Ÿæˆå™¨](#builder)
*   [å·¥å…·ç®±](#wbox)
*   [è§’åº¦ PWA æ¼”ç¤º](#angular)

# PWA æ„å»ºå™¨

[![PWA Builder](img/21c9d5cced57f8605dcbedf37c1d704d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--QAOiAihs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mgdi9lgup0sf0m7j93v3.png)

[PWA Builder](https://www.pwabuilder.com/) æ˜¯å¾®è½¯çš„ä¸€ä¸ªå¼€æºé¡¹ç›®( [repo](https://github.com/pwa-builder/PWABuilder-CLI) )ã€‚å½“å‰ç‰ˆæœ¬(2.0)å¸¦æ¥äº†å…¨æ–°çš„å¸ƒå±€å’Œæ›´å¤šçš„åŠŸèƒ½ï¼Œä»¥æ›´å¥½åœ°å¸®åŠ©å¼€å‘äººå‘˜ã€‚

è®¿é—®ç½‘é¡µæ—¶ï¼Œæˆ‘ä»¬åœ¨æ ‡é¢˜ä¸­æœ‰ä¸¤ä¸ªèœå•é¡¹:

*   æˆ‘çš„ä¸­å¿ƒ(é»˜è®¤æ‰“å¼€)

*   ç‰¹è‰²å•†åº—

### æˆ‘çš„æ¢çº½é¡µé¢

æœ¬èŠ‚çš„ç›®æ ‡æ˜¯åˆ†æä¸€ä¸ªç»™å®šçš„ç½‘ç«™ï¼Œå¹¶æä¾›æç¤ºï¼Œä½¿å…¶å®Œå…¨ PWA å‡†å¤‡å°±ç»ªã€‚

[![pwa-builder-site](img/ebbc6e9b18a076e62581a90808a62942.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--kE-Ff_2X--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ycl3hi4o50g2ges0dgzo.png)

é€šè¿‡è¾“å…¥æˆ‘ä»¬çš„ web åº”ç”¨ç¨‹åºçš„ url åœ°å€ï¼ŒPWA Builder å¼€å§‹æœç´¢æ˜¯å¦å­˜åœ¨ web åº”ç”¨ç¨‹åºæ¸…å•ã€å·²å®‰è£…çš„æœåŠ¡å·¥ä½œå™¨å’Œå®‰å…¨è¿æ¥ï¼Œä»¥åŠå…¶ä»–å‡ ä¸ªå‚æ•°ã€‚

ä¸‹é¢æˆ‘ç”¨`https://angular.io`ç½‘ç«™å±•ç¤ºäº†ä¸€ä¸ªç›®æ ‡å·²ç»æ˜¯ PWA çš„ä¾‹å­:

[![scan-site](img/5ddf88e2077f44b10c1791badfd18c5e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--QKjorCij--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5avjk3qvepro5i59o9ck.png)

ä¸‰ä¸ªâ€œæŠ¥å‘Šå¡â€åˆ†åˆ«æ˜¾ç¤º web æ¸…å•ã€æœåŠ¡äººå‘˜å’Œå®‰å…¨æ€§çš„åˆ†æç»“æœã€‚æ¯ä¸ªç›’å­éƒ½æœ‰ä¸€ä¸ªåˆ†æ•°(æ€»åˆ† 100)ã€‚è¿™æ—¨åœ¨å¸®åŠ©è¯†åˆ«ç¼ºå¤±çš„ PWA è®¾ç½®ï¼Œå¹¶éµå¾ªæœ€ä½³å®è·µã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦ä¸€ä¸ªç½‘ç«™:`www.repubblica.it`ã€‚
è¿™é‡Œæ²¡æœ‰å®‰è£…æœåŠ¡äººå‘˜ï¼Œå› æ­¤å¾—åˆ†ä»…ä¸º 60 åˆ†ã€‚å¦‚æœæˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°ä»»ä½•è½¯ä»¶ï¼Œè¿™ä¸ªæ¡ˆä¾‹å¯èƒ½åæ˜ äº†æˆ‘ä»¬ç½‘ç«™çš„ç°çŠ¶ã€‚

[![example-no-sw](img/ac3c269f3ed1f5260deb478a0d761ce8.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Jg1pUeI7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/qvbbizwmw1mn422xj41v.png)

ç°åœ¨è®©æˆ‘ä»¬è¯¦ç»†æè¿°ä¸€ä¸‹æ¸…å•å’ŒæœåŠ¡äººå‘˜éƒ¨åˆ†ã€‚

### ç½‘é¡µæ¸…å•éƒ¨åˆ†

**æ¸…å•é¡µé¢**å…è®¸æ·±å…¥æŸ¥çœ‹ web æ¸…å•çš„è¯¦ç»†ä¿¡æ¯:

[![manifest-info](img/216c20eb2fbd03b5a1d396d5c09a3b77.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--E_WICv0Q--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/369qwdkw24mb0qedpmwk.png)

å¦‚æœæ–‡ä»¶ä¸­å­˜åœ¨ä»»ä½•é”™è¯¯ï¼Œå®ƒå°†æ˜¾ç¤ºåœ¨æ˜¾ç¤ºæœ€ç»ˆ web æ¸…å•çš„å³é¢æ¿çš„å³ä¸‹è§’ã€‚

å¦‚æœç›®æ ‡ç½‘ç«™æ²¡æœ‰ä»»ä½•æ¸…å•æ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºä¼šå°è¯•ä»é¡µé¢ä¸­çŒœæµ‹ä¸€äº›å€¼ï¼Œæ¯”å¦‚åº”ç”¨ç¨‹åºåç§°çš„æ ‡é¢˜æˆ–é¡µé¢å†…å®¹ä¸­çš„å›¾ç‰‡ã€‚è¿™äº›å€¼å°†åœ¨è¡¨å•ä¸­æå‡ºï¼Œè¡¨å•çš„å­—æ®µä¸ web æ¸…å•å±æ€§ä¸€è‡´ã€‚
æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘è¿™äº›å­—æ®µæˆ–ä¸Šä¼ æ–°å›¾åƒï¼ŒPWA Builder å°†ç›´æ¥æ›´æ–°æœ€ç»ˆçš„ json æ–‡ä»¶ã€‚

â€œè®¾ç½®â€é€‰é¡¹å¡å…è®¸å®šä¹‰æ›´å¤šå±æ€§ã€‚åœ¨ä¸‹æ‹‰èœå•çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦è®°ä½æ‰€æœ‰å¯èƒ½çš„å€¼ï¼Œè¿™ä½¿æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°è°ƒæ•´ web æ¸…å•:

[![manifest-settings](img/3e6cb609ef274459d8889a5695db35e9.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--sdWZ0XGq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ywvv3gyzyb3y8cfoxj5d.png)

### æœåŠ¡äººå‘˜

è¿™ä¸€éƒ¨åˆ†å¯èƒ½æ›´æœ‰è¶£ï¼Œå› ä¸ºå®ƒå…è®¸åœ¨ä¸€ç»„æœ€å¸¸è§çš„è½¯ä»¶åœºæ™¯ä¸­è¿›è¡Œé€‰æ‹©ï¼Œæ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªç®€å•çš„ç¦»çº¿é¡µé¢æˆ–å®ç°`stale while revalidate`ç¼“å­˜ç­–ç•¥(å¦‚æœä½ æƒ³äº†è§£æ›´å¤šç»†èŠ‚ï¼Œè¿™å·²ç»åœ¨[ä»¥å‰çš„æ–‡ç« ](https://dev.to/paco_ita/service-workers-and-caching-strategies-explained-step-3-m4f#stale-strategy)ä¸­è®¨è®ºè¿‡äº†)ã€‚

å½“æˆ‘ä»¬é€‰æ‹©æä¾›çš„é€‰é¡¹ä¹‹ä¸€æ—¶ï¼Œå³ä¾§çš„ä»£ç ç‰‡æ®µä¼šç›¸åº”åœ°æ›´æ–°ã€‚æ­¤æ—¶æˆ‘ä»¬è¦åšçš„å°±æ˜¯ä¸‹è½½æ–‡ä»¶å¹¶ä¸Šä¼ åˆ°æˆ‘ä»¬çš„ web åº”ç”¨ç¨‹åºä¸­ã€‚

[![sw](img/f83bf35010d1f3dd49db1029d67f1e36.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--rOwQJO6S--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/o2zpsec316qvbbug78ms.png)T3ã€‘

### åŠŸèƒ½å•†åº—é¡µé¢

æ­¤é¡µé¢æ”¶é›†äº†é¢„é…ç½®çš„ä»£ç ç‰‡æ®µï¼Œå…è®¸è¿›ä¸€æ­¥å¢å¼ºæˆ‘ä»¬çš„ PWAã€‚æˆ‘ä»¬åªéœ€è¦é€‰æ‹©ä¸€ä¸ªç‰¹æ€§å¹¶å°†ä»£ç å¯¼å…¥åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚å®Œæˆäº†ï¼Œè€¶ï¼ï¼ğŸ˜€

[![feature-store-page](img/7beafa9cc043794099c42a93f7dfae68.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--2TA9oEST--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1lvbqdecrnc7owed24jq.png)

å¾®è½¯å›¢é˜Ÿæ­£åœ¨åŠªåŠ›åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æ·»åŠ æ›´å¤šçš„ä»£ç ç‰‡æ®µã€‚

### å»ºç«‹æˆ‘çš„ PWA

é™¤äº†å•ç‹¬å¤„ç†å•ä¸ªæ–‡ä»¶ä¹‹å¤–ï¼ŒPWA Builder è¿˜æä¾›äº†é’ˆå¯¹ä¸åŒå¹³å°ç”Ÿæˆå®Œæ•´çš„åŸºæœ¬åº”ç”¨ç¨‹åºçš„å¯èƒ½æ€§ã€‚

[![build-pwa](img/b470c6ed58e735052eeac1d77ae95637.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--alkg5qj8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/eyr1i8efkwm0bo40nsnz.png)

ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å·¥å…·æ–‡æ¡£[ğŸ“”](https://docs.pwabuilder.com/) 

# å·¥å…·ç®±

[![workbox-logo](img/3cf839c10f033d29e15f30096a51c4c3.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--EbQlhkQq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9nl0mq5vb4xrwflaizfp.png)

Workbox æ˜¯ Google çš„ä¸€ä¸ªå¼€æºé¡¹ç›®(è¿™é‡Œæ˜¯ [repo](https://github.com/GoogleChrome/workbox) )ã€‚

å®ƒåŒ…å«ä¸€ç»„æŠ½è±¡æœåŠ¡å·¥ä½œè€…å¤æ‚æ€§çš„åº“å’ŒèŠ‚ç‚¹æ¨¡å—ã€‚è¿™å…è®¸å…³æ³¨åº”ç”¨ç¨‹åºä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸å¿…å…³å¿ƒåº•å±‚çš„ PWA ç»†èŠ‚ã€‚

### è®¾ç½®

ä¸ PWA Builder ç›¸æ¯”ï¼ŒWorkbox ä¸ºå¼€å‘äººå‘˜æä¾›äº†æ›´å¼ºå¤§å’Œæ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œä½†å¦ä¸€æ–¹é¢ï¼Œå®ƒä¹Ÿéœ€è¦æœ€å°‘çš„ Javascript å’ŒæœåŠ¡äººå‘˜çŸ¥é“å¦‚ä½•æ“ä½œã€‚

ä¸ºäº†å¼€å§‹ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæœåŠ¡å·¥ä½œè€…ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯¼å…¥å·¥ä½œç®±æ–‡ä»¶`workbox-sw.js` :

```
importScripts('https://storage.googleapis.com/workbox-cdn/releases/4.3.1/workbox-sw.js');

if (workbox) {
  console.log(`Workbox is loaded!!`);
} else {
  console.log(`Workbox failed to load`);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`importScripts()`æ–¹æ³•å±äº [WorkerGlobalScope](https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope#Methods) æ¥å£ï¼Œå¹¶åŒæ­¥å¯¼å…¥ä¸€ä¸ªæˆ–å¤šä¸ªè„šæœ¬ï¼Œç”¨é€—å·åˆ†éš”ï¼Œåˆ° worker çš„ä½œç”¨åŸŸä¸­ã€‚

åœ¨ Workbox ä¸­ï¼Œæ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚ï¼Œ`routes`ç”¨äºç¡®å®šå“ªäº›è¯·æ±‚å¿…é¡»åŒ¹é…ã€‚
ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸åŒçš„æ–¹æ³•:

*   **ç´å¼¦**

```
workbox.routing.registerRoute(
  // Matches a Request for the myTargetFile.js file
  '/myTargetFile.js',
  handlerFn
); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   **æ­£åˆ™è¡¨è¾¾å¼**

```
workbox.routing.registerRoute(
// Matches image files
  /\.(?:png|gif|jpg|jpeg|svg)$/,
  handlerFn
); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   **å›è°ƒ**

```
const myCallBackFn = ({url, event}) => {
  // Here we can implement our custom matching criteria

  // If we want the route to match: return true
  return true;
};

const handlerFn = async ({url, event, params}) => { 
  return new Response(
   // Do something ...
  );
};

workbox.routing.registerRoute(
  myCallBackFn,
  handlerFn
); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦å®šä¹‰çš„è·¯ç”±ä¸è¯·æ±‚åŒ¹é…ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡`caching strategy modules`æˆ–`custom callbacks`æŒ‡ç¤º Workbox åšä»€ä¹ˆ(å°±åƒä¸Šé¢çš„ç¬¬ä¸‰ä¸ªä¾‹å­)ã€‚

**ç¼“å­˜ç­–ç•¥æ¨¡å—**è®©æˆ‘ä»¬ç”¨ä¸€è¡Œä»£ç å®ç°ä¸€ä¸ªç¼“å­˜ç­–ç•¥:

```
workbox.routing.registerRoute(
  /\.css$/,
  new workbox.strategies.StaleWhileRevalidate({

    // We can provide a custom name for the cache
    cacheName: 'css-cache',
  })
); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢çš„ä»£ç ç¼“å­˜äº†`.css`æ–‡ä»¶å¹¶å®ç°äº†`StaleWhileRevalidate`ç­–ç•¥ã€‚ä¸æˆ‘ä»¬åœ¨[ä¹‹å‰çš„å¸–å­](https://dev.to/paco_ita/service-workers-and-caching-strategies-explained-step-3-m4f#caching-strategy)ä¸­çœ‹åˆ°çš„ä»£ç ç›¸æ¯”ï¼Œæˆ‘ä»¬ä¸å¾—ä¸æ‰¿è®¤å®ƒè¦ç®€æ´å¾—å¤šï¼ï¼

æ”¯æŒçš„ç­–ç•¥æœ‰:

*   ç½‘ç»œä¼˜å…ˆ
*   å…ˆç¼“å­˜
*   é‡æ–°éªŒè¯æ—¶è¿‡æ—¶
*   ä»…ç½‘ç»œ
*   ä»…ç¼“å­˜

å®šåˆ¶å›è°ƒé€‚ç”¨äºæˆ‘ä»¬éœ€è¦ä¸°å¯Œå“åº”æˆ–å¼€å‘ä¸€äº›é¢„å®šä¹‰ç¼“å­˜ç­–ç•¥æ²¡æœ‰æä¾›çš„å…¶ä»–ç‰¹å®šåŠ¨ä½œçš„åœºæ™¯ã€‚

è·¯å¾„å’Œç¼“å­˜æ¨¡å—æ˜¯ Workbox çš„åŸºç¡€ï¼Œä½†è¯¥å·¥å…·æä¾›äº†æ›´å¤šã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`pre-cache`æ–‡ä»¶ä½¿ web åº”ç”¨ç¨‹åºå³ä½¿åœ¨ç¦»çº¿æ—¶ä¹Ÿèƒ½å“åº”ï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`plugins`æ¥ç®¡ç†åå°åŒæ­¥é˜Ÿåˆ—ï¼Œä»¥é˜²ä¸€ä¸ªç½‘ç»œè¯·æ±‚å¤±è´¥ã€‚

ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•å®šä¹‰ç¼“å­˜å¤šå°‘æ¡ç›®ä»¥åŠä¿ç•™å¤šé•¿æ—¶é—´:

```
workbox.routing.registerRoute(
  /\.(?:png|jpg|jpeg|svg)$/,
  new workbox.strategies.CacheFirst({
    cacheName: 'img-assets',
    plugins: [
      new workbox.expiration.Plugin({
        maxEntries: 50,
        maxAgeSeconds: 7 * 24 * 60 * 60,  // 7 days
      }),
    ],
  }),
); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### è°ƒè¯•ä¿¡æ¯

åœ¨å¼€å‘æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œè°ƒè¯•å’ŒæŸ¥çœ‹åœ¨ Workbox ä¸‹å‘ç”Ÿäº†ä»€ä¹ˆæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚

Workbox çš„è°ƒè¯•ç‰ˆæœ¬æä¾›äº†è®¸å¤šç»†èŠ‚ï¼Œæœ‰åŠ©äºç†è§£æ˜¯å¦æœ‰ä»»ä½•ä¸œè¥¿æ²¡æœ‰æŒ‰é¢„æœŸå·¥ä½œã€‚

æˆ‘ä»¬éœ€è¦å¯ç”¨ Workbox æ¥ä½¿ç”¨è°ƒè¯•ç‰ˆæœ¬:

```
workbox.setConfig({  debug:  true  }) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

debug ä¸º JavaScript æ§åˆ¶å°æ„å»ºå…·æœ‰ç‰¹å®šæ—¥å¿—çº§åˆ«çš„æ—¥å¿—æ¶ˆæ¯ã€‚å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°ä¸€äº›æ—¥å¿—ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ä¸­çš„æ—¥å¿—çº§åˆ«è®¾ç½®ã€‚å°†å…¶è®¾ç½®ä¸º*è¯¦ç»†*çº§åˆ«å°†æ˜¾ç¤ºæœ€è¯¦ç»†çš„æ¶ˆæ¯ã€‚

è¿™äº›åŠŸèƒ½åªæ˜¯å·¥å…·ç®±æ½œåŠ›çš„ä¸€å°éƒ¨åˆ†ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œçœ‹çœ‹å…³äºå½“å‰å¯ç”¨çš„æ‰€æœ‰æ¨¡å—çš„[æ–‡æ¡£](https://developers.google.com/web/tools/workbox/modules/)ã€‚ã€T2

# æ£±è§’åˆ†æ˜

[![angular_pwa](img/d40d044f265c98b865bd74585a755343.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--C0svzccH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/4wi96mbg4sq7yemmsdh0.png)

è™½ç„¶ä»¥å‰çš„å·¥å…·æ˜¯æ¡†æ¶ä¸å¯çŸ¥çš„ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ Angular å®ç°æ¸è¿›å¼ web åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å®ƒæ˜¯å¤šä¹ˆå®¹æ˜“ï¼

### è®¾ç½®

å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰ angular å¹¶å®‰è£…äº† CLIï¼Œæ‚¨å¯ä»¥ç›´æ¥è¿›å…¥ä¸‹ä¸€èŠ‚

å¯¹äºæ¼”ç¤ºï¼Œæˆ‘å°†ä½¿ç”¨[è§†è§‰ä»£ç ](https://code.visualstudio.com/)ï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨ã€‚
æˆ‘ä»¬è¿˜éœ€è¦`@angular/cli`ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…å®ƒï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:

```
// using npm 
npm install -g @angular/cli@latest 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¦éªŒè¯ä¸€åˆ‡æ­£å¸¸ï¼Œåœ¨æ§åˆ¶å°ä¸­æŒ‰`ng help`ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ‰€æœ‰å¯ç”¨çš„å‘½ä»¤:

[![ng-cli](img/4e5e24c5a5e7b7a2dbf13b9de49b043b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--sRDM0Fla--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/wfksxm64v4xtjyxqijv4.png)

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®:

```
ng new angular-pwa 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®‰è£…å®Œæ‰€æœ‰ node_modules åï¼Œä½¿ç”¨`serve`å‘½ä»¤æ„å»ºå¹¶è¿è¡Œåº”ç”¨ç¨‹åº:

```
ng serve 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`http://localhost:4200/`æ‰“å¼€æµè§ˆå™¨ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°é»˜è®¤çš„è§’åº¦é¡µé¢:

[![angular_boilerplate](img/5d22e939381ba66ee286166fa6c6daf5.png)](https://res.cloudinary.com/practicaldev/image/fetch/s---LYuJKf4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/g53tp9k1n5ztrt6kpd39.png)

å¾ˆå¥½ï¼ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å¼€å§‹äº†ã€‚

[![ready](img/a0888fe34d362f2b3d64f44b76068c48.png)](https://i.giphy.com/media/Lm63QU87HvgVEuTV63/giphy.gif)

### æ·»åŠ  PWA åŠŸèƒ½

[æ·»åŠ åŸç†å›¾](https://angular.io/guide/schematics#add-schematics)å…è®¸ä¸ºè§’åº¦åº”ç”¨æä¾› PWA åŠŸèƒ½ã€‚åœ¨æ§åˆ¶å°ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:

```
ng add @angular/pwa 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ä¸åŒçš„ä¸œè¥¿å·²ç»è¢«æ›´æ–°

[![added-files](img/db3b1c52c8084f6179f3d52363ec7f01.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--2tPKkoqN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9ewbipy96svyeuo5dwf6.png)

è®©æˆ‘ä»¬é¦–å…ˆå¼€å§‹åˆ†ææ›´æ–°çš„æ–‡ä»¶ã€‚

*angular.json*

```
 "build":  {  ...  "configurations":  {  "production":  {  ...  "serviceWorker":  true,  "ngswConfigPath":  "ngsw-config.json"  }  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–°å±æ€§:`serviceworker: true`å’Œ`"ngswConfigPath": "ngsw-config.json"`ã€‚ç¬¬ä¸€ä¸ªå±æ€§å°†æŒ‡ç¤ºç”Ÿäº§æ„å»ºåœ¨åˆ†å‘æ–‡ä»¶å¤¹ä¸­åŒ…æ‹¬æœåŠ¡å·¥ä½œå™¨æ–‡ä»¶(ngsw-worker.js å’Œ ngsw.json ),è€Œåè€…æŒ‡å®šæœåŠ¡å·¥ä½œå™¨é…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚

*index.html*T2ã€‘

```
 <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1976d2"> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯¥å‘½ä»¤æ³¨å†Œäº† web æ¸…å•ï¼Œå¹¶ä¸ºæˆ‘ä»¬çš„ PWA æ·»åŠ äº†ä¸€ä¸ªé»˜è®¤çš„`theme color`ã€‚

*åº”ç”¨æ¨¡å— ts*

ä¸‹è½½`ServiceWorkerModule`å¹¶æ³¨å†ŒæœåŠ¡å·¥äººæ–‡ä»¶(ngsw-worker.js)ã€‚

```
@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    HttpClientModule,
    ServiceWorkerModule.register('ngsw-worker.js', { enabled: environment.production })
  ],
  bootstrap: [AppComponent]
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æœç´¢`ngsw-worker.js`æ–‡ä»¶ï¼Œæˆ‘ä»¬æ— æ³•åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­æ‰¾åˆ°å®ƒã€‚åŸå› æ˜¯è¯¥æ–‡ä»¶ç›´æ¥å–è‡ª node_modules æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨ç”Ÿäº§æ„å»ºåæ”¾åœ¨åˆ†å‘æ–‡ä»¶å¤¹ä¸­(é»˜è®¤ä¸º`/dist`ï¼Œä½†å¯ä»¥åœ¨ angular.json æ–‡ä»¶ä¸­é…ç½®)ã€‚

> âš ï¸ **æ³¨æ„ï¼**æˆ‘ä»¬ä¸åº”æ‰‹åŠ¨ç¼–è¾‘æœåŠ¡äººå‘˜æ–‡ä»¶ï¼Œå› ä¸ºè¿™å°†åœ¨æ¯æ¬¡ç”Ÿäº§æ„å»ºæ—¶è¢«è¦†ç›–ï¼Œåˆ é™¤æˆ‘ä»¬å·²ç»æ·»åŠ çš„ä»»ä½•æ›´æ”¹ã€‚
> 
> `{ enabled: environment.production }`æ˜¯å…è®¸ ServiceWorkerModule æ³¨å†ŒæœåŠ¡å·¥ä½œè€…æ¡£æ¡ˆçš„æ ‡å¿—æ¡ä»¶ã€‚å®ƒä½¿ç”¨ environment.production å˜é‡ä»…åœ¨ç”Ÿäº§æ„å»ºä¹‹åå¯ç”¨æ³¨å†Œ:`ng build --prod`ã€‚

åœ¨æ–°ç”Ÿæˆçš„æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€ç»„å¤§å°ä¸åŒçš„å›¾åƒ(è§’å½¢æ ‡å¿—)
æ”¾åœ¨`assets/icons`æ–‡ä»¶å¤¹ä¸­ã€‚è¿™äº›å°†ç”¨äºä¸»å±å¹•å›¾æ ‡(ä¸€æ—¦å®‰è£…äº† PWA)å’Œé—ªå±(å¦‚æœæµè§ˆå™¨æ”¯æŒçš„è¯)ã€‚

**manifest.webmanifest.json**
ä½¿ç”¨é»˜è®¤å€¼åˆ›å»º web-manifest æ–‡ä»¶(manifest . web manifest . JSON)ã€‚

```
{  "name":  "my-pwa",  "short_name":  "my-pwa",  "theme_color":  "#1976d2",  "background_color":  "#fafafa",  "display":  "standalone",  "scope":  "./",  "start_url":  "./",  "icons":  [  {  "src":  "assets/icons/icon-72x72.png",  "sizes":  "72x72",  "type":  "image/png",  "purpose":  "maskable any"  },  {  "src":  "assets/icons/icon-96x96.png",  "sizes":  "96x96",  "type":  "image/png",  "purpose":  "maskable any"  },  {  "src":  "assets/icons/icon-128x128.png",  "sizes":  "128x128",  "type":  "image/png",  "purpose":  "maskable any"  },  {  "src":  "assets/icons/icon-144x144.png",  "sizes":  "144x144",  "type":  "image/png",  "purpose":  "maskable any"  },  {  "src":  "assets/icons/icon-152x152.png",  "sizes":  "152x152",  "type":  "image/png",  "purpose":  "maskable any"  },  {  "src":  "assets/icons/icon-192x192.png",  "sizes":  "192x192",  "type":  "image/png",  "purpose":  "maskable any"  },  {  "src":  "assets/icons/icon-384x384.png",  "sizes":  "384x384",  "type":  "image/png",  "purpose":  "maskable any"  },  {  "src":  "assets/icons/icon-512x512.png",  "sizes":  "512x512",  "type":  "image/png",  "purpose":  "maskable any"  }  ]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è®©æˆ‘ä»¬åˆ†æä¸€ä¸‹è½¯ä»¶é…ç½®æ–‡ä»¶ï¼Œå› ä¸ºæœ‰è¶£çš„äº‹æƒ…å°±å‘ç”Ÿåœ¨è¿™é‡Œï¼

*ngsw-config.json*

```
{  "$schema":  "./node_modules/@angular/service-worker/config/schema.json",  "index":  "/index.html",  "assetGroups":  [  {  "name":  "app",  "installMode":  "prefetch",  "resources":  {  "files":  [  "/favicon.ico",  "/index.html",  "/*.css",  "/*.js"  ]  }  },  {  "name":  "assets",  "installMode":  "lazy",  "updateMode":  "prefetch",  "resources":  {  "files":  [  "/assets/**",  "/*.(eot|svg|cur|jpg|png|webp|gif|otf|ttf|woff|woff2|ani)"  ]  }  }  ]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å±æ€§å¯»å€ node_module æ–‡ä»¶å¤¹ä¸­çš„é…ç½®æ¨¡å¼ã€‚å®ƒé€šè¿‡åœ¨ç¼–è¾‘æ–‡ä»¶æ—¶æä¾›éªŒè¯å’Œæç¤ºæ¥å¸®åŠ©å¼€å‘äººå‘˜ã€‚å¦‚æœå°è¯•æ·»åŠ æ— æ•ˆå±æ€§ï¼ŒIDE å°†æ˜¾ç¤ºä¸€æ¡è­¦å‘Š:

[![error](img/2edfa5e7ac60e943206b01ed385635f2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--pxKHZu5G--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/3noi1qlcagg31pewfq56.png)

`index`å±æ€§ä¿å­˜äº†ç´¢å¼•é¡µçš„è·¯å¾„ï¼Œé€šå¸¸æ˜¯ index.htmlã€‚

`assetGroups`æ•°ç»„æœ‰ä¸¤ä¸ªç¼“å­˜é…ç½®å¯¹è±¡:

*   **app** :è¿™ä¸ªç»„çš„ç›®æ ‡æ˜¯æ„æˆæˆ‘ä»¬åº”ç”¨ç¨‹åºæ ¸å¿ƒçš„æ‰€æœ‰é™æ€æ–‡ä»¶(â€œapp shellâ€)ï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›ä¸»åŠ¨è·å–å®ƒä»¬ã€‚å±æ€§`"installMode": "prefetch"`æŒ‡å®šåœ¨æœåŠ¡äººå‘˜å®‰è£…æ—¶æ£€ç´¢å®ƒä»¬ï¼Œå¹¶ä½¿å®ƒä»¬åœ¨ç¼“å­˜ä¸­å·²ç»å¯ç”¨ã€‚å¦‚æœè½¯ä»¶æ— æ³•æ”¶é›†æ–‡ä»¶ï¼Œå®‰è£…æ­¥éª¤å°†ä¼šä¸­æ–­ã€‚åœ¨é¡µé¢é‡æ–°åŠ è½½æ—¶ï¼Œå†æ¬¡è§¦å‘æ–°çš„å°è¯•ã€‚

å¦‚æœæˆ‘ä»¬æƒ³åŒ…å«å¤–éƒ¨èµ„æºï¼Œä¾‹å¦‚ web å­—ä½“ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªæ–°çš„å±æ€§`url`ï¼Œæ¥å—ä¸€ä¸ªå¸¦æœ‰ glob æ ¼å¼çš„èµ„æºè·¯å¾„çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚

```
 "resources":  {  "files":  [  "/favicon.ico",  "/index.html",  "/manifest.webmanifest",  "/*.css",  "/*.js"  ],  "urls":  [  "https://fonts.googleapis.com/**"  ]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   **èµ„äº§**:é’ˆå¯¹éå³æ—¶éœ€è¦çš„èµ„æº(å¦‚å›¾åƒã€å­—ä½“æ–‡ä»¶)ã€‚`"installMode": "lazy"`å‘Šè¯‰æœåŠ¡äººå‘˜ä»…åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æ”¶é›†è¯·æ±‚çš„æ•°æ®ï¼Œè€Œä¸æ˜¯åœ¨æ­¤ä¹‹å‰ã€‚`prefetch`å’Œ`lazy`æ˜¯ installMode å±æ€§çš„ä¸¤ä¸ªå¯èƒ½å€¼ï¼Œæè¿°äº†æˆ‘ä»¬æœ‰å¤šæ¸´æœ›è·å¾—åº•å±‚èµ„æºã€‚`"updateMode": "prefetch"`æŒ‡å®šå¦‚æœæ£€æµ‹åˆ°æ–°ç‰ˆæœ¬çš„èµ„æºï¼Œè½¯ä»¶å¿…é¡»å¦‚ä½•æ“ä½œã€‚å€¼ä¸ºâ€œprefetchâ€æ—¶ï¼Œå®ƒä¼šç«‹å³è·å–æ–°ç‰ˆæœ¬ï¼Œè€Œâ€œlazyâ€ä¼šè®©è½¯ä»¶ä»…åœ¨å†æ¬¡è¯·æ±‚æ—¶è·å–æ–°ç‰ˆæœ¬ã€‚

> âš ï¸ **æ³¨æ„ï¼** `"updateMode": "lazy"`ä»…åœ¨ installMode çš„å€¼ä¸ºâ€œæ‡’æƒ°â€æ—¶æœ‰æ•ˆã€‚

æå–çš„æ–‡ä»¶å­˜å‚¨åœ¨ [`Cache Storage`](https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage) ä¸­ï¼Œè¿™æ˜¯æœåŠ¡äººå‘˜å¯è®¿é—®çš„æ‰€æœ‰ç¼“å­˜çš„æ¥å£ã€‚

`assetGroups`æ˜¯ä¸ºèµ„äº§èµ„æºä¿ç•™çš„ï¼Œç”±`ng add @angular/add`å‘½ä»¤è‡ªåŠ¨åˆ›å»ºã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ å¦ä¸€ä¸ªåä¸º`dataGroups`çš„æ•°ç»„æ¥ç¼“å­˜æ•°æ®è¯·æ±‚ã€‚
è®©æˆ‘ä»¬åœ¨ ngsw-config.json æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç (å°±åœ¨ assetGroups ä¹‹å):

```
 "dataGroups":  [{  "name":  "jokes-cache",  "urls":  [  "https://icanhazdadjoke.com/"],  "cacheConfig":  {  "strategy":  "performance",  "maxSize":  5,  "maxAge":  "15m"  }  },  {  "name":  "stocks-cache",  "urls":  [  "https://api.thecatapi.com/img/search"],  "cacheConfig":  {  "strategy":  "freshness",  "maxSize":  10,  "maxAge":  "1d",  "timeout":  "5s"  }  }] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ä¸ºæ¯ä¸ªç¼“å­˜å®šä¹‰ä¸€ä¸ªåç§°ä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡`urls`å±æ€§è®¾ç½®æˆ‘ä»¬æ„Ÿå…´è¶£çš„ API ç«¯ç‚¹è¿›è¡Œç¼“å­˜ã€‚
`cacheConfig`éƒ¨åˆ†å®šä¹‰äº†åº”ç”¨äºåŒ¹é…è¯·æ±‚çš„ç­–ç•¥:

*   **maxSize** :ç¼“å­˜å“åº”çš„æœ€å¤§æ¬¡æ•°ã€‚

*   **maxAge** :è®¾ç½®ç¼“å­˜æ¡ç›®çš„å¯¿å‘½ã€‚åœ¨è¿™æ®µæ—¶é—´ä¹‹åï¼Œç¼“å­˜çš„é¡¹ç›®å°†è¢«åˆ é™¤ã€‚
    æ¥å—åç¼€:
    d:å¤©
    h:å°æ—¶
    m:åˆ†é’Ÿ
    s:ç§’
    u:æ¯«ç§’

*   **è¶…æ—¶**:ä½¿ç”¨`freshness`ç­–ç•¥ï¼Œå®ƒæŒ‡çš„æ˜¯ç½‘ç»œè¶…æ—¶æŒç»­æ—¶é—´ï¼Œåœ¨æ­¤ä¹‹åï¼ŒæœåŠ¡å·¥ä½œè€…å°†å°è¯•ä»ç¼“å­˜ä¸­æ£€ç´¢æ•°æ®ã€‚

å¦‚ Angular æ–‡æ¡£ä¸­æ‰€è¿°ï¼Œåªæœ‰è¿™ä¸¤ç§ç¼“å­˜ç­–ç•¥å¯ç”¨:

> é»˜è®¤çš„**æ€§èƒ½**ï¼Œä¼˜åŒ–å“åº”ï¼Œå°½å¯èƒ½å¿«ã€‚å¦‚æœèµ„æºå­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™ä½¿ç”¨ç¼“å­˜çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä¸å‘å‡ºç½‘ç»œè¯·æ±‚ã€‚æ ¹æ® maxAgeï¼Œè¿™å…è®¸ä¸€äº›é™ˆæ—§æ€§ï¼Œä»¥æ¢å–æ›´å¥½çš„æ€§èƒ½ã€‚è¿™é€‚ç”¨äºä¸ç»å¸¸å˜åŒ–çš„èµ„æºï¼›ä¾‹å¦‚ï¼Œç”¨æˆ·å¤´åƒå›¾åƒã€‚
> 
> **æ–°é²œåº¦**ä¼˜åŒ–æ•°æ®æµé€šï¼Œä¼˜å…ˆä»ç½‘ç»œè·å–è¯·æ±‚çš„æ•°æ®ã€‚æ ¹æ®è¶…æ—¶ï¼Œåªæœ‰å½“ç½‘ç»œè¶…æ—¶æ—¶ï¼Œè¯·æ±‚æ‰ä¼šé€€å›åˆ°ç¼“å­˜ä¸­ã€‚è¿™å¯¹äºç»å¸¸å˜åŒ–çš„èµ„æºå¾ˆæœ‰ç”¨ï¼›ä¾‹å¦‚ï¼Œå¸æˆ·ä½™é¢ã€‚

åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†`performance`ç­–ç•¥ç”¨äº [`icanhazdadjoke.com`](https://icanhazdadjoke.com/api) ç«¯ç‚¹ã€‚è¿™ä¸ª API åœ¨æ¯æ¬¡è®¿é—®æ—¶éƒ½ä¼šè¿”å›éšæœºçš„ç¬‘è¯ã€‚å› ä¸ºæˆ‘ä»¬å¸Œæœ›æ¯ 15 åˆ†é’Ÿåªå‘é€ä¸€ä¸ªæ–°ç¬‘è¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»ç¼“å­˜ä¸­æä¾›æ•°æ®ï¼Œå¹¶ç›¸åº”åœ°è®¾ç½®ç”Ÿå­˜æœŸã€‚

åœ¨å¦ä¸€è¾¹ï¼Œæˆ‘ä»¬å¯¹ [`api.thecatapi.com`](https://api.thecatapi.com/img/search) ç«¯ç‚¹é‡‡ç”¨`freshness`ç­–ç•¥ï¼Œè¿”å›ä¸€åªçŒ«çš„éšæœºå›¾åƒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ API æ¥æä¾›è‚¡ç¥¨å¸‚åœºçš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†æˆ‘è®¤ä¸ºä¸€äº›çŒ«çš„ç…§ç‰‡ä¼šæ›´å¯çˆ±ã€‚å› ä¸ºæˆ‘ä»¬çœŸçš„å–œæ¬¢çŒ«ï¼Œæˆ‘ä»¬å†³å®šä¸ºæ–°é²œåº¦ç­–ç•¥ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦æœ‰æœ€æ–°çš„æœ€æ–°ç»†èŠ‚ã€‚

æœåŠ¡å·¥ä½œè€…å°†åœ¨ä»»ä½•æ—¶å€™è°ƒç”¨ API æ—¶è®¿é—®ç½‘ç»œï¼Œå¹¶ä¸”åªæœ‰åœ¨è¶…æ—¶ 5 ç§’çš„æƒ…å†µä¸‹ï¼Œå¦‚åœ¨ä¸­æ–­æˆ–æ²¡æœ‰è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå®ƒæ‰ä¼šä»ç¼“å­˜ä¸­ä¼ é€’æ‰€è¯·æ±‚çš„æ•°æ®ã€‚

> âš ï¸ **æ³¨æ„ï¼**ä¸ºäº†æ”¹å–„ç”¨æˆ·ä½“éªŒï¼Œç‰¹åˆ«æ˜¯å¦‚æœè¯·æ±‚çš„æ•°æ®æ–°é²œåº¦éå¸¸é‡è¦ï¼Œæˆ‘ä»¬åº”è¯¥é€šçŸ¥ç”¨æˆ·æ‰€æä¾›çš„ä¿¡æ¯æ¥è‡ªç¼“å­˜ï¼Œå¹¶ä¸”ä¸æ˜¯æœ€æ–°çš„ã€‚

å¯¹äºè¿™ä¸ªæ¼”ç¤ºï¼Œæˆ‘ä¸º HTTP è°ƒç”¨åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„æœåŠ¡ï¼Œå¹¶æ›´æ”¹äº†é»˜è®¤çš„`app-component`æ¨¡æ¿æ¥æ˜¾ç¤º API è°ƒç”¨ç»“æœã€‚
ä½ å¯ä»¥ä» [Github åº“](https://github.com/pacoita/angular-pwa-boilerplate)è·å¾—å®Œæ•´çš„ä»£ç ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†æˆ‘å°±ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†ã€‚PWA æ¼”ç¤ºä¹Ÿåœ¨[åœ¨çº¿](https://pacoita.github.io/angular-pwa-boilerplate/)æä¾›ã€‚

### ä½¿ç­¾å­é€ 

ç°åœ¨æ˜¯æ—¶å€™ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œç”Ÿäº§æ„å»ºäº†:

```
ng build --prod 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°†åˆ›å»ºä¸€ä¸ª`dist`æ–‡ä»¶å¤¹(å¦‚æœæ‚¨ä¿ç•™é»˜è®¤è®¾ç½®)ã€‚å› ä¸ºæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨`ng serve`å‘½ä»¤åœ¨æœ¬åœ°æµ‹è¯•æœåŠ¡äººå‘˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ web æœåŠ¡å™¨ã€‚æˆ‘é€‰æ‹©äº† Chrome æ‰©å±•â€œweb æœåŠ¡å™¨â€:

[![web-server](img/ce704f838c8beeeb4eb59baa90e4df0b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--saLcygyR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/enzpljc6zq3yivgf90pz.png)

é€šè¿‡ web æœåŠ¡å™¨è®¿é—®å»ºè®®çš„ URLï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°æˆ‘ä»¬çš„ Angular é¡¹ç›®ï¼Œå¸ƒå±€å¦‚ä¸‹:

[![app-demo](img/dc717ebc13f2d2cc5e0921cb2e1c174e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--sIX4Jr5s--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/s7j46pkqimw6iip7gwzt.png)

æ‰“å¼€ dev tools(Chrome ä¸­çš„ F12 ),åœ¨åº”ç”¨ç¨‹åºé€‰é¡¹å¡ä¸­ï¼Œæˆ‘ä»¬å®‰è£…äº†æˆ‘ä»¬çš„æœåŠ¡äººå‘˜:

[![sw](img/67d02c831ef1a0fea052897149d8bb10.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--xGbBFqka--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/gn0g0xsxc5kitvoxmanv.png)

DevTools çš„ network é€‰é¡¹å¡å‘æˆ‘ä»¬å±•ç¤ºäº†æ­£åœ¨ä½¿ç”¨çš„ç¼“å­˜ç­–ç•¥:

[![network-tab](img/85a5c65b2e06e954fe2a5a630f4c9d51.png)](https://res.cloudinary.com/practicaldev/image/fetch/s---O7kFdp3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/ekd71cy2oeyocfg9l8ak.png)

ä»ç¼“å­˜ä¸­æä¾›`icanhazdadjoke.com`(é™¤éå®ƒè¿‡æœŸ)ï¼Œè€Œä»ç½‘ç»œä¸­è·å– cats APIã€‚ä¸€åˆ‡æŒ‰è®¡åˆ’è¿›è¡Œï¼

å¦‚æœæˆ‘ä»¬å°†è¿æ¥åˆ‡æ¢åˆ°é£è¡Œæ¨¡å¼(åœ¨ç§»åŠ¨è®¾å¤‡ä¸Š),æˆ–è€…å•å‡» DevTools ä¸­çš„ *offline* å¤é€‰æ¡†æ¥æ¨¡æ‹Ÿæ— ç½‘ç»œè¿æ¥å¹¶åˆ·æ–°é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„é¡µé¢ä»ç„¶è¢«æ¸²æŸ“ï¼Œæ²¡æœ‰æ˜¾ç¤ºé»˜è®¤çš„ç¦»çº¿é¡µé¢ã€‚

æˆ‘ä»¬åˆ›é€ äº†ä¸€ä¸ªæœ‰æ£±è§’çš„ PWAï¼Œç®€å•å§ï¼Ÿ

[![happy](img/e654c641dd72587175700a2cf0f7ddf4.png)](https://i.giphy.com/media/l46C52IJdRfvCGyVW/giphy.gif)T3ã€‘

# åˆ†ææˆ‘ä»¬çš„ PWA

æˆ‘ä»¬å¦‚ä½•ç¡®ä¿æ–°åˆ›å»ºçš„ PWA ä¸€åˆ‡æ­£å¸¸ï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬æœ‰ä¸åŒçš„å‡†åˆ™å’Œå·¥å…·æ¥éªŒè¯æˆ‘ä»¬çš„ PWAã€‚

### PWA æ£€æŸ¥è¡¨

è°·æ­Œå·¥ç¨‹å¸ˆå‘å¸ƒäº†ä¸€ä»½æ¸…å•ï¼Œä¸Šé¢æœ‰å¾ˆå¤šè¦éµå¾ªçš„è¦ç‚¹ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬çš„ PWA éµå¾ªæœ€ä½³å®è·µï¼Œå¹¶å°†å®Œç¾åœ°å·¥ä½œã€‚è¯¥åˆ—è¡¨åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ã€‚å¯¹äºå®ƒä»¬ä¸­çš„æ¯ä¸€ä¸ªï¼Œéƒ½æä¾›äº†ä¸€äº›æ“ä½œæ¥æµ‹è¯•å’Œä¿®å¤ç‰¹å®šçš„ä¸»é¢˜(Lighthouse å·¥å…·ç”¨äºè¿è¡Œä¸€äº›å»ºè®®çš„æµ‹è¯•):

[![pwa-check-list](img/5bd245c3d51c80ea0583d883498d1c3d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Sdl-Qjse--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/v59w5rx8momate5enipc.png)

ä½ å¯ä»¥åœ¨è¿™é‡Œ
æ‰¾åˆ°å®Œæ•´çš„åå•

### ç¯å¡”

Google çš„ Lighthouse æ˜¯ä¸€æ¬¾å¼€æºçš„ç½‘é¡µå®¡è®¡å·¥å…·ã€‚
ç½‘ç«™çš„ç›®æ ‡å¯ä»¥æ˜¯æ€§èƒ½ã€å¯è®¿é—®æ€§ã€æ¸è¿›å¼ç½‘ç»œåº”ç”¨å’Œå…¶ä»–æ–¹é¢ã€‚

å¦‚æœä»»ä½•å®¡è®¡å¤±è´¥ï¼Œå°†åœ¨å…¶ç‰¹å®šéƒ¨åˆ†ä¸­æŠ¥å‘Šã€‚æœ€é«˜ 100 åˆ†è¡¨ç¤ºæˆ‘ä»¬çš„ç½‘ç«™æœ‰å¤šå¥½:

[![lighthouse-audit](img/02cc12cdb37889d0b40210aa9bb826b7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--gcA51wVk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/eo412teci1m2568hyzzn.png)

å…³æ³¨ PWA å®¡æ ¸ï¼Œå¦‚æœæˆ‘ä»¬å±•ç¤ºäº†â€œPWA å¾½ç« â€,è¿™æ„å‘³ç€æ²¡æœ‰å¤±è´¥ç‚¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åšå¾—å¾ˆå¥½ï¼Œåº”è¯¥å¾—åˆ°ä¸€æ¯å¥½å’–å•¡ï¼Œâ˜•ï¼ï¼

[![pwa-audit](img/0e446cf6f7da9a6e36a5d12aaf5224e6.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--7uzhUaVO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/8c2vdqcporj0mtpy8zkn.png)

ç¯å¡” PWA å®¡è®¡éµå¾ªæˆ‘ä»¬ä¸Šé¢æåˆ°çš„`PWA Check List`ã€‚

## å¥–åŠ±é“¾æ¥

æœ€åçš„å°ç¤¼ç‰©ğŸå› ä¸ºå·²ç»åˆ°äº†æ–‡ç« çš„ç»“å°¾ï¼ğŸ‰

çœ‹çœ‹ [pwa.rocks](https://pwa.rocks/) ç½‘ç«™ï¼Œåœ¨é‚£é‡Œä½ å¯ä»¥æ‰¾åˆ°ä¸€ç³»åˆ— pwa çš„ä¾‹å­ã€‚å…¶ä¸­ä¸€äº›å¯èƒ½ä¼šå¯å‘ä½ ğŸ’¡ï¼

ä¸‹ç¯‡è§ï¼ï¼

ä½ å¯ä»¥å…³æ³¨æˆ‘:

[![follow-me-twitter](img/ff8782766b4760eb9020cec54eb02af8.png)](https://twitter.com/paco_ita)