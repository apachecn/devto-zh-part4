# ID3TagEditor:ä¸€ä¸ª Swift æ¡†æ¶ï¼Œå¯ä»¥ä¸º macOSã€iOSã€tvOSã€watchOS å’Œ Linux è¯»å†™ mp3 æ–‡ä»¶çš„ ID3 æ ‡ç­¾

> åŸæ–‡:[https://dev . to/chicio/ID3 tag editor-a-swift-framework-to-read-and-write-ID3-tag-of-your-MP3-files-for-MAC OS-IOs-tvos-and-watch OS-127 p](https://dev.to/chicio/id3tageditor-a-swift-framework-to-read-and-write-id3-tag-of-your-mp3-files-for-macos-ios-tvos-and-watchos-127p)

æˆ‘æè¿°äº†æˆ‘çš„ä¸¤ä¸ªæœ€æ–°é¡¹ç›®:ID3TagEditor å’Œ MP 3 id tag gerã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æè¿°æˆ‘æ˜¯å¦‚ä½•åˆ›å»º ID3TagEditor çš„ã€‚

åœ¨[è¿™ç¯‡ä¹‹å‰çš„æ–‡ç« ](https://dev.to/chicio/the-birth-of-id3tageditor-and-mp3id3tagger-and-my-journey-into-the-id3-tag-standard-2ob6)ä¸­ï¼Œæˆ‘æè¿°äº†æˆ‘å¼€å‘ [ID3TagEditor](https://github.com/chicio/ID3TagEditor) çš„åŸå› ï¼Œè¿™æ˜¯ä¸€ä¸ª swift åº“ï¼Œç”¨äºç¼–è¾‘ mp3 æ–‡ä»¶çš„ ID3 æ ‡ç­¾ï¼Œæ”¯æŒ macOSã€iOSã€watchOS å’Œ tvOSã€‚
åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æè¿°æˆ‘æ˜¯å¦‚ä½•å¼€å‘å®ƒçš„ã€‚ä¸‹é¢ä½ å¯ä»¥æ‰¾åˆ°å›¾ä¹¦é¦†çš„æ ‡å¿—ã€‚

[![ID3TagEditor logo](../Images/e76bf686fa27fda1a3fb18100b0d30c9.png "ID3TagEditor logo")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--py0K5agv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.fabrizioduroni.it/assets/images/posts/id3tageditor-logo.jpg)

ä½†æ˜¯åœ¨æ·±å…¥äº†è§£ ID3TagEditor çš„ç»†èŠ‚ä¹‹å‰ï¼Œäº†è§£ä¸€ä¸‹ ID3 æ ‡ç­¾æ ‡å‡†æ˜¯å¦‚ä½•å·¥ä½œçš„æ˜¯å¾ˆæœ‰ç”¨çš„(ä½ å¯ä»¥åœ¨å®˜æ–¹ç½‘ç«™ä¸Šæ‰¾åˆ°å®Œæ•´çš„å‚è€ƒèµ„æ–™)ã€‚å®ƒå¯¹ ID3 æ ‡å‡†çš„å®šä¹‰æ˜¯:

> ID3 æ ‡ç­¾æ˜¯ä»¥è§„å®šæ ¼å¼å­˜å‚¨çš„ MP3 éŸ³é¢‘æ–‡ä»¶å†…çš„æ•°æ®å®¹å™¨

è¿™ä¸ªå®šä¹‰æ„å‘³ç€ ID3 æ ‡ç­¾åŸºæœ¬ä¸Šæ˜¯å­˜å‚¨åœ¨ mp3 æ–‡ä»¶å¼€å¤´çš„ä¿¡æ¯å—ã€‚è¯¥æ ‡å‡†å®šä¹‰äº†ä»»ä½•å¼€å‘äººå‘˜éƒ½å¯ä»¥ç”¨æ¥è¯»å†™è¿™äº›ä¿¡æ¯çš„æ ¼å¼ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä½¿ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨çš„ ID3 æ ‡ç­¾çš„ä¾‹å­ã€‚

[![ID3 tag example](../Images/119b69492d1b42a6c0ad60bad463d362.png "ID3 tag example")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--lGZDU5sH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.fabrizioduroni.it/assets/images/posts/id3-tag-example.jpg)

æ ‡ç­¾ç”±ä¸€ä¸ªæ ‡é¢˜å’Œä¸€ç³»åˆ—å¸§ç»„æˆã€‚æ ‡ç­¾æŠ¥å¤´çš„å¤§å°ä¸º 10 å­—èŠ‚ï¼ŒåŒ…å«ä»¥ä¸‹ä¿¡æ¯(é’ˆå¯¹ v2 å’Œ v3):

*   ID3 æ ‡ç­¾æ–‡ä»¶æ ‡è¯†ç¬¦ï¼Œ3 å­—èŠ‚ï¼Œé€šå¸¸è¡¨ç¤ºä¸ºâ€œID3â€
*   æ ‡ç­¾ç‰ˆæœ¬ï¼Œ2 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨ä¸»ç‰ˆæœ¬å’Œä¿®è®¢ç‰ˆæœ¬çš„ä¸€å¯¹æ•°å­—(å¦‚`0x03 0x00`)
*   æ ‡å¿—ï¼Œ1 å­—èŠ‚ï¼ŒåŒ…å«ä¸‰ä¸ªé…ç½®æ ‡å¿—ï¼Œè¡¨ç¤ºä¸º`%abc00000`(ä½ä¸º 1)
*   å¤§å°ï¼Œ4 å­—èŠ‚ã€‚å¼•ç”¨ ID3 æ ‡å‡†ï¼Œå°ºå¯¸ä¸º:

> ä¸åŒæ­¥åå®Œæ•´æ ‡ç­¾çš„å¤§å°ï¼ŒåŒ…æ‹¬å¡«å……ï¼Œä¸åŒ…æ‹¬å¤´ä½†ä¸åŒ…æ‹¬æ‰©å±•å¤´ã€‚ID3v2 æ ‡ç­¾å¤§å°ç”¨å››ä¸ªå­—èŠ‚ç¼–ç ï¼Œå…¶ä¸­æ¯ä¸ªå­—èŠ‚çš„æœ€é«˜æœ‰æ•ˆä½(ä½ 7)éƒ½è®¾ç½®ä¸ºé›¶ï¼Œæ€»å…± 28 ä½ã€‚ç½®é›¶çš„ä½è¢«å¿½ç•¥ï¼Œæ‰€ä»¥ä¸€ä¸ª 257 å­—èŠ‚é•¿çš„æ ‡ç­¾è¢«è¡¨ç¤ºä¸º$00 00 02 01ã€‚....åœ¨å¤§å°æè¿°ä¸­ä»…ä½¿ç”¨äº† 28 ä½(ä»£è¡¨é«˜è¾¾ 256MB)...

[![ID3 tag header](../Images/12618d35ccff14295433413a996b41c4.png "ID3 tag header")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--eOMUDtyz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.fabrizioduroni.it/assets/images/posts/id3-tag-header.jpg)

æ¡†æ¶ç”±æ ‡é¢˜å’Œè‡ªå®šä¹‰å†…å®¹ç»„æˆã€‚å¸§å¤´åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯çš„å¤§å°ä¼šå› ç‰ˆæœ¬è€Œå¼‚:

*   å¸§ idï¼Œç‰ˆæœ¬ 2 ä¸­ 3 ä¸ªå­—èŠ‚ï¼Œç‰ˆæœ¬ 3 ä¸­ 4 ä¸ªå­—èŠ‚
*   å¤§å°ï¼Œç‰ˆæœ¬ 2 ä¸­ä¸º 3 ä¸ªå­—èŠ‚ï¼Œç‰ˆæœ¬ 3 ä¸­ä¸º 4 ä¸ªå­—èŠ‚ï¼Œç”¨äºæè¿°å¸§çš„æ€»å¤§å°ï¼Œä¸åŒ…æ‹¬æŠ¥å¤´
*   é€‰é¡¹æ ‡å¿—ï¼Œ2 å­—èŠ‚ä»…åœ¨ç‰ˆæœ¬ 3 ä¸­å¯ç”¨

å› æ­¤ï¼Œå¸§å¤´å¤§å°åœ¨ç‰ˆæœ¬ 3 ä¸­ä¸º 10 å­—èŠ‚ï¼Œåœ¨ç‰ˆæœ¬ 2 ä¸­ä¸º 6 å­—èŠ‚ã€‚åœ¨æ ‡é¢˜ä¹‹åæ˜¯å®šåˆ¶çš„ç‰¹å®šæ¡†æ¶æ ‡å¿—/é€‰é¡¹å’Œæ¡†æ¶å†…å®¹ã€‚ä»¥ä¸‹æ˜¯ç¬¬ 3 ç‰ˆæ ‡ç­¾ä¸­çš„æ¡†æ¶ç¤ºä¾‹ã€‚

[![ID3 frame example](../Images/3adb236b20d33d3e09a81c0ce8beb9fa.png "ID3 frame example")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--sCyfWcF3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.fabrizioduroni.it/assets/images/posts/id3-frame-example.jpg)

æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„æ˜¯ï¼Œåœ¨ ID3 æ ‡è®°çš„æœ«å°¾è¿˜æœ‰ 2 KB çš„åç§»é‡(ä½ å¯ä»¥åœ¨å‰é¢çš„å›¾ç‰‡ä¸­çœ‹åˆ°ï¼Œåœ¨æ ‡è®°çš„æœ«å°¾æœ‰ä¸€ç³»åˆ—æ— å°½çš„`0x00`ğŸ˜Œ).ID3TagEditor æ˜¯å¦‚ä½•è¯»å†™æ‰€æœ‰è¿™äº›ä¿¡æ¯çš„ï¼Ÿæ¡†æ¶çš„ä¸»è¦ api æ˜¯ä¸¤ä¸ªç®€å•çš„æ–¹æ³•:

```
/**
 Read the ID3 tag contained in the mp3 file.

 - parameter path: path of the mp3 file to be parsed.

 - throws: Could throw `InvalidFileFormat` if an mp3 file doesn't exists at the specified path.

 - returns: an ID3 tag or nil, if a tag doesn't exists in the file.
 */
public func read(from path: String) throws -> ID3Tag?

/**
 Writes the mp3 to a new file or overwrite it with the new ID3 tag.

 - parameter tag: the ID3 tag that written in the mp3 file.
 - parameter path: path of the mp3 file where we will write the tag.
 - parameter newPath: path where the file with the new tag will be written. **If nil, the mp3 file will be overwritten**.
 If nothing is passed, the file will be overwritten at its current location.

 - throws: Could throw `TagTooBig` (tag size > 256 MB) or `InvalidTagData` (no data set to be written in the
 ID3 tag).
 */
public func write(tag: ID3Tag, to path: String, andSaveTo newPath: String? = nil) throws 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› æ­¤ï¼ŒID3TagEditor æ¡†æ¶æœ‰ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†:ä¸€ä¸ªç”¨äºè¯»å–/è§£æ mp3 æ–‡ä»¶ï¼Œå¦ä¸€ä¸ªç”¨äºå°† ID3 æ ‡ç­¾å†™å…¥ mp3 æ–‡ä»¶ã€‚

è®©æˆ‘ä»¬ä»é˜…è¯»/è§£æéƒ¨åˆ†å¼€å§‹ã€‚åº“çš„ä¸»è¦å…¥å£ç‚¹æ˜¯ä»ä¸€ä¸ª`ID3TagParserFactory`å®ä¾‹åŒ–çš„ç±»`ID3TagParser`ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯è¢«ç§°ä¸º`parse`ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒè§£æå„ç§å¸§ã€‚åœ¨æ­¤ä¹‹å‰æœ‰ä¸‰ä¸ªæ“ä½œ:

*   æ ‡ç­¾çš„ç‰ˆæœ¬ç”±åä¸º`ID3TagVersionParser`çš„åˆä½œè€…æå–
*   æ£€æŸ¥æ ‡ç­¾æ˜¯å¦åœ¨åŠ è½½çš„ mp3 æ–‡ä»¶ä¸­å¯ç”¨ã€‚è¿™é¡¹æ£€æŸ¥ç”±åä¸º`ID3TagPresence`çš„åˆä½œè€…å®Œæˆ
*   æ ‡ç­¾çš„å¤§å°ç”±ä¸€ä¸ªå«åš`ID3TagSizeParser`çš„åˆä½œè€…æå–

```
....

func parse(mp3: Data) -> ID3Tag? {
    let version = tagVersionParser.parse(mp3: mp3 as Data)
    if (tagPresence.isTagPresentIn(mp3: mp3 as Data, version: version)) {
        let id3Tag = ID3Tag(version: version, size: 0)
        parseTagSizeFor(mp3: mp3 as NSData, andSaveInId3Tag: id3Tag)
        parseFramesFor(mp3: mp3 as NSData, id3Tag: id3Tag)
        return id3Tag
    }
    return nil
}

.... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¯ä¸ªå¸§çš„è§£æåœ¨å‡½æ•°`parseFramesFor`ä¸­å®Œæˆã€‚

```
....
private func parseFramesFor(mp3: NSData, id3Tag: ID3Tag) {
    var currentFramePosition = id3TagConfiguration.headerSize();
    while currentFramePosition < id3Tag.properties.size {
        let frame = getFrameFrom(mp3: mp3, position: currentFramePosition, version: id3Tag.properties.version)
        frameContentParser.parse(frame: frame, id3Tag: id3Tag)
        currentFramePosition += frame.count;
    }
}

private func getFrameFrom(mp3: NSData, position: Int, version: ID3Version) -> Data {
    let frameSize = frameSizeParser.parse(mp3: mp3, framePosition: position, version: version)
    let frame = mp3.subdata(with: NSMakeRange(position, frameSize))
    return frame
}
.... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹æ¯ä¸ªå¸§çš„è§£ææ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼ŸID3TagEditor å¦‚ä½•è¯†åˆ«æ­£ç¡®çš„å¸§å¹¶æ ¹æ®å¸§ç±»å‹æ‰§è¡Œæ­£ç¡®çš„è§£æï¼Ÿç­”æ¡ˆåœ¨`ID3FrameContentParser`ç±»å†…éƒ¨ï¼Œåœ¨`parseFramesFor(mp3: NSData, id3Tag: ID3Tag)`å‡½æ•°å†…éƒ¨ä½¿ç”¨ã€‚è¯¥ç±»ä½¿ç”¨ [**å‘½ä»¤æ¨¡å¼**](https://en.wikipedia.org/wiki/Command_pattern) ä¸ºå½“å‰å¸§ç±»å‹å¯åŠ¨æ­£ç¡®çš„
è§£ææ“ä½œã€‚å¸§è§£ææ“ä½œåˆ—è¡¨å­˜å‚¨åœ¨ä¸€ä¸ªå­—å…¸ä¸­ï¼Œå…¶ä¸­çš„å…³é”®å­—æ˜¯`FrameType`æšä¸¾ã€‚è¯¥æšä¸¾ä¸€èˆ¬æ ‡è¯†å¸§ç±»å‹ï¼Œå¹¶åœ¨`ID3FrameConfiguration`å‡½æ•°`frameTypeFor(identifier: frameIdentifier, version: version)`ä¸­æ˜ å°„åˆ°æ¯ä¸ªç‰ˆæœ¬çš„æ­£ç¡® ID3 å¸§æ ‡è¯†ç¬¦ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¸§æ ‡è¯†ç¬¦çš„æå–æ˜¯åœ¨`getFrameTypeFrom(frame: Data, version: ID3Version) -> FrameType`ä¸­å®Œæˆçš„ã€‚

```
 class ID3FrameContentParser: FrameContentParser {
     private let frameContentParsingOperations: [FrameType : FrameContentParsingOperation]
     private var id3FrameConfiguration: ID3FrameConfiguration

     init(frameContentParsingOperations: [FrameType : FrameContentParsingOperation],
          id3FrameConfiguration: ID3FrameConfiguration) {
         self.frameContentParsingOperations = frameContentParsingOperations
         self.id3FrameConfiguration = id3FrameConfiguration
     }

     func parse(frame: Data, id3Tag: ID3Tag) {
         let frameType = getFrameTypeFrom(frame: frame, version: id3Tag.properties.version)
         if (isAValid(frameType: frameType)) {
             frameContentParsingOperations[frameType]?.parse(frame: frame, id3Tag: id3Tag)
         }
     }

     private func getFrameTypeFrom(frame: Data, version: ID3Version) -> FrameType {
         let frameIdentifierSize = id3FrameConfiguration.identifierSizeFor(version: version)
         let frameIdentifierData = [UInt8](frame.subdata(in: Range(0...frameIdentifierSize - 1)))
         let frameIdentifier = toString(frameIdentifier: frameIdentifierData)
         let frameType = id3FrameConfiguration.frameTypeFor(identifier: frameIdentifier, version: version)
         return frameType
     }

     private func isAValid(frameType: FrameType) -> Bool {
         return frameType != .Invalid
     }

     private func toString(frameIdentifier: [UInt8]) -> String {
         return frameIdentifier.reduce("") { (convertedString, byte) -> String in
             return convertedString + String(Character(UnicodeScalar(byte)))
         }
     }
 } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæˆ‘ä»¬æƒ³æ›´æ·±å…¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹`ID3FrameContentParsingOperationFactory`ã€‚è¿™ä¸ªç±»åˆå§‹åŒ–ä½œä¸ºå‘½ä»¤ä½¿ç”¨çš„ç±»æ¥åˆ†æå„ç§ç±»å‹çš„å¸§ã€‚æˆ‘å°†åœ¨å…¶ä»–å¸–å­ä¸­è®¨è®ºå®ƒä»¬çš„å®ç°ç»†èŠ‚(å› ä¸ºè¿™ä¸ªç±»åŒ…å«äº†å¾ˆå¤šå¾ˆé…·çš„ swift ä¸œè¥¿ï¼Œæˆ‘å¯ä»¥ç”¨å®ƒä»¬æ¥å†™å¾ˆå¤šå…¶ä»–å¸–å­ğŸ˜).

```
class ID3FrameContentParsingOperationFactory {
    static func make() -> [FrameType : FrameContentParsingOperation] {
        let paddingRemover = PaddingRemoverUsingTrimming()
        let id3FrameConfiguration = ID3FrameConfiguration()
        return [
            .Artist: ID3FrameStringContentParsingOperation(
                    paddingRemover: paddingRemover, 
                    id3FrameConfiguration: id3FrameConfiguration
            ) { (id3Tag: ID3Tag, frameContentWithoutPadding: String) in
                id3Tag.artist = frameContentWithoutPadding
            },
            .AlbumArtist: ID3FrameStringContentParsingOperation(
                    paddingRemover: paddingRemover,
                    id3FrameConfiguration: id3FrameConfiguration
            ) { (id3Tag: ID3Tag, frameContentWithoutPadding: String) in
                id3Tag.albumArtist = frameContentWithoutPadding
            },
            .Album: ID3FrameStringContentParsingOperation(
                    paddingRemover: paddingRemover,
                    id3FrameConfiguration: id3FrameConfiguration
            ) { (id3Tag: ID3Tag, frameContentWithoutPadding: String) in
                id3Tag.album = frameContentWithoutPadding
            },
            .Title: ID3FrameStringContentParsingOperation(
                    paddingRemover: paddingRemover,
                    id3FrameConfiguration: id3FrameConfiguration
            ) { (id3Tag: ID3Tag, frameContentWithoutPadding: String) in
                id3Tag.title = frameContentWithoutPadding
            },
            .AttachedPicture: AttachedPictureFrameContentParsingOperation(
                    id3FrameConfiguration: id3FrameConfiguration,
                    pictureTypeAdapter: ID3PictureTypeAdapter(
                            id3FrameConfiguration: ID3FrameConfiguration(),
                            id3AttachedPictureFrameConfiguration: ID3AttachedPictureFrameConfiguration()
                    )
            ),
            .Year: ID3FrameStringContentParsingOperation(
                    paddingRemover: paddingRemover,
                    id3FrameConfiguration: id3FrameConfiguration
            ) { (id3Tag: ID3Tag, frameContentWithoutPadding: String) in
                id3Tag.year = frameContentWithoutPadding
            },
            .Genre: ID3FrameStringContentParsingOperation(
                    paddingRemover: paddingRemover,
                    id3FrameConfiguration: id3FrameConfiguration
            ) { (id3Tag: ID3Tag, frameContentWithoutPadding: String) in
                id3Tag.genre = ID3GenreStringAdapter().adapt(genre: frameContentWithoutPadding)
            },
            .TrackPosition : ID3FrameStringContentParsingOperation(
                    paddingRemover: paddingRemover,
                    id3FrameConfiguration: id3FrameConfiguration
            ) { (id3Tag: ID3Tag, frameContentWithoutPadding: String) in
                id3Tag.trackPosition = ID3TrackPositionStringAdapter().adapt(trackPosition: frameContentWithoutPadding)
            }
        ]
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬çœ‹çœ‹ ID3TagEditor å¦‚ä½•å‘ mp3 æ–‡ä»¶å†™å…¥ä¸€ä¸ªæ–°æ ‡ç­¾ã€‚æ ‡ç­¾çš„åˆ›å»ºæ˜¯ç”±åœ¨`Mp3WithID3TagBuilder`ç±»ä¸­ä½¿ç”¨çš„`ID3TagCreator`ç±»å®Œæˆçš„ï¼Œè¿™ä¸ªç±»ä½¿ç”¨ç£ç›˜ä¸Šçš„æ–°æ ‡ç­¾å¯¹ mp3 æ–‡ä»¶æ‰§è¡ŒçœŸæ­£çš„å†™æ“ä½œã€‚`ID3TagCreator`ç±»çš„ä¸»è¦åŠŸèƒ½æ˜¯`create(id3Tag: ID3Tag) throws -> Data`ã€‚
åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæ¡†æ¶æ˜¯ç”±ä½œä¸º`ID3Tag`ç±»ä¼ é€’ç»™æ¡†æ¶çš„æ•°æ®åˆ›å»ºçš„ã€‚å¦‚æœæ‰€æœ‰çš„å¸§éªŒè¯éƒ½é¡ºåˆ©ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„æ ‡ç­¾å¤´ï¼ŒåŒæ ·ï¼Œå¦‚æœæ ‡ç­¾å¤´æœ‰æ•ˆ(æ ‡ç­¾çš„å¤§å°æœ‰æ•ˆ)ï¼Œåˆ™æ–°çš„`Data`å¯¹è±¡è¿”å›åˆ°`Mp3WithID3TagBuilder`ç±»å¹¶å†™å…¥ mp3 æ–‡ä»¶ã€‚

```
class ID3TagCreator {
    private let id3FrameCreatorsChain: ID3FrameCreatorsChain
    private let uInt32ToByteArrayAdapter: UInt32ToByteArrayAdapter
    private let id3TagConfiguration: ID3TagConfiguration

    ....

    func create(id3Tag: ID3Tag) throws -> Data {
        var frames = id3FrameCreatorsChain.createFrames(id3Tag: id3Tag, tag: [UInt8]())
        if thereIsNotValidDataIn(frames: frames) {
            throw ID3TagEditorError.InvalidTagData
        }
        frames.append(contentsOf: createFramesEnd())
        let header = createTagHeader(contentSize: frames.count, id3Tag: id3Tag);
        let tag = header + frames
        if (isTooBig(tag: tag)) {
            throw ID3TagEditorError.TagTooBig
        }
        return Data(bytes: tag)
    }

    ....
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¸§æ•°æ®æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Ÿç­”æ¡ˆåœ¨`ID3FrameCreatorsChain`å’Œ`ID3FrameCreatorsChainFactory`ç±»ä¸­ã€‚å·¥å‚ç±»åˆ›å»ºäº†ä¸€ä¸ª [**è´£ä»»é“¾**](https://en.wikipedia.org/wiki/Chain-of-responsibility_pattern) ï¼Œå…¶ä¸­`ID3FrameCreatorsChain`ç±»çš„æ¯ä¸ªå­ç±»éƒ½æ˜¯ä¸€ä¸ªä¸“é—¨åŒ–ï¼Œè´Ÿè´£ç¼–å†™ç‰¹å®šçš„å¸§ç±»å‹ã€‚åœ¨é“¾çš„æœ«å°¾ï¼Œè¿”å›ä¸€ä¸ª`[Uint8]`æ•°ç»„ã€‚è¿™åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œç„¶ååœ¨`ID3TagCreator`ç±»çš„`create(id3Tag: ID3Tag) throws -> Data`æœ«å°¾è¢«è½¬æ¢æˆä¸€ä¸ª`Data`å¯¹è±¡(è¿™é‡Œä¹Ÿæ·»åŠ äº†æ ‡ç­¾å¤´ï¼Œæ­£å¦‚æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„)ã€‚ä¸‹é¢æ‚¨å¯ä»¥æ‰¾åˆ°åŒ…å«åœ¨`ID3FrameCreatorsChainFactory`ç±»ä¸­çš„é“¾åˆ›å»º(åŒæ ·ï¼Œæˆ‘ä»¬å°†åœ¨ä»¥åçš„å…¶ä»–å¸–å­ä¸­çœ‹åˆ°é“¾ä¸­åŒ…å«çš„å„ç§ç±»çš„è¯¦ç»†ä¿¡æ¯ğŸ˜œè¿™ä¸ªæ¡†æ¶åŒ…å«äº†å¤ªå¤šå¾ˆé…·çš„ swift ä¸œè¥¿ğŸ˜³).éœ€è¦æ³¨æ„çš„ä¸€ä»¶é‡è¦äº‹æƒ…æ˜¯:`ID3AttachedPicturesFramesCreator`ç±»èƒ½å¤Ÿåˆ›å»ºé™„åŠ çš„å›¾ç‰‡æ¡†æ¶ï¼Œå°†å°é¢çš„ç±»å‹è®¾ç½®ä¸º ID3 æ ‡å‡†ä¸­å®šä¹‰çš„åˆ—è¡¨ä¸­çš„ä¸€ç§ã€‚è¿™æ ·ï¼Œæˆ‘å°±å¯ä»¥ä½¿ç”¨æˆ‘çš„ [ID3TagEditor æ¡†æ¶ç”¨æ­£ç¡®çš„æ•°æ®æ¥æ ‡è®° mp3ï¼Œæˆ‘éœ€è¦è¿™äº›æ•°æ®æ¥åœ¨æˆ‘çš„ clio](///2018/05/07/born-id3tageditor-mp3id3tagger.html) çš„åª’ä½“å¯¼èˆªç³»ç»Ÿä¸Šæ˜¾ç¤º mp3 æ–‡ä»¶å°é¢ï¼ï¼ï¼ğŸ˜Œ

```
class ID3FrameCreatorsChainFactory {
    static func make() -> ID3FrameCreatorsChain {
        let paddingAdder = PaddingAdderToEndOfContentUsingNullChar()
        let frameConfiguration = ID3FrameConfiguration()
        let uInt32ToByteArrayAdapter = UInt32ToByteArrayAdapterUsingUnsafePointer()
        let frameContentSizeCalculator = ID3FrameContentSizeCalculator(
                uInt32ToByteArrayAdapter: uInt32ToByteArrayAdapter
        )
        let frameFlagsCreator = ID3FrameFlagsCreator()
        let frameFromStringUTF16ContentCreator = ID3FrameFromStringContentCreator(
                frameContentSizeCalculator: frameContentSizeCalculator,
                frameFlagsCreator: frameFlagsCreator,
                stringToBytesAdapter: ID3UTF16StringToByteAdapter(paddingAdder: paddingAdder,
                                                                  frameConfiguration: frameConfiguration)
        )
        let frameFromStringISO88591ContentCreator = ID3FrameFromStringContentCreator(
            frameContentSizeCalculator: frameContentSizeCalculator,
            frameFlagsCreator: frameFlagsCreator,
            stringToBytesAdapter: ID3ISO88591StringToByteAdapter(paddingAdder: paddingAdder,
                                                                 frameConfiguration: frameConfiguration)
        )
        let albumFrameCreator = ID3AlbumFrameCreator(
                frameCreator: frameFromStringUTF16ContentCreator,
                id3FrameConfiguration: frameConfiguration
        )
        let albumArtistCreator = ID3AlbumArtistFrameCreator(
                frameCreator: frameFromStringUTF16ContentCreator,
                id3FrameConfiguration: frameConfiguration
        )
        let artistFrameCreator = ID3ArtistFrameCreator(
                frameCreator: frameFromStringUTF16ContentCreator,
                id3FrameConfiguration: frameConfiguration
        )
        let titleFrameCreator = ID3TitleFrameCreator(
                frameCreator: frameFromStringUTF16ContentCreator,
                id3FrameConfiguration: frameConfiguration
        )
        let attachedPictureFrameCreator = ID3AttachedPicturesFramesCreator(
                attachedPictureFrameCreator: ID3AttachedPictureFrameCreator(
                        id3FrameConfiguration: frameConfiguration,
                        id3AttachedPictureFrameConfiguration: ID3AttachedPictureFrameConfiguration(),
                        frameContentSizeCalculator: frameContentSizeCalculator,
                        frameFlagsCreator: frameFlagsCreator
                )
        )
        let yearFrameCreator = ID3YearFrameCreator(
                frameCreator: frameFromStringISO88591ContentCreator,
                id3FrameConfiguration: frameConfiguration
        )
        let genreFrameCreator = ID3GenreFrameCreator(
                frameCreator: frameFromStringISO88591ContentCreator,
                id3FrameConfiguration: frameConfiguration
        )
        let trackPositionFrameCreator = ID3TrackPositionFrameCreator(
                frameCreator: frameFromStringISO88591ContentCreator,
                id3FrameConfiguration: frameConfiguration
        )
        albumFrameCreator.nextCreator = albumArtistCreator
        albumArtistCreator.nextCreator = artistFrameCreator
        artistFrameCreator.nextCreator = titleFrameCreator
        titleFrameCreator.nextCreator = yearFrameCreator
        yearFrameCreator.nextCreator = genreFrameCreator
        genreFrameCreator.nextCreator = trackPositionFrameCreator
        trackPositionFrameCreator.nextCreator = attachedPictureFrameCreator
        return albumFrameCreator
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±æ˜¯è¿™æ ·ï¼ï¼ï¼è¿™æ˜¯ ID3TagEditor æ¡†æ¶çš„ä¸€èˆ¬ç»“æ„ã€‚å¦‚æœä½ æƒ³æ›´å¤šåœ°äº†è§£è¿™ä¸ªæ¡†æ¶ï¼Œä½ å¯ä»¥çœ‹çœ‹[æˆ‘çš„ github repo](https://github.com/chicio/ID3TagEditor) å¹¶å¼€å§‹ä¸ºâ¤ï¸åšäº›è´¡çŒ®ğŸ’œã€‚æ˜¾ç„¶ï¼Œä½ ä¹Ÿå¿…é¡»ç»§ç»­é˜…è¯»æˆ‘çš„åšå®¢ï¼Œå¹¶ç­‰å¾…æˆ‘åœ¨ä¸Šé¢æ‰¿è¯ºçš„å…³äºå…¶ä»–å®ç°ç»†èŠ‚çš„å…¶ä»–å¸–å­(å¦‚æœä½ æ‡’å¾—è‡ªå·±å»çœ‹çš„è¯ğŸ˜˜ğŸ˜†).

*åŸè½½äº[https://www . fabrizioduroni . it](https://www.fabrizioduroni.it/2018/05/08/id3tageditor-swift-read-write-id3-tag-mp3.html)2018 å¹´ 5 æœˆ 8 æ—¥ã€‚*