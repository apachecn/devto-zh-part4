# å¦‚ä½•ç”¨ Cypress æµ‹è¯•è·å– API è¯·æ±‚

> åŸæ–‡:[https://dev . to/mjsarfatti/how-to-test-your-fetch-requests-with-cypress-bh5](https://dev.to/mjsarfatti/how-to-test-your-fetch-requests-with-cypress-bh5)

æŸæ ‘[ç‰›é€¼](https://dev.to/noriste/front-end-productivity-boost-cypress-as-your-main-development-browser-5cdk)ã€‚æœ‰äº† Cypressï¼Œä½ å¯ä»¥åšä»»ä½•äº‹æƒ…ï¼ŒåŒ…æ‹¬é€šè¿‡ stub requests æ¨¡æ‹Ÿä½ çš„åç«¯ï¼Œæˆ–è€…åœ¨ä½ æ¯å¤©æ—©ä¸Šé†’æ¥çš„æ—¶å€™æŠŠæ–°ç…®çš„å’–å•¡é€åˆ°ä½ çš„åºŠä¸Š <sup>[1](#note-1)</sup> ã€‚

ä¸å¹¸çš„æ˜¯ï¼ŒCypress ç›®å‰ä¸æ”¯æŒæ‹¦æˆªç”¨æ›´ç°ä»£çš„ *[Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)* å‘å‡ºçš„è¯·æ±‚ï¼Œè€Œåªæ”¯æŒä¸å¤ªå¥½çš„è€å¼ *XMLHttpRequest* ã€‚

ä»[ä»–ä»¬è‡ªå·±çš„æ–‡æ¡£](https://docs.cypress.io/guides/guides/network-requests.html#Testing-Strategies):

> è¯·æ³¨æ„ï¼ŒCypress ç›®å‰åªæ”¯æŒæ‹¦æˆª XMLHttpRequestsã€‚ä½¿ç”¨ Fetch API çš„è¯·æ±‚å’Œå…¶ä»–ç±»å‹çš„ç½‘ç»œè¯·æ±‚(å¦‚é¡µé¢åŠ è½½å’Œ`<script>`æ ‡ç­¾)å°†ä¸ä¼šè¢«æ‹¦æˆªï¼Œä¹Ÿä¸ä¼šåœ¨å‘½ä»¤æ—¥å¿—ä¸­æ˜¾ç¤ºã€‚è§ [#95](https://github.com/cypress-io/cypress/issues/95) äº†è§£æ›´å¤šç»†èŠ‚å’Œä¸´æ—¶è§£å†³åŠæ³•ã€‚

å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªéå¸¸ç®€å•ä½†éå¸¸æœ‰æ•ˆçš„è§£å†³æ–¹æ³•:åŒ…å«ä¸€ä¸ª`fetch` polyfillï¼Œç„¶ååˆ é™¤`window.fetch`ä»¥ç¡®ä¿æµè§ˆå™¨é€€å›åˆ° *XMLHttpRequest* ã€‚

ä¸‹é¢æ˜¯ç®€å•çš„ 3 æ­¥æµç¨‹:

1.  åœ¨ä½ çš„é¡¹ç›®ä¸­å®‰è£…`fetch` polyfill åŒ…ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰

    ```
    $ npm install whatwg-fetch --save
    ~or~  
    $ yarn add whatwg-fetch 
    ```

2.  å°†å…¶å¯¼å…¥åˆ°æ‚¨çš„é¡¹ç›®ä¸­(æ‚¨å¯èƒ½ä¼šåœ¨æ‚¨çš„`index.js`æ–‡ä»¶ä¸­æ‰§è¡Œ)

    ```
    /* file: src/index.js */

    import 'whatwg-fetch'; 
    ```

3.  æŒ‡ç¤º Cypress åœ¨æ¯æ¬¡çª—å£åŠ è½½
    å‰åˆ é™¤`window.fetch`

    ```
    /* file: cypress/support/index.js */

    // Delete window.fetch on every window load
    Cypress.on('window:before:load', win => {
      delete win.fetch;
    }); 
    ```

å°±è¿™æ ·ï¼Œç¥ä½ æ„‰å¿«ğŸš€

* * *

<small>å¤‡æ³¨

T3ã€‘1-å°šæœªç¡®è®¤</small>