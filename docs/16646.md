# å°† Go æµ‹è¯•è®¾ç½®ä¸ºè¡¨æ ¼é©±åŠ¨çš„å­æµ‹è¯•

> åŸæ–‡:[https://dev . to/jayson eswith/setting-up-your-go-tests-as-table-driven-subtests-2md 2](https://dev.to/jaysonesmith/setting-up-your-go-tests-as-table-driven-subtests-2md2)

Go å¯¹æµ‹è¯•æœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œæœ‰äº›äººå¯èƒ½ä¼šç”¨æ›´æœ‰æ•ˆã€æ›´æ˜“è¯»çš„æ–¹å¼æ¥ç¼–å†™æµ‹è¯•ã€‚æˆ‘è§è¿‡ä¸€äº›ä¸åŒçš„ç¼–å†™æµ‹è¯•çš„æ–¹æ³•ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢æˆ‘æœ€å–œæ¬¢çš„æ˜¯è¡¨é©±åŠ¨å­æµ‹è¯•ã€‚åœ¨æˆ‘ä»¬æ·±å…¥äº†è§£è¿™äº›å†…å®¹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥ä¸€æ­¥åœ°ä½¿ç”¨è¡¨é©±åŠ¨çš„å­æµ‹è¯•ã€‚æ³¨æ„:ä½ å¯èƒ½ä¼šåœ¨é‡å¤–çœ‹åˆ°ä»¥ä¸åŒé£æ ¼ç¼–å†™çš„è¡¨æ ¼é©±åŠ¨å­æµ‹è¯•ã€‚è¿™é‡Œä»‹ç»çš„é£æ ¼å°±æ˜¯æˆ‘çš„åšæ³•ã€‚

## [](#before-table-driven-subtests-tdsts)è¡¨é©±åŠ¨å‰å­æµ‹è¯•(TDSTs)

è®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„åŠ æ³•å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå¯¹å®ƒä»¬è¿›è¡Œè½¬æ¢ï¼Œå¦‚æœè½¬æ¢æˆåŠŸï¼Œå°±è¿”å›å®ƒä»¬çš„å’Œã€‚

```
// add.go
package add

import (
    "strconv"

    "github.com/pkg/errors"
)

func add(x, y string) (int64, error) {
    xInt, err := strconv.ParseInt(x, 10, 64)
    if err != nil {
        return 0, errors.Wrap(err, "converting x failed")
    }

    yInt, err := strconv.ParseInt(y, 10, 64)
    if err != nil {
        return 0, errors.Wrap(err, "converting y failed")
    }

    return xInt + yInt, nil
} 
```

ä¸‹é¢æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨æ¥æä¾› add å‡½æ•°çš„ä¸€äº›åŸºæœ¬å†…å®¹çš„å…­ä¸ªæ¡ˆä¾‹:

*   é›¶
*   æ­£æ•°
*   æœ‰è‚¯å®šç­”æ¡ˆçš„è´Ÿæ•°
*   å¸¦æœ‰å¦å®šç­”æ¡ˆçš„è´Ÿæ•°
*   x å‚æ•°æ— æ³•è§£æ
*   y å‚æ•°æ— æ³•è§£æ

è€Œä¸‹é¢çš„ä¾‹å­æ˜¯ä»¥ä¸€ç§æ¸…æ™°æ˜“è¯»çš„æ–¹å¼å»ºç«‹èµ·æ¥çš„ï¼Œå…¶æ­¥éª¤åˆ†ä¸ºå®‰æ’/è¡ŒåŠ¨/æ–­è¨€æˆ–ç»™å‡º/ä½•æ—¶/ç„¶åï¼Œè¿™å–å†³äºä½ å¦‚ä½•æ€è€ƒã€‚å³ä½¿æœ‰ä¸€ä¸ªæµ‹è¯•å¤±è´¥ï¼Œè¿™ç§è®¾ç½®ä¹Ÿèƒ½è®©æˆ‘ä»¬å¾—åˆ°æ‰€æœ‰çš„æµ‹è¯•è¾“å‡ºã€‚

...å®ƒä¹Ÿæ˜¯è¶…çº§é‡å¤å’Œä¸å¿…è¦çš„å†—é•¿ã€‚ğŸ˜…

```
// ./add_test.go
package add

import (
    "errors"
    "testing"

    "github.com/stretchr/testify/require"
)

func TestAdd_Zeros(t *testing.T) {
    expected := int64(0)

    actual, err := add("0", "0")

    require.NoError(t, err)
    require.Equal(t, expected, actual)
}

func TestAdd_PositiveNumbers(t *testing.T) {
    expected := int64(4)

    actual, err := add("2", "2")

    require.NoError(t, err)
    require.Equal(t, expected, actual)
}

func TestAdd_NegativeNumbers_PositiveAnswer(t *testing.T) {
    expected := int64(5)

    actual, err := add("-5", "10")

    require.NoError(t, err)
    require.Equal(t, expected, actual)
}

func TestAdd_NegativeNumbers_NegativeAnswer(t *testing.T) {
    expected := int64(-8)

    actual, err := add("-5", "-3")

    require.NoError(t, err)
    require.Equal(t, expected, actual)
}

func TestAdd_XFailsParse(t *testing.T) {
    expected := int64(0)
    expectedErr := errors.New(`converting x failed: strconv.ParseInt: parsing "a": invalid syntax`)

    actual, err := add("a", "0")

    require.EqualError(t, expectedErr, err.Error())
    require.Equal(t, expected, actual)
}

func TestAdd_YFailsParse(t *testing.T) {
    expected := int64(0)
    expectedErr := errors.New(`converting y failed: strconv.ParseInt: parsing "z": invalid syntax`)

    actual, err := add("0", "z")

    require.EqualError(t, expectedErr, err.Error())
    require.Equal(t, expected, actual)
} 
```

ä¸æ˜¯æœ‰å…­ä¸ªä¸åŒçš„æµ‹è¯•å‡½æ•°ï¼Œæœ‰äº›å‡½æ•°çš„åå­—è¶Šæ¥è¶Šé•¿ï¼Œæ¯”å¦‚`TestAdd_NegativeNumbers_NegativeAnswer`æ¥è¡¨è¾¾æµ‹è¯•çš„ç›®çš„ï¼Œå¦‚æœæˆ‘å‘Šè¯‰ä½ æˆ‘ä»¬å¯ä»¥æŠŠå®ƒé‡æ„ä¸ºä¸€ä¸ªæµ‹è¯•å‡½æ•°ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿé‚£çœŸçš„ä¼šè®© T2 æŠŠäº‹æƒ…æ”¶æ‹¾å¹²å‡€ï¼Œä¸æ˜¯å—ï¼Ÿè¡¨æ ¼æµ‹è¯•ç”±ä¸‰ä¸ªåŸºæœ¬éƒ¨åˆ†ç»„æˆ:è¡¨æ ¼ã€å¾ªç¯å’Œæµ‹è¯•ã€‚

## [](#setting-the-table)è®¾ç½®è¡¨æ ¼

è¡¨æµ‹è¯•ä¸­çš„è¡¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è®¾ç½®:ä¸€ä¸ª slice of struct([]struct)æˆ–ä¸€ä¸ª map of string struct(map[string]struct)ã€‚é™¤äº†é£æ ¼ä¹‹å¤–ï¼Œè¿™ä¸¤è€…ä¹‹é—´æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œå½“ä½¿ç”¨[]struct æ—¶ï¼Œæ‚¨çš„æµ‹è¯•å°†æ€»æ˜¯æŒ‰ç…§å®ƒä»¬åœ¨è¡¨ä¸­å­˜åœ¨çš„é¡ºåºè¿è¡Œã€‚è¿™ç§å§‹ç»ˆä¸€è‡´çš„é¡ºåºå¯èƒ½æ˜¯ä¸€ä»¶åäº‹ï¼Œå› ä¸ºå¦‚æœæ‚¨ä¸æ³¨æ„æµ‹è¯•ä¹‹é—´çš„çŠ¶æ€ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æµ‹è¯•ä»¥ä¸€ç§é¡ºåºé€šè¿‡ï¼Œè€Œä¸æ˜¯ä»¥å¦ä¸€ç§é¡ºåºé€šè¿‡ã€‚æˆ‘æœ€è¿‘é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„ä¸€ç»„æµ‹è¯•ä½¿ç”¨äº† map[string]string æ–¹æ³•ï¼Œå› ä¸ºåœ°å›¾ä¸ä¼šä»¥ä¸€è‡´çš„é¡ºåºè¿”å›ã€‚å®ƒä»¬ä¸æ˜¯éšæœºçš„ï¼Œä½†æ˜¯å®ƒä»¬è¶³å¤Ÿä¸ä¸€è‡´ï¼Œä»¥è‡³äºå¯¹äºè¿™ä¸ªä¾‹å­æ¥è¯´å®ƒä»¬ä¹Ÿæ˜¯*ã€‚å¯¹äºæœ¬æŒ‡å—ï¼Œæˆ‘ä»¬å°†åˆ›å»ºçš„è¡¨å°†ä½¿ç”¨[]struct æ–¹æ³•ã€‚*

æˆ‘ä»¬çš„è¡¨å°†æ˜¯æˆ‘ä»¬æƒ³è¦è¿è¡Œçš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹çš„é›†åˆï¼ŒåŒ…å«æˆ‘ä»¬éœ€è¦çš„å…³äºæµ‹è¯•åç§°ã€è¾“å…¥å’Œé¢„æœŸæ•°æ®çš„æ‰€æœ‰ä¿¡æ¯ã€‚åœ¨æ›´é«˜çº§çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„è¡¨ä¹Ÿå¯ä»¥åŒ…æ‹¬åƒæµ‹è¯•è£…ç½®æˆ–è¾…åŠ©æ–¹æ³•è¿™æ ·çš„ä¸œè¥¿â€”â€”è®©æˆ‘ä»¬åœ¨å­¦ä¹ æ—¶ä¿æŒç®€å•ã€‚

åœ¨æœ€åŸºæœ¬çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç©ºè¡¨çœ‹èµ·æ¥ä¼šåƒè¿™æ ·(æˆ‘å–œæ¬¢å°†æˆ‘ä»¬èµ‹äºˆå®ƒçš„å˜é‡å‘½åä¸º testCases):

```
testCases := []struct{}{} 
```

ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬éœ€è¦å¡«å……æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹ã€‚æˆ‘ä»¬å°†é¦–å…ˆé€šè¿‡å®šä¹‰æˆ‘ä»¬çš„å­—æ®µå’Œå®ƒä»¬çš„ç±»å‹æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå°±åƒæˆ‘ä»¬å°†æ”¾å…¥æ ‡å‡†ç»“æ„ä¸­ä¸€æ ·ã€‚

```
testCases := []struct {
    name     string
    x        string
    y        string
    expected int64
    err      error
}{} 
```

ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶æ”¶ç´§ä¸€ç‚¹ï¼

```
testCases := []struct {
    name     string
    x        string
    y        string
    expected int64
    err      error
}{
    {
        name:     "Zeros",
        x:        "0",
        y:        "0",
        expected: int64(0),
    },
} 
```

ä¸œè¥¿è¿˜æ˜¯å¥½çœ‹çš„ï¼Œå¹²å‡€çš„ï¼Œæ˜“è¯»çš„ï¼æ‚¨ä¹Ÿå¯ä»¥ç¼–å†™æ²¡æœ‰ struct é”®çš„å•ç‹¬æ¡ˆä¾‹ï¼Œä½†æ˜¯ä¸ºäº†å¯è¯»æ€§ï¼Œæˆ‘å€¾å‘äºä¿ç•™å®ƒä»¬ã€‚æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œè¿™é‡Œæ²¡æœ‰ err æ¡ç›®ã€‚è¿™ç§æƒ…å†µä¸‹æ²¡æœ‰å£°æ˜çš„é”™è¯¯ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›å‡ºç°é”™è¯¯ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦åŒ…å«é”™è¯¯ï¼

## [](#time-to-loop)å¾ªç¯æ—¶é—´

è¡¨é©±åŠ¨æµ‹è¯•çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å®ƒä»¬å¾ˆç®€æ´ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥å®Œæˆå®ƒä»¬ã€‚è¿™å°±æ˜¯æˆ‘ä»¬çš„å¾ªç¯å‡ºç°çš„åœ°æ–¹ã€‚è¿™ä¸€æ­¥*çœŸçš„*ç®€å•:

```
for _, tc := range testCases {} 
```

æˆ‘ä»¬åœ¨`testCases`ä¸Šå»ºç«‹äº†ä¸€ä¸ªæ ‡å‡†å¾ªç¯ï¼Œå¹¶å°†æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åˆ†é…ç»™`tc`ã€‚è¿™æ˜¯è¿™é‡Œï¼Œè®©æˆ‘ä»¬æ”¶ç´§ä¸œè¥¿ï¼Œçœ‹çœ‹å¦‚ä½•å®Œæ•´çš„è®¾ç½®ç°åœ¨çœ‹èµ·æ¥ã€‚

```
func TestAdd(t *testing.T) {
    testCases := []struct {
        name, x, y string
        expected   int64
        err        error
    }{
        {name: "Zeros", x: "0", y: "0", expected: int64(0)},
    }

    for _, tc := range testCases {

    }
} 
```

æˆ‘å°†ç»“æ„ä¸­çš„å£°æ˜å‹ç¼©äº†ä¸€äº›ï¼Œå› ä¸ºæˆ‘ä»¬çš„æµ‹è¯•å€¼æ˜¯åŸºæœ¬çš„ï¼Œæ‰€ä»¥æˆ‘å°†å®ƒä»¬éƒ½æ”¾åœ¨ä¸€è¡Œä¸­ã€‚

## [](#the-test)æµ‹è¯•

æˆ‘ä»¬å·²ç»å»ºç«‹äº†ä¸‰åˆ†ä¹‹äºŒçš„è¡¨é©±åŠ¨æµ‹è¯•ï¼Œè®©æˆ‘ä»¬ç»™å®ƒä¸€äº›ä¸œè¥¿æ¥è¿è¡Œã€‚(æˆ‘ä»¬ç¨åä¼šåšå­æµ‹è¯•)è¿™ä¸€æ­¥çœ‹èµ·æ¥åŸºæœ¬ä¸Šå’Œæˆ‘ä»¬çš„åˆå§‹æµ‹è¯•ä¸€æ ·ï¼›æˆ‘ä»¬åªéœ€è¦é€‚å½“åœ°å‘½åä¸€äº›ä¸œè¥¿ï¼Œè¿™æ ·æµ‹è¯•å°±çŸ¥é“ä»€ä¹ˆå»å“ªé‡Œäº†ã€‚

```
func TestAdd(t *testing.T) {
    testCases := []struct {
        name, x, y string
        expected   int64
        err        error
    }{
        {name: "Zeros", x: "0", y: "0", expected: int64(0)},
    }

    for _, tc := range testCases {
        actual, err := add(tc.x, tc.y)

        require.NoError(t, err)
        require.Equal(t, tc.expected, actual)
    }
} 
```

ç°åœ¨ï¼Œä½ å¯èƒ½ä¼šæƒ³ï¼Œä¸æˆ‘ä»¬å¼€å§‹æ—¶çš„æƒ…å†µç›¸æ¯”ï¼Œè¿™æœ‰ç‚¹å¤æ‚ï¼Œå¦‚æœè¿™æ˜¯æˆ‘ä»¬å”¯ä¸€çš„æµ‹è¯•æ¡ˆä¾‹ï¼Œæˆ‘åœ¨æŸç§ç¨‹åº¦ä¸ŠåŒæ„ä½ çš„è§‚ç‚¹ã€‚ä¸€æ—¦ä½ å¼€å§‹ä½¿ç”¨å®ƒä»¬ï¼Œé»˜è®¤è®¾ç½®å®ƒä»¬æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºå®ƒä½¿å¾—æ·»åŠ æ–°çš„æ¡ˆä¾‹å˜å¾—éå¸¸å®¹æ˜“ã€‚è®©æˆ‘ä»¬é€šè¿‡æ·»åŠ æ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹æ¥å±•ç¤ºè¿™ä¸€ç‚¹ã€‚

```
func TestAdd(t *testing.T) {
    testCases := []struct {
        name, x, y string
        expected   int64
        err        error
    }{
        {name: "Zeros", x: "0", y: "0", expected: int64(0)},
        {name: "Positive numbers", x: "2", y: "2", expected: int64(4)},
        {name: "Negative numbers with positive result", x: "-5", y: "10", expected: int64(5)},
        {name: "Negative numbers with negative result", x: "-5", y: "-3", expected: int64(-8)},
        {name: "X fails to parse", x: "a", y: "0", expected: int64(0),
            err: errors.New(`converting x failed: strconv.ParseInt: parsing "a": invalid syntax`)},
        {name: "Y fails to parse", x: "0", y: "z", expected: int64(0),
            err: errors.New(`converting y failed: strconv.ParseInt: parsing "z": invalid syntax`)},
    }

    for _, tc := range testCases {
        actual, err := add(tc.x, tc.y)

        require.NoError(t, err)
        require.Equal(t, tc.expected, actual)
    }
} 
```

å¦‚æ­¤ç®€å•ï¼â€œä½†æ˜¯ç­‰ç­‰ï¼Œé‚£äº›ä¸é€šè¿‡ï¼â€ä½ æ˜¯æ­£ç¡®çš„è¯»è€…ï¼›æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„æµ‹è¯•éƒ¨åˆ†ä¸­æ·»åŠ æ›´å¤šçš„ä¸œè¥¿æ¥è®©äº‹æƒ…è¿›è¡Œä¸‹å»ã€‚è¿™å¯èƒ½æ˜¯è¿™æ ·çš„ã€‚

```
for _, tc := range testCases {
    actual, err := add(tc.x, tc.y)

    if tc.err == nil {
        require.NoError(t, err)
    } else {
        require.EqualError(t, tc.err, err.Error())
    }
    require.Equal(t, tc.expected, actual)
} 
```

## [](#time-for-the-subtests)å­æµ‹è¯•æ—¶é—´

æ ‡å‡†è¡¨æµ‹è¯•çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å¤±è´¥äº†ï¼Œé‚£ä¹ˆä¹‹åçš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½ä¸ä¼šè¿è¡Œï¼Œè¿™è®©æˆ‘ä»¬å¤„äºä¸€ä¸ªéå¸¸ç³Ÿç³•çš„å¢ƒåœ°ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬å¯¹ä»£ç çš„çŠ¶æ€æœ‰ä¸€ä¸ªä¸å®Œæ•´çš„äº†è§£ï¼Œè¿™å¯èƒ½æ˜¯å±é™©çš„ï¼è¿™å°±æ˜¯å­æµ‹è¯•çš„ç”¨æ­¦ä¹‹åœ°ã€‚

æ€ä¹ˆä¼šï¼Ÿæ¯ä¸ªå­æµ‹è¯•éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œå½“ä¸€ä¸ªæµ‹è¯•å¤±è´¥æ—¶ï¼Œæµ‹è¯•æ‰§è¡Œä¼šç»§ç»­åˆ°ä¸‹ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œç›´åˆ°æ‰€æœ‰çš„æµ‹è¯•éƒ½å®Œæˆâ€”â€”å‡è®¾ä½ ç¼–å†™çš„æµ‹è¯•æ˜¯åŸå­çš„ã€‚ä½ *æ­£åœ¨ç”¨è¿™ç§æ–¹å¼ç¼–å†™ä½ çš„æµ‹è¯•ï¼Œå¯¹å—ï¼Ÿå¯¹å—ï¼Ÿï¼*

è®¾ç½®è¿è¡Œå­æµ‹è¯•éå¸¸ç®€å•:

```
func TestAdd(t *testing.T) {
    testCases := []struct {
        name, x, y string
        expected   int64
        err        error
    }{
        {name: "Zeros", x: "0", y: "0", expected: int64(0)},
        {name: "Positive numbers", x: "2", y: "2", expected: int64(4)},
        {name: "Negative numbers with positive result", x: "-5", y: "10", expected: int64(5)},
        {name: "Negative numbers with negative result", x: "-5", y: "-3", expected: int64(-8)},
        {name: "X fails to parse", x: "a", y: "0", expected: int64(0),
            err: errors.New(`converting x failed: strconv.ParseInt: parsing "a": invalid syntax`)},
        {name: "Y fails to parse", x: "0", y: "z", expected: int64(0),
            err: errors.New(`converting y failed: strconv.ParseInt: parsing "z": invalid syntax`)},
    }

    for _, tc := range testCases {
        t.Run(tc.name, func(tt *testing.T) {
            actual, err := add(tc.x, tc.y)

            if tc.err == nil {
                require.NoError(tt, err)
            } else {
                require.EqualError(tt, tc.err, err.Error())
            }
            require.Equal(tt, tc.expected, actual)
        })
    }
} 
```

è¶…çº§ç®€å•ï¼åªéœ€åŒ…è£…ç°æœ‰çš„æµ‹è¯•è®¾ç½®ï¼Œæ›´æ”¹ä¸€äº›å˜é‡åï¼Œå°±å¯ä»¥å¾—åˆ°å­æµ‹è¯•äº†ï¼è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æŒ‡å‡º:

*   t.Run æ¥å—æµ‹è¯•å(æˆ‘ä»¬ç°åœ¨æ­£åœ¨ä½¿ç”¨å®ƒï¼)ä»¥åŠä¸€ä¸ªåŒ…è£…æˆ‘ä»¬çš„æµ‹è¯•ä»£ç çš„å‡½æ•°ã€‚
*   åŒ…è£…å‡½æ•°æ¥å—ä¸€ä¸ªæµ‹è¯•å®ä¾‹ã€‚T struct å¹¶å°†å…¶å£°æ˜ä¸º`tt`ã€‚è™½ç„¶æ²¡æœ‰å¿…è¦ï¼Œä½†æˆ‘ä¼šåšäº‹æƒ…å¯èƒ½ä¼šå‡ºé”™çš„äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¦¨è¿™æ ·åšï¼Œå¹¶åœ¨æœªæ¥çš„é“è·¯ä¸Šä¸ºè‡ªå·±èŠ‚çœä¸€äº›å¯èƒ½çš„ç—›è‹¦ã€‚

è®©æˆ‘ä»¬è¿è¡Œä¸€ä¸‹æ–°è®¾ç½®çš„å­æµ‹è¯•ï¼Œçœ‹çœ‹æƒ…å†µå¦‚ä½•:

```
$ go test
PASS
ok      github.com/jaysonesmith/tdst    0.024s 
```

### [](#all-about-the-communication)ä¸€åˆ‡å…³äºäº¤æµ

è¡Œ...é‡è¦çš„æ˜¯ï¼Œè¯¥è¾“å‡ºçœ‹èµ·æ¥å°±åƒä»»ä½•å…¶ä»–æµ‹è¯•è¿è¡Œé€šè¿‡æ—¶çš„æƒ…å†µä¸€æ ·ï¼æ˜¯å•Šï¼æ­£ç¡®ï¼è™½ç„¶å½“ä»–ä»¬é€šè¿‡æµ‹è¯•æ—¶çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å½“æµ‹è¯•å¤±è´¥æ—¶æ‰æ˜¯çœŸæ­£çš„ç²¾å½©ï¼æˆ‘å°†ä¿®æ”¹ä¸€åŠå­æµ‹è¯•ä¸­çš„å†…å®¹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å¤±è´¥æ—¶çš„è¾“å‡ºæ˜¯ä»€ä¹ˆæ ·å­:

```
$ go test
--- FAIL: TestAdd (0.00s)
    --- FAIL: TestAdd/Positive_numbers (0.00s)
        add_test.go:35:
                Error Trace:    add_test.go:35
                Error:          Not equal:
                                expected: 5
                                actual  : 4
                Test:           TestAdd/Positive_numbers
    --- FAIL: TestAdd/Negative_numbers_with_negative_result (0.00s)
        add_test.go:35:
                Error Trace:    add_test.go:35
                Error:          Not equal:
                                expected: -3
                                actual  : -8
                Test:           TestAdd/Negative_numbers_with_negative_result
    --- FAIL: TestAdd/Y_fails_to_parse (0.00s)
        add_test.go:33:
                Error Trace:    add_test.go:33
                Error:          Error message not equal:
                                expected: "converting y failed: strconv.ParseInt: parsing \"z\": invalid syntax"
                                actual  : "converting y failed: strconv.ParseInt: foo"
                Test:           TestAdd/Y_fails_to_parse
FAIL
exit status 1
FAIL    github.com/jaysonesmith/tdst    0.024s 
```

å‘œï¼æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªéå¸¸å®¹æ˜“é˜…è¯»çš„æ‰€æœ‰å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹çš„åˆ†ç±»ï¼ŒåŒ…æ‹¬çˆ¶æµ‹è¯•ã€æµ‹è¯•ç”¨ä¾‹ã€å¤±è´¥çš„æ–­è¨€è¡Œï¼Œä»¥åŠä¸€äº›æœ‰ç”¨çš„é¢„æœŸ/å®é™…è¾“å‡ºï¼Œä»¥å¸®åŠ©æˆ‘ä»¬è¯Šæ–­é—®é¢˜ã€‚å¦‚æœæ²¡æœ‰å­æµ‹è¯•ï¼Œè¾“å‡ºä¼šæ˜¯è¿™æ ·çš„:

```
$ go test
--- FAIL: TestAdd (0.00s)
    add_test.go:35:
                Error Trace:    add_test.go:35
                Error:          Not equal:
                                expected: 5
                                actual  : 4
                Test:           TestAdd
FAIL
exit status 1
FAIL    github.com/jaysonesmith/tdst    0.025s 
```

...æ˜¯å•Šã€‚ä¸€ç‚¹ä¹Ÿæ²¡ç”¨ï¼Œæ˜¯å§ï¼Ÿ

å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Go çš„éè‡´å‘½å·¥å…·æˆ– evidence çš„`assert`è€Œä¸æ˜¯`require`ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä¸å­æµ‹è¯•è®¾ç½®ç±»ä¼¼çš„è¡Œä¸ºï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šå®Œå…¨åœæ­¢å½“å‰è¿è¡Œã€‚æˆ‘é€šå¸¸ä½¿ç”¨`assert`ï¼Œä½†æ˜¯ï¼Œä½œä¸ºä¸€ä¸ªè­¦å‘Šï¼Œå¦‚æœæµ‹è¯•çš„ä¸€éƒ¨åˆ†å¤±è´¥ï¼Œå¹¶ä¸”éšåçš„æ–­è¨€ä¾èµ–äºè¯¥æ•°æ®ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´ä¸€äº›ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚

ä¸‹é¢æ˜¯æˆ‘å¦‚ä½•è®¾ç½®çš„ï¼Œä»¥åŠæˆ‘ä»¬æœ€ç»ˆçš„æµ‹è¯•å°†ä¼šæ˜¯ä»€ä¹ˆæ ·å­:

```
func TestAdd(t *testing.T) {
    testCases := []struct {
        name, x, y string
        expected   int64
        err        error
    }{
        {name: "Zeros", x: "0", y: "0", expected: int64(0)},
        {name: "Positive numbers", x: "2", y: "2", expected: int64(5)},
        {name: "Negative numbers with positive result", x: "-5", y: "10", expected: int64(5)},
        {name: "Negative numbers with negative result", x: "-5", y: "-3", expected: int64(-3)},
        {name: "X fails to parse", x: "a", y: "0", expected: int64(0),
            err: errors.New(`converting x failed: strconv.ParseInt: parsing "a": invalid syntax`)},
        {name: "Y fails to parse", x: "0", y: "z", expected: int64(0),
            err: errors.New(`converting y failed: strconv.ParseInt: foo`)},
    }

    for _, tc := range testCases {
        t.Run(tc.name, func(tt *testing.T) {
            actual, err := add(tc.x, tc.y)

            if tc.err == nil {
                assert.NoError(tt, err)
            } else {
                assert.EqualError(tt, tc.err, err.Error())
            }
            assert.Equal(tt, tc.expected, actual)
        })
    }
} 
```

ä½ è§‰å¾—æ€ä¹ˆæ ·ï¼Ÿæˆ‘ä¸ªäººçœŸçš„å¾ˆå–œæ¬¢è¿™äº›ï¼Œå¹¶ä¸”åœ¨æµ‹è¯•çš„æ—¶å€™ç»å¸¸ä¼šå†™ TDST çš„ã€‚æˆ‘å¸Œæœ›ä½ å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ï¼Œå¹¶å–œæ¬¢è¿™æœ¬ä¹¦ã€‚

éå¸¸æ„Ÿè°¢æ‚¨çš„å®è´µæ—¶é—´ï¼

å°„æµç ”ç©¶â€¦

æ³¨:æœ¬æŒ‡å—ä»…æ¶µç›–è®¾ç½®è¡¨æ ¼é©±åŠ¨å­æµ‹è¯•ï¼Œä½†ä¸åŒ…æ‹¬æ‰€æœ‰å…³äºå®ƒä»¬çš„ç²¾å½©å†…å®¹ï¼ä¹Ÿè®¸æˆ‘ä¹Ÿä¼šå†™è¿™äº›ï¼