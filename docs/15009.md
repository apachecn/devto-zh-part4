# ç”¨(å¾®å°çš„)GO å’Œ WebAssembly åˆ›å»º Dev çš„ç¦»çº¿é¡µé¢ğŸ¦„ğŸ’¡âœ¨

> åŸæ–‡:[https://dev . to/sendilkumarn/create-dev-s-offline-page-with-tiny-go-and-web assembly-9n 6](https://dev.to/sendilkumarn/create-dev-s-offline-page-with-tiny-go-and-webassembly-9n6)

Dev çš„[ç¦»çº¿é¡µé¢](https://dev.to/offline)å¾ˆæœ‰è¶£ï¼Œæˆ‘ä»¬[ç”¨ Rust å’Œ WebAssembly](https://dev.to/sendilkumarn/create-dev-s-offline-page-with-rust-and-webassembly-21gn) å®ç°äº†å®ƒã€‚

å›´æ£‹å¾ˆç®€å•ã€‚æˆ‘ä»¬èƒ½åœ¨ Go å’Œ WebAssembly ä¸­å®ç°å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„...

[![](../Images/8373d42f25b2fc76408bebffd1a6320f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--_i4QVzEO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1eaxlpr98hv1bedjgyhg.gif)

æˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚å¦‚æœä½ æƒ³ä»å¤´å¼€å§‹å†™ï¼Œå¯ä»¥æŸ¥çœ‹[è¿™ç¯‡æ•™ç¨‹](https://dev.to/sendilkumarn/tiny-go-to-webassembly-5168)ã€‚

å¦‚æœä½ åªæ˜¯æƒ³çœ‹æºä»£ç ï¼Œ[çœ‹çœ‹è¿™ä¸ªåˆ†æ”¯](https://github.com/sendilkumarn/go-wasm/tree/dev-board)ã€‚

# [](#code-code-code)ä»£ç ä»£ç ä»£ç 

æˆ‘ä»¬å°†é¦–å…ˆåœ¨`go/main.go`ä¸­å¯¼å…¥â€œsyscall/jsâ€å’Œâ€œfmtâ€ã€‚

> å½“ä½¿ç”¨ js/WASM æ¶æ„æ—¶,â€œsyscall/jsâ€åŒ…æä¾›äº†å¯¹ WebAssembly ä¸»æœºç¯å¢ƒçš„è®¿é—®ã€‚å®ƒçš„ API åŸºäº JavaScript è¯­ä¹‰ã€‚è¿™ä¸ªåŒ…æ˜¯å®éªŒæ€§çš„ã€‚ğŸ¦„ ğŸ¦„

```
package main 

import( 
    "fmt"
    "syscall/js"
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ·»åŠ ä¸€äº›å…¨å±€å¯ç”¨çš„å˜é‡ï¼Œè¿™äº›å˜é‡æ˜¯æˆ‘ä»¬ä» JavaScript æˆ–æµè§ˆå™¨è°ƒç”¨å‡½æ•°æ—¶å¯èƒ½éœ€è¦ç”¨åˆ°çš„ã€‚

```
var (
    isPainting bool
    x          float64
    y          float64
    ctx        js.Value
    color      string
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°†åœ¨`out/index.html`ä¸­æ‰‹åŠ¨æ·»åŠ ç”»å¸ƒå…ƒç´ ã€‚

```
<canvas id="canvas"> </canvas> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç§»é™¤`main`åŠŸèƒ½å†…çš„`Hello World`è¡Œï¼Œå¹¶æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹ã€‚

ä»æµè§ˆå™¨ä¸­è·å–`document`å¯¹è±¡ã€‚ä½¿ç”¨`document`å¾—åˆ°æˆ‘ä»¬åˆšåˆšæ·»åŠ çš„`canvas`å…ƒç´ ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨`syscall/js` API æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚

```
func main() {

    doc := js.Global().Get("document")
    canvasEl := doc.Call("getElementById", "canvas")
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

API å¾ˆç®€å•ã€‚ä» JavaScript çš„å…¨å±€åç§°ç©ºé—´è·å–æ–‡æ¡£ã€‚

åœ¨æ–‡æ¡£å†…éƒ¨ï¼Œé€šè¿‡ Id è°ƒç”¨ canvas å…ƒç´ ã€‚

æˆ‘ä»¬å°†è®¾ç½®`canvasEl`çš„ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚å®½åº¦ã€é«˜åº¦ã€‚æˆ‘ä»¬è¿˜ä¼šå¾—åˆ°ç”»å¸ƒ'`context`ã€‚

```
bodyW := doc.Get("body").Get("clientWidth").Float()
bodyH := doc.Get("body").Get("clientHeight").Float()
canvasEl.Set("width", bodyW)
canvasEl.Set("height", bodyH)
ctx = canvasEl.Call("getContext", "2d") 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åæˆ‘ä»¬å°†å®šä¹‰ä¸‰ä¸ªäº‹ä»¶ç›‘å¬å™¨`mousedown` | `mousemove` | `mouseup`åˆ°`canvasElement`ã€‚

### [](#mouse-down)é¼ æ ‡æ”¾ä¸‹

å½“æˆ‘ä»¬ç‚¹å‡»é¼ æ ‡æ—¶ï¼Œæˆ‘ä»¬å°†å¼€å§‹ç»˜ç”»ã€‚

```
startPaint := js.FuncOf(func(this js.Value, args []js.Value) interface{} {
    e := args[0]
    isPainting = true

    x = e.Get("pageX").Float() - canvasEl.Get("offsetLeft").Float()
    y = e.Get("pageY").Float() - canvasEl.Get("offsetTop").Float()
    return nil
})

canvasEl.Call("addEventListener", "mousedown", startPaint) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> è¯·æ³¨æ„ï¼Œè¿”å› nil æ˜¯å¾ˆé‡è¦çš„ï¼Œå¦åˆ™ç¨‹åºå°†æ— æ³•ç¼–è¯‘ã€‚

æ•´ä¸ª API åŸºäº[åå°„ API](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect) ã€‚

### [](#mouse-move)é¼ æ ‡ç§»åŠ¨

æˆ‘ä»¬å°†å®šä¹‰ç»˜ç”»åŠŸèƒ½ã€‚

```
 paint := js.FuncOf(func(this js.Value, args []js.Value) interface{} {
    if isPainting {
        e := args[0]
        nx := e.Get("pageX").Float() - canvasEl.Get("offsetLeft").Float()
        ny := e.Get("pageY").Float() - canvasEl.Get("offsetTop").Float()

        ctx.Set("strokeStyle", color)
        ctx.Set("lineJoin", "round")
        ctx.Set("lineWidth", 5)

        ctx.Call("beginPath")
        ctx.Call("moveTo", nx, ny)
        ctx.Call("lineTo", x, y)
        ctx.Call("closePath")

        // actually draw the path*
        ctx.Call("stroke")

        // Set x and y to our new coordinates*
        x = nx
        y = ny
    }
    return nil
})
canvasEl.Call("addEventListener", "mousemove", paint) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#mouse-up)é¼ æ ‡æŠ¬èµ·

æœ€åï¼Œæˆ‘ä»¬å°†å®šä¹‰å½“é¼ æ ‡æŠ¬èµ·äº‹ä»¶è¢«è§¦å‘æ—¶è°ƒç”¨çš„é€€å‡ºæ–¹æ³•ã€‚

```
 exit := js.FuncOf(func(this js.Value, args []js.Value) interface{} {
        isPainting = false
        return nil
    })

    canvasEl.Call("addEventListener", "mouseup", exit) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œæˆ‘ä»¬å°†å®šä¹‰é¢œè‰²é€‰æ‹©å™¨ã€‚åœ¨`out/index.html`ä¸­æ·»åŠ ä¸€ä¸ªé¢œè‰² div å’Œå¿…è¦çš„ CSSã€‚

```
<style>
     .color {
            display: inline-block;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            margin: 10px;
       }
</style>

<div id="colors></div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°†é¢œè‰²å®šä¹‰ä¸ºä¸€ä¸ªæ•°ç»„ã€‚ç„¶åéå†é¢œè‰²å¹¶åˆ›å»ºè‰²æ ·èŠ‚ç‚¹ã€‚å‘è‰²æ ·æ·»åŠ ä¸€ä¸ªå•å‡»äº‹ä»¶ä¾¦å¬å™¨ã€‚

```
 divEl := doc.Call("getElementById", "colors")

    colors := [6]string {"#F4908E", "#F2F097", "#88B0DC", "#F7B5D1", "#53C4AF", "#FDE38C"}

    for _, c := range colors {  
        node := doc.Call("createElement", "div")
        node.Call("setAttribute","class", "color")
        node.Call("setAttribute", "id", c)
        node.Call("setAttribute","style", fmt.Sprintf("background-color: %s", c))

        setColor := js.FuncOf(func(this js.Value, args []js.Value) interface{} {
                e := args[0]
                color = e.Get("target").Get("id").String()
                return nil;
        })

        node.Call("addEventListener", "click", setColor)

        divEl.Call("appendChild", node)

    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±æ˜¯è¿™æ ·ã€‚

ç°åœ¨é€šè¿‡è¿è¡Œ`go run webServer.go`å¯åŠ¨ web æœåŠ¡å™¨ã€‚

ä½¿ç”¨
ç¼–è¯‘è¿›å…¥ WebAssembly æ¨¡å—

```
tinygo build -o ./out/main.wasm -target wasm -no-debug ./go/main.go 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®¿é—® [localhost:8080](https://dev.tolocalhost:8080) æŸ¥çœ‹ä¸ºæ‚¨çš„åˆ›æ„å‡†å¤‡çš„ä»¤äººæ•¬ç•çš„ç”»å¸ƒæ¿ğŸ¦„ã€‚

ğŸ’¡ç”Ÿæˆçš„`WebAssembly`æ¨¡å—æ­£å¥½æ˜¯ **52KB** ã€‚TinyGo éå¸¸æ£’ï¼Œå¯ä»¥åˆ›å»ºå°å¾—æƒŠäººçš„ WebAssembly äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å®ƒæ˜¯å¦‚ä½•åˆ›é€ çš„ï¼Ÿè¯·ç»§ç»­å…³æ³¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ã€‚ğŸ’¡

> æ³¨æ„:æ¯æ™šä½¿ç”¨ Firefox / Firefoxã€‚Chrome æœ‰æ—¶ä¼šå´©æºƒã€‚

### [](#more-optimization-heart)æ›´ä¼˜åŒ–â¤ï¸

> ç§»é™¤`fmt`å¯¼å…¥å¹¶ç”¨æ™®é€šçš„å­—ç¬¦ä¸²è¿æ¥æ›¿æ¢`fmt.Sprintf`ï¼Œè¿™å°†å»æ‰å¦ä¸€ä¸ª **26KB** ã€‚æ£€æŸ¥æäº¤[è¿™é‡Œ](https://github.com/sendilkumarn/go-wasm/commit/f5837b0cee52f7598cff0da0a4f94770a29cb279)ã€‚

*æ„Ÿè°¢ Justin Clift åˆ†äº«è¿™ä¸ªæŠ€å·§:)*

ä½ â¤ï¸ç”Ÿé”ˆäº†å—ï¼Ÿç‚¹å‡»æŸ¥çœ‹å¦‚ä½•ä½¿ç”¨ Rust è¿›è¡Œ web ç»„è£…ã€‚

æˆ‘å¸Œæœ›è¿™èƒ½ç»™ä½ ä¸€ä¸ªåŠ¨åŠ›ï¼Œå¼€å§‹ä½ çš„ WebAssembly ä¹‹æ—…ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜/å»ºè®®/è§‰å¾—æˆ‘é”™è¿‡äº†ä»€ä¹ˆï¼Œè¯·éšæ—¶æ·»åŠ è¯„è®ºã€‚

ä½ å¯ä»¥åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘ã€‚

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç•™ä¸‹èµæˆ–è¯„è®ºã€‚â¤ï¸

è°¢è°¢

[![aspittel image](../Images/45a8d86fe0ff981bf7cdb45b471a3c5c.png)](/aspittel)

## [é˜¿é‡ŒÂ·æ–¯çš®ç‰¹](/aspittel)

[Passionate about education, Python, JavaScript, and code art.](/aspittel)

å¯¹äº[ç¯‡](https://dev.to/aspittel/how-to-create-the-drawing-interaction-on-dev-s-offline-page-1mbe)ã€‚