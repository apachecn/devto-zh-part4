# åœ¨æ°´è±šä¸­åˆ¶ä½œå¤æ‚çš„æµ‹è¯•æ•°æ®

> åŸæ–‡:[https://dev . to/n 350071/making-complex-test-data-in-capybara-2ojn](https://dev.to/n350071/making-complex-test-data-in-capybara-2ojn)

## [](#first-notes)ğŸ¦„é¦–å…ˆï¼Œç¬”è®°

è¿™é¡¹æŠ€æœ¯å®é™…ä¸Šä¸ä»…é€‚ç”¨äºæ°´è±šæµ‹è¯•ï¼Œä¹Ÿé€‚ç”¨äº RSpec æµ‹è¯•ã€‚ç„¶è€Œï¼Œä¸»è¦çš„ä½¿ç”¨æ¡ˆä¾‹æ˜¯æ°´è±šã€‚

## [](#situation)ğŸ¤”æƒ…å†µ

æ‚¨éœ€è¦ä¸ºå¤šä¸ªæµ‹è¯•å‡†å¤‡å¤æ‚çš„æµ‹è¯•æ•°æ®ã€‚

å¯¹äº Factorybot æ¥è¯´ä¼¼ä¹å¤ªå¤æ‚äº†ã€‚ä½†æ˜¯ï¼ŒUI æ“ä½œä¼¼ä¹å¾ˆå®¹æ˜“ã€‚

## [](#solution)ğŸ‘è§£å†³åŠæ³•

ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¨¡å—å¹¶åŒ…å«å®ƒï¼Œåœ¨{}å—ä¹‹å‰è°ƒç”¨å®ƒã€‚

```
#rails_helper.rb
Dir[Rails.root.join('spec/rails_helpers/**/*.rb')].each { |f| require f } 
```

```
# spec/rails_helpers/book_operation_scripts.rb
module BookOperationScripts
  def create_published_book(author, options = {})
    click_on('publish a new book')
    fill_in 'v2_book[author]', with: options.fetch(:name, 'n350071')
    fill_in 'v2_book[title]', with: options.fetch(:name, 'enjoy ruby')
    fill_in 'v2_book[price]', with: '8'
    # ...
    page.execute_script("$('form#publish-form').submit()")
  end
end 
```

```
# spec/v2/feature/books_spec.rb
require 'rails_helper'

feature 'book/', js: true do
  include BookOperationScripts
  let(:author){ create(:v2_author) }
  before do
    create_v2_published_book(author)
  end
end 
```

## [](#parent-note)ğŸ”—çˆ¶æ³¨é‡Š

[![n350071 image](img/c9dd0fa7ece3b4a6c3e55d373898cd1e.png)](/n350071) [## æˆ‘çš„æ°´è±šç¬”è®°

### n350071ğŸ‡¯ğŸ‡µ9 æœˆ 11 æ—¥ 192 åˆ†é’Ÿé˜…è¯»

#rails](/n350071/my-capybara-note-2gp3)