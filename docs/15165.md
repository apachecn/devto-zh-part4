# ä½¿ç”¨ Blazor åˆ›å»º DEV çš„ç¦»çº¿é¡µé¢

> åŸæ–‡:[https://dev . to/azure/creating-dev-s-offline-page-using-blazor-29dl](https://dev.to/azure/creating-dev-s-offline-page-using-blazor-29dl)

æˆ‘çœ‹åˆ°äº†ä¸€ä¸ªæ¥è‡ªé˜¿é‡ŒÂ·æ–¯çš®ç‰¹å°”çš„æœ‰è¶£å¸–å­ï¼Œå…³äºåˆ›å»º [DEV çš„ç¦»çº¿](https://dev.to/offline)é¡µé¢:

[![aspittel](../Images/45a8d86fe0ff981bf7cdb45b471a3c5c.png)](/aspittel) [## å¦‚ä½•åœ¨ DEV çš„ç¦»çº¿é¡µé¢ä¸Šåˆ›å»ºç»˜å›¾äº¤äº’

### Ali Spittelï¼Œ7 æœˆ 3 æ—¥è‡³ 19 æ—¥ï¼Œ4 åˆ†é’Ÿé˜…è¯»

#javascript #art #showdev](/aspittel/how-to-create-the-drawing-interaction-on-dev-s-offline-page-1mbe)

é‰´äºæˆ‘è¿‡å»ç”¨ WebAssembly åšè¿‡ä¸€äº›[å®éªŒï¼Œæˆ‘å†³å®šå°è¯•ä¸€ä¸‹è‡ªå·±åœ¨ WebAssembly ä¸­çš„å®ç°ï¼Œç‰¹åˆ«æ˜¯ç”¨](https://dev.to/aaronpowell/learning-golang-through-webassembly---go-wasm-typescript-and-react-klm) [Blazor](https://dotnet.microsoft.com/apps/aspnet/web-apps/client?WT_mc.id=devto-blog-aapowell) ã€‚

## [](#getting-started)å…¥é—¨

*è­¦å‘Š:Blazor æ˜¯ä¸€ä¸ªä½¿ç”¨ã€‚NET å †æ ˆï¼Œç‰¹åˆ«æ˜¯ C#è¯­è¨€ã€‚å®ƒæ˜¯é«˜åº¦å®éªŒæ€§çš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½åœ¨ç¼–å†™æ—¶ä¼šå‘ç”Ÿå˜åŒ–(æˆ‘ç”¨çš„æ˜¯ build `3.0.0-preview6.19307.2`)ã€‚*

é¦–å…ˆï¼Œä½ éœ€è¦éµå¾ª Blazor çš„[è®¾ç½®æŒ‡å—ï¼Œä¸€æ—¦å®Œæˆï¼Œåœ¨ä½ æœ€å–œæ¬¢çš„ç¼–è¾‘å™¨ä¸­åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®(æˆ‘ç”¨çš„æ˜¯ VS ä»£ç )ã€‚](https://docs.microsoft.com/en-gb/aspnet/core/blazor/get-started?view=aspnetcore-3.0&tabs=visual-studio-code&WT_mc.id=devto-blog-aapowell)

ç„¶åæˆ‘ä»`Pages`å’Œ`Shared`æ–‡ä»¶å¤¹ä¸­åˆ é™¤äº†æ‰€æœ‰çš„æ ·æ¿ä»£ç (é™¤äº†ä»»ä½•`_Imports.razor`æ–‡ä»¶)ï¼Œä»`css`æ–‡ä»¶å¤¹å’Œ`sample-data`ä¸­åˆ é™¤äº†å¼•å¯¼ç¨‹åºã€‚ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªå®Œå…¨ç©ºçš„ Blazor é¡¹ç›®ã€‚

## [](#creating-our-layout)åˆ›å»ºæˆ‘ä»¬çš„å¸ƒå±€

æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ›å»º[å¸ƒå±€æ–‡ä»¶](https://docs.microsoft.com/en-gb/aspnet/core/blazor/layouts?view=aspnetcore-3.0&WT_mc.id=devto-blog-aapowell)ã€‚å’Œ ASP.NET MVC ä¸€æ ·ï¼ŒBlazor ä½¿ç”¨ä¸€ä¸ªå¸ƒå±€æ–‡ä»¶ä½œä¸ºæ‰€æœ‰é¡µé¢çš„åŸºç¡€æ¨¡æ¿(æ‰€æœ‰ä½¿ç”¨è¿™ä¸ªå¸ƒå±€çš„é¡µé¢ï¼Œä½ å¯ä»¥æœ‰å¤šä¸ªå¸ƒå±€)ã€‚å› æ­¤ï¼Œåœ¨`Shared`ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`MainLayout.razor`çš„æ–°æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†å®šä¹‰å®ƒã€‚é‰´äºæˆ‘ä»¬å¸Œæœ›å®ƒæ˜¯å…¨å±çš„ï¼Œè¿™å°†æ˜¯*éå¸¸ç®€å•* :

```
@inherits LayoutComponentBase

@Body 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªæ–‡ä»¶ç»§æ‰¿äº† Blazor ä¸ºå¸ƒå±€æä¾›çš„åŸºç±»ï¼Œ`LayoutComponentBase`,å®ƒè®©æˆ‘ä»¬å¯ä»¥è®¿é—®`@Body`å±æ€§ï¼Œè¿™ä¸ªå±æ€§å…è®¸æˆ‘ä»¬å°†é¡µé¢å†…å®¹æ”¾åœ¨ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„ HTML ä¸­ã€‚æˆ‘ä»¬ä¸éœ€è¦åœ¨å®ƒå‘¨å›´æ”¾ç½®ä»»ä½•ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨é¡µé¢ä¸­æ”¾ç½®`@Body`ã€‚

## [](#creating-our-offline-page)åˆ›å»ºæˆ‘ä»¬çš„ç¦»çº¿é¡µé¢

åˆ¶ä½œç¦»çº¿é¡µé¢çš„æ—¶é—´åˆ°äº†ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨`Pages`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå§‘ä¸”ç§°ä¹‹ä¸º`Offline.html` :

```
@page "/"

<h3>Offline</h3> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯æˆ‘ä»¬çš„èµ·ç‚¹ï¼Œé¦–å…ˆæˆ‘ä»¬æœ‰`@page`æŒ‡ä»¤ï¼Œå®ƒå‘Šè¯‰ Blazor è¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥å¯¼èˆªåˆ°çš„é¡µé¢ï¼Œå®ƒå°†å“åº”çš„ URL æ˜¯`"/"`ã€‚æˆ‘ä»¬æœ‰ä¸€äº›å ä½ç¬¦ HTML åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬å°†å–ä»£ä¸‹ä¸€æ­¥ã€‚

### [](#starting-the-canvas)å¯åŠ¨ç”»å¸ƒ

ç¦»çº¿é¡µé¢æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢ç»˜å›¾çš„å¤§ç”»å¸ƒï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå®ƒï¼Œè®©æˆ‘ä»¬ç”¨ç”»å¸ƒå…ƒç´ 
æ›´æ–°`Offline.razor`

```
@page "/"

<canvas></canvas> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#setting-the-canvas-size)è®¾ç½®ç”»å¸ƒå¤§å°

æˆ‘ä»¬éœ€è¦è®¾ç½®ç”»å¸ƒçš„å¤§å°ä¸ºå…¨å±ï¼Œç°åœ¨æ˜¯`0x0`ï¼Œä¸ç†æƒ³ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›è·å¾—æµè§ˆå™¨çš„`innerWidth`å’Œ`innerHeight`ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨ Blazor çš„ [JavaScript interop](https://docs.microsoft.com/en-gb/aspnet/core/blazor/javascript-interop?view=aspnetcore-3.0&WT_mc.id=devto-blog-aapowell) ã€‚

æˆ‘ä»¬å°†å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„ JavaScript æ–‡ä»¶è¿›è¡Œäº’æ“ä½œ(å°†å…¶å‘½åä¸º`helper.js`å¹¶å°†å…¶æ”¾å…¥`wwwroot`ï¼ŒåŒæ—¶æ›´æ–°`wwwroot`ä¸­çš„`index.html`ä»¥å¼•ç”¨å®ƒ):

```
window.getWindowSize = () => {
    return { height: window.innerHeight, width: window.innerWidth };
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª C# `struct`æ¥è¡¨ç¤ºè¿™äº›æ•°æ®(æˆ‘åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ·»åŠ äº†ä¸€ä¸ªåä¸º`WindowSize.cs`çš„æ–‡ä»¶):

```
namespace Blazor.DevToOffline
{
    public struct WindowSize
    {
        public long Height { get; set; }
        public long Width { get; set; }
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Blazor ç»„ä»¶ä¸­ä½¿ç”¨å®ƒ:

```
@page "/"
@inject IJSRuntime JsRuntime

<canvas height="@windowSize.Height" width="@windowSize.Width"></canvas>

@code {
    WindowSize windowSize;

    protected override async Task OnInitAsync()
    {
        windowSize = await JsRuntime.InvokeAsync<WindowSize>("getWindowSize");
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯æ·»åŠ çš„ä¸€ç‚¹ä»£ç ï¼Œè®©æˆ‘ä»¬æ¥åˆ†è§£å®ƒã€‚

```
@inject IJSRuntime JsRuntime 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨[ä¾èµ–æ³¨å…¥](https://docs.microsoft.com/en-gb/aspnet/core/blazor/dependency-injection?view=aspnetcore-3.0&WT_mc.id=devto-blog-aapowell)å°†`IJSRuntime`ä½œä¸ºä¸€ä¸ªåä¸º`JsRuntime`çš„å±æ€§æ³¨å…¥åˆ°æˆ‘ä»¬çš„ç»„ä»¶ä¸­ã€‚

```
<canvas height="@windowSize.Height" width="@windowSize.Width"></canvas> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æŠŠ`<canvas>`å…ƒç´ çš„`height`å’Œ`width`å±æ€§è®¾ç½®ä¸ºæˆ‘ä»¬çš„`struct` å®ä¾‹*å­—æ®µçš„å€¼ï¼Œè¯¥å®ä¾‹åä¸º`windowSize`ã€‚æ³¨æ„`@`å‰ç¼€ï¼Œè¿™å‘Šè¯‰ç¼–è¯‘å™¨è¿™æ˜¯æŒ‡ C#å˜é‡ï¼Œè€Œä¸æ˜¯é™æ€å­—ç¬¦ä¸²ã€‚* 

```
@code {
    WindowSize windowSize;

    protected override async Task OnInitAsync()
    {
        windowSize = await JsRuntime.InvokeAsync<WindowSize>("getWindowSize");
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»åœ¨ç»„ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªä»£ç å—ã€‚å®ƒåŒ…å«å˜é‡`windowSize`(è¯¥å˜é‡æœªåˆå§‹åŒ–ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªç»“æ„ï¼Œå› æ­¤å®ƒæœ‰ä¸€ä¸ªé»˜è®¤å€¼)ï¼Œç„¶åæˆ‘ä»¬è¦†ç›–ä¸€ä¸ª[ç”Ÿå‘½å‘¨æœŸæ–¹æ³•](https://docs.microsoft.com/en-gb/aspnet/core/blazor/components?view=aspnetcore-3.0&WT_mc.id=devto-blog-aapowell#lifecycle-methods)ï¼Œ`OnInitAsync`ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨ JavaScript æ¥è·å–çª—å£å¤§å°å¹¶å°†å…¶èµ‹ç»™æˆ‘ä»¬çš„å±€éƒ¨å˜é‡ã€‚

æ­å–œä½ ï¼Œä½ ç°åœ¨æœ‰ä¸€ä¸ªå…¨å±ç”»å¸ƒï¼ğŸ‰

## [](#wiring-up-events)æ¥çº¿èµ·äº‹ä»¶

æˆ‘ä»¬å¯èƒ½å·²ç»æ˜¾ç¤ºäº†ç”»å¸ƒï¼Œä½†æ˜¯å®ƒè¿˜æ²¡æœ‰åšä»»ä½•äº‹æƒ…ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬é€šè¿‡æ·»åŠ ä¸€äº›äº‹ä»¶å¤„ç†ç¨‹åºæ¥è§£å†³è¿™ä¸ªé—®é¢˜:

```
@page "/"
@inject IJSRuntime JsRuntime

<canvas height="@windowSize.Height"
        width="@windowSize.Width"
        @onmousedown="@StartPaint"
        @onmousemove="@Paint"
        @onmouseup="@StopPaint"
        @onmouseout="@StopPaint" />

@code {
    WindowSize windowSize;

    protected override async Task OnInitAsync()
    {
        windowSize = await JsRuntime.InvokeAsync<WindowSize>("getWindowSize");
    }

    private void StartPaint(UIMouseEventArgs e)
    {
    }

    private async Task Paint(UIMouseEventArgs e)
    {
    }

    private void StopPaint(UIMouseEventArgs e)
    {
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ä½ åœ¨ Blazor ä¸­ç»‘å®šäº‹ä»¶æ—¶ï¼Œä½ éœ€è¦ç»™äº‹ä»¶ååŠ ä¸Šå‰ç¼€`@`ï¼Œæ¯”å¦‚`@onmousedown`ï¼Œç„¶åæä¾›äº‹ä»¶å‘ç”Ÿæ—¶è¦è°ƒç”¨çš„å‡½æ•°åï¼Œæ¯”å¦‚`@StartPaint`ã€‚è¿™äº›å‡½æ•°çš„ç‰¹å¾æ˜¯è¿”å›ä¸€ä¸ª`void`æˆ–`Task`ï¼Œè¿™å–å†³äºå®ƒæ˜¯å¦æ˜¯å¼‚æ­¥çš„ã€‚è¯¥å‡½æ•°çš„å‚æ•°éœ€è¦æ˜¯é€‚å½“ç±»å‹çš„äº‹ä»¶å‚æ•°ï¼Œæ˜ å°„åˆ° DOM ç­‰ä»·ç‰©(`UIMouseEventArgs`ã€`UIKeyboardEventArgs`ç­‰)ã€‚).

*æ³¨æ„:å¦‚æœæ‚¨å°†å®ƒä¸ JavaScript å‚è€ƒå®ç°è¿›è¡Œæ¯”è¾ƒï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æˆ‘æ²¡æœ‰ä½¿ç”¨`touch`äº‹ä»¶ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨æˆ‘ä»Šå¤©çš„å®éªŒä¸­ï¼ŒBlazor ä¸­æœ‰ä¸€ä¸ªç»‘å®šè§¦æ‘¸äº‹ä»¶çš„ bugã€‚è®°ä½ï¼Œè¿™æ˜¯é¢„æ¼”ï¼*

## [](#getting-the-canvas-context)è·å–ç”»å¸ƒä¸Šä¸‹æ–‡

*æ³¨æ„:æˆ‘å°†è®¨è®ºå¦‚ä½•ä» Blazor è®¾ç½®ä¸`<canvas>`çš„äº¤äº’ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ æ›´å¯èƒ½æƒ³ä½¿ç”¨ [BlazorExtensions/Canvas](https://github.com/blazorExtensions/Canvas/) è€Œä¸æ˜¯ roll-you-ownã€‚*

å› ä¸ºæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç”»å¸ƒçš„ 2D ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¿é—®å®ƒã€‚ä½†é—®é¢˜æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ª JavaScript APIï¼Œè€Œæˆ‘ä»¬æ˜¯åœ¨ C#/WebAssembly ä¸­ï¼Œè¿™ä¼šæœ‰ç‚¹æœ‰è¶£ã€‚

æœ€ç»ˆï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ç”¨ JavaScript æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå¹¶ä¾èµ–äº Blazor çš„ JavaScript äº’æ“ä½œç‰¹æ€§ï¼Œå› æ­¤ä»ç„¶æ— æ³•é¿å…ç¼–å†™ä¸€äº› JavaScript ä»£ç ï¼

è®©æˆ‘ä»¬å†™ä¸€ä¸ªå°çš„ JavaScript æ¨¡å—æ¥ç»™æˆ‘ä»¬ä¸€ä¸ª API:

```
((window) => {
    let canvasContextCache = {};

    let getContext = (canvas) => {
        if (!canvasContextCache[canvas]) {
            canvasContextCache[canvas] = canvas.getContext('2d');
        }
        return canvasContextCache[canvas];
    };

    window.__blazorCanvasInterop = {
        drawLine: (canvas, sX, sY, eX, eY) => {
            let context = getContext(canvas);

            context.lineJoin = 'round';
            context.lineWidth = 5;
            context.beginPath();
            context.moveTo(eX, eY);
            context.lineTo(sX, sY);
            context.closePath();
            context.stroke();
        },

        setContextPropertyValue: (canvas, propertyName, propertyValue) => {
            let context = getContext(canvas);

            context[propertyName] = propertyValue;
        }
    };
})(window); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ç”¨ä¸€ä¸ªåŒ¿åè‡ªæ‰§è¡Œå‡½æ•°åˆ›å»ºçš„é—­åŒ…ä½œç”¨åŸŸæ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™æ ·æˆ‘ç”¨æ¥é¿å…ä¸æ–­è·å–ä¸Šä¸‹æ–‡çš„`canvasContextCache`å°±ä¸ä¼šæš´éœ²å‡ºæ¥ã€‚

è¯¥æ¨¡å—ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªåŠŸèƒ½ï¼Œç¬¬ä¸€ä¸ªæ˜¯åœ¨ç”»å¸ƒä¸Šçš„ä¸¤ç‚¹ä¹‹é—´ç”»ä¸€æ¡çº¿(æˆ‘ä»¬éœ€è¦å®ƒæ¥æ¶‚é¸¦ï¼)ç¬¬äºŒä¸ªæ›´æ–°äº†ä¸Šä¸‹æ–‡çš„ä¸€ä¸ªå±æ€§(æˆ‘ä»¬éœ€è¦å®ƒæ¥æ”¹å˜é¢œè‰²ï¼).

ä½ å¯èƒ½ä¹Ÿæ³¨æ„åˆ°äº†ï¼Œæˆ‘ä»æ¥æ²¡æœ‰è°ƒç”¨è¿‡`document.getElementById`ï¼Œæˆ‘åªæ˜¯ä»¥æŸç§æ–¹å¼â€œç¥å¥‡åœ°â€å¾—åˆ°äº†ç”»å¸ƒã€‚è¿™å¯ä»¥é€šè¿‡[æ•è· C#ä¸­çš„ç»„ä»¶å¼•ç”¨](https://docs.microsoft.com/en-gb/aspnet/core/blazor/components?view=aspnetcore-3.0&WT_mc.id=devto-blog-aapowell#capture-references-to-components)å¹¶ä¼ é€’è¯¥å¼•ç”¨æ¥å®ç°ã€‚

ä½†è¿™ä»ç„¶éƒ½æ˜¯ JavaScriptï¼Œæˆ‘ä»¬ç”¨ C#åšä»€ä¹ˆï¼Ÿæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª C#åŒ…è£…ç±»ï¼

```
public class Canvas2DContext
{
    private readonly IJSRuntime jsRuntime;
    private readonly ElementRef canvasRef;

    public Canvas2DContext(IJSRuntime jsRuntime, ElementRef canvasRef)
    {
        this.jsRuntime = jsRuntime;
        this.canvasRef = canvasRef;
    }

    public async Task DrawLine(long startX, long startY, long endX, long endY)
    {
        await jsRuntime.InvokeAsync<object>("__blazorCanvasInterop.drawLine", canvasRef, startX, startY, endX, endY);
    }

    public async Task SetStrokeStyleAsync(string strokeStyle)
    {
        await jsRuntime.InvokeAsync<object>("__blazorCanvasInterop.setContextPropertyValue", canvasRef, "strokeStyle", strokeStyle);
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯ä¸€ä¸ªé€šç”¨ç±»ï¼Œå®ƒæ¥å—æ•è·çš„å¼•ç”¨å’Œ JavaScript interop APIï¼Œåªæ˜¯ç»™äº†æˆ‘ä»¬ä¸€ä¸ªæ›´å¥½çš„ç¼–ç¨‹æ¥å£ã€‚

## [](#wiring-up-our-context)ä¸²èµ·æˆ‘ä»¬çš„è„‰ç»œ

æˆ‘ä»¬ç°åœ¨å¯ä»¥è¿æ¥ä¸Šä¸‹æ–‡ï¼Œå‡†å¤‡åœ¨ç”»å¸ƒä¸Šç”»çº¿:

```
@page "/"
@inject IJSRuntime JsRuntime

<canvas height="@windowSize.Height"
        width="@windowSize.Width"
        @onmousedown="@StartPaint"
        @onmousemove="@Paint"
        @onmouseup="@StopPaint"
        @onmouseout="@StopPaint"
        @ref="@canvas" />

@code {
    ElementRef canvas;

    WindowSize windowSize;

    Canvas2DContext ctx;
    protected override async Task OnInitAsync()
    {
        windowSize = await JsRuntime.InvokeAsync<WindowSize>("getWindowSize");
        ctx = new Canvas2DContext(JsRuntime, canvas);
    }

    private void StartPaint(UIMouseEventArgs e)
    {
    }

    private async Task Paint(UIMouseEventArgs e)
    {
    }

    private void StopPaint(UIMouseEventArgs e)
    {
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€šè¿‡å°†`@ref="@canvas"`æ·»åŠ åˆ°æˆ‘ä»¬çš„`<canvas>`å…ƒç´ ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†æˆ‘ä»¬éœ€è¦çš„å¼•ç”¨ï¼Œç„¶ååœ¨`OnInitAsync`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†æˆ‘ä»¬å°†ä½¿ç”¨çš„`Canvas2DContext`ã€‚

## [](#drawing-on-the-canvas)åœ¨ç”»å¸ƒä¸Šç”»ç”»

æˆ‘ä»¬ç»ˆäºå‡†å¤‡å¥½åœ¨ç”»å¸ƒä¸Šç”»ç”»äº†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å®ç°è¿™äº›äº‹ä»¶å¤„ç†ç¨‹åº:

```
 bool isPainting = false;
    long x;
    long y;
    private void StartPaint(UIMouseEventArgs e)
    {
        x = e.ClientX;
        y = e.ClientY;
        isPainting = true;
    }

    private async Task Paint(UIMouseEventArgs e)
    {
        if (isPainting)
        {
            var eX = e.ClientX;
            var eY = e.ClientY;

            await ctx.DrawLine(x, y, eX, eY);
            x = eX;
            y = eY;
        }
    }

    private void StopPaint(UIMouseEventArgs e)
    {
        isPainting = false;
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸å¯å¦è®¤ï¼Œè¿™äº›ä¸ JavaScript å®ç°æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œå®ƒä»¬æ‰€è¦åšçš„å°±æ˜¯ä»é¼ æ ‡äº‹ä»¶ä¸­è·å–åæ ‡ï¼Œç„¶åå°†å®ƒä»¬ä¼ é€’ç»™ç”»å¸ƒä¸Šä¸‹æ–‡åŒ…è£…å™¨ï¼Œç”»å¸ƒä¸Šä¸‹æ–‡åŒ…è£…å™¨è¿›è€Œè°ƒç”¨é€‚å½“çš„ JavaScript å‡½æ•°ã€‚

## [](#conclusion)ç»“è®º

ğŸ‰æˆ‘ä»¬å®Œäº†ï¼ä½ å¯ä»¥çœ‹åˆ°å®ƒåœ¨è¿™é‡Œè¿è¡Œï¼Œä»£ç åœ¨ GitHub ä¸Šã€‚

## ![GitHub logo](../Images/292a238c61c5611a7f4d07a21d9e8e0a.png)[aaronpowell](https://github.com/aaronpowell)/[blazor-devto-offline](https://github.com/aaronpowell/blazor-devto-offline)

### å¦‚ä½•ä½¿ç”¨ Blazor åˆ›å»º DEV.to çš„ç¦»çº¿é¡µé¢çš„æ¼”ç¤º

<article class="markdown-body entry-content container-lg" itemprop="text">

è¿™ä¸ªåº“åŒ…å«äº†ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨ [Blazor](https://dotnet.microsoft.com/apps/aspnet/web-apps/client?WT_mc.id=blazordevtooffline-github-aapowell) åˆ›å»º [DEV.to](https://dev.to) [ç¦»çº¿é¡µé¢](https://dev.to/offline)çš„ä¾‹å­ã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å®ƒçš„èº«å½±[https://blazordevtooffline.z23.web.core.windows.net/](https://blazordevtooffline.z23.web.core.windows.net/)ã€‚

</article>

[View on GitHub](https://github.com/aaronpowell/blazor-devto-offline)

è¿™æ˜¯å¯¹ Blazor çš„ä¸€ä¸ªå¿«é€Ÿæµè§ˆï¼Œä½†æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨ä¸€ä¸ªåœºæ™¯ä¸­ä½¿ç”¨ Blazorï¼Œè¿™ä¸ªåœºæ™¯å¯èƒ½éœ€è¦æˆ‘ä»¬ç”¨ JavaScript åšæ›´å¤šçš„äº’æ“ä½œï¼Œè¿™æ˜¯è®¸å¤šåœºæ™¯éƒ½éœ€è¦çš„ã€‚

æˆ‘å¸Œæœ›ä½ å–œæ¬¢å®ƒï¼Œå¹¶å‡†å¤‡å¥½å¤„ç†è‡ªå·±çš„ Blazor å®éªŒï¼

## [](#bonus-the-colour-picker)å¥–é‡‘ï¼Œæ‹¾è‰²å™¨

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æœ‰ä¸€ä»¶äº‹æˆ‘ä»¬æ²¡æœ‰åšï¼Œé‚£å°±æ˜¯å®ç°é¢œè‰²é€‰æ‹©å™¨ï¼

æˆ‘æƒ³ä½œä¸ºä¸€ä¸ªé€šç”¨ç»„ä»¶è¿™æ ·åšï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·åš:

```
<ColourPicker OnClick="@SetStrokeColour"
              Colours="@colours" /> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ä¸€ä¸ªåä¸º`ColourPicker.razor`(æ–‡ä»¶åå¾ˆé‡è¦ï¼Œå› ä¸ºè¿™æ˜¯ç»„ä»¶çš„åç§°)çš„æ–°æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºç»„ä»¶:

```
<div class="colours">
    @foreach (var colour in Colours)
    {
        <button class="colour"
                @onclick="@OnClick(colour)"
                @key="@colour">
        </button>
    }
</div>

@code {
    [Parameter]
    public Func<string, Action<UIMouseEventArgs>> OnClick { get; set; }

    [Parameter]
    public IEnumerable<string> Colours { get; set; }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬çš„ç»„ä»¶å°†æœ‰ 2 ä¸ªå‚æ•°ï¼Œå¯ä»¥ä»çˆ¶è®¾ç½®ï¼Œé¢œè‰²çš„é›†åˆå’Œå½“ä½ ç‚¹å‡»æŒ‰é’®æ—¶è°ƒç”¨çš„å‡½æ•°ã€‚æˆ‘åšçš„äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯è¿™æ ·çš„ï¼Œä½ ä¼ å…¥ä¸€ä¸ªè¿”å›åŠ¨ä½œçš„*å‡½æ•°ï¼Œæ‰€ä»¥å½“`<button>`å…ƒç´ è¢«åˆ›å»ºæ—¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€œç»‘å®šâ€åˆ°é¢œè‰²åç§°çš„å•ä¸€å‡½æ•°ã€‚*

è¿™æ„å‘³ç€æˆ‘ä»¬æœ‰è¿™æ ·çš„ç”¨æ³•:

```
@page "/"
@inject IJSRuntime JsRuntime

<ColourPicker OnClick="@SetStrokeColour"
              Colours="@colours" />

// snip

@code {
    IEnumerable<string> colours = new[] { "#F4908E", "#F2F097", "#88B0DC", "#F7B5D1", "#53C4AF", "#FDE38C" };

    // snip

    private Action<UIMouseEventArgs> SetStrokeColour(string colour)
    {
        return async _ =>
        {
            await ctx.SetStrokeStyleAsync(colour);
        };
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå¦‚æœä½ ç‚¹å‡»é¡¶éƒ¨çš„é¢œè‰²é€‰æ‹©å™¨ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªä¸åŒé¢œè‰²çš„ç¬”ã€‚

æ¶‚é¸¦å¿«ä¹ï¼