# ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ç±»ç»„ä»¶çš„æ„é€ å‡½æ•°ä¸­ç»‘å®šæ–¹æ³•ï¼Ÿ

> åŸæ–‡:[https://dev . to/aman _ Singh/why-do-we-need-to-bind-methods-inside-our-class-component-s-constructor-45bn](https://dev.to/aman_singh/why-do-we-need-to-bind-methods-inside-our-class-component-s-constructor-45bn)

å¦‚æœæˆ‘ä»¬å›åˆ°[é’©å­](https://reactjs.org/docs/hooks-intro.html)è¿˜æ²¡æœ‰è¯ç”Ÿçš„æ—¶ä»£ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ª React ç±»[ç»„ä»¶](https://reactjs.org/docs/components-and-props.html#function-and-class-components)æ—¶ï¼Œå°†ä¸å¯é¿å…åœ°é‡åˆ°è¿™æ®µä»£ç ã€‚

```
class MyClassComponent extends React.Component {
  constructor(props) {
    super(props);

    // Assuming that you need to pass this as a prop to one of a child component
    this.someMethod = this.someMethod.bind(this); // But why? ğŸ¤”
  }
 ... 
} 
```

è¿™æ˜¯å› ä¸ºæ¯å½“åœ¨ä¸€ä¸ªç±»ç»„ä»¶å†…éƒ¨ï¼Œå½“æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºé“å…·ä¼ é€’ç»™å­ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æ‰§è¡Œä»¥ä¸‹æ“ä½œä¹‹ä¸€:

*   å°†å…¶ç»‘å®šåˆ°æ„é€ å‡½æ•°ä¸­ã€‚
*   å†…è”ç»‘å®šå®ƒ(è¿™å¯èƒ½ä¼šæœ‰ä¸€äº›æ€§èƒ½é—®é¢˜)ã€‚
*   ä½¿ç”¨ [*ç®­å¤´å‡½æ•°*](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions) (ä¸ [*å±æ€§åˆå§‹åŒ–å™¨*](https://babeljs.io/docs/en/babel-plugin-proposal-class-properties) è¯­æ³•ç›¸åŒ)ã€‚

ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åšè¿™é¡¹é¢å¤–çš„å·¥ä½œï¼Ÿ

é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å°†é¦–å…ˆå°è¯•è§£é‡Šæ„é€ å‡½æ•°å†…éƒ¨çš„ç»‘å®šã€‚ä¸€æ—¦æˆ‘ä»¬è·å¾—äº†è¿™äº›çŸ¥è¯†ï¼Œæˆ‘ä»¬å°†è¯•å›¾å›ç­”ä¸ºä»€ä¹ˆç®­å¤´å‡½æ•°ä¸éµå¾ªåŒæ ·çš„ä»ªå¼ã€‚

æˆ‘ä»¬éœ€è¦çŸ¥é“çš„ä¸€ç‚¹æ˜¯ï¼Œæ„é€ å‡½æ•°ä¸­çš„ç»‘å®šä¸ React æ— å…³ã€‚çº¯ç²¹å’Œ JavaScript å¦‚ä½•å®ç°**è¿™ä¸ª**æœ‰å…³ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ä»£ç :

```
var x = 10;
let foo = {
  x: 90,
  getX: function() {
    return this.x;
  }
};

foo.getX(); // prints 90

let xGetter = foo.getX;

xGetter(); // prints 10; 
```

å½“æˆ‘ä»¬å°† *x* åˆå§‹åŒ–ä¸ºå…¨å±€èŒƒå›´æ—¶ï¼Œå®ƒå°±æˆä¸ºäº†*çª—å£*å¯¹è±¡çš„å±æ€§(å‡è®¾æ˜¯æµè§ˆå™¨ç¯å¢ƒè€Œä¸æ˜¯ä¸¥æ ¼æ¨¡å¼)ã€‚æˆ‘ä»¬å¯ä»¥æ–­è¨€:

```
window.x === 10; // true 
```

**è¿™ä¸ª**å°†æ€»æ˜¯æŒ‡å‘è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œåœ¨ *foo.getX()* ï¼Œ**è¿™ä¸ª**æŒ‡å‘ *foo* å¯¹è±¡è¿”å›æˆ‘ä»¬çš„å€¼ 90ã€‚è€Œåœ¨ *xGetter()* ï¼Œ**çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ª**æŒ‡å‘*çª—å£*å¯¹è±¡ï¼Œè¿”å›ç»™æˆ‘ä»¬å€¼ 10ã€‚

ä¸ºäº†æ£€ç´¢ *foo.x* çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ [Function.prototype.bind](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_objects/Function/bind) å°† **this** çš„å€¼ç»‘å®šåˆ° *foo* å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚

```
let getFooX = foo.getX.bind(foo);
getFooX(); // prints 90 
```

æœ‰äº†è¿™äº›çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬è¯•ç€ç†è§£å½“æ‚¨å°†ä¸€ä¸ªå‡½æ•° prop ä¼ é€’ç»™å­ç»„ä»¶æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

åœ¨ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿçš„*ç±»*ç»„ä»¶æ¥æ¨¡ä»¿ React ç»„ä»¶å¿ƒç†æ¨¡å‹ã€‚åœ¨*æ¸²æŸ“*å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ªæ™®é€šçš„ JS å¯¹è±¡ï¼Œå®ƒæœ‰ä¸€ä¸ªåä¸º*â€˜onClickâ€™*çš„åŠŸèƒ½å±æ€§ã€‚

> [React å…ƒç´ ](https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html#elements-describe-the-tree)åªæ˜¯ä¸€ä¸ªä¸å¯å˜çš„æè¿°å¯¹è±¡ï¼Œå¸¦æœ‰
> ä¸¤ä¸ªå­—æ®µ:type: (string | ReactClass)å’Œ props: Object

```
class Component {
  constructor() {
    this.state = 10;
    this.setState = function() {
      console.log('state');
    };
  }

  handleClick() {
    this.setState();
  }

  render() {
    // return a child component.
    return {
      type: 'button',
      props: {
        // pass functional props
        onClick: this.handleClick,
        children: 'Click Me'
      }
    };
  }
}

// 1\. creating a component instance
const componentInstance = new Component();

// 2\. calling a render method on the instance
// ( In reality, React does the same thing for your class components)
const element = componentInstance.render();

// 3\. calling the onClick function, which was passed as a  prop,
// will throw a 'TypeError: this.setState is not a function'.
element.props.onClick(); 
```

è¿™ä¸ª TypeError ç°åœ¨å¾ˆæ˜æ˜¾ï¼Œå› ä¸ºå®ƒæŒ‡å‘äº†ä¸çŸ¥é“ä»»ä½• setState å‡½æ•°å­˜åœ¨çš„ *props* å¯¹è±¡ã€‚ *setState* å‡½æ•°åªæ˜¯ *componentInstance* çš„ä¸€ä¸ªå±æ€§ã€‚

æ‰€ä»¥ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ„é€ å‡½æ•°ä¸­ç»‘å®š handleClick å‡½æ•°:

```
// inside constructor function
constructor() {
  // bind returns a new function
  this.handleClick = this.handleClick.bind(this);
}

...

// calling onClick will print 'state' this time.
element.props.onClick(); 
```

ç°åœ¨ï¼Œ**è¿™ä¸ª**çš„å€¼å°†å§‹ç»ˆæŒ‡å‘ *componentInstance* ï¼Œè¯¥å®ä¾‹å°† *setState* ä½œä¸ºå…¶å±æ€§ä¹‹ä¸€ï¼Œå¹¶ä¸”ä¸ä¼šæŠ›å‡ºä»»ä½•ç±»å‹é”™è¯¯ã€‚

* * *

è¿™å°±æ˜¯æˆ‘ä»¬ç¬¬ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚åˆ°ç›®å‰ä¸ºæ­¢è¿›å±•ä¸é”™ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å°è¯•æ‰¾å‡ºç¬¬äºŒä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚

çœ‹ä¸‹é¢çš„ä»£ç :

```
let bar = { someMethod: function() { return this; } };

bar.someMethod(); // print {someMethod: f}

let foo = { someMethod: () => this};

foo.someMethod(); // prints global 'window' object 
```

æ˜¾ç¤ºç®­å¤´å‡½æ•°æœ¬èº«æ²¡æœ‰è¿™ä¸ªã€‚å®ƒæ€»æ˜¯ç”±åˆ›å»ºæ—¶ arrow å‡½æ•°å‘¨å›´çš„ä½œç”¨åŸŸå†³å®šã€‚

> ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„è¿™ä¸ªã€‚

å½“æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ç±»ä¸­ä½¿ç”¨ä¸€ä¸ª*ç®­å¤´*å‡½æ•°æ—¶(ä½¿ç”¨[å±æ€§åˆå§‹åŒ–å™¨](https://babeljs.io/docs/en/babel-plugin-proposal-class-properties)ç‰¹æ€§)ï¼Œå®ƒæˆä¸ºå®ä¾‹çš„æ–¹æ³•å±æ€§ã€‚ç”±äº**è¿™ä¸ª**æ€»æ˜¯ç”±å¤–éƒ¨ä½œç”¨åŸŸå†³å®šï¼Œå®ƒå°†æŒ‡å‘ç±»çš„*å®ä¾‹*ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®é™…æƒ…å†µ:

```
class Component {
  constructor() {
    this.state = 10;
    this.setState = function() {
      console.log('state');
    };
  }

  // using fat arrow function; no binding require inside constructor
  handleClick = () => {
    // this will now point to the instance of Component class which knows about the setState method property
    this.setState();
  };

  render() {
    // return a child component.
    return {
      type: 'button',
      props: {
        // pass functional props
        onClick: this.handleClick,
        children: 'Click Me'
      }
    };
  }
}
// 1\. creating a component instance
const componenttInstance = new Component();

//  2\. calling a render method on the instance ( In reality, React does the same thing for your class components)

const element = componenttInstance.render();

// 3\. calling onClick will now print 'state' to the console.
element.props.onClick(); 
```

æˆ‘å¸Œæœ›ä½ å–œæ¬¢é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼Œç°åœ¨èƒ½å¤Ÿè‡ªä¿¡åœ°å›ç­”è¿™ä¸ªé—®é¢˜ã€‚æˆ‘å¼ºçƒˆæ¨èé˜…è¯»è¿™ç¯‡ç”±[é˜¿å…‹å¡å°”Â·åŠ³æ–½è¿ˆå°”](https://twitter.com/rauschma)åšå£«æ’°å†™çš„[æ–‡ç« ](http://2ality.com/2017/12/alternate-this.html)ï¼Œä»¥è·å¾—å…³äº`this`å¦‚ä½•å·¥ä½œçš„æ›´è¯¦ç»†çš„æè¿°ã€‚

æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œå¦‚æœæ‚¨å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œâ¤ï¸ä¸€å®šä¼šè®©æˆ‘ç¬‘é€é¢œå¼€ğŸ˜ã€‚