# åœ¨æµè§ˆå™¨ä¸­æ“ä½œæ–‡ä»¶

> åŸæ–‡ï¼š<https://dev.to/kitanga_nday/manipulating-files-in-the-browser-2l22>

æˆ‘å·²ç»æƒ³å†™ä¸€ä¸ªæ•™ç¨‹æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæ‰€ä»¥æˆ‘æƒ³æœ‰ä»€ä¹ˆæ¯”å†™ä¸€ä¸ªå‡ ä¹è®©æˆ‘é•¿å‡ºç™½å‘çš„è¯é¢˜æ›´å¥½çš„æ–¹å¼æ¥å‘å¸–ã€‚

ç°åœ¨ï¼Œè¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•™ç¨‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¸ªäººå®éªŒï¼Œçœ‹çœ‹æˆ‘æ˜¯å¦èƒ½å®Œæˆè¿™ä¸ªç®€å•çš„ä»»åŠ¡ï¼Œå¹¶å¸Œæœ›æ•™ä½ ä¸€äº›æˆ‘åœ¨å°è¯•è¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚

æ— è®ºå¦‚ä½•ï¼Œä¸ºäº†è®©æ‚¨å­¦ä¹ å¦‚ä½•è¯»å–ã€å†™å…¥å’Œè§£æè‡ªå®šä¹‰æ–‡ä»¶æ ¼å¼ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª pack æ–‡ä»¶:ä¸€ä¸ªåŒ…å«ä¸åŒæ–‡ä»¶çš„æ–‡ä»¶(æƒ³æƒ³æ²¡æœ‰å‹ç¼©æ­¥éª¤çš„ ZIP æ–‡ä»¶)ã€‚è¿™åœ¨ web ä¸Šéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºæ‚¨å¸Œæœ›å‘æœåŠ¡å™¨å‘å‡ºå°½å¯èƒ½å°‘çš„è¯·æ±‚ã€‚ä¸è¿‡ï¼Œå¦‚æœæˆ‘æ²¡è®°é”™çš„è¯ï¼ŒHTTP/2 åº”è¯¥å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜(å‰§é€:æ˜¯çš„ï¼Œå®ƒè§£å†³äº†ã€‚[ç°åœ¨å¯ä»¥å¼‚æ­¥è¯·æ±‚æ–‡ä»¶äº†](https://medium.com/@factoryhr/http-2-the-difference-between-http-1-1-benefits-and-how-to-use-it-38094fa0e95b)ã€‚

æˆ‘ä»¬çš„åŒ…æ–‡ä»¶åŒ…å«**å›¾åƒ** (PNG)å’Œ**éŸ³é¢‘** (OGG)æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬è¿æ¥æˆä¸€ä¸ªæ–‡ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨ä½ å–œæ¬¢çš„ä»»ä½•å…¶ä»–æ–‡ä»¶ç±»å‹(ä¾‹å¦‚ï¼Œç”¨ MP3 æ›¿æ¢ OGG)ã€‚

## å¯¹ç€å¼ é£

ç°åœ¨å¯¹äºè¿™ä¸ªæ¼”ç¤ºï¼Œæˆ‘å°†ä½¿ç”¨ [Codepen](https://codepen.io/pen) ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ è§‰å¾—èˆ’æœçš„ç¯å¢ƒï¼Œåªè¦ä½ èƒ½è·Ÿä¸Šã€‚å¦‚æœä½ è¿·è·¯äº†ï¼Œä½ å¯ä»¥çœ‹çœ‹æˆ‘çš„ç¬”[è¿™é‡Œ](https://codepen.io/kitanga/pen/LYPNXEG)æ¥è·Ÿä¸Šã€‚

### HTML/CSS

ä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªæ¥å—å¤šä¸ªæ–‡ä»¶çš„æ–‡ä»¶è¾“å…¥å…ƒç´ ï¼Œä½†ä»…é™äº PNG å’Œ OGG æ–‡ä»¶ï¼Œä¸€ä¸ªç”¨äºå°†æ‰€é€‰æ–‡ä»¶æ·»åŠ åˆ°ä¸´æ—¶â€œå­˜å‚¨â€ä¸­çš„æ·»åŠ æŒ‰é’®ï¼Œä»¥åŠä¸€ä¸ªç”¨äºå¯åŠ¨æ•´ä¸ªæ‰“åŒ…è¿‡ç¨‹çš„ä¸‹è½½æŒ‰é’®ã€‚

```
<div id="wrapper">
    <input type="file" accept=".png, .ogg" multiple>
    <div><button id="download">Download</button></div>
    <button type="button" id="add">Add</button>
</div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é™¤äº†åŸºæœ¬çš„è®¾ç½®é£æ ¼ï¼Œæˆ‘ä»¬çš„ CSS å°†ä¸»è¦ä½¿ç”¨ flexbox æ°´å¹³å±…ä¸­è¾“å…¥å…ƒç´ ã€‚

```
* {
   box-sizing: border-box;
}

html, body, #wrapper {
   width: 100%;
   height: 100%;
   margin: 0;
   padding: 0;
   overflow: hidden;
}

#wrapper {
   padding-top: 1%;
   padding-left: 10%;
   padding-right: 10%;
   display: flex;
   justify-content: center;
   flex-wrap: wrap;
}

#wrapper>* {
   flex-grow: 1;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### ç°åœ¨ä¸ºä¸€äº› JavaScript

é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä¸º add æŒ‰é’®åˆ›å»ºä¸€ä¸ª`onclick`äº‹ä»¶ç›‘å¬å™¨ï¼Œå°†æ–‡ä»¶ååŠå…¶å¤§å°æ·»åŠ åˆ°é¡µé¢ä¸­ã€‚å®ƒè¿˜å°†å®ƒä»¬æ·»åŠ åˆ°æˆ‘ä»¬çš„â€œstoreâ€å˜é‡ä¸­ï¼Œç°åœ¨æˆ‘ä»¬ç§°ä¹‹ä¸º`files`ã€‚

```
const VERSION = 1;

// Get ref to the input and the files display elements.
const input = document.querySelector('input');
const filesContainer = document.querySelector('.files');
const addBtn = document.getElementById('add');
const download = document.getElementById("download");
// We'll use this to download the file
const anchor = document.createElement('a');

// We'll store files here
let files = [];

addBtn.onclick = () => {
   // Disable the file uploader and add button
   input.disabled = true;
   addBtn.innerText = "...";
   addBtn.disabled = true;

   // Convert files list to an array
   const selectedFiles = Array.prototype.slice.call(input.files);

   if (selectedFiles.length) {
      // Clear the files list on screen
      filesContainer.innerHTML = "";

      // We'll run this each time a file is done processing
      let count = selectedFiles.length;
      const callback = () => {
         // If our count is zero then we are done
         if (!--count) {
            // Enable the file uploader and add button
            input.disabled = false;
            addBtn.innerText = "Add";
            addBtn.disabled = false;
         }
      };

      // Add into files array
      selectedFiles.forEach(_file => {
         // We need to get the byte array of the file first
         _file.arrayBuffer().then(buffer => {
            let file = {
               name: _file.name,
               size: _file.size,
               type: _file.type,
               buffer
            };
            files.push(file);

            // Add files to the page
            filesContainer.innerHTML += `<div>${file.name}  ${Math.round(
               file.size / 1024
            )}kb</div>`;
            callback();
         });
      });
   }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»£ç æ³¨é‡Šéå¸¸ç®€å•æ˜äº†ï¼Œæˆ‘åªè¦æ±‚æ‚¨å¯†åˆ‡å…³æ³¨`VERSION`å¸¸é‡å’Œ`anchor`å…ƒç´ ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨åé¢çš„`HEADER`åˆ›å»ºä¸­ä»¥åŠå½“æˆ‘ä»¬æƒ³è¦è§£ææ–‡ä»¶æ—¶ä½¿ç”¨å®ƒä»¬ã€‚

æˆ‘ç¡®å®è®¤ä¸ºåœ¨å†…å­˜ä¸­ä¿å­˜æ¯ä¸ªæ–‡ä»¶çš„å­—èŠ‚æ•°ç»„(ä¹Ÿç§°ä¸º ArrayBuffer)å¯èƒ½ä¸å¥½ï¼Œä½†æ˜¯ï¼Œå˜¿ï¼Œè°ä¼šæŠ±æ€¨å‘¢ï¼Œå¯¹å—ï¼Ÿ

å¿«é€Ÿæç¤º:æˆ‘åœ¨ Codepen ä¸­ä½¿ç”¨ Babel æ—¶é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘å…³é—­äº†å®ƒï¼Œå¼€å§‹ç¼–å†™æ›´å…·é˜²å¾¡æ€§çš„ä»£ç (å³ä½¿ç”¨æ›´å¤šçš„ ES5 æŠ€æœ¯)ã€‚æˆ‘çŸ¥é“ä½ ä»¬ä¸­çš„å¤§å¤šæ•°äººå¯èƒ½æ²¡æœ‰æ‰“å¼€å·´åˆ«å¡”ä¼ è¾“ï¼Œä½†æ˜¯å¯¹äºé‚£äº›æ‰“å¼€çš„äººæ¥è¯´ï¼Œè¿™åªæ˜¯ä¸€ä¸ªè­¦å‘Šã€‚

ç°åœ¨æ‚¨åº”è¯¥å·²ç»åœ¨ä»£ç ä¸­çœ‹åˆ°äº†ä¸€ä¸ª`filesContainer`å¸¸é‡ã€‚è¿™æ˜¯å¯¹æˆ‘ä»¬å°†è¦æ·»åŠ çš„ HTML çš„å¼•ç”¨:

```
<div id="wrapper">
    <input type="file" accept=".png, .ogg" multiple>
    <div><button id="download">Download</button></div>
    <button type="button" id="add">Add</button>
    <div class="files"></div>
</div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è€Œä¸”æ˜¯ CSS

```
/* ...previous styles... */

.files {
   width: 100%;
   height: 100%;
   padding-top: 1%;
   text-align: center;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™åªæ˜¯ä¸ºäº†åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæ–‡ä»¶ã€‚

### æˆ‘ä»¬æ¥è°ˆè°ˆæ–‡ä»¶æ ¼å¼è®¾è®¡

åœ¨æˆ‘ä»¬ç»§ç»­åˆ›å»ºæ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡æ–‡ä»¶çš„ç»“æ„ã€‚è¿™éœ€è¦ä½ ç†è§£ä¸¤ä»¶äº‹:**åŸè¯­**å’Œ**ç»“æ„åŒ–**æ•°æ®ç±»å‹æ˜¯ã€‚

åŸå§‹æ•°æ®ç±»å‹ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§*æ ‡å‡†*,ç”¨äºæŒ‡å®šä¸€ä¸ªå±æ€§å ç”¨å¤šå°‘ä½(ç¨åä¼šè¯¦ç»†ä»‹ç»)ã€‚æ—¢ç„¶æˆ‘ä»¬çŸ¥é“è®¡ç®—æœºæ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½å·¥ä½œçš„ï¼Œé‚£ä¹ˆ 1 å­—èŠ‚(å³ 8 ä½)å°†æ˜¯æˆ‘ä»¬æœ€å°çš„åŸè¯­ã€‚ç°åœ¨è¿™äº›å­—èŠ‚æœ‰ä¸¤ç§å½¢å¼:å®ƒä»¬å¯ä»¥æ˜¯æœ‰ç¬¦å·çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ— ç¬¦å·çš„ã€‚æœ‰ç¬¦å·æ„å‘³ç€æˆ‘ä»¬çš„å­—èŠ‚å¯ä»¥ä»£è¡¨ä¸€ä¸ªæ­£æ•°æˆ–è´Ÿæ•°ã€‚æ— ç¬¦å·è¡¨ç¤ºéƒ½æ˜¯æ­£æ•°ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åªä½¿ç”¨æ— ç¬¦å·å­—èŠ‚ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦è´Ÿæ•°ã€‚ä¸‹é¢æ˜¯ä¸€äº›æ•°æ®ç±»å‹çš„åˆ—è¡¨ï¼Œå¯ä»¥è®©ä½ æ›´å¥½åœ°ç†è§£æˆ‘æ‰€è¯´çš„å†…å®¹:

[![List of primitive types](img/8abab3efb578ccf6f426b5557cfffdcd.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--x9itcQSm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.tutsplus.com/gamedev/uploads/legacy/009_binaryFileFormats/primitive_data_types.png)

è¯·åŠ¡å¿…è®°ä½ç¼©å†™ç‰ˆæœ¬(å³ U8 ä»£è¡¨æ— ç¬¦å· 8 ä½æ•´æ•°)ï¼Œå› ä¸ºæˆ‘å°†åœ¨æœ¬æ•™ç¨‹ä¸­å¤§é‡ä½¿ç”¨å®ƒä»¬ã€‚

å¦ä¸€æ–¹é¢ï¼Œç»“æ„åŒ–æ•°æ®ç±»å‹è¡¨ç¤ºæˆ‘ä»¬çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„å—ï¼Œç”±è®¾è®¡æ–‡æ¡£ä¸­çš„å±æ€§/ç‰¹æ€§æ‰€è¡¨ç¤ºçš„åŸå§‹æ•°æ®ç±»å‹ç»„æˆã€‚

```
// e.g
Structure {
    property   U16
    property2  U8
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› æ­¤ï¼Œä¸Šè¿°ç»“æ„æ€»å…±å°†å ç”¨ 24 ä½(16 + 8)æˆ– 3 ä¸ªå­—èŠ‚ï¼Œå‰ 16 ä½(2 ä¸ªå­—èŠ‚)å°†è¡¨ç¤ºå±æ€§`property`ï¼Œè€Œå‰©ä½™çš„ 8 ä½(1 ä¸ªå­—èŠ‚)å°†è¡¨ç¤ºå±æ€§`property2`ã€‚

å¥½å§ï¼å¼€å§‹è®¾è®¡è¿™ä¸ªä¸œè¥¿ã€‚

### æ‰“åŒ…æ–‡ä»¶æ ¼å¼è®¾è®¡

`PACK`æ–‡ä»¶å°†æœ‰ä¸€ä¸ª`HEADER`å’Œä¸€ä¸ª`FILE`åˆ—è¡¨

```
PACK {
    header     HEADER
    files      FILE[HEADER.count]
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`HEADER`å°†ä¿å­˜æ‰“åŒ…ç¨‹åºçš„ç‰ˆæœ¬å·ä»¥åŠåŒ…ä¸­æœ‰å¤šå°‘æ–‡ä»¶çš„ä¿¡æ¯ã€‚

```
HEADER {
    version    U8
    count      U8
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`FILE`ç»“æ„å°†ä»¥å­—èŠ‚ä¸ºå•ä½ä¿å­˜æ–‡ä»¶ç±»å‹å’Œé•¿åº¦çš„ä¿¡æ¯ã€‚

```
FILE {
    type       U24
    length     U32
    data       [length]
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å±æ€§(prop)æ˜¯ä¸€ä¸ª 3 å­—ç¬¦çš„ ASCII ç å­—ç¬¦ä¸²ï¼Œå®ƒå°†é€šçŸ¥è§£æå™¨è¿™æ˜¯ä»€ä¹ˆæ–‡ä»¶ã€‚ç›®å‰ï¼Œç±»å‹å¯ä»¥æ˜¯ä¸¤ç§æƒ…å†µä¹‹ä¸€:â€œIMGâ€æˆ–â€œæ¾³å¤§åˆ©äºšâ€ã€‚å¦ä¸€æ–¹é¢ï¼Œ`length`åªæ˜¯å‘Šè¯‰æˆ‘ä»¬æ–‡ä»¶æœ‰å¤šé•¿ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚è€Œ`data`å±æ€§ä¿å­˜æ–‡ä»¶çš„å­—èŠ‚ã€‚

### æ‰“åŒ…æ–‡ä»¶å®ç°

ç°åœ¨æˆ‘ä»¬æœ‰äº†è‡ªå·±çš„è®¾è®¡ï¼Œè®©æˆ‘ä»¬ç»§ç»­å®ç°æˆ‘ä»¬çš„å¤´æ–‡ä»¶å¹¶æ·»åŠ æ‰“åŒ…çš„æ–‡ä»¶ã€‚

ä½†æ˜¯ï¼Œåœ¨æˆ‘ä»¬åšä»»ä½•å…¶ä»–äº‹æƒ…ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è°ˆè°ˆç±»å‹ã€‚æˆ‘è¯´çš„â€œè°ˆè®ºâ€æ˜¯æŒ‡ä½ å¿…é¡»å»é˜…è¯»å®ƒï¼Œå› ä¸ºæˆ‘åœ¨è¿™é‡Œè§£é‡Šå®ƒè‚¯å®šä¼šä½¿è¿™ç¯‡æ–‡ç« è†¨èƒ€èµ·æ¥ã€‚é—æ†¾çš„ğŸ˜‰ã€‚

å®Œæˆäº†å—ï¼Ÿå¥½å§ï¼Œé‚£æˆ‘ä»¬ç»§ç»­ã€‚

æˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºæˆ‘ä»¬çš„æ–‡ä»¶å¤´ï¼Œä½ æ˜¾ç„¶è¿˜è®°å¾—ï¼Œå®ƒæœ‰ä¸€ä¸ªç‰ˆæœ¬å’Œä¸€ä¸ªè®¡æ•°ï¼Œä¸¤è€…éƒ½æ˜¯ç”± 8 ä½æ— ç¬¦å·æ•´æ•°è¡¨ç¤ºçš„ã€‚

```
HEADER {
    version    U8
    count      U8
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ä¸ºä»£ç :

```
function pack(VERSION, selectedFiles) {
   // Making sure that we have files selected
   if (!selectedFiles.length) {
      return false;
   }

   // Create the header with a version number and file count
   let header = new Uint8Array([VERSION, selectedFiles.length]);

   // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`pack`çš„å‡½æ•°ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°:æˆ‘ä»¬çš„æ‰“åŒ…ç¨‹åºçš„ç‰ˆæœ¬å’Œæˆ‘ä»¬ä¹‹å‰å­˜å‚¨çš„æ–‡ä»¶å¯¹è±¡åˆ—è¡¨ã€‚æˆ‘ä»¬åœ¨å‡½æ•°ä¸­åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶è¢«é€‰ä¸­ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬å°±ç»“æŸè¿™ä¸ªè¿‡ç¨‹ã€‚ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª`Uint8Array`åˆ›å»ºäº†`HEADER`ç»“æ„ï¼Œå¹¶è®¾ç½®äº†ä¸¤ä¸ªå±æ€§å€¼:`version`å’Œ`count`ã€‚

åœ¨åˆ›å»ºæœ€ç»ˆæ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»çŸ¥é“æœ€ç»ˆæ–‡ä»¶çš„å¤§å°ã€‚

```
function pack(VERSION, selectedFiles) {
   // Making sure that we have files selected
   if (!selectedFiles.length) {
      return false;
   }

   // Create the header with a version number and file count
   let header = new Uint8Array([VERSION, selectedFiles.length]);

   // Set our final file's size
   let fileSize = header.byteLength;
   fileSize += selectedFiles
      .map(file => file.size)
      .reduce((acc, currentVal) => acc + (currentVal + 7));

   // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨å°†åˆå§‹æ–‡ä»¶å¤§å°è®¾ç½®ä¸ºæ–‡ä»¶å¤´çš„å­—èŠ‚æ•°åï¼Œæˆ‘ä»¬å‡å°‘æˆ‘ä»¬æ‹¥æœ‰çš„æ–‡ä»¶åˆ—è¡¨ï¼Œä»¥ä¾¿å°†æ‰€æœ‰å¤§å°åŠ åœ¨ä¸€èµ·ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥åš`currentVal + 7`æ˜¯å› ä¸ºæ¯ä¸ª`FILE`éƒ½æœ‰ä¸€ä¸ª 56 ä½æˆ– 7 å­—èŠ‚çš„å¤´ã€‚

ä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„æ–‡ä»¶ï¼Œæ·»åŠ æ–‡ä»¶å¤´ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåç§»é‡å˜é‡ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ­¥æ·»åŠ æ–‡ä»¶æ—¶ä½¿ç”¨:

```
function pack(VERSION, selectedFiles) {
   // ...

   // Our final file
   let finalFile = new Uint8Array(fileSize);

   // First add the header
   finalFile.set(header);

   // Keep count of the last file's offset
   let offset = header.byteLength;

   // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ˜¯æˆ‘ä»¬çš„æ–‡ä»¶è¿æ¥ä»£ç ã€‚ä»¥é˜²ä½ å¿˜è®°äº†`FILE`çš„æ ·å­:

```
FILE {
    type       U24
    length     U32
    data       [length]
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æ¥å®ç°è¿™ä¸ª:

```
function pack(VERSION, selectedFiles) {
   // ...

   // Now, take files and concatenate them
   selectedFiles.forEach(file => {
      // The FILE structure
      let outputFile = new Uint8Array(7 + file.size);

      // File's type
      if (file.type.includes("image")) {
         // Fill the ASCII characters IMG
         outputFile.set([73, 77, 71]);
      } else {
         // Fill the ASCII characters AUD
         outputFile.set([65, 85, 68]);
      }

      // Create a 32 bit integer...
      const fileLength32 = new Uint32Array([file.size]);
      // ...add finally add it as the length
      outputFile.set(new Uint8Array(fileLength32.buffer), 3);

      // And now add the file itself
      outputFile.set(new Uint8Array(file.buffer), 7);

      // Concatenate the file to the final file
      finalFile.set(outputFile, offset);

      // Update the offset value
      offset += outputFile.byteLength - 1;
   });

   // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç®€å•åœ°è¯´ï¼Œæˆ‘åœ¨å°è¯•åšè¿™ä¸ª`outputFile.set(new Uint32Array([file.size]), 3)`æ—¶é‡åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼Œå› ä¸ºå®ç°åªæ·»åŠ äº†ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚ä¸ºäº†ç¡®ä¿é•¿åº¦æ­£ç¡®ï¼Œä½ å¿…é¡»åˆ›å»ºä¸€ä¸ª`U32`æ•´æ•°ï¼Œç„¶åç”¨å®ƒçš„ç¼“å†²åŒºåˆ›å»ºä¸€ä¸ª`Uint8Array`ã€‚

åœ¨è¿™ä¸ªå‡½æ•°çš„é€»è¾‘çš„æœ€åï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ª blob å½¢å¼çš„åŒ…æ–‡ä»¶:

```
function pack(VERSION, selectedFiles) {
   // ...

   return new Blob([finalFile.buffer]);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬çš„`pack`å‡½æ•°çš„æœ€ç»ˆä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚

```
function pack(VERSION, selectedFiles) {
   // Making sure that we have files selected
   if (!selectedFiles.length) {
      return false;
   }

   // Create the header with a version number and file count
   let header = new Uint8Array([VERSION, selectedFiles.length]);

   // Set our final file's size
   let fileSize = header.byteLength;
   fileSize += selectedFiles
      .map(file => file.size)
      .reduce((acc, currentVal) => acc + (currentVal + 7));

   // Our final file
   let finalFile = new Uint8Array(fileSize);

   // First add the header
   finalFile.set(header);

   // Keep count of the last file's offset
   let offset = header.byteLength + 1;

   // Now, take files and concatenate them
   selectedFiles.forEach(file => {
      // The FILE structure
      let outputFile = new Uint8Array(7 + file.size);

      // File's type
      if (file.type.includes("image")) {
         // Fill the ASCII characters IMG
         outputFile.set([73, 77, 71]);
      } else {
         // Fill the ASCII characters AUD
         outputFile.set([65, 85, 68]);
      }

      // Add the length
      outputFile.set(new Uint32Array([file.size]), 3);

      // And now add the file itself
      outputFile.set(new Uint8Array(file.buffer), 7);

      // Concatenate the file to the final file
      finalFile.set(outputFile, offset);

      // Update the offset value
      offset += outputFile.byteLength - 1;
   });

   return new Blob([finalFile.buffer]);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç›®å‰ï¼Œå®ƒå¹¶ä¸é‚£ä¹ˆæœ‰ç”¨ã€‚å½“ç”¨æˆ·æŒ‰ä¸‹ä¸‹è½½æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»å¼€å§‹è¿™ä¸ªè¿‡ç¨‹ã€‚ç„¶åï¼Œåœ¨åˆ›å»ºæˆ‘ä»¬çš„æ–‡ä»¶ä¹‹åï¼ŒéªŒè¯æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å‘æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„`anchor`å…ƒç´ æ·»åŠ æ­£ç¡®çš„å±æ€§ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä¸‹è½½ä¸€ä¸ªâ€œresource.packedâ€æ–‡ä»¶:

```
download.onclick = () => {
   // Disable all the action elements onscreen
   const actionEles = document.querySelectorAll('#wrapper > *');
   actionEles.forEach(ele => (ele.disabled = true));

   // Pack the files
   let packedFile = pack(VERSION, files);

   // If there isn't a file exported then we don't do anything
   if (!packedFile) {
      // Re-enable the action buttons
      actionEles.forEach(ele => (ele.disabled = false));
      return false;
   }

   // Set the download and href values
   anchor.download = "resource.packed";
   anchor.href = window.URL.createObjectURL(packedFile);
   // Prompt user to save file
   anchor.click();

   // Re-enable the action buttons
   actionEles.forEach(ele => (ele.disabled = false));
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™åº”è¯¥å¯ä»¥äº†ã€‚å¦‚æœä½ æƒ³éªŒè¯æ–‡ä»¶æ˜¯å¦åˆ›å»ºæ­£ç¡®ï¼Œä½ å¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ï¼Œå¦‚ [HxD](https://filehippo.com/download_hxd-hex-editor/) æ¥æ£€æŸ¥ä½ çš„ã€‚æ‰“åŒ…çš„æ–‡ä»¶ã€‚

å­¦ä¹ ä½¿ç”¨ä¸€ä¸ªåå…­è¿›åˆ¶ç¼–è¾‘å™¨è¢«è¯æ˜æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå› ä¸ºæˆ‘å‘ç°å¾ˆå®¹æ˜“å‘ç°æ–‡ä»¶åœ¨å“ªé‡Œæ²¡æœ‰æ­£ç¡®æ„å»º(é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘è¯´çš„æ˜¯ pack æ–‡ä»¶çš„å¤´ï¼Œè¯•å›¾çœ‹åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶ä»å“ªé‡Œå¼€å§‹çœŸçš„å¾ˆéš¾)ã€‚ä½†æ˜¯ï¼Œæˆ‘è®¤ä¸ºä½ ä¹Ÿåº”è¯¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªã€‚

(é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæ‚¨ä¹Ÿå¯ä»¥åˆ›å»ºä¸åŒçš„ç»“æ„ä½œä¸º`TypedArray`ç»„ä»¶ï¼Œç„¶åå°†å®ƒä»¬æ”¾å…¥ä¸€ä¸ªæ•°ç»„ä¸­ã€‚ç„¶åä½¿ç”¨è¿™ä¸ªæ•°ç»„åˆ›å»ºä¸€ä¸ª blob æ–‡ä»¶ã€‚æˆ‘æ²¡æœ‰å°è¯•è¿‡ï¼Œä½†æ˜¯å®ƒåº”è¯¥æ¯”æˆ‘åœ¨è¿™é‡Œå®ç°çš„è¦ç®€å•)

## ç°åœ¨...è§£æå™¨

æˆ‘ä»¬çš„è§£æå™¨å°†æå–å¤´éƒ¨å’Œæ–‡ä»¶ã€‚æˆ‘ä»¬è¿˜å°†ç¼–å†™ä¸€äº›è‡ªå®šä¹‰ä»£ç ï¼Œå°†è¿™äº›æå–çš„æ–‡ä»¶å‘å¸ƒåˆ°é¡µé¢ä¸Šã€‚æˆ‘å°†æŠŠæˆ‘ä»¬æ‰€æœ‰çš„ç»“æ„è®¾è®¡æ”¾åœ¨è¿™é‡Œï¼Œä»¥ä¾¿äºè®°å¿†ç»“æ„:

```
PACK {
    header     HEADER
    files      FILE[HEADER.count]
}

HEADER {
    version    U8
    count      U8
}

FILE {
    type       U24
    length     U32
    data       [length]
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯åˆ›å»ºç¬¬äºŒä¸ª[ç¬”](https://codepen.io/pen),åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ åŒ…æ–‡ä»¶ï¼Œå¹¶åœ¨è§£æåç«‹å³çœ‹åˆ°ä¸åŒçš„æ–‡ä»¶ã€‚

å¦‚æœä½ è¿·è·¯äº†ï¼Œåªè¦çœ‹çœ‹æˆ‘çš„æ–°ç¬”å°±å¯ä»¥äº†ã€‚

ä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘å°†å‘å¸ƒ HTML/CSS å¹¶ç›´æ¥è½¬åˆ°æˆ‘ä»¬çš„ Javascriptã€‚

```
<div id="wrapper">
    <input type="file" accept=".packed">
    <div class="files"></div>
</div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
.file {
   width: 100vw;
}

img {
   width: 43vw;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬åˆ›å»ºå¯¹è¿™äº›å…ƒç´ çš„ DOM å¼•ç”¨ï¼Œç„¶åå‘`input`å…ƒç´ æ·»åŠ ä¸€ä¸ª`onchange`äº‹ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è§£æè¿‡ç¨‹äº†ã€‚

```
const VERSION = 1;

// Get ref to the input and the files display elements.
const input = document.querySelector("input");
const filesContainer = document.querySelector(".files");

input.onchange = () => {
   // First we get our pack file if it was selected
   let file = input.files[0];

   // Make sure that we have our file
   if (file) {
      // We get the buffer
      file.arrayBuffer().then(buffer => {
         // Parse our file
         let unpackedFiles = parse(VERSION, buffer);
         // Display files on screen to make sure everything is OK
         displayFiles(unpackedFiles);
      });
   }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨æˆ‘ä»¬çš„`parse`å‡½æ•°ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ª blob æ–‡ä»¶æ•°ç»„ã€‚ä½†é¦–å…ˆï¼Œä¸€äº›è®¾ç½®:

```
function parse(VERSION, buffer) {
   // Check if big/little endian
   const isLittleEndian = new Uint8Array(new Uint32Array([0x12345678]).buffer)[0] === 0x78;

   // Create a view of file's byte data
   let file = new DataView(buffer);

   // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å­—èŠ‚åºã€‚å¯¹ï¼Œå°±æ˜¯ä¸€ä¸ªå­—ã€‚æ˜¾ç„¶ä¸åŒçš„è®¡ç®—æœºè¯»å–å­—èŠ‚æ˜¯ä¸åŒçš„(è°ä¼šçŒœåˆ°)ã€‚æœ‰äº›ä»æœ€å³è¾¹çš„å­—èŠ‚å¼€å§‹ï¼Œæœ‰äº›ä»æœ€å·¦è¾¹çš„å­—èŠ‚å¼€å§‹ã€‚æˆ‘ä»¬çš„ parse å‡½æ•°ä¸­çš„ç¬¬ä¸€è¡Œæ£€æŸ¥è®¡ç®—æœºæ˜¯å¦æ˜¯ little endian(æœ€å³è¾¹çš„å­—èŠ‚)ã€‚ä½¿ç”¨ DataView æ„é€ å‡½æ•°å…è®¸æˆ‘ä»¬ç¼–å†™å¯ä»¥åœ¨å¤§ç«¯å’Œå°ç«¯æ¶æ„ä¸Šå·¥ä½œçš„ä»£ç ã€‚é‡è¦çš„æ˜¯ï¼Œå› ä¸ºä½ ä¸æƒ³ä»é”™è¯¯çš„ä¸€ç«¯è¯»å–ä½ çš„æ–‡ä»¶ã€‚

ç°åœ¨è¿™äº›éƒ½å®Œæˆäº†ï¼Œè®©æˆ‘ä»¬ç»§ç»­é˜…è¯»æˆ‘ä»¬çš„å¤´æ–‡ä»¶å¹¶è®¾ç½®æ–‡ä»¶æå–:

```
function parse(VERSION, buffer) {
   // ...

   // If the version number of the parser is the same as the version number of packer then continue
   if (file.getUint8(0, isLittleEndian) === VERSION) {
      // How many files we have to get
      let count = file.getUint8(1 , isLittleEndian);
      // Our offset from the start of the buffer
      let offset = 2;
      // An array of Blob objects
      let unpackedFiles = [];

      // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯ä»¥å¼€å§‹æå–æˆ‘ä»¬çš„æ–‡ä»¶:

```
function parse(VERSION, buffer) {
   // ...
   // If the version number of the parser is the same as the version number of packer then continue
   if (file.getUint8(0, isLittleEndian) === VERSION) {
      // ...

      // Get the files
      for (let index = 0; index < count; index++) {
         // Get the type first
         let type = "";
         for (let char = 0; char < 3; char++) {
            type += String.fromCharCode(file.getUint8(offset++, isLittleEndian));
         }

         // Get the length of file
         const fileLength = file.getUint32(offset, isLittleEndian);
         offset += 4;

         // Our array of byte values
         let byteArray = [];

         // Get the bytes
         for (let fileIndex = 0; fileIndex < fileLength; fileIndex++) {
            //
            byteArray.push(file.getUint8(offset + fileIndex, isLittleEndian));
         }

         offset += fileLength - 1;

         // Create a temporary store for our bytes
         let fileArray = new Uint8Array(byteArray);

         // Create our options object based on file type
         let options = { type: "" };
         if (type === 'IMG') {
            options.type = 'image/png';
         } else {
            options.type = 'audio/ogg';
         }

         // Add the file to our collection of files
         unpackedFiles.push(new Blob([fileArray.buffer], options));
      }

      return unpackedFiles;
   }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½äº†ï¼Œè¿™æ˜¯å¾ˆå¤šä»£ç ã€‚è®©æˆ‘å‘Šè¯‰ä½ è¿™é‡Œå‘ç”Ÿçš„äº‹æƒ…çš„è¦ç‚¹:

1.  æˆ‘ä»¬å¾—åˆ°çš„ç±»å‹å¯ä»¥æ˜¯ä¸¤ç§å¯èƒ½çš„ç±»å‹ä¹‹ä¸€:IMG æˆ–æ¾³å…ƒã€‚
2.  è·å–æ–‡ä»¶çš„é•¿åº¦
3.  åˆ›å»ºä¸€ä¸ªæ•°ç»„æ¥ä¿å­˜å­—èŠ‚ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå¾ªç¯æ¥æ·»åŠ å®ƒä»¬ã€‚
4.  åˆ›å»ºä¸€ä¸ª blob æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„ blob æ–‡ä»¶æ•°ç»„ä¸­

ç„¶åï¼Œè¯¥å‡½æ•°ä»¥å¯¼å‡ºè§£å‹ç¼©æ–‡ä»¶çš„ä¸€è¡Œç»“æŸï¼Œè¿™äº›æ–‡ä»¶å°†æ˜¾ç¤ºåœ¨æˆ‘ä»¬çš„`displayFiles`å‡½æ•°:
ä¸­

```
function displayFiles(unpackedFiles) {
   // Clear the files list
   filesContainer.innerHTML = "";

   unpackedFiles.forEach(file => {
      // Create a div element
      let div = `<div class="file">[FILE]</div>`;

      // Check type
      if (file.type.includes('image')) {
         // It's an image
         div = div.replace('[FILE]', `<img src="${window.URL.createObjectURL(file)}"/>`);
      } else {
         // It's an audio file
         div = div.replace('[FILE]', `<audio src="${window.URL.createObjectURL(file)}" controls></audio>`);
      }
      // Update DOM
      filesContainer.innerHTML += div;
   })
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™åªæ˜¯è·å–æˆ‘ä»¬çš„ blob æ–‡ä»¶ï¼Œåˆ›å»ºåˆ°å®ƒä»¬çš„é“¾æ¥ï¼Œç„¶åå°†å®ƒä»¬æ·»åŠ åˆ° DOM ä¸­ã€‚å·®ä¸å¤šå°±æ˜¯è¿™æ ·ã€‚

æœ€å...

## ä½ ã€‚æ˜¯ã€‚å¤ªæ£’äº†ã€‚ğŸ˜

è°¢è°¢ä½ èƒ½èµ°åˆ°è¿™ä¸€æ­¥ã€‚æˆ‘å†™äº†å¾ˆå¤šæˆ‘çŸ¥é“çš„ï¼Œåªæ˜¯å¸Œæœ›è¿™å¯¹æŸäººæœ‰æ‰€å¸®åŠ©ã€‚æˆ‘çŸ¥é“æˆ‘å­¦åˆ°äº†å¾ˆå¤šã€‚

## è¿åŠ¨

æˆ‘æƒ³å¦‚æœåœ¨é‚£ä¹‹åæˆ‘èƒ½ç»™ä½ ç•™ç‚¹äº‹åšå°±å¥½äº†ã€‚æˆ‘ä»¬çš„æ‰“åŒ…å™¨/è§£æå™¨ç¼ºå°‘äº†å¾ˆå¤šä¸œè¥¿:æ·»åŠ æ ‡è¯†ç¬¦ä»¥ä¾¿æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬æ­£åœ¨å¤„ç†ä»€ä¹ˆæ–‡ä»¶ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œåˆ†ç»„è€Œä¸æ˜¯æ¯æ¬¡éƒ½å¿…é¡»è¯»å–ç±»å‹ï¼Œé€šè¿‡å°† mime ç±»å‹æ·»åŠ åˆ°`FILE`çš„å¤´ä¸­æ¥æ”¯æŒä¸åŒçš„æ–‡ä»¶ç±»å‹ï¼Œè¿˜åœ¨å¤´ä¸­ä¸º`version`å±æ€§ä½¿ç”¨äº†ä¸€ä¸ª`STRING`ç»“æ„ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ semver å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ä»£ç æ€»ä½“ä¸Šæ›´å¥½ã€‚

å› æ­¤ï¼Œæ‚¨çš„å¯é€‰ç»ƒä¹ æ˜¯å°½å¯èƒ½å¤šåœ°å°†è¿™äº›ç‰¹æ€§/ä¼˜åŒ–æ·»åŠ åˆ°æ‰“åŒ…å™¨/è§£æå™¨ä»£ç ä¸­ã€‚

## æœ‰ä»€ä¹ˆç–‘é—®å—ï¼Ÿ

å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ä¸‹é¢ç•™è¨€ã€‚æˆ‘è‚¯å®šä¼šç™»è®°å…¥ä½çš„ã€‚

æˆ‘ç¡®å®æœ‰ä¸€ä¸ªé—®é¢˜è¦é—®ä½ ï¼Œè¿™ä¸ªæ•™ç¨‹èƒ½æ›´å¥½å—ï¼Ÿä¹Ÿè®¸å®ƒå¯ä»¥æ›´çŸ­ï¼Œæˆ‘ç¡®å®è§‰å¾—æˆ‘æ²¡æœ‰å¾ˆå¥½åœ°è§£é‡Šæœ€åˆçš„éƒ¨åˆ†ã€‚ä½œä¸ºä¸€ä¸ªç³»åˆ—ä¼šæ›´å¥½å—ï¼Ÿ

æˆ‘ä¸å¤ªäº†è§£è¿™ä¸ªç¤¾åŒºï¼Œæ‰€ä»¥å¦‚æœæˆ‘çš„å†™ä½œé£æ ¼çœ‹èµ·æ¥ä¸æ€ä¹ˆæ ·ã€‚

## ä¸€äº›ä½ å¯èƒ½æƒ³è¯»çš„æ–‡ç« 

*   [è‚¯å®šæ˜¯å—åˆ°äº†è¿™ç¯‡å…³äº GameDev Tuts+](https://gamedevelopment.tutsplus.com/tutorials/create-custom-binary-file-formats-for-your-games-data--gamedev-206) çš„æ–‡ç« çš„å¯å‘
*   [æœ‰è¶£çš„é˜…è¯»è®©æˆ‘æƒ³åˆ°äº†ä½¿ç”¨ç±»å‹åŒ–æ•°ç»„æ¥åˆ›å»ºä¸Šé¢çš„ä¾‹å­ï¼Œä½†æ˜¯å¯¹äº web å¼€å‘äººå‘˜æ¥è¯´](https://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/)
*   [ç±»å‹æ•°ç»„](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays)