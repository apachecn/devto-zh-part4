# é…·å°å­©ç”¨é’©å­å¤„ç†çŠ¶æ€

> åŸæ–‡ï¼š<https://dev.to/amirmoh10/cool-kids-handle-state-with-hooks-52p3>

React åº”ç”¨ç¨‹åºåŸºæœ¬ä¸Šæ˜¯ä¸€ç»„ React ç»„ä»¶ï¼Œå®ƒä»¬è¢«æ”¾åœ¨ä¸€èµ·æœåŠ¡äºåº”ç”¨ç¨‹åºçš„ç›®çš„ã€‚è¿™äº›ç»„ä»¶å¯ä»¥æ˜¯åŠŸèƒ½æ€§çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»ã€‚ **Functional** ç»„ä»¶æ˜¯æ¥æ”¶é“å…·(å±æ€§)å¹¶è¿”å›æ¸²æŸ“åˆ°å±å¹•ä¸Šçš„ JSX ä»£ç çš„å‡½æ•°ã€‚å®ƒä»¬è¢«å½’ç±»ä¸ºæ— çŠ¶æ€ç»„ä»¶ï¼Œå› ä¸ºå®ƒä»¬ä¸ä½¿ç”¨çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚

ç„¶è€Œï¼Œåœ¨ 16.8 ä¹‹å‰ï¼Œå¦‚æœä½ æƒ³åœ¨ä½ çš„ç»„ä»¶ä¸­æœ‰ä¸€ä¸ªçŠ¶æ€æˆ–è€…æƒ³ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä½ éœ€è¦ä½¿ä½ çš„ç»„ä»¶æˆä¸ºä¸€ä¸ªåŸºäº**ç±»çš„**ç»„ä»¶ã€‚åˆ›å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œä½¿ç”¨è¿™ä¸¤ç§ç±»å‹çš„ç»„ä»¶å„æœ‰ä¼˜åŠ¿ã€‚ç„¶è€Œï¼Œå®ƒä»¬ä¹‹é—´çš„è½¬æ¢çœŸçš„å¾ˆçƒ¦äººï¼Œå½“æ¶‰åŠåˆ°å¤æ‚çš„åº”ç”¨ç¨‹åºæ—¶ï¼ŒçŸ¥é“ä½¿ç”¨å“ªä¸ªç”Ÿå‘½å‘¨æœŸã€ä½•æ—¶ä»¥åŠå¦‚ä½•æ­£ç¡®ä½¿ç”¨å®ƒçœŸçš„å¾ˆæœ‰æŒ‘æˆ˜æ€§ã€‚

React 16.8 å¼•å…¥äº†ä¸€ä¸ªæ–°ç‰¹æ€§:**é’©å­**ã€‚React é’©å­æ˜¯ä¸€ä¸ªæ ¹æœ¬æ€§çš„æ”¹å˜ï¼Œå› ä¸ºå®ƒä»¬ä½¿å¾—åˆ›å»ºæœ‰çŠ¶æ€(å¸¦çŠ¶æ€)çš„å‡½æ•°ç»„ä»¶æˆä¸ºå¯èƒ½ï¼

è¿™ç¯‡æ–‡ç« æ—¨åœ¨å±•ç¤º React ä¸­çŠ¶æ€ç®¡ç†çš„å½“å‰çŠ¶æ€ã€‚æˆ‘ä»¬å°†ä»¥ä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨åº”ç”¨ç¨‹åºä¸ºä¾‹ï¼Œä½¿ç”¨ç±»ç»„ä»¶é€»è¾‘å®ç°å®ƒï¼Œç„¶åä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„ React é’©å­:`useState`å’Œ`useReducer`ã€‚é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬å°†ç»å†ç±»å’Œå‡½æ•°ç»„ä»¶ä¸­çš„çŠ¶æ€æ“ä½œã€‚

* * *

æˆ‘ä»¬è®¡ç®—å™¨åº”ç”¨ç¨‹åºçš„æœ€ç»ˆç»“æœå°†å¦‚ä¸‹æ‰€ç¤º:

[![calculator-gif](img/83f16e8493eb0e035bbbe6bb66aae491.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--fmIf9mno--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/1600/1%2AEWxHgl3Ek64DGyHfCPPYWw.gif)

è®¡ç®—å™¨æ¥å—ä¸¤ä¸ªè¾“å…¥æ•°å­—ï¼Œæ ¹æ®é€‰å®šçš„è¿ç®—ç¬¦æ‰§è¡Œç®—æœ¯è¿ç®—ã€‚

```
class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
     ....
    };
  }
  ...
  };
  render() {
    return (
      <form>
        <label>
          <div>
            Number 1 : <input type="text" onChange={this.firstNumUpdate} />
          </div>
          <br />
          <div>
            Number 2 : <input type="text" onChange={this.secondNumUpdate} />
          </div>
          <br />
          <div>
            <select onChange={this.operatorUpdate}>
              <option value="+">+</option>
              <option value="-">-</option>
              <option value="*">*</option>
              <option value="/">/</option>
            </select>
            <br />
            <br />
          </div>
          <input type="button" onClick={this.executeComputation} value="Execute" />
          <div />
          <br />
          <input type="text" value={this.state.result} />
        </label>
      </form>
    );
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

# I-ä½¿ç”¨ä¸€ä¸ªç±»ç»„ä»¶

å†æ¬¡æé†’æ‚¨ï¼Œæˆ‘ä»¬å€ŸåŠ©åŸºäº**ç±»çš„**ç±»å‹ç»„ä»¶æ¥åˆ›å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿æ•æ‰ç”¨æˆ·è¾“å…¥å¹¶ç›¸åº”åœ°æ›´æ–°çŠ¶æ€å€¼ã€‚æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„çŠ¶æ€åŒ…æ‹¬ä»¥ä¸‹å†…å®¹:

*   **firstnumber** :ç”¨æˆ·è¾“å…¥çš„æ•°å­— 1ï¼Œ
*   **ç¬¬äºŒä¸ªæ•°å­—**:ç”¨æˆ·è¾“å…¥çš„ç¬¬äºŒä¸ªæ•°å­—ï¼Œ
*   **æ“ä½œå‘˜**:ç”¨æˆ·é€‰æ‹©çš„æ“ä½œå‘˜ï¼Œ
*   **ç»“æœ**:ç”¨è¿ç®—ç¬¦è®¡ç®—æ•°å­— 1 å’Œæ•°å­— 2 çš„æœ€ç»ˆç»“æœã€‚

```
class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      firstnumber: 0,
      secondnumber: 0,
      operator: "+",
      result: 0
    };
    this.firstNumUpdate = this.firstNumUpdate.bind(this);
    this.secondNumUpdate = this.secondNumUpdate.bind(this);
    this.operatorUpdate = this.operatorUpdate.bind(this);
  }
  ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬è¿˜æœ‰æˆ‘ä»¬çš„`onChange`å’Œ`onClick`å¤„ç†ç¨‹åºï¼Œå®ƒä»¬è°ƒç”¨`this.setState`æ¥æ›´æ–° **this.state** ä¸­çš„åŠ¨æ€å­˜å‚¨å€¼:

*   `firstNumUpdate`:æ ¹æ®æ•°å­— 1 ç”¨æˆ·è¾“å…¥æ›´æ–°çŠ¶æ€å€¼ firstnumber çš„å‡½æ•°ï¼Œ
*   `secondNumUpdate`:æ ¹æ®æ•°å­— 2 ç”¨æˆ·è¾“å…¥æ›´æ–°çŠ¶æ€å€¼ secondnumber çš„å‡½æ•°ï¼Œ
*   `operatorUpdate`:æ ¹æ®æ“ä½œå‘˜ç”¨æˆ·é€‰æ‹©æ›´æ–°çŠ¶æ€å€¼æ“ä½œå‘˜çš„åŠŸèƒ½ã€‚
*   `executeComputation`:æ ¹æ®æ•°å­— 1ã€æ•°å­— 2 å’Œæ‰€é€‰è¿ç®—ç¬¦è®¡ç®—ç»“æœçš„å‡½æ•°ã€‚

```
firstNumUpdate(evt) {
    this.setState({ firstnumber: Number(evt.target.value) });
  }
  secondNumUpdate(evt) {
    this.setState({ secondnumber: Number(evt.target.value) });
  }
  operatorUpdate(evt) {
    this.setState({ operator: evt.target.value });
  }

  executeComputation = () => {
    let z = null;
    let operator = this.state.operator;
    let firstnumber = this.state.firstnumber;
    let secondnumber = this.state.secondnumber;

    switch (operator) {
      case "+":
        z = firstnumber + secondnumber;
        break;
      case "-":
        z = firstnumber - secondnumber;
        break;
      case "/":
        z = firstnumber / secondnumber;
        break;
      case "*":
        z = firstnumber * secondnumber;
        break;
      default:
        throw new Error();
    }

    this.setState({ ...this.state, result: z });
  }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬çš„ç±»ç»„ä»¶çš„è¿”å›æ–¹æ³•æ˜¯è¿™æ ·çš„:

```
class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      firstnumber: 0,
      secondnumber: 0,
      operator: "+",
      result: 0
    };
    this.firstNumUpdate = this.firstNumUpdate.bind(this);
    this.secondNumUpdate = this.secondNumUpdate.bind(this);
    this.operatorUpdate = this.operatorUpdate.bind(this);
  }

  firstNumUpdate(evt) {
    this.setState({ firstnumber: Number(evt.target.value) });
  }
  secondNumUpdate(evt) {
    this.setState({ secondnumber: Number(evt.target.value) });
  }
  operatorUpdate(evt) {
    this.setState({ operator: evt.target.value });
  }

  executeComputation = () => {
    let z = null;
    let operator = this.state.operator;
    let firstnumber = this.state.firstnumber;
    let secondnumber = this.state.secondnumber;

    switch (operator) {
      case "+":
        z = firstnumber + secondnumber;
        break;
      case "-":
        z = firstnumber - secondnumber;
        break;
      case "/":
        z = firstnumber / secondnumber;
        break;
      case "*":
        z = firstnumber * secondnumber;
        break;
      default:
        throw new Error();
    }

    this.setState({ ...this.state, result: z });
  };

  render() {
    return (
      <form>
        <label>
          <div>
            Number 1 : <input type="text" onChange={this.firstNumUpdate} />
          </div>
          <br />
          <div>
            Number 2 : <input type="text" onChange={this.secondNumUpdate} />
          </div>
          <br />
          <div>
            <select onChange={this.operatorUpdate}>
              <option value="+">+</option>
              <option value="-">-</option>
              <option value="*">*</option>
              <option value="/">/</option>
            </select>
            <br />
            <br />
          </div>
          <input
            type="button"
            onClick={this.executeComputation}
            value="Execute"
          />
          <div />
          <br />
          <input type="text" value={this.state.result} />
        </label>
      </form>
    );
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬çš„ç±»ç»„ä»¶åˆ°æ­¤ä¸ºæ­¢ï¼ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ä»£ç [ã€‚](https://codesandbox.io/s/classcalculator-f581y)

ç°åœ¨æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†è®¡ç®—å™¨ä½œä¸ºä¸€ä¸ªç±»ç»„ä»¶çš„æ ·å­ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨é’©å­æ¥å®ç°å®ƒã€‚

* * *

# II-ä½¿ç”¨åŠŸèƒ½ç»„ä»¶

## a)ä½¿ç”¨ useState é’©å­

ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªåŠŸèƒ½ç»„ä»¶å’Œ`useState`é’©å­æ¥å®ç°åŒä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬ä¸èƒ½å†ä½¿ç”¨ **this.state** æˆ– **this.setState** å±æ€§ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä¼šä½¿ç”¨åŸºäºç±»çš„ç»„ä»¶ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬çš„**åŠŸèƒ½**ç»„ä»¶åœ¨é’©å­çš„å¸®åŠ©ä¸‹å°†å­˜å‚¨å’Œæ›´æ–°çŠ¶æ€ã€‚å¦‚å‰æ‰€è¿°ï¼Œé’©å­æ˜¯ React åŠ©æ‰‹å‡½æ•°ï¼Œç”¨æ¥åˆ›å»º&æ“ä½œç»„ä»¶çš„çŠ¶æ€ã€‚

é¦–å…ˆè®©æˆ‘ä»¬ä» React å¯¼å…¥`useState`ã€‚

```
import React, { useState } from "react"; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹è¯­æ³•å°†åŸºäºç±»çš„åº”ç”¨ç¨‹åºç»„ä»¶ç¼–å†™ä¸ºåŠŸèƒ½ç»„ä»¶:

```
function App() { 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åæˆ‘ä»¬è°ƒç”¨`useState`é’©å­å‡½æ•°ï¼Œå®ƒä¸ºç”¨æˆ·è¾“å…¥è·å–ä¸€ä¸ªåˆå§‹çŠ¶æ€ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„:

```
const initialState = {
  firstnumber: 0,
  secondnumber: 0,
  operator: "+",
  result: 0
};

function App() {
  const [state, setState] = useState(initialState);
  ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¯¹è±¡çš„**çŠ¶æ€ï¼Œ**
*   ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ç”¨äºæ›´æ–°çŠ¶æ€çš„å‡½æ•°ã€‚å¯¹äº**åˆå§‹çŠ¶æ€**ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ä»»ä½•ä¸œè¥¿ï¼Œä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œ0ï¼Œnullï¼Œä¸€ä¸ªç©ºæ•°ç»„ï¼Œä¸€ä¸ªç©ºå¯¹è±¡ï¼Œä»»ä½•ä½ æƒ³è¦åˆå§‹ç®¡ç†çš„çŠ¶æ€ã€‚

```
const [state, setState] = useState(initialState); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å†³å®šå°†ç¬¬ä¸€ä¸ªæ•°å­—ã€ç¬¬äºŒä¸ªæ•°å­—å’Œç»“æœè¾“å…¥å…ƒç´ çš„åˆå§‹å€¼è®¾ä¸ºâ€œ0â€ï¼Œè€Œæ“ä½œç¬¦é€‰æ‹©è¾“å…¥å…ƒç´ çš„åˆå§‹å€¼ä¸ºâ€œ+â€ã€‚

> *æˆ‘ä»¬å½“ç„¶å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„`useState`è°ƒç”¨ï¼Œå¹¶å°†æˆ‘ä»¬æ‰€æœ‰çš„çŠ¶æ€(åŒ…æ‹¬æ•°å­—ã€ç»“æœå’Œæ“ä½œç¬¦)æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ä¸­ã€‚ç„¶è€Œï¼Œæ˜æ™ºçš„æ–¹æ³•æ˜¯ä½¿ç”¨å¤šä¸ªè°ƒç”¨ï¼Œè¿™æ ·ä½ å¯ä»¥åˆ†å¼€ä½ çš„çŠ¶æ€ï¼Œç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ï¼Œå¹¶ä¸”ä¸€æ¬¡ä¸€ä¸ªçŠ¶æ€åœ°å…³æ³¨**ã€‚***

 **å½“ä¸€ä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶(ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªæ•°å­—è¾“å…¥çš„ onChange äº‹ä»¶)ï¼Œæˆ‘ä»¬ä½¿ç”¨å…¶å¯¹åº”çš„çŠ¶æ€æ›´æ–°å™¨å‡½æ•°æ¥æ‰§è¡ŒçŠ¶æ€æ›´æ–°ã€‚

```
const operatorUpdate = evt => {
  setState({ ...state, operator: evt.target.value });
};

const firstNumUpdate = evt => {
  setState({ ...state, firstnumber: Number(evt.target.value) });
};

const secondNumUpdate = evt => {
  setState({ ...state, secondnumber: Number(evt.target.value) });
};

const executeComputation = () => {
  let z = null;
  let operator = state.operator;
  let firstnumber = state.firstnumber;
  let secondnumber = state.secondnumber;

  switch (operator) {
    default:
      z = firstnumber + secondnumber;
      break;
    case "-":
      z = firstnumber - secondnumber;
      break;
    case "/":
      z = firstnumber / secondnumber;
      break;
    case "*":
      z = firstnumber * secondnumber;
      break;
  }

  setState({ ...state, result: z });
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç§ğŸ‰ï¼ç‚¹å‡»æŸ¥çœ‹æˆ‘ä»¬çš„è®¡ç®—å™¨åº”ç”¨ç¨‹åºçš„å¤–è§‚

## b)ä½¿ç”¨ useReducer æŒ‚é’©

å¹¶ä¸æ˜¯æˆ‘ä»¬å”¯ä¸€å¯ä»¥ç”¨æ¥æ“ä½œç»„ä»¶çŠ¶æ€çš„é’©å­ã€‚æˆ‘ä»¬ç°åœ¨å°†çœ‹åˆ°å¦ä¸€ä¸ªé’©å­ï¼Œ`useReducer`ï¼Œå®ƒç”¨ä¸åŒçš„è¯­æ³•å¸®åŠ©å®ç°ç›¸åŒçš„ç»“æœã€‚è¿™ä¸ªé’©å­ä½¿ç”¨å¸¦æœ‰ä¸¤ä¸ªå‚æ•°çš„ reducer:ä¸€ä¸ªçŠ¶æ€å’Œä¸€ä¸ªåŠ¨ä½œï¼Œå¹¶è¿”å›åº”ç”¨ç¨‹åºçš„æ–°çŠ¶æ€ã€‚å¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡ Redux çŠ¶æ€ç®¡ç†åº“ï¼Œä½ ä¼šå‘ç°`useReducer`é’©å­å¯¹ Redux çš„ reducer éå¸¸ç†Ÿæ‚‰ã€‚

> *`useReducer`é‡‡ç”¨ä¸€ä¸ªå‡½æ•°(ç§°ä¸º reducer ),å®ƒæœ‰ä¸¤ä¸ªå‚æ•°:**çŠ¶æ€**å’Œ**åŠ¨ä½œ**ã€‚æ ¹æ®ä¼ é€’ç»™ reducer çš„åŠ¨ä½œï¼Œè¿”å›åº”ç”¨ç¨‹åºçš„æ–°çŠ¶æ€ã€‚æˆ‘ä»¬ä¸€ä¼šå„¿å°†å›åˆ°å‡é€Ÿå™¨ã€‚*

### æ­¥éª¤ 1:é…ç½®ç”¨æˆ·ç”¨æˆ·

æˆ‘ä»¬å…ˆå¯¼å…¥`useReducer` :

```
import React, { useReducer } from "react"; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åæˆ‘ä»¬è¿™æ ·å®šä¹‰é’©å­:

```
const [state, dispatch] = useReducer(reducer, initialState); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### ç¬¬äºŒæ­¥:å®šä¹‰ç”¨æˆ·è¾“å…¥çš„é€»è¾‘

è®©æˆ‘ä»¬å†æ¥çœ‹çœ‹æˆ‘ä»¬çš„é—®é¢˜:æˆ‘ä»¬å¸Œæœ›å°†ä¸¤ä¸ªæ•°ç›¸åŠ ã€ç›¸å‡ã€ç›¸ä¹˜æˆ–ç›¸é™¤ã€‚ä¸ºæ­¤ï¼Œç”¨æˆ·é¦–å…ˆè¾“å…¥ 2 ä¸ªæ•°å­—ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬çš„ 1 å·å’Œ 2 å·è¾“å…¥å­—æ®µã€‚

> *ç”±äºæ ‘çš„å¤æ‚æ€§ä¸æ˜¯å¾ˆé«˜ï¼Œç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¸éœ€è¦ä»ä¸€ä¸ªç»„ä»¶ä¼ é€’åˆ°å¦ä¸€ä¸ªåµŒå…¥çš„ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª`useState`é’©å­ï¼Œå°±åƒæˆ‘ä»¬ä¸Šé¢åšçš„é‚£æ ·ï¼Œæ¥æ“ä½œç”¨æˆ·è¾“å…¥ã€‚ç„¶è€Œï¼Œä¸ºäº†ä¸¾ä¾‹ï¼Œè®©æˆ‘ä»¬ç”¨`useReducer`æ¥è¡¨ç¤º**çš„ä¸€åˆ‡**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨**æ¥å¤„ç†ç”¨æˆ·è¾“å…¥**å’Œè®¡ç®—å™¨çš„**é€»è¾‘ã€‚***

æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ reducer ä¸­å®šä¹‰äº†ä¸¤ä¸ªåŠ¨ä½œ:`FIRST_NUM_UPDATE`å’Œ`SECOND_NUM_UPDATE`ï¼Œåˆ†åˆ«ä»£è¡¨å½“ç”¨æˆ·è¾“å…¥**æ•°å­— 1** æˆ–**æ•°å­— 2**:
æ—¶è¦è°ƒåº¦æˆ–â€œè§¦å‘â€çš„åŠ¨ä½œ

```
function reducer(state, action) {
  const firstnumber = Number(action.firstnumber);
  const secondnumber = Number(action.secondnumber);

  switch (action.type) {
    // User Input actions
    case "FIRST_NUM_UPDATE":
      return {
        ...state,
        firstnumber: firstnumber
      };
    case "SECOND_NUM_UPDATE":
      return {
        ...state,
        secondnumber: secondnumber
      };
    case "OPERATOR_UPDATE":
      return {
        ...state,
        operator: action.operator
      };
    // Computing actions
    case "ADD":
      return {
        ...state,
        result: firstnumber + secondnumber
      };
    case "SUBTRACT":
      return { ...state, result: firstnumber - secondnumber };
    case "MULTIPLY":
      return { ...state, result: firstnumber * secondnumber };
    case "DIVIDE":
      return { ...state, result: firstnumber / secondnumber };
    default:
      throw new Error();
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> *è¾“å…¥çš„**ç¬¬ä¸€ä¸ªæ•°å­—**æˆ–**ç¬¬äºŒä¸ªæ•°å­—**çš„å€¼é€šè¿‡åŠ¨ä½œå‚æ•°ä¼ é€’ã€‚æ ¹æ®è¾“å…¥çš„æ•°å­—ï¼Œ`FIRST_NUM_UPDATE`æˆ–`SECOND_NUM_UPDATE`éšåè¢«è°ƒåº¦ä»¥è¿”å›ä¸€ä¸ª**æ–°çŠ¶æ€**ï¼Œè¯¥çŠ¶æ€åŒ…å«æ–°è¾“å…¥çš„**ç¬¬ä¸€æ•°å­—**å’Œ**ç¬¬äºŒæ•°å­—**çš„å€¼ã€‚*

ç°åœ¨æˆ‘ä»¬çš„ reducer å¤„ç†è¿™äº›åŠ¨ä½œï¼Œè®©æˆ‘ä»¬å®é™…ä¸Šåœ¨ç”¨æˆ·æ›´æ”¹ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªæ•°å­—çš„è¾“å…¥æ—¶è§¦å‘å®ƒä»¬ã€‚

```
const firstNumUpdate = evt => {
    dispatch({
      type: "FIRST_NUM_UPDATE",
      firstnumber: evt.target.value
    });
  };

const secondNumUpdate = evt => {
    dispatch({
      type: "SECOND_NUM_UPDATE",
      secondnumber: evt.target.value
    });
  }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬æƒ³è¦åœ¨ 1 å·å’Œ 2 å·è¾“å…¥å­—æ®µçš„`onChange`æœŸé—´è°ƒåº¦å®ƒä»¬ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬ä¸ºæ¯ä¸ªæ•°å­—è¾“å…¥å­—æ®µè°ƒç”¨`onChange`å¤„ç†ç¨‹åºä¸­çš„`firstNumUpdate`å’Œ`secondNumUpdate`ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
<div> Number 1 :
  <input type="text" onChange={evt => firstNumUpdate(evt)} value={state.firstnumber} /> </div> <br /> 
<div> Number 2 :
  <input type="text" onChange={evt => secondNumUpdate(evt)} value={state.secondnumber} /> </div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸåœ°ä½¿ç”¨æˆ‘ä»¬çš„ reducer å°†çŠ¶æ€æ›´æ–°ä¸ºç”¨æˆ·åœ¨æ•°å­—è¾“å…¥å­—æ®µä¸­è¾“å…¥çš„å†…å®¹ï¼è®©æˆ‘ä»¬å¯¹æ“ä½œç¬¦é€‰æ‹©å…ƒç´ åšåŒæ ·çš„äº‹æƒ…:

*   æˆ‘ä»¬å®šä¹‰äº†`OPERATOR_UPDATE`åŠ¨ä½œæ¥è¿”å›æˆ‘ä»¬çš„ reducer å‡½æ•°ä¸­é€‰æ‹©çš„æ“ä½œç¬¦

```
case "OPERATOR_UPDATE":
      return {
        ...state,
        operator: action.operator
      }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŠ©æ‰‹æ–¹æ³•`operatorUpdate`æ¥åˆ†æ´¾`OPERATOR_UPDATE`åŠ¨ä½œ:

```
const operatorUpdate = evt => {
    const operator = evt.target.value;
    dispatch({
      type: "OPERATOR_UPDATE",
      operator: operator
    });
  }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   æˆ‘ä»¬ä»æ“ä½œç¬¦ select å…ƒç´ ä¸­çš„ onChange å¥æŸ„è°ƒç”¨`operatorUpdate`:

```
<select onChange={evt => operatorUpdate(evt)}>
      <option value="+">+</option>
      <option value="-">-</option>
      <option value="*">*</option>
      <option value="/">/</option>
</select> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é…·ï¼Œç°åœ¨è®©æˆ‘ä»¬ç”¨è®¡ç®—å™¨çš„é€»è¾‘æ¥å¼„è„æˆ‘ä»¬çš„æ‰‹å§ï¼

### ç¬¬ä¸‰æ­¥:å®šä¹‰è®¡ç®—å™¨çš„é€»è¾‘

æˆ‘ä»¬çš„è®¡ç®—å™¨ä½¿ç”¨æˆ·èƒ½å¤Ÿå°†ä¸¤ä¸ªæ•°ç›¸åŠ ã€ç›¸å‡ã€ç›¸ä¹˜æˆ–ç›¸é™¤ã€‚ä»…ä»…ä»é™ˆè¿°é—®é¢˜å¼€å§‹ï¼Œæˆ‘ä»¬å·²ç»æœ‰ 4 ä¸ªå‡é€Ÿå™¨åŠ¨ä½œäº†ï¼

*   ä»£è¡¨æˆ‘ä»¬äººæ•°æ€»å’Œçš„è¡ŒåŠ¨

```
case "ADD":
      return {
        ...state,
        result: Number(action.firstnumber) + Number(action.secondnumber)
      }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `SUBTRACT`ä»£è¡¨æˆ‘ä»¬çš„æ•°å­—ç›¸å‡çš„åŠ¨ä½œ:

```
case "MULTIPLY":
      return { ...state, result: firstnumber * secondnumber }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `DIVIDE`ä»£è¡¨æˆ‘ä»¬äººæ•°åˆ’åˆ†çš„è¡ŒåŠ¨:

```
case "DIVIDE":
      return { ...state, result: firstnumber / secondnumber }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€ç»ˆï¼Œæˆ‘ä»¬çš„ reducer å‡½æ•°çœ‹èµ·æ¥åƒè¿™æ ·:

```
function reducer(state, action) {
  const firstnumber = Number(action.firstnumber);
  const secondnumber = Number(action.secondnumber);

  switch (action.type) {
    // User Input actions
    case "FIRST_NUM_UPDATE":
      return {
        ...state,
        firstnumber: firstnumber
      };
    case "SECOND_NUM_UPDATE":
      return {
        ...state,
        secondnumber: secondnumber
      };
    case "OPERATOR_UPDATE":
      return {
        ...state,
        operator: action.operator
      };
    // Computing actions
    case "ADD":
      return {
        ...state,
        result: firstnumber + secondnumber
      };
    case "SUBTRACT":
      return { ...state, result: firstnumber - secondnumber };
    case "MULTIPLY":
      return { ...state, result: firstnumber * secondnumber };
    case "DIVIDE":
      return { ...state, result: firstnumber / secondnumber };
    default:
      throw new Error();
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„åŠ©æ‰‹æ–¹æ³•`executeComputation`æ¥æ ¹æ®æ‰€ä½¿ç”¨çš„æ“ä½œç¬¦
åˆ†æ´¾è¿™äº›åŠ¨ä½œ

```
const executeComputation = () => {
    const operator = state.operator;

    switch (operator) {
      case "+":
        dispatch({
          type: "ADD",
          firstnumber: state.firstnumber,
          secondnumber: state.secondnumber
        });
        break;

      case "-":
        dispatch({
          type: "SUBTRACT",
          firstnumber: state.firstnumber,
          secondnumber: state.secondnumber
        });
        break;

      case "*":
        dispatch({
          type: "MULTIPLY",
          firstnumber: state.firstnumber,
          secondnumber: state.secondnumber
        });
        break;

      case "/":
        dispatch({
          type: "DIVIDE",
          firstnumber: state.firstnumber,
          secondnumber: state.secondnumber
        });
        break;

      default:
        throw new Error();
    }
  }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ **state.result** :
æ¥æ˜¾ç¤ºç»“æœ

```
<input type="text" value={state.result} /> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç»“æŸäº†ğŸ‰ï¼ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æˆ‘ä»¬åˆšåˆšåšäº†ä»€ä¹ˆ

* * *

# ç»“è®º

æ ¹æ® [React æ–‡æ¡£](https://reactjs.org/docs/hooks-intro.html)ï¼Œå¦‚æœä½ å·²ç»åœ¨ä½¿ç”¨ç±»ç»„ä»¶ï¼Œä½ å°±ä¸å¿…åˆ‡æ¢åˆ°é’©å­ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¸å†éœ€è¦ä»…ä»…ä¸ºäº†åœ¨ç»„ä»¶ä¸­æ‹¥æœ‰çŠ¶æ€è€Œä½¿ç”¨ç±»ã€‚`useState`å’Œ`useReducer` React é’©å­æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„è¯­æ³•æ¥å®ç°å‡½æ•°ç»„ä»¶ä¸­çš„åˆ›å»º&æ“ä½œçŠ¶æ€ã€‚

å…³äº React é’©å­ä½¿ç”¨è§„åˆ™çš„é‡è¦æ³¨æ„äº‹é¡¹ã€‚

> ä¾‹å¦‚ï¼Œé’©å­ç”¨åœ¨ä½ çš„ç»„ä»¶çš„é¡¶å±‚ï¼›ä¸èƒ½è°ƒç”¨åµŒå¥—åœ¨å¦ä¸€ä¸ªå‡½æ•°ã€if è¯­å¥æˆ–å¾ªç¯ä¸­çš„ hook å‡½æ•°ã€‚æ­¤å¤–ï¼Œå®ƒä»¬å¿…é¡»æ˜¯æ¥å—é“å…·å¹¶è¿”å› JSX çš„ç»„ä»¶å‡½æ•°ã€‚

å…¶ä»–ä¸€äº›å€¼å¾—ä¸€çœ‹çš„å¾ˆé…·çš„ä¾‹å­æ˜¯:

*   `useContext`:æ¥å—ä¸€ä¸ª`React.createContext`ä¸Šä¸‹æ–‡å¯¹è±¡å¹¶è¿”å›è¯¥ä¸Šä¸‹æ–‡çš„å½“å‰ä¸Šä¸‹æ–‡å€¼ã€‚
*   `useEffect`:ç±»ä¼¼äº`componentDidMount`å’Œ`componentDidUpdate`ã€‚
*   `useCallback`:è¿”å›ä¸€ä¸ªè®°å¿†åŒ–çš„å›è°ƒã€‚

è¦é˜…è¯»æ›´å¤šå…³äºé’©å­çš„å†…å®¹ï¼Œè¯·æŸ¥çœ‹é’©å­ API ã€‚

ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« å—ï¼Ÿæœ‰å¸®åŠ©å—ï¼Ÿæœ‰ä»€ä¹ˆæ”¹è¿›çš„å»ºè®®å—ï¼Ÿå¦‚æœæ‚¨æœ‰ä»»ä½•æƒ³æ³•æˆ–æ„è§ï¼Œæˆ‘ä»¬å¾ˆä¹æ„å€¾å¬ï¼

> ***é€šçŸ¥**:æˆ‘å’Œæˆ‘å¦¹å¦¹ [@anssamghezala](https://dev.to/anssamghezala) éƒ½åœ¨å­¦ä¹  Reactï¼Œæ¯ä¸ªæœˆå‘æ–‡ç« **ã€‚åœ¨ twitter ä¸Šå…³æ³¨æˆ‘ä»¬ [@amir_ghezala](https://twitter.com/amir_ghezala) å’Œ [@anssam_ghezala](https://twitter.com/anssam_ghezala) è”ç³»æˆ‘ä»¬å§ï¼:)*****