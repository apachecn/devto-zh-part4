# ä½¿ç”¨ Blynk è·å¾—ç²’å­ç½‘æ ¼çš„ä¸¤ç§æœ€ä½³æ–¹æ³•

> åŸæ–‡:[https://dev . to/jaredwolff/2-best-ways-to-get-particle-mesh-work-with-blynk-2867](https://dev.to/jaredwolff/2-best-ways-to-get-particle-mesh-working-with-blynk-2867)

å†™ app éœ€è¦æ—¶é—´ã€‚ç¼–å†™ä¸€ä¸ªèƒ½åœ¨ç¡¬ä»¶ä¸Šå·¥ä½œçš„ç¨‹åºç”šè‡³è¦èŠ±æ›´å¤šçš„æ—¶é—´ã€‚

å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚

Enter [Blynk](http://blynk.io) .

è¿™æ˜¯ä¸€ä¸ªè¿æ¥åˆ°ç¡¬ä»¶çš„åº”ç”¨ç¨‹åºã€‚å®ƒæœ‰ä¸€ä¸ªå¸¦æœ‰é¢„å»ºéƒ¨ä»¶çš„æ‹–æ”¾ç•Œé¢ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨å‡ ç§’é’Ÿå†…æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ç„¶ååœ¨å‡ åˆ†é’Ÿå†…ä¸Šä¼ æ‚¨çš„è®¾å¤‡ä¼ æ„Ÿå™¨è¯»æ•°ã€‚

Blynk å¯ä»¥ä½¿ç”¨æ°©æ°”ã€ç¡¼æˆ–ä»¥å¤ªç½‘è¿æ¥çš„æ°™æ°”ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¸é€‚ç”¨äºç²’å­ç½‘æ ¼ç½‘ç»œã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½ å°†å­¦ä¹ ä¸€äº›è§£å†³æ–¹æ³•æ¥è®©ä½ çš„åŸºäºç½‘æ ¼çš„é¡¹ç›®è¿è¡Œèµ·æ¥ã€‚

## [](#from-particle-cloud-to-blynk)ä»ç²’å­äº‘åˆ° Blynk

[![Particle Cloud to Blynk](../Images/8f80dc1db92bb2798c9316b03f62cb1e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--E9Uv5nwp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/Copy_of_Mesh_to_Blynk-33d60955-97f6-47d2-a78c-97724c502154.png)

è®©æˆ‘ä»¬ä»æœ€ç®€å•çš„ç”¨ä¾‹å¼€å§‹:ä»ä»»ä½•ç²’å­è®¾å¤‡è·å–æ•°æ®åˆ° Blynkã€‚

æ¥è‡ª[ç²’å­å¹³æ–¹](http://jaredwolff.com/homemade-indoor-air-quality-sensor/)çš„ç©ºæ°”è´¨é‡æ•°æ®å¯¹äºè¿™ä¸ªä¾‹å­æ¥è¯´æ˜¯å®Œç¾çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘è¦ç”¨è¿™ä¸ªã€‚

é¦–å…ˆè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ Blynk é¡¹ç›®

[![Create Project in Blynk](../Images/18171423b34baaec50589b9cc8f6cc47.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--c1UVtiA3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/IMG_2233-2a80b63a-b88b-4e58-a50b-5fc02923ae23.png)

è·å–**è®¤è¯ä»¤ç‰Œ**æˆ‘ä»¬ç¨åä¼šç”¨åˆ°å®ƒã€‚æ‚¨å¯ä»¥**ç‚¹å‡»è®¤è¯ä»¤ç‰Œ**å°†å…¶å¤åˆ¶åˆ°æ‚¨çš„å‰ªè´´æ¿ã€‚

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä¸ºè¿™ä¸ªä¾‹å­æ·»åŠ ä¸€ä¸ª**è¶…çº§å›¾è¡¨**ã€‚

[![Add a SuperChart](../Images/339b6f1dcf0e68a603ecf5eb215cd699.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xR3wqR-K--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/IMG_2231-308d94bf-63f4-40a6-98e3-e49ced05c90a.png)

é…ç½®è¶…çº§å›¾è¡¨ä»¥ä½¿ç”¨è™šæ‹Ÿå¼•è„šã€‚æˆ‘ä»¬æ— æ³•è®¿é—®è®¾å¤‡ä¸Šçš„å®é™…ç¡¬ä»¶å¼•è„šã€‚ **V0** æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚

[![Select Virtual Pin 0](../Images/db4dab2a2b2646f65d8286f7fe005128.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--hC-hFB60--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/IMG_2232-e53a0997-453e-47ee-b2d1-27a30dc12dfc.png)

è¦æ›´æ–° Blynk ä¸­çš„å€¼ï¼Œæˆ‘ä»¬å¿…é¡»ä»¥æŸç§æ–¹å¼è¿›è¡Œè¿æ¥ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨**ç²’å­æ§åˆ¶å°ä¸­ä½¿ç”¨ä¸€ä¸ª**é›†æˆ**ã€‚**

åœ¨ç²’å­æ§åˆ¶å°ä¸­ï¼Œå•å‡»ç»ˆç«¯å›¾æ ‡ä¸‹æ–¹çš„å›¾æ ‡ã€‚ç„¶åç‚¹å‡»**æ–°å»ºé›†æˆã€‚**

[![Create new Integration in Particle Console](../Images/a95534b86296c27beb7ba824687cdfe0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--KsG0Mh5H--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/Screen_Shot_2019-07-27_at_10-33b85b6e-d685-4c1a-b639-423df7b2dd85.43.37_AM.png)

çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œçœ‹çœ‹æˆ‘æ˜¯å¦‚ä½•å¡«å†™æ‰€æœ‰å†…å®¹çš„ã€‚

[![Enter all the information into the New Integration Screen](../Images/e881f568fff0503539f99198f02076f7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--l1PNEWa---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/Screen_Shot_2019-07-24_at_3-a5433944-8a2a-4b0d-81b6-faa4c038bd65.27.06_PM.png)

ç²’å­å¹³æ–¹ä½¿ç”¨**äº‹ä»¶åç§°**ä½œä¸º* *** `blob`ã€‚å¯¹äºå…¶ä»–é¡¹ç›®ï¼Œè¿™å¯èƒ½æœ‰æ‰€ä¸åŒã€‚* *è¯·è®°ä½:**æ‚¨çš„æ´»åŠ¨åç§°ä¸ä»`Particle.publish(eventName, data)`å¼€å§‹çš„åç§°ç›¸åŒã€‚

**URL** è¢«è®¾ç½®ä¸ºä½¿ç”¨`blink-cloud.com`åœ°å€ã€‚æ ¹æ®ä»–ä»¬çš„ APIï¼Œä¸€ä¸ªç¤ºä¾‹ URL çœ‹èµ·æ¥åƒ:

[![Blink cloud write pin API call](../Images/a7dea660111a741ac1d9512b5ef8338f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--2BRz3noG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/Screen_Shot_2019-07-24_at_4-730022d3-f758-43b3-b4cc-bb3012d22d9e.44.06_PM.png)

æˆ‘è¿˜ä¼šåœ¨è¿™é‡ŒåŒ…æ‹¬å®ƒï¼Œè¿™æ ·æ›´å®¹æ˜“å¤åˆ¶

```
http://blynk-cloud.com/auth_token/update/pin?value=value 
```

ç”¨æˆ‘ä»¬ä¹‹å‰å¾—åˆ°çš„**è®¤è¯ä»¤ç‰Œ**æ›¿æ¢`auth_token`ã€‚

ç”¨æˆ‘ä»¬æƒ³è¦ä¿®æ”¹çš„è™šæ‹Ÿ pin æ›¿æ¢`pin`ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ **V0**

ç”¨æ‚¨æƒ³è¦ä½¿ç”¨çš„å€¼æ›¿æ¢`value`ã€‚

æˆ‘ä»¬å°†å¼•ç”¨ç²’å­å¹³æ–¹`blob`ä¸­çš„ä¸€ä¸ªå€¼ã€‚å®ƒæ˜¯è¿™æ ·ç»„ç»‡çš„:

```
{
  "temperature": 28.60,
  "humidity": 45.00,
  "sgp30_tvoc": 18,
  "sgp30_c02": 400,
  "bme680_temp": 27.36,
  "bme680_pres": 1012.43,
  "bme680_hum": 43.80,
  "bme680_iaq": 43.90,
  "bme680_temp_calc": 27.30,
  "bme680_hum_calc": 43.97
} 
```

ç²’å­ä½¿ç”¨[å°èƒ¡å­æ¨¡æ¿](http://mustache.github.io/mustache.5.html)ã€‚ä»ä¸Šé¢çš„æˆªå›¾å¯ä»¥çœ‹å‡ºï¼Œå¯ä»¥å°†`value`è®¾ç½®ä¸º`{{{temperature}}}`ã€‚

**æ³¨æ„:**å¦‚æœä½ æ­£åœ¨åšè‡ªå·±çš„é¡¹ç›®ï¼Œç”¨ JSON å‘å¸ƒæ˜¯å¾ˆé‡è¦çš„ã€‚ä½œä¸ºå‚è€ƒï¼Œ`Particle.publish`å‘½ä»¤çœ‹èµ·æ¥åƒ:

```
// Publish data
Particle.publish("blob", String::format("{\"temperature\":%.2f,\"humidity\":%.2f}",si7021_data.temperature, si7021_data.humidity) , PRIVATE, WITH_ACK); 
```

ç‚¹å‡»å±å¹•åº•éƒ¨çš„**è“è‰²å¤§ä¿å­˜æŒ‰é’®**ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥è¿›å…¥ä¸‹ä¸€æ­¥äº†ï¼

### [](#testing)æµ‹è¯•

è‡ªä»åˆ›å»ºæˆ‘ä»¬çš„ Particle Webhook é›†æˆä»¥æ¥ï¼Œå®ƒä¸€ç›´åœ¨å‘ Blynk å‘å¸ƒæ•°æ®ã€‚æˆ‘ä»¬å»çœ‹çœ‹æœ‰æ²¡æœ‰ç”¨ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å›åˆ° Blynk åº”ç”¨ç¨‹åºã€‚**ç‚¹å‡» Blynk å±å¹•å³ä¸Šè§’çš„æ’­æ”¾æŒ‰é’®**ã€‚

[![Watch data come into Blynk app](../Images/dd8cd682e9882ac762f46964f7f1dd4e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--96AjiMOt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/IMG_2234-43cebeaa-2dd4-401c-84e5-b365953f4a66.png)

å¦‚æœæ‚¨çš„é›†æˆå·²ç»è¿è¡Œäº†ä¸€æ®µæ—¶é—´ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°å›¾è¡¨ä¸­å¡«å……äº†æ•°æ®ï¼å¦‚æœä½ ä»€ä¹ˆä¹Ÿæ²¡çœ‹è§ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥æ—¥å¿—ã€‚

**å›åˆ°ä½ çš„ç§¯åˆ†**å’Œ**å‘åº•éƒ¨æ»šåŠ¨**ã€‚æˆ‘ä»¬æƒ³çœ‹çœ‹æ˜¯å¦æœ‰é”™è¯¯ã€‚

ä¸ç¡®å®šé‚£çœ‹èµ·æ¥åƒä»€ä¹ˆï¼Ÿè¿™æ˜¯ä¸€ä¸ªæœ‰è¯¯å·®çš„ç§¯åˆ†çš„ä¾‹å­:

[![Particle console integration errors](../Images/80d45c9acea075889a3df1ed789f44f2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--k28hyZ0v--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/Screen_Shot_2019-07-24_at_4-47e820b4-1636-406e-8ba1-ff22cf899478.55.36_PM.png)

æ‚¨å¯ä»¥è¿›ä¸€æ­¥å‘ä¸‹æ»šåŠ¨ï¼Œè°ƒæŸ¥é”™è¯¯å‘ç”Ÿçš„åŸå› ã€‚

[![Investigate Particle Integration failure further](../Images/8c775d53184efc845893bb476e8bffd4.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--0muRxQGz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/Screen_Shot_2019-07-24_at_4-2e5843f3-1960-41a7-90b0-d80432d6ef2d.56.36_PM.png)

åº•éƒ¨ä¸€ç›´æ˜¾ç¤ºæ¥è‡ªæœåŠ¡å™¨çš„å“åº”ã€‚æ ¹æ®æœåŠ¡çš„ä¸åŒï¼Œå®ƒä»¬ä¼šç»™å‡º API è°ƒç”¨å¤±è´¥çš„åŸå› ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä¸¢å¤±äº†ä¸¤ä¸ªå­—æ®µçš„å€¼ã€‚

### [](#particle-to-blynk-is-working)ç²’å­åˆ° Blynk æ­£åœ¨å·¥ä½œï¼

ç°åœ¨ï¼Œæ‚¨æœ‰äº†åœ¨ Blynk ä¸­å‘å¸ƒè™šæ‹Ÿ pin çš„åŸºæœ¬æ–¹æ³•ã€‚ä¸è¿‡ä¹Ÿæœ‰ç¼ºç‚¹ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæ‚¨å¿…é¡»ä¸ºæ¯ä¸ªä¿¡å·è™šæ‹Ÿå¼•è„šåˆ›å»ºä¸€ä¸ªé›†æˆã€‚å¦‚æœä½ æœ‰å…«ä¸ªè¯»æ•°ï¼Œé‚£æ„å‘³ç€å…«ä¸ªç§¯åˆ†ã€‚

çœŸæ‰«å…´ã€‚

åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†å­¦ä¹ é…ç½® Blynk çš„ä¸åŒæ–¹æ³•ã€‚æˆ‘ä»¬èµ°å§ï¼

## [](#local-mesh-using-blynk-library)å±€éƒ¨ç½‘æ ¼ä½¿ç”¨ Blynk åº“

[![Particle Mesh to Blynk](../Images/c3a258c96d00513203d7d485453629af.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--tJzO6Bgg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/Mesh_to_Blynk-0a66867b-a193-4b97-801a-b780c9a481e2.png)

ä¸ç¬¬ä¸€ç§æ–¹æ³•ä¸åŒï¼Œæˆ‘ä»¬å°†åªå…³æ³¨æ”¹å˜å›ºä»¶ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨æ°©ã€ç¡¼æˆ–ä»¥å¤ªç½‘è¿æ¥çš„æ°™å’Œä¸€ä¸ªæ™®é€šæ°™ã€‚åœ¨æœ¬æ•™ç¨‹çš„å…¶ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†è¿™äº›è®¾å¤‡ç§°ä¸ºâ€œè¾¹ç¼˜è·¯ç”±å™¨â€ã€‚

æ°™ä¼šè¿è¡Œç²’å­å¹³æ–¹ä»£ç ã€‚æˆ‘ä»¬å°†ä½¿ç”¨`Mesh.publish`è€Œä¸æ˜¯`Particle.publish`ã€‚è¿™å…è®¸æˆ‘ä»¬ä»…å‘æœ¬åœ°ç½‘çŠ¶ç½‘ç»œå‘å¸ƒã€‚

åŒæ—¶ï¼Œè¾¹ç¼˜è·¯ç”±å™¨æ­£åœ¨ç›‘å¬æ¶ˆæ¯ã€‚å®ƒæ”¶é›†è¿™äº›å€¼ï¼Œç„¶åä½¿ç”¨ Blynk API å‘å¸ƒåˆ°åº”ç”¨ç¨‹åºã€‚

ä»¥ä¸‹æ˜¯æ­¥éª¤:

### [](#setup-our-edge-router)è®¾ç½®æˆ‘ä»¬çš„è¾¹ç¼˜è·¯ç”±å™¨

æŒ‰ä¸‹ **Cmd+Shift+P** è°ƒå‡ºèœå•ã€‚é”®å…¥**å®‰è£…åº“ã€‚**

[![Install library in Visual Studio Code](../Images/f5bcdaafe6f72583baf516fc1e910586.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--YUKXhTB5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/Screen_Shot_2019-07-28_at_4-f8149823-96fc-460f-b47e-2bcf56b670c2.50.29_PM.png)

ç„¶åè¾“å…¥ **blynkã€‚**å¦‚æœä½ è¿˜æ²¡æœ‰ä¸‹è½½çš„è¯ï¼Œè¿™ä¸ªåº“åº”è¯¥å¯ä»¥ä¸‹è½½ã€‚

å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥å°†è¿™ä¸ªåº“åŒ…å«åœ¨ä½ çš„`.ino`æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
#include <blynk.h> 
```

åœ¨æˆ‘ä»¬çš„`setup()`å‡½æ•°ä¸­ï¼Œè®©æˆ‘ä»¬åˆå§‹åŒ– Blynk åº“:

```
// Put initialization like pinMode and begin functions here.
Blynk.begin(auth); 
```

åœ¨æˆ‘ä»¬çš„`setup()`å‡½æ•°ä¸­ï¼Œè®¢é˜…`temperature`äº‹ä»¶ã€‚è¿æ¥çš„æ°™æ°”ä¼šäº§ç”Ÿæ­¤äº‹ä»¶ã€‚

```
// Subscribe to temperature events
Mesh.subscribe("temperature",tempHandler); 
```

ç°åœ¨è¿™æ ·å®šä¹‰`tempHandler`:

```
// Temperature event handler for mesh
void tempHandler(const char *event, const char *data){
} 
```

åœ¨`loop()`å‡½æ•°ä¸­ï¼Œç¡®ä¿æˆ‘ä»¬æœ‰`Blynk.run();`

```
// loop() runs over and over again, as quickly as it can execute.
void loop() {
  // The core of your code will likely live here.
  Blynk.run();
} 
```

æœ€åï¼Œå¯¹äº`tempHandler`,æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªè°ƒè¯•è¾“å‡ºæ¥ç›‘æ§äº‹ä»¶ã€‚æˆ‘ç”¨è¿‡è¿™æ ·çš„ä¸œè¥¿:

```
Serial.printlnf("event=%s data=%s", event, data ? data : "NULL"); 
```

ç²’å­åœ¨ä»–ä»¬çš„ä¸€äº›ä¾‹å­ä¸­ä½¿ç”¨äº†è¿™ä¸€ç‚¹ã€‚å®ƒä¹Ÿéå¸¸é€‚åˆæˆ‘ä»¬çš„ç›®çš„ï¼

**æ³¨æ„:**ç¡®ä¿ä½ å·²ç»åœ¨ä½ çš„`Setup()`å‡½æ•°ä¸­è°ƒç”¨äº†`Serial.begin()`ï¼

æ‰€ä»¥ç°åœ¨æˆ‘ä»¬æœ‰`tempHandler`æ¥æ¥æ”¶æ¥è‡ªæ°™çš„æ•°æ®ã€‚è¾¹ç¼˜è·¯ç”±å™¨ç°åœ¨å¯ä»¥è·å–è¯¥æ•°æ®å¹¶å°†å…¶ä¸Šä¼ åˆ° Blynkã€‚è®©æˆ‘ä»¬ä¸ºæ­¤ä½¿ç”¨`Blynk.virtualWrite`å‡½æ•°:

```
// Write the data
Blynk.virtualWrite(V0, data); 
```

è¿™å°†æŠŠæ¸©åº¦å€¼ä»æ°™å†™å…¥`V0`å¼•è„šã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„ä¸æ˜¯ V0ï¼Œè¯·ç¡®ä¿åœ¨è¿™é‡Œæ›´æ”¹è¯¥å€¼ã€‚(è¿™ä¸ä¹‹å‰çš„*ç²’å­äº‘åˆ° Blynk* çš„ä¾‹å­è®¾ç½®ç›¸åŒ)

[![DataStream V0](../Images/db4dab2a2b2646f65d8286f7fe005128.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--hC-hFB60--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/IMG_2232-e53a0997-453e-47ee-b2d1-27a30dc12dfc.png)

è¾¹ç¼˜è·¯ç”±å™¨çš„æœ€ç»ˆä»£ç åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºã€‚å½“ä½ å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œç¼–è¯‘ä¸€ä¸ª flash åˆ°ä½ çš„è®¾å¤‡ä¸Šï¼

```
/*
 * Project blynk-argon-forwarder
 * Description: Argon Blynk forwarder for Particle Mesh. Forwards data from mesh connected devices to Blynk.
 * Author: Jared Wolff
 * Date: 7/25/2019
 */

#include <blynk.h>

char auth[] = "<ENTER YOUR AUTH KEY>";

// Temperature event handler for mesh
void tempHandler(const char *event, const char *data){
  Serial.printlnf("event=%s data=%s", event, data ? data : "NULL");

  // Write the data
  Blynk.virtualWrite(V0, data);
}

// setup() runs once, when the device is first turned on.
void setup() {

  // Serial for debugging
  Serial.begin();

  // Put initialization like pinMode and begin functions here.
  Blynk.begin(auth);

  // Subscribe to temperature events
  Mesh.subscribe("temperature",tempHandler);

}

// loop() runs over and over again, as quickly as it can execute.
void loop() {
  // The core of your code will likely live here.
  Blynk.run();

} 
```

è®°å¾—ä½¿ç”¨ Blynk åº”ç”¨ç¨‹åºä¸­çš„`AUTH TOKEN`è®¾ç½®`auth`ï¼

### [](#setting-up-a-xenon)è®¾ç½®æ°™æ°”

[![Xenon!](../Images/1ffb424a129ece47593e72754a8b5c85.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ZVVSG7qY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/two-best-ways-to-get-particle-mesh-working-with-blynk/images/Copy_of_Compose-a34be8da-a352-4a76-af8c-8c83e65efe50.png)

åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚è¿™ä¸€æ¬¡ï¼Œå®ƒå°†ä¸ºæ°™æ•è·â€œæ¸©åº¦æ•°æ®â€ã€‚

è®©æˆ‘ä»¬åœ¨æ–‡ä»¶çš„é¡¶éƒ¨æ·»åŠ ä¸€ä¸ªåä¸º`time_millis`çš„å˜é‡ã€‚ç±»å‹æ˜¯`system_tick_t`ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒä¸ºæ¸©åº¦è¯»æ•°åˆ›å»ºä¸€ä¸ªç®€å•çš„å»¶æ—¶è®¡æ—¶å™¨ã€‚

```
// Global variable to track time (used for temp sensor readings)
system_tick_t time_millis; 
```

å¯¹äºé—´éš”ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé¢„å¤„ç†å™¨å®šä¹‰

```
#define INTERVAL_MS 2000 
```

ç°åœ¨è®©æˆ‘ä»¬åœ¨`loop()`å‡½æ•°ä¸­å°†è¿™äº›è”ç³»åœ¨ä¸€èµ·ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª`if`è¯­å¥æ¥æ¯”è¾ƒæˆ‘ä»¬å½“å‰çš„ç³»ç»Ÿæ—¶é—´å’Œä¸Šä¸€ä¸ªäº‹ä»¶åŠ ä¸Šåç§»é‡çš„æ—¶é—´ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªç®€å•çš„è®¡æ—¶å™¨ï¼Œè¿™æ˜¯æœ€å¥½çš„æ–¹æ³•ä¹‹ä¸€ï¼

```
// Check if our interval > 2000ms
  if( millis() - time_millis > INTERVAL_MS ) {
  } 
```

ä¸€æ—¦æˆ‘ä»¬è¿›å»äº†ï¼Œç¡®ä¿ä½ é‡ç½®äº†`timer_millis`:

```
 //Set time to the 'current time' in millis
    time_millis = millis(); 
```

ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`random()`å‡½æ•°ç”Ÿæˆæ¸©åº¦å€¼ã€‚æˆ‘ä»¬å°†ä½¿ç”¨åŒå‚æ•°å˜é‡ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥è®¾ç½®æœ€å°å€¼å’Œæœ€å¤§å€¼:

```
 // Create a random number
    int rand = random(20,30); 
```

æœ€åï¼Œæˆ‘ä»¬å°†`Mesh.publish`å€¼:

```
 // Publish our "temperature" value
    Mesh.publish("temperature",String::format("%d",rand)); 
```

å½“è¿™ä¸ªä¾‹å­è¿è¡Œæ—¶ï¼Œæ¸©åº¦è¢«å¹¿æ’­åˆ°ç½‘çŠ¶ç½‘ç»œã€‚ç„¶åï¼Œè¾¹ç¼˜è·¯ç”±å™¨æ¥æ”¶å®ƒå¹¶å°†å…¶è½¬å‘ç»™ Blynkï¼

ä½ å¯ä»¥éšæ—¶åˆ·æ–°è¿™ä¸ªå›ºä»¶ã€‚è¿™æ˜¯æ°™çš„å®Œæ•´ä»£ç ï¼Œè¿™æ ·ä½ å°±å¯ä»¥äº¤å‰æ¯”è¾ƒäº†:

```
/*
 * Project blynk-xenon-rgb
 * Description: Recieve RGB level from connected Edge Router. Sends simiulated temperature values via mesh to the Blynk cloud.
 * Author: Jared Wolff
 * Date: 7/25/2019
 */

// How often we update the temperature
#define INTERVAL_MS 2000

// Global variable to track time (used for temp sensor readings)
system_tick_t time_millis;
// setup() runs once, when the device is first turned on.
void setup() {

  // Set time to 0
  time_millis = 0;

}

// loop() runs over and over again, as quickly as it can execute.
void loop() {

  // Check if our interval > 2000ms
  if( millis() - time_millis > INTERVAL_MS ) {
    //Set time to the 'current time' in millis
    time_millis = millis();

    // Create a random number
    int rand = random(20,30);

    // Publish our "temperature" value
    Mesh.publish("temperature",String::format("%d",rand));

  }

} 
```

### [](#give-it-a-test)æµ‹è¯•ä¸€ä¸‹å§ï¼

æ—¢ç„¶æˆ‘ä»¬å·²ç»å¯¹è¿™ä¸¤ä¸ªè®¾å¤‡è¿›è¡Œäº†ç¼–ç¨‹ï¼Œè®©æˆ‘ä»¬è®©å®ƒä»¬ç›¸äº’é€šä¿¡ã€‚

æˆ‘å·²ç»ç”¨åä¸º **8f-9 çš„ç½‘çŠ¶ç½‘ç»œå»ºç«‹äº†æ°©ã€‚**æˆ‘å°†è§£é‡Šå¦‚ä½•å°†æ°™æ°”è¿æ¥åˆ°å‘½ä»¤è¡Œç•Œé¢ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç²’å­åº”ç”¨ç¨‹åºã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°† Xenon è¿æ¥åˆ° USBï¼Œå¹¶è®©å®ƒè¿›å…¥ç›‘å¬æ¨¡å¼ã€‚è¿æ¥åï¼ŒæŒ‰ä½**æ¨¡å¼æŒ‰é’®**ç›´åˆ°**é—ªçƒè“è‰²ã€‚**

[https://www.youtube.com/embed/C-0_m3GUupg](https://www.youtube.com/embed/C-0_m3GUupg)

ç„¶åä½¿ç”¨ CLI è®¾ç½®ç½‘çŠ¶ç½‘ç»œã€‚é¦–å…ˆè®©æˆ‘ä»¬è·å–è®¾å¤‡ ID:

```
Jareds-MacBook-Pro:nrfjprog.sh jaredwolff$ particle identify
? Which device did you mean?
  /dev/tty.usbmodem146401 - Argon
â¯ /dev/tty.usbmodem146101 - Xenon 
```

å¦‚æœæ‚¨æœ‰å¤šä¸ªè®¾å¤‡è¿æ¥ï¼Œè¯·ç¡®ä¿æ‚¨é€‰æ‹©äº†æ­£ç¡®çš„ä¸€ä¸ªï¼å¦‚æœå‡ºç°æç¤ºï¼Œè¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡ã€‚æ‚¨çš„è¾“å‡ºåº”è¯¥ç±»ä¼¼äº:

```
Your device id is e00fce682d9285fbf4412345
Your system firmware version is 1.3.0-rc.1 
```

ä¸‹ä¸€æ­¥æˆ‘ä»¬éœ€è¦ id ä¸ºçš„**ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿è¡Œ`particle mesh`å‘½ä»¤ã€‚**

```
particle mesh add <xenon id> <id of your argon, boron, etc> 
```

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­:

```
particle mesh add e00fce682d9285fbf4412345 hamster_turkey
? Enter the network password [hidden]
â–„ Adding the device to the network... 
```

ç»“æŸæ—¶ï¼Œä½ ä¼šçœ‹åˆ°:

```
Done! The device should now connect to the cloud. 
```

è¿™ä¸ªè¿‡ç¨‹å¹¶ä¸å®Œç¾ã€‚åœ¨`Adding the device to the network...`é˜¶æ®µï¼Œæˆ‘å¿…é¡»ç”¨`particle mesh remove`ç§»é™¤æ°™æ°”ã€‚é‡ç½®æ°©æ°”åï¼Œé‡æ–°è¿è¡Œ`particle mesh add`å‘½ä»¤ã€‚

ç°åœ¨åˆ°äº†ç»ˆåœºã€‚

ä½¿ç”¨`particle serial monitor --follow`å°†ä¸¤ä¸ªè®¾å¤‡ä¸²è¡Œè¿æ¥

å¦‚æœæ‚¨è¿æ¥äº†ä¸¤ä¸ªè®¾å¤‡ï¼Œ`particle serial monitor`å°†æç¤ºæ‚¨é€‰æ‹©:

```
Jareds-MacBook-Pro:blynk-xenon-rgb jaredwolff$ particle serial monitor --follow
Polling for available serial device...
? Which device did you mean? /dev/tty.usbmodem146101 - Xenon
Opening serial monitor for com port: "/dev/tty.usbmodem146101"
Serial monitor opened successfully: 
```

**è®°ä½:**ä½ å¿…é¡»ä¸ºæ¯ä¸ªä½ æƒ³è¿æ¥çš„è®¾å¤‡è¿è¡Œ`particle serial monitor`ã€‚

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°æ¥è‡ªè¾¹ç¼˜è·¯ç”±å™¨çš„ä¸€äº›è¾“å‡ºï¼

```
Serial monitor opened successfully:
event=temperature data=21
event=temperature data=28
event=temperature data=21
event=temperature data=27
event=temperature data=28
event=temperature data=26
event=temperature data=23
event=temperature data=26
event=temperature data=21 
```

æŸ¥çœ‹åº”ç”¨ç¨‹åºï¼Œ**è¶…çº§å›¾è¡¨**åº”è¯¥ä¼šå¯¹è¿™äº›æ–°æ•°æ®åšå‡ºååº”ã€‚

å°†å‘½ä»¤è¡Œä¸­çš„æœ€åä¸€ä¸ªå€¼ä¸å›¾è¡¨ä¸­çš„æœ€åä¸€ä¸ªå€¼è¿›è¡Œæ¯”è¾ƒï¼Ÿå®ƒä»¬åŒ¹é…å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆæ‚¨å·²ç»å®Œæˆäº†è¿™ä¸ªç¤ºä¾‹ï¼

## [](#conclusion)ç»“è®º

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å·²ç»å­¦ä¹ äº†å¦‚ä½•å°†ç²’å­äº‘æ•°æ®è½¬å‘åˆ° Blynkã€‚ä½ è¿˜å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨ç²’å­æ°©ã€ç¡¼æˆ–ä»¥å¤ªç½‘è¿æ¥æ°™æ¥åšåŒæ ·çš„äº‹æƒ…ã€‚æ•¬ç•è€¶ã€‚ğŸ˜ğŸ‘

ç°åœ¨ä½ å·²ç»æœ‰äº†å·¥å…·æ¥ä½¿ä½ çš„ç²’å­ç½‘æ ¼é¡¹ç›®é—ªçƒï¼Œæ˜¯æ—¶å€™å¼€å§‹å·¥ä½œäº†ï¼

**å–œæ¬¢è¿™ä¸ªå¸–å­ï¼Ÿ**

è¿™ç¯‡æ–‡ç« æ‘˜è‡ªæˆ‘å³å°†å‘å¸ƒçš„*ç²’å­ç½‘æ ¼ç»ˆææŒ‡å—*ã€‚éšç€å‘å¸ƒæ—¶é—´çš„ä¸´è¿‘ï¼Œæˆ‘ä¼šåœ¨é‚®ä»¶åˆ—è¡¨ä¸­åˆ†äº«æ›´å¤šç‹¬å®¶å†…å®¹ã€‚[ä½ å¯ä»¥åœ¨è¿™é‡Œæ³¨å†Œæ›´æ–°ã€‚](https://jaredwolff.com/the-ultimate-guide-to-particle-mesh/)

**è¿˜æœ‰ç–‘é—®ï¼Ÿ**

ç•™ä¸‹ä½ çš„è¯„è®ºæˆ–è€…ç»™æˆ‘å‘ä¸€æ¡çŸ­ä¿¡ã€‚