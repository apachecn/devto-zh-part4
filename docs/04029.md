# æ€§èƒ½:ä¸ç¯å¢ƒå…±èˆ

> åŸæ–‡:[https://dev . to/negue/performance-tree-shake-with-environment-ts-ck3](https://dev.to/negue/performance-tree-shake-with-environment-ts-ck3)

æ‚¨å¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œæ‚¨åªéœ€è¦åœ¨å¼€å‘è¿‡ç¨‹ä¸­å­˜åœ¨çš„æ¨¡å—ï¼Œè€Œä¸éœ€è¦åœ¨äº§å“æ„å»ºä¸­å­˜åœ¨ã€‚

ä¾‹å¦‚:

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‡ ä¹ä¸€ç›´åœ¨ä½¿ç”¨`@ngrx/store-devtools`ã€‚

ä¸ºäº†åœ¨æˆ‘çš„äº§å“æ„å»ºä¸­æ²¡æœ‰è¿™ä¸ªæ¨¡å—ï¼Œæˆ‘æƒ³ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ç®€å•çš„ï¼Œåªè¦ä½¿ç”¨ç¯å¢ƒæ¡ä»¶å°†å®ƒä»æ„å»ºä¸­æ’é™¤ã€‚

<figure>

```
import {environment} from '../environments/environment';
import {StoreDevtoolsModule} from '@ngrx/store-devtools';

const additionalImports = [];

if (!environment.production) {
  additionalImports.push(StoreDevtoolsModule.instrument({
    maxAge: 25
  }));
}

@NgModule({
  import: [
    ...additionalImports
  ]
}) 
```

<figcaption>app.module.ts</figcaption>

</figure>

ä½†æ˜¯ç¼–è¯‘å™¨ä»ç„¶ä¼šå°†æ¨¡å—æ·»åŠ åˆ°äº§å“ç‰ˆæœ¬ä¸­:å¤§çº¦ä¸ºè¿™ä¸ªæ¨¡å—æ·»åŠ äº†`18 kb`ï¼Œå½“ç„¶ä¸æ˜¯â€œé‚£ä¹ˆå¤šâ€,ä½†æ˜¯è¿™åŠ èµ·æ¥å°±æ˜¯åŠ è½½+è§£æ/è¯„ä¼°æ—¶é—´ï¼Œè¿™å¯èƒ½æ˜¯ä½ ä¸éœ€è¦çš„ã€‚

## [](#using-raw-environmentts-endraw-the-better-way-)ä½¿ç”¨`environment.ts`æ›´å¥½çš„æ–¹å¼:)

ç”±äº angular ä¸º`environment.ts`å’Œ`environment.prod.ts`æ·»åŠ äº†ä¸€ä¸ªé»˜è®¤çš„`fileReplacements`é…ç½®ï¼Œè¿™äº›é…ç½®å°†åªåœ¨å¼€å‘/ç”Ÿäº§æ„å»ºæœŸé—´ç¼–è¯‘ã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥ä¸ºæˆ‘ä»¬çš„å¼€å‘é˜¶æ®µæ·»åŠ ä¸åŒçš„æ¨¡å—ï¼Œæˆ–è€…ä¸ºç”Ÿäº§é˜¶æ®µæ·»åŠ ä¸åŒçš„æ¨¡å—ã€‚

<figure>

```
import {StoreDevtoolsModule} from '@ngrx/store-devtools';

export const environment = {
  production: false,
  modules: [
    StoreDevtoolsModule.instrument({
      maxAge: 25
    }),
  ]
}; 
```

<figcaption>environment.ts</figcaption>

</figure>

<figure>

```
import {environment} from '../environments/environment';

@NgModule({
  import: [
    ...environment.modules
  ]
}) 
```

<figcaption>app.module.ts</figcaption>

</figure>

## [](#tada-now-that-module-is-only-added-during-development-and-not-in-your-production-build-tada)ğŸ‰ç°åœ¨ï¼Œè¯¥æ¨¡å—ä»…åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ·»åŠ ï¼Œè€Œä¸æ˜¯åœ¨æ‚¨çš„ç”Ÿäº§æ„å»ºä¸­æ·»åŠ ğŸ‰

ä¹Ÿè®¸åœ¨æœªæ¥æœ‰å¯èƒ½ä»…ä»…é€šè¿‡ä½¿ç”¨`if (environment.production)`æ¥åŠ¨æ‘‡è¿™äº›ç§ç±»ï¼Œä½†æ˜¯åœ¨é‚£ä¹‹å‰æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ³•ã€‚

### [](#-raw-protip-1-endraw-use-an-interface-for-your-environment-files)`Protip 1:`ä¸ºä½ çš„ç¯å¢ƒæ–‡ä»¶ä½¿ç”¨ä¸€ä¸ªæ¥å£ã€‚

æœ‰ä¸€ä¸ªç±»ä¼¼äº
çš„`environment.def.ts`æ–‡ä»¶

```
export interface Environment {
  production: boolean;
  modules: any[];
} 
```

è¿™æ ·ä¸¤è€…(æˆ–è€…æ›´å¤šï¼Ÿ)ç¯å¢ƒè‡³å°‘åœ¨å±æ€§ä¸Šæ˜¯ä¸€è‡´çš„ã€‚

### [](#-raw-protip-2-endraw-use-a-pathalias)`Protip 2:`ä½¿ç”¨è·¯å¾„åˆ«å

<figure>

```
 "compilerOptions":  {  "paths":  {  "@myApp/env":  ["apps/myApp/src/environments/environment"]  }  } 
```

<figcaption>tsconfig.json</figcaption>

</figure>

ç„¶åä½ å¯ä»¥é€šè¿‡`@myApp/env`è€Œä¸æ˜¯`../../../..and/so/on../../environment`å°†ä½ çš„ç¯å¢ƒå¯¼å…¥åˆ°ä»»ä½•æ–‡ä»¶ä¸­

* * *

### æˆ‘çœŸçš„å¾ˆæƒ³çŸ¥é“ï¼Œä½ ä»¬æ˜¯å¦åªåœ¨å¼€å‘/ç”Ÿäº§æœŸé—´ä½¿ç”¨æ¨¡å—ï¼Ÿ