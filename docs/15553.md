# ä¸ react ä¸Šä¸‹æ–‡å…±äº«çŠ¶æ€å’ŒåŠŸèƒ½

> åŸæ–‡:[https://dev . to/hlebon/share-States-and-functionality-with-react-context-4oh](https://dev.to/hlebon/share-states-and-functionalities-with-react-context-4oh)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ **React Context** ä¸ºä¸€ç»„ç»„ä»¶åˆ›å»ºå¹¶æä¾›çŠ¶æ€å’ŒåŠŸèƒ½ã€‚

## [](#a-basic-radio-button-component)ä¸€ä¸ªåŸºæœ¬å•é€‰æŒ‰é’®ç»„ä»¶

é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬ç§°ä¹‹ä¸º **RadioButton** çš„ç»„ä»¶ï¼Œå®ƒå°†æ¥æ”¶ **checked** ã€ **value** ã€ **onChange** å’Œ **children** ä½œä¸ºé“å…·ã€‚æˆ‘ä»¬å¸Œæœ›å°†**â€˜inputâ€™**html æ ‡ç­¾å°è£…åˆ° react ç»„ä»¶ä¸­ï¼Œä½¿å…¶å¯é‡ç”¨ã€‚

```
import React from "react";

function RadioButton({ checked, value, onChange, children }){
  return (
    <label>
      <input
        type="radio"
        value={value}
        checked={checked}
        onChange={({ target }) => onChange(target.value)}
      />
      { children }
    </label>
  )
} 
```

è¿™ä¸ªç»„ä»¶ä½œä¸ºä¸€ä¸ª**è¡¨ç¤ºç»„ä»¶**å·¥ä½œï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªæ­£å¼çš„ä¸œè¥¿ï¼Œä½†æ˜¯å¾ˆå¤šäººå–œæ¬¢ç»™æ²¡æœ‰æœ¬åœ°çŠ¶æ€å’Œè¿”å› jsx å…ƒç´ çš„ç»„ä»¶èµ·è¿™ä¸ªåå­—ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç»„ä»¶æ¥æ˜¾ç¤ºä¸€ç»„ **type="radio"** çš„è¾“å…¥ï¼Œä¾‹å¦‚åŠ¨ç‰©ã€‚

```
function Animals(){
  return (
    <div>
      <RadioButton>ğŸ±</RadioButton>
      <RadioButton>ğŸ¶</RadioButton>
      <RadioButton>ğŸ°</RadioButton>
      <RadioButton>ğŸµ</RadioButton>
    </div>
  )
} 
```

[![alt text](../Images/821113926eaabff72f9cd1757bdb408d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ADHZO0yU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://hansgarcia.dev/static/a110489b04fdb1a60427e2f1cda8d49a/4c4ed/radiobtn_animals.png)

ä¸ºäº†é€‰æ‹©ä¸€ç»„é€‰é¡¹ä¸­çš„ä¸€ä¸ªï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªçŠ¶æ€æ¥ä¿å­˜å½“å‰é€‰æ‹©çš„å€¼ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœé€‰æ‹©å€¼ä¸º**ã€çŒ«ã€‘**ï¼ŒçŠ¶æ€ä¸º**ã€çŒ«ã€‘**ï¼Œå¦‚æœæ”¹ä¸º**ã€çŒ´å­ã€‘**ï¼ŒçŠ¶æ€å°†å˜ä¸º**ã€çŒ´å­ã€‘**ã€‚

## [](#handle-the-state-of-our-component)å¤„ç†æˆ‘ä»¬ç»„ä»¶çš„çŠ¶æ€

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶ï¼Œåœ¨è¿™ä¸ªç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“ç”¨æˆ·æ˜¯å–œæ¬¢ä¸€åªçŒ«è¿˜æ˜¯ä¸€åªç‹—ä½œä¸ºå® ç‰©ã€‚

æˆ‘çŸ¥é“ï¼Œæˆ‘çŸ¥é“ï¼Œè¿™æ˜¯ä¸ªè‰°éš¾çš„å†³å®šã€‚ğŸ¤”

```
function Form() {
  const [pet, setPet] = React.useState("cat");

  function handleOnChange(value) {
    setPet(value);
  }

  return (
    <div>
      <RadioButton value="cat" checked={"cat" === pet} onChange={onChange}>
        <span role="img" aria-label="cat">
          ğŸ±
        </span>
      </RadioButton>
      <RadioButton value="dog" checked={"dog" === pet} onChange={onChange}>
        <span role="img" aria-label="dog">
          ğŸ¶
        </span>
      </RadioButton>
    </div>
  );
} 
```

è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬åœ¨è¿™é‡Œåšäº†ä»€ä¹ˆã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬ä»ä¸­å£°æ˜äº†ä¸€ä¸ªåä¸º**çš„æœ‰çŠ¶æ€ç»„ä»¶ã€‚**

ä¸€ä¸ª**æœ‰çŠ¶æ€ç»„ä»¶**æ˜¯ä¸€ä¸ªå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæœ¬åœ°çŠ¶æ€çš„ç»„ä»¶ã€‚

*   æˆ‘ä»¬ä½¿ç”¨åˆå§‹å€¼ä¸º`"cat"`çš„`React.useState`ã€‚
*   ç„¶åå£°æ˜äº†ä¸€ä¸ªå‡½æ•°`handleOnChange`ï¼Œå®ƒå°†æ›´æ–°ç»„ä»¶çš„çŠ¶æ€ã€‚
*   æœ€åï¼Œæˆ‘ä»¬å°†å¸¦æœ‰ç›¸åº”æ ‡ç­¾çš„è¡¨æƒ…ç¬¦å·`cat`å’Œ`dog`ä¼ é€’ç»™ RadioButton ç»„ä»¶ã€‚

```
<RadioButton
  value="dog"
  checked={"dog" === pet}
  onChange={handleOnChange}>
  <span role="img" aria-label="dog">
    ğŸ¶
  </span>
</RadioButton> 
```

[![radio button](../Images/63645d74ff1e22c95e6181f5dcdb1911.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ZM08J90E--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://hansgarcia.dev/choose_a_pet-33d4e76c7d35a41c14507da8fc840707.gif)

## [](#using-context-to-share-states-through-components)ä½¿ç”¨ä¸Šä¸‹æ–‡é€šè¿‡ç»„ä»¶å…±äº«çŠ¶æ€

ä¸€ä¸ª**å•é€‰æŒ‰é’®**èƒŒåçš„é€»è¾‘å¾ˆç®€å•ï¼Œå®ƒåªå…è®¸ç”¨æˆ·é€‰æ‹©ä¸€ç»„é€‰é¡¹ä¸­çš„ä¸€ä¸ªï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·åªéœ€åœ¨ä¸­åšå‡ºé€‰æ‹©ğŸ±æˆ–ğŸ¶ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ React ä¸Šä¸‹æ–‡é€šè¿‡å•é€‰æŒ‰é’®ç»„ä»¶å…±äº«çŠ¶æ€ã€‚

è®©æˆ‘ä»¬ç”¨`React.createContext()`åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œè¿”å›å€¼å°†è¢«èµ‹ç»™ä¸€ä¸ªåä¸º`RadioContext`çš„å¸¸é‡ã€‚

```
const RadioContext = React.createContext(); 
```

æˆ‘ä»¬å°†æŠŠæœ‰çŠ¶æ€ç»„ä»¶çš„åç§°ä» **Form** æ”¹ä¸º **RadioGroup** ï¼Œç°åœ¨å®ƒå°†è·å¾—ä¸‰ä¸ªæ–°çš„é“å…·: **defaultValue** ã€ **onChange** å’Œ **children** ã€‚

```
- function Form()
+ function RadioGroup({ children, defaultValue, onChange }){
  //...
} 
```

æˆ‘ä»¬å°†æŠŠæ—§çš„`pet`å’Œ`setPet`å˜é‡åé‡å‘½åä¸ºæ›´é€šç”¨çš„åå­—ï¼Œå¦‚`state`ã€`setState`ï¼Œè¿™ä¸ªçŠ¶æ€å°†ä¿æŒä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚

```
- const [pet, setPet] = React.useState("cat");
+ const [state, setState] = React.useState(""); 
```

ç°åœ¨æˆ‘ä»¬æ­£åœ¨æ¥æ”¶ä¸€ä¸ªæ–°çš„ prop **defaultValue** æˆ‘ä»¬éœ€è¦åœ¨å®ƒæ¯æ¬¡æ”¹å˜æ—¶å°†å…¶æ·»åŠ åˆ°çŠ¶æ€ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨ **React.useEffect** ã€‚

```
React.useEffect(()=>{
    setState(defaultValue)
  }, [defaultValue]) 
```

åœ¨ return è¯­å¥ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`RadioContext.Provider`æ¥å…è®¸å…¶ä»–ç»„ä»¶è®¢é˜…ä¸Šä¸‹æ–‡å˜åŒ–ï¼Œæˆ‘ä»¬å°†åœ¨`value={[state, onChange]}`
ä¸­æä¾›è¿™äº›å€¼

```
<RadioContext.Provider value={[state, onChange]}>
  <div role="radiogroup">
    {children}
  </div>
</RadioContext.Provider> 
```

ç°åœ¨è®©æˆ‘ä»¬æŠŠæ‰€æœ‰è¿™äº›ç§»åˆ°å¦ä¸€ä¸ªæ–‡ä»¶`radioButton.js`

```
// radioButton.js
import React from "react";
const RadioContext = React.createContext();

function RadioGroup({ children, defaultValue, onChange }) {
  const [state, setState] = React.useState("");

  function handleOnChange(value) {
    setState(value);
    onChange(value); // we can call the onChange prop and pass the new value
  }

  React.useEffect(() => {
    setState(defaultValue);
  }, [defaultValue]);

  return (
    <RadioContext.Provider value={[state, handleOnChange]}>
      <div role="radiogroup">{children}</div>
    </RadioContext.Provider>
  );
} 
```

## [](#consuming-changes-of-states-from-context)ä»ä¸Šä¸‹æ–‡ä¸­æ¶ˆè€—çŠ¶æ€çš„å˜åŒ–ã€‚

æˆ‘ä»¬çš„ç»„ä»¶éœ€è¦ä¸€ç§æ–¹æ³•æ¥è·å–ä¸Šä¸‹æ–‡æä¾›çš„å€¼ã€‚
æˆ‘ä»¬å°†ä½¿ç”¨ **React.useContext** ï¼Œæˆ‘ä»¬å°†ä¼ é€’ä¹‹å‰åˆ›å»ºçš„**æ— çº¿ç”µä¸Šä¸‹æ–‡**ä½œä¸ºè¾“å…¥`React.useContext(RadioContext)`ï¼Œè¿™å°†ä»æä¾›è€…`<RadioContext.Provider value={[state, onChange]}>`
è¿”å›å€¼

```
function useRadioContext(){
  // we could use array destructuring if we want
  // const [state, onChange] = React.useContext(RadioContext);
  const context = React.useContext(RadioContext);
  if (!context) {
    throw new Error(
      `Radio compound components cannot be rendered outside the Radio component`
    );
  }
  return context;
} 
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªéªŒè¯ **RadioButton** ç»„ä»¶æ˜¯å¦åœ¨ **RadioGroup** ä¸Šä¸‹æ–‡ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œå¦‚æœä¸æ˜¯ï¼Œå®ƒå°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚

## [](#subscribe-to-changes)è®¢é˜…ä¿®æ”¹

å•é€‰æŒ‰é’®ç»„ä»¶éœ€è¦è®¢é˜…**å•é€‰æŒ‰é’®ç»„**ç»„ä»¶ä¸­çš„æ›´æ”¹ã€‚

```
function RadioButton({ value, children }) {
  const [state, onChange] = useRadioContext();
  const checked = value === state;
  return (
    <label>
      <input
        value={value}
        checked={checked}
        type="radio"
        onChange={({ target }) => onChange(target.value)}
      />
      {children}
    </label>
  );
} 
```

ç„¶åæˆ‘ä»¬åªéœ€è¦é€šè¿‡æ¯”è¾ƒæ¥è‡ªä¸Šä¸‹æ–‡çš„çŠ¶æ€(å€¼)å’Œç»„ä»¶çš„**å€¼**æ¥çŸ¥é“ç»„ä»¶æ˜¯å¦è¢«**æ£€æŸ¥**ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å®Œæ•´çš„ä»£ç ã€‚

```
// radioButton.js
import React from "react";

const RadioContext = React.createContext();

function useRadioContext() {
  const context = React.useContext(RadioContext);
  if (!context) {
    throw new Error(
      `Radio compound components cannot be rendered outside the Radio component`
    );
  }
  return context;
}

function RadioGroup({ children, defaultValue, onChange }) {
  const [state, setState] = React.useState("");

  function handleOnChange(value) {
    setState(value);
    onChange(value);
  }

  React.useEffect(() => {
    setState(defaultValue);
  }, [defaultValue]);

  return (
    <RadioContext.Provider value={[state, handleOnChange]}>
      <div role="radiogroup">{children}</div>
    </RadioContext.Provider>
  );
}

function RadioButton({ value, children }) {
  const [state, onChange] = useRadioContext();
  const checked = value === state;
  return (
    <label>
      <input
        value={value}
        checked={checked}
        type="radio"
        onChange={({ target }) => onChange(target.value)}
      />
      {children}
    </label>
  );
}

RadioGroup.RadioButton = RadioButton;

export default RadioGroup; 
```

åœ¨æ–‡ä»¶çš„åº•éƒ¨ï¼Œæˆ‘ä»¬å¯¼å‡º Radio ç»„ä»¶ä½œä¸ºä¸€ä¸ª**å¯¼å‡ºç¼ºçœå€¼**ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬æ·»åŠ  **RadioGroup** ç»„ä»¶ä½œä¸ºç»„ä»¶çš„å±æ€§ä¹‹å‰ã€‚

## [](#using-our-custom-component)ä½¿ç”¨æˆ‘ä»¬å®šåˆ¶çš„ç»„ä»¶

```
import React from "react";
import ReactDOM from "react-dom";
import RadioGroup from "./radioButton";

function App() {
  return (
    <RadioGroup
      defaultValue="cat"
      onChange={value => console.log("value: ", value)}
    >
      <RadioGroup.RadioButton value="cat">
        <span role="img" aria-label="cat">
          ğŸ±
        </span>
      </RadioGroup.RadioButton>
      <RadioGroup.RadioButton value="dog">
        <span role="img" aria-label="dog">
          ğŸ¶
        </span>
      </RadioGroup.RadioButton>
    </RadioGroup>
  );
}

const rootElement = document.getElementById("root");
ReactDOM.render(<App />, rootElement); 
```

ç°åœ¨æˆ‘ä»¬çš„æ–°ç»„ä»¶å·¥ä½œäº†ï¼Œå¯èƒ½æœ‰ç‚¹å†—é•¿ï¼Œä½†æˆ‘å–œæ¬¢å®ƒã€‚

è¿™ä¸æ˜¯ä¸€ä¸ªè¯¦ç»†çš„å®ç°ï¼Œè€Œæ˜¯ä½¿ç”¨ **React ä¸Šä¸‹æ–‡**çš„ä¸€ä¸ªèµ·ç‚¹ã€‚

å¦‚æœä½ æƒ³ç©ä¸€ä¸‹ï¼Œè¯•è¯• **codesandbox**

[https://codesandbox.io/embed/radio-button-with-react-context-ktkf4](https://codesandbox.io/embed/radio-button-with-react-context-ktkf4)