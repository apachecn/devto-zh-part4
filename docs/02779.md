# å°†åº”ç”¨ç¨‹åºè¿ç§»åˆ°æ— æœåŠ¡å™¨ä½“ç³»ç»“æ„å’Œè“è‰²åŠŸèƒ½

> åŸæ–‡ï¼š<https://dev.to/azure/migracion-de-una-aplicacion-mean-a-arquitectura-serverless-y-azure-functions-44no>

æœ¬æ–‡æ˜¯å†…å®¹é›†[# server esssetember](https://dev.to/azure/serverless-september-content-collection-2fhb)çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å°†åœ¨æ­¤æ‰¾åˆ° 2019 å¹´ 9 æœˆæœŸé—´å‘è¡¨çš„æ‰€æœ‰æ–‡ç« ã€‚

æœ¬æ–‡å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Azure Functions è½»æ¾ã€å¿«é€Ÿã€åŠ¨æ€åœ°å°†åº”ç”¨ç¨‹åºè¿ç§»åˆ°æ— æœåŠ¡å™¨ä½“ç³»ç»“æ„ï¼

é¡¹ç›®æ„æ€æ˜¯å·²ç»å‡†å¤‡å¥½äº†ï¼Œæ‚¨å¯ä»¥åˆ¶ä½œ git cline æˆ–ä¸‹è½½å®ƒ

æˆ‘ä»¬èµ°å§ï¼Ÿï¼

## äº†è§£é¡¹ç›®ç»“æ„æ„æ€

åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†ä¾§é‡äºä¸¤ä¸ªæ–‡ä»¶å¤¹:API å’Œ **front** ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º:

[![Screen-Shot-09-11-19-at-12-04-PM.png](img/f6d6f5329b0ff17f6217ccd0b89684e9.png)](https://postimg.cc/RJKKF34d)

å¦‚æœæ‚¨è¿è¡Œæ­¤åº”ç”¨ç¨‹åºï¼Œæ‚¨å°†æ³¨æ„åˆ°æˆ‘ä»¬ä»åœ¨ mongodb ä¸­ï¼Œå¹¶ä¸”æ­£åœ¨ä½¿ç”¨åç«¯ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Node.jsã€‚

æŒä¹…æ•°æ®åŒ…æ‹¬:

**åˆ†ç±»:Funcionario**

*   **å®˜å‘˜:**(è’™å¤åŒ…ç”Ÿæˆçš„ç¼–å· guid)
*   å…¬åŠ¡å‘˜å§“å:å­—ç¬¦ä¸²
*   **è´§ç‰©:**å­—ç¬¦ä¸²
*   å·ç è¯†åˆ«å…ƒ:å·ç 

å¦‚æœè¦åœ¨æœ¬åœ°è¿è¡Œæ­¤é¡¹ç›®ï¼Œè¯·ä»…æ‰§è¡Œé¡¹ç›®å­˜å‚¨åº“ä¸­ README.md ä¸­çš„æ­¥éª¤ã€‚

å¥½å§ï¼Œç°åœ¨ä½ æœ‰äº† MEAN è®¡åˆ’ï¼Œè¿ç§»åˆ° Azure Functionsï¼Ÿ

ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯è“è‰²å‡½æ•°ï¼

## å®ƒä»¬æ˜¯è“è‰²åŠŸèƒ½å—ï¼Ÿâš¡ï¸

**[ã€azure functionsã€‘](https://azure.microsoft.com/es-es/services/functions/?WT.mc_id=servsept_devto-blog-gllemos)**æ˜¯ä¸€ç§æ— éœ€æœåŠ¡å™¨çš„æµç¨‹æœåŠ¡ï¼Œä½¿æ‚¨æ— éœ€æ˜ç¡®é…ç½®æˆ–ç®¡ç†åŸºç¡€æ¶æ„å³å¯æŒ‰éœ€è¿è¡Œä»£ç ã€‚

Azure Functions æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬:

*   **c#**
*   **[JavaScript](https://docs.microsoft.com/es-es/azure/azure-functions/functions-reference-node?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[F#](https://docs.microsoft.com/es-es/azure/azure-functions/functions-reference-fsharp?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[Java](https://docs.microsoft.com/es-es/azure/azure-functions/functions-reference-java?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[PowerShell](https://docs.microsoft.com/es-es/azure/azure-functions/functions-reference-powershell?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[Python](https://docs.microsoft.com/es-es/azure/azure-functions/functions-reference-python?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[æ‰“å­—ç¨¿](https://docs.microsoft.com/es-es/azure/azure-functions/functions-reference-node?WT.mc_id=servsept_devto-blog-gllemos#typescript)**

ä¸‹é¢çš„è¯­è¨€å·²ç»å—æ”¯æŒï¼Œä½†åœ¨å®ƒä»¬çš„ preview ç‰ˆæœ¬ä¸­:

*   **ç—›å‡»**
*   **PHP**

æœ‰å…³ Azure Functions æ”¯æŒçš„è¯­è¨€çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·è®¿é—®æ­¤å¤„çš„é“¾æ¥

ä½†æ˜¯ï¼Œå¯¹äºæœ¬æ–‡ï¼Œæˆ‘ä»¬å°†é‡ç‚¹è®¨è®º JavaScriptã€‚ğŸ˜‰

## è“è‰²åŠŸèƒ½ä¸­çš„é‡è¦æ¨¡æ¿

å¼€å§‹è¿ç§»ä¹‹å‰ï¼Œè¯·åŠ¡å¿…æ³¨æ„ Azure Functions æœ‰å‡ ä¸ªç°æˆçš„æ¨¡æ¿ã€‚å…¶ä¸­åŒ…æ‹¬:

*   **[HTTPTrigger](https://docs.microsoft.com/es-es/azure/azure-functions/functions-create-first-azure-function?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[TimerTrigger](https://docs.microsoft.com/es-es/azure/azure-functions/functions-create-scheduled-function?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[CosmosDBTrigger](https://docs.microsoft.com/es-es/azure/azure-functions/functions-bindings-cosmosdb-v2?WT.mc_id=servsept_devto-blog-gllemos)**

*   **[é˜Ÿåˆ—è§¦å‘å™¨](https://docs.microsoft.com/es-es/azure/azure-functions/functions-bindings-storage-queue?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[EventGridTrigger](https://docs.microsoft.com/es-es/azure/event-grid/resize-images-on-storage-blob-upload-event?tabs=dotnet&WT.mc_id=servsept_devto-blog-gllemos)**
*   **[äº‹ä»¶è§¦å‘](https://docs.microsoft.com/es-es/azure/azure-functions/functions-bindings-event-hubs?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[ServiceBusQueueTrigger](https://docs.microsoft.com/es-es/azure/azure-functions/functions-bindings-service-bus?WT.mc_id=servsept_devto-blog-gllemos)**
*   **[ServiceBusTopicTrigger](https://docs.microsoft.com/es-es/azure/azure-functions/functions-bindings-service-bus?WT.mc_id=servsept_devto-blog-gllemos)T3ã€‘**

æˆ‘ä¸ä¼šé€ä¸€è¯¦è¿°æ¨¡æ¿ï¼Œå¦åˆ™è¿™ç¯‡æ–‡ç« ä¼šå¾ˆå¤§ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³è¿›ä¸€æ­¥äº†è§£æ¯ä¸ªæ¨¡æ¿åŠå…¶åœ¨ç‰¹å®šåº”ç”¨ç¨‹åºä¸­çš„æœ€ä½³ç”¨é€”ï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯»æ–‡æ¡£ã€‚

å¯¹äºæ­¤å¸–å­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨**[ã€HTTP triggerã€‘](https://docs.microsoft.com/es-es/azure/azure-functions/functions-create-first-azure-function?WT.mc_id=servsept_devto-blog-gllemos)**ï¼Œå› ä¸ºæ­¤æ¨¡æ¿å¯ç”¨ä½¿ç”¨ http è¯·æ±‚æ‰§è¡Œä»£ç ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼

å¦‚æœä½ æ˜¯ä»»ä½•ä¸€æ‰€å­¦æ ¡æˆ–å¤§å­¦çš„å­¦ç”Ÿï¼Œä½ å¯ä»¥è®¾ç«‹ä½ çš„å­¦ç”Ÿè“è´¦æˆ·ã€‚æ­¤å¸æˆ·å°†ä¸ºæ‚¨æä¾› 100.00 ç¾å…ƒçš„ä¿¡ç”¨ï¼Œè®©æ‚¨æ— éœ€ä¿¡ç”¨å¡å³å¯å…è´¹ä½¿ç”¨æœåŠ¡ã€‚è¦æ¿€æ´»æ­¤è´¦æˆ·ï¼Œåªéœ€è®¿é—®æ—è¾¹çš„é“¾æ¥: **[ã€è¿™é‡Œã€‘](https://azure.microsoft.com/es-es/free/students/?WT.mc_id=servsept_devto-blog-gllemos)** ã€æ­¤è´¦æˆ·æ¯æœˆå¯ä½¿ç”¨ **1ï¼Œ000ï¼Œ000 ä»½å…è´¹ç”³è¯·å¤„ç†è“è‰²åŠŸèƒ½äº‹ä»¶ï¼**

[![Screen-Shot-09-11-19-at-12-42-PM.png](img/1cea6e7ca048487dcb8a75c1f74f5a39.png)](https://postimg.cc/5HCTSV5r)

å—¯ï¼Œåœ¨è¿™ç§è“å‡½æ•°çš„æ¦‚è¿°ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è¿ç§»äº†ï¼å¾€å‰èµ°ï¼

## è“è‰²åŠŸèƒ½æ ¸å¿ƒå·¥å…·å¥—è£…çš„å®‰è£…

**[ã€è“è‰²åŠŸèƒ½æ ¸å¿ƒå·¥å…·ã€‘](https://docs.microsoft.com/azure/azure-functions/functions-run-local?WT.mc_id=servsept_devto-blog-gllemos)** å…è®¸æ‚¨ä»ç³»ç»Ÿå‘½ä»¤æç¤ºç¬¦æˆ–ä½¿ç”¨ç»ˆç«¯åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šå¼€å‘å’Œæµ‹è¯•åŠŸèƒ½ã€‚

ä»¥ä¸‹æ˜¯ç»§ç»­æœ¬æ•™ç¨‹æ‰€éœ€çš„ç¨‹åºå’Œè½¯ä»¶åŒ…:

*   **[node . js-LTS](https://nodejs.org/en/)T3ã€‘**
*   **[Azure åŠŸèƒ½æ ¸å¿ƒå·¥å…·](https://www.npmjs.com/package/azure-functions-core-tools)**
*   **[è’™å“¥ç½—ç›˜](https://www.mongodb.com/products/compass)**

åœ¨è®¡ç®—æœºä¸Šå®‰è£… Node.js åï¼Œåªéœ€é”®å…¥ä»¥ä¸‹å‘½ä»¤:

*   **çª—æˆ·**

```
npm install -g azure-functions-core-tools 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   **è‹¹æœç”µè„‘**

```
brew tap azure/functions
brew install azure-functions-core-tools 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   **Linux(Ubuntu/Debian)com APT**

```
curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
sudo mv microsoft.gpg /etc/apt/trusted.gpg.d/microsoft.gpg 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ‰å…³æ­£ç¡®å®‰è£…è“è‰²åŠŸèƒ½æ ¸å¿ƒå·¥å…·çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®æ­¤å¤„çš„é“¾æ¥

æˆ‘å¦‚ä½•çŸ¥é“æ˜¯å¦æ­£ç¡®å®‰è£…äº†è“è‰²åŠŸèƒ½æ ¸å¿ƒå·¥å…·ï¼Ÿåªéœ€åœ¨ç»ˆç«¯ä¸Šé”®å…¥ä»¥ä¸‹å‘½ä»¤:

```
> func 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ ¹æ®ä»¥ä¸‹ gif å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œåˆ™è¯´æ˜è½¯ä»¶åŒ…å®‰è£…æˆåŠŸã€‚

[![gif-serverless-07.gif](img/e830fa0a29e050f1f59c309f63e59731.png)](https://gifyu.com/image/hYvM)

å¤ªå¥½äº†ï¼ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„åŠŸèƒ½ã€‚ä¸ºæ­¤ï¼Œè¯·åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šåˆ›å»ºæœ¬åœ°æ–‡ä»¶å¤¹å¹¶â–¡ï¼

## åˆ›å»ºè“è‰²å‡½æ•°æ–°åº”ç”¨

æ—¢ç„¶æˆ‘ä»¬å·²ç»å®‰è£…äº†è½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºã€‚ä¸ºæ­¤ï¼Œåªéœ€æŒ‰ç…§ gif ç­‰æ­¥éª¤è¿›è¡Œæ“ä½œ:

[![gif-serverless-08.gif](img/df4f2824ed7f9058d4e5712a6a725f8a.png)](https://gifyu.com/image/hYqP)

è¯·æ³¨æ„ï¼Œæ‰“å¼€ Visual Studio ä»£ç æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»å•å‡»å³ä¸‹è§’çš„â€œ`YES`â€æŒ‰é’®ä»¥å¯ç”¨é¡¹ç›®ä¸­çš„æŸäº›é‡è¦æ–‡ä»¶ã€‚

## åœ¨è’™æˆˆå¸ƒå»ºç«‹è¿æ¥

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯¹æˆ‘ä»¬æ–°åˆ›å»ºçš„é¡¹ç›®åšä¸€äº›å¿…è¦çš„ä¿®æ”¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­æœ¬åœ°å®‰è£…[ã€mong odbã€‘](https://www.npmjs.com/package/mongodb)ã€‚é”®å…¥ä»¥ä¸‹å‘½ä»¤:

```
> npm install mongodb 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨é¡¹ç›®ä¸­å®‰è£… mongodb æ—¶ï¼Œè¯·æ³¨æ„æ–‡ä»¶â€œ`package.json`â€å·²å‘ç”Ÿæ›´æ”¹ã€‚æœ€åï¼Œè¯¥æ–‡ä»¶åº”å¦‚ä¸‹æ‰€ç¤º:

*   **æ¡£æ¡ˆ:package.json**

```
{  "name":  "crud-serverless-mongodb",  "version":  "1.0.0",  "description":  "Projeto azure functions com persistencia com o mongoDb",  "scripts":  {  "test":  "echo \"No tests yet...\""  },  "author":  "",  "dependencies":  {  "mongodb":  "^3.3.2"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º:â€œT0â€çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºæ–‡ä»¶:`mongo.js`ã€‚ç°åœ¨é¡¹ç›®ç»“æ„å¦‚ä¸‹æ‰€ç¤º:

[![Screen-Shot-09-11-19-at-02-05-PM.png](img/6ac457e3b56bc274a6dd475f0174267b.png)](https://postimg.cc/CRVryLtH)

ç°åœ¨è®©æˆ‘ä»¬æ›´æ”¹æ–‡ä»¶`mongo.js`ã€‚ä¸ºæ­¤ï¼Œè¯·åŒ…æ‹¬ä»¥ä¸‹ä»£ç :

*   **archivo: shared/mongo.js**

```
/**
 * Arquivo: mongo.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel por tratar a conexÃ£o da Base de Dados localmente
 * Author: Glaucia Lemos
 */

const { MongoClient } = require("mongodb");

const config = {
  url: "mongodb://localhost:27017/crud-serverless-mongodb",
  dbName: "crud-serverless-mongodb"
};

async function createConnection() {
  const connection = await MongoClient.connect(config.url, {
    useNewUrlParser: true
  });
  const db = connection.db(config.dbName);
  return {
    connection,
    db
  };
}

module.exports = createConnection; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

âˆæˆ‘ä»¬æ­£åœ¨å»ºç«‹ä¸è’™æˆˆå¸ƒçš„æœ¬åœ°è”ç³»ï¼âˆç±»ä¼¼äºæˆ‘ä»¬å·²ç»åœ¨åç«¯ä½¿ç”¨ Node.js åšçš„äº‹æƒ…ï¼

å¹¶ä¸”æˆ‘ä»¬è¿˜æ›´æ”¹äº†æ–‡ä»¶`local.settings.json`ã€‚æ­¤æ–‡ä»¶è´Ÿè´£â€œå­˜å‚¨â€æˆ‘ä»¬ä¸æƒ³åœ¨æäº¤æ—¶æš´éœ²çš„æ‰€æœ‰å¯†é’¥ã€‚è¯·æ³¨æ„ï¼Œæ­¤æ–‡ä»¶ä½äºâ€œ`.gitignore`â€çš„æ–‡ä»¶åˆ—è¡¨ä¸­ã€‚

æ‰“å¼€æ–‡ä»¶â€œ`local.settings.json`â€å¹¶è¿›è¡Œä»¥ä¸‹æ›´æ”¹:

*   **æ¡£æ¡ˆ:local.settings.json**

```
{  "IsEncrypted":  false,  "Values":  {  "FUNCTIONS_WORKER_RUNTIME":  "node",  "AzureWebJobsStorage":  "{AzureWebJobsStorage}"  },  "Host":  {  "LocalHttpPort":  7071,  "CORS":  "*"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯ç”¨äº†é¢œè‰²ã€‚âˆæ²¡æœ‰ä»–ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨å‰ç«¯æ‰§è¡Œ cru æ“ä½œï¼å¦‚æœä½ æƒ³å¤šäº†è§£ä¸€äº›é¢œè‰²ï¼Œæˆ‘å»ºè®®ä½ è¯»ä¸€ä¸‹ã€‚

ç¬¬ä¸€éƒ¨åˆ†å‡†å¤‡å¥½äº†ï¼æˆ‘ä»¬ç›¸ä¿¡æˆ‘ä»¬çš„ä¿¡æ¡æ˜¯è“è‰²åŠŸèƒ½ï¼

## åˆ›å»ºâ€˜create officialâ€™åŠŸèƒ½

è¦åˆ›å»ºæ–°å‡½æ•°ï¼Œåªéœ€é”®å…¥ä»¥ä¸‹å‘½ä»¤:

```
func new 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¾“å…¥æ­¤å‘½ä»¤å°†ä¸ºæ‚¨æä¾›å„ç§æ¨¡æ¿é€‰é¡¹ï¼Œè“è‰²å‡½å¼å¯ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚å°±æˆ‘ä»¬è€Œè¨€ï¼Œå¦‚å‰æ‰€è¿°ï¼Œé€‰æ‹©æ¨¡æ¿:`HttpTrigger`ã€‚éµå¾ª gif çš„æ­¥éª¤:

[![gif-serverless-09.gif](img/f7b5857da806260b9d7ff5d05ece5650.png)](https://gifyu.com/image/hYI8)

è¯·æ³¨æ„ï¼Œå·²åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹â€œ`CreateFuncionario`â€å’Œä¸¤ä¸ªæ–‡ä»¶:

*   **function.json** :è¿™é‡Œæˆ‘ä»¬å°†å®šä¹‰æˆ‘ä»¬ç«¯ç‚¹çš„è·¯å¾„å’Œæ–¹æ³•ã€‚

*   **index.json** :è¿™é‡Œæˆ‘ä»¬å°†å‘å±•ç»ˆç‚¹é€»è¾‘ã€‚

æˆ‘ä»¬å¼€å§‹ä¿®æ”¹è¿™äº›æ–‡ä»¶ã€‚ä»¥`function.json`å¼€å¤´

*   **æ¡£æ¡ˆ:create official/function . JSON**

```
{  "bindings":  [{  "authLevel":  "anonymous",  "type":  "httpTrigger",  "direction":  "in",  "name":  "req",  "methods":  ["post"],  "route":  "funcionarios"  },  {  "type":  "http",  "direction":  "out",  "name":  "res"  }  ]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è®©æˆ‘ä»¬æ›´æ”¹æ–‡ä»¶`index.js`:

*   **æ¡£æ¡ˆ:create official/index . js**

```
/**
 * Arquivo: CreateFuncionario/index.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel por criar um novo 'FuncionÃ¡rio'
 * Author: Glaucia Lemos
 */

const createMongoClient = require('../shared/mongo')

module.exports = async function (context, req) {
  const funcionario = req.body || {}

  if (funcionario) {
    context.res = {
      status: 400,
      body: 'Os dados do(a) FuncionÃ¡rio(a) Ã© obrigatÃ³rio!'
    }
  }

  const { db, connection } = await createMongoClient()

  const Funcionarios = db.collection('funcionarios')

  try {
    const funcionarios = await Funcionarios.insert(funcionario)
    connection.close()

    context.res = {
      status: 201,
      body: funcionarios.ops[0]
    }
  } catch (error) {
    context.res = {
      status: 500,
      body: 'Error ao criar um novo FuncionÃ¡rio(a)'
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œæˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯å®šä¹‰äº†`POST`çš„è·¯çº¿ï¼Œå¹¶å‘å±•äº†åˆ›å»ºæ–°å‘˜å·¥çš„é€»è¾‘ã€‚

æˆ‘ä»¬è¦è¿è¡Œè¿™ä¸ªç«¯ç‚¹å—ï¼Ÿè¦è¿è¡Œï¼Œåªéœ€é”®å…¥ä»¥ä¸‹å‘½ä»¤:

```
> func host start 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

âˆå°†åˆ—å‡ºæˆ‘ä»¬åˆ›å»ºçš„ç«¯ç‚¹ï¼çœ‹çœ‹ gif:

[![gif-serverless-11.gif](img/b2a631e7c161d4e89fa73ed405083539.png)](https://gifyu.com/image/hYI5)

æ˜¯ä»¥ä¸‹ç«¯ç‚¹:`[POST] http://localhost:7071/api/funcionario`

`7071`é—¨æ˜¯è“è‰²åŠŸèƒ½çš„é»˜è®¤é—¨ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦æ”¾åœ¨å‰ç«¯çš„ä¸œè¥¿ï¼

å¥½å§ï¼Œç°åœ¨æˆ‘ä»¬èµ°è¿™æ¡è·¯ï¼ŒæŠŠå®ƒåŠ åˆ°å‰ç«¯ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹é¡¹ç›®`Front`åšä¸€äº›ä¿®æ”¹ã€‚è½¬åˆ°ä½äº:`front -> src -> app -> funcionario.service.ts`çš„æ–‡ä»¶å¤¹`front`ï¼Œç„¶åæ›´æ”¹ä»¥ä¸‹æ–‡ä»¶`funcionario.service.ts`

*   **æ¡£æ¡ˆ:å®˜å‘˜ã€‚service.ts**

```
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';

@Injectable({
  providedIn: 'root'
})
export class FuncionarioService {

  // ==> Uri da api (Back-End)
  uri = 'http://localhost:7071/api';

  constructor(private http: HttpClient) { }

(...) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬åªéœ€è¦æ›´æ”¹è§’åº¦æœåŠ¡ä¸­å®šä¹‰çš„ uriã€‚

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å¤„å†³ Mongo Compass å’Œ Front Endã€‚â–¡åœ¨ gif ä¸­ï¼Œæ–°å‘˜å·¥å°†å¦‚ä½•åšæŒä¸‹å»ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦é¡¹ç›®æ–‡ä»¶å¤¹â–¡â–¡â–¡â–¡â–¡ï¼

**(ç‚¹å‡»å›¾ç‰‡è§‚çœ‹ gif)**

[![gif-serverless-122d9fa9f9e2c32e04.md.gif](img/dc23cd5f25ab707d3ef909bb6c357667.png)](https://gifyu.com/image/hYuM)

å¦™æäº†ï¼ğŸ˜

âˆè®©æˆ‘ä»¬åˆ—å‡ºå‘˜å·¥åå•ï¼

## åˆ›å»ºâ€˜get officersâ€™åŠŸèƒ½

å’Œä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬ç”¨å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å‡½æ•°:`func new`ï¼Œå‘½åå‡½æ•°`GetFuncionarios`ï¼Œç„¶åæ›´æ”¹æ–‡ä»¶:`function.json` e `index.js`

**(ç‚¹å‡»å›¾ç‰‡è§‚çœ‹ gif)**

[![gif-serverless-1390be8d86cc5d4218.md.gif](img/8d443815dfeb968d50c00d3642686a5e.png)](https://gifyu.com/image/hYuz)

*   **get officers/function . JSON**

```
{  "bindings":  [{  "authLevel":  "anonymous",  "type":  "httpTrigger",  "direction":  "in",  "name":  "req",  "methods":  ["get"],  "route":  "funcionarios"  },  {  "type":  "http",  "direction":  "out",  "name":  "res"  }  ]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   **GetFuncionarios/index.js**

```
/**
 * Arquivo: GetFuncionarios/index.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel por listar todos os 'FuncionÃ¡rios'
 * Author: Glaucia Lemos
 */

const createMongoClient = require('../shared/mongo')

module.exports = async context => {
  const { db, connection } = await createMongoClient()

  const Funcionarios = db.collection('funcionarios')
  const res = await Funcionarios.find({})
  const body = await res.toArray()

  connection.close()

  context.res = {
    status: 200,
    body
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åˆæ¥äº†ï¼gif åˆæ¥äº†ï¼

[![gif-serverless-14.gif](img/2abb577d869169a61f1236add0ba4930.png)](https://gifyu.com/image/hYdI)

å®ƒåˆæ¢å¤æ­£å¸¸äº†ã€‚ä½ å·²ç»æ³¨æ„åˆ°ç”¨è“è‰²å‡½æ•°åˆ›å»º CRUD å¾ˆå®¹æ˜“ï¼Œâˆå—ï¼Ÿéµå¾ªç›¸åŒçš„æ­¥éª¤åˆ›å»ºä¸‹ä¸€ä¸ªå‡½æ•°ï¼

## Creando la funciÃ³n ' GetFuncionarioById '

ç°åœ¨è¿™é‡Œçš„å¤§å®¶éƒ½å¾ˆæ¸…æ¥šåˆ¶ä½œä¸€ä¸ªå¸¦æœ‰è“è‰²åŠŸèƒ½çš„ CRUD æ˜¯å¤šä¹ˆå®¹æ˜“ï¼Œæˆ‘å°†å¼€å§‹åŠ å¿«åˆ¶ä½œè¿‡ç¨‹ï¼Œåªåœ¨æ–‡ä»¶`function.json`å’Œ`index.js`ä¸­æŠ¥å‘Šå‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–

*   **get å®˜å‘˜ ById/index.js**

```
{  "bindings":  [{  "authLevel":  "anonymous",  "type":  "httpTrigger",  "direction":  "in",  "name":  "req",  "methods":  ["get"],  "route":  "funcionarios/{id}"  },  {  "type":  "http",  "direction":  "out",  "name":  "res"  }  ]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   **GetFuncionarioById/function . JSON**

```
// @ts-nocheck
/**
 * Arquivo: GetFuncionarioById/index.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel por listar FuncionÃ¡rio pelo Id
 * Author: Glaucia Lemos
 */

const { ObjectID } = require('mongodb')
const createMongoClient = require('../shared/mongo')

module.exports = async function (context, req) {
  const { id } = req.params

  if (!id) {
    context.res = {
      status: 400,
      body: 'Por favor, passe o nÃºmero correto do Id do FuncionÃ¡rio!'
    }

    return
  }

  const { db, connection } = await createMongoClient()

  const Funcionarios = db.collection('funcionarios')

  try {
    const body = await Funcionarios.findOne({ _id: ObjectID(id) })

    connection.close()
    context.res = {
      status: 200,
      body
    }
  } catch (error) {
    context.res = {
      status: 500,
      body: 'Erro ao listar o FuncionÃ¡rio pelo Id.'
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç°åœ¨ä¸è¯•è¯•ã€‚è®©æˆ‘ä»¬å¼€å‘æœ€åä¸¤ä¸ªåŠŸèƒ½:`Update`å’Œ`Delete`ã€‚

## åˆ›å»ºâ€˜æ›´æ–°å®˜å‘˜â€™åŠŸèƒ½

å†ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°åŠŸèƒ½å¹¶æ›´æ”¹æ–‡ä»¶å’Œ`function.json`:

*   **UpdateFuncionario/index . js**

```
{  "bindings":  [{  "authLevel":  "anonymous",  "type":  "httpTrigger",  "direction":  "in",  "name":  "req",  "methods":  ["put"],  "route":  "funcionarios/{id}"  },  {  "type":  "http",  "direction":  "out",  "name":  "res"  }  ]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   **UpdateFuncionario/index . js**

```
// @ts-nocheck
/**
 * Arquivo: UpdateFuncionario/index.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel por atualizar 'FuncionÃ¡rio' por Id
 * Author: Glaucia Lemos
 */

const { ObjectID } = require('mongodb')
const createMongoClient = require('../shared/mongo')

module.exports = async function (context, req) {
  const { id } = req.params
  const funcionario = req.body || {}

  if (!id || !funcionario) {
    context.res = {
      status: 400,
      body: 'Os campos sÃ£o obrigatÃ³rios'
    }

    return
  }

  const { db, connection } = await createMongoClient()
  const Funcionarios = db.collection('funcionarios')

  try {
    const funcionarios = await Funcionarios.findOneAndUpdate(
      { _id: ObjectID(id) },
      { set: funcionario }
    )

    connection.close()

    context.res = {
      status: 200,
      body: funcionarios
    }
  } catch (error) {
    context.res = {
      status: 500,
      body: 'Erro ao atualizar o FuncionÃ¡rio'
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

-å¥½å§ã€‚ç°åœ¨è®©æˆ‘ä»¬å‘å±•æˆ‘ä»¬æœ€åçš„åŠŸèƒ½:`Delete`ã€‚

## åˆ›å»ºã€åˆ é™¤å®˜å‘˜ã€‘åŠŸèƒ½

å†æ¬¡ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œé€‰æ‹©é€‰é¡¹:`DeleteFuncionario`ï¼Œå°†å‡½æ•°å‘½åä¸º`DeleteFuncionario`ï¼Œç„¶åæ›´æ”¹æ–‡ä»¶`function.json`å’Œ`index.js`:

*   **åˆ é™¤å…¬åŠ¡å‘˜/èŒèƒ½ã€‚json**

```
{  "bindings":  [{  "authLevel":  "anonymous",  "type":  "httpTrigger",  "direction":  "in",  "name":  "req",  "methods":  ["delete"],  "route":  "funcionarios/{id}"  },  {  "type":  "http",  "direction":  "out",  "name":  "res"  }  ]  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   **DeleteFuncionario/index . js**

```
// @ts-nocheck
/**
 * Arquivo: DeleteFuncionario/index.js
 * Data: 10/11/2019
 * DescriÃ§Ã£o: arquivo responsÃ¡vel excluir um 'FuncionÃ¡rio' pelo Id
 * Author: Glaucia Lemos
 */

const { ObjectID } = require('mongodb')
const createMongoClient = require('../shared/mongo')

module.exports = async function (context, req) {
  const { id } = req.params

  if (!id) {
    context.res = {
      status: 400,
      body: 'Os campos sÃ£o obrigatÃ³rios!'
    }

    return
  }

  const { db, connection } = await createMongoClient()

  const Funcionarios = db.collection('funcionarios')

  try {
    await Funcionarios.findOneAndDelete({ _id: ObjectID(id) })
    connection.close()
    context.res = {
      status: 204,
      body: 'FuncionÃ¡rio excluÃ­do com sucesso!'
    }
  } catch (error) {
    context.res = {
      status: 500,
      body: 'Erro ao excluir FuncionÃ¡rio' + id
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬çš„åŸæ²¹å‡†å¤‡å¥½äº†ï¼æˆ‘ä»¬è¦æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹å—ï¼Ÿgifï¼gifï¼

**(ç‚¹å‡»å›¾ç‰‡è§‚çœ‹ gif)**

[![gif-serverless-156824eb58eaca624e.md.gif](img/4d5d4f154837af0bffdf110f5a4b5577.png)](https://gifyu.com/image/hYnX)

æœ€ç¾ä¸½çš„ä¸æ˜¯å—ï¼Ÿå†æ¬¡è¯·æ³¨æ„ï¼ŒåŒ…å«å¤§é‡æ–‡ä»¶çš„æ–‡ä»¶å¤¹â€œ`api`â€å°†ä¸éœ€è¦å®ƒï¼

æ‰€æœ‰å¼€å‘çš„ä»£ç éƒ½åœ¨è¿™é‡Œ:

**[å‰ç«¯å·¥ç¨‹](https://github.com/glaucia86/workshop-mean-serverless)**

ğŸ‘‰ **[Projeto Api -æ— æœåŠ¡å™¨](https://github.com/glaucia86/crud-serverless-mongodb)**

## ç»“è®º

ä»Šå¤©ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•å°† MEAN åº”ç”¨ç¨‹åºè¿ç§»åˆ° Azure Functionsï¼Œä½†åœ¨æœ¬åœ°ä¿ç•™è¿™äº›æ•°æ®å¹¶åœ¨æœ¬åœ°æ‰§è¡Œè¿™äº›åŠŸèƒ½ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦å°†æ­¤åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°äº‘ä¸Šï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿæˆ‘ä»¬çš„åç«¯ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘æ‚¨ä»‹ç»å¦‚ä½•ä» mongodb è¿ç§»åˆ° CosmosDbï¼Œä»¥åŠå¦‚ä½•åœ¨ Visual Studio ä»£ç ä¸­ä½¿ç”¨ Azure Tools æ‰©å±•å®ç°è¿™äº›åŠŸèƒ½ã€‚

å¦‚éœ€æœ‰å…³ Azure Functions çš„æ›´å¤šä¿¡æ¯ï¼Œå»ºè®®æ‚¨å‚åŠ ä»¥ä¸‹å®Œå…¨å…è´¹çš„ Serverless & Azure Functions è¯¾ç¨‹å’Œå…¶ä»–ä¸€äº›é‡è¦èµ„æº:

**[å…è´¹è¯¾ç¨‹-è“è‰²åŠŸèƒ½](https://docs.microsoft.com/es-es/learn/paths/create-serverless-applications/?WT.mc_id=servsept_devto-blog-gllemos)**

**[JavaScript å’Œ Node.js](https://docs.microsoft.com/es-es/javascript/azure/?WT.mc_id=servsept_devto-blog-gllemos&view=azure-node-latest)** å¼€å‘è€…ç”¨è“è‰²

**[è“çš®ä¹¦åŠŸèƒ½](https://docs.microsoft.com/es-es/azure/azure-functions/?WT.mc_id=servsept_devto-blog-gllemos)**

**[é€šè¿‡ Visual Studio ä»£ç ](https://docs.microsoft.com/es-es/azure/azure-functions/functions-create-first-function-vs-code?WT.mc_id=servsept_devto-blog-gllemos)** åˆ›å»ºå…¶ç¬¬ä¸€ä¸ªåŠŸèƒ½

âœ… **[VS ä»£ç æ‰©å±•â€”â€”azure å‡½æ•°](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions&WT.mc_id=servsept_devto-blog-gllemos)**

âœ… **[ç”µå­ä¹¦ GrÃ¡tis - Azure æ— æœåŠ¡å™¨è®¡ç®—é£Ÿè°±](https://azure.microsoft.com/es-es/resources/azure-serverless-computing-cookbook/?WT.mc_id=servsept_devto-blog-gllemos)**

å¹¶ä¸”ä¸ºäº†äº†è§£è¿™ä¸ªå’Œå…¶ä»–çš„äº‹æ€å‘å±•ï¼Œâˆåœ¨ twitter ä¸Šï¼

[![Twitter](img/9a13c0534f6448ca23e17b3afbfb6a4c.png)](https://twitter.com/glaucia_lemos86)

ä¸€ä¼šå„¿è§ã€‚â¤ï¸ â¤ï¸ â¤ï¸