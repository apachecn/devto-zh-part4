# React Native:åœ¨ç°æœ‰ iOS åº”ç”¨ä¸­ä½¿ç”¨å¤šä¸ª RCTRootView å®ä¾‹

> åŸæ–‡ï¼š<https://dev.to/chicio/react-native-use-multiple-rctrootview-instances-in-an-existing-ios-app-1g92>

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•åœ¨ç°æœ‰çš„ iOS åº”ç”¨ä¸­ä½¿ç”¨å¤šä¸ª RCTRootView å®ä¾‹ã€‚

å¦‚æœæˆ‘ä»¬æƒ³åœ¨ç°æœ‰çš„åº”ç”¨ç¨‹åºä¸­å¼€å§‹ä½¿ç”¨ React Nativeï¼Œè¿™çœŸçš„å¾ˆå®¹æ˜“ã€‚æˆ‘ä»¬å¯ä»¥è®©æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª React æœ¬åœ°ç»„ä»¶åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­è¿è¡Œï¼Œåªéœ€éµå¾ªç°æœ‰åº”ç”¨ç¨‹åºçš„[å…¥é—¨æ•™ç¨‹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ç°æœ‰åº”ç”¨ç¨‹åºä¸åŒéƒ¨åˆ†ä½¿ç”¨å¤šä¸ª React æœ¬åœ°ç»„ä»¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ğŸ˜¨ï¼Ÿåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨å¤šä¸ª`RCTRootView`å®ä¾‹æ¥æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸åŒéƒ¨åˆ†çš„ä¸åŒ React æœ¬åœ°ç»„ä»¶ã€‚
ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªç®€å•çš„å¸¦æœ‰ React Native çš„ iOS ç°æœ‰åº”ç”¨ç¨‹åºã€‚å®ƒæœ‰ä¸¤ä¸ªéå¸¸ç®€å• React æœ¬åœ°ç»„ä»¶:](https://facebook.github.io/react-native/docs/integration-with-existing-apps.html)

*   `BlueScreen`ï¼Œæ˜¾ç¤ºè“è‰²è§†å›¾
*   `RedScreen`ï¼Œæ˜¾ç¤ºçº¢è‰²è§†å›¾

```
class BlueScreen extends React.Component {
    render() {
        return (
            <View style={styles.blue} />
        );
    }
}

class RedScreen extends React.Component {
    render() {
        return (
            <View style={styles.red} />
        );
    }
}

const styles = StyleSheet.create({
    blue: {
        backgroundColor: "#0000FF",
        width: "100%",
        height: "100%"
    },
    red: {
        backgroundColor: "#FF0000",
        width: "100%",
        height: "100%"
    }
});

AppRegistry.registerComponent('BlueScreen', () => BlueScreen);
AppRegistry.registerComponent('RedScreen', () => RedScreen); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æœ¬æœºç«¯æœ‰ä¸€ä¸ªæ§åˆ¶å™¨`ReactViewController`ï¼Œå®ƒæ˜¾ç¤ºäº†ä¸€ä¸ªåä¸º React çš„æœ¬æœºç»„ä»¶ã€‚

```
class ReactViewController: UIViewController {
    init(moduleName: String) {
        super.init(nibName: nil, bundle: nil)
        view = RCTRootView(bundleURL: URL(string: "http://localhost:8081/index.bundle?platform=ios"),
                           moduleName: moduleName,
                           initialProperties: nil,
                           launchOptions: nil)
    }

    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿˜æœ‰å¦ä¸€ä¸ªæ§åˆ¶å™¨`MainViewController`ï¼Œå®ƒä½¿ç”¨å¤šä¸ª`ReactViewController`å®ä¾‹æ˜¾ç¤ºäº†ä¸Šè¿° React æœ¬åœ°ç»„ä»¶ã€‚è¯¥åº”ç”¨çš„ç”¨æˆ·ç•Œé¢éå¸¸ç®€å•:åœ¨`MainViewController`çš„è§†å›¾ä¸Šæœ‰ä¸¤ä¸ªæŒ‰é’®ã€‚ç‚¹å‡»ç¬¬ä¸€ä¸ªæŒ‰é’®ï¼Œæ˜¾ç¤ºå¸¦æœ‰åŒ…å«
`RedComponent`çš„`RCTRootView`çš„`ReactViewController`ã€‚ç‚¹å‡»ç¬¬äºŒä¸ªæŒ‰é’®ï¼Œæ˜¾ç¤ºå¸¦æœ‰åŒ…å«`BlueComponent`çš„`RCTRootView`çš„`ReactViewController`ã€‚

è¿™åŸºæœ¬ä¸Šæ„å‘³ç€åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­æœ‰å¤šä¸ª`RCTRootView`ï¼Œæ¯ä¸ªæ§åˆ¶å™¨åˆ›å»ºä¸€ä¸ªã€‚è¿™ä¸ªå®ä¾‹åŒæ—¶ä¿æŒæ´»åŠ¨(å› ä¸º`MainViewController`ä¿æŒå¯¹ä¸¤ä¸ª`ReactViewController`çš„å¼•ç”¨)ã€‚å¯åŠ¨ React æœ¬åœ°ç»„ä»¶çš„ä»£ç ä¸ç°æœ‰åº”ç”¨ç¨‹åºçš„[å…¥é—¨æ•™ç¨‹ä¸­åŒ…å«çš„ä»£ç ç›¸åŒã€‚](https://facebook.github.io/react-native/docs/integration-with-existing-apps.html) 

```
class MainViewController: UIViewController {
    private let blueViewController: ReactViewController
    private let redViewController: ReactViewController

    required init?(coder aDecoder: NSCoder) {
        blueViewController = ReactViewController(moduleName: "BlueScreen")
        redViewController = ReactViewController(moduleName: "RedScreen")
        super.init(coder: aDecoder)
    }

    @IBAction func showRedScreen(_ sender: Any) {
        navigationController?.pushViewController(redViewController, animated: true)
    }

    @IBAction func showBlueScreen(_ sender: Any) {
        navigationController?.pushViewController(blueViewController, animated: true)
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæˆ‘ä»¬å°è¯•è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼Œå°†ä¼šå‘ç”Ÿéå¸¸å¥‡æ€ªçš„äº‹æƒ…:

*   å¦‚æœæˆ‘ä»¬è¿›è¡Œå®æ—¶é‡æ–°åŠ è½½ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æˆ‘ä»¬çš„ **React ç»„ä»¶è¢«å¤šæ¬¡åˆ·æ–°**
*   å¦‚æœæˆ‘ä»¬åœ¨æ¨¡æ‹Ÿå™¨ä¸­æŒ‰ä¸‹ cmd + ctrl + z(æ‘‡åŠ¨æ‰‹åŠ¿æ¨¡æ‹Ÿ) **2 å¼€å‘èœå•å°†æ˜¾ç¤º**

[![react native multiple dev menus](img/80903125480e41e84bcd24d9378b0f40.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--YwhsRyFo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://www.fabrizioduroni.it/asseimg/posts/react-native-multiple-debugger.gif)

*   å¦‚æœæˆ‘ä»¬åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¿›è¡Œ**å®æ—¶é‡æ–°åŠ è½½ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šå´©æºƒ**

[![react native crash multiple view](img/df0a1de6e57a9abbfaa8aee2e932e5d7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--a8Csxsoa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.fabrizioduroni.it/asseimg/posts/react-native-crash-reload-with-debugger.jpg)

è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼Ÿæˆ‘ä»¬çš„ä»£ç æœ‰é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹ React Native ä»£ç ä¸­å¯¹`RCTRootView`åˆå§‹åŒ–å™¨çš„æ³¨é‡Šï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ°ä¸€äº›éå¸¸å¥‡æ€ªçš„äº‹æƒ…:

```
/**
 * - Designated initializer -
 */
- (instancetype)initWithBridge:(RCTBridge *)bridge
                    moduleName:(NSString *)moduleName
             initialProperties:(NSDictionary *)initialProperties NS_DESIGNATED_INITIALIZER;

/**
 * - Convenience initializer -
 * A bridge will be created internally.
 * This initializer is intended to be used when the app has a single RCTRootView,
 * otherwise create an `RCTBridge` and pass it in via `initWithBridge:moduleName:`
 * to all the instances.
 */
- (instancetype)initWithBundleURL:(NSURL *)bundleURL
                       moduleName:(NSString *)moduleName
                initialProperties:(NSDictionary *)initialProperties
                    launchOptions:(NSDictionary *)launchOptions; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»€ä¹ˆğŸ˜†ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼ï¼Ÿï¼ï¼Ÿï¼ï¼Ÿï¼Ÿï¼Ÿè¿™åŸºæœ¬ä¸Šæ„å‘³ç€å…¥é—¨ä¸­çš„æ–‡æ¡£åªè€ƒè™‘äº†æˆ‘ä»¬åªæœ‰ä¸€ä¸ª`RCTRootView`å®ä¾‹çš„æƒ…å†µã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„`ReactViewController`åšäº›ä»€ä¹ˆï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åŒæ—¶è®©å¤šä¸ª`RCTRootView`æ´»ç€ã€‚
æˆ‘ä»¬é—®é¢˜çš„è§£å†³æ–¹æ¡ˆåŒ…å«åœ¨ä¸Šé¢åˆå§‹åŒ–å™¨çš„æ³¨é‡Šä¸­:æˆ‘ä»¬éœ€è¦ä½¿ç”¨æŒ‡å®šçš„`RCTRootView`åˆå§‹åŒ–å™¨ï¼Œå¼€å§‹åœ¨ app ä¸­åŒæ—¶ä½¿ç”¨å®ƒä»¬çš„å¤šä¸ªå®ä¾‹ã€‚æ‰€ä»¥æ–°çš„`ReactViewController`å’Œæ–°çš„`RCTRootView`åˆå§‹åŒ–å¦‚ä¸‹:

```
class ReactViewController: UIViewController {

    init(moduleName: String, bridge: RCTBridge) {
        super.init(nibName: nil, bundle: nil)
        view = RCTRootView(bridge: bridge,
                           moduleName: moduleName,
                           initialProperties: nil)
    }

    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹äº`ReactViewController`å’Œ`RCTRootView`çš„æ–°åˆå§‹åŒ–ï¼Œæˆ‘ä»¬ä»å“ªé‡Œè·å¾—ä¸€ä¸ª`RCTBridge`çš„å®ä¾‹ï¼Ÿä¸€ä¸ªæ–°å¯¹è±¡`ReactNativeBridge`åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„`RCTBridge`å®ä¾‹ï¼Œå¹¶å°†å…¶å­˜å‚¨ä¸ºä¸€ä¸ªå±æ€§ã€‚

`RCTBridge`å®ä¾‹éœ€è¦ä¸€ä¸ª`RCTBridgeDelegate`ã€‚å¦ä¸€ä¸ªæ–°å¯¹è±¡`ReactNativeBridgeDelegate`å°†æˆä¸º`RCTBridge`çš„ä»£ç†ã€‚

```
class ReactNativeBridge {
    let bridge: RCTBridge

    init() {
        bridge = RCTBridge(delegate: ReactNativeBridgeDelegate(), launchOptions: nil)
    }
}

class ReactNativeBridgeDelegate: NSObject, RCTBridgeDelegate {

    func sourceURL(for bridge: RCTBridge!) -> URL! {
        return URL(string: "http://localhost:8081/index.bundle?platform=ios")
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨å¯ä»¥ä¿®æ”¹`MainViewController`ã€‚è¿™ä¸ªæ§åˆ¶å™¨å°†åˆ›å»ºä¸€ä¸ªå¸¦æœ‰å•ä¸ª`RCTBridge`å®ä¾‹çš„å•ä¸ª`ReactNativeBridge`ã€‚è¿™ä¸ªå®ä¾‹å°†ä¼ é€’ç»™ä¸¤ä¸ª`ReactViewController`ã€‚æ‰€ä»¥å®ƒä»¬åŸºæœ¬ä¸Šå…±äº«åŒä¸€ä¸ªæ¡¥å®ä¾‹ã€‚

```
class MainViewController: UIViewController {
    private let blueViewController: ReactViewController
    private let redViewController: ReactViewController
    private let reactNativeBridge: ReactNativeBridge

    required init?(coder aDecoder: NSCoder) {
        reactNativeBridge = ReactNativeBridge()
        blueViewController = ReactViewController(moduleName: "BlueScreen",
                                                 bridge: reactNativeBridge.bridge)
        redViewController = ReactViewController(moduleName: "RedScreen",
                                                bridge: reactNativeBridge.bridge)
        super.init(coder: aDecoder)
    }

    @IBAction func showRedScreen(_ sender: Any) {
        navigationController?.pushViewController(redViewController, animated: true)
    }

    @IBAction func showBlueScreen(_ sender: Any) {
        navigationController?.pushViewController(blueViewController, animated: true)
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å†æ¬¡å°è¯•è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼Œä¸€åˆ‡éƒ½ä¼šæŒ‰é¢„æœŸè¿è¡Œ:

*   å¦‚æœæˆ‘ä»¬è¿›è¡Œå®æ—¶é‡æ–°åŠ è½½ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æˆ‘ä»¬çš„ **React ç»„ä»¶ä»…åˆ·æ–°ä¸€æ¬¡**
*   å¦‚æœæˆ‘ä»¬åœ¨æ¨¡æ‹Ÿå™¨ä¸­æŒ‰ä¸‹ cmd + ctrl + z é”®**ï¼Œå°†æ˜¾ç¤º 1 ä¸ªå¼€å‘èœå•**
*   **è°ƒè¯•æ¨¡å¼ä¸‹å®æ—¶é‡æ–°åŠ è½½ä¸å†å´©æºƒ**

[![React Native single dev menus](img/5df6874a5ca550ce7a6a27f5780e1e73.png "React Native single dev menus")](https://res.cloudinary.com/practicaldev/image/fetch/s--XTC4QZqg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://www.fabrizioduroni.it/asseimg/posts/react-native-single-debugger.gif)

æœ¬æ–‡ä¸­ç”¨ä½œç¤ºä¾‹çš„åº”ç”¨ç¨‹åºçš„å®Œæ•´æºä»£ç åŒ…å«åœ¨ github repo ä¸­ã€‚
ç°åœ¨æˆ‘ä»¬å‡†å¤‡åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­åŒæ—¶ä½¿ç”¨å¤šä¸ª React æœ¬åœ°ç»„ä»¶ğŸ˜Œã€‚

*åŸè½½äº[https://www . fabrizioduroni . it](https://www.fabrizioduroni.it/2017/12/08/react-native-multiple-instance-rctrootview.html)2017 å¹´ 12 æœˆ 8 æ—¥ã€‚*