# ç”¨ä¸ä¸¥æ ¼çš„å‘½ä»¤æ‰“æŸäºº

> åŸæ–‡:[https://dev . to/codingcatdev/slap-someone-with-slack-commands-23oa](https://dev.to/codingcatdev/slap-someone-with-slack-commands-23oa)

> åŸå¸–:[https://ajonp.com/lessons/slap-someone-with-slack-commands/](https://ajonp.com/lessons/slap-someone-with-slack-commands/)

[https://www.youtube.com/embed/3A4iucpZiwo](https://www.youtube.com/embed/3A4iucpZiwo)

# [](#slappy-slack)æ¾æ¾å®å®

å› æ­¤ï¼Œé¢‘é“ä¸Šçš„ä¸€ä¸ªå®Œç¾æ´¾æƒ³è¦åœ¨æˆ‘ä»¬çš„ç©ºé—²é¢‘é“ä¸Šæ·»åŠ ä¸€ä¸ªæœ‰è¶£çš„`/slap`å‘½ä»¤ã€‚æˆ‘åŸºæœ¬ä¸Šè¯´äº†ï¼Œæ¥å—æŒ‘æˆ˜ï¼å¿«é€Ÿçš„è°·æ­Œæœç´¢è®©æˆ‘èµ°ä¸Šäº†æ­£ç¡®çš„é“è·¯ï¼Œæ‰¾åˆ°äº†[é¦™æ–™å·¥å‚ Slapbot](https://spicefactory.co/blog/2015/12/09/slapbot-for-slack-good-old-slap-available-again/) ã€‚æˆ‘å…‹éš†äº†è¿™ä¸ªï¼Œç„¶åå¼€å§‹åšä¸€äº›è°ƒæ•´ï¼

[![slap challenge](../Images/1e199f1bb2d0fd64ce8c89b2f6640feb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--EduXA7tz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1566663387/ajonp-ajonp-com/blog/Screen_Shot_2019-08-24_at_12.08.04_PM.png)

## [](#installation)å®‰è£…

> è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥å°†å®ƒä½œä¸ºç‹¬ç«‹çš„èŠ‚ç‚¹æœåŠ¡å™¨è¿è¡Œï¼Œä½†æ˜¯æˆ‘é€‰æ‹©ä½¿ç”¨ Firebase Cloud å‡½æ•°ï¼Œå› ä¸ºæˆ‘çš„è®¡åˆ’æ˜¯åœ¨ä»¥åæ·»åŠ ä¸€äº›æœºå™¨å­¦ä¹ ã€‚

åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘æäº¤äº†æ–‡ä»¶`.firebaserc`å’Œ`firebase.json`ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®©æˆ‘å¯ä»¥ç»§ç»­è¿›è¡Œæ›´æ”¹ã€‚å¯¹äºæ‚¨çš„é¡¹ç›®ï¼Œæ‚¨éœ€è¦åœ¨å¼€å§‹é¡¹ç›®è®¾ç½®å’Œ Firebase åˆå§‹åŒ–ä¹‹å‰åˆ é™¤è¿™äº›æ–‡ä»¶ã€‚

## [](#initialize-firebase)åˆå§‹åŒ– Firebase

> è®¾ç½® [Firebase CLI](https://firebase.google.com/docs/cli) çš„æ–‡æ¡£ã€‚

```
firebase init 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“å‡ºç°ä½ çš„é€‰æ‹©æ—¶ï¼Œå‘ä¸‹ç®­å¤´å¹¶ç‚¹å‡»ç©ºæ ¼é”®`Functions: Configure and deploy Cloud Functions`ã€‚

[![Firebase Functions select](../Images/1630f3d62a3db516e8944117666224d4.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--aWPnus4t--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1566664040/ajonp-ajonp-com/blog/Screen_Shot_2019-08-24_at_12.26.04_PM.png)

å¦‚æœä½ æƒ³å¼€å§‹ä½¿ç”¨ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œé€‰æ‹©`Create a new project`ï¼ŒæŸ¥çœ‹ [Firebase Init Docs](https://firebase.google.com/docs/cli) è·å–æ›´å¤šä¿¡æ¯ã€‚

ä¹‹åï¼Œæ‚¨å¯ä»¥é€‰æ‹© Javascript

[![JS selection for firebase init](../Images/9df9cc0803fdc09ca7c1bb9de93e9f8d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--f3ijdaZt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1566664040/ajonp-ajonp-com/blog/Screen_Shot_2019-08-24_at_12.26.20_PM.png)

å¯¹äºæœ€ç»ˆè®¾ç½®ï¼Œé™¤äº†â€œæ˜¯å¦è¦ç«‹å³å®‰è£…ä¸ npm çš„ä¾èµ–å…³ç³»ï¼Ÿâ€ï¼Œå¯¹äºè¿™ä¸ª Y(æ˜¯)ã€‚

[![Firebase init Selections](../Images/e31b3abdbc7b62cf455594a9d9882185.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--fvB8bhpC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1566664040/ajonp-ajonp-com/blog/Screen_Shot_2019-08-24_at_12.27.07_PM.png) ã€‚

ç°åœ¨ä½ å·²ç»å®Œæˆäº†ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸¤ä¸ªæ–°æ–‡ä»¶`.firebaserc`å’Œ`firebase.json`ã€‚

## [](#deploy-functions)éƒ¨ç½²åŠŸèƒ½

æŒ‰ç…§ç°åœ¨çš„æƒ…å†µï¼Œè¿™å°†å…è®¸æ‚¨è¿›è¡Œæœ¬åœ°æµ‹è¯•(è¿™ä¸æ˜¯æœ¬è¯¾çš„ç›®çš„)ã€‚æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯å°†å®ƒéƒ¨ç½²åˆ° Firebaseï¼Œä»¥ä¾¿ Slack å¯ä»¥è®¿é—®å®ƒã€‚å› ä¸ºæˆ‘ä»¬çš„é¡¹ç›®åº”è¯¥å·²ç»è®¾ç½®å¥½äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ deploy å‘½ä»¤ã€‚

ä¸ºäº†è®©æˆ‘ä»¬è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œä½ éœ€è¦ä¸ºè¿™ä¸ªé¡¹ç›®åˆ‡æ¢ä½ çš„ Firebase è®¢é˜…ï¼Œæˆ‘æ¨è Blaze è®¡åˆ’ï¼Œå› ä¸ºä½ å°†ä¸ä¼šè¢«æ”¶è´¹ï¼Œç›´åˆ°ä½ ä¸€ä¸ªæœˆè°ƒç”¨ 125ï¼Œ000 æ¬¡ï¼Œæˆ‘ä¸çŸ¥é“ä½ çš„ slack é£æ‰‡ï¼Œä½†è¿™å°†æ˜¯éå¸¸ä»¤äººå°è±¡æ·±åˆ»çš„ï¼æ‚¨å¯ä»¥é€‰æ‹©å±å¹•å·¦ä¸‹æ–¹çš„ä¿®æ”¹é¡¹ç›®ï¼Œå®ƒåº”è¯¥ä¼šæ‰“å¼€ä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„æ¨¡æ€ã€‚

ï¼[Firebase Modal([https://RES . cloud inary . com/ajonp/image/upload/v 1566667914/ajonp-ajonp-com/blog/Screen _ Shot _ 2019-08-24 _ at _ 1 . 31 . 47 _ pm . png](https://res.cloudinary.com/ajonp/image/upload/v1566667914/ajonp-ajonp-com/blog/Screen_Shot_2019-08-24_at_1.31.47_PM.png))

ç°åœ¨æ˜¯æ—¶å€™éƒ¨ç½²æˆ‘ä»¬çš„åŠŸèƒ½äº†:

```
firebase deploy 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒåº”è¯¥æˆåŠŸåœ°åˆ›å»ºäº†ä¸€ä¸ªäº‘å‡½æ•°ï¼Œè¾“å‡ºå¦‚ä¸‹: [![cloud deploy output](../Images/d1250168714c68787b142082c863da2c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--OeSB-ud7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1566667465/ajonp-ajonp-com/blog/Screen_Shot_2019-08-24_at_1.24.11_PM.png)

ä½ å¯ä»¥åœ¨ [Firebase æ§åˆ¶å°](https://console.firebase.com/)çš„å¼€å‘- >åŠŸèƒ½ä¸‹æŸ¥çœ‹

[![Functions in Console](../Images/f37cd10907a5fa6bce28efe6377d5bec.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--gwPBzWSn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1566667721/ajonp-ajonp-com/blog/Screen_Shot_2019-08-24_at_1.28.22_PM.png)

### [](#example-of-local-testing)æœ¬åœ°æµ‹è¯•çš„ä¾‹å­

```
firebase serve 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯¥å‘½ä»¤å°†è¾“å‡ºæ¨¡æ‹Ÿå™¨è¿è¡Œçš„ä½ç½®ã€‚

```
=== Serving from '/Users/ajonp/Documents/Web/slapbot'...

âš  Your requested "node" version "8" doesn't match your global version "10"
âœ” functions: Emulator started at http://localhost:5000
i functions: Watching "/Users/ajonp/Documents/Web/slapbot/functions" for Cloud Functions...
âœ” functions[api]: http function initialized (http://localhost:5000/ajonp-slack-slap/us-central1/api). 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥å¦‚æœä½ æƒ³å¯¹å®ƒä½¿ç”¨ä¸€äº› curl å‘½ä»¤ï¼Œä½ å¯ä»¥:

```
curl -X POST \
  'https://us-central1-ajonp-slack-slap.cloudfunctions.net/api/slap?callback=YOURCALLBACK' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -H 'cache-control: no-cache' \
  -d 'user_name=ajonp&text=slappy&channel_id=1234&undefined=' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#slack-configuration)æ¾å¼›é…ç½®

è½¬åˆ° Slack æœåŠ¡éƒ¨åˆ† https://.slack.com/appsã€‚æ¯”å¦‚è¯´[https://ajonp-com.slack.com/apps](https://ajonp-com.slack.com/apps)ã€‚

### [](#incoming-webhook)ä¼ å…¥ Webhook

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•è®© Slack æ¥å—æˆ‘ä»¬çš„`/slap`æ¶ˆæ¯ï¼Œä¸ºæˆ‘ä»¬çš„è´¦æˆ·è¿”å› Slack çš„ç³»ç»Ÿã€‚æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªå…¥ç«™ Webhook æ¥å…è®¸è¿™ä¸ªäº¤äº’æˆåŠŸã€‚

[![slash incoming webhooks](../Images/2ea808f59783d203d1c60961c1c38540.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zToJrmTB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1566668484/ajonp-ajonp-com/blog/Screen_Shot_2019-08-24_at_1.37.36_PM.png)

*   é€‰æ‹©è¦å‘å¸ƒçš„ä»»ä½•é¢‘é“(ä¸è¦æ‹…å¿ƒï¼Œå½“ä½ æ‰“è€³å…‰æ—¶ï¼Œæœºå™¨äººä¼šä½¿ç”¨ä½ è¾“å…¥çš„é¢‘é“)
*   å¤åˆ¶å¹¶ç²˜è´´ä½ å¾—åˆ°çš„ URL çš„ä»¤ç‰Œéƒ¨åˆ†(ç±»ä¼¼äº:`https://hooks.slack.com/services/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`
*   æ‰€ä»¥å®ƒå°†æ˜¯`/T2UR5KNQ2/BMNTDRAG0/mPToTmuARk2BqYhn93Izzbbb`éƒ¨åˆ†ï¼Œå› ä¸ºæˆ‘ä»¬å°†éœ€è¦å®ƒæ¥æ‰§è¡Œæ–œæ å‘½ä»¤ã€‚

[![Full configuration](../Images/0444206e914ce21e3ea0546dc03edada.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--KNzOkjuO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1566668484/ajonp-ajonp-com/blog/Screen_Shot_2019-08-24_at_1.41.05_PM.png)

### [](#slash-command-app)æ–œçº¿å‘½ä»¤ App

ç°åœ¨æˆ‘ä»¬éœ€è¦æ·»åŠ å’Œåº”ç”¨ç¨‹åºæ¥é…ç½®æ–œæ å‘½ä»¤ã€‚

[![Slash Command Search](../Images/62a58f1b8bc32c3a8efd1aa08e9cab2b.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Qk4tl2A_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1566667140/ajonp-ajonp-com/blog/Screen_Shot_2019-08-24_at_12.49.28_PM.png)

åœ¨ url ä¸­è¾“å…¥æ‚¨çš„æœåŠ¡ URL æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„-> `https://us-central1-ajonp-slack-slap.cloudfunctions.net/api/slap?callback=YOURCALLBACK`ã€‚

ç°åœ¨ä½ æœ‰äº†ä¸€ä¸ªå¯ä»¥ä¸ä¹‹äº’åŠ¨çš„å·¥ä½œæœºå™¨äººï¼Œä½†è¿™æ˜¯ä½ å’Œä»–ä¹‹é—´çš„ç§äººäº¤æµï¼Œæ‰€ä»¥ä½ å¯ä»¥è¯´è¿™å¹¶ä¸æœ‰è¶£ã€‚è®©æˆ‘ä»¬å˜å¾—æ›´æœ‰è¶£ï¼

*   å–`services`ä¹‹åçš„éƒ¨åˆ†ï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œå®ƒå°†æ˜¯- > `/T2UR5KNQ2/BMNTDRAG0/mPToTmuARk2BqYhn93Izzbbb`
*   å›åˆ° Slash å‘½ä»¤ï¼Œç¼–è¾‘ URLï¼Œä»ä¸Šé¢æ·»åŠ ä»¤ç‰Œéƒ¨åˆ†ï¼Œè¿™æ ·å®ƒåº”è¯¥åœ¨æœ«å°¾ï¼Œç±»ä¼¼äº`https://us-central1-ajonp-slack-slap.cloudfunctions.net/api/slap?callback=/T2UR5KNQ2/BMNTDRAG0/mPToTmuARk2BqYhn93Izzbbb`ã€‚

é¡ºä¾¿æŠŠ`https://us-central1-ajonp-slack-slap.cloudfunctions.net/api`æ›¿æ¢æˆä½ çš„ç½‘å€ï¼Œæˆ–è€…éšæ„ä½¿ç”¨è¿™ä¸ªã€‚

## [](#usage-in-slack)é—²ç½®æ—¶çš„ç”¨æ³•

åœ¨æœ€ç®€å•çš„å½¢å¼ä¸­ï¼Œä½ åªéœ€è¾“å…¥:

```
/slap @chouse 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¼šå‘Šè¯‰ slapbot ç”¨ä¸€ä¸ªé±¼è¡¨æƒ…ç¬¦å·ç»™ Chris ä¸€ä¸ªå¤§å¤§çš„è€³å…‰ã€‚æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡é”®å…¥:
æ¥æä¾›è‡ªå·±çš„è¡¨æƒ…ç¬¦å·

```
/slap @chouse :hot_pepper: 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå…‹é‡Œæ–¯å°†è¢«è¡¨æƒ…ç¬¦å·æ‰‡è€³å…‰ğŸŒ¶ã€‚LOLï¼

é»˜è®¤æƒ…å†µä¸‹ï¼Œæœºå™¨äººè¿˜ä¼šåœ¨ç»“å°¾åŒ…å«ä¸€äº›æˆè°‘ã€‚è¯·ç»§ç»­é˜…è¯»ï¼Œäº†è§£å¦‚ä½•å¯¹æ­¤è¿›è¡Œé…ç½®ã€‚

## [](#configuring-the-bot-behaviour)é…ç½®æœºå™¨äººè¡Œä¸º

*   è¦ç¼–è¾‘éšæœºæˆè°‘å­—ç¬¦ä¸²ï¼Œæ›´æ”¹`helpers.js`ä¸­çš„`banterArray`å˜é‡ã€‚
*   è¦åˆ é™¤æˆè°‘ï¼Œè¯·ä»`server.js`ä¸­`botPayload`çš„`text`å±æ€§ä¸­åˆ é™¤`banter`å˜é‡ã€‚
*   è¦æ›´æ”¹æœºå™¨äººåç§°æˆ–å›¾æ ‡ï¼Œè¯·æ›´æ”¹`server.js`ä¸­`botPayload`çš„`user_name`å’Œ`icon_emoji`å±æ€§ã€‚
*   è¦æ›´æ”¹é»˜è®¤è¡¨æƒ…ç¬¦å·ï¼Œè¯·æ›´æ”¹`constants.js`ä¸­çš„`DEFAULT_EMOJI`å˜é‡ã€‚

æ­å–œï¼Œäº«å—æŒæ´å§ï¼