# ç”¨ React é’©å­ç®€åŒ–çŠ¶æ€åˆå§‹åŒ–å™¨

> åŸæ–‡:[https://dev . to/bnevilleoneill/simplizing-state-initializer-with-react-hooks-5g 49](https://dev.to/bnevilleoneill/simplifying-state-initializers-with-react-hooks-5g49)

[![](../Images/4e11a01f6b6523703314788bf8ea5f7a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--NpMMREUW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/80ptnflz0bo8ordlmzxc.jpg)

éšç€é’©å­çš„å‡ºç°ï¼Œåœ¨ç»„ä»¶ä¹‹é—´å…±äº«é€»è¾‘çš„é¦–é€‰æ–¹å¼æ˜¯é€šè¿‡å¯é‡ç”¨çš„å®šåˆ¶é’©å­ã€‚è¦åˆ›å»ºçœŸæ­£å¯é‡ç”¨çš„å®šåˆ¶æŒ‚é’©ï¼Œæ‚¨åº”è¯¥é‡‡ç”¨ä¹…ç»è€ƒéªŒçš„é«˜çº§ React ç»„ä»¶æ¨¡å¼ã€‚å…¶ä¸­ä¸€ç§æ¨¡å¼å«åšçŠ¶æ€åˆå§‹åŒ–æ¨¡å¼ã€‚

ä»€ä¹ˆæ˜¯çŠ¶æ€åˆå§‹åŒ–å™¨æ¨¡å¼ï¼Ÿå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿä¸ºä»€ä¹ˆé‡è¦ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæ¨¡å¼æ˜¯å¦‚ä½•ç”¨é’©å­å®ç°çš„ï¼Ÿæˆ‘å¸Œæœ›åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¸ºè¿™äº›é—®é¢˜æä¾›ç­”æ¡ˆã€‚

å¦‚æœä½ å¯¹ç”¨é’©å­å®ç°æ¯ä¸€ä¸ªé«˜çº§çš„ React æ¨¡å¼æ„Ÿå…´è¶£ï¼Œä½ åº”è¯¥å»çœ‹çœ‹æˆ‘çš„ä¹¦ï¼Œâ€œé‡æ–°å¼•å…¥ Reactâ€æˆ‘ä»”ç»†è€Œè¯¦ç»†åœ°è®¨è®ºäº†è¿™ä¸ªé—®é¢˜ã€‚

è¯·æ³¨æ„ï¼Œæ–‡ç« çš„ä»¥ä¸‹éƒ¨åˆ†å‡è®¾[åœ¨é’©å­](https://medium.com/free-code-camp/learn-the-basics-of-react-hooks-in-10-minutes-b2898287fe5d)ä¸ŠåŸºæœ¬æµç•…ã€‚

## [![LogRocket Free Trial Banner](../Images/4aa67f42a82d61c79b61acb13eae9479.png)T4ã€‘](https://logrocket.com/signup/)

## [](#what-does-it-mean-to-initialize-state)åˆå§‹åŒ–çŠ¶æ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

ä¸€èˆ¬æ¥è¯´ï¼Œåˆå§‹åŒ–æ„å‘³ç€è®¾ç½®æŸç‰©çš„å€¼ã€‚æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼ŒçŠ¶æ€åˆå§‹åŒ–å™¨æ¨¡å¼çš„å­˜åœ¨æ˜¯ä¸ºäº†è®©å®šåˆ¶é’©å­çš„æ¶ˆè´¹è€…èƒ½å¤Ÿæ›´å®¹æ˜“åœ°è®¾ç½®â€œçŠ¶æ€å€¼â€

æ³¨æ„ï¼ŒçŠ¶æ€åˆå§‹åŒ–æ¨¡å¼å¹¶ä¸æ¯æ¬¡éƒ½å®Œå…¨æ§åˆ¶çŠ¶æ€çš„è®¾ç½®å€¼ï¼›å®ƒä¸»è¦å…è®¸åœ¨æ‚¨çš„è‡ªå®šä¹‰é’©å­ä¸­è®¾ç½®åˆå§‹çŠ¶æ€ï¼Œå¹¶å°†çŠ¶æ€é‡ç½®ä¸ºåˆå§‹é»˜è®¤å€¼ã€‚

è™½ç„¶è¿™å¹¶ä¸ç­‰åŒäºåœ¨è‡ªå®šä¹‰é’©å­ä¸­å®Œå…¨æ§åˆ¶çŠ¶æ€å€¼çš„è®¾ç½®ï¼Œä½†æ˜¯å®ƒæä¾›äº†å¾ˆå¤§çš„å¥½å¤„ï¼Œæ‚¨å¾ˆå¿«å°±ä¼šçœ‹åˆ°ã€‚

## [](#the-demo-app)æ¼”ç¤ºåº”ç”¨ç¨‹åº

æˆ‘å°†åŠ¡å®åœ°è®¨è®ºè¿™ä¸ªä¸»é¢˜ï¼Œæ‰€ä»¥è¿™æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨çš„[æ¼”ç¤ºåº”ç”¨ç¨‹åº](https://codesandbox.io/s/stateinitializer-g5kuu)ã€‚

è¿™æœ‰ç‚¹åšä½œï¼Œä½†æˆ‘ä¿è¯è¿™ä¸ä¼šå½±å“å¯¹å¸¦é’©å­çš„çŠ¶æ€åˆå§‹åŒ–æ¨¡å¼çš„ç†è§£ã€‚

[![Demo App Displaying State Initializer Pattern](../Images/4f3e74972bd385661c9ccb2429050c32.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--h-kgyO20--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://i0.wp.com/blog.logrocket.com/wp-content/uploads/2019/06/state-initializer-demo-app.gif%3Fssl%3D1)

æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªç¾åŒ–äº†çš„è®¡æ•°å™¨åº”ç”¨ç¨‹åºã€‚ä½ ç‚¹å‡»**æ›´å¤šå’–å•¡**æŒ‰é’®ï¼Œå’–å•¡æ¯çš„æ•°é‡å¢åŠ ã€‚

ä¸»è¦çš„`App`ç»„ä»¶åˆ©ç”¨ä¸€ä¸ªå®šåˆ¶çš„é’©å­æ¥ç®¡ç†å’–å•¡æ¯çš„æ•°é‡ã€‚ä¸‹é¢æ˜¯è‡ªå®šä¹‰é’©å­çš„å®ç°ï¼Œ`useCounter`ï¼Œçœ‹èµ·æ¥åƒ:

```
// the App uses this custom hook to track the count of coffee cups 

function useCounter() {
  const [count, setCount] = useState(1);

  return {
    count,
    setCount
  };
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢è‡ªå®šä¹‰é’©å­çš„ä¸€ä¸ªæ›´è°¨æ…çš„å®ç°æ˜¯è®°å¿†è‡ªå®šä¹‰é’©å­è¿”å›çš„å¯¹è±¡å€¼ã€‚

```
// good 
return {
   count,
   setCount
};

// better 
return useMemo(() => ({
  count, 
  setCount 
})) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç»§ç»­å§ã€‚

## å‘ä¸€ä¸ª 5 å²çš„å­©å­è§£é‡ŠçŠ¶æ€åˆå§‹åŒ–æ¨¡å¼

å°±æˆ‘æ‰€çŸ¥ï¼Œæ¯ä¸ªäººéƒ½æ˜¯ä»å©´å„¿å¼€å§‹ç”Ÿå‘½çš„ã€‚å‡ å¹´åï¼Œå®ƒä»¬ä¼šé•¿å¤§æˆäººï¼Œç›´åˆ°å˜è€ã€‚

ç”¨â€œååº”æ€§â€çš„æœ¯è¯­æ¥è¯´ï¼Œäººç±»æœ€åˆçš„çŠ¶æ€æ˜¯å©´å„¿ã€‚æ­¤çŠ¶æ€æ˜¯é¢„å®šä¹‰çš„ï¼Œæ— æ³•æ›´æ”¹ï¼›æ²¡æœ‰äººæ˜¯ä½œä¸ºä¸€ä¸ªæ²¡æœ‰ç«¥å¹´çš„æˆå¹´äººæ¥åˆ°è¿™ä¸ªä¸–ç•Œçš„ã€‚

è€ƒè™‘åˆ°å¯é‡ç”¨çš„å®šåˆ¶é’©å­ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªæœ‰ä¸¥é‡ç¼ºé™·çš„è®¾è®¡ã€‚ä½ çš„å¯é‡ç”¨å®šåˆ¶é’©å­çš„åˆå§‹çŠ¶æ€ä¸åº”è¯¥æ˜¯ä¸€æˆä¸å˜çš„ã€‚æ‚¨åº”è¯¥è®©æ‚¨çš„å¯é‡ç”¨å®šåˆ¶é’©å­çš„æ¶ˆè´¹è€…èƒ½å¤Ÿå†³å®šé’©å­çš„åˆå§‹çŠ¶æ€ã€‚

æœ‰è¶£çš„æ˜¯ï¼Œè®¾ç½®è‡ªå®šä¹‰å¯é‡ç”¨é’©å­çš„åˆå§‹çŠ¶æ€å¹¶ä¸æ˜¯çŠ¶æ€åˆå§‹åŒ–å™¨æ¨¡å¼æå‡ºçš„å”¯ä¸€è¦æ±‚ã€‚

è€ƒè™‘ä»¥ä¸‹æƒ…å†µ:éšç€äººç±»çš„æˆé•¿ï¼Œæ²¡æœ‰åŠæ³•å°†ä¸€ä¸ªå®Œå…¨æˆç†Ÿçš„æˆå¹´äººé‡ç½®å›å©´å„¿çŠ¶æ€(å³åˆå§‹çŠ¶æ€)ã€‚æˆ‘çŸ¥é“è¿™å¬èµ·æ¥å¾ˆè’è°¬ï¼Œä½†æ˜¯è¿™ä¸ªç¡®åˆ‡çš„ç‰¹æ€§æ˜¯åœ¨çŠ¶æ€åˆå§‹åŒ–æ¨¡å¼ä¸­å®ç°çš„ã€‚

åœ¨ä»»ä½•æ—¶å€™ï¼Œå®ç°çŠ¶æ€åˆå§‹åŒ–å™¨æ¨¡å¼æ„å‘³ç€æš´éœ²ä¸€ä¸ªé‡ç½®å›è°ƒï¼Œé’©å­çš„æ¶ˆè´¹è€…å¯ä»¥åœ¨ä»–ä»¬è®¤ä¸ºåˆé€‚çš„æ—¶å€™å°†çŠ¶æ€é‡ç½®ä¸ºåˆå§‹çŠ¶æ€ã€‚

æˆ‘ç°åœ¨å·²ç»å¼ºè°ƒäº†ä¸¤ä¸ªéœ€æ±‚ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªéœ€æ±‚éœ€è¦è§£å†³:æ‚¨è¿˜å¿…é¡»ä½¿æ¶ˆè´¹è€…èƒ½å¤Ÿåœ¨æ‰§è¡Œé‡ç½®åç«‹å³æ‰§è¡Œä»»ä½•å‰¯ä½œç”¨ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æˆåŠŸåœ°å°†ä¸€ä¸ªäººä»æˆäººé‡ç½®ä¸ºå©´å„¿(åˆå§‹çŠ¶æ€)ï¼Œæ‚¨éœ€è¦æ‰§è¡Œæ¸…ç†ï¼Œå¦‚å‡ºå”®æˆäººçš„è´¢äº§ï¼Œå‘ä»–ä»¬çš„å·¥ä½œåœ°ç‚¹å‘é€ç»ˆæ­¢ç”µå­é‚®ä»¶ï¼Œå‘ä»–ä»¬çš„é…å¶å‘å‡ºç¦»å©šç­‰ã€‚

ä¸€ä¸ªå©´å„¿ä¸éœ€è¦è¿™äº›ï¼æ‰€ä»¥ï¼Œæ¸…ç†ä»–ä»¬çš„æˆå¹´ç”Ÿæ´»å§ï¼

åŒæ ·ï¼Œå½“æ‚¨å°†ç»„ä»¶é‡ç½®ä¸ºåˆå§‹çŠ¶æ€æ—¶ï¼Œåœ¨æŸäº›ç”¨ä¾‹ä¸­ï¼Œæ¶ˆè´¹è€…éœ€è¦æ‰§è¡Œæ¸…ç†ã€‚æ‚¨éœ€è¦ä½¿è¯¥åŠŸèƒ½å¯ç”¨ã€‚

è¿™å°±å¯¹äº†ã€‚ç°åœ¨æ¨ç†çŠ¶æ€åˆå§‹åŒ–å™¨æ¨¡å¼åº”è¯¥æ›´å®¹æ˜“äº†ã€‚

## [](#reiterating-the-requirements)é‡ç”³è¦æ±‚

ä¸ºäº†ç¡®ä¿æ‚¨æ²¡æœ‰è¢«ä¸Šä¸€èŠ‚çš„è§£é‡Šå†²æ˜å¤´è„‘ï¼Œä¸‹é¢æ˜¯çŠ¶æ€åˆå§‹åŒ–å™¨æ¨¡å¼æ»¡è¶³çš„éœ€æ±‚:

1.  å…è®¸å¯é…ç½®çš„åˆå§‹çŠ¶æ€
2.  å‘ä½¿ç”¨è€…å…¬å¼€é‡ç½®å‡½æ•°å¤„ç†ç¨‹åº
3.  å…è®¸åœ¨é‡ç½®åç«‹å³æ‰§è¡Œä»»ä½•å‰¯ä½œç”¨

### [](#1-configurable-initial-state)1ã€‚å¯é…ç½®åˆå§‹çŠ¶æ€

æ¨¡å¼çš„ç¬¬ä¸€ä¸ªéœ€æ±‚æ°å¥½æ˜¯æœ€å®¹æ˜“è§£å†³çš„ã€‚è€ƒè™‘å®šåˆ¶é’©å­çš„åˆå§‹å®ç°:

```
function useCounter () {
  const [count, setCount] = useState(1);

  return {
    count,
    setCount
  };
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ç¬¬ 2 è¡Œï¼Œé’©å­å†…çš„åˆå§‹çŠ¶æ€è¢«è®¾ç½®ã€‚

```
const [count, setCount] = useState(1) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸è¦ç¡¬ç¼–ç åˆå§‹çŠ¶æ€ï¼Œè€Œæ˜¯ç¼–è¾‘é’©å­æ¥æœŸå¾…ä¸€ä¸ªåä¸º`initialCount`çš„å‚æ•°ï¼Œå¹¶å°†è¿™ä¸ªå€¼ä¼ é€’ç»™`useState`è°ƒç”¨ã€‚

```
function useCounter (initialCount) {
  const [count, setCount] = useState(initialCount);

  return {
    count,
    setCount
  };
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†æ›´å…·é˜²å¾¡æ€§ï¼Œå¯ä»¥é€šè¿‡é»˜è®¤çš„å‚æ•°è¯­æ³•è®¾ç½®ä¸€ä¸ªå›é€€ã€‚è¿™å°†è¿åˆä¸é€šè¿‡è¿™ä¸ª`initialCount`å‚æ•°çš„ç”¨æˆ·ã€‚

```
function useCounter (initialCount = 1) {
  const [count, setCount] = useState(initialCount);

  return {
    count,
    setCount
  };
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è‡ªå®šä¹‰é’©å­åº”è¯¥åƒä»¥å‰ä¸€æ ·å·¥ä½œï¼Œä½†æ˜¯åœ¨åˆå§‹åŒ–åˆå§‹çŠ¶æ€æ—¶æ›´åŠ çµæ´»ã€‚æˆ‘å°†æŠŠåˆå§‹å’–å•¡æ¯æ•°åˆå§‹åŒ–ä¸º 10ï¼Œå¦‚ä¸‹æ‰€ç¤º:

[![Demo Illustrating Configurable Initial State](../Images/03b8781f02ba095cdd1130b5cdc7e65e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--04z7mDh0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://i1.wp.com/blog.logrocket.com/wp-content/uploads/2019/06/configurable-initial-state-example-1024x484.gif%3Fresize%3D1024%252C484%26ssl%3D1)

è¿™æ­£æ˜¯æ¶ˆè´¹è€…ä½¿ç”¨å®ç°çš„åŠŸèƒ½åˆå§‹åŒ–çŠ¶æ€çš„æ–¹å¼ã€‚è®©æˆ‘ä»¬ç»§ç»­æ»¡è¶³å…¶ä»–è¦æ±‚ã€‚

### [](#2-handling-resets)2ã€‚å¤„ç†å¤ä½

ä¸ºäº†å¤„ç†é‡ç½®ï¼Œæˆ‘ä»¬éœ€è¦å…¬å¼€ä¸€ä¸ªå›è°ƒï¼Œæ¶ˆè´¹è€…å¯ä»¥åœ¨ä»»ä½•æ—¶é—´ç‚¹è°ƒç”¨å®ƒã€‚ä»¥ä¸‹æ˜¯æ–¹æ³•ã€‚é¦–å…ˆï¼Œåœ¨è‡ªå®šä¹‰é’©å­ä¸­åˆ›å»ºä¸€ä¸ªæ‰§è¡Œå®é™…å¤ä½çš„å‡½æ•°:

```
function useCounter (initialCount = 1) {
  const [count, setCount] = useState(initialCount);
  // look here ğŸ‘‡
  const reset = useCallback(() => {
        setCount(initialCount)
  }, [initialCount])

  return {
    count,
    setCount
  };
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬é€šè¿‡åˆ©ç”¨`useCallback`é’©å­æ¥ä¼˜åŒ–å¤ä½å›è°ƒã€‚æ³¨æ„ï¼Œåœ¨é‡ç½®å›è°ƒä¸­æœ‰ä¸€ä¸ªç®€å•çš„çŠ¶æ€æ›´æ–°å™¨è°ƒç”¨ï¼Œ`setCount` :

```
setCount(initialCount) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒè´Ÿè´£å°†çŠ¶æ€è®¾ç½®ä¸ºç”¨æˆ·ä¼ å…¥çš„åˆå§‹å€¼ï¼Œæˆ–è€…æ‚¨é€šè¿‡é»˜è®¤å‚æ•°è¯­æ³•æä¾›çš„é»˜è®¤å€¼ã€‚ç°åœ¨ï¼Œåœ¨è¿”å›çš„å¯¹è±¡å€¼ä¸­å…¬å¼€è¿™ä¸ª reset å›è°ƒï¼Œå¦‚ä¸‹:

```
... 
return {
  count, 
  setCount, 
  reset 
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œè¿™ä¸ªå®šåˆ¶é’©å­çš„ä»»ä½•æ¶ˆè´¹è€…éƒ½å¯ä»¥æ£€ç´¢å¤ä½å›è°ƒï¼Œå¹¶åœ¨éœ€è¦æ—¶æ‰§è¡Œå¤ä½ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­:

[![Example Of Demo App Handling Resets](../Images/fc85a2a75cd10ca8e1b4e74e2defbdd7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--GLwU2f8U--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://i0.wp.com/blog.logrocket.com/wp-content/uploads/2019/06/handling-resets-example-1024x478.gif%3Fresize%3D1024%252C478%26ssl%3D1)

### [](#3-triggering-a-side-effect-after-a-reset)3ã€‚é‡ç½®åè§¦å‘å‰¯ä½œç”¨

æœ€åï¼Œæˆ‘ä»¬è®¨è®ºçŠ¶æ€åˆå§‹åŒ–æ¨¡å¼çš„æœ€åä¸€ä¸ªéœ€æ±‚ã€‚ä½ çŸ¥é“å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å—(ä¾‹å¦‚ï¼Œå¼•å‘å‰¯ä½œç”¨)ï¼Ÿè¿™æœ‰ç‚¹æ£˜æ‰‹ï¼Œä½†å¾ˆå®¹æ˜“æ»¡è¶³ã€‚é¦–å…ˆï¼Œè€ƒè™‘å¦‚ä½•åœ¨å…¸å‹çš„åŠŸèƒ½ç»„ä»¶ä¸­è§¦å‘å‰¯ä½œç”¨:

```
useEffect(() => {
 // perform side effect here
}, [dependency]) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯ä»¥æœ‰æŠŠæ¡åœ°å‡è®¾è¿™ä¸ªç»„ä»¶çš„æ¶ˆè´¹è€…ä¼šåšç±»ä¼¼çš„äº‹æƒ…ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œéœ€è¦ä»å®šåˆ¶é’©å­ä¸­æš´éœ²å‡ºä»€ä¹ˆå‘¢ï¼Ÿ

å¥½å§ï¼Œçœ‹çœ‹ä¼ é€’ç»™`useEffect`æ•°ç»„ä¾èµ–é¡¹çš„å€¼ã€‚

æ‚¨éœ€è¦å…¬å¼€ä¸€ä¸ªä¾èµ–é¡¹â€”â€”ä¸€ä¸ªåªæœ‰åœ¨å†…éƒ¨è§¦å‘é‡ç½®æ—¶æ‰ä¼šæ”¹å˜çš„ä¾èµ–é¡¹ï¼Œä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨è€…è°ƒç”¨é‡ç½®å›è°ƒåã€‚

æœ‰ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘å†’æ˜§åœ°åœ¨â€œ[é‡æ–°å¼•å…¥ React](https://leanpub.com/reintroducing-react) â€ä¸­è§£é‡Šäº†è¿™ä¸¤è€…ã€‚

ç„¶è€Œï¼Œä»¥ä¸‹æ˜¯æˆ‘è®¤ä¸ºçš„é¦–é€‰è§£å†³æ–¹æ¡ˆ:

```
function useCounter(initialCount = 1) {
  const [count, setCount] = useState(initialCount);
  // 1\. look here ğŸ‘‡
  const resetRef = useRef(0);

  const reset = useCallback(() => {
    setCount(initialCount);
    // 2\. ğŸ‘‡ update reset count
    ++resetRef.current;
  }, [initialCount]);

  return {
    count,
    setCount,
    reset,
    resetDep: resetRef.current // 3\. ğŸ‘ˆ expose this dependency
  };
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨æŸ¥çœ‹ä¸Šé¢çš„ä»£ç ï¼Œæ‚¨ä¼šå‘ç°ä¸‰è¡Œæ³¨é‡Šã€‚

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª`ref`æ¥ä¿å­˜å·²ç»è§¦å‘çš„å¤ä½æ¬¡æ•°ã€‚è¿™æ˜¯é€šè¿‡`useRef`æŒ‚é’©å®Œæˆçš„ã€‚

```
...
// 1\. look here ğŸ‘‡
const resetRef = useRef(0);
... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¯å½“ç”¨æˆ·è°ƒç”¨ reset å›è°ƒå‡½æ•°æ—¶ï¼Œéƒ½éœ€è¦æ›´æ–° reset ref è®¡æ•°ã€‚

```
...
const reset = useCallback(() => {
    setCount(initialCount);

    // 2\. ğŸ‘‡ update reset count
    ++resetRef.current;

  }, [initialCount]);
... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œå°†è¿™ä¸ªé‡ç½®è®¡æ•°å…¬å¼€ä¸º`resetDep`ï¼Œé‡ç½®ä¾èµ–ã€‚

```
...
return {
    count,
    setCount,
    reset,
    resetDep: resetRef.current // 3\. ğŸ‘ˆ expose this dependency
  };
... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åï¼Œç”¨æˆ·å¯ä»¥æ£€ç´¢è¯¥é‡ç½®ç›¸å…³æ€§`resetDep`ï¼Œå¹¶ä¸”å½“è¯¥å€¼æ”¹å˜æ—¶ï¼Œä»…æ‰§è¡Œå‰¯ä½œç”¨*ã€‚*

 *è¿™å°±å¼•å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œæ¶ˆè´¹è€…å°†å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæš´éœ²çš„`resetDep`ï¼Ÿæˆ‘å°†è¿›ä¸€æ­¥è§£é‡Šå®šåˆ¶é’©å­çš„æ¶ˆè´¹è€…å¦‚ä½•ä½¿ç”¨è¿™ç§é‡ç½®ä¾èµ–ã€‚

å¿«é€Ÿé—®ç­”:ä½ è®¤ä¸ºä¸‹é¢çš„è§£å†³æ–¹æ¡ˆå¯è¡Œå—ï¼Ÿ

```
// consumer's app 
const { resetDep } = useCounter() 

useEffect(() => {
  // side effect after reset
}, [resetDep]) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ä¼šåƒé¢„æœŸçš„é‚£æ ·èµ·ä½œç”¨ã€‚é‚£ä¹ˆï¼Œä¸Šé¢çš„è§£å†³æ–¹æ¡ˆæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ

è¿™é‡Œçš„é—®é¢˜æ˜¯`useEffect`æ€»æ˜¯åœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æŒ‚è½½çš„æ—¶å€™è¢«ç¬¬ä¸€ä¸ªè§¦å‘ï¼å› æ­¤ï¼Œå¤ä½å‰¯ä½œç”¨å°†åœ¨æŒ‚è½½æ—¶è§¦å‘ï¼Œéšåï¼Œæ¯å½“`resetDep`æ”¹å˜æ—¶è§¦å‘ã€‚

è¿™ä¸æ˜¯æˆ‘ä»¬å¯»æ±‚çš„è¡Œä¸ºï¼›æˆ‘ä»¬ä¸å¸Œæœ›åœ¨æŒ‚è½½æ—¶è§¦å‘é‡ç½®å‰¯ä½œç”¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”¨æˆ·å¯ä»¥æ£€æŸ¥ç»„ä»¶ä½•æ—¶å®‰è£…ï¼Œç„¶åæ‰è§¦å‘æ•ˆæœå‡½æ•°ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ:

```
// consumer's app 
const {resetDep} = useCounter() 

// boolean ref. default to true
const componentJustMounted = useRef(true) 

useEffect(() => {
    if(!componentJustMounted) {
       // perform side effect 
       //only when the component isn't just mounted 
     }
  // if not set boolean ref to false. 
  componentJustMounted.current = false; 
}, [resetDep]) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸æ˜¯ä¸€ä¸ªå›°éš¾çš„å®ç°ã€‚

ç„¶è€Œï¼Œå¦‚æœæ‚¨å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæµè¡Œçš„å¯é‡ç”¨é’©å­ï¼Œæˆ–è€…åªæ˜¯æƒ³ä¸ºé’©å­çš„æ¶ˆè´¹è€…å…¬å¼€ä¸€ä¸ªæ›´ç®€å•çš„ APIï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å°†ä¸Šé¢çš„æ‰€æœ‰åŠŸèƒ½åŒ…è£…å¹¶å…¬å¼€åœ¨å¦ä¸€ä¸ªå®šåˆ¶é’©å­ä¸­ï¼Œä¾›æ¶ˆè´¹è€…ä½¿ç”¨â€”â€”ç±»ä¼¼äº`useEffectAfterMount`ã€‚

æ— è®ºå¦‚ä½•ï¼Œé‡ç½®ä¾èµ–é¡¹çš„å®ç°ä»ç„¶æœ‰æ•ˆã€‚ä¸éœ€è¦åœ¨å†…éƒ¨è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚

## [](#conclusion)ç»“è®º

è®¾è®¡æ¨¡å¼çš„å­˜åœ¨æ˜¯ä¸ºäº†ç»™å¸¸è§é—®é¢˜æä¾›ä¸€è‡´çš„è§£å†³æ–¹æ¡ˆã€‚é«˜çº§çš„ React è®¾è®¡æ¨¡å¼ä¹Ÿå¯ä»¥ä¸ºæ„å»ºçœŸæ­£å¯é‡ç”¨çš„ç»„ä»¶æä¾›ä¸€è‡´çš„è§£å†³æ–¹æ¡ˆã€‚

æƒ³äº†è§£æ›´å¤šå…³äºæ„å»ºçœŸæ­£å¯é‡ç”¨é’©å­çš„çŸ¥è¯†å—ï¼Ÿçœ‹çœ‹æˆ‘çš„æ–°ä¹¦ï¼Œã€Šé‡æ–°å¼•å…¥ååº”ã€‹

å›å¤´è§ï¼

* * *

## [](#plug-logrocket-a-dvr-for-web-apps)Plug: [LogRocket](https://logrocket.com/signup/) ï¼Œä¸€æ¬¾é€‚ç”¨äºç½‘ç»œåº”ç”¨çš„ DVR

[![LogRocket Dashboard Free Trial Banner](../Images/0abf868fe5ccbed99d71cb8d9e81ed98.png)T2ã€‘](https://logrocket.com/signup/)

LogRocket æ˜¯ä¸€ä¸ªå‰ç«¯æ—¥å¿—å·¥å…·ï¼Œå¯ä»¥è®©ä½ å›æ”¾é—®é¢˜ï¼Œå°±åƒå®ƒä»¬å‘ç”Ÿåœ¨ä½ è‡ªå·±çš„æµè§ˆå™¨ä¸­ä¸€æ ·ã€‚LogRocket ä¸éœ€è¦çŒœæµ‹é”™è¯¯å‘ç”Ÿçš„åŸå› ï¼Œä¹Ÿä¸éœ€è¦å‘ç”¨æˆ·è¯¢é—®æˆªå›¾å’Œæ—¥å¿—è½¬å‚¨ï¼Œè€Œæ˜¯è®©æ‚¨é‡æ”¾ä¼šè¯ä»¥å¿«é€Ÿäº†è§£å“ªé‡Œå‡ºé”™äº†ã€‚å®ƒå¯ä»¥ä¸ä»»ä½•åº”ç”¨ç¨‹åºå®Œç¾é…åˆï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ¡†æ¶ï¼Œå¹¶ä¸”æœ‰æ’ä»¶å¯ä»¥è®°å½•æ¥è‡ª Reduxã€Vuex å’Œ@ngrx/store çš„é¢å¤–ä¸Šä¸‹æ–‡ã€‚

é™¤äº†è®°å½• Redux æ“ä½œå’ŒçŠ¶æ€ï¼ŒLogRocket è¿˜è®°å½•æ§åˆ¶å°æ—¥å¿—ã€JavaScript é”™è¯¯ã€å †æ ˆè·Ÿè¸ªã€å¸¦æœ‰å¤´+æ­£æ–‡çš„ç½‘ç»œè¯·æ±‚/å“åº”ã€æµè§ˆå™¨å…ƒæ•°æ®å’Œè‡ªå®šä¹‰æ—¥å¿—ã€‚å®ƒè¿˜ä½¿ç”¨ DOM æ¥è®°å½•é¡µé¢ä¸Šçš„ HTML å’Œ CSSï¼Œç”šè‡³ä¸ºæœ€å¤æ‚çš„å•é¡µé¢åº”ç”¨ç¨‹åºé‡æ–°åˆ›å»ºåƒç´ çº§å®Œç¾è§†é¢‘ã€‚

[å…è´¹è¯•ç”¨](https://logrocket.com/signup/)ã€‚

* * *

å¸–å­[ç”¨ React é’©å­](https://blog.logrocket.com/simplifying-state-initializers-with-react-hooks/)ç®€åŒ–çŠ¶æ€åˆå§‹åŒ–å™¨æœ€å…ˆå‡ºç°åœ¨[åšå®¢](https://blog.logrocket.com)ä¸Šã€‚*