# æ•™ç¨‹:Kubernetes å·çš„åŸºç¡€(ç¬¬ 1 éƒ¨åˆ†)

> åŸæ–‡ï¼š<https://dev.to/itnext/tutorial-basics-of-kubernetes-volumes-part-1-jhm>

æˆ‘ä»¬ç»§ç»­æˆ‘ä»¬çš„â€œæœå£³ä¸­çš„åº“ä¼¯å†…ç‰¹â€ä¹‹æ—…ï¼Œè¿™ä¸€éƒ¨åˆ†å°†æ¶µç›–åº“ä¼¯å†…ç‰¹å·ï¼æ‚¨å°†äº†è§£åˆ°:

*   æ¦‚è¿°`Volume`ä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒä»¬
*   å¦‚ä½•ä½¿ç”¨`Volume`
*   å¸®åŠ©å®é™…æ¢ç´¢`Volume` s çš„åŠ¨æ‰‹ç¤ºä¾‹

ä»£ç å¯ä» GitHub ä¸Šçš„[è·å¾—](https://github.com/abhirockzz/kubernetes-in-a-nutshell/blob/master/volumes-1)

> å¾ˆé«˜å…´é€šè¿‡ [Twitter](https://twitter.com/abhi_tweeter) è·å¾—æ‚¨çš„åé¦ˆï¼Œæˆ–è€…å‘è¡¨è¯„è®ºï¼

## å…ˆå†³æ¡ä»¶:

ä½ å°†éœ€è¦`minikube`å’Œ`kubectl`ã€‚

å°† [`minikube`](https://kubernetes.io/docs/tasks/tools/install-minikube/) ä½œä¸ºå•èŠ‚ç‚¹ Kubernetes é›†ç¾¤å®‰è£…åœ¨æ‚¨è®¡ç®—æœºä¸Šçš„è™šæ‹Ÿæœºä¸­ã€‚åœ¨ Mac ä¸Šï¼Œä½ å¯ä»¥ç®€å•åœ°:

```
curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64 \
  && chmod +x minikube

sudo mv minikube /usr/local/bin 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®‰è£… [`kubectl`](https://kubernetes.io/docs/tasks/tools/install-kubectl/) ä¸ä½ çš„ AKS é›†ç¾¤äº¤äº’ã€‚åœ¨ Mac ä¸Šï¼Œä½ å¯ä»¥ç®€å•åœ°:

```
curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/darwin/amd64/kubectl
chmod +x ./kubectl
sudo mv ./kubectl /usr/local/bin/kubectl 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## æ¦‚è¿°

å­˜å‚¨åœ¨ Docker å®¹å™¨ä¸­çš„æ•°æ®æ˜¯çŸ­æš‚çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåªåœ¨å®¹å™¨å­˜æ´»ä¹‹å‰å­˜åœ¨ã€‚Kubernetes å¯ä»¥é‡å¯ä¸€ä¸ªå¤±è´¥æˆ–å´©æºƒçš„å®¹å™¨(åœ¨åŒä¸€ä¸ª`Pod`ä¸­)ï¼Œä½†æ˜¯æ‚¨æœ€ç»ˆä»ç„¶ä¼šä¸¢å¤±æ‚¨å¯èƒ½å·²ç»å­˜å‚¨åœ¨å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä»»ä½•æ•°æ®ã€‚Kubernetes åœ¨`Volume` s çš„å¸®åŠ©ä¸‹è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒæ”¯æŒå¤šç§ç±»å‹çš„`Volume`ï¼ŒåŒ…æ‹¬å¤–éƒ¨äº‘å­˜å‚¨(ä¾‹å¦‚ [Azure Disk](https://azure.microsoft.com/services/storage/disks/?WT.mc_id=devto-blog-abhishgu) ã€äºšé©¬é€Š EBSã€GCE æŒä¹…ç›˜ç­‰ã€‚)ã€ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ Cephã€GlusterFS ç­‰ã€‚ä»¥åŠå…¶ä»–é€‰é¡¹ï¼Œå¦‚`emptyDir`ã€`hostPath`ã€`local`ã€`downwardAPI`ã€`secret`ã€`config`ç­‰ã€‚

### å·æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿ

ä½¿ç”¨ä¸€ä¸ª`Volume`ç›¸å¯¹ç®€å•â€”â€”çœ‹çœ‹è¿™ä¸ªéƒ¨åˆ†çš„`Pod`è§„èŒƒä½œä¸ºä¾‹å­

```
spec:
  containers:
  - name: kvstore
    image: abhirockzz/kvstore:latest
    volumeMounts:
    - mountPath: /data
      name: data-volume
    ports:
    - containerPort: 8080
  volumes:
    - name: data-volume
      emptyDir: {} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„ä»¥ä¸‹äº‹é¡¹:

*   `spec.volumes` -å£°æ˜å¯ç”¨å·ã€å…¶`name`(ä¾‹å¦‚`data-volume`)å’Œå…¶ä»–(å·)ç‰¹å®šç‰¹å¾ï¼Œä¾‹å¦‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶æŒ‡å‘ Azure ç£ç›˜
*   `spec.containers.volumeMounts` -å®ƒæŒ‡å‘åœ¨`spec.volumes`(ä¾‹å¦‚`data-volume`)ä¸­å£°æ˜çš„ä¸€ä¸ªå·ï¼Œå¹¶ç¡®åˆ‡åœ°æŒ‡å®šå®ƒæƒ³è¦åœ¨å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä»€ä¹ˆä½ç½®æŒ‚è½½è¯¥å·(ä¾‹å¦‚`/data`)ã€‚

[![](img/8188f6c733ad41088cd7d0c17e172044.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--qXuAt1Zz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/k39990r9jd888qwycu65.jpg)

ä¸€ä¸ª`Pod`å¯ä»¥æœ‰å¤šä¸ª`Volume`åœ¨`spec.volumes`ä¸­å£°æ˜ã€‚è¿™äº›`Volume`ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯ä»¥è¢«`Pod`ä¸­çš„æ‰€æœ‰å®¹å™¨è®¿é—®ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰å®¹å™¨éƒ½å¿…é¡»æŒ‚è½½æˆ–ä½¿ç”¨æ‰€æœ‰çš„å·ã€‚å¦‚æœéœ€è¦ï¼Œ`Pod`ä¸­çš„å®¹å™¨å¯ä»¥å°†å¤šä¸ªå·æŒ‚è½½åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ä¸åŒè·¯å¾„ä¸­ã€‚æ­¤å¤–ï¼Œä¸åŒçš„å®¹å™¨å¯èƒ½åŒæ—¶è£…è½½ä¸€ä¸ªå·ã€‚

### å·çš„å¦ä¸€ç§åˆ†ç±»æ–¹å¼

æˆ‘å–œæ¬¢æŠŠå®ƒä»¬åˆ†ä¸º:

*   **çŸ­æš‚çš„** - `Volume` sï¼Œä¸`Pod`ç”Ÿå­˜æœŸç´§å¯†è€¦åˆ(å¦‚`emptyDir`å·)ï¼Œå³å¦‚æœ`Pod`è¢«ç§»é™¤(å‡ºäºä»»ä½•åŸå› )ï¼Œå®ƒä»¬å°†è¢«åˆ é™¤ã€‚
*   **æŒä¹…** - `Volume` sï¼Œç”¨äºé•¿æœŸå­˜å‚¨ï¼Œç‹¬ç«‹äº`Pod`æˆ–`Node`ç”Ÿå‘½å‘¨æœŸã€‚åœ¨æ‰˜ç®¡ Kubernetes äº§å“(å¦‚ Azure Kubernetes æœåŠ¡ã€Google Kubernetes å¼•æ“ç­‰)çš„æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½æ˜¯`NFS`æˆ–åŸºäºäº‘çš„å­˜å‚¨ã€‚

è®©æˆ‘ä»¬ä»¥`emptyDir`ä¸ºä¾‹

## åŠ¨ä½œä¸­çš„ emptyDir å·

ä¸€ä¸ª`emptyDir`å·å¼€å§‹æ—¶æ˜¯ç©ºçš„(å› æ­¤å¾—åï¼)å¹¶ä¸”æœ¬è´¨ä¸Šæ˜¯çŸ­æš‚çš„ï¼Œå³åªåœ¨`Pod`æ´»ç€çš„æ—¶å€™å­˜åœ¨ã€‚ä¸€æ—¦`Pod`è¢«åˆ é™¤ï¼Œé‚£ä¹ˆ`emptyDir`æ•°æ®ä¹Ÿè¢«åˆ é™¤ã€‚è¿™åœ¨ä¸€äº›åœºæ™¯/éœ€æ±‚ä¸­éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ä¸´æ—¶ç¼“å­˜ï¼Œåœ¨ä¸€ä¸ª`Pod`ä¸­å¤šä¸ªå®¹å™¨çš„å…±äº«å­˜å‚¨ç­‰ç­‰ã€‚

ä¸ºäº†è¿è¡Œè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ã€è¿‡äºç®€åŒ–çš„é”®å€¼å­˜å‚¨ï¼Œå®ƒä¸º

*   æ·»åŠ é”®å€¼å¯¹
*   è¯»å–é”®çš„å€¼

> å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œè¿™æ˜¯ä»£ç 

### åˆå§‹éƒ¨ç½²

[![](img/7f5f18b928809d89a0a770c087a18d24.png)](https://i.giphy.com/media/QJvwBSGaoc4eI/giphy.gif)

å¦‚æœå°šæœªè¿è¡Œï¼Œå¯åŠ¨`minikube`

```
minikube start 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

éƒ¨ç½²`kvstore`åº”ç”¨ç¨‹åºã€‚è¿™å°†ç®€å•åœ°åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºå®ä¾‹(`Pod`)çš„`Deployment`å’Œä¸€ä¸ª`NodePort`æœåŠ¡

```
kubectl apply -f https://raw.githubusercontent.com/abhirockzz/kubernetes-in-a-nutshell/master/volumes-1/kvstore.yaml 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> ä¸ºäº†ç®€å•èµ·è§ï¼ŒYAML æ–‡ä»¶ç›´æ¥ä» [GitHub repo](https://github.com/abhirockzz/kubernetes-in-a-nutshell) ä¸­å¼•ç”¨ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥å°†è¯¥æ–‡ä»¶ä¸‹è½½åˆ°æ‚¨çš„æœ¬åœ°æœºå™¨ä¸Šï¼Œå¹¶ä»¥åŒæ ·çš„æ–¹å¼ä½¿ç”¨å®ƒã€‚

ç¡®è®¤å®ƒä»¬å·²è¢«åˆ›å»º

```
kubectl get deployments kvstore

NAME      READY   UP-TO-DATE   AVAILABLE   AGE
kvstore   1/1     1            1           28s

kubectl get pods -l app=kvstore

NAME                       READY   STATUS    RESTARTS   AGE
kvstore-6c94877886-gzq25   1/1     Running   0          40s 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> å¦‚æœä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯`NodePort`æœåŠ¡ï¼Œé‚£ä¹Ÿæ²¡å…³ç³»â€”â€”è¿™å°†åœ¨éšåçš„åšå®¢æ–‡ç« ä¸­ä»‹ç»ã€‚ç›®å‰ï¼Œåªéœ€è¦ç†è§£å®ƒæ˜¯è®¿é—®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„ä¸€ç§æ–¹å¼(åœ¨æœ¬ä¾‹ä¸­æ˜¯ REST ç«¯ç‚¹)

æ£€æŸ¥ç”±`NodePort`æœåŠ¡ç”Ÿæˆçš„éšæœºç«¯å£çš„å€¼â€”â€”æ‚¨å¯èƒ½ä¼šçœ‹åˆ°ä¸æ­¤ç±»ä¼¼çš„ç»“æœ(ä½¿ç”¨ä¸åŒçš„ IPã€ç«¯å£)

```
kubectl get service kvstore-service

NAME              TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
kvstore-service   NodePort   10.106.144.48   <none>        8080:32598/TCP   5m 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ£€æŸ¥`PORT(S)`åˆ—ä»¥æ‰¾å‡ºéšæœºç«¯å£ï¼Œä¾‹å¦‚åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯`32598`(`8080`æ˜¯æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå…¬å¼€çš„å®¹å™¨å†…çš„å†…éƒ¨ç«¯å£â€”â€”å¿½ç•¥å®ƒ)

ç°åœ¨ï¼Œæ‚¨åªéœ€è¦ä½¿ç”¨`minikube ip`è·å¾—`minikube`èŠ‚ç‚¹çš„ IP åœ°å€

> å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ VirtualBox è™šæ‹Ÿæœºï¼Œè¿™å¯èƒ½ä¼šè¿”å›ç±»ä¼¼äº`192.168.99.100`çš„å†…å®¹

åœ¨éšåçš„å‘½ä»¤ä¸­ï¼Œç”¨ minikube è™šæ‹Ÿæœº IP æ›¿æ¢`host`,ç”¨éšæœºç«¯å£å€¼æ›¿æ¢`port`

åˆ›å»ºå‡ ä¸ªæ–°çš„é”®å€¼å¯¹æ¡ç›®

```
curl http://[host]:[port]/save -d 'foo=bar'
curl http://[host]:[port]/save -d 'mac=cheese' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¾‹å¦‚

```
curl http://192.168.99.100:32598/save -d 'foo=bar'
curl http://192.168.99.100:32598/save -d 'mac=cheese' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®¿é—®é”®`foo`çš„å€¼

```
curl http://[host]:[port]/read/foo 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨åº”è¯¥ä¼šå¾—åˆ°æ‚¨ä¸º`foo` - `bar`ä¿å­˜çš„å€¼ã€‚è¿™åŒæ ·é€‚ç”¨äº`mac`ï¼Œå³ä½ å°†å¾—åˆ°`cheese`ä½œä¸ºå®ƒçš„å€¼ã€‚ç¨‹åºå°†é”®å€¼æ•°æ®ä¿å­˜åœ¨`/data`ä¸­â€”â€”è®©æˆ‘ä»¬é€šè¿‡ç›´æ¥æŸ¥çœ‹`Pod`ä¸­çš„ Docker å®¹å™¨æ¥ç¡®è®¤è¿™ä¸€ç‚¹

```
kubectl exec <pod name> -- ls /data/

foo
mac 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`foo`ã€`mac`æ˜¯ä»¥æŒ‰é”®å‘½åçš„å•ä¸ªæ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬è¿›ä¸€æ­¥æŒ–æ˜ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥èƒ½å¤Ÿç¡®è®¤å®ƒä»¬å„è‡ªçš„å€¼

ç¡®è®¤é”®`mac`çš„å€¼

```
kubectl exec <pod name> -- cat /data/mac`

cheese 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­£å¦‚æ‰€æ–™ï¼Œæ‚¨å¾—åˆ°äº†ç­”æ¡ˆ`cheese`,å› ä¸ºè¿™æ˜¯æ‚¨ä¹‹å‰å­˜å‚¨çš„å†…å®¹ã€‚å¦‚æœä½ è¯•å›¾å¯»æ‰¾ä¸€ä¸ªä½ è¿˜æ²¡æœ‰å­˜å‚¨çš„é”®ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯

```
cat: can't open '/data/moo': No such file or directory
command terminated with exit code 1 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### æ€æ­»å®¹å™¨ï¼›-)

[![](img/cc74ee884f04a21ddb51dc1b794cbef4.png)](https://i.giphy.com/media/26hit1ov3k16SG0Tu/giphy-downsized.gif)

å¥½çš„ï¼Œç›®å‰ä¸ºæ­¢ä¸€åˆ‡é¡ºåˆ©ï¼ä½¿ç”¨`Volume`å¯ä»¥ç¡®ä¿æ•°æ®åœ¨å®¹å™¨é‡å¯/å´©æºƒæ—¶å¾—åˆ°ä¿å­˜ã€‚è®©æˆ‘ä»¬â€œæ¬ºéª—â€ä¸€ä¸‹ï¼Œæ‰‹åŠ¨æ€æ­» Docker å®¹å™¨ã€‚

```
kubectl exec [pod name] -- ps

PID   USER     TIME  COMMAND
  1   root     0:00 /kvstore
  31 root      0:00  ps 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> æ³¨æ„`kvstore`åº”ç”¨ç¨‹åºçš„è¿›ç¨‹ ID(åº”è¯¥æ˜¯`1`)

åœ¨ä¸åŒçš„ç»ˆç«¯ä¸­ï¼Œåœ¨ pod ä¸Šè®¾ç½®ä¸€ä¸ªè§‚å¯Ÿå™¨

```
kubectl get pods -l app=kvstore --watch 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æ€æ­»äº†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿›ç¨‹

```
kubectl exec [pod name] -- kill 1 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ ä¼šæ³¨æ„åˆ° Pod ä¼šç»å†å‡ ä¸ªé˜¶æ®µ(å¦‚`Error`ç­‰)ã€‚)ç„¶åè¿”å›åˆ°`Running`çŠ¶æ€(ç”± Kubernetes é‡æ–°å¯åŠ¨)ã€‚

```
NAME                       READY     STATUS    RESTARTS   AGE
kvstore-6c94877886-gzq25   1/1       Running   0         15m
kvstore-6c94877886-gzq25   0/1       Error     0         15m
kvstore-6c94877886-gzq25   1/1       Running   1         15m 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰§è¡Œ`kubectl exec <pod name> -- ls /data`ä»¥ç¡®è®¤æ•°æ®åœ¨å®¹å™¨é‡å¯åä»ç„¶å­˜åœ¨ã€‚

### åˆ é™¤ Podï¼

ä½†æ˜¯æ•°æ®ä¸ä¼šåœ¨ Pod çš„ç”Ÿå‘½å‘¨æœŸåç»§ç»­å­˜åœ¨ã€‚ä¸ºäº†ç¡®è®¤è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬æ‰‹åŠ¨åˆ é™¤`Pod`

```
kubectl delete pod -l app=kvstore 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹ç¡®è®¤æ¶ˆæ¯

```
pod "kvstore-6c94877886-gzq25" deleted 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Kubernetes å°†å†æ¬¡é‡å¯`Pod`ã€‚å‡ ç§’é’Ÿåï¼Œæ‚¨å¯ä»¥ç¡®è®¤åŒæ ·çš„æƒ…å†µ

```
kubectl get pods -l app=kvstore 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªæ–°çš„`Pod`å¤„äº`Running`çŠ¶æ€

è·å– pod åç§°å¹¶å†æ¬¡æŸ¥çœ‹æ–‡ä»¶

```
kubectl get pods -l app=kvstore
kubectl exec [pod name] -- ls /data/store 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸å‡ºæ‰€æ–™ï¼Œ`/data/`ç›®å½•å°†ä¸ºç©ºï¼

## éœ€è¦æŒä¹…å­˜å‚¨

ç®€å•çš„(çŸ­æš‚çš„)`Volume`éš`Pod`è€Œç”Ÿï¼Œéš`Pod`è€Œæ­»â€”â€”ä½†è¿™å¯¹å¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´æ˜¯ä¸å¤Ÿçš„ã€‚ä¸ºäº†å…·æœ‰å¼¹æ€§ã€å¯é æ€§ã€å¯ç”¨æ€§å’Œå¯ä¼¸ç¼©æ€§ï¼ŒKubernetes åº”ç”¨ç¨‹åºéœ€è¦èƒ½å¤Ÿè·¨ pod ä½œä¸ºå¤šä¸ªå®ä¾‹è¿è¡Œï¼Œè¿™äº› pod æœ¬èº«å¯èƒ½è¢«è°ƒåº¦æˆ–æ”¾ç½®åœ¨ Kubernetes é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸Šã€‚æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªç¨³å®šã€æŒä¹…çš„å•†åº—ï¼Œæ¯”è¿è¡Œ Pod çš„`Pod`ç”šè‡³`Node`è¿˜è¦æŒä¹…ã€‚

æ­£å¦‚åœ¨è¿™ç¯‡åšå®¢çš„å¼€å¤´æåˆ°çš„ï¼Œä½¿ç”¨ä¸€ä¸ª`Volume`å¾ˆç®€å•â€”â€”ä¸ä»…ä»…æ˜¯åƒæˆ‘ä»¬åˆšåˆšçœ‹åˆ°çš„é‚£æ ·çš„ä¸´æ—¶å­˜å‚¨ï¼Œç”šè‡³æ˜¯é•¿æœŸçš„æŒä¹…å­˜å‚¨ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ª(è™šæ„çš„)ä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨ [Azure Disk](https://azure.microsoft.com/services/storage/disks/?WT.mc_id=devto-blog-abhishgu) ä½œä¸ºéƒ¨ç½²åˆ° [Azure Kubernetes æœåŠ¡](https://azure.microsoft.com/services/kubernetes-service/?WT.mc_id=devto-blog-abhishgu)çš„åº”ç”¨ç¨‹åºçš„å­˜å‚¨ä»‹è´¨ã€‚

```
apiVersion: v1
kind: Pod
metadata:
  name: testpod
spec:
  volumes:
  - name: logs-volume
    azureDisk:
          kind: Managed
          diskName: myAKSDiskName
          diskURI: myAKSDiskURI
  containers:
  - image: myapp-docker-image
    name: myapp
    volumeMounts:
    - mountPath: /app/logs
      name: logs-volume 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±è¿™æ ·å—ï¼Ÿä¸å®Œå…¨æ˜¯ï¼ğŸ˜‰è¿™ç§æ–¹æ³•æœ‰å±€é™æ€§ã€‚è¿™ä¸€ç‚¹ä»¥åŠæ›´å¤šå†…å®¹å°†åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€éƒ¨åˆ†è®¨è®ºâ€”â€”æ•¬è¯·å…³æ³¨ï¼

[![](img/ec2753c593b97e14f6833a428fa9a184.png)](https://i.giphy.com/media/hS6KvugVZSAH6/giphy-downsized.gif)

æˆ‘çœŸçš„å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œå¹¶ä»ä¸­å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ğŸ˜ƒğŸ˜ƒå¦‚æœä½ åšäº†ï¼Œè¯·å–œæ¬¢å¹¶è·Ÿéšï¼