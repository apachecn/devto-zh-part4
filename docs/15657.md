# å‰ç«¯ä¸­çš„åµŒå¥—ä¾èµ–å…³ç³»

> åŸæ–‡:[https://dev.to/open-wc/nested-dependencies-in-frontend-558c](https://dev.to/open-wc/nested-dependencies-in-frontend-558c)

æ‰€ä»¥ä½ æœ‰äº†è¿™ä¸ªå¾ˆæ£’çš„æƒ³æ³•ï¼Œç°åœ¨ä½ æƒ³å®é™…å»åšã€‚æˆ‘å¾ˆç¡®å®šä½ ä¸æƒ³ä»å¤´å¼€å§‹ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä½¿ç”¨ç°æœ‰çš„å¼€æºåŒ…ã€‚

å¦‚æœä½ æƒ³åˆä½œï¼Œæ‰€æœ‰çš„ä»£ç éƒ½åœ¨ [github](https://github.com/daKmoR/nested-dependencies-in-frontend) ä¸Šã€‚

å¯¹äºæˆ‘ä»¬çš„ä¾‹å­ï¼Œæˆ‘ä»¬æƒ³ä½¿ç”¨ lit-element å’Œ lit-htmlã€‚

```
mkdir nested-dependecies-in-frontend
cd nested-dependecies-in-frontend
npm install lit-element lit-html@1.0.0 --save-exact 
```

> æ³¨æ„:æˆ‘ä»¬åœ¨è¿™é‡Œæ•…æ„ä½¿ç”¨å›ºå®šç‰ˆæœ¬ã€‚

ç„¶åæˆ‘ä»¬å°†ä¸¤ä¸ªåŒ…éƒ½åŠ è½½åˆ°æˆ‘ä»¬çš„`main.js`ä¸­ã€‚

```
import { LitElement } from "lit-element";
import { html } from "lit-html";

console.log(LitElement);
console.log(html); 
```

ä¸ºäº†äº†è§£æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæœ‰å¤šå¤§ï¼Œæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªæ±‡æ€»åŒ…ã€‚é¦–å…ˆï¼Œå®‰è£…æ±‡æ€»:

```
npm install -D rollup 
```

ç„¶ååˆ›å»ºä¸€ä¸ª`rollup.config.js`

```
export default {
  input: "main.js",
  output: {
    file: "bundle.js",
    format: "iife"
  },
}; 
```

æ¥ä¸‹æ¥ï¼Œå°†`"build": "rollup -c rollup.config.js && du -h bundle.js"`æ·»åŠ åˆ° package.json çš„`scripts`å—ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è½»æ¾åœ°æ„å»ºæ–‡ä»¶å¹¶è¾“å‡ºå…¶æ–‡ä»¶å¤§å°ã€‚
è®©æˆ‘ä»¬é€šè¿‡`npm run build` :)
æ¥è¿è¡Œå®ƒ

```
(!) Unresolved dependencies
https://rollupjs.org/guide/en#warning-treating-module-as-external-dependency
lit-element (imported by main.js)
lit-html (imported by main.js) 
```

å“¦ï¼æ²¡ç”¨ï¼ğŸ˜­

å¥½å§ï¼Œæˆ‘ä»¥å‰å¬è¿‡è¿™ä¸ª...æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€äº›æ’ä»¶ï¼Œä»¥ä¾¿ Rollup èƒ½å¤Ÿç†è§£èŠ‚ç‚¹è§£æ(å³ç±»ä¼¼äº`import { html } from 'lit-html'`çš„è£¸æ¨¡å—è¯´æ˜ç¬¦)çš„å·¥ä½œæ–¹å¼ã€‚

```
npm i -D rollup-plugin-node-resolve 
```

```
+ import resolve from "rollup-plugin-node-resolve";
+
   export default {
    input: "main.js",
    output: {
      file: "bundle.js",
      format: "iife"
    },
+  plugins: [resolve()]
  }; 
```

```
$ npm run build
# ...
created bundle.js in 414ms
96K     bundle.js 
```

æ‰€ä»¥è¿™çœ‹èµ·æ¥ä¸é”™ã€‚ğŸ’ª

### [](#what-happens-if-someone-prefers-yarn)å¦‚æœæœ‰äººåçˆ±çº±çº¿ä¼šæ€æ ·ï¼Ÿ

å…ˆå®‰è£…ä¸€ä¸ªçº±çº¿ï¼Œç„¶åå†æ„å»ºï¼Œç»“æœåº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œå¯¹å—ï¼Ÿ

```
$ yarn install
$ yarn build
# ...
created bundle.js in 583ms
124K    bundle.js 
```

å“‡ï¼è¿™æ˜¯æ„æ–™ä¹‹å¤–çš„â€”â€”`yarn`ç‰ˆæœ¬çš„å†…å­˜æ˜¯ 124Kï¼Œè€Œ`npm`æ˜¯ 96Kã€‚
çœ‹æ¥çº±çº¿æ„å»ºåŒ…å«ä¸€äº›é¢å¤–çš„æ–‡ä»¶...ä¹Ÿè®¸ä¸€ä¸ªåŒ…è£¹è¢«å¤åˆ¶äº†ï¼Ÿ

```
$ yarn list --pattern lit-*
â”œâ”€ lit-element@2.2.0
â”‚  â””â”€ lit-html@1.1.0
â””â”€ lit-html@1.0.0 
```

æ˜¯çš„ï¼Œ`lit-html`ç‰ˆæœ¬`1.0.0`å’Œ`1.1.0`éƒ½è£…äº†ã€‚åŸå› å¾ˆå¯èƒ½æ˜¯å½“æˆ‘ä»¬ç”¨ä¸Šé¢çš„`npm install --save-exact lit-html@1.0.0`å‘½ä»¤å®‰è£…`lit-html`æ—¶ï¼Œæˆ‘ä»¬å°†`lit-html`å›ºå®šåˆ°äº†æ ¹ä¾èµ–ä¸­çš„`1.0.0`ç‰ˆæœ¬ã€‚

è™½ç„¶`npm`ä¼¼ä¹å¯ä»¥å¾ˆå¥½åœ°åˆ é™¤é‡å¤æ•°æ®ï¼Œä½†æˆ‘è§‰å¾—ä½¿ç”¨`npm`å¹¶ä¸å®‰å…¨ï¼Œå› ä¸ºå¦‚æœä¾èµ–å…³ç³»æ ‘å˜å¾—æ›´å¤§ï¼Œnpm ä¹Ÿä¼šå–œæ¬¢å®‰è£…åµŒå¥—ä¾èµ–å…³ç³»ã€‚

```
$ npm ls lit-element lit-html
â”œâ”€â”¬ lit-element@2.2.0
â”‚ â””â”€â”€ lit-html@1.0.0  deduped
â””â”€â”€ lit-html@1.0.0 
```

å¦å¤–ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä½¿ç”¨ä¸€äº› beta(ä¾‹å¦‚`0.x.x`)ä¾èµ–æ—¶ï¼Œè¿™å˜å¾—éå¸¸æ£˜æ‰‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ[å¡å¼—](https://semver.org/#spec-item-4)è¯´æ¯ä¸€æ¬¡`0.x.0`é‡Šæ”¾éƒ½æ„å‘³ç€ä¸€æ¬¡[çªç ´æ€§çš„æ”¹å˜](https://semver.org/#how-should-i-deal-with-revisions-in-the-0yz-initial-development-phase)ã€‚è¿™æ„å‘³ç€`0.8.0`è¢«è§†ä¸ºä¸`0.9.0`ä¸å…¼å®¹ã€‚å› æ­¤ï¼Œå³ä½¿æ‚¨ä½¿ç”¨çš„ API åœ¨ä¸¤ä¸ªç‰ˆæœ¬ä¸­éƒ½å·¥ä½œå¾—å¾ˆå¥½ï¼Œæ‚¨ä¹Ÿæ€»æ˜¯ä¼šå¾—åˆ°åµŒå¥—çš„ä¾èµ–å…³ç³»ï¼Œè¿™å¯èƒ½ä¼šæ‚„æ‚„åœ°ç ´åæ‚¨çš„åº”ç”¨ç¨‹åºã€‚ä¾‹å¦‚ï¼Œç»ˆç«¯ä¸Šå°†æ²¡æœ‰è­¦å‘Šæˆ–ä¿¡æ¯ğŸ˜±

### [](#how-node-resolution-works)èŠ‚ç‚¹è§£æå¦‚ä½•å·¥ä½œ

åœ¨ nodejs ä¸­ï¼Œå½“æ‚¨ä½¿ç”¨ä¸€ä¸ªè£¸è¯´æ˜ç¬¦å¯¼å…¥ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä¾‹å¦‚,`import { LitElement } from "lit-element";`èŠ‚ç‚¹çš„æ¨¡å—è§£æå™¨å‡½æ•°è·å–å­—ç¬¦ä¸²`lit-element`ï¼Œå¹¶å¼€å§‹åœ¨`module.paths`ä¸­åˆ—å‡ºçš„æ‰€æœ‰ç›®å½•ä¸­æœç´¢å¯¼å…¥æ¨¡å—ï¼Œæ‚¨å¯ä»¥åƒæ£€æŸ¥èŠ‚ç‚¹ REPL ä¸­çš„ä»»ä½•å…¶ä»–å€¼ä¸€æ ·æ£€æŸ¥å®ƒ:

```
$ node
module.paths
[
  '/some/path/nested-dependencies-in-frontend/node_modules',
  '/some/path/node_modules',
  '/some/node_modules',
  '/node_modules',
]
# unimportant folders are hidden here 
```

åŸºæœ¬ä¸Šï¼Œnode æŸ¥çœ‹æ¯ä¸ª`node_modules`æ–‡ä»¶å¤¹ï¼Œä»æ¨¡å—çš„çˆ¶ç›®å½•å¼€å§‹ï¼Œæ²¿ç€æ–‡ä»¶æ ‘å‘ä¸Šç§»åŠ¨ï¼Œç›´åˆ°æ‰¾åˆ°ä¸æ¨¡å—è¯´æ˜ç¬¦åŒ¹é…çš„ç›®å½•å(åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯`lit-element`)ã€‚è§£æç®—æ³•æ€»æ˜¯ä»å½“å‰æ¨¡å—çš„çˆ¶ç›®å½•å¼€å§‹ï¼Œæ‰€ä»¥å®ƒæ€»æ˜¯ç›¸å¯¹äºæ–‡ä»¶çš„å¯¼å…¥ä½ç½®ã€‚å¦‚æœæˆ‘ä»¬ä» lit-element çš„ç›®å½•ä¸­æ£€æŸ¥`module.paths`ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªä¸åŒçš„åˆ—è¡¨ã€‚

```
$ cd node_modules/lit-element
$ node
module.paths
[
  '/some/path/nested-dependencies-in-frontend/node_modules/lit-element/node_modules',
  '/some/path/nested-dependencies-in-frontend/node_modules',
  '/some/path/node_modules',
  '/some/node_modules',
  '/node_modules',
] 
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥ç†è§£ä»€ä¹ˆæ˜¯èŠ‚ç‚¹çš„åµŒå¥—ä¾èµ–ã€‚æ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥æœ‰è‡ªå·±çš„`node_modules`ç›®å½•ï¼Œä»¤äººè®¨åŒçš„*ï¼Œå¹¶ä¸”åœ¨é‚£ä¸ªæ¨¡å—çš„æ–‡ä»¶ä¸­å¼•ç”¨çš„å¯¼å…¥æ€»æ˜¯é¦–å…ˆåœ¨å®ƒä»¬æœ€è¿‘çš„`node_modules`ç›®å½•ä¸­æŸ¥æ‰¾...*

 *| èŠ‚ç‚¹ä¸ŠåµŒå¥—ä¾èµ–çš„ä¼˜ç‚¹ | å‰ç«¯åµŒå¥—ä¾èµ–çš„ç¼ºç‚¹ |
| --- | --- |
| æ¯ä¸ªåŒ…éƒ½å¯ä»¥æœ‰è‡ªå·±çš„ä¾èµ–ç‰ˆæœ¬ | è¿é€ç›¸åŒçš„ä»£ç ä¸¤æ¬¡æ„å‘³ç€æ›´é•¿çš„ä¸‹è½½å’Œå¤„ç†æ—¶é—´ |
| åŒ…ä¸å—åº”ç”¨ç¨‹åºä¸­å…¶ä»–åŒ…çš„ä¾èµ–å…³ç³»çš„å½±å“ | å¦‚æœç›¸åŒçš„ä»£ç ä»ä¸¤ä¸ªä¸åŒçš„ä½ç½®å¯¼å…¥ä¸¤æ¬¡ï¼Œé‚£ä¹ˆä¸œè¥¿å¯èƒ½ä¼šæŸå(ä¾‹å¦‚ï¼Œé€šè¿‡ [WeakMaps](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap) æˆ– singletons è¿›è¡Œæ€§èƒ½ä¼˜åŒ–) |
| è®¿é—®è®¸å¤šé¢å¤–æ–‡ä»¶æ— éœ€æ”¯ä»˜â€œé«˜é¢è´¹ç”¨â€ã€‚ | æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨æ˜¯ä¸€ä¸ªé¢å¤–çš„è¯·æ±‚ |
| åœ¨æœåŠ¡å™¨ä¸Šï¼Œä½ é€šå¸¸ä¸å¤ªå…³å¿ƒæœ‰å¤šå°‘é¢å¤–çš„ä»£ç (æ–‡ä»¶å¤§å°) | æ€»ä¹‹ï¼Œä½ çš„ç½‘ç«™ä¼šå˜æ…¢ |

### [](#the-problems)å‡ºç°äº†é—®é¢˜

ç®€è€Œè¨€ä¹‹ï¼Œåå¥½åµŒå¥—çš„è‡ªåŠ¨æ¨¡å—è§£æå¯¹äºå‰ç«¯æ¥è¯´å¯èƒ½æ˜¯å±é™©çš„ã€‚

*   æˆ‘ä»¬å…³å¿ƒåŠ è½½å’Œè§£ææ€§èƒ½
*   æˆ‘ä»¬å…³å¿ƒæ–‡ä»¶çš„å¤§å°
*   æœ‰äº›åŒ…å¿…é¡»æ˜¯å•ä»¶çš„(å³åœ¨æ¨¡å—å›¾ä¸­æ˜¯å”¯ä¸€çš„)æ‰èƒ½åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æ­£å¸¸å·¥ä½œ
    *   ä¾‹å­åŒ…æ‹¬`lit-html`å’Œ`graphql`
*   æˆ‘ä»¬åº”è¯¥å®Œå…¨æ§åˆ¶æœ€ç»ˆå‡ºç°åœ¨å®¢æˆ·æµè§ˆå™¨ä¸Šçš„å†…å®¹

èŠ‚ç‚¹æ ·å¼çš„æ¨¡å—è§£ææ˜¯ä¸ºæœåŠ¡å™¨ç«¯ç¯å¢ƒè®¾è®¡çš„ï¼Œå½“åœ¨æµè§ˆå™¨ä¸­é‡‡ç”¨æ—¶ï¼Œå¯èƒ½ä¼šå°†è¿™äº›é—®é¢˜å˜æˆä¸¥é‡çš„é—®é¢˜ã€‚
<abbr title="In my humble opinion">IMHO</abbr> å³ä½¿èŠ‚ç‚¹è§£æåœ¨æŠ€æœ¯ä¸Šæ˜¯å¯èƒ½çš„ï¼Œä¸ºä¸€ä¸ªå¤æ‚çš„æ•°æ®ç½‘æ ¼å¤šæ¬¡åŠ è½½ä»£ç ç»ä¸åº”è¯¥æ˜¯æˆ‘ä»¬ä½œä¸ºå‰ç«¯å¼€å‘äººå‘˜çš„ç›®æ ‡ã€‚

### [](#solutions)æ–¹æ¡ˆ

ä»¤äººæ¬£æ…°çš„æ˜¯ï¼Œæˆ‘ä»¬ä»Šå¤©å¯ä»¥ä½¿ç”¨è¿™äº›é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”å³å°†å‡ºç°çš„ææ¡ˆå°†å®Œå…¨æ¶ˆé™¤æœªæ¥å¯¹è¿™ç§å˜é€šåŠæ³•çš„éœ€è¦ã€‚

#### [](#making-it-work-today)ä»Šå¤©æˆåŠŸäº†

ä¸‹é¢æ˜¯ä¸€äº›åœ¨å‰ç«¯ä»£ç ä¸­ä½¿ç”¨è£¸æ¨¡å—è¯´æ˜ç¬¦çš„æŠ€å·§:

*   ç¡®ä¿æ‚¨çš„ä¾èµ–å…³ç³»æ ‘ä¸­çš„æ¨¡å—éƒ½ä½¿ç”¨å®ƒä»¬çš„å…¬å…±ä¾èµ–å…³ç³»çš„ç›¸ä¼¼ç‰ˆæœ¬èŒƒå›´
*   å°½å¯èƒ½é¿å…å›ºå®šç‰¹å®šçš„åŒ…ç‰ˆæœ¬(å°±åƒæˆ‘ä»¬åœ¨ä¸Šé¢ç”¨`npm i -S lit-html@1.0.0`åšçš„é‚£æ ·)
*   å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨`npm`:
    *   å®‰è£…è½¯ä»¶åŒ…åè¿è¡Œ`npm dedupe`åˆ é™¤åµŒå¥—çš„é‡å¤é¡¹ã€‚
    *   æ‚¨å¯ä»¥å°è¯•åˆ é™¤æ‚¨çš„`package-lock.json`å¹¶è¿›è¡Œå…¨æ–°å®‰è£…ã€‚æœ‰æ—¶å®ƒç¥å¥‡åœ°å¸®åŠ©äº†ğŸ§™â€â™‚ï¸
*   å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨`yarn`:
    *   è€ƒè™‘ä½¿ç”¨ [yarn resolutions](https://yarnpkg.com/lang/en/docs/selective-version-resolutions/) æ¥æŒ‡å®šä»»ä½•å¤åˆ¶åŒ…çš„é¦–é€‰ç‰ˆæœ¬

#### [](#a-look-into-the-future)å±•æœ›æœªæ¥

å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿå‡†ç¡®åœ°å‘Šè¯‰ JavaScript ç¯å¢ƒ(å³æµè§ˆå™¨)åœ¨å“ªä¸ª`path`æ‰¾åˆ°æŸä¸ªå­—ç¬¦ä¸²æŒ‡å®šçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦èŠ‚ç‚¹æ ·å¼çš„è§£ææˆ–ç¼–ç¨‹æ—¶çš„é‡å¤æ•°æ®åˆ é™¤ä¾‹ç¨‹ã€‚
æˆ‘ä»¬å°†ç¼–å†™ç±»ä¼¼è¿™æ ·çš„ä¸œè¥¿ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æµè§ˆå™¨ï¼Œä»¥æŒ‡å®šå“ªäº›è·¯å¾„æ˜ å°„åˆ°å“ªäº›åŒ…:

```
{  "lit-html":  "./node_modules/lit-html.js",  "lit-element":  "./node_modules/lit-element.js"  } 
```

ä½¿ç”¨è¿™ä¸ªå¯¼å…¥æ˜ å°„æ¥è§£æåŒ…è·¯å¾„æ„å‘³ç€æ€»æ˜¯åªæœ‰ä¸€ä¸ªç‰ˆæœ¬çš„`lit-html`å’Œ`lit-element`ï¼Œå› ä¸ºå…¨å±€ç¯å¢ƒå·²ç»çŸ¥é“åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°å®ƒä»¬ã€‚

å¹¸è¿çš„æ˜¯ï¼Œâœ¨ï¼Œè¿™å·²ç»æ˜¯ä¸€ä¸ªè¢«æè®®çš„åä¸º[å¯¼å…¥åœ°å›¾](https://github.com/WICG/import-maps)çš„è§„èŒƒäº†ã€‚å› ä¸ºå®ƒæ˜¯ä¸ºæµè§ˆå™¨è®¾è®¡çš„ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸éœ€è¦åšä»»ä½•è½¬æ¢ï¼ä½ åªéœ€æä¾›åœ°å›¾ï¼Œå¼€å‘æ—¶ä¸éœ€è¦ä»»ä½•æ„å»ºæ­¥éª¤ï¼Ÿ

å¬èµ·æ¥å¾ˆç–¯ç‹‚ğŸ˜œï¼Ÿæˆ‘ä»¬æ¥è¯•è¯•å§ï¼ğŸ¤—

> æ³¨æ„:è¯·æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„ API æè®®ï¼Œå®ƒè¿˜æ²¡æœ‰æœ€ç»ˆç¡®å®šæˆ–è¢«å®ç°è€…æ¥å—ã€‚

å®ƒç›®å‰åªèƒ½åœ¨ Chrome 75+ä¸­å·¥ä½œï¼Œåœ¨ä¸€é¢æ——å¸œåé¢ã€‚
æ‰€ä»¥åœ¨åœ°å€æ è¾“å…¥`chrome://flags/`ï¼Œç„¶åæœç´¢`Built-in module infra and import maps`å¹¶å¯ç”¨ã€‚
ä¸‹é¢æ˜¯å®ƒçš„ç›´æ¥é“¾æ¥:ã€‚

#### [](#using-import-maps-in-the-browser)åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨å¯¼å…¥åœ°å›¾

ä¸ºäº†ä½¿ç”¨å¯¼å…¥æ˜ å°„ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`index.html`æ–‡ä»¶ã€‚

```
<html lang="en-GB">
<head>
  <script type="importmap">
    {
      "imports": {
        "lit-html": "./node_modules/lit-html/lit-html.js",
        "lit-html/": "./node_modules/lit-html/",
        "lit-element": "./node_modules/lit-element/lit-element.js",
        "lit-element/": "./node_modules/lit-element/"
      }
    }
  </script>
  <title>My app</title>
</head>

<body>
  <crowd-chant>
    <span slot="what">Bare Imports!</span>
    <span slot="when">Now!</span>
  </crowd-chant>

  <script type="module" src="./main.js"></script>
</body>

</html> 
```

å¹¶è°ƒæ•´`main.js`ã€‚

```
import { html, LitElement } from "lit-element";

class CrowdChant extends LitElement {
  render() {
    return html`
      <h2>What do we want?</h2>
      <slot name="what"></slot>
      <h2>When do we want them?</h2>
      <time><slot name="when">Now!</slot></time>
    `;
  }
}

customElements.define("crowd-chant", CrowdChant); 
```

ä¿å­˜æ–‡ä»¶ï¼Œç„¶åé€šè¿‡åœ¨åŒä¸€ä¸ªç›®å½•ä¸­è¿è¡Œ`npx http-server -o`åœ¨æœ¬åœ°æä¾›å®ƒã€‚
è¿™å°†æ‰“å¼€ [http://localhost:8080/](http://localhost:8080/) ï¼Œåœ¨è¿™é‡Œæ‚¨å°†çœ‹åˆ°æ‚¨çš„å®šåˆ¶å…ƒç´ å‘ˆç°åœ¨å±å¹•ä¸Šã€‚ğŸ‰

è¿™æ˜¯ä»€ä¹ˆå¦–æœ¯ğŸ”®ï¼Ÿåœ¨æ²¡æœ‰ä»»ä½•æ†ç»‘å™¨ã€å·¥å…·æˆ–æ„å»ºæ­¥éª¤çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªç»„ä»¶åŒ–çš„åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨äº†æˆ‘ä»¬å·²ç»ç†Ÿæ‚‰å¹¶å–œçˆ±çš„ç®€å•è¯´æ˜ç¬¦ã€‚

è®©æˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹:

```
import { html } from 'lit-html';
// will actually import "./node_modules/lit-html/lit-html.js"
// because of
// "lit-html": "./node_modules/lit-html/lit-html.js",

import { repeat } from 'lit-html/directives/repeat.js'
// will actually import "./node_modules/lit-html/directives/repeat.js"
// beacause of
// "lit-html/": "./node_modules/lit-html/", 
```

æ‰€ä»¥è¿™æ„å‘³ç€

1.  æ‚¨å¯ä»¥ç›´æ¥å¯¼å…¥åŒ…ï¼Œå› ä¸ºåŒ…åç§°æ˜ å°„åˆ°ç‰¹å®šçš„æ–‡ä»¶
2.  æ‚¨å¯ä»¥å¯¼å…¥å­ç›®å½•å’Œæ–‡ä»¶ï¼Œå› ä¸º`packageName + '/'`è¢«æ˜ å°„åˆ°å®ƒçš„ç›®å½•
3.  ä»å­ç›®å½•å¯¼å…¥æ–‡ä»¶æ—¶ï¼Œæ‚¨å¿…é¡»*è€Œä¸æ˜¯*çœç•¥`.js`

#### [](#what-does-this-all-mean-for-my-production-build)è¿™ä¸€åˆ‡å¯¹æˆ‘çš„ç”Ÿäº§æ„å»ºæ„å‘³ç€ä»€ä¹ˆï¼Ÿ

é‡è¦çš„æ˜¯è¦å†æ¬¡æŒ‡å‡ºï¼Œè¿™ä»ç„¶æ˜¯å®éªŒæ€§çš„æŠ€æœ¯ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½ä»ç„¶å¸Œæœ›ä½¿ç”¨ Rollup ä¹‹ç±»çš„å·¥å…·ä¸ºç”Ÿäº§ç«™ç‚¹è¿›è¡Œä¼˜åŒ–æ„å»ºã€‚æˆ‘ä»¬æ­£åœ¨å…±åŒæ¢ç´¢è¿™äº›æ–°çš„ API å°†ä¸ºæˆ‘ä»¬çš„ç½‘ç«™å’Œåº”ç”¨å¸¦æ¥ä»€ä¹ˆã€‚æ½œåœ¨çš„æè®®ä»ç„¶ä¸ç¨³å®šï¼Œä½†è¿™ä¸åº”è¯¥é˜»æ­¢æˆ‘ä»¬å®éªŒå¹¶ä»ä¸­æå–æ•ˆç”¨ã€‚æ¯•ç«Ÿï¼Œæˆ‘ä»¬å¤§å¤šæ•°äººéƒ½ä¹ æƒ¯äºä½¿ç”¨`babel`æ¥å¯ç”¨ decorators ä¹‹ç±»çš„å®éªŒæ€§è¯­æ³•ï¼Œå°½ç®¡åœ¨æ’°å†™æœ¬æ–‡æ—¶è¯¥æè®®è‡³å°‘æœ‰å››ç§é£æ ¼ã€‚

å¦‚æœæ‚¨ç°åœ¨æƒ³å°è¯•åœ¨ä¸å—æ”¯æŒçš„æµè§ˆå™¨ä¸­å¯¼å…¥åœ°å›¾ï¼Œæ‚¨å°†éœ€è¦ä¸€ä¸ªæ„å»ºæ­¥éª¤æˆ–ä¸€ä¸ªè¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆï¼Œå¦‚ systemjsã€‚å¯¹äº build-step é€‰é¡¹ï¼Œæ‚¨å°†ä½¿ç”¨å°Šé‡æ‚¨çš„`import map`çš„ä¸œè¥¿æ¥æ›¿æ¢`rollup-plugin-node-resolve`ï¼Œè€Œä¸æ˜¯ä½¿ç”¨èŠ‚ç‚¹è§£æã€‚

å¦‚æœä½ å¯ä»¥æŒ‡å‘ä½ çš„`index.html`ï¼Œè®©å®ƒçŸ¥é“ä½ çš„å…¥å£ç‚¹æ˜¯ä»€ä¹ˆï¼Œæ˜¯å¦æœ‰ä¸€ä¸ªå¯¼å…¥æ˜ å°„ï¼Œè¿™ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿ

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ [open-wc](https://open-wc.org) ä¸Šï¼Œæˆ‘ä»¬ä¼šç”¨æˆ‘ä»¬çš„`rollup-plugin-index-html`å‘å¸ƒå¯¹å¯¼å…¥åœ°å›¾çš„å®éªŒæ€§æ”¯æŒã€‚

æ‚¨å¯ä»¥åœ¨ dev.to ä¸Šé˜…è¯»æ‰€æœ‰ç›¸å…³å†…å®¹ã€‚è¯·å…³æ³¨æ­¤å¤„çš„å…¬å‘ŠğŸ˜‰ã€‚

åœ¨[æ¨ç‰¹](https://twitter.com/openwc)ä¸Šå…³æ³¨æˆ‘ä»¬ï¼Œæˆ–è€…åœ¨æˆ‘çš„ä¸ªäºº[æ¨ç‰¹](https://twitter.com/dakmor)ä¸Šå…³æ³¨æˆ‘ã€‚
è¯·åŠ¡å¿…åœ¨[open-wc.org](https://open-wc.org)æŸ¥çœ‹æˆ‘ä»¬çš„å…¶ä»–å·¥å…·å’Œå»ºè®®ã€‚

æ„Ÿè°¢[æœ¬å°¼](https://dev.to/bennypowers)å’Œ[æ‹‰æ–¯](https://github.com/LarsDenBakker)çš„åé¦ˆï¼Œå¹¶å¸®åŠ©å°†æˆ‘çš„æ¶‚é¸¦å˜æˆä¸€ä¸ªåç»­çš„æ•…äº‹ã€‚*