# ä¸€ä¸ªæœ‰æ£±è§’çš„å½¢å¼å’ŒæŒ‡ä»¤çš„å°æŠ€å·§ğŸƒ

> åŸæ–‡ï¼š<https://dev.to/angular/a-little-trick-with-angular-forms-and-directives-2mep>

æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨å¸Œæœ›åœ¨åº”ç”¨ç¨‹åºä¸­çš„å¤šä¸ªåœ°æ–¹ä½¿ç”¨ä¸€ä¸ªè¡¨å•ã€‚è¡¨å•å°†å…·æœ‰ç›¸åŒçš„å¸ƒå±€ï¼Œä½†éªŒè¯å°†æ˜¯ä¸åŒçš„ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™ç§å½¢å¼ç”¨äºä¸€ä¸ªå¤šæ­¥éª¤çš„ç¨‹åºä¸­ï¼Œå¹¶ä¸”åœ¨ç¨‹åºçš„æ¯ä¸€æ­¥ä¸­ï¼Œè¿™ç§å½¢å¼å˜å¾—æ›´åŠ ä¸¥æ ¼ã€‚ä½ èƒ½è®©å®ƒä¿æŒå¹²ç‡¥å—ï¼Ÿæˆ‘ä»¬é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶æå‡ºäº†ä»¥ä¸‹è§£å†³æ–¹æ¡ˆã€‚

### è¡¨å•

ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªäººçš„åå­—ã€è”ç³»ä¿¡æ¯å’Œè¿‡æ•ç—‡ã€‚
å¼€å§‹æ—¶ï¼Œåªéœ€è¦åå­—ã€‚ç¨åï¼Œæˆ‘ä»¬å°†éœ€è¦è¯¥äººçš„å…¶ä»–ä¿¡æ¯ã€‚

```
@Component({
  selector: 'person',
  template: `
    <div [formGroup]="form">
      <div>
        <label>Name</label>
        <input type="text" formControlName="name" />
      </div>

      <div>
        <label>Contact info</label>
        <input type="text" formControlName="contactInfo" />
      </div>

      <div>
        <label>Allergies</label>
        <input type="text" formControlName="allergies" />
      </div>

      <strong>{{ form.valid ? 'valid' : 'invalid' }}</strong>
    </div>
  `,
})
export class PersonComponent {
  form = this.formBuilder.group({
    name: ['', Validators.required],
    contactInfo: [''],
    allergies: [''],
  })

  constructor(private formBuilder: FormBuilder) {}
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†äººåè®¾ä¸ºå¿…å¡«å­—æ®µã€‚

### æŒ‡ä»¤

é€šè¿‡ä½¿ç”¨è§’åº¦æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨å…¥ç»„ä»¶çš„å®ä¾‹ï¼Œè¿™å…è®¸æˆ‘ä»¬è®¿é—®è¡¨å•ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¦æ”¹å˜è¡¨å•çš„æœ‰æ•ˆæ€§ï¼Œå¹¶éœ€è¦æ›´å¤šçš„å­—æ®µã€‚

```
@Directive({
  selector: 'person[stage-one]',
})
export class StageOneDirective {
  constructor(host: PersonComponent) {
    host.form.get('contactInfo').setValidators([Validators.required])
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†ç¡®ä¿è¯¥æŒ‡ä»¤å°†æ³¨å…¥`PersonComponent`,æˆ‘ä»¬å¿…é¡»ä½¿è¯¥æŒ‡ä»¤ç‰¹å®šäº person è¡¨å•ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»„ä»¶çš„é€‰æ‹©å™¨ä½œä¸ºå‰ç¼€ï¼Œå¹¶å°†æŒ‡ä»¤çš„åç§°é™„åŠ åˆ°å®ƒåé¢ï¼Œ`person[stage-one]`ã€‚è¿™æ ·ï¼Œåªæœ‰å½“æŒ‡ä»¤ä½œä¸ºå±æ€§æ·»åŠ åˆ° person ç»„ä»¶æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨è¯¥æŒ‡ä»¤ã€‚
å› ä¸º person ç»„ä»¶ä¸Šçš„è¡¨å•è¢«è®¾ç½®ä¸º publicï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»æˆ‘ä»¬çš„æŒ‡ä»¤ä¸­è®¿é—®è¡¨å•ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥è®¿é—®è¡¨å•ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¿é—®è¡¨å•åŸŸå’Œå®ƒä»¬çš„éªŒè¯å™¨ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•æ¥åˆ›å»ºæ›´ä¸¥æ ¼çš„éªŒè¯ã€‚

```
@Directive({
  selector: 'person[stage-two]',
})
export class StageTwoDirective {
  constructor(host: PersonComponent) {
    host.form.get('contactInfo').setValidators([Validators.required])
    host.form.get('allergies').setValidators([Validators.required])
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### ç”¨æ³•

ä¸ºäº†ä½¿è¿™ä¸ªå°ä¾‹å­æ›´å®Œæ•´ï¼Œè¿™å°±æ˜¯åœ¨å¦ä¸€ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ person ç»„ä»¶å’ŒæŒ‡ä»¤çš„æ–¹å¼ã€‚

```
<!-- Only the name is required -->
<person></person>

<!-- The name and the contactInfo are required -->
<person stage-one></person>

<!-- All fields are required -->
<person stage-two></person> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> æˆ‘å‘ç°è¿™æ˜¯ä¸€ä¸ªç»“åˆæ§åˆ¶å€¼è®¿é—®å™¨çš„å¹²å‡€çš„è§£å†³æ–¹æ¡ˆï¼Œæ­£å¦‚åœ¨[åœ¨ä¼ä¸šç¯å¢ƒä¸­ä½¿ç”¨è§’åº¦è¡¨å•](https://timdeschryver.dev/posts/working-with-angular-forms-in-an-enterprise-environment)ä¸­æ‰€è®¨è®ºçš„ã€‚

åœ¨æ¥ä¸‹æ¥çš„[é—ªç”µæˆ˜](https://stackblitz.com/edit/angular-forms-directive-trick)ä¸­ç©è½¬è¿™ä¸ªä¾‹å­ã€‚