# ä¸ºä»€ä¹ˆè¦ååº”é’©å­ï¼Ÿ

> åŸæ–‡:[https://dev.to/tylermcginnis/why-react-hooks-51lj](https://dev.to/tylermcginnis/why-react-hooks-51lj)

*è¿™æœ€åˆå‘è¡¨åœ¨ [ui.dev](https://ui.dev/why-react-hooks/) ä¸Šï¼Œæ˜¯æˆ‘ä»¬ [React Hooks](https://ui.dev/react-hooks/) è¯¾ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œå°±å»çœ‹çœ‹å§ã€‚*

* * *

[https://www.youtube.com/embed/eX_L39UvZes](https://www.youtube.com/embed/eX_L39UvZes)

æ¯å½“ä½ è¦å­¦ä¹ æ–°ä¸œè¥¿æ—¶ï¼Œä½ è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯é—®è‡ªå·±ä¸¤ä¸ªé—®é¢˜-

1)è¿™ä¸ªä¸œè¥¿ä¸ºä»€ä¹ˆä¼šå­˜åœ¨ï¼Ÿè¿™ä¸ªä¸œè¥¿è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

å¦‚æœä½ ä»æ¥æ²¡æœ‰ä¸ºè¿™ä¸¤ä¸ªé—®é¢˜æ‰¾åˆ°ä¸€ä¸ªä»¤äººä¿¡æœçš„ç­”æ¡ˆï¼Œå½“ä½ æ·±å…¥ç»†èŠ‚æ—¶ï¼Œä½ å°±æ²¡æœ‰è¶³å¤Ÿåšå®çš„åŸºç¡€ã€‚å…³äº[ååº”é’©å­](https://tylermcginnis.com/courses/react-hooks/)ï¼Œè¿™äº›é—®é¢˜ç‰¹åˆ«æœ‰è¶£ã€‚å½“ Hooks å‘å¸ƒæ—¶ï¼ŒReact æ˜¯ JavaScript ç”Ÿæ€ç³»ç»Ÿä¸­æœ€å—æ¬¢è¿å’Œå–œçˆ±çš„å‰ç«¯æ¡†æ¶ã€‚å°½ç®¡å·²æœ‰å¥½è¯„ï¼ŒReact å›¢é˜Ÿä»ç„¶è®¤ä¸ºæœ‰å¿…è¦æ„å»ºå’Œå‘å¸ƒæŒ‚é’©ã€‚è¿·å¤±åœ¨å„ç§åª’ä½“å¸–å­å’Œåšå®¢ä¸­æ€è€ƒæŒ‚é’©çš„åŸå›  **(1)ä¸ºä»€ä¹ˆ**å’Œä¸ºäº†ä»€ä¹ˆ **(2)åˆ©ç›Š**ï¼Œå°½ç®¡å¥½è¯„å¦‚æ½®ï¼ŒReact å›¢é˜Ÿå†³å®šèŠ±è´¹å®è´µçš„èµ„æºæ¥æ„å»ºå’Œå‘å¸ƒæŒ‚é’©ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸¤ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ›´æ·±å…¥åœ°äº†è§£æˆ‘ä»¬è¿‡å»æ˜¯å¦‚ä½•ç¼–å†™ React åº”ç”¨ç¨‹åºçš„ã€‚

### [](#createclass)createClass

å¦‚æœä½ æ¥è§¦ React æ¸¸æˆè¶³å¤Ÿé•¿çš„æ—¶é—´ï¼Œä½ ä¼šè®°å¾—`React.createClass` APIã€‚è¿™æ˜¯æˆ‘ä»¬åˆ›å»º React ç»„ä»¶çš„åŸå§‹æ–¹å¼ã€‚æ‚¨ç”¨æ¥æè¿°ç»„ä»¶çš„æ‰€æœ‰ä¿¡æ¯éƒ½å°†ä½œä¸ºå¯¹è±¡ä¼ é€’ç»™`createClass`ã€‚

```
const ReposGrid = React.createClass({
  getInitialState () {
    return {
      repos: [],
      loading: true
    }
  },
  componentDidMount () {
    this.updateRepos(this.props.id)
  },
  componentDidUpdate (prevProps) {
    if (prevProps.id !== this.props.id) {
      this.updateRepos(this.props.id)
    }
  },
  updateRepos (id) {
    this.setState({ loading: true })

    fetchRepos(id)
      .then((repos) => this.setState({
        repos,
        loading: false
      }))
  },
  render() {
    const { loading, repos } = this.state

    if (loading === true) {
      return <Loading />
    }

    return (
      <ul>
        {repos.map(({ name, handle, stars, url }) => (
          <li key={name}>
            <ul>
              <li><a href={url}>{name}</a></li>
              <li>@{handle}</li>
              <li>{stars} stars</li>
            </ul>
          </li>
        ))}
      </ul>
    )
  }
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**[ğŸ’»ç©ä»£ç ã€‚](https://codesandbox.io/s/why-react-hooks-createclass-iw6s5)**

`createClass`æ˜¯åˆ›å»º React ç»„ä»¶çš„ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹æ³•ã€‚React æœ€åˆä½¿ç”¨`createClass` API çš„åŸå› æ˜¯ï¼Œå½“æ—¶ JavaScript æ²¡æœ‰å†…ç½®çš„ç±»ç³»ç»Ÿã€‚å½“ç„¶ï¼Œè¿™æœ€ç»ˆæ”¹å˜äº†ã€‚åœ¨ ES6 ä¸­ï¼ŒJavaScript å¼•å…¥äº†`class`å…³é”®å­—ï¼Œå¹¶ä»¥ä¸€ç§æœ¬åœ°æ–¹å¼åœ¨ JavaScript ä¸­åˆ›å»ºç±»ã€‚è¿™å°† React ç½®äºä¸€ä¸ªè‰°éš¾çš„ä½ç½®ã€‚è¦ä¹ˆç»§ç»­ä½¿ç”¨`createClass`å¯¹æŠ— JavaScript çš„è¿›æ­¥ï¼Œè¦ä¹ˆæœä» EcmaScript æ ‡å‡†çš„æ„å¿—ï¼Œæ‹¥æŠ±ç±»ã€‚å†å²å·²ç»è¯æ˜ï¼Œä»–ä»¬é€‰æ‹©äº†åè€…ã€‚

### [](#reactcomponent)åšå‡ºååº”ã€‚æˆåˆ†

> æˆ‘ä»¬å‘ç°æˆ‘ä»¬çš„å·¥ä½œä¸æ˜¯è®¾è®¡ä¸€ä¸ªèŒä¸šç³»ç»Ÿã€‚æˆ‘ä»¬åªæƒ³ä½¿ç”¨æƒ¯ç”¨çš„ JavaScript æ–¹å¼æ¥åˆ›å»ºç±»ã€‚- [ååº” v0.13.0 å‘å¸ƒ](https://reactjs.org/blog/2015/01/27/react-v0.13.0-beta-1.html)

React v0.13.0 å¼•å…¥äº†`React.Component` APIï¼Œå…è®¸æ‚¨ä»(ç°åœ¨çš„)åŸç”Ÿ JavaScript ç±»åˆ›å»º React ç»„ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„èƒœåˆ©ï¼Œå› ä¸ºå®ƒæ›´å¥½åœ°ç¬¦åˆ EcmaScript æ ‡å‡†ã€‚

```
class ReposGrid extends React.Component {
  constructor (props) {
    super(props)

    this.state = {
      repos: [],
      loading: true
    }

    this.updateRepos = this.updateRepos.bind(this)
  }
  componentDidMount () {
    this.updateRepos(this.props.id)
  }
  componentDidUpdate (prevProps) {
    if (prevProps.id !== this.props.id) {
      this.updateRepos(this.props.id)
    }
  }
  updateRepos (id) {
    this.setState({ loading: true })

    fetchRepos(id)
      .then((repos) => this.setState({
        repos,
        loading: false
      }))
  }
  render() {
    if (this.state.loading === true) {
      return <Loading />
    }

    return (
      <ul>
        {this.state.repos.map(({ name, handle, stars, url }) => (
          <li key={name}>
            <ul>
              <li><a href={url}>{name}</a></li>
              <li>@{handle}</li>
              <li>{stars} stars</li>
            </ul>
          </li>
        ))}
      </ul>
    )
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**[ğŸ’»ç©ä»£ç ã€‚](https://codesandbox.io/s/why-react-hooks-reactcomponent-xdhg5)T3ã€‘**

å°½ç®¡æœç€æ­£ç¡®çš„æ–¹å‘è¿ˆå‡ºäº†æ˜æ˜¾çš„ä¸€æ­¥ï¼Œä½†`React.Component`å¹¶éæ²¡æœ‰ä»£ä»·ã€‚

##### [](#constructor)æ„é€ å‡½æ•°

å¯¹äºç±»ç»„ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨`constructor`æ–¹æ³•ä¸­å°†ç»„ä»¶çš„çŠ¶æ€åˆå§‹åŒ–ä¸ºå®ä¾‹ä¸Šçš„`state`å±æ€§(`this`)ã€‚ç„¶è€Œï¼Œæ ¹æ® ECMAScript è§„èŒƒï¼Œå¦‚æœæ‚¨æ­£åœ¨æ‰©å±•ä¸€ä¸ªå­ç±»(åœ¨æœ¬ä¾‹ä¸­æ˜¯`React.Component`ï¼Œæ‚¨å¿…é¡»é¦–å…ˆè°ƒç”¨`super`ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨`this`ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ä½¿ç”¨ React æ—¶ï¼Œè¿˜å¿…é¡»è®°ä½å°†`props`ä¼ é€’ç»™`super`ã€‚

```
 constructor (props) {
    super(props) // ğŸ¤®

    ...
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

##### [](#autobinding)è‡ªåŠ¨ç»‘å®š

å½“ä½¿ç”¨`createClass`æ—¶ï¼ŒReact ä¼šè‡ªåŠ¨å°†æ‰€æœ‰æ–¹æ³•ç»‘å®šåˆ°ç»„ä»¶çš„å®ä¾‹`this`ã€‚æœ‰äº†`React.Component`ï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†ã€‚å¾ˆå¿«ï¼Œåˆ°å¤„çš„å¼€å‘è€…æ„è¯†åˆ°ä»–ä»¬ä¸çŸ¥é“è¿™ä¸ªå…³é”®å­—æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ä½ å¿…é¡»è®°ä½åœ¨ç±»çš„`constructor`ä¸­`.bind`æ–¹æ³•ï¼Œè€Œä¸æ˜¯è®©æ–¹æ³•è°ƒç”¨â€œåˆšåˆšå·¥ä½œâ€ã€‚å¦‚æœä¸è¿™æ ·åšï¼Œå°±ä¼šå‡ºç°å¸¸è§çš„â€œæ— æ³•è¯»å–æœªå®šä¹‰çš„å±æ€§`setState`â€é”™è¯¯ã€‚

```
 constructor (props) {
    ...

    this.updateRepos = this.updateRepos.bind(this) // ğŸ˜­
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘çŸ¥é“ä½ å¯èƒ½åœ¨æƒ³ä»€ä¹ˆäº†ã€‚é¦–å…ˆï¼Œè¿™äº›é—®é¢˜ç›¸å½“è‚¤æµ…ã€‚å½“ç„¶ï¼Œè°ƒç”¨`super(props)`å¹¶è®°ä½`bind`ä½ çš„æ–¹æ³•æ˜¯ä»¤äººè®¨åŒçš„ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆæ ¹æœ¬æ€§çš„é”™è¯¯ã€‚ç¬¬äºŒï¼Œè¿™äº›ç”šè‡³ä¸ä¸€å®šæ˜¯ React çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ JavaScript ç±»çš„è®¾è®¡æ–¹å¼ã€‚è¿™ä¸¤ç‚¹éƒ½æ˜¯æ­£ç¡®çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æ˜¯å¼€å‘è€…ã€‚å½“ä½ ä¸€å¤©è¦å¤„ç† 20 å¤šæ¬¡æ—¶ï¼Œå³ä½¿æ˜¯æœ€è¡¨é¢çš„é—®é¢˜ä¹Ÿä¼šå˜å¾—ä»¤äººè®¨åŒã€‚å¯¹æˆ‘ä»¬æ¥è¯´å¹¸è¿çš„æ˜¯ï¼Œåœ¨ä»`createClass`åˆ‡æ¢åˆ°`React.Component`åä¸ä¹…ï¼Œå°±äº§ç”Ÿäº†[ç±»å­—æ®µ](https://tylermcginnis.com/javascript-private-and-public-class-fields/)ææ¡ˆã€‚

##### [](#class-fields)ç±»å­—æ®µ

ç±»å­—æ®µå…è®¸æ‚¨ç›´æ¥æ·»åŠ å®ä¾‹å±æ€§ä½œä¸ºç±»çš„å±æ€§ï¼Œè€Œä¸å¿…ä½¿ç”¨`constructor`ã€‚è¿™å¯¹æˆ‘ä»¬æ¥è¯´æ„å‘³ç€ï¼Œæœ‰äº†ç±»å­—æ®µï¼Œæˆ‘ä»¬ä¹‹å‰è°ˆåˆ°çš„ä¸¤ä¸ªâ€œè¡¨é¢â€é—®é¢˜éƒ½å°†å¾—åˆ°è§£å†³ã€‚æˆ‘ä»¬ä¸å†éœ€è¦ä½¿ç”¨`constructor`æ¥è®¾ç½®ç»„ä»¶çš„åˆå§‹çŠ¶æ€ï¼Œä¹Ÿä¸å†éœ€è¦åœ¨`constructor`ä¸­ä½¿ç”¨`.bind`ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„æ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°ã€‚

```
class ReposGrid extends React.Component {
  state = {
    repos: [],
    loading: true
  }
  componentDidMount () {
    this.updateRepos(this.props.id)
  }
  componentDidUpdate (prevProps) {
    if (prevProps.id !== this.props.id) {
      this.updateRepos(this.props.id)
    }
  }
  updateRepos = (id) => {
    this.setState({ loading: true })

    fetchRepos(id)
      .then((repos) => this.setState({
        repos,
        loading: false
      }))
  }
  render() {
    const { loading, repos } = this.state

    if (loading === true) {
      return <Loading />
    }

    return (
      <ul>
        {repos.map(({ name, handle, stars, url }) => (
          <li key={name}>
            <ul>
              <li><a href={url}>{name}</a></li>
              <li>@{handle}</li>
              <li>{stars} stars</li>
            </ul>
          </li>
        ))}
      </ul>
    )
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**[ğŸ’»ç©ä»£ç ã€‚](https://codesandbox.io/s/why-react-hooks-class-fields-9tbis)T3ã€‘**

æ‰€ä»¥ç°åœ¨æˆ‘ä»¬æ²¡äº‹äº†ï¼Œå¯¹å§ï¼Ÿä¸å¹¸çš„æ˜¯ï¼Œæ²¡æœ‰ã€‚ä»`createClass`åˆ°`React.Component`çš„ç§»åŠ¨å¸¦æ¥äº†ä¸€äº›æŠ˜è¡·ï¼Œä½†æ˜¯æ­£å¦‚æˆ‘ä»¬çœ‹åˆ°çš„ï¼Œç±»å­—æ®µå¤„ç†äº†è¿™äº›ã€‚ä¸å¹¸çš„æ˜¯ï¼Œåœ¨æˆ‘ä»¬çœ‹åˆ°çš„æ‰€æœ‰å…ˆå‰ç‰ˆæœ¬ä¸­ï¼Œä»ç„¶å­˜åœ¨ä¸€äº›æ›´æ·±åˆ»(ä½†å¾ˆå°‘è¢«æåŠ)çš„é—®é¢˜ã€‚

React çš„æ•´ä¸ªæ€æƒ³æ˜¯ï¼Œé€šè¿‡å°†åº”ç”¨ç¨‹åºåˆ†è§£æˆå•ç‹¬çš„ç»„ä»¶ï¼Œç„¶åå°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥æ›´å¥½åœ°ç®¡ç†åº”ç”¨ç¨‹åºçš„å¤æ‚æ€§ã€‚è¿™ä¸ªç»„ä»¶æ¨¡å‹ä½¿å¾— React å¦‚æ­¤ä¼˜é›…ã€‚å®ƒè®©æˆ‘ä»¬åšå‡ºååº”ï¼Œåšå‡ºååº”ã€‚ç„¶è€Œï¼Œé—®é¢˜ä¸åœ¨äºç»„ä»¶æ¨¡å‹ï¼Œè€Œåœ¨äºç»„ä»¶æ¨¡å‹æ˜¯å¦‚ä½•å®ç°çš„ã€‚

### [](#duplicate-logic)é‡å¤é€»è¾‘

ä»å†å²ä¸Šçœ‹ï¼Œæˆ‘ä»¬æ„å»º React ç»„ä»¶çš„æ–¹å¼ä¸ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¯†åˆ‡ç›¸å…³ã€‚è¿™ç§åˆ’åˆ†è‡ªç„¶è¿«ä½¿æˆ‘ä»¬åœ¨æ•´ä¸ªç»„ä»¶ä¸­æ•£å¸ƒç›¸å…³çš„é€»è¾‘ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬ä¸€ç›´ä½¿ç”¨çš„`ReposGrid`ä¾‹å­ä¸­æ¸…æ¥šåœ°çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬éœ€è¦ä¸‰ç§ä¸åŒçš„æ–¹æ³•(`componentDidMount`ã€`componentDidUpdate`å’Œ`updateRepos`)æ¥å®ŒæˆåŒæ ·çš„äº‹æƒ…â€”â€”è®©`repos`ä¸`props.id`ä¿æŒåŒæ­¥ã€‚

```
 componentDidMount () {
    this.updateRepos(this.props.id)
  }
  componentDidUpdate (prevProps) {
    if (prevProps.id !== this.props.id) {
      this.updateRepos(this.props.id)
    }
  }
  updateRepos = (id) => {
    this.setState({ loading: true })

    fetchRepos(id)
      .then((repos) => this.setState({
        repos,
        loading: false
      }))
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¨æ–°çš„èŒƒä¾‹æ¥å¤„ç† React ç»„ä»¶ä¸­çš„å‰¯ä½œç”¨ã€‚

### [](#sharing-nonvisual-logic)å…±äº«éå¯è§†åŒ–é€»è¾‘

å½“æ‚¨è€ƒè™‘ React ä¸­çš„ç»„åˆæ—¶ï¼Œæ‚¨å¾ˆå¯èƒ½ä¼šè€ƒè™‘ UI ç»„åˆã€‚è¿™å¾ˆè‡ªç„¶ï¼Œå› ä¸ºè¿™æ˜¯ React æ“…é•¿çš„ã€‚

```
view = fn(state) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®é™…ä¸Šï¼Œæ„å»ºä¸€ä¸ªåº”ç”¨ä¸ä»…ä»…æ˜¯ UI å±‚ã€‚éœ€è¦ç»„åˆå’Œé‡ç”¨éå¯è§†åŒ–é€»è¾‘å¹¶ä¸å°‘è§ã€‚ä½†æ˜¯ï¼Œå› ä¸º React å°† UI è€¦åˆåˆ°ç»„ä»¶ï¼Œæ‰€ä»¥è¿™å¯èƒ½å¾ˆå›°éš¾ã€‚ä»å†å²ä¸Šçœ‹ï¼ŒReact å¯¹æ­¤å¹¶æ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç­”æ¡ˆã€‚

ç»§ç»­æˆ‘ä»¬çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦åˆ›å»ºå¦ä¸€ä¸ªåŒæ ·éœ€è¦`repos`çŠ¶æ€çš„ç»„ä»¶ã€‚ç°åœ¨ï¼Œè¯¥çŠ¶æ€å’Œå¤„ç†å®ƒçš„é€»è¾‘å­˜åœ¨äº`ReposGrid`ç»„ä»¶ä¸­ã€‚æˆ‘ä»¬è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿå—¯ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯å¤åˆ¶è·å–å’Œå¤„ç†æˆ‘ä»¬çš„`repos`çš„æ‰€æœ‰é€»è¾‘ï¼Œå¹¶å°†å…¶ç²˜è´´åˆ°æ–°ç»„ä»¶ä¸­ã€‚å¾ˆè¯±äººï¼Œä½†æ˜¯ä¸è¡Œã€‚æ›´èªæ˜çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª[é«˜é˜¶ç»„ä»¶](https://tylermcginnis.com/react-higher-order-components/)ï¼Œå®ƒå°è£…äº†æ‰€æœ‰çš„å…±äº«é€»è¾‘ï¼Œå¹¶å°†`loading`å’Œ`repos`ä½œä¸ºé“å…·ä¼ é€’ç»™ä»»ä½•éœ€è¦å®ƒçš„ç»„ä»¶ã€‚

```
function withRepos (Component) {
  return class WithRepos extends React.Component {
    state = {
      repos: [],
      loading: true
    }
    componentDidMount () {
      this.updateRepos(this.props.id)
    }
    componentDidUpdate (prevProps) {
      if (prevProps.id !== this.props.id) {
        this.updateRepos(this.props.id)
      }
    }
    updateRepos = (id) => {
      this.setState({ loading: true })

      fetchRepos(id)
        .then((repos) => this.setState({
          repos,
          loading: false
        }))
    }
    render () {
      return (
        <Component
          {...this.props}
          {...this.state}
        />
      )
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæ¯å½“æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•ç»„ä»¶éœ€è¦`repos`(æˆ–`loading`)æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒåŒ…è£…åœ¨æˆ‘ä»¬çš„`withRepos` HOC ä¸­ã€‚

```
// ReposGrid.js
function ReposGrid ({ loading, repos }) {
  ...
}

export default withRepos(ReposGrid) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
// Profile.js
function Profile ({ loading, repos }) {
  ...
}

export default withRepos(Profile) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**[ğŸ’»ç©ä»£ç ã€‚](https://codesandbox.io/s/why-react-hooks-withrepos-okjsj)T3ã€‘**

è¿™æ˜¯å¯è¡Œçš„ï¼Œå¹¶ä¸”åœ¨å†å²ä¸Š(è¿åŒ[æ¸²æŸ“é“å…·](https://tylermcginnis.com/react-render-props/))ä¸€ç›´æ˜¯å…±äº«éè§†è§‰é€»è¾‘çš„æ¨èè§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œè¿™ä¸¤ç§æ¨¡å¼éƒ½æœ‰ä¸€äº›ç¼ºç‚¹ã€‚

é¦–å…ˆï¼Œå¦‚æœä½ ä¸ç†Ÿæ‚‰å®ƒä»¬(å³ä½¿ä½ å¾ˆç†Ÿæ‚‰)ï¼Œä½ çš„å¤§è„‘å¯èƒ½ä¼šä¸å¤ªæ˜ç™½å…¶ä¸­çš„é€»è¾‘ã€‚é€šè¿‡æˆ‘ä»¬çš„`withRepos` HOCï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†æœ€ç»ˆå‘ˆç°çš„ç»„ä»¶ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ç±»ç»„ä»¶ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„é€»è¾‘æ‰€åœ¨çš„åœ°æ–¹ã€‚å¤šä¹ˆå¤æ‚çš„è¿‡ç¨‹ã€‚

æ¥ä¸‹æ¥ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸æ­¢ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨çš„ HOC ä¼šæ€ä¹ˆæ ·ã€‚ä½ å¯ä»¥æƒ³è±¡ï¼Œå®ƒä¼šå¾ˆå¿«å¤±æ§ã€‚

```
export default withHover(
  withTheme(
    withAuth(
      withRepos(Profile)
    )
  )
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¯”^æ›´ç³Ÿç³•çš„æ˜¯æœ€ç»ˆå¾—åˆ°çš„æ¸²æŸ“ã€‚hoc(å’Œç±»ä¼¼çš„æ¨¡å¼)è¿«ä½¿ä½ é‡ç»„å’ŒåŒ…è£…ä½ çš„ç»„ä»¶ã€‚è¿™æœ€ç»ˆä¼šå¯¼è‡´â€œåŒ…è£…åœ°ç‹±â€,è¿™åˆä¸€æ¬¡ä½¿è·Ÿè¸ªå˜å¾—æ›´åŠ å›°éš¾ã€‚

```
<WithHover>
  <WithTheme hovering={false}>
    <WithAuth hovering={false} theme='dark'>
      <WithRepos hovering={false} theme='dark' authed={true}>
        <Profile 
          id='JavaScript'
          loading={true} 
          repos={[]}
          authed={true}
          theme='dark'
          hovering={false}
        />
      </WithRepos>
    </WithAuth>
  <WithTheme>
</WithHover> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#current-state)å½“å‰çŠ¶æ€

è¿™å°±æ˜¯æˆ‘ä»¬çš„ç°çŠ¶ã€‚

*   React å¾ˆå—æ¬¢è¿ã€‚
*   æˆ‘ä»¬ä¸º React ç»„ä»¶ä½¿ç”¨ç±»ï¼Œå› ä¸ºè¿™åœ¨å½“æ—¶æ˜¯æœ€æœ‰æ„ä¹‰çš„ã€‚
*   å«è¶…(é“å…·)å¾ˆçƒ¦ã€‚
*   æ²¡äººçŸ¥é“â€œè¿™ä¸ªâ€æ˜¯æ€ä¹ˆè¿ä½œçš„ã€‚
*   å¥½äº†ï¼Œå†·é™ä¸‹æ¥ã€‚æˆ‘çŸ¥é“ä½ çŸ¥é“â€œè¿™â€æ˜¯æ€ä¹ˆå›äº‹ï¼Œä½†å¯¹æŸäº›äººæ¥è¯´è¿™æ˜¯ä¸å¿…è¦çš„éšœç¢ã€‚
*   é€šè¿‡ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç»„ç»‡æˆ‘ä»¬çš„ç»„ä»¶è¿«ä½¿æˆ‘ä»¬åœ¨æ•´ä¸ªç»„ä»¶ä¸­æ•£å¸ƒç›¸å…³çš„é€»è¾‘ã€‚
*   React æ²¡æœ‰å¥½çš„åŸè¯­æ¥å…±äº«éå¯è§†åŒ–é€»è¾‘ã€‚

ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„ç»„ä»¶ API æ¥è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒ**ç®€å•**ã€**å¯ç»„åˆ**ã€**çµæ´»**å’Œ**å¯æ‰©å±•**ã€‚è¿™æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ï¼Œä½† React å›¢é˜Ÿä¸çŸ¥ä½•æ•…å®Œæˆäº†å®ƒã€‚

### [](#react-hooks)ååº”é’©

ä» React v0.14.0 å¼€å§‹ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•æ¥åˆ›å»ºç»„ä»¶â€”â€”ç±»æˆ–å‡½æ•°ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œå¦‚æœæˆ‘ä»¬çš„ç»„ä»¶æœ‰çŠ¶æ€æˆ–è€…éœ€è¦ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ç±»ã€‚å¦åˆ™ï¼Œå¦‚æœå®ƒåªæ˜¯æ¥å—é“å…·å’Œæ¸²æŸ“ä¸€äº› UIï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå‡½æ•°ã€‚

å¦‚æœä¸æ˜¯è¿™æ ·å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨ç±»ï¼Œè€Œæ˜¯æ€»æ˜¯ä½¿ç”¨å‡½æ•°ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ

> æœ‰æ—¶å€™ï¼Œä¼˜é›…çš„å®ç°åªæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚ä¸æ˜¯æ–¹æ³•ã€‚ä¸æ˜¯ä¸€ä¸ªç­ã€‚ä¸æ˜¯æ¡†æ¶ã€‚åªæ˜¯ä¸€ä¸ªåŠŸèƒ½ã€‚
> 
> çº¦ç¿°Â·å¡é©¬å…‹ã€‚Oculus VR CTOã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥å¢åŠ åŠŸèƒ½ç»„ä»¶æ‹¥æœ‰çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„èƒ½åŠ›ï¼Œä½†æ˜¯å‡è®¾æˆ‘ä»¬è¿™æ ·åšäº†ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ

å—¯ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è°ƒç”¨`super(props)`ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ‹…å¿ƒ`bind`è°ƒç”¨æˆ‘ä»¬çš„æ–¹æ³•æˆ–è€…`this`å…³é”®å­—ï¼Œæˆ‘ä»¬ä¹Ÿä¸å†éœ€è¦ä½¿ç”¨ç±»å­—æ®µã€‚æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬ä¹‹å‰è°ˆåˆ°çš„æ‰€æœ‰â€œè¡¨é¢â€é—®é¢˜éƒ½ä¼šæ¶ˆå¤±ã€‚

```
(ãƒà²¥,_ï½£à²¥)ãƒå½¡ React.Component ğŸ—‘

function ãƒ¾(Åâ€¿Åâœ¿) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæ›´éš¾çš„é—®é¢˜æ˜¯ã€‚

*   çŠ¶æ€
*   ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
*   å…±äº«éè§†è§‰é€»è¾‘

##### [](#state)çŠ¶æ€

ç”±äºæˆ‘ä»¬ä¸å†ä½¿ç”¨ç±»æˆ–`this`ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–°çš„æ–¹å¼æ¥æ·»åŠ å’Œç®¡ç†ç»„ä»¶å†…éƒ¨çš„çŠ¶æ€ã€‚ä» React v16.8.0 å¼€å§‹ï¼ŒReact é€šè¿‡`useState`æ–¹æ³•ä¸ºæˆ‘ä»¬æä¾›äº†è¿™ç§æ–°æ–¹å¼ã€‚

> `useState`æ˜¯æœ¬è¯¾ç¨‹ä¸­æ‚¨å°†çœ‹åˆ°çš„è®¸å¤šâ€œæŒ‚é’©â€ä¸­çš„ç¬¬ä¸€ä¸ªã€‚è®©è¿™ç¯‡æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†ä½œä¸ºä¸€ä¸ªè½¯ä»‹ç»ã€‚åœ¨æœªæ¥çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ›´æ·±å…¥åœ°ç ”ç©¶`useState`ä»¥åŠå…¶ä»–é’©å­ã€‚

`useState`æ¥å—å•ä¸ªå‚æ•°ï¼ŒçŠ¶æ€çš„åˆå§‹å€¼ã€‚å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€é¡¹æ˜¯çŠ¶æ€ï¼Œç¬¬äºŒé¡¹æ˜¯æ›´æ–°çŠ¶æ€çš„å‡½æ•°ã€‚

```
const loadingTuple = React.useState(true)
const loading = loadingTuple[0]
const setLoading = loadingTuple[1]

...

loading // true
setLoading(false)
loading // false 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æ‚¨æ‰€è§ï¼Œå•ç‹¬æŠ“å–æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹å¹¶ä¸æ˜¯æœ€ä½³çš„å¼€å‘ä½“éªŒã€‚è¿™åªæ˜¯ä¸ºäº†æ¼”ç¤º`useState`å¦‚ä½•è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚é€šå¸¸ï¼Œæ‚¨ä¼šä½¿ç”¨æ•°ç»„ææ„æ¥è·å–ä¸€è¡Œä¸­çš„å€¼ã€‚

```
// const loadingTuple = React.useState(true)
// const loading = loadingTuple[0]
// const setLoading = loadingTuple[1]

const [ loading, setLoading ] = React.useState(true) // ğŸ‘Œ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è®©æˆ‘ä»¬ç”¨æ–°å‘ç°çš„å…³äº`useState`é’©å­çš„çŸ¥è¯†æ¥æ›´æ–°æˆ‘ä»¬çš„`ReposGrid`ç»„ä»¶ã€‚

```
function ReposGrid ({ id }) {
  const [ repos, setRepos ] = React.useState([])
  const [ loading, setLoading ] = React.useState(true)

  if (loading === true) {
    return <Loading />
  }

  return (
    <ul>
      {repos.map(({ name, handle, stars, url }) => (
        <li key={name}>
          <ul>
            <li><a href={url}>{name}</a></li>
            <li>@{handle}</li>
            <li>{stars} stars</li>
          </ul>
        </li>
      ))}
    </ul>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**[ğŸ’»ç©ä»£ç ã€‚](https://codesandbox.io/s/why-react-hooks-usestate-ddhc4)T3ã€‘**

*   State âœ…
*   ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
*   å…±äº«éè§†è§‰é€»è¾‘

##### [](#lifecycle-methods)ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

è¿™é‡Œæœ‰ä»¶äº‹å¯èƒ½ä¼šè®©ä½ éš¾è¿‡(æˆ–è€…å¼€å¿ƒï¼Ÿ).å½“ä½¿ç”¨ React é’©å­æ—¶ï¼Œæˆ‘å¸Œæœ›ä½ æŠŠä½ æ‰€çŸ¥é“çš„å…³äºä¼ ç»Ÿçš„ React ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä»¥åŠé‚£ç§æ€ç»´æ–¹å¼çš„ä¸€åˆ‡éƒ½å¿˜æ‰ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†æŒ‰ç…§ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ¥æ€è€ƒçš„é—®é¢˜â€”â€”â€œè¿™ç§[ç”Ÿå‘½å‘¨æœŸ]åˆ’åˆ†è‡ªç„¶è¿«ä½¿æˆ‘ä»¬åœ¨æ•´ä¸ªç»„ä»¶ä¸­æ•£å¸ƒç›¸å…³çš„é€»è¾‘ã€‚â€ç›¸åï¼Œä»**åŒæ­¥**çš„è§’åº¦æ¥è€ƒè™‘ã€‚

å›æƒ³ä¸€ä¸‹æ‚¨ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„ä»»ä½•æ—¶å€™ã€‚æ— è®ºæ˜¯è®¾ç½®ç»„ä»¶çš„åˆå§‹çŠ¶æ€ã€è·å–æ•°æ®ã€æ›´æ–° DOMï¼Œè¿˜æ˜¯ä»»ä½•äº‹æƒ…â€”â€”æœ€ç»ˆç›®æ ‡æ€»æ˜¯åŒæ­¥ã€‚é€šå¸¸ï¼Œåœ¨ React land ä¹‹å¤–åŒæ­¥ä¸€äº›ä¸œè¥¿(API è¯·æ±‚ã€DOM ç­‰)ã€‚)ä¸ React land(ç»„ä»¶çŠ¶æ€)å†…éƒ¨çš„æŸä¸ªä¸œè¥¿ï¼Œåä¹‹äº¦ç„¶ã€‚

å½“æˆ‘ä»¬è€ƒè™‘åŒæ­¥è€Œä¸æ˜¯ç”Ÿå‘½å‘¨æœŸäº‹ä»¶æ—¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†ç›¸å…³çš„é€»è¾‘ç‰‡æ®µç»„åˆåœ¨ä¸€èµ·ã€‚ä¸ºæ­¤ï¼ŒReact ç»™äº†æˆ‘ä»¬å¦ä¸€ä¸ªåä¸º`useEffect`çš„é’©å­ã€‚

å®šä¹‰ï¼Œ`useEffect`è®©ä½ åœ¨å‡½æ•°ç»„ä»¶ä¸­æ‰§è¡Œå‰¯ä½œç”¨ã€‚å®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªå¯é€‰æ•°ç»„ã€‚å‡½æ•°å®šä¹‰è¦è¿è¡Œçš„å‰¯ä½œç”¨ï¼Œè€Œ(å¯é€‰)æ•°ç»„å®šä¹‰ä½•æ—¶â€œé‡æ–°åŒæ­¥â€(æˆ–é‡æ–°è¿è¡Œ)æ•ˆæœã€‚

```
React.useEffect(() => {
  document.title = `Hello, ${username}`
}, [username]) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä¼ é€’ç»™`useEffect`çš„å‡½æ•°å°†åœ¨`username`æ”¹å˜æ—¶è¿è¡Œã€‚å› æ­¤ï¼Œå°†æ–‡æ¡£çš„æ ‡é¢˜ä¸`Hello, ${username}`å†³å®šçš„å†…å®¹åŒæ­¥ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨`useEffect`é’©å­æ¥åŒæ­¥`repos`å’Œæˆ‘ä»¬çš„`fetchRepos` API è¯·æ±‚å‘¢ï¼Ÿ

```
function ReposGrid ({ id }) {
  const [ repos, setRepos ] = React.useState([])
  const [ loading, setLoading ] = React.useState(true)

  React.useEffect(() => {
    setLoading(true)

    fetchRepos(id)
      .then((repos) => {
        setRepos(repos)
        setLoading(false)
      })
  }, [id])

  if (loading === true) {
    return <Loading />
  }

  return (
    <ul>
      {repos.map(({ name, handle, stars, url }) => (
        <li key={name}>
          <ul>
            <li><a href={url}>{name}</a></li>
            <li>@{handle}</li>
            <li>{stars} stars</li>
          </ul>
        </li>
      ))}
    </ul>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**[ğŸ’»ç©ä»£ç ã€‚](https://codesandbox.io/s/why-react-hooks-useeffect-0m35p)T3ã€‘**

å¾ˆåœ†æ»‘ï¼Œå¯¹å§ï¼Ÿæˆ‘ä»¬å·²ç»æˆåŠŸåœ°æ‘†è„±äº†`React.Component`ã€`constructor`ã€`super`ã€`this`ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å†è®©æˆ‘ä»¬çš„æ•ˆæœé€»è¾‘åˆ†æ•£(å’Œé‡å¤)åœ¨æ•´ä¸ªç»„ä»¶ä¸­ã€‚

*   State âœ…
*   ç”Ÿå‘½å‘¨æœŸæ–¹æ³•âœ…
*   å…±äº«éè§†è§‰é€»è¾‘

##### [](#sharing-nonvisual-logic)å…±äº«éå¯è§†é€»è¾‘

å‰é¢æˆ‘ä»¬æåˆ° React æ²¡æœ‰å¾ˆå¥½åœ°è§£å†³å…±äº«éå¯è§†åŒ–é€»è¾‘çš„åŸå› æ˜¯å› ä¸ºâ€œReact å°† UI è€¦åˆåˆ°ä¸€ä¸ªç»„ä»¶â€ã€‚è¿™å¯¼è‡´è¿‡äºå¤æ‚çš„æ¨¡å¼ï¼Œå¦‚[é«˜é˜¶ç»„ä»¶](https://tylermcginnis.com/react-higher-order-components/)æˆ–[æ¸²æŸ“é“å…·](https://tylermcginnis.com/react-render-props/)ã€‚ç°åœ¨ä½ å¯èƒ½å·²ç»çŒœåˆ°äº†ï¼ŒHooks å¯¹æ­¤ä¹Ÿæœ‰ä¸€ä¸ªç­”æ¡ˆã€‚ç„¶è€Œï¼Œå¾ˆå¯èƒ½ä¸æ˜¯ä½ æƒ³çš„é‚£æ ·ã€‚æ²¡æœ‰ç”¨äºå…±äº«éå¯è§†é€»è¾‘çš„å†…ç½®æŒ‚é’©ï¼Œç›¸åï¼Œæ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰æŒ‚é’©ï¼Œä¸ä»»ä½• UI åˆ†ç¦»ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå·±çš„å®šåˆ¶`useRepos`é’©å­æ¥çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚è¿™ä¸ªé’©å­å°†æ¥å—æˆ‘ä»¬æƒ³è¦è·å–çš„å›è´­çš„ä¸€ä¸ª`id`ï¼Œå¹¶ä¸”(éµå¾ªç±»ä¼¼çš„ API)å°†è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­ç¬¬ä¸€é¡¹æ˜¯`loading`çŠ¶æ€ï¼Œç¬¬äºŒé¡¹æ˜¯`repos`çŠ¶æ€ã€‚

```
function useRepos (id) {
  const [ repos, setRepos ] = React.useState([])
  const [ loading, setLoading ] = React.useState(true)

  React.useEffect(() => {
    setLoading(true)

    fetchRepos(id)
      .then((repos) => {
        setRepos(repos)
        setLoading(false)
      })
  }, [id])

  return [ loading, repos ]
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½çš„ä¸€ç‚¹æ˜¯ï¼Œä»»ä½•ä¸è·å–æˆ‘ä»¬çš„`repos`ç›¸å…³çš„é€»è¾‘éƒ½å¯ä»¥åœ¨è¿™ä¸ªå®šåˆ¶é’©å­ä¸­æŠ½è±¡å‡ºæ¥ã€‚ç°åœ¨ï¼Œä¸ç®¡æˆ‘ä»¬åœ¨å“ªä¸ªç»„ä»¶ä¸­ï¼Œå³ä½¿å®ƒæ˜¯éå¯è§†åŒ–é€»è¾‘ï¼Œåªè¦æˆ‘ä»¬éœ€è¦å…³äº`repos`çš„æ•°æ®ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„`useRepos`å®šåˆ¶é’©å­ã€‚

```
function ReposGrid ({ id }) {
  const [ loading, repos ] = useRepos(id)

  ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
function Profile ({ user }) {
  const [ loading, repos ] = useRepos(user.id)

  ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**[ğŸ’»ç©ä»£ç ã€‚](https://codesandbox.io/s/why-react-hooks-custom-hooks-t4rqv)T3ã€‘**

*   State âœ…
*   ç”Ÿå‘½å‘¨æœŸæ–¹æ³•âœ…
*   å…±äº«éå¯è§†åŒ–é€»è¾‘âœ…

* * *

é’©å­çš„å¸‚åœºå®£ä¼ æ˜¯ï¼Œä½ å¯ä»¥åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€ã€‚å®é™…ä¸Šï¼Œé’©å­è¿œä¸æ­¢è¿™äº›ã€‚å®ƒä»¬æ˜¯å…³äºæ”¹è¿›çš„ä»£ç é‡ç”¨ã€ç»„åˆå’Œæ›´å¥½çš„é»˜è®¤å€¼ã€‚æˆ‘ä»¬è¿˜éœ€è¦ä»‹ç»æ›´å¤šçš„é’©å­ï¼Œä½†æ˜¯ç°åœ¨ä½ çŸ¥é“äº†å®ƒä»¬ä¸ºä»€ä¹ˆå­˜åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªåšå®çš„åŸºç¡€ã€‚

* * *

è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨ TylerMcGinnis.comï¼Œæ˜¯æˆ‘ä»¬ T2 ååº”é’©å­è¯¾ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œçœ‹çœ‹å§ã€‚