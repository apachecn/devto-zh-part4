# å¡æ€å…¥é—¨ï¼ŒSolidity çš„ç‘å£«å†›åˆ€

> åŸæ–‡:[https://dev . to/liamzebedee/a-primer-on-Seth-solidity-s-Swiss-army-knife-mi3](https://dev.to/liamzebedee/a-primer-on-seth-solidity-s-swiss-army-knife-mi3)

åŒå€¦äº†ç”¨ JS è„šæœ¬å†™`new Web3`åªæ˜¯ä¸ºäº†æ£€æŸ¥å¹³è¡¡ï¼Ÿä¸ºæŠŠäº‹æƒ…è½¬æ¢æˆ BigNumber çš„æ‘©æ“¦è€Œçƒ¦æ¼ï¼ŒåŠ è½½`Contract.json`ï¼Œå¤„ç†æ‰¿è¯ºåªæ˜¯ä¸ºäº†åšä¸€äº›ç®€å•çš„äº‹æƒ…ï¼Ÿè®©æˆ‘ç»™ä½ ä»‹ç»ä¸€ä¸‹`seth`ã€‚ä½¿ç”¨`seth`ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨å‘½ä»¤è¡Œçš„é€Ÿåº¦å’Œçµæ´»æ€§è½»æ¾åœ°ä¸æ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’ã€‚è¿™æ˜¯æˆ´ç§°èµçš„ MakerDAO å›¢é˜Ÿå¼€å‘çš„ä¸€å¥—å·¥å…·çš„ä¸€éƒ¨åˆ†ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½ å°†ä» 0 èµ°å‘è‹±é›„ã€‚

## [](#introduction-to-seth)å¡æ–¯ç®€ä»‹

Github ä¸Šçš„ [Seth å‚è€ƒæŒ‡å—](https://github.com/dapphub/dapptools/tree/master/src/seth)å¾ˆæ£’ï¼Œä½†æ˜¯å®ƒé—æ¼äº†ä¸€äº›ç»éªŒï¼Œå¦‚æœä½ ä¸æ˜¯ CLI çš„é«˜çº§ç”¨æˆ·ï¼Œè¿™äº›ç»éªŒä¸ä¼šå¾ˆæ˜æ˜¾ã€‚æˆ‘å°†ä»è¿™äº›ç”¨ä¾‹çš„è§’åº¦è§£é‡Šä¸€äº›éå¸¸ç®€å•çš„æŠ€æœ¯:

*   éƒ¨ç½²å—èŒåˆåŒ
*   ä¿å­˜åˆåŒçš„éƒ¨ç½²åœ°å€
*   è°ƒç”¨æ–¹æ³•å’Œä¼ é€’å‚æ•°
*   ä»ä¸åŒè´¦æˆ·è¿›è¡Œäº¤æ˜“
*   è½¬æ¢å•ä½(æ•°å­—ã€eth)

### [](#installing-seth)å®‰è£… seth

`seth`æ˜¯`dapptools`å¥—ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥å¥—ä»¶æ˜¯ä¸€ä¸ªè¶…çº§æœ€å°è½¯ä»¶åŒ…(æ¯”å¦‚ 5kB)ã€‚æ‘˜è‡ªä»–ä»¬çš„ [Github æŒ‡ä»¤](https://github.com/dapphub/dapptools) :

```
curl https://dapp.tools/install | sh 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#deploying-a-truffle-contract)éƒ¨ç½²æ¾éœ²å¥‘çº¦

Seth åŸºäº unix å“²å­¦ï¼Œå°†æ–‡ä»¶æ”¾åœ¨æ ¸å¿ƒä½ç½®ã€‚æ‚¨å¯èƒ½å·²ç»ä¹ æƒ¯äº†åƒ Truffle è¿™æ ·çš„æ•´ä½“æ¡†æ¶ï¼Œå½“å®ƒå¤„ç†ä¸šåŠ¡æ—¶ï¼Œæ‚¨åªèƒ½ååœ¨ååº§ã€‚è¿è¡Œ`truffle compile`ï¼Œä¼šç”Ÿæˆ`build/contracts/ContractName.json`å½¢å¼çš„å¥‘çº¦å·¥ä»¶ã€‚è¿è¡Œ`truffle migrate`ï¼Œå®ƒå°†è‡ªåŠ¨è·å–è¿™äº›åˆåŒçš„å­—èŠ‚ç å¹¶éƒ¨ç½²å®ƒä»¬ã€‚

è¿™å¯èƒ½çœ‹èµ·æ¥å¾ˆå¯æ€•ï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬è‡ªå·±åšç»†èŠ‚å¹¶ä¸å¤æ‚ï¼

[![](../Images/7d64d5ab0777d8bbe9f23c8fb2bc4555.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--okDWUZei--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/784r3viwrckuhwkblkoz.png)
[![](../Images/f1b0dca8a8470c8a93b85d48e31d547f.png)T6ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jne747f_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/4x41j7q1s4tpby6tbqcx.png)

ä½†æ˜¯ç­‰ç­‰ï¼Œ`bytecode`å’Œ`deployedBytecode`æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå—¯ï¼Œå½“ä½ åœ¨ä»¥å¤ªåŠä¸­éƒ¨ç½²ä¸€ä¸ªåˆåŒæ—¶ï¼Œä½ åšäº†ä¸¤ä»¶äº‹:

1)æ‚¨æ­£åœ¨åˆ›å»ºä¸€ä¸ªå¥‘çº¦ï¼Œå®ƒå°†è¿è¡Œæ—¶ä»£ç å­˜å‚¨åœ¨é“¾
ä¸Š 2)æ‚¨æ­£åœ¨è°ƒç”¨æ„é€ å‡½æ•°

ç®€å•åœ°è¯´â€”â€”`deployedBytecode`åªæ˜¯è¿è¡Œæ—¶ï¼Œè€Œ`bytecode`åŒ…å«äº†æ„é€ å‡½æ•°çš„ä»£ç ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨ seth éƒ¨ç½²åˆåŒæœ‰å¤šç®€å•ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®‰è£…`jq`ï¼Œä¸€ä¸ªå¯ä»¥è§£æ JSON çš„ CLI å·¥å…·ã€‚ä½ å¯ä»¥åœ¨æ‰¾åˆ°[çš„å®‰è£…è¯´æ˜ã€‚](https://stedolan.github.io/jq/download/) 

```
# Get the bytecode from the Truffle artifact
export CODE=$(cat build/contracts/ERC20.json | jq -r .bytecode) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#setting-up-seths-environment)è®¾ç½® seth çš„ç¯å¢ƒ

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥è®¾ç½® seth éœ€è¦çŸ¥é“çš„ç¯å¢ƒå˜é‡:

```
# Connect to the local node
export ETH_RPC_URL=http://127.0.0.1:8545

# Disable below if not on Truffle
export ETH_GAS=4712388

# Use the unlocked RPC accounts
export ETH_RPC_ACCOUNTS=yes

# Get the 1st account and use it
export ETH_FROM=$(seth accounts | head -n1 | awk '{ print $1 }') 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#deploying-the-contract)éƒ¨ç½²åˆåŒ

```
# We can write it simply
seth send --create $CODE

# Passing variables to the constructor
# In this example, the constructor is ERC20Detailed
# constructor(string name, string symbol, uint decimals)
seth send --create $CODE TokenName TOK 18 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæ‚¨å°†å¾—åˆ°å¦‚ä¸‹è¾“å‡º:

```
seth-send: Published transaction with 3227 bytes of calldata.
seth-send: 0xb330d69093fd6b19d5afecffebf6734f77ef8d7cf47dabb87ad840a7d4b8e57f
seth-send: Waiting for transaction receipt....
seth-send: Transaction included in block 36.
0x243e72b69141f6af525a9a5fd939668ee9f2b354 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åä¸€è¡Œæ˜¯åˆåŒåœ°å€ã€‚

### [](#saving-a-contracts-deployment-address)ä¿å­˜åˆåŒçš„è°ƒé…åœ°å€

æˆ‘åœ¨ Bash æ–¹é¢å¹¶ä¸ç†Ÿç»ƒâ€”â€”ä½†æ˜¯æˆ‘çŸ¥é“ä¸€ä»¶äº‹:å½“æˆ‘æƒ³ä¿å­˜éƒ¨ç½²åœ°å€æ—¶ï¼Œæˆ‘å¹¶ä¸æ˜¯åœ¨é‡æ–°å‘æ˜è½®å­ã€‚ä½¿ç”¨ Sourcegraph(è¿™æ˜¯ grep+git çš„ç±»å›ºé†‡)ï¼Œæˆ‘åªæ˜¯[åœ¨ dapphub çš„æ‰€æœ‰å›è´­](https://sourcegraph.com/search?q=repo:%5Egithub%5C.com/dapphub+seth+send+)ä¸­æœç´¢`seth send`ï¼Œå¹¶èƒ½å¤ŸæŠ“å–ä¸‹é¢çš„è¡Œã€‚

```
ERC20_ADDR=$(seth send --create $CODE --status 2>/dev/null)

# or even terser
ERC20_ADDR=$(seth send --create $(cat build/contracts/ERC20.json | jq -r .bytecode) --status 2>/dev/null) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`2>/dev/null`åŸºæœ¬ä¸Šå°† STDERR(è§[æ ‡å‡†æµ](https://en.wikipedia.org/wiki/Standard_streams))é‡å®šå‘ä¸º nullã€‚seth çš„æ‰€æœ‰æ‚é¡¹è®°å½•éƒ½è¢«å¿½ç•¥ï¼Œæˆ‘ä»¬åªå‰©ä¸‹åˆåŒåœ°å€ã€‚

**å¦‚æœéƒ¨ç½²å¤±è´¥**ï¼Œå°±æ²¡æœ‰`.catch`æˆ–è€…éš¾ä»¥è´Ÿæ‹…çš„æ‰¿è¯ºè¦å¤„ç†ã€‚`$ERC20_ADDR`å˜é‡å°†ä¸ºç©ºã€‚å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªè„šæœ¬ä¸­è‡ªåŠ¨æ‰§è¡Œï¼Œæ˜æ™ºçš„åšæ³•æ˜¯ç¡®ä¿å®ƒåœ¨å¤±è´¥æ—¶å°½æ—©é€€å‡ºã€‚çœ‹çœ‹è¿™ä¸ª:

```
#!/bin/bash
set -ex

# Connect to the local node
export ETH_RPC_URL=http://127.0.0.1:8545

# Disable below if not on Truffle
export ETH_GAS=4712388

# Use the unlocked RPC accounts
export ETH_RPC_ACCOUNTS=yes

# Get the 1st account and use it
export ETH_FROM=$(seth accounts | head -n1 | awk '{ print $1 }')

ERC20_ADDR=$(seth send --create $(cat build/contracts/ERC20.json | jq -r .bytecode) --status 2>/dev/null)

echo -n $ERC20_ADDR > ERC20.deployment 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å˜£ï¼æˆ‘ä»¬åˆšåˆšå°†åœ°å€ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿ä»¥ååŠ è½½ï¼

### [](#calling-methods-and-passing-arguments)è°ƒç”¨æ–¹æ³•å’Œä¼ é€’å‚æ•°

è¿™å¯èƒ½æ˜¯èµ›æ–¯æœ€å¥½çš„éƒ¨åˆ†ã€‚ä½¿ç”¨è¿™ä¸ªå·¥å…·è°ƒç”¨å¥‘çº¦ä¸Šçš„æ–¹æ³•å†ç®€å•ä¸è¿‡äº†ï¼Œå› ä¸º**ä½ ä¸å¿…åŠ è½½ JSON ABI"** æ¥ä¸å¥‘çº¦äº¤äº’ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æ­£åœ¨æµ‹è¯•è¿™ä¸ªä»¤ç‰Œå¥‘çº¦ï¼Œæˆ‘ä»¬æƒ³ä¸ºè‡ªå·±é“¸é€ ä¸€äº›ä»¤ç‰Œã€‚è¿™æœ‰å¤šç®€å•:

```
# Get the contracts address
export ERC20_ADDR=$(cat ERC20.deployment)

seth send $ERC20_ADDR "mint(uint256)" 1 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åŒæ ·ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æœ‰è¿”å›å€¼ï¼Œä½ åªéœ€è¦å‘ seth å±•ç¤ºå¦‚ä½•è§£ç å®ƒã€‚æˆ‘ä»¬ä¼ é€’çš„æ˜¯æ–¹æ³•ç­¾åï¼Œä½†å½¢å¼æ¯”å®Œæ•´æ–¹æ³•ç®€å•å¾—å¤š- `method(<types>)(<return-types>)`ã€‚

```
# Get the balance of our address
seth send $ERC20_ADDR "balanceOf(address)(uint)" $ETH_FROM 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#transacting-from-different-accounts)ä¸åŒè´¦æˆ·äº¤æ˜“

æˆ‘ä»¬ç»å¸¸åœ¨å¥‘çº¦é€»è¾‘ä¸­ä½¿ç”¨`msg.sender`ã€‚åˆ°äº†æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›ä½¿ç”¨ä¸åŒçš„å¸æˆ·è¿›è¡Œäº¤äº’ã€‚Seth ä½¿ç”¨`ETH_FROM`å˜é‡ä½¿è¿™å˜å¾—éå¸¸ç®€å•ã€‚

æˆ‘ä»¬å·²ç»å¼€å§‹ä½¿ç”¨å…¨å±€`ETH_FROM`äº†ï¼Œä½†æ˜¯ä½¿ç”¨æ¯ä¸ªè°ƒç”¨ä¹Ÿå¾ˆç®€å•ã€‚

```
export BUYER=$(seth accounts | sed -n 2p | awk '{ print $1 }')

seth send --from $BUYER --value 402343423423423 $EXCHANGE "ethToTokenSwapInput(uint256,uint256)" 3 1000000000000 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢çš„ä¾‹å­ä»æˆ‘åˆ†é…çš„åä¸º$BUYER çš„ç‰¹å®šå¸æˆ·è°ƒç”¨ Uniswap exchange ä¸Šçš„`ethToTokenSwapInput`ã€‚å®ƒè¿˜åˆ©ç”¨`--value`åœ¨äº‹åŠ¡ä¸­å‘é€ä¸€äº›ä»¥å¤ªç½‘ã€‚

### [](#converting-units-numbers-eth)è½¬æ¢å•ä½(æ•°å­—ï¼Œeth)

è¿™è®©æˆ‘æƒ³èµ·äº†æˆ‘æœ€åä¸€æ¬¡é‡è¦çš„å…³äºèµ›æ–¯è½¬æ¢å•ä½çš„æ•™å­¦ã€‚åœ¨ä»¥å¤ªåŠä¸­ï¼Œæˆ‘ä»¬é»˜è®¤å¤„ç†`uint256`ï¼Œä»¥å¤ªå’Œå…¶ä»–ä»£å¸*é€šå¸¸æ˜¯*è®¾è®¡ä¸ºæ˜¾ç¤º 18 ä½å°æ•°ã€‚Seth ä½¿è¿™äº›ä¸åŒæ ¼å¼ä¹‹é—´çš„è½¬æ¢å˜å¾—å¾ˆå®¹æ˜“ã€‚

```
seth --to-dec 0000000000000cb803 eth
# 833539

seth --from-wei <decimal-amount>
# 0.123

seth --to-wei <decimal-value>
# 123

seth --to-ascii 67646179206d617465
# ... ;) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#conclusion)ç»“è®º

ä½œä¸ºä»¥å¤ªåŠç”Ÿæ€ç³»ç»Ÿçš„å¼€å‘è€…ï¼Œæˆ‘è®¤ä¸º`seth`æ˜¯ä¸€é¡¹äº†ä¸èµ·çš„æŠ•èµ„ã€‚è€ƒè™‘åˆ°å…¨æ–°å·¥å…·å¹³å°å›ºæœ‰çš„å¤æ‚æ€§ï¼Œ`seth`æ˜¯ä¸€ç§åœ¨åŒºå—é“¾è½¯ä»¶ä¸Šæ£€æŸ¥ã€è¯•éªŒå’Œè¿­ä»£çš„å®ç”¨æ–¹æ³•ã€‚

â˜•ï¸:å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæŒ‡å—ï¼Œå¯ä»¥è€ƒè™‘åœ¨ Twitter ä¸Šå…³æ³¨æˆ‘ã€‚

ğŸ˜æˆ‘å–œæ¬¢å­¦ä¹ å’Œæ•™å­¦ï¼Œå¹¶ç»å¸¸è¿™æ ·åšã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä½ å¯èƒ½ä¼šæ„Ÿå…´è¶£çš„é“¾æ¥:

*   æˆ‘çš„[ä»¤äººæ•¬ç•çš„åšå®æ¨¡å¼](https://github.com/liamzebedee/awesome-solidity-patterns)å›è´­
*   [å¦‚ä½•å°†åº“é“¾æ¥åˆ° sol-ç¼–è¯‘å™¨ç”Ÿæˆçš„ Solidity å¥‘çº¦ä¸­](https://dev.to/liamzebedee/how-to-link-libraries-into-solidity-contracts-generated-by-sol-compiler-34b3)
*   æˆ‘çš„åšå®¢ï¼Œ[å¸¸è§„é­…åŠ›](https://liamz.co/blog/)ï¼Œæœ‰ä¸€äº›æ›´æ·±å…¥çš„å†…å®¹
*   [@liamzebedee](https://twitter.com/liamzebedee) æŸ¥çœ‹ç§‘æŠ€é¢†åŸŸæœ‰è¶£çš„é“¾æ¥/è®¨è®º