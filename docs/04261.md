# æ‚¨åº”è¯¥ä½¿ç”¨çŠ¶æ€è¿˜æ˜¯ä½¿ç”¨è¯ä¹¦ğŸ¤·ï¼ŸçœŸçš„æ²¡å…³ç³»ã€‚3 åˆ†é’Ÿå†…è§£é‡Šå®Œæ¯•ã€‚

> åŸæ–‡:[https://dev . to/getd/should-you-use state-or-usereducer-not-matter-really-explained-in-3 mins-9dk](https://dev.to/getd/should-you-usestate-or-usereducer-doesn-t-matter-really-explained-in-3-mins-9dk)

React [æ–‡æ¡£](https://reactjs.org/docs/hooks-reference.html#usereducer)æ¨èä½¿ç”¨`useReducer`æ¥å¤„ç†å¤æ‚çš„çŠ¶æ€å€¼ã€‚ä½†å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒä»¬åŒæ ·å¼ºå¤§ã€‚è®©æˆ‘å‘Šè¯‰ä½ æ€ä¹ˆåšã€‚

# [](#usereducer-can-replace-usestate)useReducer å¯ä»¥ä»£æ›¿ useState

é¦–å…ˆï¼Œæ›´ç®€å•çš„æƒ…å†µ:ä»»ä½•`useState`éƒ½å¯ä»¥ä½¿ç”¨`useReducer`æ¥å®ç°ã€‚äº‹å®ä¸Šï¼Œ`useState`åŠé’©æœ¬èº«å°±æ˜¯ç”±ä¸€ä¸ªå‡é€Ÿå™¨å®ç°çš„ã€‚

è®©æˆ‘ä»¬ç”¨`useState`åˆ›å»ºä¸€ä¸ªç®€å•çš„ååº”çŠ¶æ€ã€‚è¯¥çŠ¶æ€åŒ…å«ä¸€ä¸ª`count`å·ã€‚

```
type State = { count: number };

const [state, setState] = React.useState<State>({ count: 0 }); 
```

æˆ‘ä»¬å¯ä»¥ç”¨`useReducer`é‡æ–°å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚

```
type Action = {
  type: 'COUNT_CHANGED',
  count: number,
};

const reducer: React.Reducer<State, Action> = (
  prevState: State,
  action: Action
): State => {
  switch (action.type) {
    case "COUNT_CHANGED":
      return { ...prevState, count: action.count };
  }
};

const [state, dispatch] = React.useReducer(reducer, { count: 0 }); 
```

é™¤äº†å¤šè¡Œä»£ç ä¹‹å¤–ï¼Œå®ƒä»¬çš„åŠŸèƒ½å®Œå…¨ç›¸åŒã€‚

è¿™é‡Œ`useReducer`æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚

*   ç¬¬ä¸€ä¸ªæ˜¯`reducer`å‡½æ•°:`(prevState, action) => newState`ã€‚å½“`dispatch`å˜ä¸º`action`æ—¶ï¼Œå®ƒæ›´æ–°(è¿˜åŸ)å…ˆå‰çŠ¶æ€ä¸ºæ–°çŠ¶æ€ã€‚
*   ç¬¬äºŒä¸ªæ˜¯åˆå§‹çŠ¶æ€ï¼Œä¸ä¼ å…¥`useState`çš„çŠ¶æ€ç›¸åŒã€‚

æˆ‘ä»¬åªæœ‰ä¸€ä¸ªåŠ¨ä½œå«åš`COUNT_CHANGED`ã€‚æ‰€ä»¥ä¸‹é¢ä¸¤è¡Œä¼šè§¦å‘ç›¸åŒçš„çŠ¶æ€æ›´æ–°:

```
// with useState
setState({ count: 1 });

// with useReducer
dispatch({ type: 'COUNT_CHANGED', count: 1 }); 
```

# [](#usestate-can-replace-usereducer-too)useState ä¹Ÿå¯ä»¥ä»£æ›¿ useReducer

`useReducer`çš„ä¸€ä¸ªä¼˜åŠ¿æ˜¯å®ƒå¤„ç†å¤æ‚çŠ¶æ€å€¼çš„èƒ½åŠ›ã€‚è®©æˆ‘ä»¬åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªè¾“å…¥ç»„ä»¶çš„æ ¹çº§è¡¨å•ç»„ä»¶ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸ªè¾“å…¥éƒ½å¤„ç†è‡ªå·±çš„å€¼ã€‚ç”¨æˆ·ç•Œé¢å¦‚ä¸‹:

```
 <UserForm>
      <FirstNameInput />
      <LastNameInput />
      <AgeInput />
    </UserForm> 
```

æˆ‘ä»¬åœ¨ä¸‹é¢åˆ›å»ºä¸€ä¸ªç¼©å‡å™¨æ¥å¤„ç† 3 ä¸ªè¾“å…¥å€¼:

```
// A complex state with user name and age
type UserState = {
  name: {
    first: string,
    last: string,
  },
  age: number,
};

// Three action types to update each state value
type Action =
  | {
      type: "FIRST_NAME_CHANGED";
      first: string;
    }
  | {
      type: "LAST_NAME_CHANGED";
      last: string;
    }
  | {
      type: "AGE_CHANGED";
      age: number;
    };

const reducer: React.Reducer<UserState, Action> = (
  prevState: UserState,
  action: Action
): UserState => {
  switch (action.type) {
    case "FIRST_NAME_CHANGED":
      return { ...prevState, name: { ...prevState.name, first: action.first } };
    case "LAST_NAME_CHANGED":
      return { ...prevState, name: { ...prevState.name, last: action.last } };
    case "AGE_CHANGED":
      return { ...prevState, age: action.age };
  }
}; 
```

ç°åœ¨åœ¨æˆ‘ä»¬çš„`UserForm`ç»„ä»¶ä¸­ä½¿ç”¨å®ƒã€‚æ³¨æ„`dispatch`è¢«ä¼ é€’åˆ°æ¯ä¸ª`Input`ä¸­ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥è§¦å‘åŠ¨ä½œæ¥æ›´æ–°å®ƒä»¬è‡ªå·±çš„å­—æ®µã€‚

```
const UserForm = () => {
  const [state, dispatch] = React.useReducer(reducer, {
    name: { first: "first", last: "last" },
    age: 40
  });
  return (
    <React.Fragment>
      <FirstNameInput value={state.name.first} dispatch={dispatch} />
      <LastNameInput value={state.name.last} dispatch={dispatch} />
      <AgeInput value={state.age} dispatch={dispatch} />
    </React.Fragment>
  )
} 
```

å®Œæˆäº†ã€‚è¿™å°±æ˜¯`useReducer`å¦‚ä½•é€‚ç”¨äºå¤æ‚çŠ¶æ€ã€‚ç°åœ¨æ€ä¹ˆæ¢ç®—æˆ`useState`ï¼Ÿ

ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯å‘æ¯ä¸ª`Input`ä¼ é€’ä¸€ä¸ªå¤§çš„çŠ¶æ€å¯¹è±¡ã€‚æˆ‘ä»¬å¿…é¡»ä¼ é€’æ•´ä¸ªçŠ¶æ€ï¼Œå› ä¸ºæ¯ä¸ª`Input`éœ€è¦çŸ¥é“å½“å‰çŠ¶æ€çš„â€œå…¨è²Œâ€,ä»¥ä¾¿æ­£ç¡®åœ°æ„é€ æ–°çš„çŠ¶æ€ã€‚å¤§æ¦‚å¦‚ä¸‹:

```
// This is a bad example.
const UserForm = () => {
  const [state, setState] = React.useState({
    name: { first: "first", last: "last" },
    age: 40
  });
  return (
    <React.Fragment>
      <FirstNameInput state={state} setState={setState} />
      <LastNameInput state={state} setState={setState} />
      <AgeInput state={state} setState={setState} />
    </React.Fragment>
  )
} 
```

è¿™å¾ˆç³Ÿç³•ï¼ŒåŸå› æœ‰å‡ ä¸ª:

1.  æ²¡æœ‰èŒè´£åˆ†ç¦»:æ¯ä¸ª`Input`ç°åœ¨éœ€è¦å®Œå…¨çŠ¶æ€ä½œä¸ºå…¶å·¥ä½œçš„é“å…·ã€‚ä½¿å¾—é‡æ„å’Œå•å…ƒæµ‹è¯•æ›´åŠ å›°éš¾ã€‚
2.  æ€§èƒ½å·®:ä»»ä½•çŠ¶æ€æ”¹å˜éƒ½ä¼šè§¦å‘æ‰€æœ‰çš„`Input`é‡æ–°æ¸²æŸ“ã€‚

äº‹å®ä¸Šï¼Œè¿™äº›æ­£æ˜¯ React å›¢é˜Ÿå»ºè®®å¯¹è¿™ç§å¤æ‚çŠ¶æ€ä½¿ç”¨`useReducer`çš„åŸå› ã€‚

ä½†è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨`useState`æ¥è¾¾åˆ°åŒæ ·çš„ç»“æœã€‚å®ƒåªæ˜¯éœ€è¦æ›´å¤šçš„æ‰‹å·¥åˆ¶ä½œã€‚

```
function Counter() {
  const { state, setFirstName, setLastName, setAge } = useComplexState({
    name: { first: "first", last: "last" },
    age: 40
  });
  return (
    <React.Fragment>
      <FirstNameInput value={state.name.first} setFirstName={setFirstName} />
      <LastNameInput value={state.name.last} setLastName={setLastName} />
      <AgeInput value={state.age} setAge={setAge} />
    </React.Fragment>
  )
}

// A custom hook that returns setter functions for each field.
// This is similar to what the reducer above is doing,
// we simply convert each action into its own setter function.
function useComplexState(initialState: UserState): any {
  const [state, setState] = React.useState<UserState>(initialState);
  const setFirstName = first =>
    setState(prevState => ({
      ...prevState,
      name: { ...prevState.name, first }
    }));
  const setLastName = last =>
    setState(prevState => ({
      ...prevState,
      name: { ...prevState.name, last }
    }));
  const setAge = age => setState(prevState => ({ ...prevState, age }));
  return { state, setFirstName, setLastName, setAge };
} 
```

å…¶å®æˆ‘ä»¬å®Œå…¨å¯ä»¥åªç”¨`useState` :
æ¥æ”¹å†™`useReducer`

```
const useReducerImplementedByUseState = (reducer, initialState) => {
  const [state, setState] = React.useState<State>(initialState);
  const dispatch = (action: Action) => setState(prevState => reducer(prevState, action));
  return [state, dispatch];
};

// above implementation
const [state, dispatch] = useReducerImplementedByUseState(reducer, initialState);
// is same with
const [state, dispatch] = useReducer(reducer, initialState); 
```

æ€»ä¹‹ï¼Œ

*   å¯¹äºç®€å•çš„å€¼çŠ¶æ€ï¼Œåš`useState`ï¼Œå› ä¸ºå®ƒä½¿ç”¨çš„è¡Œæ•°è¾ƒå°‘ã€‚
*   å¯¹äºå¤æ‚çŠ¶æ€ï¼Œä½¿ç”¨ä½ æ­¤åˆ»å–œæ¬¢çš„ä»»ä½•ä¸€ä¸ªğŸ¤ª

**åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œä½ æ›´å–œæ¬¢`useState`è¿˜æ˜¯`useReducer`ï¼Ÿåœ¨â¤ï¸** ä¸‹é¢çš„è¯„è®ºä¸­åˆ†äº«ä½ çš„æƒ³æ³•