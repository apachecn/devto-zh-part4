# ğŸ’¡ä½¿ç”¨ RESTful é‡æ–°å‘æ˜ GraphQLâ€”â€”åœ¨ 4 åˆ†é’Ÿå†…ä» RESTful çš„è§’åº¦å­¦ä¹  graph QLã€‚

> åŸæ–‡:[https://dev . to/getd/reinvent-graphql-using-restful-learn-graphql-from-the-perspective-of-restful-in-4 mins-3k hk](https://dev.to/getd/reinvent-graphql-using-restful-learn-graphql-from-the-perspective-of-restful-in-4-mins-3khk)

å¯¹äºåˆå­¦è€…æ¥è¯´ï¼ŒGraphQL è¡¨é¢ä¸Šçœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†å®é™…ä¸Šå¹¶ä¸å¤æ‚ã€‚è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†å¦‚ä½•é€šè¿‡åœ¨ RESTful API ä¸­é€æ­¥å‘æ˜ GraphQL çš„æ ¸å¿ƒæ¦‚å¿µæ¥å­¦ä¹ å®ƒä»¬ã€‚

è®©æˆ‘ä»¬å›åˆ° 2014 å¹´ã€‚GraphQL è¿˜ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œæˆ‘ä»¬çš„ AWESOME-REST-API æœåŠ¡å™¨åˆšåˆšä¸Šçº¿äº†ä¸€ä¸ªç®€å•çš„ RESTful APIï¼Œå®ƒé€šè¿‡`id` :
è¿”å›ç”¨æˆ·`name`

```
// A REST API to get user name by user id
GET /user/:id/name
// e.g., get user 123's name
GET /user/123/name
> techbos 
```

æœ‰ä¸€å¤©æˆ‘ä»¬å†³å®šä¹Ÿå½’è¿˜ç”¨æˆ·çš„`age`ã€‚æ‰€ä»¥æˆ‘ä»¬æœ‰ 4 ä¸ªé€‰æ‹©:

*   é€‰é¡¹ A:ä¸º`age`åˆ›å»ºä¸€ä¸ªæ–°ç«¯ç‚¹

```
GET /user/123/age
> 23 
```

*   é€‰é¡¹ B:å°†`age`ä¸`name`åˆå¹¶

```
GET /user/123/nameAndAge
> { "name": "techbos", "age": 23 } 
```

*   é€‰é¡¹ C:è¿”å›æ•´ä¸ª`user`å¯¹è±¡ï¼Œè®©å®¢æˆ·é€‰æ‹©ä»–ä»¬æƒ³è¦çš„å­—æ®µ

```
GET /user/123
> { "name": "techbos", "age": 23, "id": 123, "location": "Seattle", ... } 
```

*   é€‰é¡¹ D:ä½¿ç”¨æŸ¥è¯¢å‚æ•°

```
GET /user/123?fields=name,age
> { "name": "techbos", "age": 23 } 
```

å¾ˆå®¹æ˜“çœ‹å‡ºé€‰é¡¹ Aã€Bã€C æœ‰å…¶é—®é¢˜:

*   é€‰é¡¹ A:è·å–`name`å’Œ`age`éœ€è¦å®¢æˆ·ç«¯å‘å‡ºä¸¤ä¸ª http è¯·æ±‚ã€‚
*   é€‰é¡¹ B:éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰æ•°ç™¾ä¸ªâ€œç»„åˆâ€ç«¯ç‚¹ã€‚
*   é€‰é¡¹ C:å¤§é‡æµªè´¹å¸¦å®½ã€‚

é€‰é¡¹ D ä¼¼ä¹æ˜¯åˆç†çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å†³å®šè¯•ä¸€è¯•ï¼Œå¹¶åœ¨è¿‡ç¨‹ä¸­ä¸æ–­æ”¹è¿›:

# [](#use-a-jsonlike-request-body)ä½¿ç”¨ç±»ä¼¼ JSON çš„è¯·æ±‚ä½“

é¦–å…ˆï¼Œ`?fields=name`å¯¹äºç®€å•çš„å­—æ®µå·¥ä½œè‰¯å¥½ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æœ‰å¯¹è±¡/åµŒå¥—å­—æ®µæ—¶å°±å˜å¾—å¤æ‚äº†ï¼Œä¾‹å¦‚ä¸‹é¢çš„`name`å¯¹è±¡çš„`first`å’Œ`last`:

```
{
  "name": {
    "first": "tech",
    "last": "bos",
  }
} 
```

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç±»ä¼¼ JSON çš„è¯·æ±‚ä½“æ›¿æ¢ url æŸ¥è¯¢å‚æ•°`?fields=`ã€‚æˆ‘ä»¬ä¹Ÿç”¨`POST`ä»£æ›¿`GET`ã€‚

```
// Replace ?fields=name,age with request body
POST /user/123
// JSON-like request body for selecting fields
{
  name {
    first
  }
  age
}
// response
> {
    "name": {
      "first": "tech"
    },
    "age": 23
  } 
```

è¿™ç»™äº†æˆ‘ä»¬ä¸€ç§æ¸…æ™°çš„æ–¹å¼æ¥å‘Šè¯‰æœåŠ¡å™¨è¿”å›å“ªäº›å­—æ®µã€‚å¹²å‡€åˆ©è½ã€‚

# [](#batch-multiple-requests)æ‰¹é‡å¤šä¸ªè¯·æ±‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°æˆ‘ä»¬çš„å®¢æˆ·ç«¯ä»£ç æ€»æ˜¯ä½¿ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„è¯·æ±‚åŒæ—¶è·å–`user`å’Œ`posts`:

```
// Get user 123's first name and age
POST /user/123 { name { first }, age }
// Get user 123's post title and content
POST /posts/user/123 { title, content } 
```

æˆ‘ä»¬å¯ä»¥åªæä¸€ä¸ªè¦æ±‚å—ï¼Ÿå½“ç„¶å¯ä»¥ã€‚æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬åˆå¹¶æˆä¸€ä¸ªå•ç‹¬çš„è¯·æ±‚ä½“ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„ç«¯ç‚¹`/smartql`ï¼Œå®ƒä»£è¡¨â€œæ™ºèƒ½æŸ¥è¯¢è¯­è¨€â€:

```
POST /smartql
// One request body to query for two things
{
  // Replaces /user/123
  user(id: 123) {
    name {
      first
    }
    age
  }
  // Replaces /posts/user/123
  posts(userId: 123) {
    title
    content
  }
}
// response
> {
    "user": {
      "name": {
        "first": "tech"
      },
      "age": 23,
    },
    "notifications": [{
      "title": "Notification 1",
      "content": "Super important",
    }, {
      "title": "Notification 2",
      "content": "Not very important",
    }],
  } 
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­æ‰¹é‡è·å–å¤šä¸ªç«¯ç‚¹ã€‚å¹²å‡€åˆ©è½ã€‚

# [](#make-api-strong-typed)ä½¿ API å¼ºç±»å‹åŒ–

éšç€æˆ‘ä»¬ API çš„å¢é•¿ï¼Œå‰ç«¯å’Œåç«¯å·¥ç¨‹å¸ˆåŒæ­¥ API å˜åŒ–å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚æˆ‘ä»¬çš„ API æ–‡æ¡£ä¼¼ä¹æ€»æ˜¯è¿‡æ—¶ï¼Œä»»ä½• API æ›´æ”¹éƒ½å¾ˆå®¹æ˜“å¯¼è‡´ bugã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†`age`å­—æ®µæ›´æ”¹ä¸º null-ableï¼Œè¿™å¯¼è‡´äº†è®¸å¤šå®¢æˆ·ç«¯å´©æºƒï¼Œå› ä¸ºä»£ç å‡è®¾`age`æ€»æ˜¯æœ‰æ•ˆçš„ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜:

*   é¦–å…ˆï¼Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•°æ®`Schema`å¹¶ä½¿ç”¨å®ƒæ¥ç¡®ä¿è¿›å‡ºæˆ‘ä»¬æœåŠ¡å™¨çš„ä»»ä½•æ•°æ®éƒ½å¿…é¡»éµå¾ªé¢„æœŸçš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª`User`æˆ–`Post`åŒ…å«ä»€ä¹ˆå­—æ®µï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªæ ¹`Query`ç±»å‹æ¥å®šä¹‰å®¢æˆ·ç«¯å¦‚ä½•ä½¿ç”¨`userId`ç­‰å‚æ•°æŸ¥è¯¢æ•°æ®ã€‚

```
# Data type for a user  type  User  {  name:  Name!  # non-null!  age:  Int  # nullable  }  # Data type for a user name  type  Name  {  first:  String  last:  String  }  # Data type for a notification  type  Post  {  title:  String!  content:  String  }  # Root query type for request body  type  Query  {  user(id:  Int!):  User  posts(userId:  Int!):  [Post]  # an array of Posts  } 
```

*   æ¥ä¸‹æ¥ï¼Œåœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„ç±»å‹æ¨¡å¼ä»æœåŠ¡å™¨ä¸‹è½½åˆ°ä¸€ä¸ª`schema.smartql`æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨é™æ€ä»£ç æ£€æŸ¥å·¥å…·å¦‚`TypeScript`æˆ–`Flow`æ¥ç¡®ä¿å®¢æˆ·ç«¯ä»£ç éµå¾ªæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è®¿é—®ç”¨æˆ·çš„`age`è€Œä¸è¿›è¡Œç©ºæ£€æŸ¥ï¼Œæˆ–è€…å¦‚æœæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ä¸º`id`çš„`user`å¯¹è±¡ï¼Œæˆ‘ä»¬å°†ä»ç±»å‹æ£€æŸ¥ä¸­å¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚

æœ‰äº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦ç»´æŠ¤ API æ–‡æ¡£ï¼Œå› ä¸º API æœ¬èº«å˜æˆäº†ä¸€ä¸ªæ´»çš„æ–‡æ¡£ã€‚

æˆ‘ä»¬éƒ½ä¸ºè¿™ä¸ªæ–°çš„`SmartQL`æ„Ÿåˆ°éå¸¸é«˜å…´ã€‚ä¸€å¹´åï¼Œæˆ‘ä»¬å†³å®šç”¨`GraphQL` *çš„åå­—æ¥å¼€æºå®ƒï¼Œå› ä¸ºä¸ºä»€ä¹ˆä¸ç”¨*ã€‚è¿™å°±æ˜¯ GraphQL çš„èµ·æº...

å¼€ç©ç¬‘ğŸ™ƒ

æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ ç†è§£ GraphQL çš„å…³é”®æ¦‚å¿µã€‚æ‚¨å¯ä»¥åœ¨[ä¸­ä½¿ç”¨ä¸Šé¢çš„ GraphQL æŸ¥è¯¢ç¤ºä¾‹ğŸ€getd.io çš„æ¸¸ä¹åœºğŸ€](https://getd.io/workspace?r=%7B%22requestMode%22%3A%22CLOUD%22%2C%22method%22%3A%22POST%22%2C%22url%22%3A%22https%3A%2F%2Fgetd.io%2Fgraphql%22%2C%22params%22%3A%5B%5D%2C%22authorization%22%3A%7B%22type%22%3A%22NONE%22%7D%2C%22headers%22%3A%5B%7B%22isEnabled%22%3Atrue%2C%22key%22%3A%22content-type%22%2C%22value%22%3A%22application%2Fjson%22%7D%5D%2C%22body%22%3A%22%7B%5Cn%20%20%5C%22operationName%5C%22%3Anull%2C%5Cn%20%20%5C%22variables%5C%22%3A%7B%7D%2C%5Cn%20%20%5C%22query%5C%22%3A%5C%22%7B%5C%5Cn%20%20demoUser(id%3A%20123)%20%7B%5C%5Cn%20%20%20%20name%20%7B%5C%5Cn%20%20%20%20%20%20first%5C%5Cn%20%20%20%20%20%20last%5C%5Cn%20%20%20%20%7D%5C%5Cn%20%20%20%20age%5C%5Cn%20%20%20%20posts%20%7B%5C%5Cn%20%20%20%20%20%20title%5C%5Cn%20%20%20%20%20%20content%5C%5Cn%20%20%20%20%7D%5C%5Cn%20%20%7D%5C%5Cn%7D%5C%5Cn%5C%22%5Cn%7D%22%2C%22formData%22%3A%5B%5D%2C%22formUrl%22%3A%5B%5D%2C%22bodyEditorFormat%22%3A%22json%22%2C%22requestBuilderTab%22%3A%22body%22%7D)T3ã€‘

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç‚¹å‡»â¤ï¸å¹¶åœ¨ twitter ä¸Šå…³æ³¨æˆ‘ã€‚