# React è‡ªå®šä¹‰æŒ‚é’©:useEventListener

> åŸæ–‡ï¼š<https://dev.to/adrianbdesigns/custom-react-hooks-useeventlistener-1kp>

è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•æ˜äº†çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å®šåˆ¶é’©å­ã€‚è¿™ä¸ªå®šåˆ¶çš„ React æŒ‚é’©è´Ÿè´£åœ¨ç»„ä»¶æŒ‚è½½æ—¶è®¾ç½®äº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶åˆ é™¤ç›‘å¬å™¨ã€‚

## addEventListener å’Œ removeEventListener

è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹`addEventListener`å’Œ`removeEventListener`å‡½æ•°çš„å®šä¹‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æˆ‘ä»¬éœ€è¦ä¼ é€’ç»™å®šåˆ¶é’©å­ä»€ä¹ˆå‚æ•°ï¼Œä»¥ä½¿å®ƒå¯¹æ‰€æœ‰ç”¨ä¾‹éƒ½æ˜¯çµæ´»çš„ã€‚

```
target.addEventListener(type, listener[, options]);
target.removeEventListener(type, listener[, options]); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»å®šä¹‰ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°éƒ½ä½¿ç”¨äº†ä»¥ä¸‹å‚æ•°:`target`ã€`type`ã€`listener`å’Œ`options`ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å»ºç«‹äº†è¾“å…¥å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ›å»ºæˆ‘ä»¬çš„é’©å­äº†ã€‚

## è‡ªå®šä¹‰æŒ‚é’©

```
import { useEffect } from 'react';

const useEventListener = (target, type, listener, ...options) => {
  React.useEffect(
    () => {
      target.addEventListener(type, listener, ...options);
      return () => {
        target.removeEventListener(type, listener, ...options);
      };
    },
    [target, type, listener, options]
  );
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä½¿ç”¨`useEffect` React é’©å­æ¥å¤„ç†ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶å‘ç”Ÿçš„äº‹æƒ…ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº`useEffect` hook çš„ä¿¡æ¯ï¼Œæˆ‘åœ¨è¿™é‡Œå·²ç»è¯¦ç»†ä»‹ç»è¿‡äº†:

[![adrianbdesigns image](img/46b991310ae299c1939838211aac489a.png)](/adrianbdesigns) [## ååº”:ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è§£é‡Šä½¿ç”¨æ•ˆæœ

### é˜¿å¾·é‡Œå®‰Â·è´æ–¯ 1919 å¹´ 8 æœˆ 5 æ—¥ 2 åˆ†é’Ÿé˜…è¯»

#react #webdev #javascript](/prototyp/react-useeffect-explained-with-lifecycle-methods-296n)

è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•åœ¨å¦ä¸€ä¸ªç»„ä»¶ä¸­å¯åŠ¨é’©å­(ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ­£åœ¨ç›‘å¬çª—å£è°ƒæ•´å¤§å°äº‹ä»¶)ã€‚

```
useEventListener(window, 'resize', handleWindowResize); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæˆ‘ä»¬ä¼ é€’ä¸€ä¸ª`document`æˆ–`window`æˆ–å¯¹è±¡ï¼Œè¿™ä¸ªé’©å­å¾ˆå¥½ç”¨ã€‚å¦‚æœè¿™æ˜¯æˆ‘ä»¬å®šåˆ¶é’©å­çš„ç”¨ä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©å®ƒä¿æŒåŸæ ·ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æ‰“ç®—ä¼ é€’ refsï¼Œè¿™ä¸ªå®šåˆ¶é’©å­éœ€è¦åšä¸€äº›å°çš„ä¿®æ”¹ï¼Œä»¥ä¾¿ä¹Ÿèƒ½å¤„ç† refsã€‚

### æ·»åŠ å‚ç…§åŠŸèƒ½

```
import { useEffect } from 'react';

const useEventListener = (target, type, listener, ...options) => {
  React.useEffect(
    () => {
      const targetIsRef = target.hasOwnProperty("current");
      const currentTarget = targetIsRef ? target.current : target;
      if (currentTarget)
        currentTarget.addEventListener(type, listener, ...options);
      return () => {
        if (currentTarget)
          currentTarget.removeEventListener(type, listener, ...options);
      };
    },
    [target, type, listener, options]
  );
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`useEffect`é’©å­ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¼ é€’çš„ç›®æ ‡æ˜¯ ref è¿˜æ˜¯`window`æˆ–è€…`document`å…ƒç´ ã€‚

è¿™å°±æ˜¯æˆ‘ä»¬åˆå§‹åŒ–é’©å­çš„æ–¹æ³•(æˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€ä¸ªç»„ä»¶ä¸­åˆå§‹åŒ–ä»»æ„å¤šçš„ç›‘å¬å™¨):

```
// Window resize listener
useEventListener(window, 'resize', handleWindowResize);

// You can also pass refs
const elementRef = useRef(null);
useEventListener(elementRef, 'mousedown', handleElementClick); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## Codepen ç¤ºä¾‹

[https://codepen.io/AdrianBece/embed/pozGGdE?height=600&default-tab=result&embed-version=2](https://codepen.io/AdrianBece/embed/pozGGdE?height=600&default-tab=result&embed-version=2)

* * *

æ„Ÿè°¢ä½ èŠ±æ—¶é—´é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚å¦‚æœä½ è§‰å¾—è¿™å¾ˆæœ‰ç”¨ï¼Œè¯·ç»™å®ƒä¸€ä¸ªâ¤ï¸æˆ–ğŸ¦„ï¼Œåˆ†äº«è¯„è®ºã€‚