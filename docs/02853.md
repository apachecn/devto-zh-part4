# ç”¨ Node.js ä¸­çš„ SendGrid å’Œ Mailgen å‘é€ç”µå­é‚®ä»¶

> åŸæ–‡:[https://dev . to/nedsoft/send-email-with-send grid-and-mailgen-in-node-js-55 C4](https://dev.to/nedsoft/send-email-with-sendgrid-and-mailgen-in-node-js-55c4)

æˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­å‘é€ç”µå­é‚®ä»¶ã€‚æƒ³åˆ°çš„ç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯ [Nodemailer](https://nodemailer.com/about/) ã€‚Nodemailer æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œåªæ˜¯ç”±äºè°·æ­Œçš„å®‰å…¨æ£€æŸ¥ï¼Œæœ‰æ—¶å¾ˆéš¾è®©å®ƒä¸ Gmail SMTP ä¸€èµ·å·¥ä½œã€‚*è¿™å¯èƒ½åªæ˜¯æˆ‘è‡ªå·±çš„çœ‹æ³•å’Œç»éªŒ*ã€‚

[SendGrid](https://www.npmjs.com/package/@sendgrid/mail) æ˜¯ Node.js ä¸­å‘é€é‚®ä»¶çš„å¦ä¸€ä¸ªé€‰é¡¹ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œç”¨ SendGrid å‘é€é‚®ä»¶æ˜¯éå¸¸æ— ç¼çš„ã€‚è™½ç„¶è¿™é¡¹æœåŠ¡ä¸æ˜¯å®Œå…¨å…è´¹çš„ï¼Œä½†å®ƒå…è®¸æ¯å¤©å…è´¹å‘é€å¤šè¾¾ 100 å°ç”µå­é‚®ä»¶ã€‚

å‘é€ç”µå­é‚®ä»¶çš„å¦ä¸€ä»¶é‡è¦äº‹æƒ…æ˜¯ç”Ÿæˆç¬¦åˆç”µå­é‚®ä»¶æ¨¡æ¿æ ‡å‡†çš„ç”µå­é‚®ä»¶æ¨¡æ¿ï¼Œç¡®ä¿å®ƒåœ¨ä¸åŒçš„ç”µå­é‚®ä»¶å®¢æˆ·ç«¯(å¦‚ Gmailã€Yahoomail ç­‰)ä¸Šæ­£ç¡®å‘ˆç°ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªåä¸º [Mailgen](https://www.npmjs.com/package/mailgen) çš„ npm åŒ…ï¼Œå®ƒåŸºäºä¸€äº›å¼€ç®±å³ç”¨çš„é…ç½®ç”Ÿæˆä¸€ä¸ªæ¼‚äº®çš„æ ‡å‡†ç”µå­é‚®ä»¶æ¨¡æ¿ã€‚

### [](#requirements)è¦æ±‚

*   SendGrid API å¯†é’¥-è¦ç”Ÿæˆ SendGrid API å¯†é’¥ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤:
    *   è®¿é—® [SendGrid](https://sendgrid.com) åˆ›å»ºè´¦æˆ·
    *   ç™»å½•åˆ°åˆ›å»ºçš„å¸æˆ·
    *   ç‚¹å‡»å·¦ä¾§å·¥å…·æ¡ä¸Šçš„[è®¾ç½®](https://app.sendgrid.com/settings/api_keys)
    *   ç‚¹å‡»`Create API Key`æŒ‰é’®ä¸Šçš„åˆ›å»ºæ¥åˆ›å»ºä¸€ä¸ª API å¯†é’¥ã€‚
*   èŠ‚ç‚¹/å¿«é€Ÿåº”ç”¨ç¨‹åºã€‚

### [](#getting-started)å…¥é—¨

æ¥ä¸‹æ¥ï¼Œåœ¨è¿™é‡Œå…‹éš†æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„é¡¹ç›®[ã€‚](https://github.com/oriechinedu/sendgrid-mailgen-email-node)

### [](#step-1-setup-express-project)æ­¥éª¤ 1 -è®¾ç½®å¿«é€’é¡¹ç›®

åˆ›å»ºä¸€ä¸ªåä¸º`sendgrid-email`çš„æ–°ç›®å½•ã€‚

```
mkdir sendgrid-email && cd sendgrid-email 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œåœ¨æ‚¨å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ‰“å¼€é¡¹ç›®å¹¶å®‰è£…ä»¥ä¸‹ä¾èµ–é¡¹:

```
npm i express dotenv mailgen @sendgrid/mail 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º`index.js`çš„æ–‡ä»¶ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶åˆ°å…¶ä¸­:

```
const express = require('express')
const sendMail = require('./mail')
const app = express()

app.use(express.json())

app.get('/', (req, res) => res.send('Hello world!!!'))

app.get('/sendMail', async (req, res) => {
  try {
    const sent = await sendMail()
    if (sent) {
      res.send({ message: 'email sent successfully' })
    }
  } catch (error) {
    throw new Error(error.message)
  }
})

app.listen(3300, () => {
  console.log('server listening at http://localhost:3300')
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

***æ³¨æ„:**æˆ‘ä»¬å…³å¿ƒçš„æ˜¯å»ºç«‹ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨æ¥æ¼”ç¤ºæœ¬æ–‡ä¸­çš„æ¦‚å¿µï¼Œå› æ­¤ä¸å…³æ³¨æœ€ä½³å®è·µã€‚ğŸ™‚*

æŸ¥çœ‹ä¸Šé¢çš„ä»£ç ç‰‡æ®µï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªè·¯ç”±`/sendMail`ï¼Œå®ƒè°ƒç”¨ä»`mail.js`å¯¼å…¥çš„å‡½æ•°`sendMail()`ã€‚è®©æˆ‘ä»¬æ¥åˆ›å»º`mail.js`çš„å†…å®¹ã€‚

### [](#step-2-generate-email-template-with-mailgen)æ­¥éª¤ 2 -ä½¿ç”¨ Mailgen ç”Ÿæˆç”µå­é‚®ä»¶æ¨¡æ¿

åˆ›å»ºä¸€ä¸ªåä¸º`mail.js`çš„æ–‡ä»¶ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶åˆ°å…¶ä¸­:

```
const MailGen = require('mailgen')
const sgMail = require('@sendgrid/mail')

require('dotenv').config()

const mailGenerator = new MailGen({
  theme: 'salted',
  product: {
    name: 'Awesome App',
    link: 'http://example.com',
    // logo: your app logo url
  },
})

const email = {
  body: {
    name: 'Jon Doe',
    intro: 'Welcome to email verification',
    action: {
      instructions: 'Please click the button below to verify your account',
      button: {
        color: '#33b5e5',
        text: 'Verify account',
        link: 'http://example.com/verify_account',
      },
    },
  },
}

const emailTemplate = mailGenerator.generate(email)
require('fs').writeFileSync('preview.html', emailTemplate, 'utf8') 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯¼å…¥äº†`Mailgen`æ¨¡å—ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªåä¸º`mailGenerator`çš„å®ä¾‹ã€‚é‚®ä»¶ç”Ÿæˆå™¨é‡‡ç”¨ä¸»é¢˜ï¼Œæœ‰å‡ ä¸ª[ä¸»é¢˜](https://www.npmjs.com/package/mailgen#more-examples)å¯ä¾›é€‰æ‹©ã€‚`product`å¯¹è±¡æ¥å—`name`ï¼Œå®ƒæ˜¯ä½ çš„åº”ç”¨ç¨‹åºçš„åå­—ï¼Œ`link`æ˜¯åº”ç”¨ç¨‹åºçš„ URLï¼Œè¿˜æœ‰`logo`ï¼Œå®ƒæ¥å—ä½ çš„åº”ç”¨ç¨‹åºæ ‡å¿—çš„ URLã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é…ç½®äº†ç”µå­é‚®ä»¶æ­£æ–‡ï¼Œç„¶åç”Ÿæˆäº†ç”µå­é‚®ä»¶æ¨¡æ¿ã€‚æœ‰å…³å¦‚ä½•é…ç½®ç”µå­é‚®ä»¶æ­£æ–‡çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ [Mailgen æ–‡æ¡£](https://www.npmjs.com/package/mailgen)ã€‚è¿™ä¸€è¡Œ`require('fs').writeFileSync('preview.html', emailTemplate, 'utf8')`æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä½ æƒ³é¢„è§ˆç”± Mailgen ç”Ÿæˆçš„ HTML æ–‡ä»¶ï¼Œä½ å¯ä»¥æ·»åŠ å®ƒã€‚

### [](#step-3-send-email-using-sendgrid)æ­¥éª¤ 3 -ä½¿ç”¨ SendGrid å‘é€ç”µå­é‚®ä»¶

å°†æ‚¨ä¹‹å‰åˆ›å»ºçš„ API å¯†é’¥å¤åˆ¶åˆ°`.env`ä¸­ï¼Œæ£€æŸ¥`.env.example`ä»¥è·å¾—æŒ‡å¯¼ã€‚
æ¥ä¸‹æ¥ï¼Œå°†ä¸‹é¢çš„ç‰‡æ®µå¤åˆ¶åˆ°`mail.js` :

```
const msg = {
  to: 'your-email@example.com',
  from: 'test@example.com',
  subject: 'Test verification email',
  html: emailTemplate,
}

const sendMail = async () => {
  try {
    sgMail.setApiKey(process.env.SENDGRID_API_KEY)
    return sgMail.send(msg)
  } catch (error) {
    throw new Error(error.message)
  }
}

module.exports = sendMail 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­£å¦‚ä½ åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼Œè®¾ç½® SendGrid éå¸¸ç®€å•ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯åƒä¸Šé¢æ˜¾ç¤ºçš„é‚£æ ·ä¼ é€’ API é”®ï¼Œç„¶åæ„é€ æ¶ˆæ¯å¹¶å‘é€ã€‚æˆ‘ä»¬å°†ä¹‹å‰ç”Ÿæˆçš„`emailTemplate`ä¼ é€’ç»™äº† SendGrid `msg`ã€‚

æŸ¥çœ‹ [@sendgrid/mail docs](https://www.npmjs.com/package/@sendgrid/mail) äº†è§£æ›´å¤šå…³äºå¦‚ä½•é…ç½®çš„ä¿¡æ¯ã€‚

å°±æ˜¯è¿™æ ·ï¼ç°åœ¨å¯åŠ¨æœåŠ¡å™¨ï¼Œå‰å¾€ Postmanï¼Œç‚¹å‡»`/sendMail`è·¯çº¿ã€‚
å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨ä¼šæ”¶åˆ°ä¸€å°å¦‚ä¸‹æ‰€ç¤ºçš„ç”µå­é‚®ä»¶:

[![Image showing the email sent](img/fe98ae5e5e5f9de2bd55fb2ee0647f66.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--5tpaB2yY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/4c9go3u6n49eyot4dgrn.png) ã€‚

æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡åœ¨æµè§ˆå™¨ä¸Šæ‰“å¼€`preview.html`æ¥é¢„è§ˆç”µå­é‚®ä»¶æ¨¡æ¿ã€‚

### [](#conclusion)ç»“è®º

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Mailgen åˆ›å»ºæ¼‚äº®çš„ç”µå­é‚®ä»¶æ¨¡æ¿ï¼Œå¹¶ä½¿ç”¨ SendGrid å‘é€é‚®ä»¶ã€‚ä¸ºäº†ä¿æŒç®€å•ï¼Œæˆ‘ä»¬åœ¨`mail.js`ä¸­å®ç°äº†æ‰€æœ‰ä¸œè¥¿ï¼Œå®é™…ä¸Šï¼Œä½ å¯èƒ½æƒ³æŠŠå®ƒåˆ†æˆå¯é‡ç”¨çš„æ¨¡å—ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåŸºäºæŸäº›å‚æ•°ç”Ÿæˆç”µå­é‚®ä»¶æ¨¡æ¿çš„å‡½æ•°ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥åœ¨æ¯æ¬¡æƒ³è¦å‘é€ç”µå­é‚®ä»¶æ—¶è½»æ¾åœ°è°ƒç”¨å®ƒã€‚

è®©æˆ‘çŸ¥é“ä½ æ˜¯å¦æœ‰ä»»ä½•é—®é¢˜æˆ–è´¡çŒ®ã€‚æˆ‘æ„¿æ„è®¨è®ºã€‚éšæ—¶è”ç³»æˆ‘ã€‚

*[æœ¬æ–‡æœ€åˆå‘è¡¨äºæˆ‘çš„åšå®¢](https://www.oriechinedu.com/posts/send-email-with-sendgrid-and-mailgen-in-nodejs/)*