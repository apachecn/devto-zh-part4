# ä¸‹è½½åƒğŸ—œï¸è¿™æ ·çš„åº”ç”¨ç¨‹åº

> åŸæ–‡:[https://dev.to/samthor/pwas-that-download-like-apps-fd6](https://dev.to/samthor/pwas-that-download-like-apps-fd6)

è¿™æ˜¯ä»Šå¤©çš„ä¸€ç¯‡çŸ­æ–‡ã€‚(é€šè¿‡å†™é‚£ä¸ªï¼Œä¼šè®©å®ƒæˆçœŸçš„ï¼)å®ƒä¹Ÿæ›´åƒæ˜¯ä¸€ç¯‡ç®€çŸ­çš„å¼€å‘è€…æ—¥å¿—ï¼Œè€Œä¸æ˜¯æœ‰ä¸€ä¸ªç‰¹å®šçš„ç‚¹ğŸ˜Œ

æ¸è¿›å¼ç½‘ç»œåº”ç”¨æ˜¯å½“ä»Šæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒçš„ä¸œè¥¿ã€‚é€šè¿‡é˜…è¯»è¿™ä¸ªç½‘ç«™ï¼Œä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ª:å¦‚æœä½ æ–­å¼€äº’è”ç½‘è¿æ¥ï¼Œä½†åŠ è½½ [dev.to](https://dev.to) ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªå¯çˆ±çš„ç¦»çº¿é¡µé¢ï¼Œä½ å¯ä»¥åœ¨é‚£é‡Œæ¶‚é¸¦ã€‚ğŸ–Œï¸ğŸ¨ğŸŠ

ä¸ºäº†æ„å»ºæœåŠ¡å·¥ä½œè€…ï¼ŒPWA çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæ‚¨å¯èƒ½æƒ³è¦ä½¿ç”¨[å·¥å…·ç®±](https://developers.google.com/web/tools/workbox/)ã€‚ä½†æ˜¯å¦‚æœ..ä½ ä¸çŸ¥é“å—ï¼ŸğŸ¤”

# [](#sams-patented-web-install-model)å±±å§†çš„ Patented^ç½‘ç«™å®‰è£…æ¨¡å¼

æˆ‘å°†åˆ›å»ºä¸€ä¸ªå‡ ä¹ç©ºæ— ä¸€ç‰©çš„ç½‘ç«™æ¥â€œå®‰è£…â€å®Œæ•´çš„ä½“éªŒï¼Œè€Œä¸æ˜¯ä½ é€šå¸¸ä½¿ç”¨çš„ PWA æ–¹æ³•â€”â€”ç¼–å†™ä¸€äº›é¡µé¢å’Œèµ„æºï¼Œç¼–å†™ä¸€ä¸ª SWï¼Œç„¶å*ç¼“å­˜*è¿™äº›ç›¸åŒçš„é¡µé¢å’Œèµ„æºã€‚

è¿™ç§å®Œæ•´çš„ä½“éªŒå®é™…ä¸Šå°†æ˜¯ä¸€ä¸ªå­˜æ”¾åœ¨å…¶ä»–åœ°æ–¹çš„`.tar`æ–‡ä»¶ã€‚æˆ‘ä»¬æ¥å®‰è£…å§ï¼ğŸ”œğŸ–¥ï¸

## [](#create-an-actual-site)åˆ›å»ºä¸€ä¸ªå®é™…ç«™ç‚¹

æ‰€ä»¥ï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦ä¸€ä¸ªçœŸæ­£çš„ç½‘ç«™ã€‚åˆ›å»ºä¸€ä¸ªåä¸º`app.tar`çš„æ–‡ä»¶ï¼ŒåŒ…å«å®ƒçš„èµ„æº:`index.html`ã€æ ·å¼ç­‰ã€‚

## [](#register-sw)å¯„å­˜å™¨è½¯ä»¶

åœ¨æˆ‘ä»¬çš„å‰å°é¡µé¢`index.html`ä¸­ï¼Œæˆ‘ä»¬åƒå¹³å¸¸ä¸€æ ·æ³¨å†Œæˆ‘ä»¬çš„è½¯ä»¶:

```
<script>
if (!('serviceWorker' in navigator)) {
  throw new Error('unsupported');
}
navigator.serviceWorker.register('/sw.js').then((reg) => {
  console.info('registered');
  // TODO
});
</script> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬åªéœ€è¦è¿™ä¸ªæ–‡ä»¶å’Œä¸‹é¢çš„`sw.js`æ˜¯ç”± HTTP æœåŠ¡å™¨æœåŠ¡çš„*çœŸæ­£çš„*ã€‚

## [](#install-handler)å®‰è£…å¤„ç†å™¨

åœ¨`sw.js`é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åš:

```
self.addEventListener('install', (ev) => {
  const p = (async() => {
    const response = await fetch('app.tar');
    const buffer = await response.arrayBuffer();

    const cache = await caches.open('app');
    const ops = [];
    untar(buffer, (file) => {
      if (file.name.endsWith('/')) {
        return;  // directory, ignore
      }
      const p = cache.put(file.name, new Response(file.buffer));
      ops.push(p);
    });
    await Promise.all(ops);
    // untar is a modified version of https://github.com/InvokIT/js-untar
  })();
  ev.waitUntil(p);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¤ªå¥½äº†ï¼æˆ‘ä»¬ç°åœ¨å·²ç»ä¸‹è½½äº†`app.tar`å¹¶å°†å…¶å†…å®¹å®‰è£…åˆ°æˆ‘ä»¬çš„ç¼“å­˜ä¸­ã€‚å®ƒå¯ä»¥åŒ…å«æˆ‘ä»¬å–œæ¬¢çš„ä»»ä½•å†…å®¹ï¼Œå¹¶ä¸”ä¸éœ€è¦æ˜ å°„åˆ°ä½ *å®é™…ä¸Š*é€šè¿‡ HTTP æä¾›çš„æ–‡ä»¶ã€‚

## [](#fetch-handler)è·å–å¤„ç†ç¨‹åº

æˆ‘å·®ç‚¹å¿˜äº†ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨`sw.js` :
ä¸­çš„æ ·æ¿æ–‡ä»¶ä»ç¼“å­˜ä¸­æä¾›æœåŠ¡

```
self.addEventListener('fetch', (ev) => {
  const p = (async() => {
    // TODO: make requests for '/index.html' match '/'
    const response = await caches.match(ev.request, {ignoreSearch: true});
    return response || fetch(ev.request);
  })();
  ev.respondWith(p);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

(è¿™å¯¹äºå‡ ä¹æ‰€æœ‰æœ‰è½¯ä»¶çš„ç«™ç‚¹æ¥è¯´éƒ½æ˜¯ä¸€æ ·çš„ã€‚)

# [](#dont-try-this-at-home)ä¸è¦åœ¨å®¶é‡Œå°è¯•è¿™ä¸ª

è¿™ä¸»è¦æ˜¯ä¸€ä¸ªå®éªŒï¼Œçœ‹çœ‹ä»ä¸€ä¸ª`.tar`æ–‡ä»¶å®‰è£…ä¸€ä¸ªç½‘ç«™æ˜¯å¦å¯è¡Œã€‚æ˜¯çš„ï¼Œå®ƒæ˜¯ï¼ç°åœ¨ä½ ä¹Ÿå¯ä»¥åœ¨ç½‘ä¸Šäº«å—å®‰è£…åº”ç”¨ç¨‹åºçš„å®Œæ•´ä½“éªŒäº†ã€‚ğŸ™„

è¿™é‡Œæœ‰ä¸€ä¸ªæ¼”ç¤ºï¼

Twelve