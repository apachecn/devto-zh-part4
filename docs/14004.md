# å¦‚ä½•åè®®ç¼“å†²è“ç‰™ä½èƒ½è€—æœåŠ¡ç¬¬ 3 éƒ¨åˆ†

> åŸæ–‡:[https://dev . to/jaredwolff/how-to-protocol-buffer-bluetooth-low-energy-service-part-3-2d5p](https://dev.to/jaredwolff/how-to-protocol-buffer-bluetooth-low-energy-service-part-3-2d5p)

åœ¨ç¬¬ 1 éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†åè®®ç¼“å†²åŒºçš„ç»“æ„ã€‚åœ¨[ç¬¬äºŒéƒ¨åˆ†](https://www.jaredwolff.com/how-to-protocol-buffer-bluetooth-low-energy-service-part-2)ä¸­ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†è“ç‰™ä½èƒ½è€—æœåŠ¡æ˜¯å¦‚ä½•åœ¨ Nordic NRF52 SDK ä¸Šæ‹¼å‡‘èµ·æ¥çš„ã€‚è¿™æœ€åä¸€ç¯‡æ–‡ç« æ±‡é›†äº†ç«¯åˆ°ç«¯å·¥ä½œç¤ºä¾‹ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚

æˆ‘ä»¬èµ°å§ï¼

## [](#setting-everything-up)è®¾ç½®å¥½ä¸€åˆ‡

[![Goose attack](../Images/76270a268f3e34d07beb843e09e8ade2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--XloAbQwe--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-protocol-buffer-bluetooth-low-energy-service-part-3/images/Untitled-6880beab-c5c2-4184-9012-4a6e68bcebc8.png)

å»çœ‹çœ‹æ¯ä¸ªç¤ºä¾‹å­˜å‚¨åº“ä¸­çš„`Readme.md`ã€‚(ä½ å°†ä¸å¾—ä¸å…‹éš†è¿™äº›åº“ï¼Œ[åœ¨è¿™é‡Œæ³¨å†Œä»¥è·å¾—ä»£ç ](https://www.jaredwolff.com/files/protobuf))ã€‚

æˆ‘å·²ç»ä½¿å›ºä»¶çš„è®¾ç½®éå¸¸ç®€å•ã€‚å¯¹äº javascript æ¥è¯´ï¼Œè¿™æœ‰ç‚¹éº»çƒ¦ï¼Œä½†å´æ˜¯å¯è¡Œçš„ï¼æˆ‘è¿˜å°†åœ¨è¿™é‡ŒåŒ…æ‹¬è¯´æ˜:

### [](#firmware-setup-for-mac)å›ºä»¶è®¾ç½®(ç”¨äº Mac)

1.  åˆå§‹åŒ–å®Œæ•´çš„å­˜å‚¨åº“(æœ‰å­æ¨¡å—ï¼):`git submodule update --init`
2.  ä½¿ç”¨è‡ªåˆ¶è½¯ä»¶å®‰è£…`protoc`:`brew install protobuf`
3.  è¿è¡Œ`make sdk`ã€‚è¿™å°†ä¸‹è½½æ‚¨çš„ SDK æ–‡ä»¶ã€‚
4.  è¿è¡Œ`make tools_osx`ã€‚è¿™å°†ä¸‹è½½æ‚¨çš„ ARMGCC å·¥å…·é“¾(ç”¨äº Mac)ã€‚å¯¹äºå…¶ä»–ç¯å¢ƒï¼Œè¯·å‚è§ä¸‹æ–‡ã€‚
5.  è¿è¡Œ`make gen_key`ä¸€æ¬¡(å¹¶ä¸”åªèƒ½è¿è¡Œä¸€æ¬¡)ï¼è¿™å°†ä¸º DFU è®¾ç½®æ‚¨çš„å¯†é’¥ã€‚
6.  è¿è¡Œ`make`ï¼Œè¿™å°†æ„å»ºä½ çš„å¼•å¯¼ç¨‹åºå’Œä¸»åº”ç”¨ç¨‹åºã€‚

**æ³¨æ„:**æ­¥éª¤ 1-5 åªéœ€åšä¸€æ¬¡ã€‚

### [](#javascript-app-setup-for-mac)Javascript åº”ç”¨è®¾ç½®(é€‚ç”¨äº Mac)

**å…ˆå†³æ¡ä»¶:**ä½ å°†éœ€è¦ Xcode å‘½ä»¤è¡Œå·¥å…·ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°é‚£äº›ã€‚

1.  å°†æ­¤å›è´­å…‹éš†åˆ°æ‚¨è®¡ç®—æœºä¸Šçš„æŸä¸ªä½ç½®
2.  ç¡®ä¿æ‚¨å·²ç»å®‰è£…äº†[nvm](https://github.com/nvm-sh/nvm/blob/master/README.md)
3.  è¿è¡Œ`nvm install v8.0.0`
4.  è¿è¡Œ`nvm install v10.15.3`
5.  è¿è¡Œ`nvm use v8.0.0`
6.  è¿è¡Œ`yarn`(å¦‚æœæ²¡æœ‰çº±çº¿`npm install yarn -g`)
7.  å®‰è£…åï¼Œè¿è¡Œ`nvm use v10.15.3`
8.  ç„¶åè¿è¡Œ`node index.js`å¼€å§‹è¿™ä¸ªä¾‹å­

ä½¿ç”¨ NVM æœ‰åŠ©äºç¼“è§£è“ç‰™åº“çš„ç¼–è¯‘é—®é¢˜ã€‚ä½ çš„é‡Œç¨‹å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚

## è¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œåè®®ç¼“å†²åŒºæœ‰ä¸¤ä¸ªåŠŸèƒ½ã€‚ç¬¬ä¸€ä¸ªä½œä¸ºå¯¹è“ç‰™è®¾å¤‡çš„â€œå‘½ä»¤â€ã€‚å…¶æ¬¡ï¼Œæ¥è‡ªè®¾å¤‡å¯¹å‘½ä»¤çš„â€œå“åº”â€ã€‚

æˆ‘ä»¬çš„ç¤ºä¾‹ javascript åº”ç”¨ç¨‹åºå‘½ä»¤ä½¿ç”¨â€œThis isâ€ä½œä¸ºæœ‰æ•ˆè´Ÿè½½ã€‚å€ŸåŠ©ä¸€äº›å­—ç¬¦ä¸²è¿ç®—çš„åŠ›é‡ï¼Œè®©æˆ‘ä»¬ç”¨å®ƒæ¥é€ ä¸€ä¸ªå®Œæ•´çš„å¥å­å§ï¼

è¿™ä¸€ç³»åˆ—äº‹ä»¶çœ‹èµ·æ¥åƒè¿™æ ·:

1.  æµ‹è¯•åº”ç”¨ç¨‹åºä½¿ç”¨æˆ‘ä»¬çš„è“ç‰™ä½èƒ½è€—æœåŠ¡è¿æ¥å¹¶å‘é€æ•°æ®ã€‚
2.  åœ¨å›ºä»¶ä¸Šè§£ç æ¶ˆæ¯ã€‚
3.  å›ºä»¶é€šè¿‡æ·»åŠ â€œcoolâ€æ¥ä¿®æ”¹åŸå§‹æ•°æ®ã€‚ç»“æœæ˜¯â€œè¿™å¾ˆé…·â€
4.  å›ºä»¶å¯¹æœ‰æ•ˆè½½è·è¿›è¡Œç¼–ç ï¼Œå¹¶ä½¿æ•°æ®å¯ä¾›è¯»å–ã€‚
5.  åº”ç”¨ç¨‹åºæœ€ç»ˆè¯»å–ç‰¹å¾ï¼Œè§£ç å¹¶æ˜¾ç¤ºç»“æœï¼

çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›å¥½å¤„:

1.  åœ¨åè®®ç¼“å†²åŒºä¸­ï¼Œæ•°æ®ç»“æ„è¢«å¾ˆå¥½åœ°å®šä¹‰ã€‚è¿™æ„å‘³ç€å®ƒæœ‰ä¸€äº›å¼ºå¤§çš„é”™è¯¯æ£€æŸ¥èƒ½åŠ›ã€‚å¦‚æœæ‚¨ä½¿ç”¨ä»»ä½•ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œæ‚¨å¯èƒ½éœ€è¦ç¼–å†™è‡ªå·±çš„æ•°æ®éªŒè¯ä»£ç ã€‚
2.  ç¼–ç å’Œè§£ç ç®€å•æ˜äº†ã€‚æ‚¨å¯ä»¥åœ¨ä¸åŒçš„å¹³å°ä¸Šå¯¹ç›¸åŒçš„æ•°æ®è¿›è¡Œç¼–ç ï¼Œå¹¶æ€»æ˜¯å¾—åˆ°ç›¸åŒçš„è§£ç ç»“æœã€‚

æƒ³è®©ç¤ºä¾‹è¿è¡Œèµ·æ¥å—ï¼Ÿæ¯•ç«Ÿæ˜¯çœ¼è§ä¸ºå®ã€‚æˆ‘ä»¬å¼€å§‹å§ã€‚

## [](#is-this-thing-on)è¿™ä¸œè¥¿å¼€ç€å—ï¼Ÿ

[![Phone in hand running NRF connect](../Images/8f92539760b3c8c2592afb1eb6b84aab.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--yCsMbL1k--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-protocol-buffer-bluetooth-low-energy-service-part-3/images/Untitled-c72fcf71-f0db-49e5-92d7-44fe601e75fa.png)

ä¸€æ—¦ä½ å®Œæˆäº†è®¾ç½®(å¦‚ä¸Š)ï¼Œè®©æˆ‘ä»¬æ¥ç»™è¿™ä¸ªå›ºä»¶ç¼–ç¨‹å§ï¼ä½ çœŸå¹¸è¿ï¼Œåªæœ‰ä¸¤æ­¥è·¯ã€‚

1.  æ’å…¥ NRF52 DK æ¿
2.  è¿è¡Œ`make flash_all`ã€‚(è¿™å°†ç¼–è¯‘å¹¶åˆ·æ–°*é¡¹ç›®çš„æ‰€æœ‰*ä»£ç ã€‚)

ä¸€æ—¦é—ªçƒï¼Œæœ€å®¹æ˜“çŸ¥é“äº‹æƒ…æ˜¯å¦å·¥ä½œçš„æ–¹æ³•æ˜¯å½“ Led 1 é—ªçƒã€‚è¿™æ„å‘³ç€å®ƒæ˜¯å¹¿å‘Šï¼Œå¹¶å‡†å¤‡è¿æ¥ã€‚

[![NRF52 DK](../Images/5efe8bb5b9dcd2703c75878c01284119.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--FqrhJgP4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-protocol-buffer-bluetooth-low-energy-service-part-3/images/Untitled-6c58e8c5-d005-4b61-a32b-29eea61b1ce7.png)

è®©æˆ‘ä»¬ç¡®ä¿å®ƒæ˜¯æ­£ç¡®çš„å¹¿å‘Šã€‚ä½ å¯ä»¥åœ¨ iOS æˆ– Android ä¸Šä½¿ç”¨ NRF è¿æ¥è¿™æ ·çš„å·¥å…·ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥é€‰æ‹©æµ…è“è‰²ã€‚(ä¹Ÿé€‚ç”¨äº [iOS](https://apps.apple.com/ru/app/lightblue-explorer/id557428110?l=en) å’Œ Android)

æ‰“å¼€å…¶ä¸­ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæ‰«æå¹¿å‘Šè®¾å¤‡ã€‚ä½ è¦æ‰¾çš„æ˜¯ **Nordic_Buttonless** ã€‚

[![BLE Apps scanning](../Images/bd8d2b669e549461c04663fcbe842980.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--GHD41Xl_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-protocol-buffer-bluetooth-low-energy-service-part-3/images/Untitled-062f5e84-ec22-4525-a591-4330a55fe30f.png)

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿æ¥å¹¶ä»”ç»†æ£€æŸ¥æˆ‘ä»¬çš„å¯è¿æ¥æœåŠ¡å’Œç‰¹å¾:

[![BLE Apps showing services](../Images/b580d431eff7171d93dd5415bc0499fc.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Ja73T_Aj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-protocol-buffer-bluetooth-low-energy-service-part-3/images/Untitled-0466566a-1d8a-4e8b-a1c9-f2f76faa116b.png)

å¦‚æ‚¨æ‰€è§ï¼Œæœ‰ä¸¤ç§æœåŠ¡ã€‚ä¸€ä¸ªæ˜¯åŒ—æ¬§èˆªç©ºçš„ DFU æœåŠ¡ã€‚å¦ä¸€ä¸ªæ˜¯æˆ‘ä»¬çš„åè®®ç¼“å†²æœåŠ¡ï¼

å¯ä»¥å°†`ble_protobuf.h`ä¸­çš„`PROTOBUF_UUID_BASE`ä¸â€œæœªçŸ¥æœåŠ¡â€çš„ UUID è¿›è¡Œæ¯”è¾ƒã€‚Nordic çš„èŠ¯ç‰‡æ˜¯å°ç«¯æ ¼å¼ï¼Œè€Œè¿™é‡Œçš„æ•°æ®æ˜¯å¤§ç«¯æ ¼å¼ã€‚(ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨å¿…é¡»åè½¬å­—èŠ‚æ‰èƒ½çœ‹åˆ°å®ƒä»¬æ˜¯ç›¸åŒçš„ï¼)

ä½ ç”šè‡³å¯ä»¥è¿›ä¸€æ­¥ç‚¹å‡»æŸ¥çœ‹ NRF è¿æ¥çš„ç‰¹å¾ã€‚åœ¨æµ…è“è‰²çš„ä¾‹å­ä¸­ï¼Œå·²ç»æ˜¾ç¤ºäº†ç‰¹æœ‰çš„ UUIDsã€‚

## [](#using-the-javascript-app)ä½¿ç”¨ Javascript åº”ç”¨ç¨‹åº

æ‰€ä»¥ï¼Œä¸€æ—¦æˆ‘ä»¬å¼€å§‹åšå¹¿å‘Šï¼Œå°±è¯¥è¿è¡Œåº”ç”¨ç¨‹åºäº†ã€‚

[![Bluetooth javascript app results](../Images/1f83e24612fd67e2c1be33af36228d3b.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--aOVilgXj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.jaredwolff.com/how-to-protocol-buffer-bluetooth-low-energy-service-part-3/images/Untitled-7e92193a-4dbe-4e08-9ebe-ee41be501580.png)

åªéœ€åˆ‡æ¢åˆ°`ble-protobuf-js`ç›®å½•å¹¶è¿è¡Œ`node index.js`

å¦‚æœæ‚¨å·²ç»æ­£ç¡®å®‰è£…äº†æ‰€æœ‰ä¸œè¥¿ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡º:

```
example started
scanning
peripheral with ID 06f9b62ec5334454875b9f53d2f3fa74 found with name: Nordic_Buttonles 
```

ç„¶åï¼Œå®ƒåº”è¯¥ç«‹å³è¿æ¥å¹¶å‘è®¾å¤‡å‘é€æ•°æ®ã€‚å®ƒåº”è¯¥ç«‹å³æ”¶åˆ°å“åº”ï¼Œå¹¶å°†å…¶æ‰“å°åˆ°å±å¹•ä¸Šã€‚

```
connected to Nordic_Buttonles
Sent: This is
Received: This is cool. 
```

ç­”å¯¹äº†ã€‚

## ä½ æˆåŠŸäº†ï¼

ğŸ‰å¦‚æœä½ å·²ç»å®Œæˆäº†æ•™ç¨‹ï¼Œé‚£ä¹ˆæ­å–œä½ ã€‚ç°åœ¨ï¼Œæ‚¨åº”è¯¥æœ‰è¶³å¤Ÿçš„ä¿¡å¿ƒå¼€å§‹ä½¿ç”¨è½¯ä»¶ä»£ç äº†ã€‚ä¹Ÿè®¸ä½ ä¼šåšäº›å¾ˆé…·çš„ä¸œè¥¿ï¼Ÿ

è¿™é‡Œæœ‰ä¸€äº›èµ„æºçš„é“¾æ¥ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—å¾ˆæ–¹ä¾¿ã€‚

*   [åè®®ç¼“å†²æ–‡ä»¶](https://developers.google.com/protocol-buffers)
*   NanoPB -(æˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨çš„åè®®ç¼“å†²åŒºçš„å®ç°)
*   [åŒ—æ¬§ SDK æ–‡æ¡£](https://www.nordicsemi.com/DocLib/Content/SDK_Doc/nRF5_SDK/v15-2-0/index)
*   åŒæ ·ï¼Œè¿™é‡Œæœ‰åˆ°ç¬¬ä¸€éƒ¨åˆ†å’Œç¬¬äºŒéƒ¨åˆ†çš„é“¾æ¥
*   å¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œ[è·å–è¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç ](https://www.jaredwolff.com/files/protobuf)

## [](#conclusion)ç»“è®º

åè®®ç¼“å†²åŒºéå¸¸é€šç”¨å’Œæ–¹ä¾¿ã€‚å°†å®ƒä»¬ä¸è“ç‰™ä½èƒ½è€—æœåŠ¡ç»“åˆä½¿ç”¨æ˜¯æ‚¨å¯ä»¥åˆ©ç”¨çš„ä¸€ç§æ–¹å¼ã€‚éšç€ç‰©è”ç½‘ä¸–ç•Œçš„ä¸æ–­æ‰©å±•ï¼Œæˆ‘æ¯«ä¸æ€€ç–‘æˆ‘ä»¬å°†åœ¨æœªæ¥çœ‹åˆ°æ›´å¤šçš„ä½¿ç”¨æ¡ˆä¾‹ï¼

æˆ‘å¸Œæœ›è¿™å¯å‘äº†æ‚¨å°†åè®®ç¼“å†²åŒºåˆå¹¶åˆ°æ‚¨è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚ç¡®ä¿æ‚¨[ä¸‹è½½äº†ç¤ºä¾‹ä»£ç ](https://www.jaredwolff.com/files/protobuf)å¹¶ç«‹å³å¼€å§‹ã€‚

è¿™ä¸ªæ•™ç¨‹å¯¹ä½ æœ‰ç”¨å—ï¼Ÿè®©æˆ‘çŸ¥é“ä½ çš„æƒ³æ³•ã€‚