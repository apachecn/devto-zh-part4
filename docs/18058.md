# æ‚¨åº”è¯¥äº†è§£çš„ç±»å‹è„šæœ¬ç±»å‹

> åŸæ–‡:[https://dev . to/XP bytes/typescript-types-you-should-know-about-3p C5](https://dev.to/xpbytes/typescript-types-you-should-know-about-3pc5)

åœ¨æˆ‘ä½¿ç”¨ TypeScript çš„æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘åœ¨å¤§å¤šæ•°(å¦‚æœä¸æ˜¯æ‰€æœ‰çš„è¯)é¡¹ç›®ä¸­ä½¿ç”¨äº†è®¸å¤šå®ç”¨ç¨‹åºç±»å‹å’Œæ ‡å‡†
ç±»å‹ã€‚æœ¬æ–‡åŒ…å«ä»¥ä¸‹ä¸»é¢˜:

*   åœ¨`type-fest`ä¸­é”®å…¥
*   å…¶ä»–ç±»å‹(è‡ªå®šä¹‰ã€å†…ç½®æˆ–`utility-types`)
*   å¸¸è§æ¨¡å¼
    *   åŒ…è¾¹å‹é˜²æŠ¤è£…ç½®
    *   `const`æ•°ç»„å’Œå¹¶é›†ç±»å‹
    *   è‡ªå®šä¹‰é”™è¯¯
    *   è®¾ç½®`this`

[![A photo of a lot open books, nicely aligned, taken at FIKA Cafe, Toronto, Canada](../Images/26fd19ddf25d2b6194ae345b25b60eff.png "Photo by Patrick Tomasso (https://unsplash.com/@impatrickt) on Unsplash (https://unsplash.com/)")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--UDJeCbii--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/p9wzwyyiaocpv0r6czhz.jpg)

## [`type-fest`T4ã€‘](https://github.com/sindresorhus/type-fest)

åŸºæœ¬ç±»å‹è„šæœ¬ç±»å‹çš„é›†åˆã€‚

è¿™ä¸ª`npm`åŒ…åŒ…å«äº†ç›¸å½“å¤šçš„(å°šæœª)å†…ç½®çš„ã€‚æˆ‘æœ‰æ—¶ä½¿ç”¨è¿™ä¸ªåŒ…(å¹¶ä»é‚£é‡Œå¯¼å…¥),æœ‰æ—¶å°†å®ƒä»¬å¤åˆ¶åˆ°æˆ‘çš„é¡¹ç›®ä¸­çš„ä¸€ä¸ªç¯å¢ƒå£°æ˜æ–‡ä»¶ä¸­ã€‚

### [](#-raw-safeomitltt-kgt-endraw-)`SafeOmit<T, K>` [ğŸŒ](https://github.com/sindresorhus/type-fest/blob/master/source/)

ä»æ²¡æœ‰ç‰¹å®šé”®çš„å¯¹è±¡ç±»å‹åˆ›å»ºç±»å‹ã€‚

ç”¨ä¾‹æ˜¯ä¸€ä¸ªæ¯”å†…ç½®`Omit`æ›´å®‰å…¨çš„(r)ç‰ˆæœ¬ï¼Œå®ƒä¸å¯¹ç…§`T`æ£€æŸ¥
é”®`K`ï¼Œè€Œæ˜¯å¯¹ç…§`any`æ£€æŸ¥å®ƒä»¬ã€‚

```
export type SafeOmit<T, K extends keyof T> = Pick<T, Exclude<keyof T, K>>

type ExecutionOptions = {
  debug: boolean;
  dry?: boolean;
  tag: 'default' | 'name';
}

type ExecutionFlags = SafeOmit<ExecutionOptions, 'tag'>
// => {
//  debug: boolean;
//  dry?: boolean | undefined;
// } 
```

### [](#-raw-readonlydeeplttgt-endraw-)`ReadonlyDeep<T>` [ğŸŒ](https://github.com/sindresorhus/type-fest/blob/master/source/readonly-deep.d.ts)

é€’å½’åœ°å°†`object` sã€`Map` sã€`Set` s å’Œ`Array` s åŠå…¶æ‰€æœ‰å±æ€§/å…ƒç´ è½¬æ¢æˆä¸å¯å˜çš„ç»“æ„ã€‚

æˆ‘çš„ç”¨ä¾‹ä¸»è¦æ˜¯åœ¨å¯¼å…¥ JSONï¼Œæˆ–è€…å¤„ç†æŠ½è±¡è¯­æ³•æ ‘çš„æ—¶å€™ã€‚è¿™äº›éœ€è¦æ˜¯å®Œå…¨ä¸å¯å˜çš„(ç›´åˆ°å®ƒä»¬è¢«å…‹éš†),è¿™å°±å¼ºåˆ¶äº†è¿™ä¸€ç‚¹ã€‚å†…ç½®çš„`Readonly<T>`åªæµ…åŠŸã€‚

```
import { ReadonlyDeep } from 'type-fest'
import dataJson = require('./data.json')

const data: ReadonlyDeep<typeof dataJson> = dataJson
data.property.value.push('bar')
//=> error TS2339: Property 'push' does not exist on type 'readonly string[]' 
```

### [](#-raw-requireatleastonceltt-kgt-endraw-)`RequireAtLeastOnce<T, K>` [ğŸŒ](https://github.com/sindresorhus/type-fest/blob/master/source/require-at-least-one.d.ts)

åˆ›å»ºè‡³å°‘éœ€è¦ä¸€ä¸ªç»™å®šå±æ€§çš„ç±»å‹ã€‚å…¶ä½™çš„
å±æ€§ä¿æŒä¸å˜ã€‚

æˆ‘çš„ç”¨ä¾‹ä¸»è¦æ˜¯å½“æˆ‘å¿…é¡»ç¡®ä¿ä¸€ä¸ªå·²çŸ¥çš„æ¥å£æ–¹æ³•å­˜åœ¨æ—¶(é€šå¸¸æ˜¯ apiã€æœåŠ¡ã€è½¬æ¢/è½¬æ¢æ ·å¼å¯¹è±¡)ï¼Œä½†æ˜¯ç±»å‹çš„å…¶ä½™éƒ¨åˆ†ç”±æ€»æ˜¯å¯ç”¨çš„å±æ€§å’Œæˆå‘˜ç»„æˆã€‚

```
import { RequireAtLeastOne } from 'type-fest'

type Responder = {
  text?: () => string;
  json?: () => string;
  secure?: boolean;
}

const responder: RequireAtLeastOne<Responder, 'text' | 'json'> = {
  json: () => '{"message": "ok"}',
  secure: true
} 
```

### [](#-raw-mergelta-bgt-endraw-)`Merge<A, B>` [ğŸŒ](https://github.com/sindresorhus/type-fest/blob/master/source/merge.d.ts)

å°†ä¸¤ç§ç±»å‹åˆå¹¶æˆä¸€ç§æ–°ç±»å‹ã€‚ç¬¬äºŒç§ç±»å‹çš„é”®è¦†ç›–ç¬¬ä¸€ç§ç±»å‹çš„é”®ã€‚

æˆ‘çš„ç”¨ä¾‹ä¸»è¦æ˜¯å½“æˆ‘æƒ³ä½¿ç”¨`Object.assign`è€Œä¸æ˜¯ä½¿ç”¨ææ„/æ‰©å±•æ¥æ„å»ºæˆ‘çš„åˆå¹¶å¯¹è±¡æ—¶ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°é»˜è®¤çš„`Object.assign`äº§ç”Ÿäº†ä¸€ä¸ªä¸æ­£ç¡®çš„ç±»å‹ã€‚

```
type Stringy = {
  bar: string,
  foo: string
}

type NotStri = {
  foo: number
  other: boolean
}

const stringy: Stringy = { bar: 'bar', foo: 'foo' }
const notstri: NotStri = { foo: 42, other: true }

const result1 = Object.assign(stringy, notstri)
//       infers Object.assign<Stringy, NotStri>
result1.foo
// => string & number

export type Merge<T, V> = Omit<T, Extract<keyof T, keyof V>> & V;
const result2: Merge<Stringy, NotStri> = Object.assign(stringy, notstri)

result2.foo
// => number

const result3 = { ...stringy, ...notstri }
// => number 
```

### [](#-raw-mutablelttgt-endraw-)`Mutable<T>` [ğŸŒ](https://github.com/sindresorhus/type-fest/blob/master/source/mutable.d.ts)

å°†å…·æœ‰`readonly`å±æ€§çš„å¯¹è±¡è½¬æ¢ä¸ºå¯å˜å¯¹è±¡ã€‚
ä¹‹é€†`Readonly<T>`ã€‚

æˆ‘ä¸ªäººå¾ˆå°‘ä½¿ç”¨è¿™ä¸ª*ï¼Œå› ä¸ºæˆ‘å€¾å‘äº`Object.freeze`é‚£äº›â€œçœŸæ­£â€`Readonly`çš„å˜é‡ã€‚æ­£å¦‚`Required<T>`æ˜¯`Partial<T>`çš„é€†ï¼Œ`Mutable<T>`æ˜¯`Readonly<T>`çš„é€†ã€‚* 

 *```
import {Mutable} from 'type-fest';

type Foo = {
    readonly a: number;
    readonly b: string;
};

const mutableFoo: Mutable<Foo> = { a: 1, b: '2' };
mutableFoo.a = 3; 
```

## [](#other-types)å…¶ä»–ç±»å‹

### [](#-raw-withfoolttgt-endraw-)`WithFoo<T>`

æ¯å½“æˆ‘æœ‰ä¸€äº›æ•°æ®`T`å¹¶ä¿®æ”¹å®ƒï¼Œä½¿å®ƒæœ‰æ›´å¤šçš„æ•°æ®ï¼Œæˆ‘é€šå¸¸ä½¿ç”¨ä¸€ä¸ªåŒ…è£…ç±»å‹ï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“åœ¨è¿›è¡Œä¸­ç”¨*ç»„åˆ*ç±»å‹ã€‚

```
interface MyType {
  bar: 'string';
}

type WithFoo<T> = T & { foo: number }

const data: MyType[] = [{ bar: 'first' }, { bar: 'second' }]
const dataWithFoo: WithFoo<MyType>[] = data.map((item, index) => ({ ...item, foo: index }))

// The inverse uses SafeOmit
type WithoutFoo<T> = Omit<T, 'foo'> 
```

### [](#atleastone)è‡³å°‘ä¸€ä¸ª

æœ‰æ—¶æˆ‘æƒ³ç¡®ä¿ä¸€ä¸ªæ•°ç»„è‡³å°‘æœ‰ä¸€ä¸ªé¡¹ç›®ã€‚æœ‰äº›ç±»å‹åº“å®é™…ä¸Šå®šä¹‰äº†ä¸€ä¸ª*æ•´ä½“*è€Œä¸ä»…ä»…æ˜¯è¿™ä¸ªç®€å•çš„åˆ«åï¼Œä½†æ˜¯è¿™è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚

```
type AtLeastOne<T> = [T, ...T[]] 
```

### [](#-raw-promisetypelttgt-endraw-)`PromiseType<T>` [ğŸŒ](https://github.com/piotrwitek/utility-types#promisetypet)

å…¶ä¸­ä¸€ä¸ªæ›´æœ‰è¶£çš„è§£åŒ…å™¨ã€‚è¿™ç»™å‡ºäº†ä¸€ä¸ª`Promise<T>`ç±»å‹çš„å†…éƒ¨ç±»å‹`T`ã€‚å½“æŸäº‹å°†è§£å¼€ç±»å‹ï¼Œæˆ–è€…ä½ æƒ³è¦åœ¨æ‰¿è¯ºçš„ä¸Šä¸‹æ–‡ä¹‹å¤–å·¥ä½œæˆ–è€…æ„å»ºä¸€ä¸ªæ–°çš„æ‰¿è¯ºç±»å‹æ—¶æœ‰ç”¨(ä¾‹å¦‚`Promise<WithLabel<PromiseType<Original>>>`)ã€‚

```
import { PromiseType } from 'utility-types';

type Response = PromiseType<Promise<string>>;
// => string 
```

### [](#-raw-returntypelttgt-endraw-builtin)`ReturnType<T>`(å†…ç½®)

è·å–å‡½æ•°ç±»å‹çš„è¿”å›ç±»å‹ã€‚

è¿™æ˜¯æˆ‘ä½¿ç”¨çš„æ‰€æœ‰ç±»å‹ä¸­æœ€å¼ºå¤§çš„æ¨æ–­ç±»å‹ä¹‹ä¸€ã€‚ä¸æ˜¯
ä¸€éåˆä¸€éåœ°å¤åˆ¶ç±»å‹æœŸæœ›ï¼Œå¦‚æœæˆ‘çŸ¥é“ä¸€ä¸ªå‡½æ•°ä¿è¯è°ƒç”¨(æˆ–æœŸæœ›è°ƒç”¨)ä¸€ä¸ªå‡½æ•°`foo`ï¼Œå¹¶ä¸”æˆ‘è¿”å›ç»“æœï¼Œæˆ‘ç»™å®ƒè¿”å›ç±»å‹`ReturnType<typeof foo>`ï¼Œå®ƒå°†è¿”å›ç±»å‹ä»`foo`çš„å‡½æ•°å£°æ˜è½¬å‘åˆ°å½“å‰å‡½æ•°ã€‚

```
type T10 = ReturnType<() => string>
// => string
type T11 = ReturnType<(s: string) => void>
// => void

function foo(): Promise<number> { return Promise.resolve(42) }
type FooResult = ReturnType<typeof foo>
// => Promise<number> 
```

### [](#-raw-instancetypelttgt-endraw-builtin)`InstanceType<T>`(å†…ç½®)

è·å–æ„é€ å‡½æ•°ç±»å‹çš„å®ä¾‹ç±»å‹ã€‚

å¦‚æœæˆ‘æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ç±»å‹(ä¸€ä¸ªå¯æ„é€ çš„ç±»å‹)ï¼Œæˆ‘å°±ä½¿ç”¨è¿™ä¸ªï¼Œä½†æ˜¯æˆ‘éœ€è¦ä½¿ç”¨è¿™ä¸ªæ„é€ å‡½æ•°çš„`ReturnType<T>`ã€‚æˆ–å¤šæˆ–å°‘æ˜¯`ConstructorType<T>`çš„é€†ã€‚

```
class C {}

type T20 = InstanceType<typeof C>;
// => C 
```

### [](#-raw-constructortypelttgt-endraw-)`ConstructorType<T>`

åŒ¹é…ä¸€ä¸ª [`class`æ„é€ å‡½æ•°](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes)

å½“æˆ‘æœ‰ä¸€ä¸ªç±»å‹(`T`)å¹¶ä¸”æˆ‘åˆ›å»ºäº†ä¸€ä¸ªç”Ÿæˆè¿™äº›ç±»å‹çš„å·¥å‚æ—¶ï¼Œæˆ–è€…å½“æˆ‘éœ€è¦æ„é€ å™¨*ç±»å‹*ï¼Œç»™å®šä¸€ä¸ªå®ä¾‹ç±»å‹æ—¶ï¼Œæˆ‘ä½¿ç”¨è¿™ä¸ªã€‚æˆ–å¤šæˆ–å°‘æ˜¯`InstanceType<T>`çš„é€†ã€‚

```
export type ConstructorType<T> = new(...arguments_: any[]) => T 
```

## [](#common-patterns)å¸¸è§å›¾æ¡ˆ

### [](#overloaded-type-guards)è¶…è½½å¼è­¦å«

æˆ‘ç»å¸¸ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ä¿æŠ¤ï¼Œä»¥ä¾¿è½»æ¾ç¼©å°éå¸¸å®½çš„å­—ä½“ã€‚å®½ç±»å‹çš„é—®é¢˜æ˜¯ï¼Œåœ¨æ£€æŸ¥æ˜¯å¦å­˜åœ¨æˆ–ç¼©å°èŒƒå›´ä¹‹å‰ï¼Œæ‚¨åªèƒ½è®¿é—®*äº¤å‰ç‚¹*ã€‚

æœ‰æ—¶ï¼Œæ‚¨å¸Œæœ›æ£€æŸ¥çš„ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå®½ç±»å‹ï¼Œå¹¶ä¸”ä¸å¸Œæœ› typeguard åœ¨å®ƒä¸åŒ¹é…æŸä¸ªç¼©å°è°“è¯æ—¶åˆ†é… *never* ã€‚è¯·å‚è§ä¸‹é¢çš„ç¤ºä¾‹ã€‚

```
import { AST_NODE_TYPES, TSESTree } from "@typescript-eslint/typescript-estree";

// Aliases for these types, so they are easy to access
type Node = TSESTree.Node
type BinaryExpression = TSESTree.BinaryExpression

// Store all the possible values for the operator property
type BinaryOperator = BinaryExpression['operator']

// Define a special type that narrows the operator
type BinaryExpressionWithOperator<T extends BinaryOperator> = BinaryExpression & { operator: T }

// Generic overload that doesn't test for operator
export function isBinaryExpression(node: Node): node is BinaryExpression
// Special overload that only matches if the opertor matches
export function isBinaryExpression<T extends BinaryOperator>(node: Node, operator: T): node is BinaryExpressionWithOperator<T>

// Implementation that allows both arguments
export function isBinaryExpression(node: Node, operator?: string): node is BinaryExpression {
  return node.type === AST_NODE_TYPES.BinaryExpression && (
    operator === undefined
    || node.operator === operator
  )
}

const generic: Node = {
  type: 'BinaryExpression',
  operator: '+',
  /*...*/
} as Node
// => TSESTree.ArrayExpression
//    | TSESTree.ArrayPattern
//    | TSESTree.ArrowFunctionExpression
//    | TSESTree.AssignmentExpression
//    | TSESTree.AssignmentPattern
//    | TSESTree.AwaitExpression
//    | ... 150 more ...
//    | TSESTree.YieldExpression

if (isBinaryExpression(generic)) {
  // typeof generic is now
  // => { type: 'BinaryExpression', operator: BinaryOperator, left: ..., }
} else {
  // typeof generic is now anything except for
  // ~> { type: 'BinaryExpression' }
}

if (isBinaryExpression(generic, '+')) {
  // typeof generic is now
  // => { type: 'BinaryExpression', operator: '+', left: ..., }
} else {
  // typeof generic is still Node
} 
```

### [](#-raw-const-endraw-arrays-and-raw-oneofltconst-arraygt-endraw-)`const`é˜µåˆ—å’Œ`OneOf<const Array>`

é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦å…è®¸ä¸€ç»„ä¸åŒçš„å€¼ã€‚è‡ªä» TypeScript 3.4
ä»¥æ¥ï¼Œæ²¡æœ‰å¿…è¦ä½¿ç”¨å¸®åŠ©å‡½æ•°è¿›è¡Œå¥‡æ€ªçš„è½¬æ¢ã€‚

ä¸‹é¢çš„ä¾‹å­åœ¨`A`ä¸­æœ‰ä¸€ç»„é€‰é¡¹ï¼Œå¹¶å®šä¹‰äº†è”åˆç±»å‹`OneOfA`ï¼Œå®ƒæ˜¯`A`çš„é€‰é¡¹ä¹‹ä¸€ã€‚

```
export type OneOf<T extends ReadonlyArray<any>> = T[number]

const A = ['foo', 'bar', 'baz'] as const
type OneOfA = OneOf<typeof A>
// => 'foo' | 'bar' | 'baz'

function indexOf(key: OneOfA): number {
  return A.indexOf(key)
  // never returns -1
} 
```

### [](#custom-errors)è‡ªå®šä¹‰é”™è¯¯

æ ¹æ® TypeScript 2.1ï¼Œå†…ç½®[çš„ç¼–è¯‘å¾ˆå¥‡æ€ª](https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work)ã€‚å¦‚æœä¸éœ€è¦æ”¯æŒ IE10 æˆ–æ›´ä½ç‰ˆæœ¬ï¼Œä¸‹é¢çš„æ¨¡å¼å¾ˆå¥½:

```
class EarlyFinalization extends Error {
  constructor() {
    super('Early finalization')
    // Doesn't work on IE10-
    Object.setPrototypeOf(this, EarlyFinalization.prototype);

    // Adds proper stacktrace
    Error.captureStackTrace(this, this.constructor)
  }
} 
```

### [](#setting-raw-this-endraw-)è®¾å®š`this`

(è‡³å°‘)æœ‰*ä¸¤ç§*æ–¹å¼å‘Šè¯‰ TypeScript ä¸€ä¸ªå‡½æ•°çš„å½“å‰ä¸Šä¸‹æ–‡`this`å€¼æ˜¯å¤šå°‘ã€‚ç¬¬ä¸€ä¸ªæ˜¯ç»™ä½ çš„å‡½æ•°æ·»åŠ ä¸€ä¸ªå‚æ•°`this`:

```
interface Traverser {
  break(): void
}

function walker(this: Traverser, root: Node) {
  this.break()
  // no error
} 
```

å¦‚æœä½ åœ¨ä¸€ä¸ª`class`æˆ–ç±»ä¼¼å‡½æ•°çš„èŒƒå›´ä¹‹å¤–å£°æ˜å‡½æ•°ï¼Œä½†æ˜¯ä½ çŸ¥é“`this`å€¼å°†è¢«ç»‘å®šåˆ°ä»€ä¹ˆï¼Œè¿™å°†æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚

ç¬¬äºŒç§æ–¹æ³•å®é™…ä¸Šå…è®¸ä½ åœ¨å‡½æ•°
çš„ä¹‹å¤–å®šä¹‰å®ƒ

 *```
interface HelperContext {
  logError: (error: string) => void;
}

const helperFunctions: { [name: string]: (() => void) } & ThisType<HelperContext> = {
  hello: function() {
      this.logError("Error: Something went wrong!");
      // TypeScript successfully recognizes that "logError" is a part of "this".

      this.update();
      // TS2339: Property 'update' does not exist on HelperContext.
  }
} 
```

å¦‚æœæ‚¨æ­£åœ¨ç»‘å®šä¸€ç»„å‡½æ•°ï¼Œè¿™å°†éå¸¸æœ‰å¸®åŠ©ã€‚

## [](#conclusion)ç»“è®º

TypeScript æœ‰å¾ˆå¤šå®çŸ³ğŸ’åœ¨ç”¨æˆ·ä¸–ç•Œæ›´æ˜¯å¦‚æ­¤ã€‚ç¡®ä¿åœ¨ä½¿ç”¨`as unknown as X`æˆ–`: any`ä¹‹å‰ï¼Œæ£€æŸ¥å†…ç½®ç±»å‹ã€`type-fest`å’Œæ‚¨è‡ªå·±çš„ä»£ç ç‰‡æ®µé›†åˆã€‚å¾ˆå¤šæ—¶å€™ï¼Œåšäº‹æƒ…çœŸçš„æœ‰ä¸€ä¸ªåˆé€‚çš„æ–¹æ³•ã€‚

[![A photo of yellow and gray, cube shaped houses, at Rotterdam, The Netherlands](../Images/eff3263d38104dc51bb84c092e160367.png "Photo by Nicole Baster (https://unsplash.com/@nicolebaster) on Unsplash (https://unsplash.com/)")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--wGggZipw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/96restcss1m07ljvl67q.jpg)**