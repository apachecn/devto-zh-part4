# ç”¨æ™®é€š JavaScript å»¶è¿ŸåŠ è½½å›¾åƒ

> åŸæ–‡:[https://dev . to/eka FYI/lazy-loading-images-with-vanilla-JavaScript-2fbj](https://dev.to/ekafyi/lazy-loading-images-with-vanilla-javascript-2fbj)

*åªéœ€å‡ è¡Œæ™®é€šçš„ JavaScript ä»£ç ï¼Œé€šè¿‡äº¤å‰ç‚¹è§‚å¯Ÿå™¨ APIâ€œå»¶è¿ŸåŠ è½½â€å›¾ç‰‡ï¼Œæé«˜ç½‘ç«™çš„é€Ÿåº¦å’Œæ€§èƒ½ã€‚*

**â€œæ‡’åŠ è½½â€æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œåªåœ¨éœ€è¦çš„æ—¶å€™â€”â€”ä¹Ÿå°±æ˜¯å½“å›¾åƒæˆ–è§†é¢‘å‡ºç°åœ¨å±å¹•ä¸Šçš„æ—¶å€™*æ‰åŠ è½½å®ƒä»¬ã€‚å¦‚æœä½ çš„é¡µé¢åŒ…å« 20 å¼ å›¾ç‰‡ï¼Œæ€»å¤§å°ä¸º 5MBï¼Œä½†æ˜¯ä½ çš„ç”¨æˆ·åªæ»šåŠ¨åˆ°ç¬¬ä¸‰å¼ å›¾ç‰‡ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦ç«‹å³è¯·æ±‚å¹¶åŠ è½½*æ‰€æœ‰çš„* 20 å¼ å›¾ç‰‡ã€‚***

 **ä¸å·æ‡’åŠ è½½ä½ çš„å›¾ç‰‡å°±åƒç‚¹äº†èœå•ä¸Šçš„æ‰€æœ‰ä¸œè¥¿ï¼Œå´ä¸çŸ¥é“ä½ èƒ½åƒå¤šå°‘ã€‚è¿™å¯èƒ½ä¼šæµªè´¹æ—¶é—´ã€èµ„æºï¼Œä»¥åŠç”¨æˆ·çš„å¸¦å®½(å¯¹ç§»åŠ¨æ•°æ®ç”¨æˆ·æ¥è¯´ï¼Œè¿™ç›¸å½“äºé‡‘é’±)ã€‚

<figure>

[![Scene from animated film Spirited Away, depicting the character No Face with so much food on the table](../Images/7e8a051fb3068b6440a49b211f30d807.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xwzkL1wm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/rllvlqv7mgxzoeij83hx.jpg)

<figcaption>Image from the film â€œSpirited Awayâ€ (2001)</figcaption>

</figure>

è¿™æ›¾ç»æ˜¯ä¸€é¡¹éº»çƒ¦çš„å·¥ä½œï¼ŒåŒ…æ‹¬æ·»åŠ /åˆ é™¤å¤šä¸ªäº‹ä»¶ç›‘å¬å™¨ä»¥åŠæ¯”è¾ƒå¤§å°å’Œä½ç½®ã€‚ä½†æ˜¯å¤šäºäº†[äº¤é›†è§‚å¯Ÿè€… API](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API) ï¼Œå®ƒå·²ç»è¢«[å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨](https://caniuse.com/#feat=intersectionobserver)æ”¯æŒï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ç”¨ä¸åˆ° 20 è¡Œ JavaScript å®ç°å»¶è¿ŸåŠ è½½ï¼

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªå®ç°å»¶è¿ŸåŠ è½½çš„å›¾åº“ã€‚æˆ‘ä»¬å°†ç”¨æ™®é€šçš„ HTMLã€CSS å’Œ JS æ¥åšè¿™ä»¶äº‹â€”â€”æ²¡æœ‰åº“æˆ–ä¾èµ–ã€‚æœ‰å¤§é‡çš„å»¶è¿ŸåŠ è½½åº“å’Œæ’ä»¶(æˆ‘åœ¨è¿™ç¯‡æ–‡ç« çš„æœ€ååŒ…æ‹¬äº†å®ƒä»¬)ï¼Œä½†æ˜¯è¿™æ˜¯ä¸€ç§æœ‰è¶£çš„æ–¹å¼æ¥ç†è§£äº¤å‰ç‚¹è§‚å¯Ÿå™¨ API æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå»¶è¿ŸåŠ è½½æ˜¯å¦‚ä½•åœ¨æœ€åŸºç¡€çš„å±‚é¢ä¸Šå·¥ä½œçš„ã€‚

ä½ å¯ä»¥è¿è¡Œå¹¶â€œé‡æ–°ç»„åˆâ€ä¸‹é¢ Glitch ä¸Šçš„ä»£ç ã€‚

[https://glitch.com/embed/#!/embed/lazy-cats?previewSize=100&path=index.html](https://glitch.com/embed/#!/embed/lazy-cats?previewSize=100&path=index.html)

***æ³¨æ„:**å»¶è¿ŸåŠ è½½ä¹Ÿé€‚ç”¨äºè§†é¢‘ï¼Œä½†è¿™é‡Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯å›¾åƒã€‚ä½ å¯ä»¥åœ¨è¿™ç¯‡æ–‡ç« çš„æœ«å°¾æ‰¾åˆ°æ›´å¤šçš„å‚è€ƒèµ„æ–™ã€‚*

* * *

## [](#implementing-lazy-loading)å®ç°å»¶è¿ŸåŠ è½½

ç®€è€Œè¨€ä¹‹ï¼Œå½“æˆ‘ä»¬åŠ è½½å›¾åº“é¡µé¢æ—¶ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µ:

1.  æµè§ˆå™¨è§£æé¡µé¢çš„ HTML å’Œ CSSï¼Œå°†å®ƒä»¬ç»“åˆèµ·æ¥æ„å»ºä¸€ä¸ªæ¸²æŸ“æ ‘ã€‚
2.  æµè§ˆå™¨è®¡ç®—ç©ºé—´(å…ƒç´ å¤§å°ã€ä½ç½®)å¹¶å°†åƒç´ ç»˜åˆ¶(å‘ˆç°)åˆ°å±å¹•ä¸Šã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨é€šå¸¸ä¼šè¯·æ±‚å¹¶åŠ è½½â€œæŠ˜å ä¸Šæ–¹â€çš„å›¾åƒï¼Œå¹¶åŠ è½½å‰©ä½™å›¾åƒçš„*å ä½ç¬¦å›¾åƒ*ã€‚
3.  äº¤å‰ç‚¹è§‚å¯Ÿå™¨ API è§‚å¯Ÿå»¶è¿ŸåŠ è½½çš„å›¾åƒã€‚å½“ç”¨æˆ·å‘æ¯ä¸ªå›¾åƒæ»šåŠ¨/è·³è½¬æ—¶ï¼Œå®ƒä¼šè¯·æ±‚å®é™…çš„å›¾åƒå¹¶å°†å ä½ç¬¦ä¸å®é™…çš„å›¾åƒäº¤æ¢ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹æ–‡ä»¶:

*   `index.html` â€” HTML markup
*   `script.js`â€”JavaScript ä»£ç 
*   `style.css` â€”åŸºæœ¬ CSS æ ·å¼

### [](#-raw-indexhtml-endraw-)`index.html`

#### [](#1-prepare-the-html-markup)1ã€‚å‡†å¤‡ HTML æ ‡è®°

è®©æˆ‘ä»¬ä»åŸºæœ¬çš„ HTML å’Œ CSS æ ‡è®°å¼€å§‹ã€‚æˆ‘ä»¬æ­£åœ¨åˆ¶ä½œä¸€ä»½çŒ«çš„æ¸…å•ã€‚æ¯ä¸ª`<li>`åˆ—è¡¨é¡¹åŒ…å«çŒ«çš„åå­—å’Œå›¾åƒã€‚

```
<ul class="cats">
  <li class="cat">
    <img class="cat__img" src="https://cataas.com/cat?width=300&i=1" alt="" />
    <strong class="cat__name">Bustopher Jones</strong>
  </li>
  <!-- etc -->
</ul> 
```

#### [](#1b-prepare-the-raw-ltnoscriptgt-endraw-fallback)1bã€‚å‡†å¤‡`<noscript>`å›é€€

ç°åœ¨è®©æˆ‘ä»¬*å°†æ¯ä¸ª`<img>`çš„*å¤åˆ¶åˆ°ä¸€ä¸ª`<noscript>`æ ‡ç­¾ä¸­ï¼Œç”¨äºæˆ‘ä»¬æƒ³è¦å»¶è¿ŸåŠ è½½çš„å›¾åƒã€‚å› ä¸ºæˆ‘ä»¬å¸Œæœ›æ­£å¸¸åŠ è½½å‰ä¸‰ä¸ªå›¾åƒï¼Œæ‰€ä»¥æˆ‘ä»¬ä»ç¬¬äº”ä¸ªé¡¹ç›®å¼€å§‹åŠ è½½ã€‚

```
<ul class="cats">
  <!-- cats #1 to 4 -->
  <!-- start lazy loading cat #5 onwards -->
  <li class="cat">
    <img class="cat__img" src="https://cataas.com/cat?width=300&i=5" alt="" />
    <noscript>
      <img class="cat__img" src="https://cataas.com/cat?width=300&i=5" alt="" />
    </noscript>
    <strong class="cat__name">Growltiger</strong>
  </li>
  <!-- etc -->
</ul> 
```

##### [](#fold-what-fold)ğŸ§ *æŠ˜ï¼Ÿä»€ä¹ˆæŠ˜å ï¼Ÿ*

éšç€è®¾å¤‡å°ºå¯¸çš„ä¸æ–­å˜åŒ–ï¼Œæˆ‘ä»¬*å®é™…ä¸Šæ²¡æœ‰*åƒå°åˆ·ä¸€æ ·â€œåœ¨æŠ˜å çº¿ä»¥ä¸Šâ€ã€‚æƒ³æ³•æ˜¯åƒå¾€å¸¸ä¸€æ ·åŠ è½½ç¬¬ä¸€ä¸ª x å›¾åƒ(å³ç«‹å³)ï¼Œå› æ­¤å°†å®ƒä»¬ä½œä¸ºé¡µé¢çš„â€œå…³é”®èµ„äº§â€åŒ…æ‹¬åœ¨å†…ï¼Œå¹¶å°†å…¶ä½™çš„ä½œä¸ºéå…³é”®èµ„äº§å»¶è¿ŸåŠ è½½ã€‚

ä½¿ç”¨æ‚¨è‡ªå·±çš„åˆ¤æ–­åŠ›æ¥å†³å®šå“ªäº›å›¾åƒæ­£å¸¸åŠ è½½åˆ°æ‚¨çš„é¡µé¢ä¸Šï¼

#### [](#2-make-the-images-raw-lazy-endraw-)2ã€‚åˆ¶ä½œå›¾åƒ`.lazy`

æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†æ²¡æœ‰å»¶è¿ŸåŠ è½½çš„å¸¸è§„å›¾åƒã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹æˆ‘ä»¬æƒ³è¦æƒ°æ€§åŠ è½½çš„æ¯ä¸ª`<img>`å…ƒç´ åšä¸‰ä»¶äº‹:

1.  æ·»åŠ ä¸€ä¸ªé¢å¤–çš„ç±»ï¼Œ`.lazy`(éšæ„ä½¿ç”¨ä»»ä½•åç§°)
2.  ç”¨å ä½ç¬¦å›¾åƒæ›¿æ¢`src`å±æ€§å€¼
3.  ç”¨å›¾åƒæºå€¼æ·»åŠ ä¸€ä¸ª`data-src`å±æ€§(å³ã€‚çŒ«çš„å½¢è±¡)

å ä½ç¬¦å›¾åƒå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œåªè¦å®ƒè¶³å¤Ÿå°ã€‚è¿™é‡Œæˆ‘ç”¨çš„æ˜¯æ™®é€šçš„ 1x1px ç°è‰² PNG å›¾åƒã€‚

```
<li class="cat">
  <img 
    class="cat__img lazy" 
    src="https://cdn.glitch.com/3a5b333c-942b-4088-9930-e7ea1e516118%2Fplaceholder.png?v=1560442648212"
    data-src="https://cataas.com/cat?width=300&i=5"
    alt="" 
  />
  <noscript>
    <img class="cat__img" src="https://cataas.com/cat?width=300&i=5" alt="" />
  </noscript>
  <strong class="cat__name">Growltiger</strong>
</li> 
```

ğŸ’¡ ***æç¤º:**æ·»åŠ ç©ºçš„`alt`å±æ€§ï¼Œè¿™æ ·å±å¹•é˜…è¯»å™¨å°±ä¸ä¼šå…¬å¸ƒå›¾åƒæ–‡ä»¶åã€‚*

åœ¨é¡µé¢åº•éƒ¨å…³é—­`</body>`ä¹‹å‰ï¼Œå¦‚æœä¸æ”¯æŒæˆ–ç¦ç”¨ JavaScriptï¼Œæ·»åŠ ä»¥ä¸‹æ ·å¼æ¥éšè—`<noscript>`è§†å›¾çš„é‡å¤å›¾åƒã€‚

```
<noscript>
  <style>.lazy { display: none; }</style>
</noscript> 
```

æˆ‘ä»¬å®Œæˆäº† HTML æ ‡è®°ã€‚ç¡®ä¿æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„`<head>`å…ƒç´ ä¸­è°ƒç”¨æˆ‘ä»¬çš„ JS æ–‡ä»¶ï¼Œä¾‹å¦‚`<script src="/script.js" defer></script>`ï¼Œå¹¶è¿›å…¥ä¸‹ä¸€æ­¥ã€‚

### [](#-raw-scriptjs-endraw-)`script.js`

#### [](#3-prepare-the-function-that-will-run-intersection-observer)3ã€‚å‡†å¤‡å°†è¿è¡Œäº¤å‰ç‚¹è§‚å¯Ÿå™¨çš„å‡½æ•°

JS æ–‡ä»¶çš„ç¬¬ä¸€æ­¥æ˜¯å‡†å¤‡è¿è¡Œäº¤å‰ç‚¹è§‚å¯Ÿå™¨çš„å‡½æ•°ã€‚

```
// Run after the HTML document has finished loading
document.addEventListener("DOMContentLoaded", function() {
  // Get our lazy-loaded images
  var lazyImages = [].slice.call(document.querySelectorAll("img.lazy"));

  // Do this only if IntersectionObserver is supported
  if ("IntersectionObserver" in window) {
    // ... write the code here
  }
}); 
```

è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆ:

*   æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œç”¨äºæ£€æµ‹ HTML æ–‡æ¡£ä½•æ—¶å®ŒæˆåŠ è½½å’Œè§£æã€‚
*   ç„¶åï¼Œæˆ‘ä»¬å°†å›¾åƒå®šä¹‰ä¸ºå»¶è¿ŸåŠ è½½â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨ç±»`.lazy`åŠ è½½`img`ä¸ªå…ƒç´ ã€‚
*   ä¸ºäº†é˜²æ­¢é”™è¯¯ï¼Œè®¾ç½®ä¸€ä¸ªæ¡ä»¶ï¼Œä»…å½“æµè§ˆå™¨æ”¯æŒäº¤å‰ç‚¹è§‚å¯Ÿå™¨æ—¶æ‰è¿è¡Œæˆ‘ä»¬çš„å‡½æ•°ã€‚

#### [](#4-create-an-intersection-observer)4ã€‚åˆ›å»ºäº¤å‰ç‚¹è§‚å¯Ÿç‚¹

**äº¤é›†è§‚å¯Ÿè€…**æ˜¯ä¸€ä¸ª JavaScript web APIï¼Œé¡¾åæ€ä¹‰ï¼Œå½“ç›®æ ‡å…ƒç´ *ä¸æ ¹/å®¹å™¨å…ƒç´ *ç›¸äº¤æ—¶ï¼Œ*è§‚å¯Ÿ*(è§‚å¯Ÿ)ã€‚

äº¤å‰ç‚¹è§‚å¯Ÿå™¨ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆ:

*   *ç›®æ ‡å…ƒç´ *â€”â€”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„å›¾åƒ
*   *æ ¹/å®¹å™¨å…ƒç´ * â€”é»˜è®¤ä¸º viewport(æˆ‘ä»¬å¯ä»¥é€‰æ‹©å®šä¹‰*ç›®æ ‡*çš„ä»»ä½•çˆ¶å…ƒç´ ï¼Œè¿™é‡Œä¸éœ€è¦)
*   *å›è°ƒå‡½æ•°*ï¼Œå½“*ç›®æ ‡*ä¸*æ ¹*ç›¸äº¤æ—¶è¿è¡Œâ€”â€”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨æ¥è‡ª`data-src`çš„å®é™…å›¾åƒäº¤æ¢`src`å€¼

åˆ›å»ºæ–°äº¤å‰ç‚¹è§‚å¯Ÿå™¨å¯¹è±¡çš„ API æ˜¯`new IntersectionObserver(callback, options)`ã€‚

*   `callback`æ˜¯ä¸€ä¸ªå¸¦ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œ`entries`å’Œ`observer`
*   `options`æ˜¯åŒ…å«é€‰é¡¹çš„å¯é€‰å¯¹è±¡

ç°åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º`lazyImageObserver`çš„æ–°è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¹¶ä¼ é€’ç»™å®ƒä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œæ²¡æœ‰ä½¿ç”¨è‡ªå®šä¹‰é€‰é¡¹ã€‚

```
if ("IntersectionObserver" in window) {
  // Create new observer object
  let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
    // ... callback function content here
  });
} 
```

#### [](#5-observe-target-elements)5ã€‚è§‚å¯Ÿç›®æ ‡å…ƒç´ 

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨åˆšåˆšåˆ›å»ºçš„`lazyImageObserver`ä¸Šè°ƒç”¨`.observe()`æ–¹æ³•æ¥è§‚å¯Ÿç›®æ ‡å…ƒç´ ï¼Œå³æˆ‘ä»¬çš„æ¯ä¸ª`.lazy`å›¾åƒã€‚

```
if ("IntersectionObserver" in window) {
  // Create new observer object
  let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
    // ... callback function content here
  });

  // Loop through and observe each image
  lazyImages.forEach(function(lazyImage) {
    lazyImageObserver.observe(lazyImage);
  });
} 
```

#### [](#6-replace-placeholder-with-the-actual-image-source)6ã€‚ç”¨å®é™…å›¾åƒæºæ›¿æ¢å ä½ç¬¦

ç°åœ¨æˆ‘ä»¬è¦ç¼–å†™åœ¨ç¬¬ 4 æ­¥ä¸­ç•™ç©ºçš„*å›è°ƒå‡½æ•°*ã€‚å½“ç›®æ ‡(æˆ‘ä»¬çš„æ¯ä¸ª`.lazy`å›¾åƒ)é€šè¿‡æ ¹å…ƒç´ (å³è¿›å…¥è§†å£)ã€‚

å›è°ƒæ¥æ”¶ä¸€ç»„`IntersectionObserverEntry`å¯¹è±¡ã€‚æ¯ä¸ª`IntersectionObserverEntry`å¯¹è±¡éƒ½æœ‰[å‡ ä¸ªå±æ€§](https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry)â€”â€”ä¸ºäº†æˆ‘ä»¬çš„ç›®çš„ï¼Œå½“æ¯ä¸ªå›¾åƒè¿›å…¥è§†å£æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨`.isIntersecting`å°†å ä½ç¬¦å›¾åƒæ›¿æ¢ä¸ºå®é™…çš„å›¾åƒæº*ã€‚* 

```
if ("IntersectionObserver" in window) {
  // Create new observer object
  let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
      // Loop through IntersectionObserverEntry objects
      entries.forEach(function(entry) {
        // Do these if the target intersects with the root
        if (entry.isIntersecting) {
          let lazyImage = entry.target;
          lazyImage.src = lazyImage.dataset.src;
          lazyImage.classList.remove("lazy");
          lazyImageObserver.unobserve(lazyImage);
        }
      });
  });

  // Loop through and observe each image
  lazyImages.forEach(function(lazyImage) {
    lazyImageObserver.observe(lazyImage);
  });
} 
```

å½“æ¯ä¸ªå›¾åƒè¿›å…¥è§†åŒºæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ:

*   ç”¨`data-src`å€¼(çŒ«å›¾åƒ)æ›¿æ¢`src`å€¼(å ä½ç¬¦å›¾åƒ)
*   ç§»é™¤`.lazy`ç±»
*   ä»»åŠ¡å®Œæˆï¼Œåœæ­¢è§‚å¯Ÿè¿™ä¸ªå›¾åƒ

#### [](#7-bonus-opera-mini-extreme-mode-fallback)7ã€‚å¥–åŠ±:Opera Miniâ€œæé™æ¨¡å¼â€å›é€€

æ‰‹æœºæµè§ˆå™¨ Opera Mini æœ‰ä¸€ä¸ªåä¸ºâ€œæé™æ¨¡å¼â€çš„æµè§ˆæ¨¡å¼ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªâ€œä»£ç†â€æœåŠ¡å™¨æ¥å‹ç¼©*å’Œ*å°†æ‰€æœ‰æ•°æ®è½¬æ¢ä¸º Opera è‡ªå·±çš„æ ¼å¼ï¼Œç§°ä¸º OBMLï¼Œç„¶åå‘é€åˆ°æµè§ˆå™¨ã€‚

è¯¥æ¨¡å¼*åœ¨æŸç§ç¨‹åº¦ä¸Šä¸æ”¯æŒ JSï¼Œå› æ­¤`<noscript>`ä¸é€‚ç”¨ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„å¤–éƒ¨ JS æ–‡ä»¶åœ¨è¿™é‡Œä¸èµ·ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªåŸºæœ¬çš„åå¤‡æ–¹æ³•ï¼Œç”¨å®é™…çš„å›¾åƒæ›¿æ¢å ä½ç¬¦å›¾åƒã€‚å¦‚æœä½ çš„ç”¨æˆ·ä¸­æœ‰ç›¸å½“æ¯”ä¾‹çš„äººä½¿ç”¨ Opera Miniï¼Œè¯·æ³¨æ„è¿™ä¸€ç‚¹ã€‚* 

```
<script>
  (function() {
    "use strict";
    if ("IntersectionObserver" in window) {
    } else {
      // `document.querySelectorAll` does not work in Opera Mini
      var lazyImages = document.getElementsByClassName("lazy");
      // https://stackoverflow.com/questions/3871547/js-iterating-over-result-of-getelementsbyclassname-using-array-foreach
      [].forEach.call(lazyImages, function (lazyImage) {
        lazyImage.src = lazyImage.dataset.src;
        lazyImage.classList.remove("lazy");
        lazyImage.height = 'auto';
      });
    }
  })();
</script> 
```

#### [](#8-thats-it)8ã€‚å°±æ˜¯è¿™æ ·ï¼

é™¤éæ‚¨çš„å›¾åƒå¼‚å¸¸æ²‰é‡å’Œ/æˆ–æ‚¨çš„ç”¨æˆ·çš„äº’è”ç½‘è¿æ¥å¤ªæ…¢ï¼Œå¦åˆ™ç”¨æˆ·å¯èƒ½ç”šè‡³ä¸ä¼šæ³¨æ„åˆ°è¿™ç§å·®å¼‚ã€‚ğŸ¤·ğŸ½â€â™€ï¸:ä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä»¬å¾ˆå¯èƒ½ä¼šæ›´å¿«åœ°æ‰¾åˆ°ä½ çš„ç½‘ç«™ï¼ŒèŠ±è´¹ä¹Ÿæ›´å°‘ã€‚

* * *

## [](#results)ç»“æœ

æˆ‘ä»¬å°†ä½¿ç”¨ Chrome DevTools(å¦‚æœæ‚¨å–œæ¬¢ï¼ŒFirefox å’Œ Safari ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„å·¥å…·)æ¥æ£€æŸ¥å¸¦æœ‰æƒ°æ€§åŠ è½½å›¾åƒçš„é¡µé¢å’Œæ™®é€šå›¾åƒä¹‹é—´çš„å·®å¼‚ï¼Œç‰¹åˆ«æ˜¯*ç½‘ç»œ*å’Œ*å®¡è®¡*é¢æ¿ã€‚

### [](#network)ç½‘ç»œ

[![Network results of page without lazy load](../Images/552c0d9c969fce5823fd264e9457762d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--u9ulBPIZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/6328rllrmxtzifw40psx.png)

æ— å»¶è¿ŸåŠ è½½:

*   15 ä¸ªè¯·æ±‚
*   **å·²è½¬ç§» 284 KB**
*   å®Œæˆ(è´Ÿè½½): **2.56 ç§’**
*   HTML æ–‡ä»¶å¤§å°: **3.2 KB**

[![Network results of page with lazy load](../Images/5979faedefc05f06985bfd7d048d41c9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--itUB2ok5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/688zncwb66234rca9gj3.png)

å»¶è¿ŸåŠ è½½:

*   **7** è¯·æ±‚â¡ï¸ 8 è¯·æ±‚æ›´å°‘
*   **172 KB** è¢«è½¬ç§»çš„â¡ï¸å°äº† 112 KB
*   å®Œèµ›(åŠ è½½): **1.92 ç§’** â¡ï¸å¿«äº† 0.64 ç§’
*   HTML æ–‡ä»¶å¤§å°: **6.6 KB** â¡ï¸ 3.4 KB *æ›´å¤§*(ç”±äºæ›´å¤šçš„æ ‡è®°)

ğŸ’¡è¯·è®°ä½ï¼Œ*åŠ è½½*æ—¶é—´å—å¤šç§å› ç´ å½±å“ï¼Œè€Œä¸ä»…ä»…æ˜¯å›¾åƒå†…å®¹ã€‚

å½“æˆ‘ä»¬å‘ä¸‹æ»šåŠ¨æ—¶ï¼Œæµè§ˆå™¨å¯¹å‰©ä½™çš„å›¾åƒè¿›è¡Œåç»­è¯·æ±‚ã€‚

[![Network results of page with lazy load with more images loaded as user scrolls down](../Images/e2014051be983c1bc7d8f1112ed60b4a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--4ByaseoR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/cq87b3heox0rit3zv6ls.png)

### [](#audits-lighthouse)å®¡è®¡(ç¯å¡”)

[![Lighthouse Audit results of page without lazy load](../Images/d302d6a2df703e8ac1f27c8c2e73b144.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--T1MxNEIo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5j6dfl184n5k7dmpij6d.png)

æ— å»¶è¿ŸåŠ è½½:

*   æ€§èƒ½: **96**
*   äº’åŠ¨æ—¶é—´: **2.1 ç§’**
*   ç¬¬ä¸€æ¬¡æœ‰æ„ä¹‰çš„ç»˜ç”»: **1.5 s**

[![Lighthouse Audit results of page with lazy load](../Images/42e8ac9fd69ebacd708c6e90a595f571.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Hg8Kpooa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zbjaxpz7ndszgvpimblh.png)

å»¶è¿ŸåŠ è½½:

*   æ€§èƒ½: **100**
*   äº’åŠ¨æ—¶é—´: **1.9 ç§’**
*   ç¬¬ä¸€æ¬¡æœ‰æ„ä¹‰çš„ç»˜ç”»: **0.6 ç§’**

æ€»ä¹‹ï¼Œç”¨ Intersection Observer API å»¶è¿ŸåŠ è½½å›¾åƒé€šå¸¸ä¼šæé«˜é¡µé¢é€Ÿåº¦å’Œæ€§èƒ½ï¼Œä½†ä¼šä½¿ HTML ä»£ç ç¨å¾®å˜å¤§ã€‚è¿™ç¯‡æ–‡ç« æ—¨åœ¨å±•ç¤ºæœ€åŸºæœ¬çš„å®ç°ï¼›è¯·åŠ¡å¿…æŸ¥çœ‹ä¸‹ä¸€éƒ¨åˆ†ï¼Œäº†è§£æ›´å¤šæƒ³æ³•å’Œå‚è€ƒèµ„æ–™ã€‚

æ„Ÿè°¢é˜…è¯»ï¼

* * *

## [](#references)å‚è€ƒæ–‡çŒ®

*   å»¶è¿ŸåŠ è½½åº“
    *   [æ‡’æƒ°](https://github.com/aFarkas/lazysizes)
    *   [æ˜“åŒ–](https://github.com/verlok/lazyload)æ˜“åŒ–
    *   ç‰¹å®šå¹³å°çš„æ’ä»¶:
        *   6 ä¸ªæƒ°æ€§åŠ è½½æ’ä»¶è®©ä½ çš„ WordPress ç«™ç‚¹æ›´å¿«
        *   [ç›–èŒ¨æ¯”å½¢è±¡](https://www.gatsbyjs.org/packages/gatsby-image)å’Œ[ç›–èŒ¨æ¯”è¯„è®ºå½¢è±¡](https://www.gatsbyjs.org/packages/gatsby-image)
*   æƒ°æ€§åŠ è½½å¢å¼º
    *   [intersect observer poly fill](https://github.com/w3c/IntersectionObserver/tree/master/polyfill)â€”W3C
    *   [å·æ‡’åŠ è½½å›¾ç‰‡å’Œè§†é¢‘](https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video) â€”æ°é‡Œç±³Â·ç“¦æ ¼çº³
    *   [å¦‚ä½•ä½¿ç”¨ SVG ä½œä¸ºå ä½ç¬¦ï¼Œä»¥åŠå…¶ä»–å›¾åƒåŠ è½½æŠ€æœ¯](https://jmperezperez.com/svg-placeholders/) â€” JosÃ© M. PÃ©rez
    *   é¢å‘ web çš„æœ¬åœ°æ˜ åƒå»¶è¿ŸåŠ è½½ï¼ â€”è‰¾è¿ªÂ·å¥¥æ–¯é©¬å°¼
        *   ğŸš§å‘å±•ä¸­ï¼›ä»…åœ¨ Chrome 75 ä¸­å¯ç”¨ï¼Œå¿…é¡»åœ¨`chrome://flags`ä¸‹æ‰‹åŠ¨å¯ç”¨
*   å…¶ä»–å›¾åƒä¼˜åŒ–ç­–ç•¥
    *   [å“åº”å›¾åƒ](https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images) â€” MDN
    *   [ä¼˜åŒ–æ‚¨çš„å›¾åƒ](https://web.dev/fast#optimize-your-images) â€” wev.dev
*   å…³äºäº¤å‰ç‚¹è§‚å¯Ÿå™¨
    *   [è·¯å£è§‚å¯Ÿå™¨ API](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API) â€” MDN
    *   [ä¿¡ä»»å¾ˆå¥½ï¼Œè§‚å¯Ÿæ›´å¥½â€”è·¯å£è§‚å¯Ÿè€… v2](https://developers.google.com/web/updates/2019/02/intersectionobserver-v2) â€”æ‰˜é©¬æ–¯Â·æ–¯å¦çº³**