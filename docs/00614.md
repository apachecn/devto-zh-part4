# ğŸ¤–â¡ğŸŒœ(æ•™æœºå™¨äººç™»æœˆ)

> åŸæ–‡ï¼š<https://dev.to/charlesdlandau/teach-bots-to-land-on-the-moon-27m9>

[åœ¨ Google Colab ä¸­ä¿®è¡¥è¿™æ¬¾ç¬”è®°æœ¬](https://colab.research.google.com/github/CharlesDLandau/rlNotebooks/blob/master/botsToTheMoon.ipynb)

[GitHub](https://github.com/CharlesDLandau/rlNotebooks)

åœ¨è¿‡å»çš„å‡ é›†é‡Œï¼Œæˆ‘ä»¬å›é¡¾äº†å¼ºåŒ–å­¦ä¹ çš„è®¾è®¡åŸåˆ™ï¼Œä»‹ç»äº† OpenAI Gym çš„å¼ºåŒ–å­¦ä¹ ï¼Œå¹¶è®­ç»ƒäº†ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¨¡å‹æ¥å¯¼èˆª OpenAI Gym ç¯å¢ƒã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†ä»£ç†-ç¯å¢ƒå…³ç³»:

*   ä»£ç†åœ¨ç¯å¢ƒä¸­é‡‡å–è¡ŒåŠ¨ã€‚è¿™äº›å¯ä»¥æ˜¯éšæœºçš„ï¼Œæˆ–è€…ç”±å¯å‘æ³•å¼•å¯¼ï¼Œæˆ–è€…ç”±æ¨¡å‹å¼•å¯¼ï¼Œæˆ–è€…ç”±ä¸€äº›ç»„åˆå¼•å¯¼ã€‚å®ƒæ¥æ”¶å…³äºç¯å¢ƒçš„æ•°æ®ï¼Œæ¯”å¦‚ç¯å¢ƒçš„å›¾ç‰‡æˆ–å­—ç¬¦ä¸²ï¼Œç„¶åé‡‡å–è¡ŒåŠ¨ã€‚ä¹‹åï¼Œå®ƒä»ç¯å¢ƒä¸­è·å¾—å¥–åŠ±ï¼Œè¿™ç›¸å½“äºå¯¹æ‰€é€‰è¡Œä¸ºçš„ç§¯ææˆ–æ¶ˆæçš„â€œå¼ºåŒ–â€ã€‚

*   ç¯å¢ƒè·Ÿè¸ªçŠ¶æ€ã€å¯èƒ½çš„åŠ¨ä½œã€å¥–åŠ±å’Œ**å¥–åŠ±å‡½æ•°**ï¼Œå¹¶ä¸”å¯é€‰åœ°å°†ç¯å¢ƒæ¸²æŸ“åˆ°æ˜¾ç¤ºå™¨ä¸Šã€‚å®ƒæ¥æ”¶æ¥è‡ªä»£ç†çš„åŠ¨ä½œï¼Œå¹¶ä¸”å®ƒå¯ä»¥è¢«é…ç½®ä¸ºä¿å­˜æ•°æ®(ä¾‹å¦‚ï¼Œä»£ç†åœ¨ç¯å¢ƒä¸­æ‰§è¡Œçš„è§†é¢‘ã€‚)

#### æ›´å¥½çš„è¯å‰‚

åœ¨å‰å‡ é›†é‡Œï¼Œæˆ‘ä»¬è¿˜å®ç°äº†ä¸€äº›ç®€å•çš„å¼ºåŒ–å­¦ä¹ ã€‚æ²¡æœ‰å·ç§¯å±‚æˆ–ç­–ç•¥å¼•æ“ï¼Œç½‘ç»œåªèƒ½å­¦ä¹ ç®€å•çš„ç­–ç•¥(å¦‚[å·¦è½¬](https://dev.to/charlesdlandau/drive-a-tank-with-python-3caf))ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åƒ [Tensorflow Agents](https://github.com/tensorflow/agents) æˆ– [OpenAI Baselines](https://github.com/openai/baselines) è¿™æ ·çš„åº“ï¼Œå®ƒä»¬æ‹¥æœ‰ä¸€äº›ç»è¿‡æˆ˜æ–—è€ƒéªŒçš„æœ€æˆåŠŸä»£ç†çš„å®ç°ã€‚æˆ‘å·²ç»å’Œå…¶ä¸­çš„ä¸€äº›åº“åˆä½œè¿‡äº†ï¼Œæˆ‘å¾—åˆ°äº†å’Œè¿™ç¯‡ç”± Thomas Simonini æ’°å†™çš„[ä¼˜ç§€æ–‡ç« ](https://medium.com/data-from-the-trenches/choosing-a-deep-reinforcement-learning-library-890fb0307092)ç›¸åŒçš„ç»“è®ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘å–œæ¬¢[ç¨³å®šåŸºçº¿](https://github.com/hill-a/stable-baselines)ï¼ŒOpenAI åŸºçº¿åº“çš„ä¸€ä¸ªåˆ†æ”¯ã€‚

#### åšå¥½å‡†å¤‡

[![Getting Ready](img/28a31e59020d331126d7073e177354ea.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--xigxxTP_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thumbs.gfycat.com/GorgeousUnfortunateAndalusianhorse-size_restricted.gif)

è®¾ç½® Google Colab çš„ç¨³å®šåŸºçº¿åŠå…¶ä¾èµ–é¡¹ï¼Œå¹¶å¼„æ¸…æ¥šå¦‚ä½•è®© gif å·¥ä½œï¼ŒèŠ±äº†æˆ‘æ¯”æˆ‘æƒ³è±¡ä¸­æ›´é•¿çš„æ—¶é—´ã€‚ä½ å¯ä»¥ç”¨ä¸‹é¢å‡ è¡Œä»£ç æ¥åš

```
# see: colab.research.google.com/drive/1GLlB53gvZaUyqMYv8GmZQJmshRUzV_tg !apt-get -qq -y install libcusparse8.0 libnvrtc8.0 libnvtoolsext1 > /dev/null
!ln -snf /usr/lib/x86_64-linux-gnu/libnvrtc-builtins.so.8.0 /usr/lib/x86_64-linux-gnu/libnvrtc-builtins.so
!apt-get -qq -y install xvfb freeglut3-dev ffmpeg> /dev/null

!pip install stable-baselines==2.7.0

# box2d fork until SWIG dependency is replaced !pip install box2d-py

# pyglet later versions break gym apparently !pip install pyglet==1.3.2

# Set up display; otherwise rendering will fail for
# classic control type envs, apparently import os
import Box2D
import pyglet
os.system("Xvfb :1 -screen 0 1024x768x24 &")
os.environ['DISPLAY'] = ':1'

# See https://github.com/ipython/ipython/issues/10045#issuecomment-522697219 from IPython.core.interactiveshell import InteractiveShell
InteractiveShell.ast_node_interactivity = "all"
from IPython import display 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ‰äº†è¿™ä¸ªæ–¹æ³•ï¼Œä½ å¯ä»¥ç”¨ä¸¤è¡Œä»£ç å®ç°ä¸€ä¸ªé«˜è´¨é‡çš„ä¼˜åŠ¿æ¼”å‘˜è¯„è®ºå®¶(A2C)æ¨¡å‹ã€‚ç®€å•åŸºçº¿å¾ˆæ£’ï¼Œå› ä¸ºå®ƒæœ‰ç›´è§‚çš„æ–¹æ³•æ¥è®­ç»ƒå’Œé¢„æµ‹ã€‚æ›´å¥½çš„æ˜¯ï¼Œå®ƒå°†æˆ‘ä»¬çš„ç¯å¢ƒå­˜å‚¨ä¸ºä¸€ä¸ª`model.env`æˆå‘˜ï¼Œå› æ­¤å¯¹äºå…¸å‹çš„å·¥ä½œæµï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„åªæ˜¯ä¸€ä¸ª`model`å®ä¾‹ã€‚

è®©æˆ‘ä»¬å¼€å§‹è®­ç»ƒå§â€”â€”ä¸‹é¢çš„å†…å®¹è¦èŠ±ç›¸å½“å¤šçš„æ—¶é—´æ¥è¿è¡Œ:

```
from stable_baselines import A2C
import time
start = time.time()

# Train a multilayer perceptron in the lunar lander. model = A2C('MlpPolicy', "LunarLander-v2").learn(900000)

# Mine finished in about 10 minutes. print(f"Finished in {time.time()-start}s") 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### ä¸€ä¸ªæ¼”å‘˜å’Œä¸€ä¸ªè¯„è®ºå®¶èµ°è¿›ä¸€å®¶é…’å§ã€‚

è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆæ¼”å‘˜-è¯„è®ºå®¶èŒƒå¼ã€‚æ¼”å‘˜è¯„è®ºå®¶è§£å†³çš„é—®é¢˜åªæ¶‰åŠæˆ‘ä»¬çš„å¥–åŠ±åŠŸèƒ½ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå¥–åŠ±åªå‘ç”Ÿåœ¨â€œä¸€é›†â€æˆ–â€œæ¸¸æˆâ€çš„ç»“å°¾è€ƒè™‘äº•å­—æ¸¸æˆçš„å¥–åŠ±å‡½æ•°:

*   æ’­æ”¾æ—¶è¿”å› 0
*   å¦‚æœæ¸¸æˆä»¥å¹³å±€ç»“æŸï¼Œè¿”å› 0
*   å¦‚æœæ¸¸æˆä»¥ä»£ç†äººå¤±è´¥å‘Šç»ˆï¼Œåˆ™è¿”å›-1.0
*   å¦‚æœæ¸¸æˆä»¥ä»£ç†è·èƒœè€Œç»“æŸï¼Œåˆ™è¿”å› 1.0

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬çš„ä»£ç†æ¯é›†éƒ½é‡‡å–äº†å‡ ä¸ªæ­¥éª¤ï¼Œè€Œè¿™äº›æ­¥éª¤ä»å¥–åŠ±åŠŸèƒ½ä¸­æ ¹æœ¬å¾—ä¸åˆ°ä»»ä½•åé¦ˆï¼Œè¿™å‡ç¼“äº†è®­ç»ƒçš„é€Ÿåº¦ï¼Œå¹¶ä¸”ä½¿å¾—å¾ˆéš¾å‘æˆ‘ä»¬çš„ä»£ç†æä¾›å…³äºå…·ä½“è¡ŒåŠ¨çš„ç²¾ç»†åé¦ˆã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¼”å‘˜è¯„è®ºå®¶å®é™…ä¸Šå®ç°äº†ä¸¤ä¸ªæ¨¡å‹:

*   ä¸€ä¸ªæ‰¹è¯„å®¶æ¨¡å‹ï¼Œè¯•å›¾é¢„æµ‹ç»™å®šè¡Œä¸ºå°†è·å¾—çš„å¥–åŠ±å€¼ï¼Œç»™å®šå¯¹ç¯å¢ƒçš„è§‚å¯Ÿã€‚è¡ŒåŠ¨-è§‚å¯Ÿå¯¹çš„é¢„æµ‹å¥–åŠ±å€¼è¡¨æœ‰æ—¶è¢«ç§°ä¸ºâ€œQ è¡¨â€
*   ä¸€ä¸ªæ¼”å‘˜æ¨¡å‹ï¼Œä»ç¯å¢ƒä¸­è·å–è§‚å¯Ÿç»“æœï¼Œä½†ä¸è·å–å¥–åŠ±ã€‚å®ƒå­¦ä¹ åœ¨ç¯å¢ƒä¸­ç©è€çš„ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯â€œæ”¿ç­–â€è¿™ä¸ªæ¨¡å‹ä¸æ˜¯ç›´æ¥ä¼˜åŒ–ç¯å¢ƒçš„å›æŠ¥ï¼Œè€Œæ˜¯ä¼˜åŒ–æ¥è‡ªæ‰¹è¯„å®¶æ¨¡å‹çš„*åé¦ˆã€‚å½“æˆ‘ä»¬åšé¢„æµ‹æ—¶ï¼Œåªéœ€è¦è°ƒç”¨æ¼”å‘˜æ¨¡å‹ã€‚*

æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æƒ³è±¡æˆ‘ä»¬çš„æ¼”å‘˜æ¨¡å‹åœ¨æœˆçƒç€é™†å™¨æ¨¡å—ä¸­ï¼Œè€Œè¯„è®ºå®¶ååœ¨æŒ‡æŒ¥ä¸­å¿ƒè§‚å¯Ÿç€é™†å™¨çš„è¡ŒåŠ¨ã€‚

[![the critic](img/19e59e33c0eeeeffdd74b8ec50b38bd4.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--c-RxG-Ra--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thumbs.gfycat.com/FlawlessWhichAdamsstaghornedbeetle-size_restricted.gif)

æ¯å½“ä¸€ä¸ªåŠ¨ä½œè¢«é‡‡å–æ—¶ï¼Œæ‰¹è¯„å®¶ä¼šæŸ¥é˜…åŠ¨ä½œã€è§’åº¦ã€é€Ÿåº¦ç­‰ç­‰çš„è¡¨æ ¼ã€‚çœ‹çœ‹è¿™ä¸ªåŠ¨ä½œæ˜¯å¦æœ‰åŠ©äºæˆåŠŸç€é™†ï¼Œè¯„è®ºå®¶é€šè¿‡æ— çº¿ç”µå‘æ¼”å‘˜åé¦ˆè¿™ä¸ªåŠ¨ä½œï¼Œæ¼”å‘˜ä»åé¦ˆä¸­å­¦ä¹ æˆä¸ºä¸€ä¸ªæ›´å¥½çš„é£è¡Œå‘˜ã€‚åœ¨æ•°åƒæ¬¡ç€é™†çš„è¿‡ç¨‹ä¸­,â€œæ‰¹è¯„å®¶â€æ ¹æ®å æ¯ã€æˆåŠŸå’Œæ„å¤–é¢‘ç¹åœ°æ›´æ–°è¡¨æ ¼ã€‚æœ‰äº›æ—¥å­ï¼Œæ¼”å‘˜å…³ç€æ”¶éŸ³æœºé£è¡Œï¼Œä½†å®ƒä»€ä¹ˆä¹Ÿå­¦ä¸åˆ°ã€‚

### è®°å½•ç€é™†çš„ GIF

ç°åœ¨ä½ çš„æ¨¡å‹å¯èƒ½å·²ç»å®Œæˆäº†è®­ç»ƒã€‚æ ¹æ®è¿™äº›æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•è®°å½•æ¨¡å‹è¿è¡Œçš„ gif:

```
import imageio
import numpy as np

# Number of images to capture n_images = 1200

images = []

# init a new episode obs = model.env.reset()
# init the img var with the starting state of the env img = model.env.render(mode='rgb_array')

for i in range(n_images):
  # At each step, append an image to list
  images.append(img)

  # Advance a step and render a new image
  action, _ = model.predict(obs)
  obs, _, _ ,_ = model.env.step(action)
  img = model.env.render(mode='rgb_array')

imageio.mimwrite('./lander.gif',
                [np.array(img) for i, img in enumerate(images) if i%2 == 0],
                fps=29) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ æˆåŠŸäº†ï¼Œé‚£ä¹ˆ`lander.gif`åº”è¯¥æ˜¯è¿™æ ·çš„:

[![lander.gif](img/1518f744773db27e524027bd2250335b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--MFfzzSgq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://serve-md.charlesdlandau.net/img/lander.gif)

åœ¨ Jupyter ä¸­æ˜¾ç¤º gif æœ‰ç‚¹è¿åç›´è§‰ï¼Œæˆ‘æ˜¯è¿™æ ·åšçš„:

```
from pathlib import Path
gifPath = Path("lander.gif")
# Display GIF in Jupyter, CoLab, IPython with open(gifPath,'rb') as f:
    display.Image(data=f.read(), format='png') 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### åŒ…è£…å®Œæ¯•...

åœ¨è¿™ä¸€é›†é‡Œï¼Œä½ :

*   äº†è§£æ¼”å‘˜å…¼è¯„è®ºå®¶
*   äº†è§£ç®€å•åŸºçº¿
*   çœ‹åˆ°äº†å¦‚ä½•åœ¨ç¬”è®°æœ¬ä¸­è®¾ç½® giffing ç¯å¢ƒ
*   ç™»é™†æœˆçƒï¼

[![goodjob.gif](img/54bff219b6fec612a6365307a8e8542e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--NjLwgo7R--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thumbs.gfycat.com/PerfumedBelatedBlowfish-size_restricted.gif)

å¥½æ ·çš„ã€‚

åœ¨æœªæ¥çš„å‡ é›†é‡Œï¼Œæˆ‘ä»¬å°†æ›´ä»”ç»†åœ°çœ‹çœ‹ RL å¦‚ä½•ä¸ºç”¨æˆ·ã€ä¼ä¸šå’Œæœºå™¨äººç»Ÿæ²»è€…åˆ›é€ ä»·å€¼ã€‚æ•¬è¯·å…³æ³¨ï¼Œæ„Ÿè°¢é˜…è¯»ã€‚