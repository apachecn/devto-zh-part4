# ä¿¡ä»»æ‰€æœ‰æƒå’Œå€Ÿæ¬¾

> åŸæ–‡:[https://dev.to/saiumesh/rust-ownership-and-borrowing-3o5d](https://dev.to/saiumesh/rust-ownership-and-borrowing-3o5d)

åœ¨æˆ‘ä»¬è°ˆè®º Rust æ‰€æœ‰æƒå’Œå€Ÿç”¨ä¹‹å‰ï¼Œæˆ‘æƒ³è®©ä½ çŸ¥é“ [techempower](https://www.techempower.com/benchmarks/#section=data-r18&hw=ph&test=query) ä¸Šå‘¨å‘å¸ƒäº†ç¬¬ 18 è½®ç»“æœï¼Œ **Rust** åœ¨ 5 ä¸ªç±»åˆ«ä¸­çš„ 4 ä¸ªç±»åˆ«ä¸­æ˜æ˜¾å æ®ä¸»å¯¼åœ°ä½ï¼Œè¿™è¡¨æ˜äº† Rust è¿™äº›å¹´æ¥å˜å¾—å¤šä¹ˆå¼ºå¤§ã€‚

Rust æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯å­¦ä¹  Rust å¹¶ä¸å®¹æ˜“ã€‚å®ƒæœ‰ä¸€ä¸ªé™¡å³­çš„å­¦ä¹ æ›²çº¿ã€‚åœ¨ Rust ä¸­ï¼Œä½ ä¼šå‘ç°æœ€éš¾å­¦çš„ä¸œè¥¿å¯èƒ½æ˜¯**æ‰€æœ‰æƒå’Œå€Ÿæ¬¾**ã€‚ä»Šå¤©æˆ‘ä»¬å°†è¯•ç€å­¦ä¹ å®ƒçš„åŸºç¡€çŸ¥è¯†ã€‚

**æœ¬æ–‡æ—¨åœ¨å­¦ä¹  it åŸºç¡€çŸ¥è¯†ï¼Œå› æ­¤åœ¨ç”Ÿäº§ä¸­å°å¿ƒä½¿ç”¨è¿™äº›ä»£ç **ã€‚

Rust æ—¢æ²¡æœ‰æ‰‹åŠ¨å†…å­˜ç®¡ç†ï¼Œä¹Ÿæ²¡æœ‰åƒåœ¾æ”¶é›†å™¨ã€‚é‚£ä¹ˆä¸‹ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜å°±æ˜¯ï¼ŒRust æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ğŸ’­ğŸ’­ã€‚Rust æœ€ç‹¬ç‰¹çš„ä¸€ç‚¹æ¥äº†ï¼Œæ‰€æœ‰æƒå’Œå€Ÿæ¬¾ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ä¾‹å­æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

åœ¨æˆ‘ä»¬çœ‹åˆ°ä»»ä½•é»‘è‰²å’Œè“è‰²æ–‡æœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸¤ç§ç±»å‹çš„å˜é‡:

1.  **é™æ€åˆ†é…çš„**ç±»å‹
2.  **å †åˆ†é…**ç±»å‹ ex:æ•°ç»„(Rust ä¸­çš„å‘é‡)

å¯¹äºä»»ä½•é™æ€åˆ†é…çš„ç±»å‹ï¼Œä¿¡ä»»æ‰€æœ‰æƒå’Œå€Ÿç”¨éƒ½ä¸é€‚ç”¨ï¼Œä½†å¯¹äºå †åˆ†é…å´é€‚ç”¨ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›ä¾‹å­ã€‚

```
 fn do_something(input: i32) -> i32 {
    input * 2
}

fn main() {
    let number: i32 = 1;
    let result = do_something(number);
    println!("result is {} for number {}", result, number)
} 
```

[åœ¨æ“åœºä¸Šè·‘](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=a661ed1ed4e2edd0e382883f64659fae)

å¦‚æœæ‚¨è¿è¡Œä¸Šé¢çš„ç¨‹åºï¼Œæ‚¨å°†å¾—åˆ°ä¸‹é¢çš„è¾“å‡ºï¼Œæ­£å¦‚é¢„æœŸçš„é‚£æ ·ã€‚

```
result is 2 for number 1 
```

ç°åœ¨è®©æˆ‘ä»¬å°†ä¸Šé¢ä¾‹å­ä¸­çš„***ã€i32ã€‘***æ›¿æ¢ä¸º ***å­—ç¬¦ä¸²(å †åˆ†é…)*** ã€‚

```
fn do_something(input: String) -> String {
    // do something with string
    input
}

fn main() {
    let name: String = String::from("Hello!!");
    let result = do_something(name);
    println!("result is {} for string {}", result, name)
} 
```

[åœ¨æ“åœºä¸Šè·‘](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=d16d1be6b9b126a5067dd2234bc8fed6)

ä¸€æ—¦ä½ è¿è¡Œä¸Šè¿°ç¨‹åºï¼Œä½ ä¼šé‡åˆ°ç¬¬ä¸€ä¸ª O & B é—®é¢˜å¦‚ä¸‹ã€‚

```
--> src\main.rs:11:52
   |
9  |     let name: String = String::from("Hello!!");
   |         ---- move occurs because `name` has type `std::string::String`, which does not implement the `Copy` trait
10 |     let result = do_something(name);
   |                               ---- value moved here
11 |     println!("result is {} for string {}", result, name)
   |                                                    ^^^^ value borrowed here after move 
```

ä»»ä½•å †åˆ†é…çš„å˜é‡éƒ½æœ‰å®ƒçš„ä½œç”¨åŸŸï¼Œé€šå¸¸è¿™ä¸ªä½œç”¨åŸŸæ˜¯å®ƒçš„å‡½æ•°çš„ç”Ÿå­˜æœŸ(ownsership)ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å°†ä»»ä½•å †å˜é‡ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆä¸ä»…æ˜¯è¯¥å˜é‡ï¼Œè€Œä¸”å®ƒçš„ä½œç”¨åŸŸä¹Ÿå°†è¿åŒå®ƒçš„ç”Ÿå­˜æœŸä¸€èµ·ä¼ é€’ç»™é‚£ä¸ªå‡½æ•°(ownsership)ã€‚è¿™æ„å‘³ç€ï¼Œä¸€æ—¦ main()è¢«ä¼ é€’ç»™ do_something()ï¼Œå®ƒå°±ä¸èƒ½è®¿é—® String ç±»å‹çš„åç§°ã€‚ä¸€æ—¦ do_something()æ‰§è¡Œå®Œæ¯•ï¼Œå­—ç¬¦ä¸² memory ç±»å‹çš„è¾“å…¥å˜é‡å°†è¢«åˆ é™¤ã€‚Rust å°±æ˜¯è¿™æ ·ç»´æŠ¤å†…å­˜ç®¡ç†çš„ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†ã€‚

ç°åœ¨ï¼Œä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å°†å‘é€å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯å®é™…çš„å˜é‡ã€‚

```
fn do_something(input: &String) -> String {
    // do something with string
    input.to_string()
}

fn main() {
    let name: String = String::from("Hello!!");
    let result = do_something(&name);
    println!("result is {} for string {}", result, name)
} 
```

[åœ¨æ“åœºä¸Šè·‘](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=f87567843586206219d2bfe6e7922774)

å¦‚æœæ‚¨è¿è¡Œä»¥ä¸Šç¨‹åºï¼Œæ‚¨å°†å¾—åˆ°ä»¥ä¸‹è¾“å‡ºã€‚

```
result is Hello!! for name Hello!! 
```

rust ä¸­çš„ä»»ä½•å˜é‡éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œé™¤éå¦æœ‰è¯´æ˜ã€‚ç°åœ¨è®©æˆ‘ä»¬å°è¯•æ”¹å˜è¾“å…¥ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

```
 fn do_something(input: &String) {
    input.push_str("world!!")
}

fn main() {
    let name: String = String::from("Hello!!");
    do_something(&name);
    println!("result is {} for name", name)
} 
```

[åœ¨æ“åœºä¸Šè·‘æ­¥](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=996ce4ac1573d7b7a3202fe6f9faf82a)

å¦‚æœæ‚¨è¿è¡Œä»¥ä¸Šç¨‹åºï¼Œæ‚¨å°†å¾—åˆ°ä»¥ä¸‹è¾“å‡ºã€‚

```
error[E0596]: cannot borrow `*input` as mutable, as it is behind a `&` reference
 --> src\main.rs:3:5
  |
2 | fn do_something(input: &String) {
  |                        ------- help: consider changing this to be a mutable reference: `&mut std::string::String`
3 |     input.push_str("World!!")
  |     ^^^^^ `input` is a `&` reference, so the data it refers to cannot be borrowed as mutable 
```

å› ä¸ºå€Ÿç”¨çš„å˜é‡æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½æ”¹å˜å®ƒã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è®©åŸå§‹å˜é‡å’Œä¼ é€’å˜é‡éƒ½å˜å¾—å¯å˜ã€‚

```
fn do_something(input: &mut String) {
    input.push_str(" World!!")
}

fn main() {
    let mut name: String = String::from("Hello!!");
    do_something(&mut name);
    println!("result is {} for name", name)
} 
```

[åœ¨æ“åœºä¸Šè·‘](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=ff04818317a5b426e0b026a22f66962b)

å¦‚æœæ‚¨è¿è¡Œä»¥ä¸Šç¨‹åºï¼Œæ‚¨å°†å¾—åˆ°ä»¥ä¸‹è¾“å‡ºã€‚

```
result is Hello!! World!! for name 
```

æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•ç–‘é—®æˆ–å¸®åŠ©ï¼Œå¯ä»¥åœ¨ twitter ä¸Šè”ç³»æˆ‘ã€‚

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åœ¨çº¿ç¨‹é—´åˆ›å»ºå¯å…±äº«çš„å˜é‡ã€‚

æ„Ÿè°¢é˜…è¯»ã€‚ç¥ä½ æ„‰å¿«ï¼