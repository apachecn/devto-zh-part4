# å¦‚ä½•ç”¨ Selenium æµ‹è¯•ä½ çš„ Sylius æ’ä»¶ï¼Ÿ

> åŸæ–‡ï¼š<https://dev.to/kayneth/how-to-test-your-sylius-plugins-with-selenium-38ci>

åœ¨ [Tataragne Interactive](https://www.tataragne.com/) ï¼Œæˆ‘ä»¬ç»å¸¸é€šè¿‡æ’ä»¶å¼€å‘ Sylius çš„åŠŸèƒ½ã€‚æ ¹æ® Javascript å‡½æ•°ï¼Œæˆ‘ä»¬å°† Behat å’Œ Selenium ä¸€èµ·ç”¨äºåœºæ™¯ã€‚

> Behat æ˜¯ä¸€ä¸ªå¼€æºçš„ PHP è¡Œä¸ºé©±åŠ¨å¼€å‘æ¡†æ¶ã€‚BDD æ˜¯ä¸€ç§é€šè¿‡å¼€å‘äººå‘˜å’Œä¸šåŠ¡ä¹‹é—´æŒç»­çš„åŸºäºå®ä¾‹çš„äº¤æµæ¥å¼€å‘è½¯ä»¶çš„æ–¹æ³•ï¼Œè¯¥åº”ç”¨ç¨‹åºæ”¯æŒè¿™ç§æ–¹æ³•ã€‚åœºæ™¯æ˜¯ç”¨ä¸€ç§å«åšå°é»„ç“œçš„ç‰¹æ®Šæ ¼å¼ç¼–å†™çš„ã€‚

é€šè¿‡è¿™ç¯‡åšæ–‡ï¼Œæ‚¨å°†äº†è§£å¦‚ä½•é…ç½® Sylius æ’ä»¶é¡¹ç›®æ¥ä½¿ç”¨ Seleniumã€‚æˆ‘è®¤ä¸ºä½ ä½¿ç”¨çš„æ˜¯ Sylius æ’ä»¶æ¡†æ¶ã€‚

## æ·»åŠ ç¡’åˆ°æˆ‘ä»¬çš„ docker-compose é…ç½®

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª chrome-node(æˆ–è€… firefox)æ¥å·¥ä½œã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªé›†è£…ç®±ã€‚ä¸€ä¸ªç”¨äºé›†çº¿å™¨ï¼Œä¸€ä¸ªç”¨äºèŠ‚ç‚¹ã€‚Hub æ˜¯è¿è¡Œæ‰€æœ‰æµ‹è¯•çš„æœºå™¨ï¼Œä½†æ˜¯ä»£ç å°†åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œå¦‚ Selenium æ–‡æ¡£ä¸­æ‰€è¿°ã€‚

```
# docker-compose.yaml
version: '3.7'

services:
    plugin: # Your app configuration. This is not the subject here

    hub:
        image: selenium/hub:3.11.0
        ports:
            - 4444:4444
        links:
            - plugin

    chrome:
        image: selenium/node-chrome:3.11.0
        #  You can also use this image and open the  container port to one of your host port to be able to use a VNC viewer
        # image: selenium/node-chrome-debug:3.11.0
        depends_on:
            - hub
        links:
            - plugin
        environment:
            - HUB_HOST=hub
            - HUB_PORT=4444
        # ports:
        #     - 5900:5900 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

æœ‰äº†è¿™ä¸ªé…ç½®ï¼Œæ‚¨å°†èƒ½å¤Ÿè¿è¡Œ`docker-compose up -d`å¹¶è½»æ¾åœ°ä½¿ç”¨æ‚¨çš„`behat.yaml`é…ç½®ã€‚

## ä½ éœ€è¦åœ¨ behat.yml ä¸­åšä»€ä¹ˆæ”¹å˜æ‰èƒ½è¿è¡Œ Selenium

å¯¹ Behat é…ç½®çš„æ›´æ”¹éå¸¸ç®€å•ã€‚

é¦–å…ˆï¼Œä½ å¯ä»¥æ›´æ”¹`Behat\MinkExtension`çš„`base_url`ï¼Œè¿™å–å†³äºä½ ä¹‹å‰ä¸ºåº”ç”¨ç¨‹åºè®¾ç½®çš„å†…å®¹ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œin å¯èƒ½åªæ˜¯ç®€å•åœ°è¢«`"http://plugin:80/"`ä»¥æˆ‘çš„å®¹å™¨ä¸ºç›®æ ‡(ä¸å®‰å…¨ğŸ˜…)ç«¯å£ 80ã€‚

å…¶æ¬¡ï¼Œä½ å¿…é¡»å°†ä½ çš„ Hub ä¸»æœºæ·»åŠ åˆ°ä½ çš„ chrome ä¼šè¯ä¸­ã€‚ç®€å•åœ°åœ¨ chrome ä¼šè¯çš„`selenium2`é…ç½®ä¸­æ·»åŠ ä¸€ä¸ªé”®`wd_host`ã€‚

ç¬¬ä¸‰ï¼Œä½ å¯ä»¥åœ¨èƒ½åŠ›ä¸­è®¾ç½®`javascriptEnabled`åˆ°`true`ã€‚

éµå¾ªä¸‹é¢çš„é…ç½®ç¤ºä¾‹ã€‚

```
Behat\MinkExtension:
    files_path: "%paths.base%/vendor/sylius/sylius/src/Sylius/Behat/Resources/fixtures/"
    base_url: "http://plugin:80/"  # Adapt this
    default_session: symfony
    javascript_session: chrome
    sessions:
        symfony:
            symfony: ~
        chrome:
            selenium2:
                browser: chrome
                wd_host: http://hub:4444/wd/hub # Add this
                capabilities:
                    browserName: chrome
                    browser: chrome
                    version: ""
                    marionette: null # https://github.com/Behat/MinkExtension/pull/311
                    javascriptEnabled: true  # Add this
                    chrome:
                        switches:
                            - "start-fullscreen"
                            - "start-maximized"
                            - "no-sandbox" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

ğŸ‰ğŸ‰ğŸ‰æ‚¨çš„é…ç½®ç°åœ¨å·²ç»å°±ç»ªğŸ‰ğŸ‰ğŸ‰

æ­£å¦‚æœ¬æœŸ SymfonyExtension æ‰€è¿°ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€ä¸ª`Session "symfony" is not registered.`ã€‚æ‚¨å¯ä»¥åœ¨é€€æ¬¾æ’ä»¶ä¸­å…³æ³¨ [#138 æ‹‰å¼è¯·æ±‚çš„å˜åŒ–ã€‚](https://github.com/Sylius/RefundPlugin/pull/138/files)

æˆ‘å¸Œæœ›è¿™ç¯‡åšæ–‡èƒ½å¸®åŠ©ä½ åœ¨ Sylius æ’ä»¶ä¸­é…ç½®ä½ çš„ç®¡ç†æˆ–å•†åº—åœºæ™¯ã€‚æˆ‘å¸Œæœ›èƒ½å¤Ÿåœ¨ä»¥åçš„æ–‡ç« ä¸­è®¨è®ºåœ¨ Gitlab CI ä½œä¸šä¸­è¿è¡Œè¿™äº›æµ‹è¯•ã€‚ğŸ’ª