# é¡µé¢å¯è§æ€§ APIï¼Œè®©æˆ‘ä»¬å¸®åŠ©ç”¨æˆ·èŠ‚çœç”µæ± å¯¿å‘½å’Œæ•°æ®ğŸ˜€

> åŸæ–‡:[https://dev . to/ya shints/page-visibility-API-let-s-help-users-save-their-battery-life-and-data-2 moa](https://dev.to/yashints/page-visibility-api-let-s-help-users-save-their-battery-life-and-data-2moa)

ä½ æƒ³è¦é‚£äº›å¼€ç€ 200 ä¸ªæ ‡ç­¾çš„äººå—ï¼Ÿä½ æ˜¯å¦åŒå€¦äº†ä¸€ç›´å¸¦ç€ç¬”è®°æœ¬å……ç”µå™¨ï¼Ÿå—¯ï¼Œæˆ‘åœ¨è¿™é‡Œè®©ä½ çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“å¦‚ä½•ä½¿ç”¨**é¡µé¢å¯è§æ€§ API** ï¼Œæˆ‘ä»¬å¯ä»¥å¸®åŠ©ç”¨æˆ·èŠ‚çœç”µæ± ã€æ•°æ®å’Œæ—¶é—´ã€‚

## [](#the-why)è¿™ä¸ªä¸ºä»€ä¹ˆ

å‡è®¾æ‚¨çš„ç”¨æˆ·æ‰“å¼€äº†å‡ ä¸ªé€‰é¡¹å¡ï¼Œä¸€ä¸ªè¿è¡Œæ²‰é‡çš„åŠ¨ç”»ï¼Œå¦ä¸€ä¸ªä»æœåŠ¡å™¨è·å–å¤§é‡æ•°æ®ï¼Œå¦ä¸€ä¸ªè¿è¡Œ YouTube ä¸Šçš„è§†é¢‘ã€‚è¿™äº›éƒ½éœ€è¦ç”¨æˆ·ç”µè„‘çš„èµ„æºï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶æ‰“å¼€å‡ ä¸ªæ ‡ç­¾ï¼Œä½ ä¼šçªç„¶æ„è¯†åˆ°ä½ çš„ç”µæ± å¿«æ²¡ç”µäº†ï¼Œæˆ–è€…ä½ çš„æ•°æ®é™é¢å¿«ç”¨å®Œäº†ã€‚

> ğŸ’¡å¦‚æœä½ å¯ä»¥åœ¨ç”¨æˆ·æ²¡æœ‰çœ‹æ ‡ç­¾é¡µ/çª—å£çš„æ—¶å€™æš‚åœå½“å‰çš„æ“ä½œï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ

æœ‰äº†`Page Visibility API`ï¼Œä½ å°±å¯ä»¥åšåˆ°ã€‚

## [](#page-visibility-api)é¡µé¢å¯è§æ€§ API

è¿™ä¸ª API å…è®¸å¼€å‘è€…çŸ¥é“ç”¨æˆ·æ˜¯å¦å·²ç»å¤±å»äº†å¯¹é¡µé¢çš„å…³æ³¨ï¼Œæˆ–è€…å·²ç»å†æ¬¡è¿”å›åˆ°é¡µé¢ã€‚å½“ç”¨æˆ·æœ€å°åŒ–æˆ–è€…åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæ ‡ç­¾é¡µ/çª—å£æ—¶ï¼ŒAPI ä¼šå‘é€ä¸€ä¸ª`visibilitychange`äº‹ä»¶è®©ç›‘å¬å™¨çŸ¥é“é¡µé¢çš„çŠ¶æ€ã€‚

é¡µé¢å¯è§æ€§ API æ˜¯ä½ å·¥å…·ç®±ä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå½“é¡µé¢å¯¹ç”¨æˆ·ä¸å¯è§æ—¶ï¼Œå®ƒå¯ä»¥è®©ä½ ä¸æ‰§è¡Œä¸å¿…è¦çš„æ“ä½œã€‚

è¯¥ API å‘`Document`æ¥å£æ·»åŠ äº†ä»¥ä¸‹å±æ€§:

*   `hidden`:åªè¯»å±æ€§ï¼Œå¦‚æœé¡µé¢å¤„äºå¯¹ç”¨æˆ·éšè—çš„çŠ¶æ€ï¼Œåˆ™è¿”å› trueã€‚
*   `visibilityState`:è¡¨ç¤ºå•æ®å½“å‰å¯è§çŠ¶æ€çš„ [`DOMString`](https://developer.mozilla.org/en-US/docs/Web/API/DOMString) ã€‚å®ƒå¯ä»¥æœ‰å››ä¸ªå€¼ï¼Œ`visible`ã€`hidden`ã€`prerender`å’Œ`unloaded`ã€‚

æ‚¨è¿˜å¯ä»¥ç›‘å¬`visibilitychange`äº‹ä»¶ï¼Œè¯¥äº‹ä»¶å°†åœ¨å¯è§æ€§æ”¹å˜æ—¶è§¦å‘æ‚¨çš„å›è°ƒå‡½æ•°:

```
function handleVisibilityChange () {
    if (document.hidden) {
        // stop that task ğŸ›‘
    } else {
        // you can start it again go â–¶ï¸
    }
}

document.addEventListener('visibilitychange', handleVisibilityChange, false); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#-raw-visibilitystate-endraw-)`visibilityState`

å¦‚å‰æ‰€è¿°ï¼Œè¯¥å±æ€§å¯ä»¥æœ‰å››ä¸ªä¸åŒçš„å€¼ï¼Œæ¯ä¸ªå€¼ä»£è¡¨ä¸€ä¸ªä¸åŒçš„é€‰é¡¹å¡/çª—å£çŠ¶æ€:

*   **å¯è§**:è¡¨ç¤ºæ ‡ç­¾é¡µ/çª—å£å¯è§æˆ–éƒ¨åˆ†å¯è§ã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ„å‘³ç€è¯¥é¡µé¢æ˜¯éæœ€å°åŒ–çª—å£çš„å‰æ™¯æ ‡ç­¾ã€‚
*   **éšè—**:é¡µé¢å› æœ€å°åŒ–æˆ–è®¾å¤‡å±å¹•å…³é—­è€Œä¸å¯è§ã€‚
*   é¢„å‘ˆç°å™¨:é¡µé¢æ­£åœ¨è¢«é¢„å‘ˆç°ï¼Œç”¨æˆ·çœ‹ä¸åˆ°ã€‚
*   **å¸è½½**:è¡¨ç¤ºç”¨æˆ·å³å°†å…³é—­å½“å‰é¡µé¢ã€‚

> âš ï¸ä½ éœ€è¦çŸ¥é“ä¸æ˜¯æ‰€æœ‰çš„æµè§ˆå™¨éƒ½æ”¯æŒåä¸¤ç§çŠ¶æ€ã€‚

## [](#demo)æ¼”ç¤º

æœ€ç®€å•çš„åœºæ™¯æ˜¯åœ¨é¡µé¢ä¸Šæ’­æ”¾è§†é¢‘ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä»¥æ­¤ä¸ºä¾‹ã€‚è®©æˆ‘ä»¬åœ¨é¡µé¢ä¸Šä½¿ç”¨ä¸€ä¸ªç®€å•çš„è§†é¢‘å…ƒç´ ï¼Œå½“ç”¨æˆ·èšç„¦åœ¨å¦ä¸€ä¸ªæ ‡ç­¾ä¸Šæ—¶ï¼Œè¿™ä¸ªå…ƒç´ ä¼šæš‚åœã€‚

```
<body>
    <h1>Demo: Page Visibility API</h1>

    <main>
        <video id="videoElement" 
               poster="http://media.w3.org/2010/05/sintel/poster.png" width="400"
               controls="" >
           <source id='mp4' src="http://media.w3.org/2010/05/sintel/trailer.mp4" type='video/mp4'/>
        <source id='webm' src="http://media.w3.org/2010/05/sintel/trailer.webm" type='video/webm'/>
        <source id='ogv' src="http://media.w3.org/2010/05/sintel/trailer.ogv" type='video/ogg'/>
            <p>Sorry, there's a problem playing this video. Please try using a different browser</p>
        </video>
    </main>

    <script>    

    (function() {
        'use strict';

        // Set the name of the "hidden" property and the change event for visibility
        var hidden, visibilityChange; 
        if (typeof document.hidden !== "undefined") {
          hidden = "hidden";
          visibilityChange = "visibilitychange";
        } else if (typeof document.mozHidden !== "undefined") { // Firefox up to v17
          hidden = "mozHidden";
          visibilityChange = "mozvisibilitychange";
        } else if (typeof document.webkitHidden !== "undefined") { // Chrome up to v32, Android up to v4.4, Blackberry up to v10
          hidden = "webkitHidden";
          visibilityChange = "webkitvisibilitychange";
        }

        var videoElement = document.getElementById("videoElement");

        // If the page is hidden, pause the video;
        // if the page is shown, play the video
        function handleVisibilityChange() {
          if (document[hidden]) {
            videoElement.pause();
          } else {
            videoElement.play();
          }
        }

        // Warn if the browser doesn't support addEventListener or the Page Visibility API
        if (typeof document.addEventListener === "undefined" || typeof document[hidden] === "undefined") {
          alert("This demo requires a modern browser that supports the Page Visibility API.");
        } else {
          // Handle page visibility change 
          document.addEventListener(visibilityChange, handleVisibilityChange, false);

          // When the video pauses and plays, change the title.
          videoElement.addEventListener("pause", function(){
            document.title = 'Paused';
          }, false);

          videoElement.addEventListener("play", function(){
            document.title = 'Playing'
          }, false);
        }

    })();
    </script>

</body> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æ‰€åšçš„å°±æ˜¯è·å–å¯¹è§†é¢‘å…ƒç´ çš„å¼•ç”¨ï¼Œå¹¶æŒ‚é’©åˆ°`visibilitychange`äº‹ä»¶ã€‚å½“é¡µé¢éšè—æ—¶ï¼Œæˆ‘ä»¬åªéœ€æš‚åœè§†é¢‘ã€‚ä¸€æ—¦ç„¦ç‚¹å›æ¥ï¼Œæˆ‘ä»¬å°±æ’­æ”¾å®ƒã€‚

[![Simples](img/11aa43529289a1fd5267d49c0089a822.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--5z35xPF4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/d6eg0xliu2zp2fm264cp.jpg)

æˆ‘åœ¨ Glitch ä¸Šåˆ›å»ºäº†ä¸€ä¸ª [live ç‰ˆæœ¬ï¼Œä½ å¯ä»¥çœ‹çœ‹ã€‚æ’­æ”¾è§†é¢‘å¹¶ç‚¹å‡»å¦ä¸€ä¸ªæ ‡ç­¾ã€‚è§†é¢‘ä¼šæš‚åœï¼Œä¸€æ—¦ä½ å›æ¥ï¼Œå®ƒä¼šå†æ¬¡æ’­æ”¾ã€‚](https://aluminum-argon.glitch.me)

## [](#summary)æ€»ç»“

ä¸€ä¸ªå¥½çš„ web åº”ç”¨ä¸ä¸€å®šéœ€è¦çƒ­é—¨çš„åŠŸèƒ½å’Œä»¤äººå°è±¡æ·±åˆ»çš„ UXã€‚æœ‰æ—¶å€™ï¼Œä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ web åº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·çš„å¸å¼•åŠ›æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚å¸Œæœ›è¿™ç¯‡å°æ–‡ç« èƒ½å¸®åŠ©ä½ åœ¨å¾ˆå¤šæ–¹é¢å¸®åŠ©ä½ çš„ç”¨æˆ·ã€‚

å¿«ä¹æ¢ç´¢ğŸ˜Šã€‚