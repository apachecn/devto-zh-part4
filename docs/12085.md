# ç”¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯é‡å®šå‘(Netlify å’Œ Gatsby)å¯¹æŠ—é“¾æ¥è…çƒ‚

> åŸæ–‡ï¼š<https://dev.to/swyx/fight-link-rot-with-server-and-client-side-redirects-netlify-and-gatsby-29jn>

é“¾æ¥æ–­å¼€ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ç”¨é‡å®šå‘æ¥å¯¹æŠ—ç½‘ç«™ä¸Šçš„é“¾æ¥è…è´¥ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡å™¨ç«¯é‡å®šå‘

éšç€ç½‘ç«™éœ€æ±‚çš„å¢é•¿ï¼ŒURL æ¶æ„ä¸€ç›´åœ¨å˜åŒ–ã€‚ä»¥`/my-post`å¼€å¤´çš„ï¼Œå°†æ¥å¯ä»¥å˜æˆ`@swyx/my-post`æˆ–`posts/my-post`æˆ–`news/2019/my-post`ã€‚

è€ƒè™‘ç”¨æˆ·ä½“éªŒã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨åšä¸€äº›æ·±å…¥çš„ç ”ç©¶ï¼Œåœ¨ç¿»äº†å‡ ä¸ªå°æ—¶çš„è°·æ­Œæœç´¢ç»“æœåï¼Œä½ å‘ç°äº†ä¸€ä¸ªå¯ä»¥è§£å†³ä½ æ‰€æœ‰é—®é¢˜çš„é“¾æ¥ã€‚ä½ ç‚¹å‡»å®ƒï¼Œç½‘ç«™ä»ç„¶åœ¨è¿è¡Œï¼Œä½†ä½ çœ‹åˆ°çš„åªæ˜¯ä¸€ä¸ª 404 é¡µé¢ï¼å¦‚æœå†…å®¹è¿˜åœ¨ï¼Œå¸Œæœ›ç½‘ç«™æœ‰æœç´¢åŠŸèƒ½æ‰¾åˆ°å®ƒï¼Œæˆ–è€…è°·æ­Œç´¢å¼•å®ƒã€‚å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå°é—®é¢˜ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªè´Ÿè´£ä»»çš„ç½‘ç«™ç®¡ç†å‘˜ï¼Œä½ åº”è¯¥ä¸ºä½ çš„ç”¨æˆ·é¿å…è¿™ä¸ªé—®é¢˜ã€‚

è€ƒè™‘åˆ°åƒ[ç¤¾äº¤åª’ä½“å±•å¼€](https://medium.com/slack-developer-blog/everything-you-ever-wanted-to-know-about-unfurling-but-were-afraid-to-ask-or-how-to-make-your-e64b4bb9254)è¿™æ ·çš„è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹ï¼Œä»¥åŠç”µå­é‚®ä»¶/RSS/ç½‘ç«™æŠ“å–å™¨ä¼šç®€å•åœ°å´©æºƒï¼Œæ‰€ä»¥â€œä¸è¦ç ´åç½‘ç»œâ€çš„åŸåˆ™å˜å¾—æ›´åŠ è¿«åˆ‡ã€‚

åœ¨æœ€åŸºæœ¬çš„å½¢å¼ä¸­ï¼Œæ‚¨ä¼šå¸Œæœ›ä» URL A é‡å®šå‘åˆ° URL B:

```
/my-broken-url   ->  /posts/my-new-url 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é€šå¸¸æ˜¯é€šè¿‡è®¾ç½®ä¸€ä¸ª[æ¥å®ç°çš„ã€‚htaccess](http://www.htaccess-guide.com/) æ–‡ä»¶æˆ–è€…[æœåŠ¡å™¨é‡å®šå‘](https://expressjs.com/en/4x/api.html#res.redirect)ã€‚

ä¸€å¯¹ä¸€é‡å®šå‘æ˜¯éå¸¸å¯å®šåˆ¶çš„ï¼Œä½†æ˜¯å¯¹äºæ‚¨å¯èƒ½éœ€è¦é‡å®šå‘çš„å¤§é‡å¸–å­æ¥è¯´å¯èƒ½æ— æ³•æ‰©å±•ã€‚

Netlify é€šè¿‡ [Netlify é‡å®šå‘](https://www.netlify.com/docs/redirects/?utm_source=blog&utm_medium=devto&utm_campaign=devex)æä¾›äº†æ›´å¼ºå¤§çš„é‡å®šå‘é…ç½®ã€‚æ‚¨å¯ä»¥ä½¿ç”¨[å ä½ç¬¦](https://www.netlify.com/docs/redirects/?utm_source=blog&utm_medium=devto&utm_campaign=devex#placeholders)æ¥å£°æ˜æ€§åœ°é‡æ–°æ’åˆ— URLã€‚æ‚¨å¯ä»¥[ä»£ç†æ— æœåŠ¡å™¨åŠŸèƒ½](https://www.netlify.com/docs/redirects/?utm_source=blog&utm_medium=devto&utm_campaign=devex#rewrites-and-proxying)ã€‚ä½ å¯ä»¥ä½¿ç”¨åŸºäº cookie çš„è¯­è¨€é‡å®šå‘ã€‚æˆ‘æœ€å–œæ¬¢çš„ï¼Œéƒ¨åˆ†æ˜¯å› ä¸ºè¯´èµ·æ¥å¾ˆæœ‰è¶£ï¼Œæ˜¯[çš„ splat åŠŸèƒ½](https://www.netlify.com/docs/redirects/?utm_source=blog&utm_medium=devto&utm_campaign=devex#splats) :

```
/posts/*  /news/:splat 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æœ‰ç‚¹åƒ URL çš„ä¼ æ’­æ“ä½œç¬¦ã€‚

å½“ä½ çš„é‡å®šå‘è¢«è®¿é—®æ—¶ï¼Œæœç´¢å¼•æ“ç´¢å¼•ä¼šç›¸åº”åœ°æ›´æ–°ã€‚

ç„¶è€Œï¼Œåœ¨ç°ä»£å•é¡µåº”ç”¨çš„æ—¶ä»£ï¼Œè¿™å¹¶ä¸æ˜¯å…¨éƒ¨ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦å®¢æˆ·ç«¯é‡å®šå‘

æœåŠ¡å™¨ç«¯é‡å®šå‘è´Ÿè´£**ç«™ç‚¹é—´é“¾æ¥**:åœ¨**å…¶ä»–**ç«™ç‚¹é€šè¿‡æ–­å¼€çš„é“¾æ¥è¿›å…¥ä½ çš„ç«™ç‚¹çš„æƒ…å†µã€‚

å®¢æˆ·ç«¯é‡å®šå‘è§£å†³äº†**ç«™ç‚¹å†…é“¾æ¥**çš„æƒ…å†µ:å½“ä½ è‡ªå·±çš„ç«™ç‚¹é“¾æ¥åˆ°ä½ ç«™ç‚¹ä¸­çš„å…¶ä»–é¡µé¢ï¼Œé€šè¿‡ JavaScript å‘ˆç°ï¼Œæ‰€ä»¥å®ƒä¸é€šè¿‡æœåŠ¡å™¨åˆ·æ–°ï¼Œå¹¶ä¸”é“¾æ¥æ–­å¼€ã€‚

å•é¡µé¢åº”ç”¨ç¨‹åºä½¿ç”¨[å®¢æˆ·ç«¯è·¯ç”±](https://codeburst.io/client-side-routing-done-right-3464275778bf)æ¥é¿å…æ•´ä¸ªé¡µé¢åˆ·æ–°(æˆ‘æœ€è¿‘æ‰çŸ¥é“[å¹¶ä¸æ€»æ˜¯æ›´å¿«](https://carter.sande.duodecima.technology/javascript-page-navigation/)ï¼TIL)ã€‚è¿™å¯¹äºé“¾è·¯è…çƒ‚æœ‰ä¸¤ä¸ªä¸»è¦çš„å«ä¹‰ã€‚

ç¬¬ä¸€ç§ä¹Ÿæ˜¯æœ€ç®€å•çš„æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªåŸºæœ¬çš„å•é¡µåº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ç”±`create-react-app`åˆ›å»ºçš„ï¼Œå®é™…ä¸Šä¸éœ€è¦ä¸€é•¿ä¸²å¤æ‚çš„æœåŠ¡å™¨ç«¯é‡å®šå‘ã€‚åªéœ€å»ºç«‹ä¸€ä¸ªç®€å•çš„å•é¡µåº”ç”¨ç¨‹åº T2ï¼Œè®©å®¢æˆ·ç«¯è·¯ç”±å¤„ç†ä¸€åˆ‡ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¹Ÿå¯ä»¥åªåœ¨å®¢æˆ·ç«¯è®¾ç½®é‡å®šå‘ã€‚æ‰€æœ‰ JavaScript æ¡†æ¶éƒ½æ”¯æŒè¿™ä¸€ç‚¹ï¼Œä» [React Router](https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/api/Redirect.md) åˆ° [Vue Router](https://router.vuejs.org/guide/essentials/redirect-and-alias.html) ã€‚è¿™å…è®¸æˆ‘ä»¬åœ¨ä¸è·¯ç”±(å½“å‰è·¯ç”±)ç›¸åŒçš„ä»£ç åº“/ä½ç½®ä¸­ç®¡ç†æˆ‘ä»¬çš„é‡å®šå‘(æ—§è·¯ç”±)ã€‚

è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯åœ¨å®Œå…¨é¡µé¢åˆ·æ–°æ—¶è§£æé¡µé¢çš„è¿‡ç¨‹ç›¸å½“è¿‚å›ã€‚é¦–å…ˆç‚¹å‡»`/my-old-url`ï¼Œç„¶åæœåŠ¡å™¨ä¸º`/`æä¾›å®¢æˆ·ç«¯æ†ç»‘åŒ…ï¼Œå®¢æˆ·ç«¯è§£æå¹¶å‘ˆç°ï¼Œå®¢æˆ·ç«¯è¯»å–`/my-old-url`ï¼Œç„¶åé‡å®šå‘åˆ°`/posts/my-new-url`ã€‚

é“¾æ¥è…çƒ‚çš„å®¢æˆ·ç«¯è·¯ç”±çš„ç¬¬äºŒä¸ªå«ä¹‰æ˜¯ï¼Œåƒ Gatsby è¿™æ ·çš„ç°ä»£ JavaScript é™æ€ç«™ç‚¹ç”Ÿæˆå™¨é¢ä¸´ä¸€ä¸ªæ··åˆé—®é¢˜ï¼Œå³æ¯ä¸ªé™æ€ç”Ÿæˆçš„é¡µé¢çš„åŒ…å¿…é¡»è¿›è¡Œå®¢æˆ·ç«¯è·¯ç”±ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›é…ç½®æœåŠ¡å™¨ç«¯ catchalls(ä»¥ç®€å•çš„å•é¡µé¢åº”ç”¨ç¨‹åºæ–¹å¼),å¦åˆ™æˆ‘ä»¬å°†å¤±å»ä½¿ç”¨é™æ€ç«™ç‚¹ç”Ÿæˆå™¨çš„å…¨éƒ¨å¥½å¤„ã€‚

ç”¨ Gatsby è®¾ç½®å®¢æˆ·ç«¯é‡å®šå‘éå¸¸å®¹æ˜“ï¼Œå› ä¸º [`createRedirect`](https://www.gatsbyjs.org/docs/actions/#createRedirect) æ˜¯ä¸€æµçš„ APIã€‚è¿™é€šè¿‡å‡ ä¸ªæ’ä»¶å˜å¾—æ›´å®¹æ˜“ï¼Œæ¯”å¦‚[Gatsby-plugin-client-side-redirect](https://www.gatsbyjs.org/packages/gatsby-plugin-client-side-redirect/)æˆ– [gatsby-redirect-from](https://www.gatsbyjs.org/packages/gatsby-redirect-from/) ï¼Œå®ƒä»¬éƒ½ä½¿å¾—é‡å®šå‘ç¨å¾®å®¹æ˜“ç¼–å†™ã€‚ç”šè‡³æœ‰é»‘å®¢[ä½¿ç”¨å…ƒæ ‡ç­¾](https://www.gatsbyjs.org/packages/gatsby-plugin-meta-redirect/?=redirect)çš„é‡å®šå‘æ’ä»¶ï¼Œä»¥åŠç”¨äºåœ¨å¿«é€ŸæœåŠ¡å™¨ä¸Šä¸ºç›–èŒ¨æ¯”æœåŠ¡çš„[ã€‚](https://www.gatsbyjs.org/packages/gatsby-plugin-express/?=redirect)

## æœªæ‰¾åˆ°å†…å®¹çš„é—ªçƒ

åœ¨å®¢æˆ·ç«¯é‡å®šå‘å’Œæ²¡æœ‰æœåŠ¡å™¨ç«¯é‡å®šå‘çš„æƒ…å†µä¸‹ä½¿ç”¨ SSG çš„ç¼ºç‚¹æ˜¯ï¼Œæ‚¨å°†é¦–å…ˆå‘ˆç°æœªæ‰¾åˆ°çš„é¡µé¢ï¼Œç›´åˆ° JavaScript åŠ è½½å¹¶æ¥ç®¡ã€‚å¯¼è‡´å¯æ€•çš„**æœªæ‰¾åˆ°å†…å®¹çš„é—ªç°**(å¼€ç©ç¬‘ï¼Œæˆ‘ç¼–çš„):

[![](img/d0f609431bfdf68e4e9758278f9fb4f7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--1wi4yG0F--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/f0abqrjbvzb2fh0we4jv.gif)

## åŒæ—¶ä½¿ç”¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯é‡å®šå‘

è¡¨é¢ä¸Šï¼Œè¿™é‡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯å»ºç«‹å¹¶è¡Œçš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯é‡å®šå‘ã€‚æ‚¨å¯èƒ½å¸Œæœ›[è‡ªåŠ¨ç”Ÿæˆã€‚htaccess æ–‡ä»¶](https://www.gatsbyjs.org/packages/gatsby-plugin-htaccess-redirects/?=redirect)å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Apache æœåŠ¡å™¨ï¼Œæˆ–è€…ä½¿ç”¨ [Netlify Redirects](https://www.netlify.com/docs/redirects/?utm_source=blog&utm_medium=devto&utm_campaign=devex) æ¥è®¾ç½®é‡å®šå‘çš„å¹¶è¡Œå®ç°ã€‚

æ‚¨ç”šè‡³å¯ä»¥ç¼–å†™ä¸€ä¸ªå·¥å…·æ¥è‡ªåŠ¨è¾“å‡ºè¿™äº›é‡å®šå‘...ğŸ¤”