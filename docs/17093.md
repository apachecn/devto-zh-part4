# è®¾å¤‡ä¸Šè°ƒè¯•ç¬¬äºŒéƒ¨åˆ†:Timbeeeeeeerï¼

> åŸæ–‡:[https://dev . to/zmdominguez/on-device-debugging-part-ii-timbeeeeeer-1827](https://dev.to/zmdominguez/on-device-debugging-part-ii-timbeeeeeeer-1827)

åœ¨è¿‡å»çš„ä¸€å¹´é‡Œï¼Œæˆ‘çš„å›¢é˜Ÿä¸€ç›´åœ¨ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ„å»ºä¸€ä¸ªå¼€å‘è€…é€‰é¡¹å±å¹•ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ [`PreferenceScreen`](https://developer.android.com/reference/androidx/preference/PreferenceScreen.html) ï¼Œå¯ä»¥åœ¨è°ƒè¯•ç‰ˆæœ¬ä¸­è·å¾—ï¼Œæ—¨åœ¨å¸®åŠ©æˆ‘ä»¬:

*   ä¸éœ€è¦è¿æ¥åˆ°ç”µè„‘å°±èƒ½çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ
*   æ— éœ€é‡æ–°å®‰è£…å³å¯æµ‹è¯•å„ç§é…ç½®
*   ä¸»æŒæˆ‘ä»¬æ­£åœ¨å°è¯•æ¢ç´¢çš„å„ç§å®éªŒ

åœ¨è¿™ä¸€ç³»åˆ—çš„å¸–å­ä¸­ï¼Œæˆ‘å°†åˆ†äº«è¿™äº›ä¸åŒçš„é€‰é¡¹æ˜¯ä»€ä¹ˆï¼Œä»¥åŠæˆ‘ä»¬æ˜¯å¦‚ä½•åšå‡ºå®ƒä»¬çš„ã€‚

(å¦‚æœä½ ä¸ç†Ÿæ‚‰ [`PreferenceFragmentCompat`](https://developer.android.com/reference/kotlin/androidx/preference/PreferenceFragmentCompat.html) ï¼Œæˆ‘å¼ºçƒˆå»ºè®®åœ¨ç»§ç»­ä¹‹å‰å…ˆé˜…è¯»ä¸€ä¸‹ã€‚ä½ å¯ä»¥ä»è¿™ä¸ª [AndroidX æŒ‡å—](https://developer.android.com/guide/topics/ui/settings.html)å¼€å§‹è®¾ç½®ã€‚)

çœ‹ç¬¬ä¸€éƒ¨åˆ†(ç°åœ¨å¼€ï¼Œç°åœ¨å…³)[è¿™é‡Œ](https://zarah.dev/2019/06/22/debug-options-toggles.html)ã€‚

* * *

æˆ‘ä»¬åœ¨ Woolworths ç»å¸¸ä½¿ç”¨çš„å·¥å…·ä¹‹ä¸€æ˜¯[æœ¨æ](https://github.com/JakeWharton/timber)ã€‚æˆ‘ä»¬ä¸ä»…ä½¿ç”¨å®ƒæ¥å¸®åŠ©æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­è¿›è¡Œè°ƒè¯•ï¼Œè¿˜åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å°½æ—©å‘ç°é—®é¢˜ï¼Œå¹¶å…³æ³¨ç”Ÿäº§ä¸­çš„æƒ…å†µã€‚

ä»¥å‰ï¼Œå½“æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨äºæµ‹è¯•çš„æ„å»ºå¹¶ä¸”äº‹æƒ…æ²¡æœ‰æŒ‰è®¡åˆ’è¿›è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¼šæ”¶åˆ°ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„æˆªå›¾:

<center>
[![](../Images/5714fa86e770c6a57a9dea0bfbe77e64.png "source: imgur.com")](https://imgur.com/Bzleb1m)

<small>Uh ğŸ™€</small>
</center>

æˆ‘ä»¬è¯•å›¾æ‰¾å‡ºä»–ä»¬åœ¨åº”ç”¨ç¨‹åºå´©æºƒå‰è¯•å›¾åšçš„äº‹æƒ…ï¼Œå¤åˆ¶ä»–ä»¬ä¹‹å‰çš„ç¡®åˆ‡æƒ…å†µï¼Œå¹¶è¯•äº†åˆè¯•ã€‚æ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ’ä¸Šäº†â€œé‚£ä¸åº”è¯¥å‘ç”Ÿâ€çš„å¢™â€”â€”å°½ç®¡å®ƒæ˜¾ç„¶å·²ç»å‘ç”Ÿäº†ã€‚ğŸ¤¦â€â™€ï¸

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ±‚åŠ©äºæœ¨æã€‚æˆ‘ä»¬è®°å½•ä¸‹è¿™äº›â€œæˆ‘ä»¬ä¸åº”è¯¥æ¥è¿™é‡Œï¼ï¼!"ä½¿ç”¨`Timber.e`çš„åœºæ™¯ã€‚åœ¨ç”Ÿäº§ä¸­ï¼Œè¿™äº›æ—¥å¿—é€šè¿‡`Crashlytics.log()`å‘é€åˆ° Fabricã€‚åœ¨è°ƒè¯•ç‰ˆæœ¬ä¸­ï¼Œè¿™äº›æ—¥å¿—è¢«å‘é€åˆ°å´©æºƒæ—¥å¿—å±å¹•ã€‚

è¿™ä¸ªå±å¹•æ˜¾ç¤ºäº† stacktrace(å¦‚æœæœ‰çš„è¯),ä»¥åŠä¸€äº›å…³äºæ„å»ºå’Œè®¾å¤‡çš„åŸºæœ¬ä¿¡æ¯ã€‚æˆ‘ä»¬è¿˜å†³å®šä½¿ç”¨è¿™ä¸ªå±å¹•æ¥è®°å½•ä»»ä½•æœªæ•è·çš„å¼‚å¸¸ã€‚å±å¹•åº•éƒ¨æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œé€šè¿‡[æ„å›¾é€‰æ‹©å™¨](https://developer.android.com/training/sharing/send)å‘é€å´©æºƒæ—¥å¿—ã€‚

<center>
[![](../Images/61e2af1024e3c943f9c8d8876aded7ed.png "source: imgur.com")](https://imgur.com/StEAFvr)

<small>Crash log screen variations</small>
</center>

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¦†ç›–äº†`Timber`çš„`e` :

```
class LoggingTree(private val app: Application) : Timber.DebugTree() {

    override fun e(message: String, vararg args: Any) {
        super.e(message, *args)
        printStackTrace(null, message, *args)
    }

    override fun e(t: Throwable, message: String?, vararg args: Any) {
        super.e(t, message, *args)
        printStackTrace(t, message, *args)
    } 
```

å¹¶ä¸”`printStackTrace`ç®€å•åœ°å°†ä¿¡æ¯ä¼ é€’ç»™æ˜¾ç¤ºé”™è¯¯çš„ä¸“ç”¨`Activity`ã€‚

æˆ‘ä»¬ç”¨`CrashType` :
ä½œä¸ºé¢å¤–çš„`Intent`æ¥æä¾›è¿™ç§é”™è¯¯

```
enum class LogType(val additionalMessage: String, @ColorRes val background: Int) {
    UNCAUGHT_EXCEPTION("!!! DO NOT IGNORE! THIS WILL CAUSE A CRASH IN PRODUCTION !!!", R.color.error_color),

    LOG("We are monitoring an issue. You may still send this log if you want.", R.color.white);
} 
```

å´©æºƒå±å¹•çš„å®ç°éå¸¸ç®€å•ï¼Œæˆ‘ä»¬æ£€ç´¢é¢å¤–çš„å†…å®¹ï¼Œå¹¶ä½¿ç”¨æ•°æ®ç»‘å®šæ¥æ˜¾ç¤ºæ¶ˆæ¯å’Œæ ·å¼åŒ–æ ‡é¢˜ã€‚(å‡ºäºå¥½å¥‡ï¼Œæˆ‘ä¹‹å‰å†™è¿‡å…³äºåœ¨æ•°æ®ç»‘å®šä¸­ä½¿ç”¨èµ„æºå¼•ç”¨çš„

å› ä¸ºæˆ‘ä»¬ä¹Ÿä½¿ç”¨å´©æºƒæ—¥å¿—å±å¹•æ¥å¤„ç†æœªæ•è·çš„å¼‚å¸¸ï¼Œæ‰€ä»¥å½“å‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨`Activity`ã€‚è¿™æ„å‘³ç€å®ƒè·³è¿‡äº†`Timber`å¤„ç†ï¼Œä½†æ˜¯æœ‰æ—¶åœ¨ Logcat ä¸­æŸ¥çœ‹æ—¥å¿—ä»ç„¶æ˜¯æœ‰ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿåœ¨é‚£é‡Œè®°å½• stack trace:

```
@SuppressLint("LogNotTimber")
override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    // ...

    // We still want to display the stack trace in Logcat for uncaught exceptions
    // but are not using Timber.e here lest we get into an infinite loop
    Log.e("FIXME", Log.getStackTraceString(stackTrace))

} 
```

å±å¹•åº•éƒ¨çš„â€œå‘é€å´©æºƒâ€æŒ‰é’®å‘å‡ºä¸€ä¸ª`ACTION_SEND` `Intent`ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥é€šè¿‡ç”µå­é‚®ä»¶ã€Slack æˆ–ä»–ä»¬é€‰æ‹©çš„ä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºå‘é€ä¿¡æ¯(æˆ‘ä¹Ÿåœ¨è¿™é‡Œå†™äº†é‚£ä¸ªï¼).

è¿™ä¼¼ä¹æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼Œä½†å®ƒä¸€æ¬¡åˆä¸€æ¬¡åœ°å¸®åŠ©æˆ‘ä»¬ä»¥æ›´æœ‰æ„ä¹‰çš„æ–¹å¼å¿«é€Ÿè§£å†³é—®é¢˜ã€‚å³ä½¿é‚£äº›å¸®åŠ©æˆ‘ä»¬æµ‹è¯•çš„äººé€‰æ‹©å‘é€æˆªå›¾ï¼Œä¹Ÿæœ‰æ›´å¤šçš„ç›¸å…³ä¿¡æ¯ï¼Œè€Œä¸æ˜¯é€šç”¨çš„å´©æºƒå¯¹è¯æ¡†ã€‚ğŸ’