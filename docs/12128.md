# Javascript ä¸­çš„ CJSã€AMDã€UMD å’Œ ESM åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ

> åŸæ–‡ï¼š<https://dev.to/iggredible/what-the-heck-are-cjs-amd-umd-and-esm-ikm>

ä¸€å¼€å§‹ï¼ŒJavascript æ²¡æœ‰å¯¼å…¥/å¯¼å‡ºæ¨¡å—çš„æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåªç”¨ä¸€ä¸ªæ–‡ä»¶ç¼–å†™ä½ çš„åº”ç”¨ç¨‹åºï¼Œé‚£å°†æ˜¯ä¸€åœºå™©æ¢¦ï¼

ç„¶åï¼Œæ¯”æˆ‘èªæ˜å¾—å¤šçš„äººè¯•å›¾ç»™ Javascript æ·»åŠ æ¨¡å—åŒ–ã€‚å…¶ä¸­ä¸€äº›æ˜¯ CJSã€AMDã€UMD å’Œ ESMã€‚ä½ å¯èƒ½å¬è¯´è¿‡å…¶ä¸­çš„ä¸€äº›(è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Œä½†è¿™äº›æ˜¯å¤§ç©å®¶)ã€‚

æˆ‘å°†ä»‹ç»é«˜å±‚æ¬¡çš„ä¿¡æ¯:è¯­æ³•ã€ç›®çš„å’ŒåŸºæœ¬è¡Œä¸ºã€‚æˆ‘çš„ç›®æ ‡æ˜¯å¸®åŠ©è¯»è€…åœ¨é‡å¤–çœ‹åˆ°å®ƒä»¬æ—¶è®¤å‡ºå®ƒä»¬ğŸ’¡ã€‚

# [t1 çš„ç‰¹å¾](#cjs)

CJS æ˜¯ CommonJS çš„ç¼©å†™ã€‚ä¸‹é¢æ˜¯å®ƒçš„æ ·å­:

```
//importing 
const doSomething = require('./doSomething.js'); 

//exporting
module.exports = function doSomething(n) {
  // do something
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   ä½ ä»¬ä¸­çš„ä¸€äº›äººå¯èƒ½ä¼šç«‹å³ä» node ä¸­è®¤å‡º CJS è¯­æ³•ã€‚è¿™æ˜¯å› ä¸ºèŠ‚ç‚¹[ä½¿ç”¨ CJS æ¨¡å—æ ¼å¼](https://blog.risingstack.com/node-js-at-scale-module-system-commonjs-require/)ã€‚
*   CJS åŒæ­¥å¯¼å…¥æ¨¡å—ã€‚
*   æ‚¨å¯ä»¥ä»åº“`node_modules`æˆ–æœ¬åœ°ç›®å½•å¯¼å…¥ã€‚è¦ä¹ˆæ˜¯ç”±`const myLocalModule = require('./some/local/file.js')`è¦ä¹ˆæ˜¯`var React = require('react');`çš„ä½œå“ã€‚
*   å½“ CJS å¯¼å…¥æ—¶ï¼Œå®ƒä¼šç»™ä½ ä¸€ä¸ªå¯¼å…¥å¯¹è±¡çš„**å‰¯æœ¬**ã€‚
*   CJS ä¸èƒ½åœ¨æµè§ˆå™¨ä¸­å·¥ä½œã€‚å®ƒå¿…é¡»è¢«è¿è¾“å’Œæ‰“åŒ…ã€‚

# AMD

AMD ä»£è¡¨å¼‚æ­¥æ¨¡å—å®šä¹‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç :

```
define(['dep1', 'dep2'], function (dep1, dep2) {
    //Define the module value by returning a value.
    return function () {};
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ–è€…

```
// "simplified CommonJS wrapping" https://requirejs.org/docs/whyamd.html
define(function (require) {
    var dep1 = require('dep1'),
        dep2 = require('dep2');
    return function () {};
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   AMD å¼‚æ­¥å¯¼å…¥æ¨¡å—(å› æ­¤å¾—å)ã€‚
*   AMD[æ˜¯ä¸ºå‰ç«¯](http://tagneto.blogspot.com/2011/04/on-inventing-js-module-formats-and.html)åšçš„(å½“å®ƒè¢«æå‡ºçš„æ—¶å€™)(è€Œ CJS æ˜¯åç«¯)ã€‚
*   AMD çš„è¯­æ³•ä¸å¦‚ CJS ç›´è§‚ã€‚æˆ‘è®¤ä¸º AMD æ˜¯ CJS çš„å¯¹ç«‹é¢ã€‚

# UMD

UMD ä»£è¡¨é€šç”¨æ¨¡å—å®šä¹‰ã€‚ä¸‹é¢æ˜¯å®ƒçš„æ ·å­([æ¥æº](http://bob.yexley.net/umd-javascript-that-runs-anywhere/) ):

```
(function (root, factory) {
    if (typeof define === "function" && define.amd) {
        define(["jquery", "underscore"], factory);
    } else if (typeof exports === "object") {
        module.exports = factory(require("jquery"), require("underscore"));
    } else {
        root.Requester = factory(root.$, root._);
    }
}(this, function ($, _) {
    // this is where I defined my module implementation

    var Requester = { // ... };

    return Requester;
})); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   å·¥ä½œäºå‰ç«¯å’Œåç«¯(å› æ­¤å¾—å*é€šç”¨*)ã€‚
*   ä¸ CJS æˆ– AMD ä¸åŒï¼ŒUMD æ›´åƒæ˜¯ä¸€ç§é…ç½®å¤šä¸ªæ¨¡å—ç³»ç»Ÿçš„æ¨¡å¼ã€‚æŸ¥çœ‹[æ­¤å¤„](https://github.com/umdjs/umd/)äº†è§£æ›´å¤šæ¨¡å¼ã€‚
*   ä½¿ç”¨ Rollup/ Webpack ç­‰æ†ç»‘å™¨æ—¶ï¼ŒUMD é€šå¸¸ç”¨ä½œåå¤‡æ¨¡å—

# ESM

ESM ä»£è¡¨ ES æ¨¡å—ã€‚å®ç°ä¸€ä¸ª[æ ‡å‡†çš„](https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/)æ¨¡å—ç³»ç»Ÿæ˜¯ Javascript çš„æè®®ã€‚æˆ‘ç›¸ä¿¡ä½ ä»¬å¾ˆå¤šäººéƒ½çœ‹è¿‡è¿™ä¸ª:

```
import React from 'react'; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å…¶ä»–é‡å¤–ç›®å‡»:

```
import {foo, bar} from './myLib';

...

export default function() {
  // your Function
};
export const function1() {...};
export const function2() {...}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   é€‚ç”¨äºè®¸å¤šç°ä»£æµè§ˆå™¨
*   å®ƒæ‹¥æœ‰ä¸¤ä¸ªä¸–ç•Œçš„ç²¾å:CJS å¼çš„ç®€å•è¯­æ³•å’Œ AMD çš„å¼‚æ­¥
*   [å¯æ‘‡æ ‘](https://developers.google.com/web/fundamentals/performance/optimizing-javascript/tree-shaking/)ï¼Œç”±äº ES6 çš„[é™æ€æ¨¡å—ç»“æ„](https://exploringjs.com/es6/ch_modules.html#static-module-structure)
*   ESM å…è®¸åƒ Rollup è¿™æ ·çš„æ†ç»‘å™¨[åˆ é™¤ä¸å¿…è¦çš„ä»£ç ](https://dev.to/bennypowers/you-should-be-using-esm-kn3)ï¼Œå…è®¸ç«™ç‚¹å‘é€æ›´å°‘çš„ä»£ç ä»¥è·å¾—æ›´å¿«çš„åŠ è½½ã€‚
*   å¯ä»¥åœ¨ HTML ä¸­è°ƒç”¨ï¼Œåªéœ€åš:

```
<script type="module">
  import {func1} from 'my-lib';

  func1();
</script> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å¯èƒ½ä¸æ˜¯åœ¨æ‰€æœ‰çš„æµè§ˆå™¨ä¸­éƒ½ 100%æœ‰æ•ˆã€‚

# æ€»ç»“

*   ESM æ˜¯æœ€å¥½çš„æ¨¡å—æ ¼å¼ï¼Œè¿™è¦å½’åŠŸäºå®ƒçš„ç®€å•è¯­æ³•ã€å¼‚æ­¥ç‰¹æ€§å’Œæ ‘çš„å¯æ‘‡åŠ¨æ€§ã€‚
*   UMD æ— å¤„ä¸åœ¨ï¼Œé€šå¸¸è¢«ç”¨ä½œåº”æ€¥æœºåˆ¶ä¸èµ·ä½œç”¨æ—¶çš„é€€è·¯
*   CJS æ˜¯åŒæ­¥çš„ï¼Œé€‚åˆåç«¯ã€‚
*   AMD æ˜¯å¼‚æ­¥çš„ï¼Œé€‚åˆå‰ç«¯ã€‚

æ„Ÿè°¢é˜…è¯»ï¼Œå¾·å¤«æ–¯ï¼åœ¨æœªæ¥ï¼Œæˆ‘è®¡åˆ’æ·±å…¥åœ°å†™æ¯ä¸ªæ¨¡å—ï¼Œå°¤å…¶æ˜¯ ESMï¼Œå› ä¸ºå®ƒåŒ…å«äº†è®¸å¤šä»¤äººæƒŠå¹çš„ä¸œè¥¿ã€‚æ•¬è¯·æœŸå¾…ï¼

å¦‚æœä½ æ³¨æ„åˆ°ä»»ä½•é”™è¯¯ï¼Œè¯·è®©æˆ‘çŸ¥é“ã€‚

# èµ„æº:

*   [åŸºæœ¬ js æ¨¡å—](https://www.freecodecamp.org/news/anatomy-of-js-module-systems-and-building-libraries-fadcd8dbd0e/)
*   [èŠ‚ç‚¹ä¸­çš„ CJS](https://blog.risingstack.com/node-js-at-scale-module-system-commonjs-require/)
*   [CJs-ESM æ¯”è¾ƒ](https://jsmodules.io/cjs.html)
*   [å‘æ˜ JS æ¨¡å—æ ¼å¼å’Œè„šæœ¬åŠ è½½å™¨](http://tagneto.blogspot.com/2011/04/on-inventing-js-module-formats-and.html)
*   [ä¸ºä»€ä¹ˆè¦ç”¨ AMD](https://requirejs.org/docs/whyamd.html)
*   [es6 æ¨¡å—æµè§ˆå™¨å…¼å®¹æ€§](https://caniuse.com/#feat=es6-module)
*   [é€šè¿‡æ‘‡æ ‘å‡å°‘ JS æœ‰æ•ˆè½½è·](https://developers.google.com/web/fundamentals/performance/optimizing-javascript/tree-shaking/)
*   [JS æ¨¡å—-é™æ€ç»“æ„](https://exploringjs.com/es6/ch_modules.html#static-module-structure)
*   [æµè§ˆå™¨ä¸­çš„ ESM](https://jakearchibald.com/2017/es-modules-in-browsers/)
*   [ES æ¨¡å—æ·±æ½œ-å¡é€š](https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/)
*   [ä½¿ç”¨ ESM çš„ç†ç”±](https://dev.to/bennypowers/you-should-be-using-esm-kn3)