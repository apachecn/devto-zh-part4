# åœ¨ä¸åŒçš„æ¡†æ¶ä¸­å®‰è£… React ç»„ä»¶

> åŸæ–‡:[https://dev . to/eljenso/react-component-mounting-in-a-different-framework-10mm](https://dev.to/eljenso/react-component-mounting-in-a-different-framework-10mm)

æˆ‘ä»¬æ­£åœ¨è¿›è¡Œçš„é¡¹ç›®æœ€åˆæ˜¯ä¸€ä¸ª [Backbone.js](https://backbonejs.org/) é¡¹ç›®ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨å¼€å§‹å°† React é›†æˆåˆ°å…¶ä¸­ã€‚
è¿™ç¯‡æ–‡ç« ä¸æ˜¯å…³äºèƒŒåçš„æ¨ç†ï¼Œè€Œæ˜¯å…³äºä¸€äº›ä¸åŒçš„ä¸œè¥¿:
æˆ‘ä»¬å¦‚ä½•åœ¨ä¸»å¹²åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨(æˆ–å®‰è£…)React ç»„ä»¶ã€‚

å½“æˆ‘ä»¬ä»å¤´å¼€å§‹ç¼–å†™ä¸€ä¸ªæ–°çš„ React åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„ entrypoint ç»„ä»¶ï¼Œé€šå¸¸ç§°ä¸º`App`ï¼Œå¹¶é€šè¿‡ ReactDOM å°†å®ƒæŒ‚è½½åˆ°ç°æœ‰ DOM ä¸­çš„æŸä¸ªä½ç½®:
`ReactDOM.render(<App />, document.getElementById("root"));`ã€‚
ç„¶åæˆ‘ä»¬å°†å¼€å§‹å¼€å‘åº”ç”¨ç¨‹åºï¼Œå®ƒå®Œå…¨é©»ç•™åœ¨é‚£ä¸ª`App`ç»„ä»¶ä¸­ã€‚

ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨å¦ä¸€ä¸ªæ¡†æ¶(åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­æ˜¯ä¸»å¹²)ç¼–å†™çš„ç°æœ‰åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬ç°åœ¨æƒ³åœ¨å…¶ä¸­ä½¿ç”¨ React æ—¶ï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†ã€‚æˆ‘ä»¬çš„é€‰æ‹©æ˜¯:

1.  ä»å¤´å¼€å§‹é‡å†™æ•´ä¸ªåº”ç”¨ç¨‹åº
2.  ç”¨ React å®ç°æ–°ç‰¹æ€§ï¼Œåœ¨è¿‡ç¨‹ä¸­æ…¢æ…¢ç”¨ React ä»£ç æ›¿ä»£ Backbone.js ä»£ç 

å‡ºäºè®¸å¤šåŸå› (å¯èƒ½ä¼šåœ¨ä»¥åçš„å¸–å­ä¸­è®¨è®º)ï¼Œæˆ‘ä»¬é€‰æ‹©äº†é€‰é¡¹ 2ã€‚

* * *

è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦é›†æˆåˆ°ç°æœ‰åº”ç”¨ç¨‹åºä¸­çš„æ–°ç»„ä»¶:

```
function CounterButton() {
  // Define state using hooks
  const [count, setCount] = React.useState<number>(0);

  // Return button displaying current state and incrementing state on click
  return (
    <button onClick={
      () => setCount(count + 1)
    }>
      {count}
    </button>
  )
} 
```

ç»„ä»¶å‘ˆç°ä¸€ä¸ªæŒ‰é’®ï¼Œæ˜¾ç¤ºç”¨æˆ·ç‚¹å‡»å®ƒçš„é¢‘ç‡ã€‚
è¯¥ç»„ä»¶æœ‰ä¸€ä¸ªçŠ¶æ€`count`ï¼Œåˆå§‹è®¾ç½®ä¸º`0`ï¼Œä»¥åŠç›¸åº”çš„è®¾ç½®å™¨åŠŸèƒ½`setCount`ã€‚

ç°åœ¨ï¼Œä¸ºäº†åœ¨æŸå¤„å°†`CounterButton`æ·»åŠ åˆ°æˆ‘ä»¬ç°æœ‰çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`ReactDOM.render`å°†å…¶æ¸²æŸ“åˆ°ç°æœ‰çš„ DOM å…ƒç´ :
`ReactDOM.render(<CounterButton />, document.getElementById("someElement"));`ã€‚

æˆ‘ä»¬å®Œäº†ã€‚

* * *

æˆ‘ä»¬å¤§æ¦‚æ˜¯è¿™æ ·è®¤ä¸ºçš„ã€‚

å¦‚æœæ‚¨å¸Œæœ›ä»¥ååœ¨ç›¸åŒçš„åœ°æ–¹é‡ç”¨ç›¸åŒçš„ç»„ä»¶ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿä¾‹å¦‚ä¸€ä¸ªæ¨¡æ€(ä¹Ÿç§°ä¸ºå¯¹è¯)ï¼Œç”¨æˆ·åœ¨æŸä¸€ç‚¹å…³é—­ï¼Œä½†æœ€ç»ˆå¯èƒ½ä¼šå†æ¬¡æ‰“å¼€ã€‚

è®©æˆ‘ä»¬ç»™`CounterButton`ç»„ä»¶æ·»åŠ ä¸€ä¸ª`show`çŠ¶æ€ï¼Œå¯ä»¥è®©`<button>`æ¶ˆå¤±:

```
function CounterButton() {
  // Define state using hooks
  const [count, setCount] = React.useState(0);
  const [show, setShow] = React.useState(true);

  // Return button displaying current state and incrementing state on click
  if (!show) {
    return null;
  }
  return (
    <button onClick={
      () => {
        if (count === 5) {
          setShow(false);
        }
        setCount(count + 1);
      }
    }>
      {count}
    </button>
  )
} 
```

å¦‚æœ`!show`ä¸ºçœŸï¼Œé‚£ä¹ˆ`CounterButton`å°†è¿”å›`null`ï¼Œå½“`show`çŠ¶æ€ä»`true`å˜ä¸º`false`æ—¶ï¼Œä» DOM ä¸­å®Œå…¨åˆ é™¤`<button>`ã€‚
åœ¨è¿™é‡Œï¼Œè¿™æ˜¯ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶`count`ä¸º`5`çš„æƒ…å†µã€‚

è¿™ä¸ªé€»è¾‘æ˜¯æˆ‘ä»¬ç›®å‰ç”¨æ¥å…³é—­ä¸€ä¸ªæ¨¡æ€çš„ã€‚
å½“ç”¨æˆ·è§¦å‘è¯¥æ¨¡æ€çš„å…³é—­é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬å°†`show`çŠ¶æ€è®¾ç½®ä¸º`false`ï¼Œè¿™å°†å¯¼è‡´è¯¥æ¨¡æ€ä» DOM ä¸­ç§»é™¤..

ä½†æ˜¯å¦‚æœä½ æƒ³åœ¨å®ƒæ¶ˆå¤±åå†æ¬¡æ˜¾ç¤º`CounterButton`å‘¢ï¼Ÿ
ç®€å•åœ°å†æ¬¡æ‰§è¡Œä¸‹é¢çš„è°ƒç”¨ï¼Œå¯¹å—ï¼Ÿ
`ReactDOM.render(<CounterButton />, document.getElementById("someElement"));`
é—æ†¾çš„æ˜¯ï¼Œ`CounterButton`ä¸ä¼šéœ²é¢ã€‚

ä»[ååº”æ–‡ä»¶](https://reactjs.org/docs/react-dom.html#render):

> å¦‚æœ React å…ƒç´ ä»¥å‰å·²ç»å‘ˆç°åœ¨ container ä¸­ï¼Œé‚£ä¹ˆè¿™ä¼šå¯¹å®ƒæ‰§è¡Œæ›´æ–°ï¼Œå¹¶ä¸”åªåœ¨å¿…è¦æ—¶æ”¹å˜ DOM ä»¥åæ˜ æœ€æ–°çš„ React å…ƒç´ ã€‚

æ¢å¥è¯è¯´ï¼ŒReactDOM å°†åƒä»¥å‰ä¸€æ ·æ¸²æŸ“*å®ä¾‹*ï¼Œåªæ˜¯ä½¿ç”¨äº†æ›´æ–°çš„é“å…·ã€‚
React ä¼šä½¿ç”¨ä¹‹å‰ç”¨è¿‡çš„`CounterButton`çš„å®ä¾‹ï¼ŒçŠ¶æ€ä¸å˜:`show`è¿˜æ˜¯`false`ã€‚

æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜çš„ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯æ¯æ¬¡åœ¨ä¼ é€’ç»™`ReactDOM.render`ä¹‹å‰åˆ›å»ºä¸€ä¸ªæ–°çš„`CounterButton`å®ä¾‹ã€‚
ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†`CounterButton`å‡½æ•°çš„ä¸»ä½“å°è£…åœ¨ä¸€ä¸ªç®­å¤´å‡½æ•°ä¸­ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŒ¿åçš„åŠŸèƒ½ç»„ä»¶ã€‚`CounterButton`ç°åœ¨å°†è¿”å›è¿™ä¸ªåŒ¿ååŠŸèƒ½ç»„ä»¶:

```
function CounterButton() {
  return () => {
    // Define state using hooks
    const [count, setCount] = React.useState(0);
    const [show, setShow] = React.useState(true);

    // Return button displaying current state and incrementing state on click
    if (!show) {
      return null;
    }
    return (
      <button onClick={
        () => {
          if (count === 5) {
            setShow(false);
          }
          setCount(count + 1);
        }
      }>
        {count}
      </button>
    )
  }
}

// Create new functional component to pass into ReactDOM.render
const CounterButtonInstance = CounterButton();
ReactDOM.render(<CounterButtonInstance  />, document.getElementById("root")); 
```

æ— è®ºæˆ‘ä»¬ç”¨è¿”å›`CounterButton()`åˆ°`document.getElementById("root")`çš„æ–¹å¼è°ƒç”¨`ReactDOM.render`å¤šå°‘æ¬¡ï¼Œ`ReactDOM.render`æ€»æ˜¯å°†è¿™ä¸ªåŒ¿åçš„åŠŸèƒ½ç»„ä»¶è§†ä¸ºä¸ä¹‹å‰çš„ç»„ä»¶ä¸åŒçš„ç»„ä»¶ã€‚
é‚£æ˜¯å› ä¸ºå®ƒ*æ˜¯*ä¸€ä¸ªä¸åŒçš„åŒ¿ååŠŸèƒ½ç»„ä»¶ã€‚

ä½†æ˜¯è¿™ç§æ–¹æ³•è‡³å°‘æœ‰ä¸€ä¸ªé—®é¢˜:
`CounterButton`ä¸å†æ˜¯åŠŸèƒ½ç»„ä»¶ï¼Œè€Œæ˜¯è¿”å›åŠŸèƒ½ç»„ä»¶çš„å‡½æ•°ã€‚
è¿™ä½¿å¾—åœ¨ React åº”ç”¨ç¨‹åºä¸­é‡ç”¨`CounterButton`å˜å¾—ä¸å¯èƒ½ã€‚

ç°åœ¨ï¼Œå¯¹äºæˆ‘ä»¬å½“å‰çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬åˆ é™¤äº†ä¸Šä¸€ä¸ªä»£ç ç‰‡æ®µä¸­å¼•å…¥çš„å°è£…ã€‚
ç›¸åï¼Œæˆ‘ä»¬åˆ©ç”¨ç‰¹æ®Šç»„ä»¶é“å…·`key`ï¼Œé˜…è¯»æ›´å¤šå…³äºå®ƒçš„[ååº”æ–‡æ¡£](https://reactjs.org/docs/lists-and-keys.html) :

```
ReactDOM.render(
  <CounterButton key={new Date().getTime()} />, document.getElementById("root") ); 
```

æˆ‘ä»¬åœ¨è¿™é‡Œåˆ©ç”¨äº†`key`å±æ€§çš„ä¸€ä¸ªé‡è¦å±æ€§:å¦‚æœ React å°†è¦é‡æ–°æ¸²æŸ“ä¸€ä¸ªç»„ä»¶ï¼Œè€Œè¿™ä¸ªç»„ä»¶çš„`key` *åœ¨ä¸Šæ¬¡æ¸²æŸ“å*å‘ç”Ÿäº†å˜åŒ–ï¼ŒReact å°†ä¼šä¸¢å¼ƒä¹‹å‰çš„ç‰ˆæœ¬å¹¶ä»å¤´å¼€å§‹æ¸²æŸ“ã€‚
æˆ‘ä»¬ä½¿ç”¨å½“å‰æ—¶é—´(ä»¥æ¯«ç§’ä¸ºå•ä½)ä½œä¸ºè¯¥å±æ€§çš„å€¼ï¼›ç”±äºè¿™å°†åœ¨æ¸²æŸ“ä¹‹é—´æ”¹å˜ï¼ŒReact å°†ç”¨ä¸€ä¸ªæ–°çš„çŠ¶æ€åˆ›å»ºä¸€ä¸ªæ–°çš„`CounterButton`å®ä¾‹ï¼ğŸ‰

ä¸‹é¢ä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå±•ç¤ºè¿™ç§æ–¹æ³•çš„ä»£ç ç¬”ã€‚
æŒ‰å‡ ä¸‹é‚£ä¸ªæŒ‰é’®ï¼Œå®ƒå°±ä¼šæ¶ˆå¤±ï¼Œå†ä¹Ÿä¸ä¼šå›æ¥ã€‚
ä½†æ˜¯å¦‚æœä½ å–æ¶ˆé‚£äº›å…³é”®é“å…·çš„æ³¨é‡Šï¼Œ`CounterButton`å°†æ¯ 2 ç§’é‡ç½®ä¸€æ¬¡ã€‚

[https://codepen.io/eljenso/embed/WqZzQq?height=600&default-tab=js,result&embed-version=2](https://codepen.io/eljenso/embed/WqZzQq?height=600&default-tab=js,result&embed-version=2)

* * *

*ä¸€äº›äº‹åçš„æƒ³æ³•*

å¯¹äºåŒ¿åå‡½æ•°ç»„ä»¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¼•å…¥å¦ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¿”å›åŸå§‹çš„`CounterButton` :

```
function CreateCounterButton() {
  return () => CounterButton()
} 
```

è°ƒç”¨`CreateCounterButton`å°†åœ¨æ¯æ¬¡è°ƒç”¨æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„`CounterButton`å®ä¾‹ã€‚è¿™å°†ä¿æŒæˆ‘ä»¬çš„`CounterButton`å¯é‡å¤ä½¿ç”¨ã€‚

ä¸Šé¢æè¿°çš„ä»»ä½•æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªç¼ºç‚¹:
`CounterButton`ä»ç„¶æ˜¯ ReactDOM çš„ä¸€éƒ¨åˆ†ï¼Œå³ä½¿åœ¨å®ƒä» DOM ä¸­ç§»é™¤ä¹‹åã€‚
æˆ‘ä»¬åº”è¯¥ç¡®ä¿`CounterButton`ä¸€æ—¦ä¸å†è¢«ä½¿ç”¨ï¼Œå°±æ­£ç¡®åœ°ä» ReactDOM ä¸­å¸è½½ï¼›å¦åˆ™ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å†…å­˜æ³„æ¼ï¼Œè¿™ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚
ReactDOM æä¾›äº†ä¸€ä¸ª`unmountComponentAtNode(container)`æ–¹æ³•ï¼Œå…è®¸å¸è½½ä»»ä½•å®‰è£…åœ¨`container`ä¸­çš„ React ç»„ä»¶ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†è¿™æ ·ä½¿ç”¨å®ƒ:

```
ReactDOM.unmountComponentAtNode(document.getElementById("root")) 
```

ä½†æ˜¯ç”±äº`CounterButton`ä¸çŸ¥é“ï¼Œä¹Ÿä¸åº”è¯¥çŸ¥é“å®ƒå¿…é¡»ä»¥è¿™ç§æ–¹å¼å¸è½½ï¼Œæ‰€ä»¥åº”è¯¥ä»å¤–éƒ¨å¤„ç†è¿™ä¸ªè°ƒç”¨ã€‚

æˆ‘ä»¬è¿˜æ²¡æœ‰è¿›ä¸€æ­¥ç ”ç©¶å¦‚ä½•ä½¿ç”¨`unmountComponentAtNode`ã€‚
ç”±äºæˆ‘ä»¬è¿˜æ²¡æœ‰å¾ˆå¤š React ç»„ä»¶(æˆ‘ä»¬ç›®å‰åœ¨ä»£ç åº“ä¸­æœ‰å¤§çº¦ 40 ä¸ª tsx æ–‡ä»¶)ï¼Œæ‰€ä»¥`key` prop æ–¹æ³•ä¼¼ä¹å·²ç»è¶³å¤Ÿäº†ã€‚ä¸€æ—¦è®¤ä¸ºå°†æœªä½¿ç”¨çš„ç»„ä»¶ç•™åœ¨ ReactDOM ä¸­ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œæˆ‘ä»¬åº”è¯¥è¿›ä¸€æ­¥ç ”ç©¶è¿™ç§æ–¹æ³•ã€‚