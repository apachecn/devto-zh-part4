# å°† React useState æŒ‚é’©ä¸ TypeScript ä¸€èµ·ä½¿ç”¨

> åŸæ–‡:[https://dev . to/miloszpp/using-react-use state-hook-with-typescript-3d3h](https://dev.to/miloszpp/using-react-usestate-hook-with-typescript-3d3h)

React æŒ‚é’©æ˜¯ React æœ€è¿‘å¢åŠ çš„ä¸€é¡¹åŠŸèƒ½ï¼Œå®ƒä½¿å‡½æ•°ç»„ä»¶å…·æœ‰ä¸ç±»ç»„ä»¶å‡ ä¹ç›¸åŒçš„åŠŸèƒ½ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨ TypeScript ä¸­ä½¿ç”¨ React æŒ‚é’©å¾ˆç®€å•ã€‚

ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ·±å…¥ç†è§£é’©å­çš„ç±»å‹å¯èƒ½ä¼šéå¸¸æœ‰ç”¨ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å…³æ³¨äº`useState`é’©å­ã€‚

æˆ‘å‡è®¾ä½ å¯¹è¿™ä¸ªé’©å­æœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ã€‚å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œè¯·å…ˆé˜…è¯»[è¿™ä¸ª](https://reactjs.org/docs/hooks-state.html)ã€‚

## [](#reading-the-types)é˜…è¯»ç±»å‹

é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹`useState`çš„ç±»å‹ç­¾åã€‚æ‚¨å°†çœ‹åˆ°ï¼Œä¸çœ‹æ–‡æ¡£(æˆ–å®ç°)ï¼Œåªä»ç±»å‹ä¸­å¯ä»¥æå–å¤šå°‘ä¿¡æ¯ã€‚

å¦‚æœä½ åªå¯¹å®é™…ä¾‹å­æ„Ÿå…´è¶£ï¼Œè·³åˆ°[ä¸‹ä¸€èŠ‚](#Usage-examples)ã€‚

### [](#overloads)è¶…è½½

```
function useState<S = undefined>(): [S | undefined, Dispatch<SetStateAction<S | undefined>>];
function useState<S>(initialState: S | (() => S)): [S, Dispatch<SetStateAction<S>>]; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚ä½ æ‰€è§ï¼Œ`useState`å‡½æ•°æœ‰ä¸¤ä¸ª*ç‰ˆæœ¬*ã€‚TypeScript å…è®¸æ‚¨ä¸ºä¸€ä¸ªå‡½æ•°å®šä¹‰å¤šä¸ªç±»å‹ç­¾åï¼Œå› ä¸ºåœ¨ JavaScript ä¸­ï¼Œä¸€ä¸ªå‡½æ•°é€šå¸¸æ”¯æŒä¸åŒç±»å‹çš„å‚æ•°ã€‚ä¸€ä¸ªå‡½æ•°çš„å¤šä¸ªç±»å‹ç­¾åè¢«ç§°ä¸º**é‡è½½**ã€‚

è¿™ä¸¤ç§é‡è½½éƒ½æ˜¯æ³›å‹å‡½æ•°ã€‚ç±»å‹å‚æ•°`S`è¡¨ç¤ºé’©å­å­˜å‚¨çš„çŠ¶æ€çš„ç±»å‹ã€‚ç¬¬äºŒä¸ªé‡è½½ä¸­çš„ç±»å‹å‚æ•°å¯ä»¥ä»`initialState`ä¸­æ¨æ–­å‡ºæ¥ã€‚ç„¶è€Œï¼Œåœ¨ç¬¬ä¸€ä¸ªé‡è½½ä¸­ï¼Œå®ƒé»˜è®¤ä¸º`undefined`ï¼Œé™¤éæ˜¾å¼æä¾›ç±»å‹å‚æ•°ã€‚**å¦‚æœä¸å°†åˆå§‹çŠ¶æ€ä¼ é€’ç»™`useState`ï¼Œåº”è¯¥æ˜¾å¼æä¾›ç±»å‹å‚æ•°ã€‚**

### [](#-raw-usestate-endraw-parameters)`useState`å‚æ•°

ç¬¬ä¸€ä¸ªé‡è½½ä¸å¸¦ä»»ä½•å‚æ•°â€”â€”å®ƒåœ¨æ‚¨è°ƒç”¨`useState`è€Œä¸æä¾›ä»»ä½•åˆå§‹çŠ¶æ€æ—¶ä½¿ç”¨ã€‚

ç¬¬äºŒä¸ªé‡è½½æ¥å—`initialState`ä½œä¸ºå‚æ•°ã€‚å®ƒçš„ç±»å‹æ˜¯`S`å’Œ`() => S`çš„è”åˆã€‚ä¸ºä»€ä¹ˆè¦ä¼ é€’ä¸€ä¸ªè¿”å›åˆå§‹çŠ¶æ€çš„å‡½æ•°è€Œä¸æ˜¯ç›´æ¥ä¼ é€’åˆå§‹çŠ¶æ€ï¼Ÿè®¡ç®—åˆå§‹çŠ¶æ€å¯èƒ½å¾ˆæ˜‚è´µã€‚åªæœ‰åœ¨å®‰è£…ç»„ä»¶æ—¶æ‰éœ€è¦å®ƒã€‚ä½†æ˜¯ï¼Œåœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œå®ƒå°†åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è®¡ç®—ã€‚**å› æ­¤ï¼Œä½ å¯ä»¥é€‰æ‹©ä¼ é€’ä¸€ä¸ªè®¡ç®—åˆå§‹çŠ¶æ€çš„å‡½æ•°â€”â€”æ˜‚è´µçš„è®¡ç®—å°†åªæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ¸²æŸ“ã€‚**

### [](#-raw-usestate-endraw-return-type)`useState`è¿”å›ç±»å‹

è®©æˆ‘ä»¬è½¬åˆ°è¿”å›ç±»å‹ã€‚ä¸¤ç§æƒ…å†µä¸‹éƒ½æ˜¯ä¸€ä¸ª**å…ƒç»„**ã€‚Tuple å°±åƒä¸€ä¸ªå…·æœ‰ç‰¹å®šé•¿åº¦çš„æ•°ç»„ï¼ŒåŒ…å«ç‰¹å®šç±»å‹çš„å…ƒç´ ã€‚

å¯¹äºç¬¬äºŒæ¬¡é‡è½½ï¼Œè¿”å›ç±»å‹ä¸º`[S, Dispatch<SetStateAction<S>>]`ã€‚å…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å…·æœ‰ç±»å‹`S`â€”â€”çŠ¶æ€å—çš„ç±»å‹ã€‚å®ƒå°†åŒ…å«ä»ç»„ä»¶çŠ¶æ€ä¸­æ£€ç´¢çš„å€¼ã€‚

ç¬¬äºŒä¸ªå…ƒç´ çš„ç±»å‹æ˜¯`Dispatch<SetStateAction<S>>`ã€‚`Dispatch<A>`è¢«ç®€å•åœ°å®šä¹‰ä¸º`(value: A) => void`â€”â€”ä¸€ä¸ªå–å€¼ä¸è¿”å›å€¼çš„å‡½æ•°ã€‚`SetStateAction<S>`å®šä¹‰ä¸º`S | ((prevState: S) => S)`ã€‚æ‰€ä»¥`Dispatch<SetStateAction<S>>`çš„ç±»å‹å…¶å®å°±æ˜¯`(value: S | ((prevState: S) => S)) => void`ã€‚å®ƒæ˜¯ä¸€ä¸ªæ¥å—çŠ¶æ€çš„æ›´æ–°ç‰ˆæœ¬çš„å‡½æ•°ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªåŸºäºå…ˆå‰ç‰ˆæœ¬äº§ç”Ÿæ›´æ–°ç‰ˆæœ¬çš„å‡½æ•°ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºç”±`setState`è¿”å›çš„å…ƒç»„çš„ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨å®ƒæ¥æ›´æ–°ç»„ä»¶çš„çŠ¶æ€ã€‚

ç¬¬ä¸€ä¸ªé‡è½½çš„è¿”å›ç±»å‹æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è¿™é‡Œç”¨`S | undefined`ä»£æ›¿äº†`S`ã€‚å¦‚æœæˆ‘ä»¬ä¸æä¾›åˆå§‹çŠ¶æ€ï¼Œå®ƒå°†æœ€åˆå­˜å‚¨`undefined`ã€‚è¿™æ„å‘³ç€`undefined`å¿…é¡»åŒ…å«åœ¨é’©å­å­˜å‚¨çš„çŠ¶æ€ç±»å‹ä¸­ã€‚

## [](#usage-examples)ç”¨æ³•ä¸¾ä¾‹

å¤§å¤šæ•°æ—¶å€™ä½ ä¸éœ€è¦è´¹å¿ƒä¸º`useState`æä¾›ç±»å‹å‚æ•°â€”â€”ç¼–è¯‘å™¨ä¼šä¸ºä½ æ¨æ–­å‡ºæ­£ç¡®çš„ç±»å‹ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç±»å‹æ¨æ–­å¯èƒ½æ˜¯ä¸å¤Ÿçš„ã€‚

### [](#empty-initial-state)ç©ºåˆå§‹çŠ¶æ€

ç¬¬ä¸€ç§æƒ…å†µæ˜¯ä½ ä¸æƒ³ç»™`useState`æä¾›åˆå§‹çŠ¶æ€ã€‚

æ­£å¦‚æˆ‘ä»¬åœ¨ç±»å‹å®šä¹‰ä¸­çœ‹åˆ°çš„ï¼Œæ— å‚æ•°çš„ç±»å‹å®å‚`S`é»˜è®¤ä¸º`undefined`ã€‚å› æ­¤ï¼Œ`pill`çš„ç±»å‹åº”è¯¥æ¨æ–­ä¸º`undefined`ã€‚ç„¶è€Œï¼Œç”±äºæ‰“å­—ç¨¿ä¸­çš„[è®¾è®¡é™åˆ¶ï¼Œå®é™…ä¸Šæ¨æ–­ä¸º`any`ã€‚](https://github.com/microsoft/TypeScript/issues/32003)

åŒæ ·ï¼Œ`setPill`çš„ç±»å‹æ¨æ–­åˆ°`React.Dispatch<any>`ã€‚è¿™çœŸçš„å¾ˆç³Ÿç³•ï¼Œå› ä¸ºæ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢æˆ‘ä»¬ç”¨æ— æ•ˆçš„è®ºç‚¹æ¥ç§°å‘¼å®ƒ:`setPill({ hello: 5 })`ã€‚

```
export const PillSelector: React.FunctionComponent = () => {
    const [pill, setPill] = useState();
    return (
        <div>
            <button onClick={() => setPill('red')}>Red pill</button>
            <button onClick={() => setPill('blue')}>Blue pill</button>
            <span>You chose {pill} pill!</span>
        </div>
    );
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å‘`setState`ä¼ é€’ä¸€ä¸ªç±»å‹å‚æ•°ã€‚åœ¨ JSXï¼Œæˆ‘ä»¬å°†`pill`è§†ä¸ºæ–‡æœ¬ï¼Œå› æ­¤æˆ‘ä»¬çš„é¦–é€‰å¯èƒ½æ˜¯`string`ã€‚ç„¶è€Œï¼Œè®©æˆ‘ä»¬æ›´ç²¾ç¡®åœ°å°†ç±»å‹é™åˆ¶ä¸ºåªå…è®¸æˆ‘ä»¬æœŸæœ›çš„å€¼ã€‚

```
const [pill, setPill] = useState<'red' | 'blue'>(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ³¨æ„`pill`çš„æ¨æ–­ç±»å‹ç°åœ¨æ˜¯`"red" | "blue" | undefined`(å› ä¸ºè¿™ä¸€æ®µçŠ¶æ€æœ€åˆæ˜¯ç©ºçš„)ã€‚å¯ç”¨äº†`strictNullChecks`åï¼ŒTypeScript ä¸å…è®¸æˆ‘ä»¬åœ¨`pill` :
ä¸Šè°ƒç”¨ä»»ä½•ä¸œè¥¿

```
// ğŸ›‘ Object is possibly 'undefined'.ts(2532)
<span>You chose {pill.toUpperCase()} pill!</span> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

...é™¤éæˆ‘ä»¬å…ˆæ£€æŸ¥å€¼:

```
// âœ… No errors!
{pill && <span>You chose {pill.toUpperCase()} pill!</span>} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#clearable-state)å¯æ¸…é™¤çŠ¶æ€

å¦ä¸€ç§æƒ…å†µæ˜¯ï¼Œå½“ä½ ç»™`useState`æä¾›ä¸€ä¸ªç±»å‹å‚æ•°çš„æ—¶å€™ï¼Œåˆå§‹çŠ¶æ€è¢«å®šä¹‰ï¼Œä½†æ˜¯ä½ æƒ³è®©**ç¨åæ¸…é™¤**è¿™ä¸ªçŠ¶æ€ã€‚

```
export const PillSelector: React.FunctionComponent = () => {
    const [pill, setPill] = useState('blue');
    return (<div>
        <button onClick={() => setPill('red')}>Red pill</button>
        <button onClick={() => setPill('blue')}>Blue pill</button>
        // ğŸ›‘ Argument of type 'undefined' is not assignable 
        // to parameter of type 'SetStateAction<string>'.
        <button onClick={() => setPill(undefined)}>Reset</button>
        {pill && <span>You chose {pill.toUpperCase()} pill!</span>}
    </div>); } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç”±äºåˆå§‹çŠ¶æ€è¢«ä¼ é€’ç»™`useState`ï¼Œå› æ­¤`pill`çš„ç±»å‹è¢«æ¨æ–­ä¸º`string`ã€‚å› æ­¤ï¼Œå½“æ‚¨è¯•å›¾å°†`undefined`ä¼ é€’ç»™å®ƒæ—¶ï¼ŒTypeScript å°†å‡ºé”™ã€‚

æ‚¨å¯ä»¥é€šè¿‡æä¾›ç±»å‹å‚æ•°æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```
const [pill, setPill] = useState<'blue' | 'red' | undefined>('blue'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#summary)æ€»ç»“

æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬å·²ç»å½»åº•åˆ†æäº†`useState`å‡½æ•°çš„ç±»å‹å®šä¹‰ã€‚åŸºäºè¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä»€ä¹ˆæ—¶å€™å‘`useState`æä¾›ç±»å‹å‚æ•°æ˜¯å¿…è¦çš„ï¼Œä»€ä¹ˆæ—¶å€™æ¨æ–­çš„ç±»å‹æ˜¯è¶³å¤Ÿçš„ã€‚

æˆ‘å–œæ¬¢é’©å­æ˜¯ä»ç±»å‹å®šä¹‰ä¸­è¯»å–å¤šå°‘ä¿¡æ¯çš„å¥½ä¾‹å­ã€‚ä»–ä»¬çœŸçš„å±•ç¤ºäº†é™æ€æ‰“å­—çš„å¨åŠ›ï¼

## [](#want-to-learn-more)æƒ³äº†è§£æ›´å¤šï¼Ÿ

ä½ å–œæ¬¢è¿™ç¯‡æ‰“å­—ç¨¿å—ï¼Ÿæˆ‘æ‰“èµŒä½ ä¹Ÿä¼šå–œæ¬¢æˆ‘çš„ä¹¦ï¼

[é«˜çº§ç±»å‹è„šæœ¬](https://typescriptmasterclass.com)