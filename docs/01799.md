# ç”¨é’©å­è£…è½½å’Œæ˜¾ç¤ºæ•°æ®

> åŸæ–‡:[https://dev . to/juliang/loading-and-display-data-with-hooks-jlj](https://dev.to/juliang/loading-and-displaying-data-with-hooks-jlj)

åœ¨æœ¬ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨çŠ¶æ€ç®¡ç†åº“æˆ–æå‡ºä¸€ä¸ªé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯ä»æœ€ä½é™åº¦å¼€å§‹ï¼Œæ ¹æ®éœ€è¦æ„å»ºæˆ‘ä»¬çš„çŠ¶æ€ç®¡ç†ã€‚

* * *

*   åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°å¦‚ä½•ç”¨é’©å­åŠ è½½å’Œæ˜¾ç¤ºæ•°æ®ã€‚
*   åœ¨ç¬¬äºŒç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ç”¨é’©å­æ”¹å˜è¿œç¨‹æ•°æ®ã€‚
*   åœ¨ç¬¬ä¸‰ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ React Context åœ¨ç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®ï¼Œè€Œä¸ä½¿ç”¨å…¨å±€å˜é‡ã€å•ä¾‹å˜é‡æˆ–æ±‚åŠ©äº MobX æˆ– Redux ç­‰çŠ¶æ€ç®¡ç†åº“ã€‚
*   åœ¨ç¬¬å››ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ [SWR](https://swr.now.sh/) åœ¨ç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®ï¼Œè¿™å¯èƒ½æ˜¯æˆ‘ä»¬ä»ä¸€å¼€å§‹å°±åº”è¯¥åšçš„ã€‚

* * *

æœ€ç»ˆä»£ç å¯ä»¥åœ¨è¿™ä¸ª [GitHub repo](https://github.com/JulianG/minimal-state-management-demo) ä¸­æ‰¾åˆ°ã€‚å®ƒæ˜¯ TypeScriptï¼Œä½†æ˜¯ç±»å‹æ³¨é‡Šå¾ˆå°‘ã€‚**å¦å¤–ï¼Œè¯·æ³¨æ„è¿™ä¸æ˜¯ç”Ÿäº§ä»£ç ã€‚**ä¸ºäº†ä¸“æ³¨äºçŠ¶æ€ç®¡ç†ï¼Œè®¸å¤šå…¶ä»–æ–¹é¢æ²¡æœ‰è¢«è€ƒè™‘(ä¾‹å¦‚[ä¾èµ–å€’ç½®](https://en.wikipedia.org/wiki/Dependency_inversion_principle)ï¼Œæµ‹è¯•æˆ–ä¼˜åŒ–)ã€‚

## [](#loading-data-with-hooks)ç”¨é’©å­åŠ è½½æ•°æ®

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª REST APIï¼Œå…¶ä¸­åŒ…å«ä¸€ç³»åˆ— [Commodore 64](https://en.wikipedia.org/wiki/Commodore_64) æ¸¸æˆã€‚æˆ‘æ˜¯è¯´ï¼Œä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿ

**éœ€æ±‚:**æˆ‘ä»¬è¦åŠ è½½åˆ—è¡¨å¹¶æ˜¾ç¤ºæ¸¸æˆã€‚

[![my favourite commodore 64 games](img/9f1a72814292f155b42888f8ba5003f2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--DGXqcpyt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1vp7uggnq1ldbz3iw035.png)

### [](#1-basic-fetching)1ã€‚åŸºæœ¬æŠ“å–

ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•ä»æœåŠ¡å™¨è·å–æ¸¸æˆåˆ—è¡¨:

```
const getGames = () => {
  return fetch('http://localhost:3001/games/').then(response => response.json());
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯ä»¥åœ¨ React åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬çš„ç¬¬ä¸€æ¬¡è¿­ä»£å¦‚ä¸‹:

**App.tsx** (ç”± index.tsx æ¸²æŸ“)( *[è§å›è´­](https://github.com/JulianG/minimal-state-management-demo/tree/01-basic-fetching-2/src)* )

```
import React from 'react';

const getGames = () => {
  return fetch('http://localhost:3001/games/').then(response => response.json());
};

export const App = () => {
  const [games, setGames] = React.useState([]);

  React.useEffect(() => {
    getGames().then(games => setGames(games));
  }, []);

  return <pre>{JSON.stringify(games, null, 2)}</pre>;
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ç¬¬ä¸€æ¬¡å‘ˆç°æˆ‘ä»¬çš„`App`ç»„ä»¶æ—¶ï¼Œ`games`æ•°ç»„å°†ä¸ºç©ºã€‚ç„¶åå½“`getGames`è¿”å›çš„æ‰¿è¯ºç»“ç®—æ—¶ï¼Œ`games`æ•°ç»„åŒ…å«äº†æˆ‘ä»¬æ‰€æœ‰çš„æ¸¸æˆï¼Œå®ƒä»¬ä¼šä»¥éå¸¸åŸºæœ¬çš„æ–¹å¼æ˜¾ç¤ºå‡ºæ¥ã€‚

### [](#2-custom-react-hook)2ã€‚è‡ªå®šä¹‰ååº”æŒ‚é’©

æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†å…¶æå–åˆ°ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ä¸­çš„è‡ªå®šä¹‰ React é’©å­ä¸­ã€‚

**ä½¿ç”¨æ¸¸æˆã€‚ts** ( *[å‚è§ rest](https://github.com/JulianG/minimal-state-management-demo/blob/02-custom-react-hook/src)*)

```
import React from 'react';

const getGames = () => {
  return fetch('http://localhost:3001/games/').then(response => response.json());
};

export const useGames = () => {
  const [games, setGames] = React.useState([]);

  React.useEffect(() => {
    getGames().then(games => setGames(games));
  }, []);

  return games;
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**App.tsx** ( *[å‚è§å›è´­](https://github.com/JulianG/minimal-state-management-demo/blob/02-custom-react-hook/src)* )

```
import React from 'react';
import { useGames } from './useGames';

export const App = () => {
  const games = useGames();
  return <pre>{JSON.stringify(games, null, 2)}</pre>;
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#3-handling-errors-and-pending-state)3ã€‚å¤„ç†é”™è¯¯å’ŒæŒ‚èµ·çŠ¶æ€

æˆ‘ä»¬çš„è‡ªå®šä¹‰é’©å­ä¸å¤„ç†æŒ‚èµ·å’Œé”™è¯¯çŠ¶æ€ã€‚ä»æœåŠ¡å™¨åŠ è½½æ•°æ®æ—¶æ²¡æœ‰è§†è§‰åé¦ˆï¼Œæ›´ç³Ÿç³•çš„æ˜¯:å¤±è´¥æ—¶æ²¡æœ‰é”™è¯¯æ¶ˆæ¯ã€‚å¦‚æœæœåŠ¡å™¨å…³é—­ï¼Œæ¸¸æˆåˆ—è¡¨å°†ä¿æŒä¸ºç©ºï¼Œæ²¡æœ‰é”™è¯¯ã€‚

æˆ‘ä»¬å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æœ‰è¿™æ–¹é¢çš„åº“ï¼Œæœ€æµè¡Œçš„æ˜¯[react-async](https://www.npmjs.com/package/react-async)ï¼›ä½†æ˜¯æˆ‘ç°åœ¨è¿˜ä¸æƒ³æ·»åŠ ä¾èµ–é¡¹ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¤„ç†é”™è¯¯å’ŒæŒ‚èµ·çŠ¶æ€æ‰€éœ€çš„æœ€å°‘ä»£ç æ˜¯å¤šå°‘ã€‚

#### [](#useasyncfunction)ä½¿ç”¨åŒæ­¥åŠŸèƒ½

æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªè‡ªå®šä¹‰é’©å­ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¼‚æ­¥å‡½æ•°(è¿”å›ä¸€ä¸ªæ‰¿è¯º)å’Œä¸€ä¸ªé»˜è®¤å€¼ã€‚

è¿™ä¸ªé’©å­è¿”å›ä¸€ä¸ªåŒ…å« 3 ä¸ªå…ƒç´ çš„å…ƒç»„:`[value, error, isPending]`ã€‚å®ƒè°ƒç”¨ async å‡½æ•°ä¸€æ¬¡*ï¼Œå¹¶åœ¨è§£ææ—¶æ›´æ–°å€¼ï¼Œå½“ç„¶ï¼Œé™¤éæœ‰é”™è¯¯ã€‚

```
function useAsyncFunction<T>(asyncFunction: () => Promise<T>, defaultValue: T) {
  const [state, setState] = React.useState({
    value: defaultValue,
    error: null,
    isPending: true
  });

  React.useEffect(() => {
    asyncFunction()
      .then(value => setState({ value, error: null, isPending: false }))
      .catch(error => setState({ ...state, error: error.toString(), isPending: false }));
  }, [asyncFunction]); // *

  const { value, error, isPending } = state;
  return [value, error, isPending];
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* *æˆ‘ä»¬çš„`useAsyncFunction`é‡Œé¢çš„`useEffect`ä¼šè°ƒç”¨ä¸€æ¬¡å¼‚æ­¥å‡½æ•°ï¼Œç„¶åæ¯æ¬¡`asyncFunction`æ”¹å˜çš„æ—¶å€™ã€‚æ›´å¤šè¯¦æƒ…:[ä½¿ç”¨çŠ¶æ€æŒ‚é’©](https://reactjs.org/docs/hooks-state.html)ï¼Œ[ä½¿ç”¨æ•ˆæœæŒ‚é’©](https://reactjs.org/docs/hooks-effect.html)ï¼Œ[æŒ‚é’© API å‚è€ƒ](https://reactjs.org/docs/hooks-reference.html)ã€‚*

ç°åœ¨ï¼Œåœ¨ useGames.ts ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨è¿™ä¸ªæ–°çš„å®šåˆ¶é’©å­ï¼Œä¼ é€’å‡½æ•°`getGames`å’Œä¸€ä¸ªç©ºæ•°ç»„çš„åˆå§‹å€¼ä½œä¸ºå‚æ•°ã€‚

```
...
export const useGames = () => {
  const games = useAsyncFunction(getGames, []); // ğŸ¤” new array on every render?
  return games;
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸è¿‡ï¼Œæœ‰ä¸ªå°é—®é¢˜ã€‚æ¯æ¬¡è°ƒç”¨`useGames`æ—¶ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡æˆ‘ä»¬çš„`App`ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼ é€’ä¸€ä¸ªæ–°çš„ç©ºæ•°ç»„ã€‚è¿™å¯¼è‡´æˆ‘ä»¬çš„æ•°æ®åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¢«é‡æ–°è·å–ï¼Œä½†æ˜¯æ¯æ¬¡è·å–éƒ½ä¼šå¯¼è‡´ä¸€æ¬¡æ–°çš„æ¸²æŸ“ï¼Œæ‰€ä»¥è¿™å¯¼è‡´äº†ä¸€ä¸ªæ— é™å¾ªç¯ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨é’©å­å¤–çš„å¸¸é‡ä¸­å­˜å‚¨åˆå§‹å€¼æ¥é¿å…è¿™ç§æƒ…å†µ:

```
...
const emptyList = [];

export const useGames = () => {
  const [games] = useAsyncFunction(getGames, emptyList);
  return games;
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#small-typescript-interlude)å°å‹æ‰“å­—ç¨¿æ’æ›²

å¦‚æœä½ ä½¿ç”¨æ™®é€šçš„ JavaScriptï¼Œä½ å¯ä»¥è·³è¿‡è¿™ä¸€éƒ¨åˆ†ã€‚

å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ä¸¥æ ¼ç±»å‹è„šæœ¬ï¼Œç”±äºâ€œnoImplicitAnyâ€ç¼–è¯‘å™¨é€‰é¡¹ï¼Œä¸Šè¿°ä»£ç å°†æ— æ³•å·¥ä½œã€‚è¿™æ˜¯å› ä¸º`const emptyList = [];`æ˜¯ä¸€ä¸ªéšå¼çš„`any`æ•°ç»„ã€‚

æˆ‘ä»¬å¯ä»¥åƒ`const emptyList: any[] = [];`ä¸€æ ·æ³¨é‡Šå®ƒï¼Œç„¶åç»§ç»­å‰è¿›ã€‚**ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨æ‰“å­—ç¨¿æ˜¯æœ‰åŸå› çš„ã€‚**æ˜ç¡®çš„`any`å¯ä»¥(ä¹Ÿåº”è¯¥)æ›´å…·ä½“ã€‚

è¿™ä¸ªåˆ—è¡¨çš„å…ƒç´ æ˜¯ä»€ä¹ˆï¼Ÿ**æ¸¸æˆï¼**æ˜¯æ¸¸æˆåˆ—è¡¨ã€‚

```
const emptyList: Game[] = []; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ç„¶ï¼Œç°åœ¨æˆ‘ä»¬**å¿…é¡»ç»™**å®šä¹‰ä¸€ä¸ª`Game`ç±»å‹ã€‚ä½†æ˜¯ä¸è¦ç»æœ›ï¼æˆ‘ä»¬æœ‰æ¥è‡ªæœåŠ¡å™¨çš„ JSON å“åº”ï¼Œæ¯ä¸ªæ¸¸æˆå¯¹è±¡çœ‹èµ·æ¥åƒè¿™æ ·:

```
{  "id":  5,  "title":  "Kung-Fu Master",  "year":  1984,  "genre":  "beat'em up",  "url":  "https://en.wikipedia.org/wiki/Kung-Fu_Master_(video_game)",  "status":  "in-progress",  "img":  "http://localhost:3001/img/kung-fu-master.gif"  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [transform.tools](https://transform.tools/json-to-typescript) å°†å…¶è½¬æ¢ä¸º TypeScript æ¥å£(æˆ–ç±»å‹)ã€‚

```
type Game = {
  id: number;
  title: string;
  year: number;
  genre: string;
  url: string;
  status: 'not-started' | 'in-progress' | 'finished';
  img: string;
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

##### [](#one-more-thing)è¿˜æœ‰ä¸€ä»¶äº‹:

æˆ‘ä»¬è¯´`useAsyncFunction`è¿”å›äº†ä¸€ä¸ª tupleï¼Œä½†æ˜¯ TypeScript çš„æ¨æ–­(@3.6.2)å¹¶ä¸ç†è§£è¿™ä¸€ç‚¹ã€‚å®ƒæ¨æ–­è¿”å›ç±»å‹ä¸º`Array<(boolean | Game[] | null)>`ã€‚æˆ‘ä»¬å¯ä»¥æ˜¾å¼åœ°å°†å‡½æ•°çš„è¿”å›ç±»å‹æ ‡æ³¨ä¸º`[T, string | null, boolean]`ï¼Œå…¶ä¸­`T`æ˜¯`value`çš„(æ³›å‹)ç±»å‹ï¼Œ`(string | null)`æ˜¯`error`çš„ç±»å‹ï¼Œ`boolean`æ˜¯`isPending`ã€‚

```
export function useAsyncFunction<T>(
  asyncFunction: () => Promise<T>,
  defaultValue: T
): [T, string | null, boolean] {
  ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼ŒTypeScript ä¼šå»ºè®®æ­£ç¡®çš„ç±»å‹ã€‚

```
const [games] = useAsyncFunction(getGames, emptyList); // games is of type Game[] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰“å­—ç¨¿æ’æ›²ç»“æŸã€‚

#### [](#composing-our-custom-hooks)ç¼–å†™è‡ªå®šä¹‰é’©å­

**useAsyncFunction.ts** ç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:( *[è§å›è´­](https://github.com/JulianG/minimal-state-management-demo/blob/03-handling-error-pending-1/src/useAsyncFunction.ts)* )

```
import React from 'react';

export function useAsyncFunction<T>(
  asyncFunction: () => Promise<T>,
  defaultValue: T
): [T, string | null, boolean] {
  const [state, setState] = React.useState({
    value: defaultValue,
    error: null,
    isPending: true
  });

  React.useEffect(() => {
    asyncFunction()
      .then(value => setState({ value, error: null, isPending: false }))
      .catch(error =>
        setState({ value: defaultValue, error: error.toString(), isPending: false })
      );
  }, [asyncFunction, defaultValue]);

  const { value, error, isPending } = state;
  return [value, error, isPending];
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„`useGames`é’©å­ä¸­ä½¿ç”¨å®ƒ:

**ä½¿ç”¨æ¸¸æˆã€‚ts** ( *[å‚è§ rest](https://github.com/JulianG/minimal-state-management-demo/blob/03-handling-error-pending-1/src/useGames.ts)*)

```
import { useAsyncFunction } from './useAsyncFunction';

const getGames = (): Promise<Game[]> => {
  return fetch('http://localhost:3001/games/').then(response => response.json());
};

type Game = {
  id: number;
  title: string;
  year: number;
  genre: string;
  url: string;
  status: 'not-started' | 'in-progress' | 'finished';
  img: string;
};

const emptyList: Game[] = [];

export const useGames = () => {
  const [games] = useAsyncFunction(getGames, emptyList);
  return games;
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#changing-ui-to-display-errors-and-pending-states)æ”¹å˜ç”¨æˆ·ç•Œé¢ä»¥æ˜¾ç¤ºé”™è¯¯å’Œæœªå†³çŠ¶æ€

å¤ªå¥½äº†ï¼ä½†æ˜¯æˆ‘ä»¬ä»ç„¶æ²¡æœ‰å¤„ç†é”™è¯¯å’Œæœªå†³çŠ¶æ€ã€‚æˆ‘ä»¬éœ€è¦æ”¹å˜æˆ‘ä»¬çš„`App`ç»„ä»¶:

```
import React from 'react';
import { useGames } from './useGames';

export const App = () => {
  const { games, error, isPending } = useGames();

  return (
    <>
      {error && <pre>ERROR! {error}...</pre>}
      {isPending && <pre>LOADING...</pre>}
      <pre>{JSON.stringify(games, null, 2)}</pre>
    </>
  );
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è€Œæˆ‘ä»¬çš„`useGames`é’©å­åº”è¯¥è¿”å›ä¸€ä¸ªå¸¦æœ‰ä¸‰ä¸ªé”®çš„å¯¹è±¡:`games`ã€`error`ã€`isPending`ã€‚

```
export const useGames = () => {
  const [games, error, isPending] = useAsyncFunction(getGames, emptyList);
  return { games, error, isPending };
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬è¿˜æ”¹è¿›äº†æˆ‘ä»¬çš„`getGames`å‡½æ•°ï¼Œå°†ä¸åŒäº 200 çš„ HTTP çŠ¶æ€ä»£ç ä½œä¸ºé”™è¯¯:

```
const getGames = (): Promise<Game[]> => {
  return fetch('http://localhost:3001/games/').then(response => {
    if (response.status !== 200) {
      throw new Error(`${response.status}  ${response.statusText}`);
    }
    return response.json();
  });
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢çš„ä»£ç æ˜¯è¿™æ ·çš„:( *[è§å›è´­](https://github.com/JulianG/minimal-state-management-demo/tree/03-handling-error-pending-2/src)* )ã€‚

## [](#conclusion)ç»“è®º

æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ React é’©å­ä» REST API åŠ è½½æ•°æ®ã€‚

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ HTTP `PATCH`è¯·æ±‚æ”¹å˜è¿œç¨‹æ•°æ®ï¼Œä»¥åŠå½“è¯·æ±‚æˆåŠŸæ—¶å¦‚ä½•æ›´æ–°æˆ‘ä»¬çš„å®¢æˆ·ç«¯æ•°æ®ã€‚

## [](#resources)èµ„æº

å»¶ä¼¸é˜…è¯»:

*   [ä½¿ç”¨çŠ¶æ€æŒ‚é’©](https://reactjs.org/docs/hooks-state.html)
*   [ä½¿ç”¨æ•ˆæœæŒ‚é’©](https://reactjs.org/docs/hooks-effect.html)
*   [é’©å­ API å¼•ç”¨](https://reactjs.org/docs/hooks-reference.html)
*   [ä½•æ—¶ä½¿ç”¨å¤‡å¿˜å½•å’Œä½¿ç”¨å›æ‹¨](https://kentcdodds.com/blog/usememo-and-usecallback/)
*   [ç”¨ React.useEffect å–æ¶ˆæ‰¿è¯º](https://juliangaramendy.dev/use-promise-subscription/)