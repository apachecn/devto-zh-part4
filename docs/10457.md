# å¯é€‰é“¾æ¥çš„æˆæœ¬ã€‚

> åŸæ–‡ï¼š<https://dev.to/smeijer/the-costs-of-optional-chaining-5bno>

ç°åœ¨å¯é€‰é“¾æ¥å·²ç»åˆ°äº†é˜¶æ®µ 3ï¼Œæ˜¯æ—¶å€™é‡æ–°è¯„ä¼°äº†ã€‚

ä¸€å¹´å¤šä»¥å‰ï¼Œæˆ‘ä»¬å†³å®šç»§ç»­å‰è¿›ï¼Œå¼€å§‹ä½¿ç”¨`@babel/plugin-proposal-optional-chaining`ã€‚å’Œå¾€å¸¸ä¸€æ ·ï¼Œbabel æ’ä»¶çš„ä¸»è¦åŸå› æ˜¯å¼€å‘è€…ä½“éªŒã€‚â€œè¿™ä¼šè®©æˆ‘ä»¬çš„ç”Ÿæ´»æ›´è½»æ¾â€ã€‚

ç¡®å®å¦‚æ­¤ã€‚ç°åœ¨ä¾ç„¶å¦‚æ­¤ã€‚æˆ‘çœ‹åˆ°å®ƒåœ¨æˆ‘ä»¬çš„ä»£ç åº“ä¸­åˆ°å¤„è¢«ä½¿ç”¨ã€‚

ååº”ä¸­`componentDidUpdate` :

```
componentDidUpdate(prevProps) {
  if (
    this.props.image?.type !== prevProps.image?.type || 
    this.props.image?.orientation !== prevProps.image?.orientation
  ) {
    // ...
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æ¸²æŸ“å‡½æ•°ä¸­:

```
function CommentButtons({ user }) {
  return (
    <div>
      <Button disabled={user?.can?.edit}>edit</Button>
      <Button disabled={user?.can?.delete}>delete</Button>
      <Button disabled={user?.can?.reply}>reply</Button>
    </div>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

çœ‹èµ·æ¥ç¡®å®ä¸é”™ã€‚å¾ˆå®¹æ˜“ç†è§£æ˜¯æ€ä¹ˆå›äº‹ã€‚ç„¶è€Œï¼Œè¿™æ˜¯æœ‰ä»£ä»·çš„ã€‚è€Œæˆ‘ä»¬ï¼Œæˆ–è€…è‡³å°‘æˆ‘ï¼Œé«˜åº¦ä½ä¼°äº†è¿™ä¸€ç‚¹ã€‚æˆæœ¬æ˜¯å­˜åœ¨çš„ï¼ŒåŒ…æ‹¬æ€§èƒ½å’Œæ†ç»‘åŒ…å¤§å°ã€‚

# è¡¨ç°

å…ˆè¯´æ€§èƒ½ã€‚å› ä¸ºé‚£ä¸æ˜¯æˆ‘æœ€å…³å¿ƒçš„ã€‚

å¦‚æœå¯é€‰é“¾æ¥è¢«è¿‡åº¦ä½¿ç”¨ï¼Œæ€§èƒ½ä»£ä»·æ˜¯å­˜åœ¨çš„ã€‚ä¸è¦å®ˆæŠ¤ä½ æ‰€æœ‰çš„è´¢äº§ã€‚åªå®ˆæŠ¤æœªçŸ¥ã€‚å¦‚æœä½ æ­£åœ¨å¤„ç†ä½ è‡ªå·±çš„ä»£ç ï¼Œå‡è®¾å­˜åœ¨æ˜¯å®‰å…¨çš„ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ²¡æœ‰åœ¨ä¸€ç§’é’Ÿå†…è¿­ä»£è‡ªå·±çš„æ¸²æŸ“å‡½æ•° 6500 ä¸‡æ¬¡ã€‚å› æ­¤ï¼Œå³ä½¿æ€§èƒ½æŸå¤±é«˜è¾¾ 45%ã€‚å®ƒåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä»ç„¶å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚å¯¹äºé‚£äº›æƒ³çŸ¥é“çš„äººï¼Œè¿™é‡Œæœ‰ [`jsperf`](https://jsperf.com/costs-of-optional-chaining) ã€‚è¯·ä¸è¦å¤ªçœ‹é‡é‚£ä»¶äº‹ã€‚

æˆ‘ä»¬ç»§ç»­å§ã€‚

# æ†å°ºå¯¸

ä¾‹å¦‚ï¼Œä¸Šé¢å‘å¸ƒçš„`CommentButtons`ç»„ä»¶åŒ…å«`244`å­—èŠ‚çš„ç¼–å†™ä»£ç ï¼Œè¿™äº›ä»£ç é€šè¿‡[å°†](https://babeljs.io/repl#?babili=false&browsers=&build=&builtIns=false&spec=false&loose=false&code_lz=GYVwdgxgLglg9mABAYTgWzQUzFAQiKKBAZwAoBvREYzAJ0QF8BKRcgKEUVsyhFqVIdOiADwATGADcAfEOGj8hBIgnEAhgCMANpjEBectToB-AHQQ1YM7phQG0m1BEB6RUTCz5nEW-WrNOvqGNLRmFlamYpg6UJj2UTGYLr4ecsI-BO4qMOraugZGoeaWZtwADloAnvblVcmZCJ7pzhIyQkxsDEA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=true&timeTravel=false&sourceType=module&lineWrap=true&presets=es2015%2Creact%2Cstage-2&prettier=true&targets=&version=7.5.5&externalPlugins=%40babel%2Fplugin-proposal-optional-chaining%407.2.0)è½¬æ¢æˆ`1.000`å­—èŠ‚ã€‚å¤§äº† 4 å€ã€‚

å› ä¸ºè¿™æ˜¯æˆ‘ä»¬è‡ªå·±çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°å‡è®¾ï¼Œæ¯å½“`user`é“å…·ä¸æ˜¯`undefined`æ—¶ï¼Œå®ƒä¹Ÿå…·æœ‰`can`å±æ€§ã€‚å¦‚æœå®ƒä¸èƒ½è¢«åç«¯æ‰§è¡Œã€‚å®ƒå°†ç”±å‰ç«¯å¼ºåˆ¶æ‰§è¡Œã€‚çˆ¶ç»„ä»¶ï¼Œæˆ–è€…æˆ‘ä»¬è°ƒç”¨ API çš„åœ°æ–¹ã€‚

æ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ç»„ä»¶æ¥åˆ é™¤`optional chaining`ï¼Œä»è€Œå°†[ä¼ è¾“çš„å­—èŠ‚å¤§å°](https://babeljs.io/repl#?babili=false&browsers=&build=&builtIns=false&spec=false&loose=false&code_lz=GYVwdgxgLglg9mABAYTgWzQUzFAQiKKBAZwAoBvREYzAJ0QF8BKRcgKEUQhKi4EMkAXio16AfhF0AdBAGIAXKwYBuDojW1MUELSSk1nADwATGADcAfAc6JD-QgkSnifAEYAbTMcHlZYKV4wUAwWgVCGAPT2RGBWNjZ2BDFOMC4eXj5-UsaYnlCYITl5mJHRCHHxtmVIzm6e3r4CUpoADu4AniGtHaVJ5daRppZqTGwMQA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=true&timeTravel=false&sourceType=module&lineWrap=true&presets=es2015%2Creact%2Cstage-2&prettier=true&targets=&version=7.5.5&externalPlugins=%40babel%2Fplugin-proposal-optional-chaining%407.2.0)å‡å°‘åˆ°`477`å­—èŠ‚ã€‚è¿™é‡Œæˆ‘ä»¬ç”šè‡³æ²¡æœ‰å‡è®¾`can`çš„å­˜åœ¨ï¼Œè€Œæ˜¯é»˜è®¤ä¸ºä¸€ä¸ªç©ºå¯¹è±¡ã€‚

```
function CommentButtons({ user }) {
  const can = user ? user.can : {};

  return (
    <div>
      <Button disabled={can.edit}>edit</Button>
      <Button disabled={can.delete}>delete</Button>
      <Button disabled={can.reply}>reply</Button>
    </div>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘æ„è¯†åˆ°è¿™æ˜¯ä¸€ä¸ªæç«¯çš„ä¾‹å­ã€‚ä½†æ˜¯æˆ‘åœ¨é‡å¤–çœ‹åˆ°äº†ä¸æ­¤éå¸¸ç›¸ä¼¼çš„ä»£ç ã€‚æˆ‘ä»¬å¼€å‘äººå‘˜åªæ˜¯å–œæ¬¢æˆ‘ä»¬çš„ç”Ÿäº§åŠ›å·¥å…·ã€‚å¦‚æœæœ‰ä¸€ä¸ªå·´åˆ«å¡”æ’ä»¶å¯ä»¥è®©äº‹æƒ…å˜å¾—æ›´ç®€å•ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨å®ƒå‘¢ï¼Ÿ

æˆ‘å¹¶ä¸æ˜¯è¯´å®Œå…¨ä¸ä½¿ç”¨å¯é€‰çš„é“¾æ¥ã€‚æˆ‘ä»ç„¶å–œæ¬¢ä½¿ç”¨å®ƒã€‚æˆ‘è¯·ä½ è®°ä½è¿™æ˜¯æœ‰ä»£ä»·çš„ã€‚ä¾‹å¦‚ï¼Œå°½é‡ä¸è¦åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å¯¹åŒä¸€ä¸ªå±æ€§ä½¿ç”¨ä¸¤æ¬¡å›é€€:

```
var canEdit = user?.can?.edit;
var canDelete = user?.can?.delete;

// transpiles to:
"use strict";

var _user, _user$can, _user2, _user2$can;

var canEdit =
  (_user = user) === null || _user === void 0
    ? void 0
    : (_user$can = _user.can) === null || _user$can === void 0
      ? void 0
      : _user$can.edit;
var canDelete =
  (_user2 = user) === null || _user2 === void 0
    ? void 0
    : (_user2$can = _user2.can) === null || _user2$can === void 0
      ? void 0
      : _user2$can.delete; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬åªéœ€æ£€æŸ¥ä¸€æ¬¡`user.can`å±æ€§:
ï¼Œå°±å¯ä»¥è½»æ¾å‡å°‘[å’Œ](https://babeljs.io/repl#?babili=false&browsers=&build=&builtIns=false&spec=false&loose=false&code_lz=G4QwTgBAxiB2CiATAlgFwgXggVwM4FMwB-AOhllPxVQG4AoUScgEXwBt9V9McDiy4pRO074aQA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=true&timeTravel=false&sourceType=module&lineWrap=true&presets=es2015%2Creact%2Cstage-2&prettier=true&targets=&version=7.5.5&externalPlugins=%40babel%2Fplugin-proposal-optional-chaining%407.2.0)

```
var can = user?.can || {};
var canEdit = can.edit;
var canDelete = can.delete;

// transpiles to:
"use strict";

var _user;

var can =
  ((_user = user) === null || _user === void 0 ? void 0 : _user.can) || {};
var canEdit = can.edit;
var canDelete = can.delete; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é™¤éä½ çš„ç¬¬ä¸€ä¸ªå¯é€‰æ“ä½œç¬¦åµŒå¥—åœ¨æŸä¸ªåœ°æ–¹ï¼Œå¦åˆ™é‡‡å–æœ€åä¸€æ­¥å¯èƒ½æ˜¯å€¼å¾—çš„ï¼Œå¹¶ä¸”å®Œå…¨é¿å…å¯é€‰æ“ä½œç¬¦:

```
var can = user && user.can || {};
var canEdit = can.edit;
var canDelete = can.delete;

// transpiles to:
"use strict";

var can = (user && user.can) || {};
var canEdit = can.edit;
var canDelete = can.delete; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘å¸Œæœ›è¿™èƒ½è¯´æ˜æˆ‘çš„è§‚ç‚¹ã€‚æˆ‘ç¡®å®æ„è¯†åˆ° gzip å¯ä»¥æ¶ˆé™¤ä¸€äº›å¼€é”€ï¼Œå› ä¸ºå®ƒéå¸¸æ“…é•¿å‹ç¼©åƒ`=== void 0`å’Œ`=== null`è¿™æ ·çš„é‡å¤æ¨¡å¼ã€‚ä½†æ˜¯å³ä½¿æœ‰äº† gzipï¼Œå¯é€‰é“¾æ¥çš„æˆæœ¬ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚è¯·è®°ä½è¿™ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´å†…åšæŒä½¿ç”¨é€šå¤©å¡”ã€‚å³ä½¿ç°åœ¨æ˜¯ç¬¬ä¸‰é˜¶æ®µï¼Œå®ƒä¹Ÿä¸ä¼šåœ¨çŸ­æœŸå†…ç™»é™†æˆ‘ä»¬éœ€è¦æ”¯æŒçš„æ‰€æœ‰æµè§ˆå™¨ã€‚

æˆ‘ä»ç„¶ä¼šç»§ç»­ä½¿ç”¨å¯é€‰é“¾æ¥ã€‚å°½ç®¡æ²¡é‚£ä¹ˆç‹‚çƒ­ã€‚

* * *

*ğŸ‘‹æˆ‘æ˜¯æ–¯è’‚èŠ¬ï¼Œæˆ‘æ­£åœ¨å»ºé€ [ä¸Šå‡æ°”æµ. app](http://updrafts.app) ã€‚æ¬¢è¿åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘ã€‚*